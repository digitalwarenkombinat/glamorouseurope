var ns=Object.defineProperty;var ss=(fe,ee,ue)=>ee in fe?ns(fe,ee,{enumerable:!0,configurable:!0,writable:!0,value:ue}):fe[ee]=ue;var Vi=(fe,ee,ue)=>(ss(fe,typeof ee!="symbol"?ee+"":ee,ue),ue);import{r as reactExports,a as reactDomExports,$ as $2AODx$react,e as e$1,c as commonjsGlobal,g as getAugmentedNamespace,b as getDefaultExportFromCjs$1,d as $7SXl2$reactdom}from"./index-xzSvTXjR.js";var __defProp=Object.defineProperty,__defNormalProp=(fe,ee,ue)=>ee in fe?__defProp(fe,ee,{enumerable:!0,configurable:!0,writable:!0,value:ue}):fe[ee]=ue,__publicField=(fe,ee,ue)=>(__defNormalProp(fe,typeof ee!="symbol"?ee+"":ee,ue),ue);const EMPTY=[];Object.freeze(EMPTY);const emptyAnnotationPage={id:"https://iiif-parser/annotation-page",type:"AnnotationPage",behavior:EMPTY,motivation:null,label:null,thumbnail:EMPTY,summary:null,requiredStatement:null,metadata:EMPTY,rights:null,provider:EMPTY,items:EMPTY,seeAlso:EMPTY,homepage:EMPTY,logo:EMPTY,rendering:EMPTY,service:EMPTY},emptyCanvas={id:"https://iiif-parser/empty-canvas",type:"Canvas",label:null,behavior:EMPTY,motivation:null,thumbnail:EMPTY,posterCanvas:null,accompanyingCanvas:null,placeholderCanvas:null,summary:null,requiredStatement:null,metadata:EMPTY,rights:null,navDate:null,provider:EMPTY,items:EMPTY,annotations:EMPTY,seeAlso:EMPTY,homepage:EMPTY,logo:EMPTY,partOf:EMPTY,rendering:EMPTY,service:EMPTY,duration:0,height:0,width:0},emptyCollection={id:"https://iiif-parser/empty-collection",type:"Collection",label:null,viewingDirection:"left-to-right",behavior:EMPTY,motivation:null,thumbnail:EMPTY,posterCanvas:null,accompanyingCanvas:null,placeholderCanvas:null,summary:null,requiredStatement:null,metadata:EMPTY,rights:null,navDate:null,provider:EMPTY,items:EMPTY,annotations:EMPTY,seeAlso:EMPTY,homepage:EMPTY,logo:EMPTY,partOf:EMPTY,rendering:EMPTY,service:EMPTY,services:EMPTY},emptyManifest={id:"https://iiif-parser/empty-manifest",type:"Manifest",annotations:EMPTY,behavior:EMPTY,homepage:EMPTY,items:EMPTY,label:null,logo:EMPTY,metadata:EMPTY,motivation:null,navDate:null,provider:EMPTY,partOf:EMPTY,posterCanvas:null,accompanyingCanvas:null,placeholderCanvas:null,rendering:EMPTY,requiredStatement:null,rights:null,seeAlso:EMPTY,service:EMPTY,services:EMPTY,start:null,structures:EMPTY,summary:null,thumbnail:EMPTY,viewingDirection:"left-to-right"},emptyRange={id:"https://iiif-parser/empty-canvas",type:"Range",label:null,behavior:EMPTY,motivation:null,thumbnail:EMPTY,posterCanvas:null,accompanyingCanvas:null,placeholderCanvas:null,summary:null,requiredStatement:null,metadata:EMPTY,rights:null,navDate:null,provider:EMPTY,items:EMPTY,annotations:EMPTY,seeAlso:EMPTY,homepage:EMPTY,logo:EMPTY,partOf:EMPTY,rendering:EMPTY,service:EMPTY,start:null,supplementary:null,viewingDirection:"left-to-right"},emptyAgent={id:"https://iiif-parser/empty-agent",type:"Agent",label:{},logo:EMPTY,seeAlso:EMPTY,homepage:EMPTY};function ensureArray$1(fe){return Array.isArray(fe)?fe:[fe]}const types$1=["Collection","Manifest","Canvas","AnnotationPage","AnnotationCollection","Annotation","ContentResource","Range","Service","Selector","Agent"];function identifyResource$1(fe){if(typeof fe>"u"||fe===null)throw new Error("Null or undefined is not a valid entity.");if(Array.isArray(fe))throw new Error("Array is not a valid entity");if(typeof fe!="object")throw new Error(`${typeof fe} is not a valid entity`);if(typeof fe.type=="string"){const ee=types$1.indexOf(fe.type);if(ee!==-1)return types$1[ee]}if(fe.profile)return"Service";throw new Error("Resource type is not known")}class Traverse$1{constructor(ee,ue={}){__publicField(this,"traversals"),__publicField(this,"options"),this.traversals={collection:[],manifest:[],canvas:[],annotationCollection:[],annotationPage:[],annotation:[],contentResource:[],choice:[],range:[],service:[],agent:[],...ee},this.options={allowUndefinedReturn:!1,...ue}}static all(ee){return new Traverse$1({collection:[ee],manifest:[ee],canvas:[ee],annotationCollection:[ee],annotationPage:[ee],annotation:[ee],contentResource:[ee],choice:[ee],range:[ee],service:[ee]})}traverseDescriptive(ee){return ee.thumbnail&&(ee.thumbnail=ee.thumbnail.map(ue=>this.traverseType(ue,this.traversals.contentResource))),ee.provider&&(ee.provider=ee.provider.map(ue=>this.traverseAgent(ue))),ee}traverseLinking(ee){return ee.seeAlso&&(ee.seeAlso=ee.seeAlso.map(ue=>this.traverseType(ue,this.traversals.contentResource))),ee.service&&(ee.service=ensureArray$1(ee.service).map(ue=>this.traverseType(ue,this.traversals.service))),ee.services&&(ee.services=ee.services.map(ue=>this.traverseType(ue,this.traversals.service))),ee.logo&&(ee.logo=ee.logo.map(ue=>this.traverseType(ue,this.traversals.contentResource))),ee.homepage&&(ee.homepage=ee.homepage.map(ue=>this.traverseType(ue,this.traversals.contentResource))),ee.partOf&&(ee.partOf=ee.partOf.map(ue=>typeof ue=="string"||!ue.type?this.traverseType(ue,this.traversals.contentResource):ue.type==="Canvas"?this.traverseType(ue,this.traversals.canvas):ue.type==="AnnotationCollection"?this.traverseType(ue,this.traversals.annotationCollection):ue.type==="Collection"?this.traverseType(ue,this.traversals.collection):this.traverseType(ue,this.traversals.contentResource))),ee.start&&(ee.start=ee.start?this.traverseType(ee.start,this.traversals.canvas):null),ee.rendering&&(ee.rendering=ee.rendering.map(ue=>this.traverseType(ue,this.traversals.contentResource))),ee.supplementary&&(ee.supplementary=ee.supplementary.map(ue=>this.traverseType(ue,this.traversals.contentResource))),ee}traverseCollectionItems(ee){return ee.items&&ee.items.map(ue=>ue.type==="Collection"?this.traverseCollection(ue):this.traverseManifest(ue)),ee}traverseCollection(ee){return this.traverseType(this.traverseDescriptive(this.traverseInlineAnnotationPages(this.traverseLinking(this.traversePosterCanvas(this.traverseCollectionItems(ee))))),this.traversals.collection)}traverseManifestItems(ee){return ee.items&&(ee.items=ee.items.map(ue=>this.traverseCanvas(ue))),ee}traverseManifestStructures(ee){return ee.structures&&(ee.structures=ee.structures.map(ue=>this.traverseRange(ue))),ee}traverseManifest(ee){return this.traverseType(this.traverseInlineAnnotationPages(this.traverseManifestStructures(this.traversePosterCanvas(this.traverseDescriptive(this.traverseLinking(this.traverseManifestItems(ee)))))),this.traversals.manifest)}traverseCanvasItems(ee){return ee.items=(ee.items||[]).map(ue=>this.traverseAnnotationPage(ue)),ee}traverseInlineAnnotationPages(ee){return typeof ee=="string"||!ee||ee.annotations&&(ee.annotations=ee.annotations.map(ue=>this.traverseAnnotationPage(ue))),ee}traverseCanvas(ee){return this.traverseType(this.traverseInlineAnnotationPages(this.traversePosterCanvas(this.traverseDescriptive(this.traverseLinking(this.traverseCanvasItems(ee))))),this.traversals.canvas)}traverseAnnotationPageItems(ee){return ee.items&&(ee.items=ee.items.map(ue=>this.traverseAnnotation(ue))),ee}traverseAnnotationPage(ee){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseAnnotationPageItems(ee))),this.traversals.annotationPage)}traverseAnnotationBody(ee){return Array.isArray(ee.body)?ee.body=ee.body.map(ue=>this.traverseContentResource(ue)):ee.body&&(ee.body=this.traverseContentResource(ee.body)),ee}traversePosterCanvas(ee){return ee.posterCanvas&&(ee.posterCanvas=this.traverseCanvas(ee.posterCanvas)),ee.placeholderCanvas&&(ee.placeholderCanvas=this.traverseCanvas(ee.placeholderCanvas)),ee.accompanyingCanvas&&(ee.accompanyingCanvas=this.traverseCanvas(ee.accompanyingCanvas)),ee}traverseAnnotation(ee){return this.traverseType(this.traverseLinking(this.traverseAnnotationBody(ee)),this.traversals.annotation)}traverseContentResourceLinking(ee){return typeof ee=="string"||!ee||ee&&ee.service&&(ee.service=ensureArray$1(ee.service||[]).map(ue=>this.traverseType(ue,this.traversals.service))),ee}traverseContentResource(ee){return ee.type==="Choice"&&(ee.items=ee.items.map(ue=>this.traverseContentResource(ue))),this.traverseType(this.traverseInlineAnnotationPages(this.traverseContentResourceLinking(ee)),this.traversals.contentResource)}traverseRangeRanges(ee){return ee.items&&(ee.items=ee.items.map(ue=>typeof ue=="string"?this.traverseCanvas({id:ue,type:"Canvas"}):ue.type==="Manifest"?this.traverseManifest(ue):this.traverseRange(ue))),ee}traverseRange(ee){return this.traverseType(this.traversePosterCanvas(this.traverseDescriptive(this.traverseLinking(this.traverseRangeRanges(ee)))),this.traversals.range)}traverseAgent(ee){return this.traverseType(this.traverseDescriptive(this.traverseLinking(ee)),this.traversals.agent)}traverseType(ee,ue){return ue.reduce((pe,_e)=>{const Ne=_e(pe);return typeof Ne>"u"&&!this.options.allowUndefinedReturn?pe:Ne},ee)}traverseService(ee){return this.traverseType(ee,this.traversals.service)}traverseUnknown(ee){const ue=identifyResource$1(ee);switch(ue){case"Collection":return this.traverseCollection(ee);case"Manifest":return this.traverseManifest(ee);case"Canvas":return this.traverseCanvas(ee);case"AnnotationPage":return this.traverseAnnotationPage(ee);case"Annotation":return this.traverseAnnotation(ee);case"ContentResource":return this.traverseContentResource(ee);case"Range":return this.traverseRange(ee);case"Service":return this.traverseService(ee);case"Agent":return this.traverseAgent(ee);default:throw new Error(`Unknown or unsupported resource type of ${ue}`)}}}const types=["sc:Collection","sc:Manifest","sc:Canvas","sc:AnnotationList","oa:Annotation","sc:Range","sc:Layer","sc:Sequence","oa:Choice","Service","ContentResource"];function identifyResource(fe){if(typeof fe>"u"||fe===null)throw new Error("Null or undefined is not a valid entity.");if(Array.isArray(fe))throw new Error("Array is not a valid entity");if(typeof fe!="object")throw new Error(`${typeof fe} is not a valid entity`);if(typeof fe["@type"]=="string"){const ee=types.indexOf(fe["@type"]);if(ee!==-1)return types[ee]}if(fe.profile)return"Service";if(fe.format||fe["@type"])return"ContentResource";throw new Error("Resource type is not known")}class Traverse{constructor(ee,ue={}){__publicField(this,"traversals"),__publicField(this,"options"),this.traversals={collection:[],manifest:[],canvas:[],annotationList:[],sequence:[],annotation:[],contentResource:[],choice:[],range:[],service:[],layer:[],...ee},this.options={convertPropsToArray:!0,mergeMemberProperties:!0,allowUndefinedReturn:!1,...ue}}static all(ee){return new Traverse({collection:[ee],manifest:[ee],canvas:[ee],annotationList:[ee],sequence:[ee],annotation:[ee],contentResource:[ee],choice:[ee],range:[ee],service:[ee],layer:[ee]})}traverseCollection(ee){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseCollectionItems(ee))),this.traversals.collection)}traverseCollectionItems(ee){if(this.options.mergeMemberProperties){const ue=[...(ee.manifests||[]).map(pe=>typeof pe=="string"?{"@id":pe,"@type":"sc:Manifest"}:pe),...(ee.collections||[]).map(pe=>typeof pe=="string"?{"@id":pe,"@type":"sc:Collection"}:pe),...ee.members||[]];delete ee.collections,delete ee.manifests,ee.members=ue}return ee.manifests&&(ee.manifests=ee.manifests.map(ue=>this.traverseManifest(typeof ue=="string"?{"@id":ue,"@type":"sc:Manifest"}:ue))),ee.collections&&(ee.collections=ee.collections.map(ue=>this.traverseCollection(typeof ue=="string"?{"@id":ue,"@type":"sc:Collection"}:ue))),ee.members&&(ee.members=ee.members.map(ue=>typeof ue=="string"?ue:this.traverseUnknown(ue))),ee}traverseManifest(ee){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseManifestItems(ee))),this.traversals.manifest)}traverseManifestItems(ee){return ee.sequences&&(ee.sequences=ee.sequences.map(ue=>this.traverseSequence(ue))),ee.structures&&(ee.structures=ee.structures.map(ue=>this.traverseRange(ue))),ee}traverseSequence(ee){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseSequenceItems(ee))),this.traversals.sequence)}traverseSequenceItems(ee){return ee.canvases&&(ee.canvases=ee.canvases.map(ue=>this.traverseCanvas(ue))),ee}traverseCanvas(ee){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseCanvasItems(ee))),this.traversals.canvas)}traverseCanvasItems(ee){return ee.images&&(ee.images=ee.images.map(ue=>this.traverseAnnotation(ue))),ee.otherContent&&(ee.otherContent=ee.otherContent.map(ue=>this.traverseAnnotationList(ue))),ee}traverseRange(ee){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseRangeItems(ee))),this.traversals.range)}traverseRangeItems(ee){if(this.options.mergeMemberProperties){const ue=[...(ee.ranges||[]).map(pe=>typeof pe=="string"?{"@id":pe,"@type":"sc:Range"}:pe),...(ee.canvases||[]).map(pe=>typeof pe=="string"?{"@id":pe,"@type":"sc:Canvas"}:pe),...ee.members||[]];delete ee.ranges,delete ee.canvases,ee.members=ue.length?ue.map(pe=>this.traverseUnknown(pe)):void 0}return ee}traverseAnnotationList(ee){const ue=typeof ee=="string"?{"@id":ee,"@type":"sc:AnnotationList"}:ee;return this.traverseType(this.traverseDescriptive(this.traverseAnnotationListItems(ue)),this.traversals.annotationList)}traverseAnnotationListItems(ee){return ee.resources&&(ee.resources=ee.resources.map(ue=>this.traverseAnnotation(ue))),ee}traverseAnnotation(ee){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseAnnotationItems(ee))),this.traversals.annotation)}traverseAnnotationItems(ee){return ee.resource&&(Array.isArray(ee.resource)?ee.resource=ee.resource.map(ue=>this.traverseContentResource(ue)):ee.resource=this.traverseContentResource(ee.resource)),ee.on,ee}traverseLayer(ee){return this.traverseType(this.traverseLinking(this.traverseLayerItems(ee)),this.traversals.layer)}traverseLayerItems(ee){return ee.otherContent&&(ee.otherContent=ee.otherContent.map(ue=>this.traverseAnnotationList(ue))),ee}traverseChoice(ee){return this.traverseType(this.traverseChoiceItems(ee),this.traversals.choice)}traverseChoiceItems(ee){return ee.default&&ee.default!=="rdf:nil"&&(ee.default=this.traverseContentResource(ee.default)),ee.item&&ee.item!=="rdf:nil"&&(ee.item=ee.item.map(ue=>this.traverseContentResource(ue))),ee}traverseService(ee){return this.traverseType(this.traverseLinking(ee),this.traversals.service)}traverseContentResource(ee){return ee["@type"]==="oa:Choice"?this.traverseChoice(ee):this.traverseType(this.traverseDescriptive(this.traverseLinking(ee)),this.traversals.contentResource)}traverseUnknown(ee){if(!ee["@type"]||typeof ee=="string")return ee;switch(identifyResource(ee)){case"sc:Collection":return this.traverseCollection(ee);case"sc:Manifest":return this.traverseManifest(ee);case"sc:Canvas":return this.traverseCanvas(ee);case"sc:Sequence":return this.traverseSequence(ee);case"sc:Range":return this.traverseRange(ee);case"oa:Annotation":return this.traverseAnnotation(ee);case"sc:AnnotationList":return this.traverseAnnotationList(ee);case"sc:Layer":return this.traverseLayer(ee);case"Service":return this.traverseService(ee);case"oa:Choice":return this.traverseChoice(ee);case"ContentResource":return this.traverseContentResource(ee)}return ee.profile?this.traverseService(ee):ee}traverseImageResource(ee){const ue=Array.isArray(ee),pe=Array.isArray(ee)?ee:[ee],_e=[];for(const Ne of pe)typeof Ne=="string"?_e.push(this.traverseContentResource({"@id":Ne,"@type":"dctypes:Image"})):_e.push(this.traverseContentResource(Ne));return!ue&&!this.options.convertPropsToArray?_e[0]:_e}traverseDescriptive(ee){return ee.thumbnail&&(ee.thumbnail=this.traverseImageResource(ee.thumbnail)),ee.logo&&(ee.logo=this.traverseImageResource(ee.logo)),ee}traverseOneOrMoreServices(ee){const ue=Array.isArray(ee),pe=Array.isArray(ee)?ee:[ee],_e=[];for(const Ne of pe)_e.push(this.traverseService(Ne));return!ue&&!this.options.convertPropsToArray?_e[0]:_e}traverseLinking(ee){return ee.related&&(ee.related=this.traverseOneOrManyType(ee.related,this.traversals.contentResource)),ee.rendering&&(ee.rendering=this.traverseOneOrManyType(ee.rendering,this.traversals.contentResource)),ee.service&&(ee.service=this.traverseOneOrMoreServices(ee.service)),ee.seeAlso&&(ee.seeAlso=this.traverseOneOrManyType(ee.seeAlso,this.traversals.contentResource)),ee.within&&(typeof ee.within=="string"||(ee.within=this.traverseOneOrManyType(ee.within,this.traversals.contentResource))),ee.startCanvas&&(typeof ee.startCanvas=="string"?ee.startCanvas=this.traverseType({"@id":ee.startCanvas,"@type":"sc:Canvas"},this.traversals.canvas):ee.startCanvas&&this.traverseType(ee.startCanvas,this.traversals.canvas)),ee.contentLayer&&(typeof ee.contentLayer=="string"?ee.contentLayer=this.traverseLayer({"@id":ee.contentLayer,"@type":"sc:Layer"}):ee.contentLayer=this.traverseLayer(ee.contentLayer)),ee}traverseOneOrManyType(ee,ue){if(!Array.isArray(ee))if(this.options.convertPropsToArray)ee=[ee];else return this.traverseType(ee,ue);return ee.map(pe=>this.traverseType(pe,ue))}traverseType(ee,ue){return ue.reduce((pe,_e)=>{const Ne=_e(pe);return typeof Ne>"u"&&!this.options.allowUndefinedReturn?pe:Ne},ee)}}const STANFORD_IIIF_IMAGE_COMPLIANCE_0="http://library.stanford.edu/iiif/image-api/compliance.html#level0",STANFORD_IIIF_IMAGE_COMPLIANCE_1="http://library.stanford.edu/iiif/image-api/compliance.html#level1",STANFORD_IIIF_IMAGE_COMPLIANCE_2="http://library.stanford.edu/iiif/image-api/compliance.html#level2",STANFORD_IIIF_IMAGE_CONFORMANCE_0="http://library.stanford.edu/iiif/image-api/conformance.html#level0",STANFORD_IIIF_IMAGE_CONFORMANCE_1="http://library.stanford.edu/iiif/image-api/conformance.html#level1",STANFORD_IIIF_IMAGE_CONFORMANCE_2="http://library.stanford.edu/iiif/image-api/conformance.html#level2",STANFORD_IIIF_1_IMAGE_COMPLIANCE_0="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0",STANFORD_IIIF_1_IMAGE_COMPLIANCE_1="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1",STANFORD_IIIF_1_IMAGE_COMPLIANCE_2="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2",STANFORD_IIIF_1_IMAGE_CONFORMANCE_0="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0",STANFORD_IIIF_1_IMAGE_CONFORMANCE_1="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1",STANFORD_IIIF_1_IMAGE_CONFORMANCE_2="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2",IIIF_1_IMAGE_LEVEL_0="http://iiif.io/api/image/1/level0.json",IIIF_1_IMAGE_LEVEL_0_PROFILE="http://iiif.io/api/image/1/profiles/level0.json",IIIF_1_IMAGE_LEVEL_1="http://iiif.io/api/image/1/level1.json",IIIF_1_IMAGE_LEVEL_1_PROFILE="http://iiif.io/api/image/1/profiles/level1.json",IIIF_1_IMAGE_LEVEL_2="http://iiif.io/api/image/1/level2.json",IIIF_1_IMAGE_LEVEL_2_PROFILE="http://iiif.io/api/image/1/profiles/level2.json",IIIF_2_IMAGE_LEVEL_0="http://iiif.io/api/image/2/level0.json",IIIF_2_IMAGE_LEVEL_0_PROFILE="http://iiif.io/api/image/2/profiles/level0.json",IIIF_2_IMAGE_LEVEL_1="http://iiif.io/api/image/2/level1.json",IIIF_2_IMAGE_LEVEL_1_PROFILE="http://iiif.io/api/image/2/profiles/level1.json",IIIF_2_IMAGE_LEVEL_2="http://iiif.io/api/image/2/level2.json",IIIF_2_IMAGE_LEVEL_2_PROFILE="http://iiif.io/api/image/2/profiles/level2.json",IIIF_3_IMAGE_LEVEL_0="level0",IIIF_3_IMAGE_LEVEL_1="level1",IIIF_3_IMAGE_LEVEL_2="level2",IIIF_2_IMAGE_LEVEL_0_NO_JSON="http://iiif.io/api/image/2/level0",IIIF_2_IMAGE_LEVEL_1_NO_JSON="http://iiif.io/api/image/2/level1",IIIF_2_IMAGE_LEVEL_2_NO_JSON="http://iiif.io/api/image/2/level2",level1Support=[IIIF_2_IMAGE_LEVEL_1_NO_JSON,IIIF_2_IMAGE_LEVEL_2_NO_JSON,STANFORD_IIIF_IMAGE_COMPLIANCE_1,STANFORD_IIIF_IMAGE_COMPLIANCE_2,STANFORD_IIIF_IMAGE_CONFORMANCE_1,STANFORD_IIIF_IMAGE_CONFORMANCE_2,STANFORD_IIIF_1_IMAGE_COMPLIANCE_1,STANFORD_IIIF_1_IMAGE_COMPLIANCE_2,STANFORD_IIIF_1_IMAGE_CONFORMANCE_1,STANFORD_IIIF_1_IMAGE_CONFORMANCE_2,IIIF_1_IMAGE_LEVEL_1,IIIF_1_IMAGE_LEVEL_1_PROFILE,IIIF_1_IMAGE_LEVEL_2,IIIF_1_IMAGE_LEVEL_2_PROFILE,IIIF_2_IMAGE_LEVEL_1,IIIF_2_IMAGE_LEVEL_1_PROFILE,IIIF_2_IMAGE_LEVEL_2,IIIF_2_IMAGE_LEVEL_2_PROFILE,IIIF_3_IMAGE_LEVEL_1,IIIF_3_IMAGE_LEVEL_2],imageServiceProfiles=[IIIF_2_IMAGE_LEVEL_0_NO_JSON,IIIF_2_IMAGE_LEVEL_1_NO_JSON,IIIF_2_IMAGE_LEVEL_2_NO_JSON,STANFORD_IIIF_IMAGE_COMPLIANCE_0,STANFORD_IIIF_IMAGE_COMPLIANCE_1,STANFORD_IIIF_IMAGE_COMPLIANCE_2,STANFORD_IIIF_IMAGE_CONFORMANCE_0,STANFORD_IIIF_IMAGE_CONFORMANCE_1,STANFORD_IIIF_IMAGE_CONFORMANCE_2,STANFORD_IIIF_1_IMAGE_COMPLIANCE_0,STANFORD_IIIF_1_IMAGE_COMPLIANCE_1,STANFORD_IIIF_1_IMAGE_COMPLIANCE_2,STANFORD_IIIF_1_IMAGE_CONFORMANCE_0,STANFORD_IIIF_1_IMAGE_CONFORMANCE_1,STANFORD_IIIF_1_IMAGE_CONFORMANCE_2,IIIF_1_IMAGE_LEVEL_0,IIIF_1_IMAGE_LEVEL_0_PROFILE,IIIF_1_IMAGE_LEVEL_1,IIIF_1_IMAGE_LEVEL_1_PROFILE,IIIF_1_IMAGE_LEVEL_2,IIIF_1_IMAGE_LEVEL_2_PROFILE,IIIF_2_IMAGE_LEVEL_0,IIIF_2_IMAGE_LEVEL_0_PROFILE,IIIF_2_IMAGE_LEVEL_1,IIIF_2_IMAGE_LEVEL_1_PROFILE,IIIF_2_IMAGE_LEVEL_2,IIIF_2_IMAGE_LEVEL_2_PROFILE,IIIF_3_IMAGE_LEVEL_0,IIIF_3_IMAGE_LEVEL_1,IIIF_3_IMAGE_LEVEL_2],configuration={attributionLabel:"Attribution",lang:"none",providerId:"http://example.org/provider",providerName:"Unknown"};function convertLanguageMapping(fe,ee="none"){if(!fe)return{};const ue=Array.isArray(fe)?fe:[fe],pe={};for(const _e of ue){if(typeof _e=="string"){pe[ee]=pe[ee]?pe[ee]:[],pe[ee].push(_e||"");continue}if(!_e["@language"]){pe[ee]=pe[ee]?pe[ee]:[],pe[ee].push(_e["@value"]||"");continue}const Ne=_e["@language"];pe[Ne]=pe[Ne]?pe[Ne]:[],pe[Ne].push(_e["@value"]||"")}return pe}function getProfile(fe){if(Array.isArray(fe))return getProfile(fe.find(ee=>typeof ee=="string"));if(imageServiceProfiles.indexOf(fe)!==-1)return"level2";if(level1Support.indexOf(fe)!==-1)return"level1";if(typeof fe=="string")return fe}function getTypeFromContext(fe){const ee=Array.isArray(fe)?fe:[fe];for(const ue of ee)switch(ue){case"http://iiif.io/api/image/2/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2":return"ImageService2";case"http://iiif.io/api/image/1/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/context.json":return"ImageService1";case"http://iiif.io/api/annex/openannotation/context.json":return"ImageApiSelector"}}function getTypeFromProfile(fe){switch(fe){case"http://iiif.io/api/image/2/level0.json":case"http://iiif.io/api/image/2/level1.json":case"http://iiif.io/api/image/2/level2.json":return"ImageService2";case"http://iiif.io/api/auth/1/kiosk":case"http://iiif.io/api/auth/1/login":case"http://iiif.io/api/auth/1/clickthrough":case"http://iiif.io/api/auth/1/external":case"http://iiif.io/api/auth/0/kiosk":case"http://iiif.io/api/auth/0/login":case"http://iiif.io/api/auth/0/clickthrough":case"http://iiif.io/api/auth/0/external":return"AuthCookieService1";case"http://iiif.io/api/auth/1/token":case"http://iiif.io/api/auth/0/token":return"AuthTokenService1";case"http://iiif.io/api/auth/1/logout":case"http://iiif.io/api/auth/0/logout":return"AuthLogoutService1";case"http://iiif.io/api/search/1/search":case"http://iiif.io/api/search/0/search":return"SearchService1";case"http://iiif.io/api/search/1/autocomplete":case"http://iiif.io/api/search/0/autocomplete":return"AutoCompleteService1"}}function removePrefix(fe){for(const ee of["sc","oa","dcterms","dctypes","iiif"])if(fe.startsWith(`${ee}:`))return fe.slice(ee.length+1);return fe}const knownTypes=["Collection","Manifest","Annotation","AnnotationPage","Range","Service"];function getNewType(fe){const ee=fe["@id"]||fe.id;let ue=fe["@type"]||fe.type;const pe=fe.profile||void 0,_e=fe["@context"]||void 0;if(pe){const Ne=getTypeFromProfile(pe);if(Ne)return Ne}if(_e){const Ne=getTypeFromContext(_e);if(Ne)return Ne}if(ue){if(Array.isArray(ue)){if(ue.indexOf("oa:CssStylesheet")!==-1)return"CssStylesheet";if(ue.indexOf("cnt:ContentAsText")!==-1)return"TextualBody";ue=ue[0]}for(const Ne of["sc","oa","dcterms","dctypes","iiif"])if(ue.startsWith(`${Ne}:`)){ue=ue.slice(Ne.length+1);break}switch(ue){case"Layer":return"AnnotationCollection";case"AnnotationList":return"AnnotationPage";case"cnt:ContentAsText":return"TextualBody"}}if(ue&&knownTypes.indexOf(ue)!==-1)return ue;if(fe.format){if(fe.format.startsWith("image/"))return"Image";if(fe.format.startsWith("text/")||fe.format==="application/pdf")return"Text";if(fe.format.startsWith("application/"))return"Dataset"}return ee&&(ee.endsWith(".jpg")||ee.endsWith(".png")||ee.endsWith(".jpeg"))?"Image":ue||"unknown"}const licenseRegex=/http(s)?:\/\/(creativecommons.org|rightsstatements.org)[^"'\\<\n]+/gm;function extractLicense(fe){const ee=fe.match(licenseRegex);return ee?ee[0]:fe}function fixLicense(fe,ee="Rights/License",ue="none"){let pe=null;const _e=[],Ne=Array.isArray(fe)?fe:[fe];for(const Ue of Ne){const Ge=Ue?extractLicense(Ue):void 0;if(Ge&&(Ge.indexOf("creativecommons.org")!==-1||Ge.indexOf("rightsstatements.org")!==-1)){Ge.startsWith("https://")?pe=`http://${Ge.slice(8)}`:pe=Ge;continue}Ge&&_e.push({label:{[ue]:[ee]},value:{[ue]:[Ge]}})}return[pe,_e]}const removeContexts=["http://iiif.io/api/presentation/2/context.json","http://iiif.io/api/image/2/context.json","http://iiif.io/api/image/1/context.json","http://library.stanford.edu/iiif/image-api/1.1/context.json","http://iiif.io/api/search/1/context.json","http://iiif.io/api/search/0/context.json","http://iiif.io/api/auth/1/context.json","http://iiif.io/api/auth/0/context.json","http://iiif.io/api/annex/openannotation/context.json"];function fixContext(fe){if(fe){const ee=Array.isArray(fe)?fe:[fe],ue=[];for(const pe of ee)pe==="http://iiif.io/api/presentation/2/context.json"&&ue.push("http://iiif.io/api/presentation/3/context.json"),removeContexts.indexOf(pe)===-1&&ue.push(pe);if(ee.length)return ue.length===1?ue[0]:ue}}function convertMetadata(fe){return fe?fe.map(ee=>({label:convertLanguageMapping(ee.label),value:convertLanguageMapping(ee.value)})):[]}function removeUndefinedProperties(fe){for(const ee in fe)(typeof fe[ee]>"u"||fe[ee]===null)&&delete fe[ee];return fe}let mintedIdCounter=0;function mintNewIdFromResource(fe,ee){const ue=encodeURI(fe.id||fe["@id"]||"").trim();return ue&&ee?`${ue}/${ee}`:ue||(mintedIdCounter++,`http://example.org/${fe["@type"]}${ee?`/${ee}`:""}/${mintedIdCounter}`)}function technicalProperties$2(fe){const ee=[...fe.behavior||[]];fe.viewingHint&&ee.push(fe.viewingHint);let ue;return Array.isArray(fe.motivation)?ue=fe.motivation.map(removePrefix):fe.motivation&&(ue=removePrefix(fe.motivation)),{"@context":fe["@context"]?fixContext(fe["@context"]):void 0,id:(fe["@id"]||mintNewIdFromResource(fe)).trim(),type:getNewType(fe),behavior:ee.length?ee:void 0,height:fe.height?fe.height:void 0,width:fe.width?fe.width:void 0,motivation:ue,viewingDirection:fe.viewingDirection,profile:fe.profile,format:fe.format?fe.format:void 0,duration:void 0,timeMode:void 0}}function descriptiveProperties$2(fe){const[ee,ue]=fixLicense(fe.license),pe=[...fe.metadata?convertMetadata(fe.metadata):[],...ue];return{rights:ee,metadata:pe.length?pe:void 0,label:fe.label?convertLanguageMapping(fe.label):void 0,requiredStatement:fe.attribution?{label:convertLanguageMapping(configuration.attributionLabel),value:convertLanguageMapping(fe.attribution)}:void 0,navDate:fe.navDate,summary:fe.description?convertLanguageMapping(fe.description):void 0,thumbnail:fe.thumbnail}}function parseWithin(fe){if(!fe.within)return;const ee=Array.isArray(fe.within)?fe.within:[fe.within],ue=[];for(const pe of ee)if(typeof pe=="string"){if(pe)switch(fe["@type"]){case"sc:Manifest":ue.push({id:pe,type:"Collection"});break}}else pe["@id"]&&ue.push({id:pe["@id"],type:getNewType(pe)});return ue.length?ue:void 0}function linkingProperties$2(fe){const ee=fe.related?Array.isArray(fe.related)?fe.related:[fe.related]:[],ue=fe.contentLayer;return{provider:fe.logo||ee.length?[{id:configuration.providerId,type:"Agent",homepage:ee.length?[ee[0]]:void 0,logo:fe.logo?Array.isArray(fe.logo)?fe.logo:[fe.logo]:void 0,label:convertLanguageMapping(configuration.providerName)}]:void 0,partOf:parseWithin(fe),rendering:fe.rendering,seeAlso:fe.seeAlso,start:fe.startCanvas,service:fe.service?ensureArray$1(fe.service):void 0,supplementary:ue?[ue]:void 0}}function embeddedContentProperties(fe){return{chars:fe.chars,format:fe.format?fe.format:void 0,language:fe.language}}function upgradeCollection(fe){return removeUndefinedProperties({...technicalProperties$2(fe),...descriptiveProperties$2(fe),...linkingProperties$2(fe),items:fe.members})}function upgradeManifest(fe){const ee=[],ue=[];for(const _e of fe.sequences||[])_e.canvases.length&&ee.push(..._e.canvases),_e.behavior&&ue.push(..._e.behavior);const pe=technicalProperties$2(fe);return ue.length&&(pe.behavior?pe.behavior.push(...ue):pe.behavior=ue),removeUndefinedProperties({...pe,...descriptiveProperties$2(fe),...linkingProperties$2(fe),items:ee,structures:fe.structures})}function upgradeCanvas(fe){return removeUndefinedProperties({...technicalProperties$2(fe),...descriptiveProperties$2(fe),...linkingProperties$2(fe),annotations:fe.otherContent&&fe.otherContent.length?fe.otherContent:void 0,items:fe.images&&fe.images.length?[{id:mintNewIdFromResource(fe,"annotation-page"),type:"AnnotationPage",items:fe.images}]:void 0})}function upgradeAnnotationList(fe){return removeUndefinedProperties({...technicalProperties$2(fe),...descriptiveProperties$2(fe),...linkingProperties$2(fe),items:fe.resources&&fe.resources.length?fe.resources:void 0})}function upgradeSequence(fe){return!fe.canvases||fe.canvases.length===0?{canvases:[],behavior:[]}:{canvases:fe.canvases,behavior:fe.viewingHint?[fe.viewingHint]:[]}}function upgradeAnnotation(fe){function ee(ue){if(Array.isArray(ue)){if(ue.length>1)return{type:"List",items:ue.map(ee)};ue=ue[0]}if(typeof ue=="string")return encodeURI(ue).trim();if("@type"in ue){let pe;if(typeof ue.full=="string")pe=ue.full;else if(ue.full["@type"]==="dctypes:Image")pe={id:ue.full["@id"],type:"Image"};else if(ue.full["@type"]==="sc:Canvas")pe={id:ue.full["@id"],type:"Canvas"};else throw new Error(`Unsupported source type on annotation: ${ue.full["@type"]}`);return{type:"SpecificResource",source:pe,selector:upgradeSelector(ue.selector)}}else return encodeURI(ue["@id"]).trim()}return removeUndefinedProperties({...technicalProperties$2(fe),...descriptiveProperties$2(fe),...linkingProperties$2(fe),target:ee(fe.on),body:Array.isArray(fe.resource)?fe.resource.map(upgradeContentResource):upgradeContentResource(fe.resource)})}function upgradeContentResource(fe){const ee=fe;return removeUndefinedProperties({...technicalProperties$2(ee),...descriptiveProperties$2(ee),...linkingProperties$2(ee),...embeddedContentProperties(ee)})}function upgradeChoice(fe){const ee=[];return fe.default&&fe.default!=="rdf:nil"&&ee.push(fe.default),fe.item&&fe.item!=="rdf:nil"&&ee.push(...fe.item),{...technicalProperties$2(fe),...descriptiveProperties$2(fe),items:ee}}function upgradeRange(fe){return removeUndefinedProperties({...technicalProperties$2(fe),...descriptiveProperties$2(fe),...linkingProperties$2(fe),items:fe.members})}function upgradeService(fe){const{"@id":ee,"@type":ue,"@context":pe,profile:_e,...Ne}=fe,Ue={};return ee&&(Ue["@id"]=ee),Ue["@type"]=getNewType(fe),Ue["@type"]==="unknown"&&(pe&&pe.length&&(Ue["@context"]=pe),Ue["@type"]="Service"),_e&&(Ue.profile=getProfile(_e)),removeUndefinedProperties({...Ue,...Ne})}function upgradeLayer(fe){return removeUndefinedProperties({...technicalProperties$2(fe),...descriptiveProperties$2(fe),...linkingProperties$2(fe)})}const presentation2to3=new Traverse({collection:[upgradeCollection],manifest:[upgradeManifest],canvas:[upgradeCanvas],annotationList:[upgradeAnnotationList],sequence:[upgradeSequence],annotation:[upgradeAnnotation],contentResource:[upgradeContentResource],choice:[upgradeChoice],range:[upgradeRange],service:[upgradeService],layer:[upgradeLayer]});function convertPresentation2(fe){return fe&&fe["@context"]&&(fe["@context"]==="http://iiif.io/api/presentation/2/context.json"||fe["@context"].indexOf("http://iiif.io/api/presentation/2/context.json")!==-1||fe["@context"]==="http://www.shared-canvas.org/ns/context.json")||fe["@context"]==="http://iiif.io/api/image/2/context.json"?presentation2to3.traverseUnknown(fe):fe}function upgradeSelector(fe){if((Array.isArray(fe["@type"])&&fe["@type"].includes("oa:SvgSelector")||fe["@type"]=="oa:SvgSelector")&&("chars"in fe||"value"in fe))return{type:"SvgSelector",value:"chars"in fe?fe.chars:fe.value};if(fe["@type"]==="oa:FragmentSelector")return{type:"FragmentSelector",value:fe.value};if(fe["@type"]==="oa:Choice")return[upgradeSelector(fe.default),...(Array.isArray(fe.item)?fe.item:[fe.item]).map(upgradeSelector)];if(fe["@type"]=="iiif:ImageApiSelector")return{type:"ImageApiSelector",region:"region"in fe?fe.region:void 0,rotation:"rotation"in fe?fe.rotation:void 0};throw new Error(`Unsupported selector type: ${fe["@type"]}`)}function getDefaultEntities$1(){return{Collection:{},Manifest:{},Canvas:{},AnnotationPage:{},AnnotationCollection:{},Annotation:{},ContentResource:{},Range:{},Service:{},Selector:{},Agent:{}}}function getResource(fe,ee){if(typeof fe=="string")return{id:fe,type:ee};if(!fe.id)throw new Error(`Invalid resource does not have an ID (${ee})`);return fe}function mapToEntities(fe){return(ee,ue)=>{const pe=fe[ee]?fe[ee]:{};return _e=>{const Ne=getResource(_e,ue||ee);return Ne&&Ne.id&&ee?(pe[Ne.id]=pe[Ne.id]?mergeEntities(pe[Ne.id],Ne):Object.assign({},Ne),{id:Ne.id,type:ee==="ContentResource"?ee:Ne.type}):Ne}}}function merge(fe,ee){if(!ee)return fe;if(Array.isArray(fe)){if(!Array.isArray(ee))throw new Error("Cannot merge array with non-array");const ue=[...fe];for(const pe of ee)if(pe!=null)if(Array.isArray(pe))ue.push(pe);else if(typeof pe=="object"&&pe.id&&pe.type){const _e=ue.findIndex(Ne=>Ne.id===pe.id&&Ne.type===pe.type);_e>=0&&(ue[_e]=merge(ue[_e],pe))}else fe.indexOf(pe)===-1&&ue.push(pe);return ue}else if(typeof fe=="object"){if(Array.isArray(ee)||typeof ee!="object")throw new Error("Cannot merge object with non-object");const ue={...fe};for(const[pe,_e]of Object.entries(ee)){const Ne=ue[pe];Ne===EMPTY||!Ne?ue[pe]=_e:ue[pe]=merge(Ne,_e)}return ue}else if(fe)return fe;return ee}function mergeEntities(fe,ee){if(typeof fe=="string")return fe;if(ee.id!==fe.id||ee.type!==fe.type)throw new Error("Can only merge entities with identical identifiers and type!");return merge({...fe},ee)}function recordTypeInMapping(fe){return(ee,ue)=>pe=>{const{id:_e,type:Ne}=getResource(pe,ue||ee);if(typeof _e>"u")throw new Error("Found invalid entity without an ID.");return ee==="ContentResource"?fe[_e]=ee:fe[_e]=Ne,pe}}function hash$1(fe){const ee=JSON.stringify(fe);let ue=5381,pe=ee.length;for(;pe;)ue=ue*33^ee.charCodeAt(--pe);const Ne=(ue>>>0).toString(16);return Ne.length%2?"0"+Ne:Ne}function addMissingIdToContentResource(fe){return ee=>typeof ee=="string"?{id:ee,type:fe}:ee.id?ee.type?ee:{type:fe,...ee}:{id:`vault://${hash$1(ee)}`,type:fe,...ee}}function ensureDefaultFields(fe){return ee=>({...fe,...ee})}function ensureArray(fe){return Array.isArray(fe)?fe:[fe]}function ensureArrayOnAnnotation(fe){return fe.body&&(fe.body=ensureArray(fe.body)),fe.seeAlso&&(fe.seeAlso=ensureArray(fe.seeAlso)),fe.body&&(fe.body=ensureArray(fe.body)),fe.audience&&(fe.audience=ensureArray(fe.audience)),fe.accessibility&&(fe.accessibility=ensureArray(fe.accessibility)),fe.motivation&&(fe.motivation=ensureArray(fe.motivation)),fe}function normalize(fe){const ee=convertPresentation2(fe),ue=getDefaultEntities$1(),pe={},_e=mapToEntities(ue),Ne=recordTypeInMapping(pe),Ge=new Traverse$1({collection:[ensureDefaultFields(emptyCollection),Ne("Collection"),_e("Collection")],manifest:[ensureDefaultFields(emptyManifest),Ne("Manifest"),_e("Manifest")],canvas:[ensureDefaultFields(emptyCanvas),Ne("Canvas"),_e("Canvas")],annotationPage:[addMissingIdToContentResource("AnnotationPage"),ensureDefaultFields(emptyAnnotationPage),Ne("AnnotationPage"),_e("AnnotationPage")],annotation:[addMissingIdToContentResource("Annotation"),ensureArrayOnAnnotation,Ne("Annotation"),_e("Annotation")],contentResource:[addMissingIdToContentResource("ContentResource"),Ne("ContentResource"),_e("ContentResource")],range:[ensureDefaultFields(emptyRange),Ne("Range","Canvas"),_e("Range","Canvas")],agent:[ensureDefaultFields(emptyAgent),Ne("Agent"),_e("Agent")]}).traverseUnknown(ee);return{entities:ue,resource:Ge,mapping:pe}}const UNSET="__$UNSET$__",UNWRAP="__$UNWRAP$__";function resolveIfExists$1(fe,ee){const ue=fe.requests[ee],pe=fe.mapping[ee];if(!(!pe||ue&&ue.resourceUri&&!fe.entities[pe][ue.resourceUri]))return fe.entities[pe][ue?ue.resourceUri:ee]}function serializedFieldsToObject(fe){const ee={};for(const[ue,pe]of fe){if(ue===UNWRAP&&pe!==UNSET)return pe;pe!==UNSET&&typeof pe<"u"&&pe!==null&&(ee[ue]=pe)}return ee}function serialize(fe,ee,ue){if(!ee.type||!ee.id)throw new Error("Unknown entity");if(!ue[ee.type])throw new Error(`Serializer not found for ${ee.type}`);function pe(_e){const Ne=ue[_e.type];if(!Ne)return UNSET;const Ue=resolveIfExists$1(fe,_e.id)||(_e.id&&_e.type?_e:null);if(!Ue)return UNSET;const Ge=Ne(Ue,fe,{isTopLevel:ee.id===_e.id});let qe=Ge.next();for(;!qe.done;){const Ke=qe.value;let Ye=UNSET;if(Ke)if(Array.isArray(Ke)){const Ze=[];for(const Xe of Ke)Ze.push(pe(Xe));Ye=Ze}else Ye=pe(Ke);qe=Ge.next(Ye)}return qe.value===UNSET?UNSET:serializedFieldsToObject(qe.value)}return pe(ee)}function languageString2to3(fe){if(!fe)return;const ee=Object.keys(fe);if(ee.length!==0){if(ee.length===1){const ue=ee[0];if(!ue)return"";const pe=(fe[ue]||[]).join("");return ue==="@none"||ue==="none"||ue==="en"?pe:{"@language":ue,"@value":pe}}return ee.map(ue=>({"@language":ue,"@value":(fe[ue]||[]).join("")}))}}function parseCanvasTarget(fe){return Array.isArray(fe)?fe.map(ee=>parseCanvasTarget(ee)):typeof fe=="string"?fe:fe.type&&fe.type==="Canvas"?fe.id:fe}function unNestArray(fe,ee=!1){if(fe)return fe.length>1&&!ee?fe:fe[0]||void 0}function convertService(fe){if(fe){if(typeof fe=="string")return{"@id":fe};if("@id"in fe){const ee={...fe};return delete ee["@type"],ee}return{"@context":"http://iiif.io/api/image/2/context.json","@id":fe.id,profile:`http://iiif.io/api/image/2/profiles/${fe.profile}.json`}}}function technicalProperties$1(fe,ee){return[["@id",fe.id],["@type",ee],["format",fe.format],["height",fe.height],["width",fe.width],["viewingDirection",fe.viewingDirection!=="left-to-right"?fe.viewingDirection:void 0]]}function*descriptiveProperties$1(fe){const ee=fe.provider?yield fe.provider[0]:void 0;return[["label",languageString2to3(fe.label)],["metadata",fe.metadata&&fe.metadata.length?fe.metadata.map(ue=>({label:languageString2to3(ue.label)||"",value:languageString2to3(ue.value)||""})):void 0],["description",languageString2to3(fe.summary)],["thumbnail",unNestArray(yield fe.thumbnail)],["navDate",fe.navDate],["logo",ee?unNestArray(ee.logo):void 0],["homepage",ee?ee.homepage:void 0],["attribution",fe.requiredStatement?languageString2to3(fe.requiredStatement.value):void 0]]}function*linkingProperties$1(fe){return[["seeAlso",unNestArray(yield fe.seeAlso)],["service",unNestArray((fe.service||[]).map(convertService))],["rendering",unNestArray(yield fe.rendering)],["startCanvas",fe.start?fe.start.id:void 0]]}const serializeConfigPresentation2={Manifest:function*(fe){return[...technicalProperties$1(fe,"sc:Manifest"),...yield*descriptiveProperties$1(fe),...yield*linkingProperties$1(fe),["sequences",[{"@id":`${fe.id}/sequence0`,"@type":"sc:Sequence",canvases:yield fe.items}]],["structures",yield fe.structures]]},Canvas:function*(fe){const ue=(yield fe.items)[0];return[...technicalProperties$1(fe,"sc:Canvas"),...yield*descriptiveProperties$1(fe),...yield*linkingProperties$1(fe),["images",ue?[ue.resources]:void 0],["annotations",fe.annotations&&fe.annotations.length?unNestArray(yield fe.annotations):void 0]]},AnnotationPage:function*(fe){return[...technicalProperties$1(fe,"sc:AnnotationList"),...yield*descriptiveProperties$1(fe),["resources",fe.items&&fe.items.length?unNestArray(yield fe.items):void 0]]},Annotation:function*(fe){return[["@id",fe.id],["@type","oa:Annotation"],["motivation","sc:painting"],["on",parseCanvasTarget(fe.target)],["resource",unNestArray(yield fe.body,!0)]]},ContentResource:function*(fe){switch(fe.type){case"Image":return[...technicalProperties$1(fe,"dctypes:Image"),...yield*descriptiveProperties$1(fe),...yield*linkingProperties$1(fe)];case"Text":case"Dataset":default:return[...technicalProperties$1(fe,void 0),...yield*descriptiveProperties$1(fe)]}},AnnotationCollection:function*(fe){return[["@id",fe.id],["@type","sc:Layer"],["label",languageString2to3(fe.label)]]},Collection:function*(fe){return[...technicalProperties$1(fe,"sc:Collection"),...yield*descriptiveProperties$1(fe),...yield*linkingProperties$1(fe),["members",yield*fe.items]]},Range:function*(fe){const ee=[],ue=[];if(fe.items)for(const pe of fe.items){const _e=yield pe;ee.push({"@id":pe.id,"@type":pe.type,label:_e?_e.label:void 0,within:fe.id}),pe.type==="Canvas"&&ue.push(pe.id)}return[...technicalProperties$1(fe,"sc:Range"),...yield*descriptiveProperties$1(fe),...yield*linkingProperties$1(fe),["canvases",ue.length===ee.length?ue:void 0],["members",ue.length!==ee.length?ee:void 0]]}};function technicalProperties(fe){var ee;return[["id",(ee=fe.id)!=null&&ee.startsWith("vault://")?void 0:fe.id],["type",fe.type],["format",fe.format],["profile",fe.profile],["height",fe.height],["width",fe.width],["duration",fe.duration||void 0],["viewingDirection",fe.viewingDirection!=="left-to-right"?fe.viewingDirection:void 0],["behavior",fe.behavior&&fe.behavior.length?fe.behavior:void 0],["timeMode",fe.timeMode],["motivation",Array.isArray(fe.motivation)?fe.motivation[0]:fe.motivation]]}function filterEmpty(fe){if(!(!fe||fe.length===0))return fe}function service2compat(fe){if(fe&&fe.type&&fe.type==="ImageService2"){const{id:ee,type:ue,profile:pe,..._e}=fe,Ne=typeof pe=="string"?pe:Array.isArray(pe)?pe.find(Ue=>typeof Ue=="string"):"";return{"@id":ee,"@type":ue,profile:Ne?Ne.startsWith("http")?Ne:`http://iiif.io/api/image/2/${Ne}.json`:"http://iiif.io/api/image/2/level0.json",..._e}}return fe}function filterService2Compat(fe){if(!(!fe||fe.length===0))return fe.map(service2compat)}function*descriptiveProperties(fe){return[["label",fe.label],["metadata",filterEmpty(fe.metadata)],["summary",fe.summary],["requiredStatement",fe.requiredStatement],["rights",fe.rights],["navDate",fe.navDate],["language",fe.language],["thumbnail",filterEmpty(yield fe.thumbnail)],["placeholderCanvas",yield fe.placeholderCanvas],["accompanyingCanvas",yield fe.accompanyingCanvas],["provider",filterEmpty(yield fe.provider)]]}function*linkingProperties(fe){return[["seeAlso",filterEmpty(yield fe.seeAlso)],["service",filterService2Compat(fe.service)],["services",filterService2Compat(fe.services)],["rendering",filterEmpty(yield fe.rendering)],["supplementary",filterEmpty(yield fe.supplementary)],["homepage",filterEmpty(yield fe.homepage)],["logo",filterEmpty(yield fe.logo)],["partOf",filterEmpty(yield fe.partOf)],["start",fe.start]]}const serializeConfigPresentation3={Manifest:function*(fe,ee,{isTopLevel:ue}){return ue?[["@context","http://iiif.io/api/presentation/3/context.json"],...technicalProperties(fe),...yield*descriptiveProperties(fe),...yield*linkingProperties(fe),["items",yield fe.items],["structures",filterEmpty(yield fe.structures)],["annotations",filterEmpty(yield fe.annotations)]]:[...technicalProperties(fe),...yield*descriptiveProperties(fe)]},Canvas:function*(fe){return[...technicalProperties(fe),...yield*descriptiveProperties(fe),...yield*linkingProperties(fe),["items",yield fe.items],["annotations",filterEmpty(yield fe.annotations)]]},Agent:function*(fe){return[["id",fe.id],["type","Agent"],["label",fe.label],...yield*linkingProperties(fe)]},AnnotationPage:function*(fe){return[...Object.entries(fe).map(([ue,pe])=>[ue,Array.isArray(pe)?filterEmpty(pe):pe]).filter(([ue,pe])=>ue!=="items"),...yield*linkingProperties(fe),["items",yield fe.items]]},Service:function*(fe){return[[UNWRAP,service2compat(fe)]]},Annotation:function*(fe){const ee=Object.entries(fe).map(([pe,_e])=>pe==="motivation"?[pe,Array.isArray(_e)?_e[0]:_e]:[pe,Array.isArray(_e)?filterEmpty(_e):_e]).filter(([pe])=>pe!=="body"),ue=yield fe.body;return[...ee,["body",ue.length===1?ue[0]:ue]]},ContentResource:function*(fe){return[...technicalProperties(fe),...yield*descriptiveProperties(fe),...yield*linkingProperties(fe),["annotations",filterEmpty(yield fe.annotations)],["items",filterEmpty(yield fe.items)]]},AnnotationCollection:function*(fe){return[["id",fe.id],["type","AnnotationCollection"],["label",fe.label]]},Collection:function*(fe,ee,{isTopLevel:ue}){return ue?[["@context","http://iiif.io/api/presentation/3/context.json"],...technicalProperties(fe),...yield*descriptiveProperties(fe),...yield*linkingProperties(fe),["items",filterEmpty(yield fe.items)]]:[...technicalProperties(fe),...yield*descriptiveProperties(fe)]},Range:function*(fe){const ee=[];for(const ue of fe.items)ue.type==="Range"?ee.push(yield ue):ee.push(ue);return[...technicalProperties(fe),...yield*descriptiveProperties(fe),...yield*linkingProperties(fe),["items",ee],["annotations",filterEmpty(yield fe.annotations)]]}};function n$1(fe){return fe==null}function t$1(fe){throw new Error("Argument "+fe+" is empty.")}function o$1(fe){return typeof fe=="string"||typeof fe=="symbol"}function u$1(fe){return!o$1(fe)}function a$1(fe){throw new Error("Argument "+fe+" is invalid, it should be an action type of type: string | symbol")}function s$1(fe,ee){return n$1(fe)&&t$1(1),u$1(fe)&&a$1(1),Object.assign(function(){var ue=ee!=null?ee.apply(void 0,arguments):void 0;return Object.assign({type:fe},ue)},{getType:function(){return fe},toString:function(){return fe}})}function y$1(fe,ee,ue){return n$1(fe)&&t$1(1),u$1(fe)&&a$1(1),function(){return s$1(fe,function(){var pe=arguments.length<=0?void 0:arguments[0],_e=arguments.length<=1?void 0:arguments[1];return ee==null&&ue==null||(pe=ee!=null?ee.apply(void 0,arguments):void 0,_e=ue!=null?ue.apply(void 0,arguments):void 0),Object.assign({},pe!==void 0&&{payload:pe},{},_e!==void 0&&{meta:_e})})}}function _typeof(fe){"@babel/helpers - typeof";return _typeof=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(ee){return typeof ee}:function(ee){return ee&&typeof Symbol=="function"&&ee.constructor===Symbol&&ee!==Symbol.prototype?"symbol":typeof ee},_typeof(fe)}function _toPrimitive$1(fe,ee){if(_typeof(fe)!=="object"||fe===null)return fe;var ue=fe[Symbol.toPrimitive];if(ue!==void 0){var pe=ue.call(fe,ee||"default");if(_typeof(pe)!=="object")return pe;throw new TypeError("@@toPrimitive must return a primitive value.")}return(ee==="string"?String:Number)(fe)}function _toPropertyKey$1(fe){var ee=_toPrimitive$1(fe,"string");return _typeof(ee)==="symbol"?ee:String(ee)}function _defineProperty$1(fe,ee,ue){return ee=_toPropertyKey$1(ee),ee in fe?Object.defineProperty(fe,ee,{value:ue,enumerable:!0,configurable:!0,writable:!0}):fe[ee]=ue,fe}function ownKeys$1(fe,ee){var ue=Object.keys(fe);if(Object.getOwnPropertySymbols){var pe=Object.getOwnPropertySymbols(fe);ee&&(pe=pe.filter(function(_e){return Object.getOwnPropertyDescriptor(fe,_e).enumerable})),ue.push.apply(ue,pe)}return ue}function _objectSpread2$1(fe){for(var ee=1;ee<arguments.length;ee++){var ue=arguments[ee]!=null?arguments[ee]:{};ee%2?ownKeys$1(Object(ue),!0).forEach(function(pe){_defineProperty$1(fe,pe,ue[pe])}):Object.getOwnPropertyDescriptors?Object.defineProperties(fe,Object.getOwnPropertyDescriptors(ue)):ownKeys$1(Object(ue)).forEach(function(pe){Object.defineProperty(fe,pe,Object.getOwnPropertyDescriptor(ue,pe))})}return fe}function formatProdErrorMessage(fe){return"Minified Redux error #"+fe+"; visit https://redux.js.org/Errors?code="+fe+" for the full message or use the non-minified dev environment for full errors. "}var $$observable=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}(),randomString=function(){return Math.random().toString(36).substring(7).split("").join(".")},ActionTypes={INIT:"@@redux/INIT"+randomString(),REPLACE:"@@redux/REPLACE"+randomString(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+randomString()}};function isPlainObject$3(fe){if(typeof fe!="object"||fe===null)return!1;for(var ee=fe;Object.getPrototypeOf(ee)!==null;)ee=Object.getPrototypeOf(ee);return Object.getPrototypeOf(fe)===ee}function createStore$1(fe,ee,ue){var pe;if(typeof ee=="function"&&typeof ue=="function"||typeof ue=="function"&&typeof arguments[3]=="function")throw new Error(formatProdErrorMessage(0));if(typeof ee=="function"&&typeof ue>"u"&&(ue=ee,ee=void 0),typeof ue<"u"){if(typeof ue!="function")throw new Error(formatProdErrorMessage(1));return ue(createStore$1)(fe,ee)}if(typeof fe!="function")throw new Error(formatProdErrorMessage(2));var _e=fe,Ne=ee,Ue=[],Ge=Ue,qe=!1;function Ke(){Ge===Ue&&(Ge=Ue.slice())}function Ye(){if(qe)throw new Error(formatProdErrorMessage(3));return Ne}function Ze(rt){if(typeof rt!="function")throw new Error(formatProdErrorMessage(4));if(qe)throw new Error(formatProdErrorMessage(5));var et=!0;return Ke(),Ge.push(rt),function(){if(et){if(qe)throw new Error(formatProdErrorMessage(6));et=!1,Ke();var nt=Ge.indexOf(rt);Ge.splice(nt,1),Ue=null}}}function Xe(rt){if(!isPlainObject$3(rt))throw new Error(formatProdErrorMessage(7));if(typeof rt.type>"u")throw new Error(formatProdErrorMessage(8));if(qe)throw new Error(formatProdErrorMessage(9));try{qe=!0,Ne=_e(Ne,rt)}finally{qe=!1}for(var et=Ue=Ge,it=0;it<et.length;it++){var nt=et[it];nt()}return rt}function Je(rt){if(typeof rt!="function")throw new Error(formatProdErrorMessage(10));_e=rt,Xe({type:ActionTypes.REPLACE})}function tt(){var rt,et=Ze;return rt={subscribe:function(nt){if(typeof nt!="object"||nt===null)throw new Error(formatProdErrorMessage(11));function st(){nt.next&&nt.next(Ye())}st();var lt=et(st);return{unsubscribe:lt}}},rt[$$observable]=function(){return this},rt}return Xe({type:ActionTypes.INIT}),pe={dispatch:Xe,subscribe:Ze,getState:Ye,replaceReducer:Je},pe[$$observable]=tt,pe}function assertReducerShape(fe){Object.keys(fe).forEach(function(ee){var ue=fe[ee],pe=ue(void 0,{type:ActionTypes.INIT});if(typeof pe>"u")throw new Error(formatProdErrorMessage(12));if(typeof ue(void 0,{type:ActionTypes.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(formatProdErrorMessage(13))})}function combineReducers(fe){for(var ee=Object.keys(fe),ue={},pe=0;pe<ee.length;pe++){var _e=ee[pe];typeof fe[_e]=="function"&&(ue[_e]=fe[_e])}var Ne=Object.keys(ue),Ue;try{assertReducerShape(ue)}catch(Ge){Ue=Ge}return function(qe,Ke){if(qe===void 0&&(qe={}),Ue)throw Ue;for(var Ye=!1,Ze={},Xe=0;Xe<Ne.length;Xe++){var Je=Ne[Xe],tt=ue[Je],rt=qe[Je],et=tt(rt,Ke);if(typeof et>"u")throw Ke&&Ke.type,new Error(formatProdErrorMessage(14));Ze[Je]=et,Ye=Ye||et!==rt}return Ye=Ye||Ne.length!==Object.keys(qe).length,Ye?Ze:qe}}function compose(){for(var fe=arguments.length,ee=new Array(fe),ue=0;ue<fe;ue++)ee[ue]=arguments[ue];return ee.length===0?function(pe){return pe}:ee.length===1?ee[0]:ee.reduce(function(pe,_e){return function(){return pe(_e.apply(void 0,arguments))}})}function applyMiddleware(){for(var fe=arguments.length,ee=new Array(fe),ue=0;ue<fe;ue++)ee[ue]=arguments[ue];return function(pe){return function(){var _e=pe.apply(void 0,arguments),Ne=function(){throw new Error(formatProdErrorMessage(15))},Ue={getState:_e.getState,dispatch:function(){return Ne.apply(void 0,arguments)}},Ge=ee.map(function(qe){return qe(Ue)});return Ne=compose.apply(void 0,Ge)(_e.dispatch),_objectSpread2$1(_objectSpread2$1({},_e),{},{dispatch:Ne})}}}const IMPORT_ENTITIES="@iiif/IMPORT_ENTITIES",MODIFY_ENTITY_FIELD="@iiif/MODIFY_ENTITY_FIELD",REORDER_ENTITY_FIELD="@iiif/REORDER_ENTITY_FIELD",ADD_REFERENCE="@iiif/ADD_REFERENCE",REMOVE_REFERENCE="@iiif/REMOVE_REFERENCE",importEntities=y$1(IMPORT_ENTITIES)(),modifyEntityField=y$1(MODIFY_ENTITY_FIELD)(),reorderEntityField=y$1(REORDER_ENTITY_FIELD)(),addReference=y$1(ADD_REFERENCE)(),removeReference=y$1(REMOVE_REFERENCE)(),entityActions={importEntities,modifyEntityField,reorderEntityField,addReference,removeReference},ADD_MAPPING="@iiif/ADD_MAPPING",ADD_MAPPINGS="@iiif/ADD_MAPPINGS",addMapping=y$1(ADD_MAPPING)(),addMappings=y$1(ADD_MAPPINGS)(),SET_META_VALUE="@iiif/SET_META_VALUE",SET_META_VALUE_DYNAMIC="@iiif/SET_META_VALUE_DYNAMIC",UNSET_META_VALUE="@iiif/UNSET_META_VALUE",setMetaValue=y$1(SET_META_VALUE)(),setMetaValueDynamic=y$1(SET_META_VALUE_DYNAMIC)(),unsetMetaValue=y$1(UNSET_META_VALUE)(),metaActions={setMetaValue,setMetaValueDynamic,unsetMetaValue},RESOURCE_ERROR="RESOURCE_ERROR",RESOURCE_LOADING="RESOURCE_LOADING",RESOURCE_READY="RESOURCE_READY",REQUEST_RESOURCE="@iiif/REQUEST_RESOURCE",REQUEST_ERROR="@iiif/REQUEST_ERROR",REQUEST_MISMATCH="@iiif/REQUEST_MISMATCH",REQUEST_COMPLETE="@iiif/REQUEST_COMPLETE",REQUEST_OFFLINE_RESOURCE="@iiif/REQUEST_OFFLINE_RESOURCE",requestResource=y$1(REQUEST_RESOURCE)(),requestError=y$1(REQUEST_ERROR)(),requestMismatch=y$1(REQUEST_MISMATCH)(),requestComplete=y$1(REQUEST_COMPLETE)();y$1(REQUEST_OFFLINE_RESOURCE)();const BATCH_ACTIONS="@iiif/BATCH",BATCH_IMPORT="@iiif/BATCH_IMPORT",batchActions=y$1(BATCH_ACTIONS)();y$1(BATCH_IMPORT)();const actionListFromResource=(fe,ee)=>{const{entities:ue,resource:pe,mapping:_e}=normalize(ee);if(pe.id===void 0)return[requestError({id:fe,message:"ID is not defined in resource."})];const Ne=[importEntities({entities:ue}),addMappings({mapping:_e})];return pe.id!==fe&&(Ne.push(addMapping({id:fe,type:pe.type})),Ne.push(requestMismatch({requestId:fe,actualId:pe.id}))),Ne.push(requestComplete({id:fe})),Ne},safeIsNaN=Number.isNaN||function(ee){return typeof ee=="number"&&ee!==ee};function isEqual(fe,ee){return!!(fe===ee||safeIsNaN(fe)&&safeIsNaN(ee))}function areInputsEqual(fe,ee){if(!Array.isArray(fe)||!Array.isArray(ee))return fe===ee;if(fe.length!==ee.length)return!1;for(let ue=0;ue<fe.length;ue++)if(!isEqual(fe[ue],ee[ue]))return!1;return!0}function resolveIfExists(fe,ee){const ue=fe.iiif.requests[ee],pe=fe.iiif.mapping[ee];if(!(!pe||!fe.iiif.entities[pe][ue.resourceUri]))return fe.iiif.entities[pe][ue.resourceUri]}function createFetchHelper(fe,ee,{waitTimeout:ue=30}={}){return async(pe,_e)=>{const Ne=fe.getState(),Ue=Ne.iiif.requests[pe];if(Ue)switch(Ue.loadingState){case RESOURCE_ERROR:break;case RESOURCE_LOADING:{let Ge,qe=!1;try{const Ke=await Promise.race([new Promise((Ye,Ze)=>{qe||(Ge=fe.subscribe(()=>{const Xe=fe.getState();if(Xe.iiif.requests[pe].loadingState===RESOURCE_ERROR){Ze();return}if(Xe.iiif.requests[pe].loadingState===RESOURCE_READY){const Je=resolveIfExists(Xe,pe);Je?Ye(Je):Ze()}}))}),new Promise((Ye,Ze)=>setTimeout(()=>{qe=!0,Ze()},ue*60))]);if(Ge&&Ge(),Ke)return Ke}catch{Ge&&Ge();break}break}case RESOURCE_READY:{const Ge=resolveIfExists(Ne,pe);if(Ge)return Ge;break}}fe.dispatch(requestResource({id:pe}));try{const Ge=await ee(pe,_e);!Ge.id&&!Ge["@id"]&&(Ge["@type"]&&(Ge["@id"]=pe),Ge.id=pe);const qe=actionListFromResource(pe,Ge);return fe.dispatch(batchActions({actions:qe})),resolveIfExists(fe.getState(),pe)}catch(Ge){throw fe.dispatch(requestError({id:pe,message:Ge.toString()})),Ge}}}function getDefaultEntities(){return{Collection:{},Manifest:{},Canvas:{},AnnotationPage:{},AnnotationCollection:{},Annotation:{},ContentResource:{},Range:{},Service:{},Selector:{},Agent:{}}}const mappingReducer=(fe={},ee)=>{switch(ee.type){case ADD_MAPPING:return{...fe,[ee.payload.id]:ee.payload.type};case ADD_MAPPINGS:return{...fe,...ee.payload.mapping};default:return fe}};function isReferenceList(fe,ee,ue,pe){return!(!fe[ue]||!fe[ue][ee]||!fe[ue][ee][pe]||!Array.isArray(fe[ue][ee][pe]))}function quickMerge(fe,ee){const ue={},pe=[];for(const[_e,Ne]of Object.entries(fe||{})){pe.push(_e);const Ue=(ee||{})[_e];if(!Ue||Ue.length===0){ue[_e]=Ne;continue}ue[_e]=Ue}for(const[_e,Ne]of Object.entries(ee||{}))pe.indexOf(_e)===-1&&(ue[_e]=Ne);return ue}const entitiesReducer=(fe=getDefaultEntities(),ee)=>{var ue;switch(ee.type){case MODIFY_ENTITY_FIELD:{if(!fe[ee.payload.type]||!fe[ee.payload.type][ee.payload.id])return fe;const pe=fe[ee.payload.type][ee.payload.id];return typeof pe=="string"?fe:{...fe,[ee.payload.type]:{...fe[ee.payload.type],[ee.payload.id]:{...pe,[ee.payload.key]:ee.payload.value}}}}case REORDER_ENTITY_FIELD:{if(!isReferenceList(fe,ee.payload.id,ee.payload.type,ee.payload.key))return fe;const pe=fe[ee.payload.type][ee.payload.id];if(typeof pe=="string")return fe;const _e=Array.from(pe[ee.payload.key]),[Ne]=_e.splice(ee.payload.startIndex,1);return _e.splice(ee.payload.endIndex,0,Ne),{...fe,[ee.payload.type]:{...fe[ee.payload.type],[ee.payload.id]:{...pe,[ee.payload.key]:_e}}}}case IMPORT_ENTITIES:{const pe=Object.keys(ee.payload.entities),_e={...fe};for(const Ne of pe){const Ue=ee.payload.entities[Ne],Ge={...fe[Ne]||{}};let qe=!1;const Ke=Object.keys(Ue||{})||[];if(Ue&&Ke){for(const Ye of Ke)qe=!0,Ge[Ye]=fe[Ne][Ye]?quickMerge(fe[Ne][Ye],Ue[Ye]):Ue[Ye];qe&&(_e[Ne]=Ge)}}return _e}case ADD_REFERENCE:{if(!isReferenceList(fe,ee.payload.id,ee.payload.type,ee.payload.key))return fe;const pe=fe[ee.payload.type][ee.payload.id],_e=Array.from(pe[ee.payload.key]);return _e.splice(ee.payload.index||_e.length+1,0,ee.payload.reference),{...fe,[ee.payload.type]:{...fe[ee.payload.type],[ee.payload.id]:{...pe,[ee.payload.key]:_e}}}}case REMOVE_REFERENCE:{if(!isReferenceList(fe,ee.payload.id,ee.payload.type,ee.payload.key))return fe;const pe=fe[ee.payload.type][ee.payload.id],_e=Array.from(pe[ee.payload.key]),Ne=ee.payload.index||_e.findIndex(Ue=>Ue&&Ue.id===ee.payload.reference.id);return Ne===-1||((ue=_e[Ne])==null?void 0:ue.id)!==ee.payload.reference.id?fe:(_e.splice(Ne,1),{...fe,[ee.payload.type]:{...fe[ee.payload.type],[ee.payload.id]:{...pe,[ee.payload.key]:_e}}})}default:return fe}},requestReducer=(fe={},ee)=>{switch(ee.type){case REQUEST_RESOURCE:case REQUEST_OFFLINE_RESOURCE:return{...fe,[ee.payload.id]:{requestUri:ee.payload.id,loadingState:RESOURCE_LOADING,uriMismatch:!1,resourceUri:ee.payload.id}};case REQUEST_MISMATCH:return{...fe,[ee.payload.requestId]:{...fe[ee.payload.requestId]||{},uriMismatch:!0,resourceUri:ee.payload.actualId},[ee.payload.actualId]:{requestUri:ee.payload.requestId,loadingState:fe[ee.payload.requestId].loadingState,uriMismatch:!0,resourceUri:ee.payload.actualId}};case REQUEST_ERROR:return{...fe,[ee.payload.id]:{...fe[ee.payload.id]||{},loadingState:RESOURCE_ERROR,error:ee.payload.message}};case REQUEST_COMPLETE:return{...fe,[ee.payload.id]:{...fe[ee.payload.id]||{},loadingState:RESOURCE_READY,error:void 0}}}return fe},metaReducer=(fe={},ee)=>{const{id:ue,updateValue:pe,value:_e,meta:Ne,key:Ue}=ee&&ee.payload||{};switch(ee.type){case SET_META_VALUE:return{...fe,[ue]:{...fe[ue]||{},[Ne]:{...fe[ue]?fe[ue][Ne]||{}:{},[Ue]:_e}}};case SET_META_VALUE_DYNAMIC:return{...fe,[ue]:{...fe[ue]||{},[Ne]:{...fe[ue]?fe[ue][Ne]||{}:{},[Ue]:fe[ue]&&fe[ue][Ne]?pe(fe[ue][Ne][Ue]):pe(void 0)}}};case UNSET_META_VALUE:return fe[ue]&&fe[ue][Ne]&&fe[ue][Ne][Ue]?{...fe,[ue]:{...fe[ue]||{},[Ne]:{...fe[ue]?fe[ue][Ne]||{}:{},[Ue]:void 0}}}:fe;default:return fe}};function createBatchReducer(fe){return(ee,ue)=>ue&&ue.type===BATCH_ACTIONS?ue.payload.actions.reduce(fe,ee):ue&&ue.type===BATCH_IMPORT?ue.payload.state:fe(ee,ue)}const reducers=combineReducers({mapping:mappingReducer,entities:entitiesReducer,requests:requestReducer,meta:metaReducer}),composeEnhancers=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||compose;function createStore(fe={}){const{enableDevtools:ee=!0,iiifStoreName:ue="iiif",defaultState:pe={},extraMiddleware:_e=[],customReducers:Ne={}}=fe,Ue=combineReducers({[ue]:reducers,...Ne});return createStore$1(createBatchReducer(Ue),pe,ee?composeEnhancers(applyMiddleware(..._e)):compose(applyMiddleware(..._e)))}function mitt(fe){return{all:fe=fe||new Map,on:function(ee,ue){var pe=fe.get(ee);pe?pe.push(ue):fe.set(ee,[ue])},off:function(ee,ue){var pe=fe.get(ee);pe&&(ue?pe.splice(pe.indexOf(ue)>>>0,1):fe.set(ee,[]))},emit:function(ee,ue){var pe=fe.get(ee);pe&&pe.slice().map(function(_e){_e(ue)}),(pe=fe.get("*"))&&pe.slice().map(function(_e){_e(ee,ue)})}}}class Vault{constructor(ee,ue){Vi(this,"options");Vi(this,"store");Vi(this,"emitter");Vi(this,"isBatching",!1);Vi(this,"batchQueue",[]);Vi(this,"remoteFetcher");Vi(this,"staticFetcher");Vi(this,"defaultFetcher",ee=>fetch(ee).then(ue=>ue.json()));Vi(this,"middleware",ee=>ue=>pe=>{if(pe.type===BATCH_ACTIONS){for(const Ue of pe.payload.actions)this.emitter.emit(Ue.type,{realAction:Ue,state:ee.getState()});const Ne=ue(pe);for(const Ue of pe.payload.actions)this.emitter.emit(`after:${pe.type}`,{action:pe,state:Ne});return Ne}this.emitter.emit(pe.type,{action:pe,state:ee.getState()});const _e=ue(pe);return this.emitter.emit(`after:${pe.type}`,{action:pe,state:_e}),_e});this.options=Object.assign({reducers:{},middleware:[],defaultState:{},customFetcher:this.defaultFetcher,enableDevtools:!0},ee||{}),this.store=ue||createStore({customReducers:this.options.reducers,extraMiddleware:[...this.options.middleware,this.middleware],defaultState:this.options.defaultState,enableDevtools:this.options.enableDevtools}),this.emitter=mitt(),this.remoteFetcher=createFetchHelper(this.store,this.options.customFetcher),this.staticFetcher=createFetchHelper(this.store,(pe,_e)=>_e)}batch(ee){this.isBatching=!0;try{ee(this),this.store.dispatch(batchActions({actions:this.batchQueue}))}catch(ue){throw this.batchQueue=[],this.isBatching=!1,ue}this.batchQueue=[],this.isBatching=!1}async asyncBatch(ee){this.isBatching=!0;try{await ee(this),this.store.dispatch(batchActions({actions:this.batchQueue}))}catch(ue){throw this.batchQueue=[],this.isBatching=!1,ue}this.batchQueue=[],this.isBatching=!1}modifyEntityField(ee,ue,pe){this.dispatch(entityActions.modifyEntityField({id:ee.id,type:ee.type,key:ue,value:pe}))}dispatch(ee){this.isBatching?this.batchQueue.push(ee):this.store.dispatch(ee)}serialize(ee,ue){return serialize(this.getState().iiif,ee,ue)}toPresentation2(ee){return this.serialize(ee,serializeConfigPresentation2)}toPresentation3(ee){return this.serialize(ee,serializeConfigPresentation3)}hydrate(ee,ue){return this.get(ee,ue,{skipSelfReturn:!1})}get(ee,ue,pe={}){typeof ue!="string"&&(pe=ue||{},ue=void 0);const{skipSelfReturn:_e=!0}=pe||{};if(Array.isArray(ee))return ee.map(Ke=>this.get(Ke,pe));const Ne=this.getState();if(typeof ee=="string"){const Ke=ue||Ne.iiif.mapping[ee];if(!Ke)return _e?null:{id:ee,type:"unknown"};ee={id:ee,type:Ke}}const Ue=ue||ee.type,Ge=ee.id,qe=Ne.iiif.entities[Ue];if(!qe){const Ke=Ne.iiif.requests[Ge];return Ke&&Ke.resourceUri!==Ge?this.get(Ke.resourceUri,pe):_e?null:ee}return qe[ee.id]||(_e?null:ee)}select(ee){return ee(this.getState())}getStore(){return this.store}getState(){return this.store.getState()}loadManifest(ee,ue){const pe=typeof ee=="string"?ee:ee.id;return this.load(pe,ue)}loadCollection(ee,ue){const pe=typeof ee=="string"?ee:ee.id;return this.load(pe,ue)}load(ee,ue){const pe=typeof ee=="string"?ee:ee.id;return ue?this.staticFetcher(pe,ue):this.remoteFetcher(pe)}areInputsEqual(ee,ue){return areInputsEqual(ee,ue)}subscribe(ee,ue,pe){typeof pe>"u"&&(typeof ue>"u"||ue===!1||ue===!0)&&(pe=ue,ue=ee,ee=Ne=>Ne);let _e=pe?null:ee(this.store.getState());return pe||ue(_e,this),this.store.subscribe(()=>{const Ne=this.store.getState(),Ue=ee(Ne);_e!==Ue&&!areInputsEqual(_e,Ue)&&ue(Ue,this),_e=Ue})}async ensureLoaded(ee){const ue=typeof ee=="string"?ee:ee.id;this.requestStatus(ue)||await this.load(ue)}requestStatus(ee){return this.select(ue=>ue.iiif.requests[ee])}getResourceMeta(ee,ue){const pe=this.getState().iiif.meta[ee];if(pe)return ue?pe[ue]:pe}setMetaValue([ee,ue,pe],_e){this.dispatch(typeof _e=="function"?metaActions.setMetaValueDynamic({id:ee,meta:ue,key:pe,updateValue:_e}):metaActions.setMetaValue({id:ee,meta:ue,key:pe,value:_e}))}}function _extends$1(){return _extends$1=Object.assign?Object.assign.bind():function(fe){for(var ee=1;ee<arguments.length;ee++){var ue=arguments[ee];for(var pe in ue)Object.prototype.hasOwnProperty.call(ue,pe)&&(fe[pe]=ue[pe])}return fe},_extends$1.apply(this,arguments)}function $e42e1063c40fb3ef$export$b9ecd428b558ff10(fe,ee,{checkForDefaultPrevented:ue=!0}={}){return function(_e){if(fe==null||fe(_e),ue===!1||!_e.defaultPrevented)return ee==null?void 0:ee(_e)}}function $c512c27ab02ef895$export$50c7b4e9d9f19c1(fe,ee=[]){let ue=[];function pe(Ne,Ue){const Ge=reactExports.createContext(Ue),qe=ue.length;ue=[...ue,Ue];function Ke(Ze){const{scope:Xe,children:Je,...tt}=Ze,rt=(Xe==null?void 0:Xe[fe][qe])||Ge,et=reactExports.useMemo(()=>tt,Object.values(tt));return reactExports.createElement(rt.Provider,{value:et},Je)}function Ye(Ze,Xe){const Je=(Xe==null?void 0:Xe[fe][qe])||Ge,tt=reactExports.useContext(Je);if(tt)return tt;if(Ue!==void 0)return Ue;throw new Error(`\`${Ze}\` must be used within \`${Ne}\``)}return Ke.displayName=Ne+"Provider",[Ke,Ye]}const _e=()=>{const Ne=ue.map(Ue=>reactExports.createContext(Ue));return function(Ge){const qe=(Ge==null?void 0:Ge[fe])||Ne;return reactExports.useMemo(()=>({[`__scope${fe}`]:{...Ge,[fe]:qe}}),[Ge,qe])}};return _e.scopeName=fe,[pe,$c512c27ab02ef895$var$composeContextScopes(_e,...ee)]}function $c512c27ab02ef895$var$composeContextScopes(...fe){const ee=fe[0];if(fe.length===1)return ee;const ue=()=>{const pe=fe.map(_e=>({useScope:_e(),scopeName:_e.scopeName}));return function(Ne){const Ue=pe.reduce((Ge,{useScope:qe,scopeName:Ke})=>{const Ze=qe(Ne)[`__scope${Ke}`];return{...Ge,...Ze}},{});return reactExports.useMemo(()=>({[`__scope${ee.scopeName}`]:Ue}),[Ue])}};return ue.scopeName=ee.scopeName,ue}function $b1b2314f5f9a1d84$export$25bec8c6f54ee79a(fe){const ee=reactExports.useRef(fe);return reactExports.useEffect(()=>{ee.current=fe}),reactExports.useMemo(()=>(...ue)=>{var pe;return(pe=ee.current)===null||pe===void 0?void 0:pe.call(ee,...ue)},[])}function $71cd76cc60e0454e$export$6f32135080cb4c3({prop:fe,defaultProp:ee,onChange:ue=()=>{}}){const[pe,_e]=$71cd76cc60e0454e$var$useUncontrolledState({defaultProp:ee,onChange:ue}),Ne=fe!==void 0,Ue=Ne?fe:pe,Ge=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(ue),qe=reactExports.useCallback(Ke=>{if(Ne){const Ze=typeof Ke=="function"?Ke(fe):Ke;Ze!==fe&&Ge(Ze)}else _e(Ke)},[Ne,fe,_e,Ge]);return[Ue,qe]}function $71cd76cc60e0454e$var$useUncontrolledState({defaultProp:fe,onChange:ee}){const ue=reactExports.useState(fe),[pe]=ue,_e=reactExports.useRef(pe),Ne=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(ee);return reactExports.useEffect(()=>{_e.current!==pe&&(Ne(pe),_e.current=pe)},[pe,_e,Ne]),ue}const $9f79659886946c16$export$e5c5a5f917a5871c=globalThis!=null&&globalThis.document?reactExports.useLayoutEffect:()=>{};function $6ed0406888f73fc4$var$setRef(fe,ee){typeof fe=="function"?fe(ee):fe!=null&&(fe.current=ee)}function $6ed0406888f73fc4$export$43e446d32b3d21af(...fe){return ee=>fe.forEach(ue=>$6ed0406888f73fc4$var$setRef(ue,ee))}function $6ed0406888f73fc4$export$c7b2cbe3552a0d05(...fe){return reactExports.useCallback($6ed0406888f73fc4$export$43e446d32b3d21af(...fe),fe)}const $5e63c961fc1ce211$export$8c6ed5c666ac1360=reactExports.forwardRef((fe,ee)=>{const{children:ue,...pe}=fe,_e=reactExports.Children.toArray(ue),Ne=_e.find($5e63c961fc1ce211$var$isSlottable);if(Ne){const Ue=Ne.props.children,Ge=_e.map(qe=>qe===Ne?reactExports.Children.count(Ue)>1?reactExports.Children.only(null):reactExports.isValidElement(Ue)?Ue.props.children:null:qe);return reactExports.createElement($5e63c961fc1ce211$var$SlotClone,_extends$1({},pe,{ref:ee}),reactExports.isValidElement(Ue)?reactExports.cloneElement(Ue,void 0,Ge):null)}return reactExports.createElement($5e63c961fc1ce211$var$SlotClone,_extends$1({},pe,{ref:ee}),ue)});$5e63c961fc1ce211$export$8c6ed5c666ac1360.displayName="Slot";const $5e63c961fc1ce211$var$SlotClone=reactExports.forwardRef((fe,ee)=>{const{children:ue,...pe}=fe;return reactExports.isValidElement(ue)?reactExports.cloneElement(ue,{...$5e63c961fc1ce211$var$mergeProps(pe,ue.props),ref:ee?$6ed0406888f73fc4$export$43e446d32b3d21af(ee,ue.ref):ue.ref}):reactExports.Children.count(ue)>1?reactExports.Children.only(null):null});$5e63c961fc1ce211$var$SlotClone.displayName="SlotClone";const $5e63c961fc1ce211$export$d9f1ccf0bdb05d45=({children:fe})=>reactExports.createElement(reactExports.Fragment,null,fe);function $5e63c961fc1ce211$var$isSlottable(fe){return reactExports.isValidElement(fe)&&fe.type===$5e63c961fc1ce211$export$d9f1ccf0bdb05d45}function $5e63c961fc1ce211$var$mergeProps(fe,ee){const ue={...ee};for(const pe in ee){const _e=fe[pe],Ne=ee[pe];/^on[A-Z]/.test(pe)?_e&&Ne?ue[pe]=(...Ge)=>{Ne(...Ge),_e(...Ge)}:_e&&(ue[pe]=_e):pe==="style"?ue[pe]={..._e,...Ne}:pe==="className"&&(ue[pe]=[_e,Ne].filter(Boolean).join(" "))}return{...fe,...ue}}const $8927f6f2acc4f386$var$NODES=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],$8927f6f2acc4f386$export$250ffa63cdc0d034=$8927f6f2acc4f386$var$NODES.reduce((fe,ee)=>{const ue=reactExports.forwardRef((pe,_e)=>{const{asChild:Ne,...Ue}=pe,Ge=Ne?$5e63c961fc1ce211$export$8c6ed5c666ac1360:ee;return reactExports.useEffect(()=>{window[Symbol.for("radix-ui")]=!0},[]),reactExports.createElement(Ge,_extends$1({},Ue,{ref:_e}))});return ue.displayName=`Primitive.${ee}`,{...fe,[ee]:ue}},{});function $8927f6f2acc4f386$export$6d1a0317bde7de7f(fe,ee){fe&&reactDomExports.flushSync(()=>fe.dispatchEvent(ee))}function $fe963b355347cc68$export$3e6543de14f8614f(fe,ee){return reactExports.useReducer((ue,pe)=>{const _e=ee[ue][pe];return _e??ue},fe)}const $921a889cee6df7e8$export$99c2b779aa4e8b8b=fe=>{const{present:ee,children:ue}=fe,pe=$921a889cee6df7e8$var$usePresence(ee),_e=typeof ue=="function"?ue({present:pe.isPresent}):reactExports.Children.only(ue),Ne=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(pe.ref,_e.ref);return typeof ue=="function"||pe.isPresent?reactExports.cloneElement(_e,{ref:Ne}):null};$921a889cee6df7e8$export$99c2b779aa4e8b8b.displayName="Presence";function $921a889cee6df7e8$var$usePresence(fe){const[ee,ue]=reactExports.useState(),pe=reactExports.useRef({}),_e=reactExports.useRef(fe),Ne=reactExports.useRef("none"),Ue=fe?"mounted":"unmounted",[Ge,qe]=$fe963b355347cc68$export$3e6543de14f8614f(Ue,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return reactExports.useEffect(()=>{const Ke=$921a889cee6df7e8$var$getAnimationName(pe.current);Ne.current=Ge==="mounted"?Ke:"none"},[Ge]),$9f79659886946c16$export$e5c5a5f917a5871c(()=>{const Ke=pe.current,Ye=_e.current;if(Ye!==fe){const Xe=Ne.current,Je=$921a889cee6df7e8$var$getAnimationName(Ke);fe?qe("MOUNT"):Je==="none"||(Ke==null?void 0:Ke.display)==="none"?qe("UNMOUNT"):qe(Ye&&Xe!==Je?"ANIMATION_OUT":"UNMOUNT"),_e.current=fe}},[fe,qe]),$9f79659886946c16$export$e5c5a5f917a5871c(()=>{if(ee){const Ke=Ze=>{const Je=$921a889cee6df7e8$var$getAnimationName(pe.current).includes(Ze.animationName);Ze.target===ee&&Je&&reactDomExports.flushSync(()=>qe("ANIMATION_END"))},Ye=Ze=>{Ze.target===ee&&(Ne.current=$921a889cee6df7e8$var$getAnimationName(pe.current))};return ee.addEventListener("animationstart",Ye),ee.addEventListener("animationcancel",Ke),ee.addEventListener("animationend",Ke),()=>{ee.removeEventListener("animationstart",Ye),ee.removeEventListener("animationcancel",Ke),ee.removeEventListener("animationend",Ke)}}else qe("ANIMATION_END")},[ee,qe]),{isPresent:["mounted","unmountSuspended"].includes(Ge),ref:reactExports.useCallback(Ke=>{Ke&&(pe.current=getComputedStyle(Ke)),ue(Ke)},[])}}function $921a889cee6df7e8$var$getAnimationName(fe){return(fe==null?void 0:fe.animationName)||"none"}const $1746a345f3d73bb7$var$useReactId=$2AODx$react.useId||(()=>{});let $1746a345f3d73bb7$var$count=0;function $1746a345f3d73bb7$export$f680877a34711e37(fe){const[ee,ue]=reactExports.useState($1746a345f3d73bb7$var$useReactId());return $9f79659886946c16$export$e5c5a5f917a5871c(()=>{fe||ue(pe=>pe??String($1746a345f3d73bb7$var$count++))},[fe]),fe||(ee?`radix-${ee}`:"")}const $409067139f391064$var$COLLAPSIBLE_NAME="Collapsible",[$409067139f391064$var$createCollapsibleContext,$409067139f391064$export$952b32dcbe73087a]=$c512c27ab02ef895$export$50c7b4e9d9f19c1($409067139f391064$var$COLLAPSIBLE_NAME),[$409067139f391064$var$CollapsibleProvider,$409067139f391064$var$useCollapsibleContext]=$409067139f391064$var$createCollapsibleContext($409067139f391064$var$COLLAPSIBLE_NAME),$409067139f391064$export$6eb0f7ddcda6131f=reactExports.forwardRef((fe,ee)=>{const{__scopeCollapsible:ue,open:pe,defaultOpen:_e,disabled:Ne,onOpenChange:Ue,...Ge}=fe,[qe=!1,Ke]=$71cd76cc60e0454e$export$6f32135080cb4c3({prop:pe,defaultProp:_e,onChange:Ue});return reactExports.createElement($409067139f391064$var$CollapsibleProvider,{scope:ue,disabled:Ne,contentId:$1746a345f3d73bb7$export$f680877a34711e37(),open:qe,onOpenToggle:reactExports.useCallback(()=>Ke(Ye=>!Ye),[Ke])},reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({"data-state":$409067139f391064$var$getState(qe),"data-disabled":Ne?"":void 0},Ge,{ref:ee})))}),$409067139f391064$var$TRIGGER_NAME="CollapsibleTrigger",$409067139f391064$export$c135dce7b15bbbdc=reactExports.forwardRef((fe,ee)=>{const{__scopeCollapsible:ue,...pe}=fe,_e=$409067139f391064$var$useCollapsibleContext($409067139f391064$var$TRIGGER_NAME,ue);return reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.button,_extends$1({type:"button","aria-controls":_e.contentId,"aria-expanded":_e.open||!1,"data-state":$409067139f391064$var$getState(_e.open),"data-disabled":_e.disabled?"":void 0,disabled:_e.disabled},pe,{ref:ee,onClick:$e42e1063c40fb3ef$export$b9ecd428b558ff10(fe.onClick,_e.onOpenToggle)}))}),$409067139f391064$var$CONTENT_NAME="CollapsibleContent",$409067139f391064$export$aadde00976f34151=reactExports.forwardRef((fe,ee)=>{const{forceMount:ue,...pe}=fe,_e=$409067139f391064$var$useCollapsibleContext($409067139f391064$var$CONTENT_NAME,fe.__scopeCollapsible);return reactExports.createElement($921a889cee6df7e8$export$99c2b779aa4e8b8b,{present:ue||_e.open},({present:Ne})=>reactExports.createElement($409067139f391064$var$CollapsibleContentImpl,_extends$1({},pe,{ref:ee,present:Ne})))}),$409067139f391064$var$CollapsibleContentImpl=reactExports.forwardRef((fe,ee)=>{const{__scopeCollapsible:ue,present:pe,children:_e,...Ne}=fe,Ue=$409067139f391064$var$useCollapsibleContext($409067139f391064$var$CONTENT_NAME,ue),[Ge,qe]=reactExports.useState(pe),Ke=reactExports.useRef(null),Ye=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(ee,Ke),Ze=reactExports.useRef(0),Xe=Ze.current,Je=reactExports.useRef(0),tt=Je.current,rt=Ue.open||Ge,et=reactExports.useRef(rt),it=reactExports.useRef();return reactExports.useEffect(()=>{const nt=requestAnimationFrame(()=>et.current=!1);return()=>cancelAnimationFrame(nt)},[]),$9f79659886946c16$export$e5c5a5f917a5871c(()=>{const nt=Ke.current;if(nt){it.current=it.current||{transitionDuration:nt.style.transitionDuration,animationName:nt.style.animationName},nt.style.transitionDuration="0s",nt.style.animationName="none";const st=nt.getBoundingClientRect();Ze.current=st.height,Je.current=st.width,et.current||(nt.style.transitionDuration=it.current.transitionDuration,nt.style.animationName=it.current.animationName),qe(pe)}},[Ue.open,pe]),reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({"data-state":$409067139f391064$var$getState(Ue.open),"data-disabled":Ue.disabled?"":void 0,id:Ue.contentId,hidden:!rt},Ne,{ref:Ye,style:{"--radix-collapsible-content-height":Xe?`${Xe}px`:void 0,"--radix-collapsible-content-width":tt?`${tt}px`:void 0,...fe.style}}),rt&&_e)});function $409067139f391064$var$getState(fe){return fe?"open":"closed"}const $409067139f391064$export$be92b6f5f03c0fe9=$409067139f391064$export$6eb0f7ddcda6131f,$409067139f391064$export$41fb9f06171c75f4=$409067139f391064$export$c135dce7b15bbbdc,$409067139f391064$export$7c6e2c02157bb7d2=$409067139f391064$export$aadde00976f34151,ErrorBoundaryContext=reactExports.createContext(null),initialState={didCatch:!1,error:null};class ErrorBoundary extends reactExports.Component{constructor(ee){super(ee),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=initialState}static getDerivedStateFromError(ee){return{didCatch:!0,error:ee}}resetErrorBoundary(){const{error:ee}=this.state;if(ee!==null){for(var ue,pe,_e=arguments.length,Ne=new Array(_e),Ue=0;Ue<_e;Ue++)Ne[Ue]=arguments[Ue];(ue=(pe=this.props).onReset)===null||ue===void 0||ue.call(pe,{args:Ne,reason:"imperative-api"}),this.setState(initialState)}}componentDidCatch(ee,ue){var pe,_e;(pe=(_e=this.props).onError)===null||pe===void 0||pe.call(_e,ee,ue)}componentDidUpdate(ee,ue){const{didCatch:pe}=this.state,{resetKeys:_e}=this.props;if(pe&&ue.error!==null&&hasArrayChanged(ee.resetKeys,_e)){var Ne,Ue;(Ne=(Ue=this.props).onReset)===null||Ne===void 0||Ne.call(Ue,{next:_e,prev:ee.resetKeys,reason:"keys"}),this.setState(initialState)}}render(){const{children:ee,fallbackRender:ue,FallbackComponent:pe,fallback:_e}=this.props,{didCatch:Ne,error:Ue}=this.state;let Ge=ee;if(Ne){const qe={error:Ue,resetErrorBoundary:this.resetErrorBoundary};if(reactExports.isValidElement(_e))Ge=_e;else if(typeof ue=="function")Ge=ue(qe);else if(pe)Ge=reactExports.createElement(pe,qe);else throw Ue}return reactExports.createElement(ErrorBoundaryContext.Provider,{value:{didCatch:Ne,error:Ue,resetErrorBoundary:this.resetErrorBoundary}},Ge)}}function hasArrayChanged(){let fe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],ee=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return fe.length!==ee.length||fe.some((ue,pe)=>!Object.is(ue,ee[pe]))}var e="colors",t="sizes",r="space",n={gap:r,gridGap:r,columnGap:r,gridColumnGap:r,rowGap:r,gridRowGap:r,inset:r,insetBlock:r,insetBlockEnd:r,insetBlockStart:r,insetInline:r,insetInlineEnd:r,insetInlineStart:r,margin:r,marginTop:r,marginRight:r,marginBottom:r,marginLeft:r,marginBlock:r,marginBlockEnd:r,marginBlockStart:r,marginInline:r,marginInlineEnd:r,marginInlineStart:r,padding:r,paddingTop:r,paddingRight:r,paddingBottom:r,paddingLeft:r,paddingBlock:r,paddingBlockEnd:r,paddingBlockStart:r,paddingInline:r,paddingInlineEnd:r,paddingInlineStart:r,top:r,right:r,bottom:r,left:r,scrollMargin:r,scrollMarginTop:r,scrollMarginRight:r,scrollMarginBottom:r,scrollMarginLeft:r,scrollMarginX:r,scrollMarginY:r,scrollMarginBlock:r,scrollMarginBlockEnd:r,scrollMarginBlockStart:r,scrollMarginInline:r,scrollMarginInlineEnd:r,scrollMarginInlineStart:r,scrollPadding:r,scrollPaddingTop:r,scrollPaddingRight:r,scrollPaddingBottom:r,scrollPaddingLeft:r,scrollPaddingX:r,scrollPaddingY:r,scrollPaddingBlock:r,scrollPaddingBlockEnd:r,scrollPaddingBlockStart:r,scrollPaddingInline:r,scrollPaddingInlineEnd:r,scrollPaddingInlineStart:r,fontSize:"fontSizes",background:e,backgroundColor:e,backgroundImage:e,borderImage:e,border:e,borderBlock:e,borderBlockEnd:e,borderBlockStart:e,borderBottom:e,borderBottomColor:e,borderColor:e,borderInline:e,borderInlineEnd:e,borderInlineStart:e,borderLeft:e,borderLeftColor:e,borderRight:e,borderRightColor:e,borderTop:e,borderTopColor:e,caretColor:e,color:e,columnRuleColor:e,fill:e,outline:e,outlineColor:e,stroke:e,textDecorationColor:e,fontFamily:"fonts",fontWeight:"fontWeights",lineHeight:"lineHeights",letterSpacing:"letterSpacings",blockSize:t,minBlockSize:t,maxBlockSize:t,inlineSize:t,minInlineSize:t,maxInlineSize:t,width:t,minWidth:t,maxWidth:t,height:t,minHeight:t,maxHeight:t,flexBasis:t,gridTemplateColumns:t,gridTemplateRows:t,borderWidth:"borderWidths",borderTopWidth:"borderWidths",borderRightWidth:"borderWidths",borderBottomWidth:"borderWidths",borderLeftWidth:"borderWidths",borderStyle:"borderStyles",borderTopStyle:"borderStyles",borderRightStyle:"borderStyles",borderBottomStyle:"borderStyles",borderLeftStyle:"borderStyles",borderRadius:"radii",borderTopLeftRadius:"radii",borderTopRightRadius:"radii",borderBottomRightRadius:"radii",borderBottomLeftRadius:"radii",boxShadow:"shadows",textShadow:"shadows",transition:"transitions",zIndex:"zIndices"},i=(fe,ee)=>typeof ee=="function"?{"()":Function.prototype.toString.call(ee)}:ee,o=()=>{const fe=Object.create(null);return(ee,ue,...pe)=>{const _e=(Ne=>JSON.stringify(Ne,i))(ee);return _e in fe?fe[_e]:fe[_e]=ue(ee,...pe)}},l=Symbol.for("sxs.internal"),s=(fe,ee)=>Object.defineProperties(fe,Object.getOwnPropertyDescriptors(ee)),a=fe=>{for(const ee in fe)return!0;return!1},{hasOwnProperty:c}=Object.prototype,d=fe=>fe.includes("-")?fe:fe.replace(/[A-Z]/g,ee=>"-"+ee.toLowerCase()),g=/\s+(?![^()]*\))/,p=fe=>ee=>fe(...typeof ee=="string"?String(ee).split(g):[ee]),u={appearance:fe=>({WebkitAppearance:fe,appearance:fe}),backfaceVisibility:fe=>({WebkitBackfaceVisibility:fe,backfaceVisibility:fe}),backdropFilter:fe=>({WebkitBackdropFilter:fe,backdropFilter:fe}),backgroundClip:fe=>({WebkitBackgroundClip:fe,backgroundClip:fe}),boxDecorationBreak:fe=>({WebkitBoxDecorationBreak:fe,boxDecorationBreak:fe}),clipPath:fe=>({WebkitClipPath:fe,clipPath:fe}),content:fe=>({content:fe.includes('"')||fe.includes("'")||/^([A-Za-z]+\([^]*|[^]*-quote|inherit|initial|none|normal|revert|unset)$/.test(fe)?fe:`"${fe}"`}),hyphens:fe=>({WebkitHyphens:fe,hyphens:fe}),maskImage:fe=>({WebkitMaskImage:fe,maskImage:fe}),maskSize:fe=>({WebkitMaskSize:fe,maskSize:fe}),tabSize:fe=>({MozTabSize:fe,tabSize:fe}),textSizeAdjust:fe=>({WebkitTextSizeAdjust:fe,textSizeAdjust:fe}),userSelect:fe=>({WebkitUserSelect:fe,userSelect:fe}),marginBlock:p((fe,ee)=>({marginBlockStart:fe,marginBlockEnd:ee||fe})),marginInline:p((fe,ee)=>({marginInlineStart:fe,marginInlineEnd:ee||fe})),maxSize:p((fe,ee)=>({maxBlockSize:fe,maxInlineSize:ee||fe})),minSize:p((fe,ee)=>({minBlockSize:fe,minInlineSize:ee||fe})),paddingBlock:p((fe,ee)=>({paddingBlockStart:fe,paddingBlockEnd:ee||fe})),paddingInline:p((fe,ee)=>({paddingInlineStart:fe,paddingInlineEnd:ee||fe}))},h=/([\d.]+)([^]*)/,f=(fe,ee)=>fe.length?fe.reduce((ue,pe)=>(ue.push(...ee.map(_e=>_e.includes("&")?_e.replace(/&/g,/[ +>|~]/.test(pe)&&/&.*&/.test(_e)?`:is(${pe})`:pe):pe+" "+_e)),ue),[]):ee,m$1=(fe,ee)=>fe in b&&typeof ee=="string"?ee.replace(/^((?:[^]*[^\w-])?)(fit-content|stretch)((?:[^\w-][^]*)?)$/,(ue,pe,_e,Ne)=>pe+(_e==="stretch"?`-moz-available${Ne};${d(fe)}:${pe}-webkit-fill-available`:`-moz-fit-content${Ne};${d(fe)}:${pe}fit-content`)+Ne):String(ee),b={blockSize:1,height:1,inlineSize:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,width:1},S$1=fe=>fe?fe+"-":"",k$1=(fe,ee,ue)=>fe.replace(/([+-])?((?:\d+(?:\.\d*)?|\.\d+)(?:[Ee][+-]?\d+)?)?(\$|--)([$\w-]+)/g,(pe,_e,Ne,Ue,Ge)=>Ue=="$"==!!Ne?pe:(_e||Ue=="--"?"calc(":"")+"var(--"+(Ue==="$"?S$1(ee)+(Ge.includes("$")?"":S$1(ue))+Ge.replace(/\$/g,"-"):Ge)+")"+(_e||Ue=="--"?"*"+(_e||"")+(Ne||"1")+")":"")),y=/\s*,\s*(?![^()]*\))/,B$1=Object.prototype.toString,$=(fe,ee,ue,pe,_e)=>{let Ne,Ue,Ge;const qe=(Ke,Ye,Ze)=>{let Xe,Je;const tt=rt=>{for(Xe in rt){const nt=Xe.charCodeAt(0)===64,st=nt&&Array.isArray(rt[Xe])?rt[Xe]:[rt[Xe]];for(Je of st){const lt=/[A-Z]/.test(it=Xe)?it:it.replace(/-[^]/g,jr=>jr[1].toUpperCase()),_r=typeof Je=="object"&&Je&&Je.toString===B$1&&(!pe.utils[lt]||!Ye.length);if(lt in pe.utils&&!_r){const jr=pe.utils[lt];if(jr!==Ue){Ue=jr,tt(jr(Je)),Ue=null;continue}}else if(lt in u){const jr=u[lt];if(jr!==Ge){Ge=jr,tt(jr(Je)),Ge=null;continue}}if(nt&&(et=Xe.slice(1)in pe.media?"@media "+pe.media[Xe.slice(1)]:Xe,Xe=et.replace(/\(\s*([\w-]+)\s*(=|<|<=|>|>=)\s*([\w-]+)\s*(?:(<|<=|>|>=)\s*([\w-]+)\s*)?\)/g,(jr,Nr,Wr,ri,Xr,Gr)=>{const qr=h.test(Nr),si=.0625*(qr?-1:1),[oi,Yr]=qr?[ri,Nr]:[Nr,ri];return"("+(Wr[0]==="="?"":Wr[0]===">"===qr?"max-":"min-")+oi+":"+(Wr[0]!=="="&&Wr.length===1?Yr.replace(h,(ii,ti,ni)=>Number(ti)+si*(Wr===">"?1:-1)+ni):Yr)+(Xr?") and ("+(Xr[0]===">"?"min-":"max-")+oi+":"+(Xr.length===1?Gr.replace(h,(ii,ti,ni)=>Number(ti)+si*(Xr===">"?-1:1)+ni):Gr):"")+")"})),_r){const jr=nt?Ze.concat(Xe):[...Ze],Nr=nt?[...Ye]:f(Ye,Xe.split(y));Ne!==void 0&&_e(x$1(...Ne)),Ne=void 0,qe(Je,Nr,jr)}else Ne===void 0&&(Ne=[[],Ye,Ze]),Xe=nt||Xe.charCodeAt(0)!==36?Xe:`--${S$1(pe.prefix)}${Xe.slice(1).replace(/\$/g,"-")}`,Je=_r?Je:typeof Je=="number"?Je&&lt in I?String(Je)+"px":String(Je):k$1(m$1(lt,Je??""),pe.prefix,pe.themeMap[lt]),Ne[0].push(`${nt?`${Xe} `:`${d(Xe)}:`}${Je}`)}}var et,it};tt(Ke),Ne!==void 0&&_e(x$1(...Ne)),Ne=void 0};qe(fe,ee,ue)},x$1=(fe,ee,ue)=>`${ue.map(pe=>`${pe}{`).join("")}${ee.length?`${ee.join(",")}{`:""}${fe.join(";")}${ee.length?"}":""}${Array(ue.length?ue.length+1:0).join("}")}`,I={animationDelay:1,animationDuration:1,backgroundSize:1,blockSize:1,border:1,borderBlock:1,borderBlockEnd:1,borderBlockEndWidth:1,borderBlockStart:1,borderBlockStartWidth:1,borderBlockWidth:1,borderBottom:1,borderBottomLeftRadius:1,borderBottomRightRadius:1,borderBottomWidth:1,borderEndEndRadius:1,borderEndStartRadius:1,borderInlineEnd:1,borderInlineEndWidth:1,borderInlineStart:1,borderInlineStartWidth:1,borderInlineWidth:1,borderLeft:1,borderLeftWidth:1,borderRadius:1,borderRight:1,borderRightWidth:1,borderSpacing:1,borderStartEndRadius:1,borderStartStartRadius:1,borderTop:1,borderTopLeftRadius:1,borderTopRightRadius:1,borderTopWidth:1,borderWidth:1,bottom:1,columnGap:1,columnRule:1,columnRuleWidth:1,columnWidth:1,containIntrinsicSize:1,flexBasis:1,fontSize:1,gap:1,gridAutoColumns:1,gridAutoRows:1,gridTemplateColumns:1,gridTemplateRows:1,height:1,inlineSize:1,inset:1,insetBlock:1,insetBlockEnd:1,insetBlockStart:1,insetInline:1,insetInlineEnd:1,insetInlineStart:1,left:1,letterSpacing:1,margin:1,marginBlock:1,marginBlockEnd:1,marginBlockStart:1,marginBottom:1,marginInline:1,marginInlineEnd:1,marginInlineStart:1,marginLeft:1,marginRight:1,marginTop:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,offsetDistance:1,offsetRotate:1,outline:1,outlineOffset:1,outlineWidth:1,overflowClipMargin:1,padding:1,paddingBlock:1,paddingBlockEnd:1,paddingBlockStart:1,paddingBottom:1,paddingInline:1,paddingInlineEnd:1,paddingInlineStart:1,paddingLeft:1,paddingRight:1,paddingTop:1,perspective:1,right:1,rowGap:1,scrollMargin:1,scrollMarginBlock:1,scrollMarginBlockEnd:1,scrollMarginBlockStart:1,scrollMarginBottom:1,scrollMarginInline:1,scrollMarginInlineEnd:1,scrollMarginInlineStart:1,scrollMarginLeft:1,scrollMarginRight:1,scrollMarginTop:1,scrollPadding:1,scrollPaddingBlock:1,scrollPaddingBlockEnd:1,scrollPaddingBlockStart:1,scrollPaddingBottom:1,scrollPaddingInline:1,scrollPaddingInlineEnd:1,scrollPaddingInlineStart:1,scrollPaddingLeft:1,scrollPaddingRight:1,scrollPaddingTop:1,shapeMargin:1,textDecoration:1,textDecorationThickness:1,textIndent:1,textUnderlineOffset:1,top:1,transitionDelay:1,transitionDuration:1,verticalAlign:1,width:1,wordSpacing:1},R$1=fe=>String.fromCharCode(fe+(fe>25?39:97)),z$1=fe=>(ee=>{let ue,pe="";for(ue=Math.abs(ee);ue>52;ue=ue/52|0)pe=R$1(ue%52)+pe;return R$1(ue%52)+pe})(((ee,ue)=>{let pe=ue.length;for(;pe;)ee=33*ee^ue.charCodeAt(--pe);return ee})(5381,JSON.stringify(fe))>>>0),W=["themed","global","styled","onevar","resonevar","allvar","inline"],j=fe=>{if(fe.href&&!fe.href.startsWith(location.origin))return!1;try{return!!fe.cssRules}catch{return!1}},E=fe=>{let ee;const ue=()=>{const{cssRules:_e}=ee.sheet;return[].map.call(_e,(Ne,Ue)=>{const{cssText:Ge}=Ne;let qe="";if(Ge.startsWith("--sxs"))return"";if(_e[Ue-1]&&(qe=_e[Ue-1].cssText).startsWith("--sxs")){if(!Ne.cssRules.length)return"";for(const Ke in ee.rules)if(ee.rules[Ke].group===Ne)return`--sxs{--sxs:${[...ee.rules[Ke].cache].join(" ")}}${Ge}`;return Ne.cssRules.length?`${qe}${Ge}`:""}return Ge}).join("")},pe=()=>{if(ee){const{rules:Ge,sheet:qe}=ee;if(!qe.deleteRule){for(;Object(Object(qe.cssRules)[0]).type===3;)qe.cssRules.splice(0,1);qe.cssRules=[]}for(const Ke in Ge)delete Ge[Ke]}const _e=Object(fe).styleSheets||[];for(const Ge of _e)if(j(Ge)){for(let qe=0,Ke=Ge.cssRules;Ke[qe];++qe){const Ye=Object(Ke[qe]);if(Ye.type!==1)continue;const Ze=Object(Ke[qe+1]);if(Ze.type!==4)continue;++qe;const{cssText:Xe}=Ye;if(!Xe.startsWith("--sxs"))continue;const Je=Xe.slice(14,-3).trim().split(/\s+/),tt=W[Je[0]];tt&&(ee||(ee={sheet:Ge,reset:pe,rules:{},toString:ue}),ee.rules[tt]={group:Ze,index:qe,cache:new Set(Je)})}if(ee)break}if(!ee){const Ge=(qe,Ke)=>({type:Ke,cssRules:[],insertRule(Ye,Ze){this.cssRules.splice(Ze,0,Ge(Ye,{import:3,undefined:1}[(Ye.toLowerCase().match(/^@([a-z]+)/)||[])[1]]||4))},get cssText(){return qe==="@media{}"?`@media{${[].map.call(this.cssRules,Ye=>Ye.cssText).join("")}}`:qe}});ee={sheet:fe?(fe.head||fe).appendChild(document.createElement("style")).sheet:Ge("","text/css"),rules:{},reset:pe,toString:ue}}const{sheet:Ne,rules:Ue}=ee;for(let Ge=W.length-1;Ge>=0;--Ge){const qe=W[Ge];if(!Ue[qe]){const Ke=W[Ge+1],Ye=Ue[Ke]?Ue[Ke].index:Ne.cssRules.length;Ne.insertRule("@media{}",Ye),Ne.insertRule(`--sxs{--sxs:${Ge}}`,Ye),Ue[qe]={group:Ne.cssRules[Ye+1],index:Ye,cache:new Set([Ge])}}v(Ue[qe])}};return pe(),ee},v=fe=>{const ee=fe.group;let ue=ee.cssRules.length;fe.apply=pe=>{try{ee.insertRule(pe,ue),++ue}catch{}}},T$1=Symbol(),w=o(),M=(fe,ee)=>w(fe,()=>(...ue)=>{let pe={type:null,composers:new Set};for(const _e of ue)if(_e!=null)if(_e[l]){pe.type==null&&(pe.type=_e[l].type);for(const Ne of _e[l].composers)pe.composers.add(Ne)}else _e.constructor!==Object||_e.$$typeof?pe.type==null&&(pe.type=_e):pe.composers.add(C(_e,fe));return pe.type==null&&(pe.type="span"),pe.composers.size||pe.composers.add(["PJLV",{},[],[],{},[]]),P$1(fe,pe,ee)}),C=({variants:fe,compoundVariants:ee,defaultVariants:ue,...pe},_e)=>{const Ne=`${S$1(_e.prefix)}c-${z$1(pe)}`,Ue=[],Ge=[],qe=Object.create(null),Ke=[];for(const Xe in ue)qe[Xe]=String(ue[Xe]);if(typeof fe=="object"&&fe)for(const Xe in fe){Ye=qe,Ze=Xe,c.call(Ye,Ze)||(qe[Xe]="undefined");const Je=fe[Xe];for(const tt in Je){const rt={[Xe]:String(tt)};String(tt)==="undefined"&&Ke.push(Xe);const et=Je[tt],it=[rt,et,!a(et)];Ue.push(it)}}var Ye,Ze;if(typeof ee=="object"&&ee)for(const Xe of ee){let{css:Je,...tt}=Xe;Je=typeof Je=="object"&&Je||{};for(const et in tt)tt[et]=String(tt[et]);const rt=[tt,Je,!a(Je)];Ge.push(rt)}return[Ne,pe,Ue,Ge,qe,Ke]},P$1=(fe,ee,ue)=>{const[pe,_e,Ne,Ue]=L(ee.composers),Ge=typeof ee.type=="function"||ee.type.$$typeof?(Ze=>{function Xe(){for(let Je=0;Je<Xe[T$1].length;Je++){const[tt,rt]=Xe[T$1][Je];Ze.rules[tt].apply(rt)}return Xe[T$1]=[],null}return Xe[T$1]=[],Xe.rules={},W.forEach(Je=>Xe.rules[Je]={apply:tt=>Xe[T$1].push([Je,tt])}),Xe})(ue):null,qe=(Ge||ue).rules,Ke=`.${pe}${_e.length>1?`:where(.${_e.slice(1).join(".")})`:""}`,Ye=Ze=>{Ze=typeof Ze=="object"&&Ze||A$1;const{css:Xe,...Je}=Ze,tt={};for(const it in Ne)if(delete Je[it],it in Ze){let nt=Ze[it];typeof nt=="object"&&nt?tt[it]={"@initial":Ne[it],...nt}:(nt=String(nt),tt[it]=nt!=="undefined"||Ue.has(it)?nt:Ne[it])}else tt[it]=Ne[it];const rt=new Set([..._e]);for(const[it,nt,st,lt]of ee.composers){ue.rules.styled.cache.has(it)||(ue.rules.styled.cache.add(it),$(nt,[`.${it}`],[],fe,Nr=>{qe.styled.apply(Nr)}));const _r=O$1(st,tt,fe.media),jr=O$1(lt,tt,fe.media,!0);for(const Nr of _r)if(Nr!==void 0)for(const[Wr,ri,Xr]of Nr){const Gr=`${it}-${z$1(ri)}-${Wr}`;rt.add(Gr);const qr=(Xr?ue.rules.resonevar:ue.rules.onevar).cache,si=Xr?qe.resonevar:qe.onevar;qr.has(Gr)||(qr.add(Gr),$(ri,[`.${Gr}`],[],fe,oi=>{si.apply(oi)}))}for(const Nr of jr)if(Nr!==void 0)for(const[Wr,ri]of Nr){const Xr=`${it}-${z$1(ri)}-${Wr}`;rt.add(Xr),ue.rules.allvar.cache.has(Xr)||(ue.rules.allvar.cache.add(Xr),$(ri,[`.${Xr}`],[],fe,Gr=>{qe.allvar.apply(Gr)}))}}if(typeof Xe=="object"&&Xe){const it=`${pe}-i${z$1(Xe)}-css`;rt.add(it),ue.rules.inline.cache.has(it)||(ue.rules.inline.cache.add(it),$(Xe,[`.${it}`],[],fe,nt=>{qe.inline.apply(nt)}))}for(const it of String(Ze.className||"").trim().split(/\s+/))it&&rt.add(it);const et=Je.className=[...rt].join(" ");return{type:ee.type,className:et,selector:Ke,props:Je,toString:()=>et,deferredInjector:Ge}};return s(Ye,{className:pe,selector:Ke,[l]:ee,toString:()=>(ue.rules.styled.cache.has(pe)||Ye(),pe)})},L=fe=>{let ee="";const ue=[],pe={},_e=[];for(const[Ne,,,,Ue,Ge]of fe){ee===""&&(ee=Ne),ue.push(Ne),_e.push(...Ge);for(const qe in Ue){const Ke=Ue[qe];(pe[qe]===void 0||Ke!=="undefined"||Ge.includes(Ke))&&(pe[qe]=Ke)}}return[ee,ue,pe,new Set(_e)]},O$1=(fe,ee,ue,pe)=>{const _e=[];e:for(let[Ne,Ue,Ge]of fe){if(Ge)continue;let qe,Ke=0,Ye=!1;for(qe in Ne){const Ze=Ne[qe];let Xe=ee[qe];if(Xe!==Ze){if(typeof Xe!="object"||!Xe)continue e;{let Je,tt,rt=0;for(const et in Xe){if(Ze===String(Xe[et])){if(et!=="@initial"){const it=et.slice(1);(tt=tt||[]).push(it in ue?ue[it]:et.replace(/^@media ?/,"")),Ye=!0}Ke+=rt,Je=!0}++rt}if(tt&&tt.length&&(Ue={["@media "+tt.join(", ")]:Ue}),!Je)continue e}}}(_e[Ke]=_e[Ke]||[]).push([pe?"cv":`${qe}-${Ne[qe]}`,Ue,Ye])}return _e},A$1={},N$1=o(),D=(fe,ee)=>N$1(fe,()=>(...ue)=>{const pe=()=>{for(let _e of ue){_e=typeof _e=="object"&&_e||{};let Ne=z$1(_e);if(!ee.rules.global.cache.has(Ne)){if(ee.rules.global.cache.add(Ne),"@import"in _e){let Ue=[].indexOf.call(ee.sheet.cssRules,ee.rules.themed.group)-1;for(let Ge of[].concat(_e["@import"]))Ge=Ge.includes('"')||Ge.includes("'")?Ge:`"${Ge}"`,ee.sheet.insertRule(`@import ${Ge};`,Ue++);delete _e["@import"]}$(_e,[],[],fe,Ue=>{ee.rules.global.apply(Ue)})}}return""};return s(pe,{toString:pe})}),H$1=o(),V$1=(fe,ee)=>H$1(fe,()=>ue=>{const pe=`${S$1(fe.prefix)}k-${z$1(ue)}`,_e=()=>{if(!ee.rules.global.cache.has(pe)){ee.rules.global.cache.add(pe);const Ne=[];$(ue,[],[],fe,Ge=>Ne.push(Ge));const Ue=`@keyframes ${pe}{${Ne.join("")}}`;ee.rules.global.apply(Ue)}return pe};return s(_e,{get name(){return _e()},toString:_e})}),G$1=class{constructor(ee,ue,pe,_e){this.token=ee==null?"":String(ee),this.value=ue==null?"":String(ue),this.scale=pe==null?"":String(pe),this.prefix=_e==null?"":String(_e)}get computedValue(){return"var("+this.variable+")"}get variable(){return"--"+S$1(this.prefix)+S$1(this.scale)+this.token}toString(){return this.computedValue}},F=o(),J$1=(fe,ee)=>F(fe,()=>(ue,pe)=>{pe=typeof ue=="object"&&ue||Object(pe);const _e=`.${ue=(ue=typeof ue=="string"?ue:"")||`${S$1(fe.prefix)}t-${z$1(pe)}`}`,Ne={},Ue=[];for(const qe in pe){Ne[qe]={};for(const Ke in pe[qe]){const Ye=`--${S$1(fe.prefix)}${qe}-${Ke}`,Ze=k$1(String(pe[qe][Ke]),fe.prefix,qe);Ne[qe][Ke]=new G$1(Ke,Ze,qe,fe.prefix),Ue.push(`${Ye}:${Ze}`)}}const Ge=()=>{if(Ue.length&&!ee.rules.themed.cache.has(ue)){ee.rules.themed.cache.add(ue);const qe=`${pe===fe.theme?":root,":""}.${ue}{${Ue.join(";")}}`;ee.rules.themed.apply(qe)}return ue};return{...Ne,get className(){return Ge()},selector:_e,toString:Ge}}),U$1=o(),X,Y$1=o(),q$1=fe=>{const ee=(ue=>{let pe=!1;const _e=U$1(ue,Ne=>{pe=!0;const Ue="prefix"in(Ne=typeof Ne=="object"&&Ne||{})?String(Ne.prefix):"",Ge=typeof Ne.media=="object"&&Ne.media||{},qe=typeof Ne.root=="object"?Ne.root||null:globalThis.document||null,Ke=typeof Ne.theme=="object"&&Ne.theme||{},Ye={prefix:Ue,media:Ge,theme:Ke,themeMap:typeof Ne.themeMap=="object"&&Ne.themeMap||{...n},utils:typeof Ne.utils=="object"&&Ne.utils||{}},Ze=E(qe),Xe={css:M(Ye,Ze),globalCss:D(Ye,Ze),keyframes:V$1(Ye,Ze),createTheme:J$1(Ye,Ze),reset(){Ze.reset(),Xe.theme.toString()},theme:{},sheet:Ze,config:Ye,prefix:Ue,getCssText:Ze.toString,toString:Ze.toString};return String(Xe.theme=Xe.createTheme(Ke)),Xe});return pe||_e.reset(),_e})(fe);return ee.styled=(({config:ue,sheet:pe})=>Y$1(ue,()=>{const _e=M(ue,pe);return(...Ne)=>{const Ue=_e(...Ne),Ge=Ue[l].type,qe=e$1.forwardRef((Ke,Ye)=>{const Ze=Ke&&Ke.as||Ge,{props:Xe,deferredInjector:Je}=Ue(Ke);return delete Xe.as,Xe.ref=Ye,Je?e$1.createElement(e$1.Fragment,null,e$1.createElement(Ze,Xe),e$1.createElement(Je,null)):e$1.createElement(Ze,Xe)});return qe.className=Ue.className,qe.displayName=`Styled.${Ge.displayName||Ge.name||Ge}`,qe.selector=Ue.selector,qe.toString=()=>Ue.selector,qe[l]=Ue[l],qe}}))(ee),ee},K$1=()=>X||(X=q$1()),Q$1=(...fe)=>K$1().createTheme(...fe);function $e02a7d9cb1dc128c$export$c74125a8e3af6bb2(fe){const ee=fe+"CollectionProvider",[ue,pe]=$c512c27ab02ef895$export$50c7b4e9d9f19c1(ee),[_e,Ne]=ue(ee,{collectionRef:{current:null},itemMap:new Map}),Ue=Je=>{const{scope:tt,children:rt}=Je,et=e$1.useRef(null),it=e$1.useRef(new Map).current;return e$1.createElement(_e,{scope:tt,itemMap:it,collectionRef:et},rt)},Ge=fe+"CollectionSlot",qe=e$1.forwardRef((Je,tt)=>{const{scope:rt,children:et}=Je,it=Ne(Ge,rt),nt=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(tt,it.collectionRef);return e$1.createElement($5e63c961fc1ce211$export$8c6ed5c666ac1360,{ref:nt},et)}),Ke=fe+"CollectionItemSlot",Ye="data-radix-collection-item",Ze=e$1.forwardRef((Je,tt)=>{const{scope:rt,children:et,...it}=Je,nt=e$1.useRef(null),st=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(tt,nt),lt=Ne(Ke,rt);return e$1.useEffect(()=>(lt.itemMap.set(nt,{ref:nt,...it}),()=>void lt.itemMap.delete(nt))),e$1.createElement($5e63c961fc1ce211$export$8c6ed5c666ac1360,{[Ye]:"",ref:st},et)});function Xe(Je){const tt=Ne(fe+"CollectionConsumer",Je);return e$1.useCallback(()=>{const et=tt.collectionRef.current;if(!et)return[];const it=Array.from(et.querySelectorAll(`[${Ye}]`));return Array.from(tt.itemMap.values()).sort((lt,_r)=>it.indexOf(lt.ref.current)-it.indexOf(_r.ref.current))},[tt.collectionRef,tt.itemMap])}return[{Provider:Ue,Slot:qe,ItemSlot:Ze},Xe,pe]}const $f631663db3294ace$var$DirectionContext=reactExports.createContext(void 0);function $f631663db3294ace$export$b39126d51d94e6f3(fe){const ee=reactExports.useContext($f631663db3294ace$var$DirectionContext);return fe||ee||"ltr"}const $d7bdfb9eb0fdf311$var$ENTRY_FOCUS="rovingFocusGroup.onEntryFocus",$d7bdfb9eb0fdf311$var$EVENT_OPTIONS={bubbles:!1,cancelable:!0},$d7bdfb9eb0fdf311$var$GROUP_NAME="RovingFocusGroup",[$d7bdfb9eb0fdf311$var$Collection,$d7bdfb9eb0fdf311$var$useCollection,$d7bdfb9eb0fdf311$var$createCollectionScope]=$e02a7d9cb1dc128c$export$c74125a8e3af6bb2($d7bdfb9eb0fdf311$var$GROUP_NAME),[$d7bdfb9eb0fdf311$var$createRovingFocusGroupContext,$d7bdfb9eb0fdf311$export$c7109489551a4f4]=$c512c27ab02ef895$export$50c7b4e9d9f19c1($d7bdfb9eb0fdf311$var$GROUP_NAME,[$d7bdfb9eb0fdf311$var$createCollectionScope]),[$d7bdfb9eb0fdf311$var$RovingFocusProvider,$d7bdfb9eb0fdf311$var$useRovingFocusContext]=$d7bdfb9eb0fdf311$var$createRovingFocusGroupContext($d7bdfb9eb0fdf311$var$GROUP_NAME),$d7bdfb9eb0fdf311$export$8699f7c8af148338=reactExports.forwardRef((fe,ee)=>reactExports.createElement($d7bdfb9eb0fdf311$var$Collection.Provider,{scope:fe.__scopeRovingFocusGroup},reactExports.createElement($d7bdfb9eb0fdf311$var$Collection.Slot,{scope:fe.__scopeRovingFocusGroup},reactExports.createElement($d7bdfb9eb0fdf311$var$RovingFocusGroupImpl,_extends$1({},fe,{ref:ee}))))),$d7bdfb9eb0fdf311$var$RovingFocusGroupImpl=reactExports.forwardRef((fe,ee)=>{const{__scopeRovingFocusGroup:ue,orientation:pe,loop:_e=!1,dir:Ne,currentTabStopId:Ue,defaultCurrentTabStopId:Ge,onCurrentTabStopIdChange:qe,onEntryFocus:Ke,...Ye}=fe,Ze=reactExports.useRef(null),Xe=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(ee,Ze),Je=$f631663db3294ace$export$b39126d51d94e6f3(Ne),[tt=null,rt]=$71cd76cc60e0454e$export$6f32135080cb4c3({prop:Ue,defaultProp:Ge,onChange:qe}),[et,it]=reactExports.useState(!1),nt=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(Ke),st=$d7bdfb9eb0fdf311$var$useCollection(ue),lt=reactExports.useRef(!1),[_r,jr]=reactExports.useState(0);return reactExports.useEffect(()=>{const Nr=Ze.current;if(Nr)return Nr.addEventListener($d7bdfb9eb0fdf311$var$ENTRY_FOCUS,nt),()=>Nr.removeEventListener($d7bdfb9eb0fdf311$var$ENTRY_FOCUS,nt)},[nt]),reactExports.createElement($d7bdfb9eb0fdf311$var$RovingFocusProvider,{scope:ue,orientation:pe,dir:Je,loop:_e,currentTabStopId:tt,onItemFocus:reactExports.useCallback(Nr=>rt(Nr),[rt]),onItemShiftTab:reactExports.useCallback(()=>it(!0),[]),onFocusableItemAdd:reactExports.useCallback(()=>jr(Nr=>Nr+1),[]),onFocusableItemRemove:reactExports.useCallback(()=>jr(Nr=>Nr-1),[])},reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({tabIndex:et||_r===0?-1:0,"data-orientation":pe},Ye,{ref:Xe,style:{outline:"none",...fe.style},onMouseDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(fe.onMouseDown,()=>{lt.current=!0}),onFocus:$e42e1063c40fb3ef$export$b9ecd428b558ff10(fe.onFocus,Nr=>{const Wr=!lt.current;if(Nr.target===Nr.currentTarget&&Wr&&!et){const ri=new CustomEvent($d7bdfb9eb0fdf311$var$ENTRY_FOCUS,$d7bdfb9eb0fdf311$var$EVENT_OPTIONS);if(Nr.currentTarget.dispatchEvent(ri),!ri.defaultPrevented){const Xr=st().filter(Yr=>Yr.focusable),Gr=Xr.find(Yr=>Yr.active),qr=Xr.find(Yr=>Yr.id===tt),oi=[Gr,qr,...Xr].filter(Boolean).map(Yr=>Yr.ref.current);$d7bdfb9eb0fdf311$var$focusFirst(oi)}}lt.current=!1}),onBlur:$e42e1063c40fb3ef$export$b9ecd428b558ff10(fe.onBlur,()=>it(!1))})))}),$d7bdfb9eb0fdf311$var$ITEM_NAME="RovingFocusGroupItem",$d7bdfb9eb0fdf311$export$ab9df7c53fe8454=reactExports.forwardRef((fe,ee)=>{const{__scopeRovingFocusGroup:ue,focusable:pe=!0,active:_e=!1,tabStopId:Ne,...Ue}=fe,Ge=$1746a345f3d73bb7$export$f680877a34711e37(),qe=Ne||Ge,Ke=$d7bdfb9eb0fdf311$var$useRovingFocusContext($d7bdfb9eb0fdf311$var$ITEM_NAME,ue),Ye=Ke.currentTabStopId===qe,Ze=$d7bdfb9eb0fdf311$var$useCollection(ue),{onFocusableItemAdd:Xe,onFocusableItemRemove:Je}=Ke;return reactExports.useEffect(()=>{if(pe)return Xe(),()=>Je()},[pe,Xe,Je]),reactExports.createElement($d7bdfb9eb0fdf311$var$Collection.ItemSlot,{scope:ue,id:qe,focusable:pe,active:_e},reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.span,_extends$1({tabIndex:Ye?0:-1,"data-orientation":Ke.orientation},Ue,{ref:ee,onMouseDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(fe.onMouseDown,tt=>{pe?Ke.onItemFocus(qe):tt.preventDefault()}),onFocus:$e42e1063c40fb3ef$export$b9ecd428b558ff10(fe.onFocus,()=>Ke.onItemFocus(qe)),onKeyDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(fe.onKeyDown,tt=>{if(tt.key==="Tab"&&tt.shiftKey){Ke.onItemShiftTab();return}if(tt.target!==tt.currentTarget)return;const rt=$d7bdfb9eb0fdf311$var$getFocusIntent(tt,Ke.orientation,Ke.dir);if(rt!==void 0){tt.preventDefault();let it=Ze().filter(nt=>nt.focusable).map(nt=>nt.ref.current);if(rt==="last")it.reverse();else if(rt==="prev"||rt==="next"){rt==="prev"&&it.reverse();const nt=it.indexOf(tt.currentTarget);it=Ke.loop?$d7bdfb9eb0fdf311$var$wrapArray(it,nt+1):it.slice(nt+1)}setTimeout(()=>$d7bdfb9eb0fdf311$var$focusFirst(it))}})})))}),$d7bdfb9eb0fdf311$var$MAP_KEY_TO_FOCUS_INTENT={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function $d7bdfb9eb0fdf311$var$getDirectionAwareKey(fe,ee){return ee!=="rtl"?fe:fe==="ArrowLeft"?"ArrowRight":fe==="ArrowRight"?"ArrowLeft":fe}function $d7bdfb9eb0fdf311$var$getFocusIntent(fe,ee,ue){const pe=$d7bdfb9eb0fdf311$var$getDirectionAwareKey(fe.key,ue);if(!(ee==="vertical"&&["ArrowLeft","ArrowRight"].includes(pe))&&!(ee==="horizontal"&&["ArrowUp","ArrowDown"].includes(pe)))return $d7bdfb9eb0fdf311$var$MAP_KEY_TO_FOCUS_INTENT[pe]}function $d7bdfb9eb0fdf311$var$focusFirst(fe){const ee=document.activeElement;for(const ue of fe)if(ue===ee||(ue.focus(),document.activeElement!==ee))return}function $d7bdfb9eb0fdf311$var$wrapArray(fe,ee){return fe.map((ue,pe)=>fe[(ee+pe)%fe.length])}const $d7bdfb9eb0fdf311$export$be92b6f5f03c0fe9=$d7bdfb9eb0fdf311$export$8699f7c8af148338,$d7bdfb9eb0fdf311$export$6d08773d2e66f8f2=$d7bdfb9eb0fdf311$export$ab9df7c53fe8454,$69cb30bb0017df05$var$TABS_NAME="Tabs",[$69cb30bb0017df05$var$createTabsContext,$69cb30bb0017df05$export$355f5bd209d7b13a]=$c512c27ab02ef895$export$50c7b4e9d9f19c1($69cb30bb0017df05$var$TABS_NAME,[$d7bdfb9eb0fdf311$export$c7109489551a4f4]),$69cb30bb0017df05$var$useRovingFocusGroupScope=$d7bdfb9eb0fdf311$export$c7109489551a4f4(),[$69cb30bb0017df05$var$TabsProvider,$69cb30bb0017df05$var$useTabsContext]=$69cb30bb0017df05$var$createTabsContext($69cb30bb0017df05$var$TABS_NAME),$69cb30bb0017df05$export$b2539bed5023c21c=reactExports.forwardRef((fe,ee)=>{const{__scopeTabs:ue,value:pe,onValueChange:_e,defaultValue:Ne,orientation:Ue="horizontal",dir:Ge,activationMode:qe="automatic",...Ke}=fe,Ye=$f631663db3294ace$export$b39126d51d94e6f3(Ge),[Ze,Xe]=$71cd76cc60e0454e$export$6f32135080cb4c3({prop:pe,onChange:_e,defaultProp:Ne});return reactExports.createElement($69cb30bb0017df05$var$TabsProvider,{scope:ue,baseId:$1746a345f3d73bb7$export$f680877a34711e37(),value:Ze,onValueChange:Xe,orientation:Ue,dir:Ye,activationMode:qe},reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({dir:Ye,"data-orientation":Ue},Ke,{ref:ee})))}),$69cb30bb0017df05$var$TAB_LIST_NAME="TabsList",$69cb30bb0017df05$export$9712d22edc0d78c1=reactExports.forwardRef((fe,ee)=>{const{__scopeTabs:ue,loop:pe=!0,..._e}=fe,Ne=$69cb30bb0017df05$var$useTabsContext($69cb30bb0017df05$var$TAB_LIST_NAME,ue),Ue=$69cb30bb0017df05$var$useRovingFocusGroupScope(ue);return reactExports.createElement($d7bdfb9eb0fdf311$export$be92b6f5f03c0fe9,_extends$1({asChild:!0},Ue,{orientation:Ne.orientation,dir:Ne.dir,loop:pe}),reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({role:"tablist","aria-orientation":Ne.orientation},_e,{ref:ee})))}),$69cb30bb0017df05$var$TRIGGER_NAME="TabsTrigger",$69cb30bb0017df05$export$8114b9fdfdf9f3ba=reactExports.forwardRef((fe,ee)=>{const{__scopeTabs:ue,value:pe,disabled:_e=!1,...Ne}=fe,Ue=$69cb30bb0017df05$var$useTabsContext($69cb30bb0017df05$var$TRIGGER_NAME,ue),Ge=$69cb30bb0017df05$var$useRovingFocusGroupScope(ue),qe=$69cb30bb0017df05$var$makeTriggerId(Ue.baseId,pe),Ke=$69cb30bb0017df05$var$makeContentId(Ue.baseId,pe),Ye=pe===Ue.value;return reactExports.createElement($d7bdfb9eb0fdf311$export$6d08773d2e66f8f2,_extends$1({asChild:!0},Ge,{focusable:!_e,active:Ye}),reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.button,_extends$1({type:"button",role:"tab","aria-selected":Ye,"aria-controls":Ke,"data-state":Ye?"active":"inactive","data-disabled":_e?"":void 0,disabled:_e,id:qe},Ne,{ref:ee,onMouseDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(fe.onMouseDown,Ze=>{!_e&&Ze.button===0&&Ze.ctrlKey===!1?Ue.onValueChange(pe):Ze.preventDefault()}),onKeyDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(fe.onKeyDown,Ze=>{[" ","Enter"].includes(Ze.key)&&Ue.onValueChange(pe)}),onFocus:$e42e1063c40fb3ef$export$b9ecd428b558ff10(fe.onFocus,()=>{const Ze=Ue.activationMode!=="manual";!Ye&&!_e&&Ze&&Ue.onValueChange(pe)})})))}),$69cb30bb0017df05$var$CONTENT_NAME="TabsContent",$69cb30bb0017df05$export$bd905d70e8fd2ebb=reactExports.forwardRef((fe,ee)=>{const{__scopeTabs:ue,value:pe,forceMount:_e,children:Ne,...Ue}=fe,Ge=$69cb30bb0017df05$var$useTabsContext($69cb30bb0017df05$var$CONTENT_NAME,ue),qe=$69cb30bb0017df05$var$makeTriggerId(Ge.baseId,pe),Ke=$69cb30bb0017df05$var$makeContentId(Ge.baseId,pe),Ye=pe===Ge.value,Ze=reactExports.useRef(Ye);return reactExports.useEffect(()=>{const Xe=requestAnimationFrame(()=>Ze.current=!1);return()=>cancelAnimationFrame(Xe)},[]),reactExports.createElement($921a889cee6df7e8$export$99c2b779aa4e8b8b,{present:_e||Ye},({present:Xe})=>reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({"data-state":Ye?"active":"inactive","data-orientation":Ge.orientation,role:"tabpanel","aria-labelledby":qe,hidden:!Xe,id:Ke,tabIndex:0},Ue,{ref:ee,style:{...fe.style,animationDuration:Ze.current?"0s":void 0}}),Xe&&Ne))});function $69cb30bb0017df05$var$makeTriggerId(fe,ee){return`${fe}-trigger-${ee}`}function $69cb30bb0017df05$var$makeContentId(fe,ee){return`${fe}-content-${ee}`}const $69cb30bb0017df05$export$be92b6f5f03c0fe9=$69cb30bb0017df05$export$b2539bed5023c21c,$69cb30bb0017df05$export$54c2e3dc7acea9f5=$69cb30bb0017df05$export$9712d22edc0d78c1,$69cb30bb0017df05$export$41fb9f06171c75f4=$69cb30bb0017df05$export$8114b9fdfdf9f3ba,$69cb30bb0017df05$export$7c6e2c02157bb7d2=$69cb30bb0017df05$export$bd905d70e8fd2ebb;var lib$5={},Parser$3={},Tokenizer={},decode={},decodeDataHtml={};Object.defineProperty(decodeDataHtml,"__esModule",{value:!0});decodeDataHtml.default=new Uint16Array('<\0\0\0\0\0\0EMabcfglmnoprstu\\bfmsligP&cutereve;iyx}rc;r;ravepha;acr;d;gpon;f;plyFunction;ingcsr;ign;ildemlaceforsucrkslash;;ed;y;crtause;noullis;a;r;pf;eve;cmpeq;HOacdefhilorsucy;PYcpyute;;italDifferentialD;leys;aeioron;dilrc;nint;ot;dnilla;terDot;i;rcleDMPTot;inus;lus;imes;ocskwiseContourIntegral;eCurlyDQoubleQuote;uote;lnpuon;e;gitruent;nt;ourIntegral;fr;oduct;nterClockwiseContourIntegral;oss;cr;p;Cap;DJSZacefios;otrahd;cy;cy;cy;grsger;r;hv;ayron;;l;ta;r;afcmriticalADGTcute;o;bleAcute;rave;ilde;ond;ferentialD;\0\0\0\0f;;DEot;qual;bleCDLRUVontourIntegrao\0\0nArrow;eoftARTrrow;ightArrow;engLReftARrrow;ightArrow;ightArrow;ightATrrow;ee;p\0\0rrow;ownArrow;erticalBar;nABLRTarrow;BUar;pArrow;reve;eft\0\0ightVector;eeVector;ector;Bar;ight\0eeVector;ector;Bar;ee;Arrow;ctr;rok;NTacdfglmopqstuxG;Hcuteaiyron;rc;ot;r;raveement;apcr;ty\0\0mallSquare;erySmallSquare;gpon;f;silon;uail;Tilde;librium;cir;m;a;mlipsts;onentialE;cfiosy;r;lled\0\0mallSquare;erySmallSquare;\0\0\0f;All;riertrf;cJTabcdfgorstcy;>mma;d;reve;eiydil;rc;;ot;r;;pf;eaterEFGLSTqual;Less;ullEqual;reater;ess;lantEqual;ilde;cr;;AacfiosuRDcy;ctek;;irc;r;lbertSpace;\0f;izontalLine;ctrok;mpownHumqual;EJOacdfgmnostucy;lig;cy;cuteiyrc;ot;r;rave;apcgr;inaryI;lie\0;egrral;section;isibleCTomma;imes;gpton;f;a;cr;ilde;\0cy;lcfosuiyrc;;r;pf;\0r;rcy;kcy;HJacfoscy;cy;ppa;eydil;;r;pf;cr;JTaceflmostcy;<cmnprute;bda;g;lacetrf;r;aeyron;dil;;fstACDFRTUVarnrgleBracket;row;BRar;ightArrow;eiling;o\0bleBracket;n\0eeVector;ector;Bar;loor;ightAVrrow;ector;ere;AVrrow;ector;iangle;BEar;qual;pDTVownVector;eeVector;ector;Bar;ector;Bar;ightsEFGLSTqualGreater;ullEqual;reater;ess;lantEqual;ilde;r;;eftarrow;idot;npwgLRlreftARrrow;ightArrow;ightArrow;eftarightightf;erLReftArrow;ightArrow;cht;rok;;acefiosup;y;dliumSpace;lintrf;r;nusPlus;pf;c;Jacefostucy;cute;aeyron;dil;;gswativeMTVediumSpace;hicneryThitedGLreaterGreateessLesLine;r;Bnptreak;BreakingSpace;f;;CDEGHLNPRSTVoungruent;pCap;oubleVerticalBar;lqxement;ual;Tilde;ists;reater;EFGLSTqual;ullEqual;reater;ess;lantEqual;ilde;umpownHump;qual;efstTriangle;BEar;qual;s;EGLSTqual;reater;ess;lantEqual;ilde;estedGLreaterGreater;essLess;recedes;ESqual;lantEqual;eiverseElement;ghtTriangle;BEar;qual;quuareSubpset;Equal;erset;Equal;bcpset;Equal;ceeds;ESTqual;lantEqual;ilde;erset;Equal;ilde;EFTqual;ullEqual;ilde;erticalBar;cr;ilde;Eacdfgmoprstuvlig;cuteiyrc;blac;r;raveaeicr;ga;cron;pf;enCurlyDQoubleQuote;uote;;clr;ashidees;mlerBParr;acek;et;arenthesis;acfhilorsrtialD;y;r;i;;usMinus;ipncareplanf;;eiocedes;ESTqual;lantEqual;ilde;me;dpuct;ortion;al;cir;;UfosOT"r;pf;cr;BEacefhiorsuarr;Gcnrute;g;r;tl;aeyron;dil;;;verseEUlqement;uilibrium;pEquilibrium;ro;ghtACDFTUVanrgleBracket;row;BLar;eftArrow;eiling;o\0bleBracket;n\0eeVector;ector;Bar;loor;ere;AVrrow;ector;iangle;BEar;qual;pDTVownVector;eeVector;ector;Bar;ector;Bar;puf;ndImplies;ightarrow;chr;;leDelayed;HOacfhimoqstuCcHcy;y;FTcy;cute;;aeiyron;dil;rc;;r;ortDLRUownArroweftArrowightArrowpArrow;gma;allCircle;pf;\0\0t;are;ISUntersection;ubpset;Equal;erset;Equal;nion;cr;ar;bcmp;set;Equal;cheeds;ESTqual;lantEqual;ilde;Th;;esrset;Equal;etHRSacfhiorsORNADE;Hccy;y;bu;;aeyron;dil;;r;ei\0efore;a;cnkSpace;Space;lde;EFTqual;ullEqual;ilde;pf;ipleDot;ctr;rok;\0\0\0\0\0\0\0cruter;ocir;r\0y;ve;iyrc;blac;r;raveacr;dierBParr;acek;et;arenthesis;on;Plus;gpon;f;ADETadpsrrow;BDar;ownArrow;ownArrow;quilibrium;ee;Arrow;ownerLReftArrow;ightArrow;i;lon;ing;cr;ilde;mlDbcdefosvash;ar;y;ash;l;er;btyar;;icalBLSTar;ine;eparator;ilde;ThinSpace;r;pf;cr;dash;cefosirc;dge;r;pf;cr;fiosr;;pf;cr;AIUacfosucy;cy;cy;cuteiyrc;;r;pf;cr;ml;Hacdefoscy;cute;ayron;;ot;\0oWidta;r;pf;cr;\0\0\0\0\0\0\0cutereve;;Ediuy;;rcte;lig;r;raveepfpsym;ha;apcclr;g;\0\0;adsvnd;;lope;;;elmrsz;esd;a;;;;;;;;t;vb;d;pth;arr;gpon;f;;Eaeiop;cir;;d;s;rox;eingctyr;;mp;eildemlcioninnt;Nabcdefiklnoprsuot;crkcepsong;psilon;rime;im;eq;ee;ed;gerk;tbrk;oy;quo;cmprtaus;eptyv;snoahw;;een;r;gcostuvwaiurc;pdptot;lus;imes;\0\0cup;ar;riangleduown;p;plus;earow;akocnklstozenge;riangle;dlrown;eft;ight;k;\0\0;;4;ck;eo;q=uiv;t;ptwxf;;tomtie;DHUVbdhmptuvLRlr;;;;;DUdu;;;;LRlr;;;;;HLRhlr;;;;;;ox;LRlr;;;;;DUdu;;;;inus;lus;imes;LRlr;;;;;HLRhlr;;;;;;evbarceior;mi;m;el;bh;sub;l;etp;Ee;;q\0\0\0\0\0\0\0\0\0\0cprute;;abcdsnd;rcup;aup;p;ot;;eot;aeiu\0s;on;dilrc;ps;sm;ot;dmnilptyv;t;err;ceiy;ck;mark;r;Ecefms;;elq;e\0\0rrowlreft;ight;RSacd;st;irc;ash;nint;id;cir;ubs;uit\0on;e;q\0\0a;t;;flemxente\0;dot;nfry;o;sr;aorr;ss;cur;bp;e;;e;dot;delprvwarrlr;;\0\0r;c;arr;p;;bcdosrcap;aup;p;ot;r;;alrvrr;m;yevwq\0\0reuee;edge;enearrowlreftightecioninnt;lcty;AHabcdefhijlorstuwzrar;glrsger;eth;h;varow;aayron;;;aogrr;tseq;glmta;ptyv;irsht;;arlraegsvm;osnd;suit;amma;in;;iode;ontimes;ncy;c\0\0rn;op;lptuwlar;f;;empsq;dot;inus;lus;quare;blebarwedgnadhownarrowarpoonlrefighkaro\0\0rn;op;cotry;;l;rok;drot;i;fahraangle;ciy;grarr;DacdefglmnopqrstuxDoocsuteter;aioyron;r;clon;;ot;Drot;;;rsave;dot;;ilsnters;;;dot;apscr;ty;svetp1;;;gs;p;gpon;f;alsr;sl;us;i;lvon;csuviorc\0\0antgltressaeils;st;v;DD;parsl;Daot;rr;cdir;oah;mrlo;cipl;seoctationential\0\0\0\0\0\0\0llingdotsey;male;ilrlig;\0\0g;ig;;lig;lig;fjaltt;ig;ns;of;\0f;ak;v;artint;aocs\0\0;;;;\0;;\0\0;;5;\0;;8;l;wn;cr;Eabcdefgijlnorstv;l;cmpute;ma;d;reve;iyrc;;ot;;lqs;qslan;cdlc;ot;o;l;;es;r;;gmel;cy;;Eaj;;;Eaes;p;prox;q;qim;pf;cir;m;el;;>;cdlqrci;r;ot;Par;uest;adels\0pror;qlqlesienrtneqq;Aabcefkosyrilmrrsfildrcy;;cwir;;ar;irc;alrrts;uitlip;con;r;sewarow;arow;amoprrr;tht;klreftarrow;ightarrow;f;bar;cltr;asrok;bpull;hen\0\0\0\0\0\0cute;iyrc;cxy;clfr;rave;inoinnt;t;fin;ta;lig;aopcgtr;elpinarh;f;ed;;cfotare;in;tie;do;celpal;grerarhk;rod;cgpty;on;f;a;uestcir;n;Edsv;ot;;v;;ilde;\0cy;lcfmosuiyrc;;r;ath;pf;\0r;rcy;kcy;acfghjosppa;v;eydil;;r;reen;cy;cy;pf;cr;ABEHabcdefghjlmnoprstuvartrail;arr;;g;ar;\0\0\0\0\0\0\0\0\0ute;mptyv;rabda;g;dl;;uor;bfhlpst;fs;s;p;l;im;l;;aeil;;s;abrrr;rk;akcek;;es;ldu;;aeuyron;diil;;cqrsa;uo;rduhar;shar;h;;fgqstahlrtrrow;taarpoonduownpeftarrows;ightahsrrow;sarpoonquigarrohreetimes;;qslan;cdgsc;ot;o;r;;es;adegspproot;qgqgtiilrsht;;;E;rdu;l;lk;cy;;achtrorneard;ri;iodot;ust;acheEaes;p;prox;q;qim;abnoptwznrg;r;rglmreftarightapsto;ightparrowlrefight;aflr;;us;imes;st;;efngear;lt;achmtrornear;d;;ri;achiqtquo;r;m;eg;;buo;r;rok;<;cdhilqrci;r;remes;arr;uest;Piar;;efrdushar;har;enrtneqq;DacdefhilnopsuDot;clprret;;ese;sto;dluowefker;oymma;;ash;asuredangler;o;cdnro;acdsir;otus;bd;u;p;dpels;f;ctr;pos;lmtimap;GLRVabcdefghijlmoprstuvwgt;;veltftarrrow;ightarrow;;;vightarrow;Ddash;ash;bcnptlaute;g;;Eiop;d;s;rour;al;s\0pmp;eaeouy\0;on;dil;ng;dot;p;;ash;;Aadqsxrr;rhrk;;oot;uieiar;ist;sr;Eest;qs;qslani;rAaprrr;ar;;sv;d;cy;AEadestr;rr;r;;fqstarrroightarro;qslan;si;ri;eiptf;;inn;Edv;ot;;;i;v;;aorr;astllel;;lint;;ceu;c;eAaitrrr;cw;;ghtarrowri;echimpqu;ceru;ort\0\0arm;e;qsubpbcp;Ees;et;eq;qc;e;Ees;et;eq;qgilrldeianglelreft;eight;e;m;esro;p;DHadgilrsash;arr;p;ash;et;;>nfin;Aetrr;;;r<ie;Atrr;rie;im;Aanrr;rhrk;;oear;\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0csuteiyr;c;abioslac;v;old;lig;crir;;\0\0\0n;ave;bmar;acitrirr;oss;n;aeicr;ga;cdnron;;pf;aelr;rp;;adiosvr;efmr;ofgof;r;lope;;cloashl;idees;as;mlbar;\0\0\0\0\0\0\0\0\0r;ast;lle\0\0m;;y;rcimptnt;od;il;enk;r;imo;v;mane;;tvchfork;aunckk;h;s;abcdemstcir;ir;ou;;nim;wo;ipuntint;f;nd;Eaceinosu;p;u;c;acenspprourlyeaespprox;qq;im;ime;sEasdfpalslar;ine;urf;;trel;cir;;ncsp;fiopsur;pf;rime;cr;aeoteirnionnt;st;eABHabcdefhilmnoprstuxartrail;arar;cdenqrteu;te;imptyv;g;del;;uor;abcfhlpstwp;;fs;;s;l;im;l;;aiil;o;nalabrrrk;akcek;;es;ldu;;aeuyron;diil;;clqsa;dhar;uo;rh;acgl;ipsnart;ilrsht;;aordu;l;;v;gnshtahlrstrrow;taarpoonduowpeftahrrowarpoonightarrows;quigarrohreetimes;g;ingdotseahmra;oust;achemid;abptnrg;r;raflr;;us;imes;apr;gt;olint;arachqquo;r;buo;rhirremes;i;efltri;luhar;;\0\0\0\0\0\0\0cute;qu;Eaceinpsy;\0;on;u;dil;rc;Eas;p;im;olint;i;ot;be;Aacmstxrr;rhr;oti;war;minnut;r;oacoyrp;hycy;;rt\0\0iaragmma;fv;;deglnprot;;q;E;;E;e;lus;arr;araeitlslsetmhp;parsl;dle;;e;s;flptcy;;b;ar;f;adres;uitcsuaup;s;p;s;ubp;eset;e;eset;e;afrarcemtr;tmiararr;fanighteppsilohsbcmnp;Edemnprs;ot;;dot;ult;Ee;;lus;arr;eiut;enq;qeq;qm;bp;;c;acenspprourlyeaespproqg;123;Edehlmnps;ost;ub;;dot;soul;b;arr;ult;Ee;;lus;eiut;enq;qeq;qm;bp;;Aanrr;rhr;owar;lig\0\0\0\0\0\0\0\0\0\0\0\0get;;raeyron;dil;;lrec;r;eiko\0e4fa;svym;cnkaspproimsasrnes;bd;ar;;eps;bcfot;ir;;ork;rime;aipdadempstngle;dlqrowneft;e;ight;eot;inus;lus;b;ime;ezium;chtry;;cy;rok;ioxheadlreftarroightarrowAHabcdfghlmoprstuwrar;cruter\0y;ve;iyrc;abhrlac;airsht;;raverlrlk;ct\0\0rn;erop;ri;alcr;gpon;f;adhlsuownarpoonlrefighi;hlonparrows;cit\0\0rn;erop;ng;ri;cr;dirot;lde;i;famrlangle;ABDacdeflnoprszrar;v;asnrgrt;eknprstappothinhirop;hiugmbpsetneq;q;setneq;q;hretianglelreftighty;ashelr;bear;q;lip;btar;trsubppf;rotrcur;bpnEenEeigzag;cefoprsirc;dibgar;e;q;erp;r;pf;;eatcr;\0\0\0\0\0\0\0trr;Aarr;Aarrais;dptfl;imAarrcqr;ptracefiosucuyte;iyrc;;nr;cy;pf;cr;cmy;lacdefhioswcute;ayron;;ot;ettra;r;cy;grarr;pf;cr;jn;j;'.split("").map(function(fe){return fe.charCodeAt(0)}));var decodeDataXml={};Object.defineProperty(decodeDataXml,"__esModule",{value:!0});decodeDataXml.default=new Uint16Array("aglq	\x1B\0\0p;os;t;t;uot;".split("").map(function(fe){return fe.charCodeAt(0)}));var decode_codepoint={};(function(fe){var ee;Object.defineProperty(fe,"__esModule",{value:!0}),fe.replaceCodePoint=fe.fromCodePoint=void 0;var ue=new Map([[0,65533],[128,8364],[130,8218],[131,402],[132,8222],[133,8230],[134,8224],[135,8225],[136,710],[137,8240],[138,352],[139,8249],[140,338],[142,381],[145,8216],[146,8217],[147,8220],[148,8221],[149,8226],[150,8211],[151,8212],[152,732],[153,8482],[154,353],[155,8250],[156,339],[158,382],[159,376]]);fe.fromCodePoint=(ee=String.fromCodePoint)!==null&&ee!==void 0?ee:function(Ne){var Ue="";return Ne>65535&&(Ne-=65536,Ue+=String.fromCharCode(Ne>>>10&1023|55296),Ne=56320|Ne&1023),Ue+=String.fromCharCode(Ne),Ue};function pe(Ne){var Ue;return Ne>=55296&&Ne<=57343||Ne>1114111?65533:(Ue=ue.get(Ne))!==null&&Ue!==void 0?Ue:Ne}fe.replaceCodePoint=pe;function _e(Ne){return(0,fe.fromCodePoint)(pe(Ne))}fe.default=_e})(decode_codepoint);(function(fe){var ee=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(Gr,qr,si,oi){oi===void 0&&(oi=si);var Yr=Object.getOwnPropertyDescriptor(qr,si);(!Yr||("get"in Yr?!qr.__esModule:Yr.writable||Yr.configurable))&&(Yr={enumerable:!0,get:function(){return qr[si]}}),Object.defineProperty(Gr,oi,Yr)}:function(Gr,qr,si,oi){oi===void 0&&(oi=si),Gr[oi]=qr[si]}),ue=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(Gr,qr){Object.defineProperty(Gr,"default",{enumerable:!0,value:qr})}:function(Gr,qr){Gr.default=qr}),pe=commonjsGlobal&&commonjsGlobal.__importStar||function(Gr){if(Gr&&Gr.__esModule)return Gr;var qr={};if(Gr!=null)for(var si in Gr)si!=="default"&&Object.prototype.hasOwnProperty.call(Gr,si)&&ee(qr,Gr,si);return ue(qr,Gr),qr},_e=commonjsGlobal&&commonjsGlobal.__importDefault||function(Gr){return Gr&&Gr.__esModule?Gr:{default:Gr}};Object.defineProperty(fe,"__esModule",{value:!0}),fe.decodeXML=fe.decodeHTMLStrict=fe.decodeHTMLAttribute=fe.decodeHTML=fe.determineBranch=fe.EntityDecoder=fe.DecodingMode=fe.BinTrieFlags=fe.fromCodePoint=fe.replaceCodePoint=fe.decodeCodePoint=fe.xmlDecodeTree=fe.htmlDecodeTree=void 0;var Ne=_e(decodeDataHtml);fe.htmlDecodeTree=Ne.default;var Ue=_e(decodeDataXml);fe.xmlDecodeTree=Ue.default;var Ge=pe(decode_codepoint);fe.decodeCodePoint=Ge.default;var qe=decode_codepoint;Object.defineProperty(fe,"replaceCodePoint",{enumerable:!0,get:function(){return qe.replaceCodePoint}}),Object.defineProperty(fe,"fromCodePoint",{enumerable:!0,get:function(){return qe.fromCodePoint}});var Ke;(function(Gr){Gr[Gr.NUM=35]="NUM",Gr[Gr.SEMI=59]="SEMI",Gr[Gr.EQUALS=61]="EQUALS",Gr[Gr.ZERO=48]="ZERO",Gr[Gr.NINE=57]="NINE",Gr[Gr.LOWER_A=97]="LOWER_A",Gr[Gr.LOWER_F=102]="LOWER_F",Gr[Gr.LOWER_X=120]="LOWER_X",Gr[Gr.LOWER_Z=122]="LOWER_Z",Gr[Gr.UPPER_A=65]="UPPER_A",Gr[Gr.UPPER_F=70]="UPPER_F",Gr[Gr.UPPER_Z=90]="UPPER_Z"})(Ke||(Ke={}));var Ye=32,Ze;(function(Gr){Gr[Gr.VALUE_LENGTH=49152]="VALUE_LENGTH",Gr[Gr.BRANCH_LENGTH=16256]="BRANCH_LENGTH",Gr[Gr.JUMP_TABLE=127]="JUMP_TABLE"})(Ze=fe.BinTrieFlags||(fe.BinTrieFlags={}));function Xe(Gr){return Gr>=Ke.ZERO&&Gr<=Ke.NINE}function Je(Gr){return Gr>=Ke.UPPER_A&&Gr<=Ke.UPPER_F||Gr>=Ke.LOWER_A&&Gr<=Ke.LOWER_F}function tt(Gr){return Gr>=Ke.UPPER_A&&Gr<=Ke.UPPER_Z||Gr>=Ke.LOWER_A&&Gr<=Ke.LOWER_Z||Xe(Gr)}function rt(Gr){return Gr===Ke.EQUALS||tt(Gr)}var et;(function(Gr){Gr[Gr.EntityStart=0]="EntityStart",Gr[Gr.NumericStart=1]="NumericStart",Gr[Gr.NumericDecimal=2]="NumericDecimal",Gr[Gr.NumericHex=3]="NumericHex",Gr[Gr.NamedEntity=4]="NamedEntity"})(et||(et={}));var it;(function(Gr){Gr[Gr.Legacy=0]="Legacy",Gr[Gr.Strict=1]="Strict",Gr[Gr.Attribute=2]="Attribute"})(it=fe.DecodingMode||(fe.DecodingMode={}));var nt=function(){function Gr(qr,si,oi){this.decodeTree=qr,this.emitCodePoint=si,this.errors=oi,this.state=et.EntityStart,this.consumed=1,this.result=0,this.treeIndex=0,this.excess=1,this.decodeMode=it.Strict}return Gr.prototype.startEntity=function(qr){this.decodeMode=qr,this.state=et.EntityStart,this.result=0,this.treeIndex=0,this.excess=1,this.consumed=1},Gr.prototype.write=function(qr,si){switch(this.state){case et.EntityStart:return qr.charCodeAt(si)===Ke.NUM?(this.state=et.NumericStart,this.consumed+=1,this.stateNumericStart(qr,si+1)):(this.state=et.NamedEntity,this.stateNamedEntity(qr,si));case et.NumericStart:return this.stateNumericStart(qr,si);case et.NumericDecimal:return this.stateNumericDecimal(qr,si);case et.NumericHex:return this.stateNumericHex(qr,si);case et.NamedEntity:return this.stateNamedEntity(qr,si)}},Gr.prototype.stateNumericStart=function(qr,si){return si>=qr.length?-1:(qr.charCodeAt(si)|Ye)===Ke.LOWER_X?(this.state=et.NumericHex,this.consumed+=1,this.stateNumericHex(qr,si+1)):(this.state=et.NumericDecimal,this.stateNumericDecimal(qr,si))},Gr.prototype.addToNumericResult=function(qr,si,oi,Yr){if(si!==oi){var ii=oi-si;this.result=this.result*Math.pow(Yr,ii)+parseInt(qr.substr(si,ii),Yr),this.consumed+=ii}},Gr.prototype.stateNumericHex=function(qr,si){for(var oi=si;si<qr.length;){var Yr=qr.charCodeAt(si);if(Xe(Yr)||Je(Yr))si+=1;else return this.addToNumericResult(qr,oi,si,16),this.emitNumericEntity(Yr,3)}return this.addToNumericResult(qr,oi,si,16),-1},Gr.prototype.stateNumericDecimal=function(qr,si){for(var oi=si;si<qr.length;){var Yr=qr.charCodeAt(si);if(Xe(Yr))si+=1;else return this.addToNumericResult(qr,oi,si,10),this.emitNumericEntity(Yr,2)}return this.addToNumericResult(qr,oi,si,10),-1},Gr.prototype.emitNumericEntity=function(qr,si){var oi;if(this.consumed<=si)return(oi=this.errors)===null||oi===void 0||oi.absenceOfDigitsInNumericCharacterReference(this.consumed),0;if(qr===Ke.SEMI)this.consumed+=1;else if(this.decodeMode===it.Strict)return 0;return this.emitCodePoint((0,Ge.replaceCodePoint)(this.result),this.consumed),this.errors&&(qr!==Ke.SEMI&&this.errors.missingSemicolonAfterCharacterReference(),this.errors.validateNumericCharacterReference(this.result)),this.consumed},Gr.prototype.stateNamedEntity=function(qr,si){for(var oi=this.decodeTree,Yr=oi[this.treeIndex],ii=(Yr&Ze.VALUE_LENGTH)>>14;si<qr.length;si++,this.excess++){var ti=qr.charCodeAt(si);if(this.treeIndex=lt(oi,Yr,this.treeIndex+Math.max(1,ii),ti),this.treeIndex<0)return this.result===0||this.decodeMode===it.Attribute&&(ii===0||rt(ti))?0:this.emitNotTerminatedNamedEntity();if(Yr=oi[this.treeIndex],ii=(Yr&Ze.VALUE_LENGTH)>>14,ii!==0){if(ti===Ke.SEMI)return this.emitNamedEntityData(this.treeIndex,ii,this.consumed+this.excess);this.decodeMode!==it.Strict&&(this.result=this.treeIndex,this.consumed+=this.excess,this.excess=0)}}return-1},Gr.prototype.emitNotTerminatedNamedEntity=function(){var qr,si=this,oi=si.result,Yr=si.decodeTree,ii=(Yr[oi]&Ze.VALUE_LENGTH)>>14;return this.emitNamedEntityData(oi,ii,this.consumed),(qr=this.errors)===null||qr===void 0||qr.missingSemicolonAfterCharacterReference(),this.consumed},Gr.prototype.emitNamedEntityData=function(qr,si,oi){var Yr=this.decodeTree;return this.emitCodePoint(si===1?Yr[qr]&~Ze.VALUE_LENGTH:Yr[qr+1],oi),si===3&&this.emitCodePoint(Yr[qr+2],oi),oi},Gr.prototype.end=function(){var qr;switch(this.state){case et.NamedEntity:return this.result!==0&&(this.decodeMode!==it.Attribute||this.result===this.treeIndex)?this.emitNotTerminatedNamedEntity():0;case et.NumericDecimal:return this.emitNumericEntity(0,2);case et.NumericHex:return this.emitNumericEntity(0,3);case et.NumericStart:return(qr=this.errors)===null||qr===void 0||qr.absenceOfDigitsInNumericCharacterReference(this.consumed),0;case et.EntityStart:return 0}},Gr}();fe.EntityDecoder=nt;function st(Gr){var qr="",si=new nt(Gr,function(oi){return qr+=(0,Ge.fromCodePoint)(oi)});return function(Yr,ii){for(var ti=0,ni=0;(ni=Yr.indexOf("&",ni))>=0;){qr+=Yr.slice(ti,ni),si.startEntity(ii);var ui=si.write(Yr,ni+1);if(ui<0){ti=ni+si.end();break}ti=ni+ui,ni=ui===0?ti+1:ti}var yi=qr+Yr.slice(ti);return qr="",yi}}function lt(Gr,qr,si,oi){var Yr=(qr&Ze.BRANCH_LENGTH)>>7,ii=qr&Ze.JUMP_TABLE;if(Yr===0)return ii!==0&&oi===ii?si:-1;if(ii){var ti=oi-ii;return ti<0||ti>=Yr?-1:Gr[si+ti]-1}for(var ni=si,ui=ni+Yr-1;ni<=ui;){var yi=ni+ui>>>1,hi=Gr[yi];if(hi<oi)ni=yi+1;else if(hi>oi)ui=yi-1;else return Gr[yi+Yr]}return-1}fe.determineBranch=lt;var _r=st(Ne.default),jr=st(Ue.default);function Nr(Gr,qr){return qr===void 0&&(qr=it.Legacy),_r(Gr,qr)}fe.decodeHTML=Nr;function Wr(Gr){return _r(Gr,it.Attribute)}fe.decodeHTMLAttribute=Wr;function ri(Gr){return _r(Gr,it.Strict)}fe.decodeHTMLStrict=ri;function Xr(Gr){return jr(Gr,it.Strict)}fe.decodeXML=Xr})(decode);(function(fe){Object.defineProperty(fe,"__esModule",{value:!0}),fe.QuoteType=void 0;var ee=decode,ue;(function(Xe){Xe[Xe.Tab=9]="Tab",Xe[Xe.NewLine=10]="NewLine",Xe[Xe.FormFeed=12]="FormFeed",Xe[Xe.CarriageReturn=13]="CarriageReturn",Xe[Xe.Space=32]="Space",Xe[Xe.ExclamationMark=33]="ExclamationMark",Xe[Xe.Number=35]="Number",Xe[Xe.Amp=38]="Amp",Xe[Xe.SingleQuote=39]="SingleQuote",Xe[Xe.DoubleQuote=34]="DoubleQuote",Xe[Xe.Dash=45]="Dash",Xe[Xe.Slash=47]="Slash",Xe[Xe.Zero=48]="Zero",Xe[Xe.Nine=57]="Nine",Xe[Xe.Semi=59]="Semi",Xe[Xe.Lt=60]="Lt",Xe[Xe.Eq=61]="Eq",Xe[Xe.Gt=62]="Gt",Xe[Xe.Questionmark=63]="Questionmark",Xe[Xe.UpperA=65]="UpperA",Xe[Xe.LowerA=97]="LowerA",Xe[Xe.UpperF=70]="UpperF",Xe[Xe.LowerF=102]="LowerF",Xe[Xe.UpperZ=90]="UpperZ",Xe[Xe.LowerZ=122]="LowerZ",Xe[Xe.LowerX=120]="LowerX",Xe[Xe.OpeningSquareBracket=91]="OpeningSquareBracket"})(ue||(ue={}));var pe;(function(Xe){Xe[Xe.Text=1]="Text",Xe[Xe.BeforeTagName=2]="BeforeTagName",Xe[Xe.InTagName=3]="InTagName",Xe[Xe.InSelfClosingTag=4]="InSelfClosingTag",Xe[Xe.BeforeClosingTagName=5]="BeforeClosingTagName",Xe[Xe.InClosingTagName=6]="InClosingTagName",Xe[Xe.AfterClosingTagName=7]="AfterClosingTagName",Xe[Xe.BeforeAttributeName=8]="BeforeAttributeName",Xe[Xe.InAttributeName=9]="InAttributeName",Xe[Xe.AfterAttributeName=10]="AfterAttributeName",Xe[Xe.BeforeAttributeValue=11]="BeforeAttributeValue",Xe[Xe.InAttributeValueDq=12]="InAttributeValueDq",Xe[Xe.InAttributeValueSq=13]="InAttributeValueSq",Xe[Xe.InAttributeValueNq=14]="InAttributeValueNq",Xe[Xe.BeforeDeclaration=15]="BeforeDeclaration",Xe[Xe.InDeclaration=16]="InDeclaration",Xe[Xe.InProcessingInstruction=17]="InProcessingInstruction",Xe[Xe.BeforeComment=18]="BeforeComment",Xe[Xe.CDATASequence=19]="CDATASequence",Xe[Xe.InSpecialComment=20]="InSpecialComment",Xe[Xe.InCommentLike=21]="InCommentLike",Xe[Xe.BeforeSpecialS=22]="BeforeSpecialS",Xe[Xe.SpecialStartSequence=23]="SpecialStartSequence",Xe[Xe.InSpecialTag=24]="InSpecialTag",Xe[Xe.BeforeEntity=25]="BeforeEntity",Xe[Xe.BeforeNumericEntity=26]="BeforeNumericEntity",Xe[Xe.InNamedEntity=27]="InNamedEntity",Xe[Xe.InNumericEntity=28]="InNumericEntity",Xe[Xe.InHexEntity=29]="InHexEntity"})(pe||(pe={}));function _e(Xe){return Xe===ue.Space||Xe===ue.NewLine||Xe===ue.Tab||Xe===ue.FormFeed||Xe===ue.CarriageReturn}function Ne(Xe){return Xe===ue.Slash||Xe===ue.Gt||_e(Xe)}function Ue(Xe){return Xe>=ue.Zero&&Xe<=ue.Nine}function Ge(Xe){return Xe>=ue.LowerA&&Xe<=ue.LowerZ||Xe>=ue.UpperA&&Xe<=ue.UpperZ}function qe(Xe){return Xe>=ue.UpperA&&Xe<=ue.UpperF||Xe>=ue.LowerA&&Xe<=ue.LowerF}var Ke;(function(Xe){Xe[Xe.NoValue=0]="NoValue",Xe[Xe.Unquoted=1]="Unquoted",Xe[Xe.Single=2]="Single",Xe[Xe.Double=3]="Double"})(Ke=fe.QuoteType||(fe.QuoteType={}));var Ye={Cdata:new Uint8Array([67,68,65,84,65,91]),CdataEnd:new Uint8Array([93,93,62]),CommentEnd:new Uint8Array([45,45,62]),ScriptEnd:new Uint8Array([60,47,115,99,114,105,112,116]),StyleEnd:new Uint8Array([60,47,115,116,121,108,101]),TitleEnd:new Uint8Array([60,47,116,105,116,108,101])},Ze=function(){function Xe(Je,tt){var rt=Je.xmlMode,et=rt===void 0?!1:rt,it=Je.decodeEntities,nt=it===void 0?!0:it;this.cbs=tt,this.state=pe.Text,this.buffer="",this.sectionStart=0,this.index=0,this.baseState=pe.Text,this.isSpecial=!1,this.running=!0,this.offset=0,this.currentSequence=void 0,this.sequenceIndex=0,this.trieIndex=0,this.trieCurrent=0,this.entityResult=0,this.entityExcess=0,this.xmlMode=et,this.decodeEntities=nt,this.entityTrie=et?ee.xmlDecodeTree:ee.htmlDecodeTree}return Xe.prototype.reset=function(){this.state=pe.Text,this.buffer="",this.sectionStart=0,this.index=0,this.baseState=pe.Text,this.currentSequence=void 0,this.running=!0,this.offset=0},Xe.prototype.write=function(Je){this.offset+=this.buffer.length,this.buffer=Je,this.parse()},Xe.prototype.end=function(){this.running&&this.finish()},Xe.prototype.pause=function(){this.running=!1},Xe.prototype.resume=function(){this.running=!0,this.index<this.buffer.length+this.offset&&this.parse()},Xe.prototype.getIndex=function(){return this.index},Xe.prototype.getSectionStart=function(){return this.sectionStart},Xe.prototype.stateText=function(Je){Je===ue.Lt||!this.decodeEntities&&this.fastForwardTo(ue.Lt)?(this.index>this.sectionStart&&this.cbs.ontext(this.sectionStart,this.index),this.state=pe.BeforeTagName,this.sectionStart=this.index):this.decodeEntities&&Je===ue.Amp&&(this.state=pe.BeforeEntity)},Xe.prototype.stateSpecialStartSequence=function(Je){var tt=this.sequenceIndex===this.currentSequence.length,rt=tt?Ne(Je):(Je|32)===this.currentSequence[this.sequenceIndex];if(!rt)this.isSpecial=!1;else if(!tt){this.sequenceIndex++;return}this.sequenceIndex=0,this.state=pe.InTagName,this.stateInTagName(Je)},Xe.prototype.stateInSpecialTag=function(Je){if(this.sequenceIndex===this.currentSequence.length){if(Je===ue.Gt||_e(Je)){var tt=this.index-this.currentSequence.length;if(this.sectionStart<tt){var rt=this.index;this.index=tt,this.cbs.ontext(this.sectionStart,tt),this.index=rt}this.isSpecial=!1,this.sectionStart=tt+2,this.stateInClosingTagName(Je);return}this.sequenceIndex=0}(Je|32)===this.currentSequence[this.sequenceIndex]?this.sequenceIndex+=1:this.sequenceIndex===0?this.currentSequence===Ye.TitleEnd?this.decodeEntities&&Je===ue.Amp&&(this.state=pe.BeforeEntity):this.fastForwardTo(ue.Lt)&&(this.sequenceIndex=1):this.sequenceIndex=+(Je===ue.Lt)},Xe.prototype.stateCDATASequence=function(Je){Je===Ye.Cdata[this.sequenceIndex]?++this.sequenceIndex===Ye.Cdata.length&&(this.state=pe.InCommentLike,this.currentSequence=Ye.CdataEnd,this.sequenceIndex=0,this.sectionStart=this.index+1):(this.sequenceIndex=0,this.state=pe.InDeclaration,this.stateInDeclaration(Je))},Xe.prototype.fastForwardTo=function(Je){for(;++this.index<this.buffer.length+this.offset;)if(this.buffer.charCodeAt(this.index-this.offset)===Je)return!0;return this.index=this.buffer.length+this.offset-1,!1},Xe.prototype.stateInCommentLike=function(Je){Je===this.currentSequence[this.sequenceIndex]?++this.sequenceIndex===this.currentSequence.length&&(this.currentSequence===Ye.CdataEnd?this.cbs.oncdata(this.sectionStart,this.index,2):this.cbs.oncomment(this.sectionStart,this.index,2),this.sequenceIndex=0,this.sectionStart=this.index+1,this.state=pe.Text):this.sequenceIndex===0?this.fastForwardTo(this.currentSequence[0])&&(this.sequenceIndex=1):Je!==this.currentSequence[this.sequenceIndex-1]&&(this.sequenceIndex=0)},Xe.prototype.isTagStartChar=function(Je){return this.xmlMode?!Ne(Je):Ge(Je)},Xe.prototype.startSpecial=function(Je,tt){this.isSpecial=!0,this.currentSequence=Je,this.sequenceIndex=tt,this.state=pe.SpecialStartSequence},Xe.prototype.stateBeforeTagName=function(Je){if(Je===ue.ExclamationMark)this.state=pe.BeforeDeclaration,this.sectionStart=this.index+1;else if(Je===ue.Questionmark)this.state=pe.InProcessingInstruction,this.sectionStart=this.index+1;else if(this.isTagStartChar(Je)){var tt=Je|32;this.sectionStart=this.index,!this.xmlMode&&tt===Ye.TitleEnd[2]?this.startSpecial(Ye.TitleEnd,3):this.state=!this.xmlMode&&tt===Ye.ScriptEnd[2]?pe.BeforeSpecialS:pe.InTagName}else Je===ue.Slash?this.state=pe.BeforeClosingTagName:(this.state=pe.Text,this.stateText(Je))},Xe.prototype.stateInTagName=function(Je){Ne(Je)&&(this.cbs.onopentagname(this.sectionStart,this.index),this.sectionStart=-1,this.state=pe.BeforeAttributeName,this.stateBeforeAttributeName(Je))},Xe.prototype.stateBeforeClosingTagName=function(Je){_e(Je)||(Je===ue.Gt?this.state=pe.Text:(this.state=this.isTagStartChar(Je)?pe.InClosingTagName:pe.InSpecialComment,this.sectionStart=this.index))},Xe.prototype.stateInClosingTagName=function(Je){(Je===ue.Gt||_e(Je))&&(this.cbs.onclosetag(this.sectionStart,this.index),this.sectionStart=-1,this.state=pe.AfterClosingTagName,this.stateAfterClosingTagName(Je))},Xe.prototype.stateAfterClosingTagName=function(Je){(Je===ue.Gt||this.fastForwardTo(ue.Gt))&&(this.state=pe.Text,this.baseState=pe.Text,this.sectionStart=this.index+1)},Xe.prototype.stateBeforeAttributeName=function(Je){Je===ue.Gt?(this.cbs.onopentagend(this.index),this.isSpecial?(this.state=pe.InSpecialTag,this.sequenceIndex=0):this.state=pe.Text,this.baseState=this.state,this.sectionStart=this.index+1):Je===ue.Slash?this.state=pe.InSelfClosingTag:_e(Je)||(this.state=pe.InAttributeName,this.sectionStart=this.index)},Xe.prototype.stateInSelfClosingTag=function(Je){Je===ue.Gt?(this.cbs.onselfclosingtag(this.index),this.state=pe.Text,this.baseState=pe.Text,this.sectionStart=this.index+1,this.isSpecial=!1):_e(Je)||(this.state=pe.BeforeAttributeName,this.stateBeforeAttributeName(Je))},Xe.prototype.stateInAttributeName=function(Je){(Je===ue.Eq||Ne(Je))&&(this.cbs.onattribname(this.sectionStart,this.index),this.sectionStart=-1,this.state=pe.AfterAttributeName,this.stateAfterAttributeName(Je))},Xe.prototype.stateAfterAttributeName=function(Je){Je===ue.Eq?this.state=pe.BeforeAttributeValue:Je===ue.Slash||Je===ue.Gt?(this.cbs.onattribend(Ke.NoValue,this.index),this.state=pe.BeforeAttributeName,this.stateBeforeAttributeName(Je)):_e(Je)||(this.cbs.onattribend(Ke.NoValue,this.index),this.state=pe.InAttributeName,this.sectionStart=this.index)},Xe.prototype.stateBeforeAttributeValue=function(Je){Je===ue.DoubleQuote?(this.state=pe.InAttributeValueDq,this.sectionStart=this.index+1):Je===ue.SingleQuote?(this.state=pe.InAttributeValueSq,this.sectionStart=this.index+1):_e(Je)||(this.sectionStart=this.index,this.state=pe.InAttributeValueNq,this.stateInAttributeValueNoQuotes(Je))},Xe.prototype.handleInAttributeValue=function(Je,tt){Je===tt||!this.decodeEntities&&this.fastForwardTo(tt)?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(tt===ue.DoubleQuote?Ke.Double:Ke.Single,this.index),this.state=pe.BeforeAttributeName):this.decodeEntities&&Je===ue.Amp&&(this.baseState=this.state,this.state=pe.BeforeEntity)},Xe.prototype.stateInAttributeValueDoubleQuotes=function(Je){this.handleInAttributeValue(Je,ue.DoubleQuote)},Xe.prototype.stateInAttributeValueSingleQuotes=function(Je){this.handleInAttributeValue(Je,ue.SingleQuote)},Xe.prototype.stateInAttributeValueNoQuotes=function(Je){_e(Je)||Je===ue.Gt?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(Ke.Unquoted,this.index),this.state=pe.BeforeAttributeName,this.stateBeforeAttributeName(Je)):this.decodeEntities&&Je===ue.Amp&&(this.baseState=this.state,this.state=pe.BeforeEntity)},Xe.prototype.stateBeforeDeclaration=function(Je){Je===ue.OpeningSquareBracket?(this.state=pe.CDATASequence,this.sequenceIndex=0):this.state=Je===ue.Dash?pe.BeforeComment:pe.InDeclaration},Xe.prototype.stateInDeclaration=function(Je){(Je===ue.Gt||this.fastForwardTo(ue.Gt))&&(this.cbs.ondeclaration(this.sectionStart,this.index),this.state=pe.Text,this.sectionStart=this.index+1)},Xe.prototype.stateInProcessingInstruction=function(Je){(Je===ue.Gt||this.fastForwardTo(ue.Gt))&&(this.cbs.onprocessinginstruction(this.sectionStart,this.index),this.state=pe.Text,this.sectionStart=this.index+1)},Xe.prototype.stateBeforeComment=function(Je){Je===ue.Dash?(this.state=pe.InCommentLike,this.currentSequence=Ye.CommentEnd,this.sequenceIndex=2,this.sectionStart=this.index+1):this.state=pe.InDeclaration},Xe.prototype.stateInSpecialComment=function(Je){(Je===ue.Gt||this.fastForwardTo(ue.Gt))&&(this.cbs.oncomment(this.sectionStart,this.index,0),this.state=pe.Text,this.sectionStart=this.index+1)},Xe.prototype.stateBeforeSpecialS=function(Je){var tt=Je|32;tt===Ye.ScriptEnd[3]?this.startSpecial(Ye.ScriptEnd,4):tt===Ye.StyleEnd[3]?this.startSpecial(Ye.StyleEnd,4):(this.state=pe.InTagName,this.stateInTagName(Je))},Xe.prototype.stateBeforeEntity=function(Je){this.entityExcess=1,this.entityResult=0,Je===ue.Number?this.state=pe.BeforeNumericEntity:Je===ue.Amp||(this.trieIndex=0,this.trieCurrent=this.entityTrie[0],this.state=pe.InNamedEntity,this.stateInNamedEntity(Je))},Xe.prototype.stateInNamedEntity=function(Je){if(this.entityExcess+=1,this.trieIndex=(0,ee.determineBranch)(this.entityTrie,this.trieCurrent,this.trieIndex+1,Je),this.trieIndex<0){this.emitNamedEntity(),this.index--;return}this.trieCurrent=this.entityTrie[this.trieIndex];var tt=this.trieCurrent&ee.BinTrieFlags.VALUE_LENGTH;if(tt){var rt=(tt>>14)-1;if(!this.allowLegacyEntity()&&Je!==ue.Semi)this.trieIndex+=rt;else{var et=this.index-this.entityExcess+1;et>this.sectionStart&&this.emitPartial(this.sectionStart,et),this.entityResult=this.trieIndex,this.trieIndex+=rt,this.entityExcess=0,this.sectionStart=this.index+1,rt===0&&this.emitNamedEntity()}}},Xe.prototype.emitNamedEntity=function(){if(this.state=this.baseState,this.entityResult!==0){var Je=(this.entityTrie[this.entityResult]&ee.BinTrieFlags.VALUE_LENGTH)>>14;switch(Je){case 1:{this.emitCodePoint(this.entityTrie[this.entityResult]&~ee.BinTrieFlags.VALUE_LENGTH);break}case 2:{this.emitCodePoint(this.entityTrie[this.entityResult+1]);break}case 3:this.emitCodePoint(this.entityTrie[this.entityResult+1]),this.emitCodePoint(this.entityTrie[this.entityResult+2])}}},Xe.prototype.stateBeforeNumericEntity=function(Je){(Je|32)===ue.LowerX?(this.entityExcess++,this.state=pe.InHexEntity):(this.state=pe.InNumericEntity,this.stateInNumericEntity(Je))},Xe.prototype.emitNumericEntity=function(Je){var tt=this.index-this.entityExcess-1,rt=tt+2+ +(this.state===pe.InHexEntity);rt!==this.index&&(tt>this.sectionStart&&this.emitPartial(this.sectionStart,tt),this.sectionStart=this.index+Number(Je),this.emitCodePoint((0,ee.replaceCodePoint)(this.entityResult))),this.state=this.baseState},Xe.prototype.stateInNumericEntity=function(Je){Je===ue.Semi?this.emitNumericEntity(!0):Ue(Je)?(this.entityResult=this.entityResult*10+(Je-ue.Zero),this.entityExcess++):(this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state=this.baseState,this.index--)},Xe.prototype.stateInHexEntity=function(Je){Je===ue.Semi?this.emitNumericEntity(!0):Ue(Je)?(this.entityResult=this.entityResult*16+(Je-ue.Zero),this.entityExcess++):qe(Je)?(this.entityResult=this.entityResult*16+((Je|32)-ue.LowerA+10),this.entityExcess++):(this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state=this.baseState,this.index--)},Xe.prototype.allowLegacyEntity=function(){return!this.xmlMode&&(this.baseState===pe.Text||this.baseState===pe.InSpecialTag)},Xe.prototype.cleanup=function(){this.running&&this.sectionStart!==this.index&&(this.state===pe.Text||this.state===pe.InSpecialTag&&this.sequenceIndex===0?(this.cbs.ontext(this.sectionStart,this.index),this.sectionStart=this.index):(this.state===pe.InAttributeValueDq||this.state===pe.InAttributeValueSq||this.state===pe.InAttributeValueNq)&&(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=this.index))},Xe.prototype.shouldContinue=function(){return this.index<this.buffer.length+this.offset&&this.running},Xe.prototype.parse=function(){for(;this.shouldContinue();){var Je=this.buffer.charCodeAt(this.index-this.offset);switch(this.state){case pe.Text:{this.stateText(Je);break}case pe.SpecialStartSequence:{this.stateSpecialStartSequence(Je);break}case pe.InSpecialTag:{this.stateInSpecialTag(Je);break}case pe.CDATASequence:{this.stateCDATASequence(Je);break}case pe.InAttributeValueDq:{this.stateInAttributeValueDoubleQuotes(Je);break}case pe.InAttributeName:{this.stateInAttributeName(Je);break}case pe.InCommentLike:{this.stateInCommentLike(Je);break}case pe.InSpecialComment:{this.stateInSpecialComment(Je);break}case pe.BeforeAttributeName:{this.stateBeforeAttributeName(Je);break}case pe.InTagName:{this.stateInTagName(Je);break}case pe.InClosingTagName:{this.stateInClosingTagName(Je);break}case pe.BeforeTagName:{this.stateBeforeTagName(Je);break}case pe.AfterAttributeName:{this.stateAfterAttributeName(Je);break}case pe.InAttributeValueSq:{this.stateInAttributeValueSingleQuotes(Je);break}case pe.BeforeAttributeValue:{this.stateBeforeAttributeValue(Je);break}case pe.BeforeClosingTagName:{this.stateBeforeClosingTagName(Je);break}case pe.AfterClosingTagName:{this.stateAfterClosingTagName(Je);break}case pe.BeforeSpecialS:{this.stateBeforeSpecialS(Je);break}case pe.InAttributeValueNq:{this.stateInAttributeValueNoQuotes(Je);break}case pe.InSelfClosingTag:{this.stateInSelfClosingTag(Je);break}case pe.InDeclaration:{this.stateInDeclaration(Je);break}case pe.BeforeDeclaration:{this.stateBeforeDeclaration(Je);break}case pe.BeforeComment:{this.stateBeforeComment(Je);break}case pe.InProcessingInstruction:{this.stateInProcessingInstruction(Je);break}case pe.InNamedEntity:{this.stateInNamedEntity(Je);break}case pe.BeforeEntity:{this.stateBeforeEntity(Je);break}case pe.InHexEntity:{this.stateInHexEntity(Je);break}case pe.InNumericEntity:{this.stateInNumericEntity(Je);break}default:this.stateBeforeNumericEntity(Je)}this.index++}this.cleanup()},Xe.prototype.finish=function(){this.state===pe.InNamedEntity&&this.emitNamedEntity(),this.sectionStart<this.index&&this.handleTrailingData(),this.cbs.onend()},Xe.prototype.handleTrailingData=function(){var Je=this.buffer.length+this.offset;this.state===pe.InCommentLike?this.currentSequence===Ye.CdataEnd?this.cbs.oncdata(this.sectionStart,Je,0):this.cbs.oncomment(this.sectionStart,Je,0):this.state===pe.InNumericEntity&&this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state===pe.InHexEntity&&this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state===pe.InTagName||this.state===pe.BeforeAttributeName||this.state===pe.BeforeAttributeValue||this.state===pe.AfterAttributeName||this.state===pe.InAttributeName||this.state===pe.InAttributeValueSq||this.state===pe.InAttributeValueDq||this.state===pe.InAttributeValueNq||this.state===pe.InClosingTagName||this.cbs.ontext(this.sectionStart,Je)},Xe.prototype.emitPartial=function(Je,tt){this.baseState!==pe.Text&&this.baseState!==pe.InSpecialTag?this.cbs.onattribdata(Je,tt):this.cbs.ontext(Je,tt)},Xe.prototype.emitCodePoint=function(Je){this.baseState!==pe.Text&&this.baseState!==pe.InSpecialTag?this.cbs.onattribentity(Je):this.cbs.ontextentity(Je)},Xe}();fe.default=Ze})(Tokenizer);var __createBinding$1=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(fe,ee,ue,pe){pe===void 0&&(pe=ue);var _e=Object.getOwnPropertyDescriptor(ee,ue);(!_e||("get"in _e?!ee.__esModule:_e.writable||_e.configurable))&&(_e={enumerable:!0,get:function(){return ee[ue]}}),Object.defineProperty(fe,pe,_e)}:function(fe,ee,ue,pe){pe===void 0&&(pe=ue),fe[pe]=ee[ue]}),__setModuleDefault$1=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(fe,ee){Object.defineProperty(fe,"default",{enumerable:!0,value:ee})}:function(fe,ee){fe.default=ee}),__importStar$1=commonjsGlobal&&commonjsGlobal.__importStar||function(fe){if(fe&&fe.__esModule)return fe;var ee={};if(fe!=null)for(var ue in fe)ue!=="default"&&Object.prototype.hasOwnProperty.call(fe,ue)&&__createBinding$1(ee,fe,ue);return __setModuleDefault$1(ee,fe),ee};Object.defineProperty(Parser$3,"__esModule",{value:!0});Parser$3.Parser=void 0;var Tokenizer_js_1=__importStar$1(Tokenizer),decode_js_1=decode,formTags=new Set(["input","option","optgroup","select","button","datalist","textarea"]),pTag=new Set(["p"]),tableSectionTags=new Set(["thead","tbody"]),ddtTags=new Set(["dd","dt"]),rtpTags=new Set(["rt","rp"]),openImpliesClose=new Map([["tr",new Set(["tr","th","td"])],["th",new Set(["th"])],["td",new Set(["thead","th","td"])],["body",new Set(["head","link","script"])],["li",new Set(["li"])],["p",pTag],["h1",pTag],["h2",pTag],["h3",pTag],["h4",pTag],["h5",pTag],["h6",pTag],["select",formTags],["input",formTags],["output",formTags],["button",formTags],["datalist",formTags],["textarea",formTags],["option",new Set(["option"])],["optgroup",new Set(["optgroup","option"])],["dd",ddtTags],["dt",ddtTags],["address",pTag],["article",pTag],["aside",pTag],["blockquote",pTag],["details",pTag],["div",pTag],["dl",pTag],["fieldset",pTag],["figcaption",pTag],["figure",pTag],["footer",pTag],["form",pTag],["header",pTag],["hr",pTag],["main",pTag],["nav",pTag],["ol",pTag],["pre",pTag],["section",pTag],["table",pTag],["ul",pTag],["rt",rtpTags],["rp",rtpTags],["tbody",tableSectionTags],["tfoot",tableSectionTags]]),voidElements=new Set(["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"]),foreignContextElements=new Set(["math","svg"]),htmlIntegrationElements=new Set(["mi","mo","mn","ms","mtext","annotation-xml","foreignobject","desc","title"]),reNameEnd=/\s|\//,Parser$2=function(){function fe(ee,ue){ue===void 0&&(ue={});var pe,_e,Ne,Ue,Ge;this.options=ue,this.startIndex=0,this.endIndex=0,this.openTagStart=0,this.tagname="",this.attribname="",this.attribvalue="",this.attribs=null,this.stack=[],this.foreignContext=[],this.buffers=[],this.bufferOffset=0,this.writeIndex=0,this.ended=!1,this.cbs=ee??{},this.lowerCaseTagNames=(pe=ue.lowerCaseTags)!==null&&pe!==void 0?pe:!ue.xmlMode,this.lowerCaseAttributeNames=(_e=ue.lowerCaseAttributeNames)!==null&&_e!==void 0?_e:!ue.xmlMode,this.tokenizer=new((Ne=ue.Tokenizer)!==null&&Ne!==void 0?Ne:Tokenizer_js_1.default)(this.options,this),(Ge=(Ue=this.cbs).onparserinit)===null||Ge===void 0||Ge.call(Ue,this)}return fe.prototype.ontext=function(ee,ue){var pe,_e,Ne=this.getSlice(ee,ue);this.endIndex=ue-1,(_e=(pe=this.cbs).ontext)===null||_e===void 0||_e.call(pe,Ne),this.startIndex=ue},fe.prototype.ontextentity=function(ee){var ue,pe,_e=this.tokenizer.getSectionStart();this.endIndex=_e-1,(pe=(ue=this.cbs).ontext)===null||pe===void 0||pe.call(ue,(0,decode_js_1.fromCodePoint)(ee)),this.startIndex=_e},fe.prototype.isVoidElement=function(ee){return!this.options.xmlMode&&voidElements.has(ee)},fe.prototype.onopentagname=function(ee,ue){this.endIndex=ue;var pe=this.getSlice(ee,ue);this.lowerCaseTagNames&&(pe=pe.toLowerCase()),this.emitOpenTag(pe)},fe.prototype.emitOpenTag=function(ee){var ue,pe,_e,Ne;this.openTagStart=this.startIndex,this.tagname=ee;var Ue=!this.options.xmlMode&&openImpliesClose.get(ee);if(Ue)for(;this.stack.length>0&&Ue.has(this.stack[this.stack.length-1]);){var Ge=this.stack.pop();(pe=(ue=this.cbs).onclosetag)===null||pe===void 0||pe.call(ue,Ge,!0)}this.isVoidElement(ee)||(this.stack.push(ee),foreignContextElements.has(ee)?this.foreignContext.push(!0):htmlIntegrationElements.has(ee)&&this.foreignContext.push(!1)),(Ne=(_e=this.cbs).onopentagname)===null||Ne===void 0||Ne.call(_e,ee),this.cbs.onopentag&&(this.attribs={})},fe.prototype.endOpenTag=function(ee){var ue,pe;this.startIndex=this.openTagStart,this.attribs&&((pe=(ue=this.cbs).onopentag)===null||pe===void 0||pe.call(ue,this.tagname,this.attribs,ee),this.attribs=null),this.cbs.onclosetag&&this.isVoidElement(this.tagname)&&this.cbs.onclosetag(this.tagname,!0),this.tagname=""},fe.prototype.onopentagend=function(ee){this.endIndex=ee,this.endOpenTag(!1),this.startIndex=ee+1},fe.prototype.onclosetag=function(ee,ue){var pe,_e,Ne,Ue,Ge,qe;this.endIndex=ue;var Ke=this.getSlice(ee,ue);if(this.lowerCaseTagNames&&(Ke=Ke.toLowerCase()),(foreignContextElements.has(Ke)||htmlIntegrationElements.has(Ke))&&this.foreignContext.pop(),this.isVoidElement(Ke))!this.options.xmlMode&&Ke==="br"&&((_e=(pe=this.cbs).onopentagname)===null||_e===void 0||_e.call(pe,"br"),(Ue=(Ne=this.cbs).onopentag)===null||Ue===void 0||Ue.call(Ne,"br",{},!0),(qe=(Ge=this.cbs).onclosetag)===null||qe===void 0||qe.call(Ge,"br",!1));else{var Ye=this.stack.lastIndexOf(Ke);if(Ye!==-1)if(this.cbs.onclosetag)for(var Ze=this.stack.length-Ye;Ze--;)this.cbs.onclosetag(this.stack.pop(),Ze!==0);else this.stack.length=Ye;else!this.options.xmlMode&&Ke==="p"&&(this.emitOpenTag("p"),this.closeCurrentTag(!0))}this.startIndex=ue+1},fe.prototype.onselfclosingtag=function(ee){this.endIndex=ee,this.options.xmlMode||this.options.recognizeSelfClosing||this.foreignContext[this.foreignContext.length-1]?(this.closeCurrentTag(!1),this.startIndex=ee+1):this.onopentagend(ee)},fe.prototype.closeCurrentTag=function(ee){var ue,pe,_e=this.tagname;this.endOpenTag(ee),this.stack[this.stack.length-1]===_e&&((pe=(ue=this.cbs).onclosetag)===null||pe===void 0||pe.call(ue,_e,!ee),this.stack.pop())},fe.prototype.onattribname=function(ee,ue){this.startIndex=ee;var pe=this.getSlice(ee,ue);this.attribname=this.lowerCaseAttributeNames?pe.toLowerCase():pe},fe.prototype.onattribdata=function(ee,ue){this.attribvalue+=this.getSlice(ee,ue)},fe.prototype.onattribentity=function(ee){this.attribvalue+=(0,decode_js_1.fromCodePoint)(ee)},fe.prototype.onattribend=function(ee,ue){var pe,_e;this.endIndex=ue,(_e=(pe=this.cbs).onattribute)===null||_e===void 0||_e.call(pe,this.attribname,this.attribvalue,ee===Tokenizer_js_1.QuoteType.Double?'"':ee===Tokenizer_js_1.QuoteType.Single?"'":ee===Tokenizer_js_1.QuoteType.NoValue?void 0:null),this.attribs&&!Object.prototype.hasOwnProperty.call(this.attribs,this.attribname)&&(this.attribs[this.attribname]=this.attribvalue),this.attribvalue=""},fe.prototype.getInstructionName=function(ee){var ue=ee.search(reNameEnd),pe=ue<0?ee:ee.substr(0,ue);return this.lowerCaseTagNames&&(pe=pe.toLowerCase()),pe},fe.prototype.ondeclaration=function(ee,ue){this.endIndex=ue;var pe=this.getSlice(ee,ue);if(this.cbs.onprocessinginstruction){var _e=this.getInstructionName(pe);this.cbs.onprocessinginstruction("!".concat(_e),"!".concat(pe))}this.startIndex=ue+1},fe.prototype.onprocessinginstruction=function(ee,ue){this.endIndex=ue;var pe=this.getSlice(ee,ue);if(this.cbs.onprocessinginstruction){var _e=this.getInstructionName(pe);this.cbs.onprocessinginstruction("?".concat(_e),"?".concat(pe))}this.startIndex=ue+1},fe.prototype.oncomment=function(ee,ue,pe){var _e,Ne,Ue,Ge;this.endIndex=ue,(Ne=(_e=this.cbs).oncomment)===null||Ne===void 0||Ne.call(_e,this.getSlice(ee,ue-pe)),(Ge=(Ue=this.cbs).oncommentend)===null||Ge===void 0||Ge.call(Ue),this.startIndex=ue+1},fe.prototype.oncdata=function(ee,ue,pe){var _e,Ne,Ue,Ge,qe,Ke,Ye,Ze,Xe,Je;this.endIndex=ue;var tt=this.getSlice(ee,ue-pe);this.options.xmlMode||this.options.recognizeCDATA?((Ne=(_e=this.cbs).oncdatastart)===null||Ne===void 0||Ne.call(_e),(Ge=(Ue=this.cbs).ontext)===null||Ge===void 0||Ge.call(Ue,tt),(Ke=(qe=this.cbs).oncdataend)===null||Ke===void 0||Ke.call(qe)):((Ze=(Ye=this.cbs).oncomment)===null||Ze===void 0||Ze.call(Ye,"[CDATA[".concat(tt,"]]")),(Je=(Xe=this.cbs).oncommentend)===null||Je===void 0||Je.call(Xe)),this.startIndex=ue+1},fe.prototype.onend=function(){var ee,ue;if(this.cbs.onclosetag){this.endIndex=this.startIndex;for(var pe=this.stack.length;pe>0;this.cbs.onclosetag(this.stack[--pe],!0));}(ue=(ee=this.cbs).onend)===null||ue===void 0||ue.call(ee)},fe.prototype.reset=function(){var ee,ue,pe,_e;(ue=(ee=this.cbs).onreset)===null||ue===void 0||ue.call(ee),this.tokenizer.reset(),this.tagname="",this.attribname="",this.attribs=null,this.stack.length=0,this.startIndex=0,this.endIndex=0,(_e=(pe=this.cbs).onparserinit)===null||_e===void 0||_e.call(pe,this),this.buffers.length=0,this.bufferOffset=0,this.writeIndex=0,this.ended=!1},fe.prototype.parseComplete=function(ee){this.reset(),this.end(ee)},fe.prototype.getSlice=function(ee,ue){for(;ee-this.bufferOffset>=this.buffers[0].length;)this.shiftBuffer();for(var pe=this.buffers[0].slice(ee-this.bufferOffset,ue-this.bufferOffset);ue-this.bufferOffset>this.buffers[0].length;)this.shiftBuffer(),pe+=this.buffers[0].slice(0,ue-this.bufferOffset);return pe},fe.prototype.shiftBuffer=function(){this.bufferOffset+=this.buffers[0].length,this.writeIndex--,this.buffers.shift()},fe.prototype.write=function(ee){var ue,pe;if(this.ended){(pe=(ue=this.cbs).onerror)===null||pe===void 0||pe.call(ue,new Error(".write() after done!"));return}this.buffers.push(ee),this.tokenizer.running&&(this.tokenizer.write(ee),this.writeIndex++)},fe.prototype.end=function(ee){var ue,pe;if(this.ended){(pe=(ue=this.cbs).onerror)===null||pe===void 0||pe.call(ue,new Error(".end() after done!"));return}ee&&this.write(ee),this.ended=!0,this.tokenizer.end()},fe.prototype.pause=function(){this.tokenizer.pause()},fe.prototype.resume=function(){for(this.tokenizer.resume();this.tokenizer.running&&this.writeIndex<this.buffers.length;)this.tokenizer.write(this.buffers[this.writeIndex++]);this.ended&&this.tokenizer.end()},fe.prototype.parseChunk=function(ee){this.write(ee)},fe.prototype.done=function(ee){this.end(ee)},fe}();Parser$3.Parser=Parser$2;var lib$4={},lib$3={};(function(fe){Object.defineProperty(fe,"__esModule",{value:!0}),fe.Doctype=fe.CDATA=fe.Tag=fe.Style=fe.Script=fe.Comment=fe.Directive=fe.Text=fe.Root=fe.isTag=fe.ElementType=void 0;var ee;(function(pe){pe.Root="root",pe.Text="text",pe.Directive="directive",pe.Comment="comment",pe.Script="script",pe.Style="style",pe.Tag="tag",pe.CDATA="cdata",pe.Doctype="doctype"})(ee=fe.ElementType||(fe.ElementType={}));function ue(pe){return pe.type===ee.Tag||pe.type===ee.Script||pe.type===ee.Style}fe.isTag=ue,fe.Root=ee.Root,fe.Text=ee.Text,fe.Directive=ee.Directive,fe.Comment=ee.Comment,fe.Script=ee.Script,fe.Style=ee.Style,fe.Tag=ee.Tag,fe.CDATA=ee.CDATA,fe.Doctype=ee.Doctype})(lib$3);var node$1={},__extends=commonjsGlobal&&commonjsGlobal.__extends||function(){var fe=function(ee,ue){return fe=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(pe,_e){pe.__proto__=_e}||function(pe,_e){for(var Ne in _e)Object.prototype.hasOwnProperty.call(_e,Ne)&&(pe[Ne]=_e[Ne])},fe(ee,ue)};return function(ee,ue){if(typeof ue!="function"&&ue!==null)throw new TypeError("Class extends value "+String(ue)+" is not a constructor or null");fe(ee,ue);function pe(){this.constructor=ee}ee.prototype=ue===null?Object.create(ue):(pe.prototype=ue.prototype,new pe)}}(),__assign$2=commonjsGlobal&&commonjsGlobal.__assign||function(){return __assign$2=Object.assign||function(fe){for(var ee,ue=1,pe=arguments.length;ue<pe;ue++){ee=arguments[ue];for(var _e in ee)Object.prototype.hasOwnProperty.call(ee,_e)&&(fe[_e]=ee[_e])}return fe},__assign$2.apply(this,arguments)};Object.defineProperty(node$1,"__esModule",{value:!0});node$1.cloneNode=node$1.hasChildren=node$1.isDocument=node$1.isDirective=node$1.isComment=node$1.isText=node$1.isCDATA=node$1.isTag=node$1.Element=node$1.Document=node$1.CDATA=node$1.NodeWithChildren=node$1.ProcessingInstruction=node$1.Comment=node$1.Text=node$1.DataNode=node$1.Node=void 0;var domelementtype_1$1=lib$3,Node$6=function(){function fe(){this.parent=null,this.prev=null,this.next=null,this.startIndex=null,this.endIndex=null}return Object.defineProperty(fe.prototype,"parentNode",{get:function(){return this.parent},set:function(ee){this.parent=ee},enumerable:!1,configurable:!0}),Object.defineProperty(fe.prototype,"previousSibling",{get:function(){return this.prev},set:function(ee){this.prev=ee},enumerable:!1,configurable:!0}),Object.defineProperty(fe.prototype,"nextSibling",{get:function(){return this.next},set:function(ee){this.next=ee},enumerable:!1,configurable:!0}),fe.prototype.cloneNode=function(ee){return ee===void 0&&(ee=!1),cloneNode$1(this,ee)},fe}();node$1.Node=Node$6;var DataNode=function(fe){__extends(ee,fe);function ee(ue){var pe=fe.call(this)||this;return pe.data=ue,pe}return Object.defineProperty(ee.prototype,"nodeValue",{get:function(){return this.data},set:function(ue){this.data=ue},enumerable:!1,configurable:!0}),ee}(Node$6);node$1.DataNode=DataNode;var Text=function(fe){__extends(ee,fe);function ee(){var ue=fe!==null&&fe.apply(this,arguments)||this;return ue.type=domelementtype_1$1.ElementType.Text,ue}return Object.defineProperty(ee.prototype,"nodeType",{get:function(){return 3},enumerable:!1,configurable:!0}),ee}(DataNode);node$1.Text=Text;var Comment$5=function(fe){__extends(ee,fe);function ee(){var ue=fe!==null&&fe.apply(this,arguments)||this;return ue.type=domelementtype_1$1.ElementType.Comment,ue}return Object.defineProperty(ee.prototype,"nodeType",{get:function(){return 8},enumerable:!1,configurable:!0}),ee}(DataNode);node$1.Comment=Comment$5;var ProcessingInstruction=function(fe){__extends(ee,fe);function ee(ue,pe){var _e=fe.call(this,pe)||this;return _e.name=ue,_e.type=domelementtype_1$1.ElementType.Directive,_e}return Object.defineProperty(ee.prototype,"nodeType",{get:function(){return 1},enumerable:!1,configurable:!0}),ee}(DataNode);node$1.ProcessingInstruction=ProcessingInstruction;var NodeWithChildren=function(fe){__extends(ee,fe);function ee(ue){var pe=fe.call(this)||this;return pe.children=ue,pe}return Object.defineProperty(ee.prototype,"firstChild",{get:function(){var ue;return(ue=this.children[0])!==null&&ue!==void 0?ue:null},enumerable:!1,configurable:!0}),Object.defineProperty(ee.prototype,"lastChild",{get:function(){return this.children.length>0?this.children[this.children.length-1]:null},enumerable:!1,configurable:!0}),Object.defineProperty(ee.prototype,"childNodes",{get:function(){return this.children},set:function(ue){this.children=ue},enumerable:!1,configurable:!0}),ee}(Node$6);node$1.NodeWithChildren=NodeWithChildren;var CDATA=function(fe){__extends(ee,fe);function ee(){var ue=fe!==null&&fe.apply(this,arguments)||this;return ue.type=domelementtype_1$1.ElementType.CDATA,ue}return Object.defineProperty(ee.prototype,"nodeType",{get:function(){return 4},enumerable:!1,configurable:!0}),ee}(NodeWithChildren);node$1.CDATA=CDATA;var Document$4=function(fe){__extends(ee,fe);function ee(){var ue=fe!==null&&fe.apply(this,arguments)||this;return ue.type=domelementtype_1$1.ElementType.Root,ue}return Object.defineProperty(ee.prototype,"nodeType",{get:function(){return 9},enumerable:!1,configurable:!0}),ee}(NodeWithChildren);node$1.Document=Document$4;var Element$1=function(fe){__extends(ee,fe);function ee(ue,pe,_e,Ne){_e===void 0&&(_e=[]),Ne===void 0&&(Ne=ue==="script"?domelementtype_1$1.ElementType.Script:ue==="style"?domelementtype_1$1.ElementType.Style:domelementtype_1$1.ElementType.Tag);var Ue=fe.call(this,_e)||this;return Ue.name=ue,Ue.attribs=pe,Ue.type=Ne,Ue}return Object.defineProperty(ee.prototype,"nodeType",{get:function(){return 1},enumerable:!1,configurable:!0}),Object.defineProperty(ee.prototype,"tagName",{get:function(){return this.name},set:function(ue){this.name=ue},enumerable:!1,configurable:!0}),Object.defineProperty(ee.prototype,"attributes",{get:function(){var ue=this;return Object.keys(this.attribs).map(function(pe){var _e,Ne;return{name:pe,value:ue.attribs[pe],namespace:(_e=ue["x-attribsNamespace"])===null||_e===void 0?void 0:_e[pe],prefix:(Ne=ue["x-attribsPrefix"])===null||Ne===void 0?void 0:Ne[pe]}})},enumerable:!1,configurable:!0}),ee}(NodeWithChildren);node$1.Element=Element$1;function isTag(fe){return(0,domelementtype_1$1.isTag)(fe)}node$1.isTag=isTag;function isCDATA(fe){return fe.type===domelementtype_1$1.ElementType.CDATA}node$1.isCDATA=isCDATA;function isText(fe){return fe.type===domelementtype_1$1.ElementType.Text}node$1.isText=isText;function isComment(fe){return fe.type===domelementtype_1$1.ElementType.Comment}node$1.isComment=isComment;function isDirective(fe){return fe.type===domelementtype_1$1.ElementType.Directive}node$1.isDirective=isDirective;function isDocument(fe){return fe.type===domelementtype_1$1.ElementType.Root}node$1.isDocument=isDocument;function hasChildren(fe){return Object.prototype.hasOwnProperty.call(fe,"children")}node$1.hasChildren=hasChildren;function cloneNode$1(fe,ee){ee===void 0&&(ee=!1);var ue;if(isText(fe))ue=new Text(fe.data);else if(isComment(fe))ue=new Comment$5(fe.data);else if(isTag(fe)){var pe=ee?cloneChildren(fe.children):[],_e=new Element$1(fe.name,__assign$2({},fe.attribs),pe);pe.forEach(function(qe){return qe.parent=_e}),fe.namespace!=null&&(_e.namespace=fe.namespace),fe["x-attribsNamespace"]&&(_e["x-attribsNamespace"]=__assign$2({},fe["x-attribsNamespace"])),fe["x-attribsPrefix"]&&(_e["x-attribsPrefix"]=__assign$2({},fe["x-attribsPrefix"])),ue=_e}else if(isCDATA(fe)){var pe=ee?cloneChildren(fe.children):[],Ne=new CDATA(pe);pe.forEach(function(Ke){return Ke.parent=Ne}),ue=Ne}else if(isDocument(fe)){var pe=ee?cloneChildren(fe.children):[],Ue=new Document$4(pe);pe.forEach(function(Ke){return Ke.parent=Ue}),fe["x-mode"]&&(Ue["x-mode"]=fe["x-mode"]),ue=Ue}else if(isDirective(fe)){var Ge=new ProcessingInstruction(fe.name,fe.data);fe["x-name"]!=null&&(Ge["x-name"]=fe["x-name"],Ge["x-publicId"]=fe["x-publicId"],Ge["x-systemId"]=fe["x-systemId"]),ue=Ge}else throw new Error("Not implemented yet: ".concat(fe.type));return ue.startIndex=fe.startIndex,ue.endIndex=fe.endIndex,fe.sourceCodeLocation!=null&&(ue.sourceCodeLocation=fe.sourceCodeLocation),ue}node$1.cloneNode=cloneNode$1;function cloneChildren(fe){for(var ee=fe.map(function(pe){return cloneNode$1(pe,!0)}),ue=1;ue<ee.length;ue++)ee[ue].prev=ee[ue-1],ee[ue-1].next=ee[ue];return ee}(function(fe){var ee=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(Ge,qe,Ke,Ye){Ye===void 0&&(Ye=Ke);var Ze=Object.getOwnPropertyDescriptor(qe,Ke);(!Ze||("get"in Ze?!qe.__esModule:Ze.writable||Ze.configurable))&&(Ze={enumerable:!0,get:function(){return qe[Ke]}}),Object.defineProperty(Ge,Ye,Ze)}:function(Ge,qe,Ke,Ye){Ye===void 0&&(Ye=Ke),Ge[Ye]=qe[Ke]}),ue=commonjsGlobal&&commonjsGlobal.__exportStar||function(Ge,qe){for(var Ke in Ge)Ke!=="default"&&!Object.prototype.hasOwnProperty.call(qe,Ke)&&ee(qe,Ge,Ke)};Object.defineProperty(fe,"__esModule",{value:!0}),fe.DomHandler=void 0;var pe=lib$3,_e=node$1;ue(node$1,fe);var Ne={withStartIndices:!1,withEndIndices:!1,xmlMode:!1},Ue=function(){function Ge(qe,Ke,Ye){this.dom=[],this.root=new _e.Document(this.dom),this.done=!1,this.tagStack=[this.root],this.lastNode=null,this.parser=null,typeof Ke=="function"&&(Ye=Ke,Ke=Ne),typeof qe=="object"&&(Ke=qe,qe=void 0),this.callback=qe??null,this.options=Ke??Ne,this.elementCB=Ye??null}return Ge.prototype.onparserinit=function(qe){this.parser=qe},Ge.prototype.onreset=function(){this.dom=[],this.root=new _e.Document(this.dom),this.done=!1,this.tagStack=[this.root],this.lastNode=null,this.parser=null},Ge.prototype.onend=function(){this.done||(this.done=!0,this.parser=null,this.handleCallback(null))},Ge.prototype.onerror=function(qe){this.handleCallback(qe)},Ge.prototype.onclosetag=function(){this.lastNode=null;var qe=this.tagStack.pop();this.options.withEndIndices&&(qe.endIndex=this.parser.endIndex),this.elementCB&&this.elementCB(qe)},Ge.prototype.onopentag=function(qe,Ke){var Ye=this.options.xmlMode?pe.ElementType.Tag:void 0,Ze=new _e.Element(qe,Ke,void 0,Ye);this.addNode(Ze),this.tagStack.push(Ze)},Ge.prototype.ontext=function(qe){var Ke=this.lastNode;if(Ke&&Ke.type===pe.ElementType.Text)Ke.data+=qe,this.options.withEndIndices&&(Ke.endIndex=this.parser.endIndex);else{var Ye=new _e.Text(qe);this.addNode(Ye),this.lastNode=Ye}},Ge.prototype.oncomment=function(qe){if(this.lastNode&&this.lastNode.type===pe.ElementType.Comment){this.lastNode.data+=qe;return}var Ke=new _e.Comment(qe);this.addNode(Ke),this.lastNode=Ke},Ge.prototype.oncommentend=function(){this.lastNode=null},Ge.prototype.oncdatastart=function(){var qe=new _e.Text(""),Ke=new _e.CDATA([qe]);this.addNode(Ke),qe.parent=Ke,this.lastNode=qe},Ge.prototype.oncdataend=function(){this.lastNode=null},Ge.prototype.onprocessinginstruction=function(qe,Ke){var Ye=new _e.ProcessingInstruction(qe,Ke);this.addNode(Ye)},Ge.prototype.handleCallback=function(qe){if(typeof this.callback=="function")this.callback(qe,this.dom);else if(qe)throw qe},Ge.prototype.addNode=function(qe){var Ke=this.tagStack[this.tagStack.length-1],Ye=Ke.children[Ke.children.length-1];this.options.withStartIndices&&(qe.startIndex=this.parser.startIndex),this.options.withEndIndices&&(qe.endIndex=this.parser.endIndex),Ke.children.push(qe),Ye&&(qe.prev=Ye,Ye.next=qe),qe.parent=Ke,this.lastNode=null},Ge}();fe.DomHandler=Ue,fe.default=Ue})(lib$4);var lib$2={},stringify$5={},lib$1={},lib={},encode={},encodeHtml={};Object.defineProperty(encodeHtml,"__esModule",{value:!0});function restoreDiff(fe){for(var ee=1;ee<fe.length;ee++)fe[ee][0]+=fe[ee-1][0]+1;return fe}encodeHtml.default=new Map(restoreDiff([[9,"&Tab;"],[0,"&NewLine;"],[22,"&excl;"],[0,"&quot;"],[0,"&num;"],[0,"&dollar;"],[0,"&percnt;"],[0,"&amp;"],[0,"&apos;"],[0,"&lpar;"],[0,"&rpar;"],[0,"&ast;"],[0,"&plus;"],[0,"&comma;"],[1,"&period;"],[0,"&sol;"],[10,"&colon;"],[0,"&semi;"],[0,{v:"&lt;",n:8402,o:"&nvlt;"}],[0,{v:"&equals;",n:8421,o:"&bne;"}],[0,{v:"&gt;",n:8402,o:"&nvgt;"}],[0,"&quest;"],[0,"&commat;"],[26,"&lbrack;"],[0,"&bsol;"],[0,"&rbrack;"],[0,"&Hat;"],[0,"&lowbar;"],[0,"&DiacriticalGrave;"],[5,{n:106,o:"&fjlig;"}],[20,"&lbrace;"],[0,"&verbar;"],[0,"&rbrace;"],[34,"&nbsp;"],[0,"&iexcl;"],[0,"&cent;"],[0,"&pound;"],[0,"&curren;"],[0,"&yen;"],[0,"&brvbar;"],[0,"&sect;"],[0,"&die;"],[0,"&copy;"],[0,"&ordf;"],[0,"&laquo;"],[0,"&not;"],[0,"&shy;"],[0,"&circledR;"],[0,"&macr;"],[0,"&deg;"],[0,"&PlusMinus;"],[0,"&sup2;"],[0,"&sup3;"],[0,"&acute;"],[0,"&micro;"],[0,"&para;"],[0,"&centerdot;"],[0,"&cedil;"],[0,"&sup1;"],[0,"&ordm;"],[0,"&raquo;"],[0,"&frac14;"],[0,"&frac12;"],[0,"&frac34;"],[0,"&iquest;"],[0,"&Agrave;"],[0,"&Aacute;"],[0,"&Acirc;"],[0,"&Atilde;"],[0,"&Auml;"],[0,"&angst;"],[0,"&AElig;"],[0,"&Ccedil;"],[0,"&Egrave;"],[0,"&Eacute;"],[0,"&Ecirc;"],[0,"&Euml;"],[0,"&Igrave;"],[0,"&Iacute;"],[0,"&Icirc;"],[0,"&Iuml;"],[0,"&ETH;"],[0,"&Ntilde;"],[0,"&Ograve;"],[0,"&Oacute;"],[0,"&Ocirc;"],[0,"&Otilde;"],[0,"&Ouml;"],[0,"&times;"],[0,"&Oslash;"],[0,"&Ugrave;"],[0,"&Uacute;"],[0,"&Ucirc;"],[0,"&Uuml;"],[0,"&Yacute;"],[0,"&THORN;"],[0,"&szlig;"],[0,"&agrave;"],[0,"&aacute;"],[0,"&acirc;"],[0,"&atilde;"],[0,"&auml;"],[0,"&aring;"],[0,"&aelig;"],[0,"&ccedil;"],[0,"&egrave;"],[0,"&eacute;"],[0,"&ecirc;"],[0,"&euml;"],[0,"&igrave;"],[0,"&iacute;"],[0,"&icirc;"],[0,"&iuml;"],[0,"&eth;"],[0,"&ntilde;"],[0,"&ograve;"],[0,"&oacute;"],[0,"&ocirc;"],[0,"&otilde;"],[0,"&ouml;"],[0,"&div;"],[0,"&oslash;"],[0,"&ugrave;"],[0,"&uacute;"],[0,"&ucirc;"],[0,"&uuml;"],[0,"&yacute;"],[0,"&thorn;"],[0,"&yuml;"],[0,"&Amacr;"],[0,"&amacr;"],[0,"&Abreve;"],[0,"&abreve;"],[0,"&Aogon;"],[0,"&aogon;"],[0,"&Cacute;"],[0,"&cacute;"],[0,"&Ccirc;"],[0,"&ccirc;"],[0,"&Cdot;"],[0,"&cdot;"],[0,"&Ccaron;"],[0,"&ccaron;"],[0,"&Dcaron;"],[0,"&dcaron;"],[0,"&Dstrok;"],[0,"&dstrok;"],[0,"&Emacr;"],[0,"&emacr;"],[2,"&Edot;"],[0,"&edot;"],[0,"&Eogon;"],[0,"&eogon;"],[0,"&Ecaron;"],[0,"&ecaron;"],[0,"&Gcirc;"],[0,"&gcirc;"],[0,"&Gbreve;"],[0,"&gbreve;"],[0,"&Gdot;"],[0,"&gdot;"],[0,"&Gcedil;"],[1,"&Hcirc;"],[0,"&hcirc;"],[0,"&Hstrok;"],[0,"&hstrok;"],[0,"&Itilde;"],[0,"&itilde;"],[0,"&Imacr;"],[0,"&imacr;"],[2,"&Iogon;"],[0,"&iogon;"],[0,"&Idot;"],[0,"&imath;"],[0,"&IJlig;"],[0,"&ijlig;"],[0,"&Jcirc;"],[0,"&jcirc;"],[0,"&Kcedil;"],[0,"&kcedil;"],[0,"&kgreen;"],[0,"&Lacute;"],[0,"&lacute;"],[0,"&Lcedil;"],[0,"&lcedil;"],[0,"&Lcaron;"],[0,"&lcaron;"],[0,"&Lmidot;"],[0,"&lmidot;"],[0,"&Lstrok;"],[0,"&lstrok;"],[0,"&Nacute;"],[0,"&nacute;"],[0,"&Ncedil;"],[0,"&ncedil;"],[0,"&Ncaron;"],[0,"&ncaron;"],[0,"&napos;"],[0,"&ENG;"],[0,"&eng;"],[0,"&Omacr;"],[0,"&omacr;"],[2,"&Odblac;"],[0,"&odblac;"],[0,"&OElig;"],[0,"&oelig;"],[0,"&Racute;"],[0,"&racute;"],[0,"&Rcedil;"],[0,"&rcedil;"],[0,"&Rcaron;"],[0,"&rcaron;"],[0,"&Sacute;"],[0,"&sacute;"],[0,"&Scirc;"],[0,"&scirc;"],[0,"&Scedil;"],[0,"&scedil;"],[0,"&Scaron;"],[0,"&scaron;"],[0,"&Tcedil;"],[0,"&tcedil;"],[0,"&Tcaron;"],[0,"&tcaron;"],[0,"&Tstrok;"],[0,"&tstrok;"],[0,"&Utilde;"],[0,"&utilde;"],[0,"&Umacr;"],[0,"&umacr;"],[0,"&Ubreve;"],[0,"&ubreve;"],[0,"&Uring;"],[0,"&uring;"],[0,"&Udblac;"],[0,"&udblac;"],[0,"&Uogon;"],[0,"&uogon;"],[0,"&Wcirc;"],[0,"&wcirc;"],[0,"&Ycirc;"],[0,"&ycirc;"],[0,"&Yuml;"],[0,"&Zacute;"],[0,"&zacute;"],[0,"&Zdot;"],[0,"&zdot;"],[0,"&Zcaron;"],[0,"&zcaron;"],[19,"&fnof;"],[34,"&imped;"],[63,"&gacute;"],[65,"&jmath;"],[142,"&circ;"],[0,"&caron;"],[16,"&breve;"],[0,"&DiacriticalDot;"],[0,"&ring;"],[0,"&ogon;"],[0,"&DiacriticalTilde;"],[0,"&dblac;"],[51,"&DownBreve;"],[127,"&Alpha;"],[0,"&Beta;"],[0,"&Gamma;"],[0,"&Delta;"],[0,"&Epsilon;"],[0,"&Zeta;"],[0,"&Eta;"],[0,"&Theta;"],[0,"&Iota;"],[0,"&Kappa;"],[0,"&Lambda;"],[0,"&Mu;"],[0,"&Nu;"],[0,"&Xi;"],[0,"&Omicron;"],[0,"&Pi;"],[0,"&Rho;"],[1,"&Sigma;"],[0,"&Tau;"],[0,"&Upsilon;"],[0,"&Phi;"],[0,"&Chi;"],[0,"&Psi;"],[0,"&ohm;"],[7,"&alpha;"],[0,"&beta;"],[0,"&gamma;"],[0,"&delta;"],[0,"&epsi;"],[0,"&zeta;"],[0,"&eta;"],[0,"&theta;"],[0,"&iota;"],[0,"&kappa;"],[0,"&lambda;"],[0,"&mu;"],[0,"&nu;"],[0,"&xi;"],[0,"&omicron;"],[0,"&pi;"],[0,"&rho;"],[0,"&sigmaf;"],[0,"&sigma;"],[0,"&tau;"],[0,"&upsi;"],[0,"&phi;"],[0,"&chi;"],[0,"&psi;"],[0,"&omega;"],[7,"&thetasym;"],[0,"&Upsi;"],[2,"&phiv;"],[0,"&piv;"],[5,"&Gammad;"],[0,"&digamma;"],[18,"&kappav;"],[0,"&rhov;"],[3,"&epsiv;"],[0,"&backepsilon;"],[10,"&IOcy;"],[0,"&DJcy;"],[0,"&GJcy;"],[0,"&Jukcy;"],[0,"&DScy;"],[0,"&Iukcy;"],[0,"&YIcy;"],[0,"&Jsercy;"],[0,"&LJcy;"],[0,"&NJcy;"],[0,"&TSHcy;"],[0,"&KJcy;"],[1,"&Ubrcy;"],[0,"&DZcy;"],[0,"&Acy;"],[0,"&Bcy;"],[0,"&Vcy;"],[0,"&Gcy;"],[0,"&Dcy;"],[0,"&IEcy;"],[0,"&ZHcy;"],[0,"&Zcy;"],[0,"&Icy;"],[0,"&Jcy;"],[0,"&Kcy;"],[0,"&Lcy;"],[0,"&Mcy;"],[0,"&Ncy;"],[0,"&Ocy;"],[0,"&Pcy;"],[0,"&Rcy;"],[0,"&Scy;"],[0,"&Tcy;"],[0,"&Ucy;"],[0,"&Fcy;"],[0,"&KHcy;"],[0,"&TScy;"],[0,"&CHcy;"],[0,"&SHcy;"],[0,"&SHCHcy;"],[0,"&HARDcy;"],[0,"&Ycy;"],[0,"&SOFTcy;"],[0,"&Ecy;"],[0,"&YUcy;"],[0,"&YAcy;"],[0,"&acy;"],[0,"&bcy;"],[0,"&vcy;"],[0,"&gcy;"],[0,"&dcy;"],[0,"&iecy;"],[0,"&zhcy;"],[0,"&zcy;"],[0,"&icy;"],[0,"&jcy;"],[0,"&kcy;"],[0,"&lcy;"],[0,"&mcy;"],[0,"&ncy;"],[0,"&ocy;"],[0,"&pcy;"],[0,"&rcy;"],[0,"&scy;"],[0,"&tcy;"],[0,"&ucy;"],[0,"&fcy;"],[0,"&khcy;"],[0,"&tscy;"],[0,"&chcy;"],[0,"&shcy;"],[0,"&shchcy;"],[0,"&hardcy;"],[0,"&ycy;"],[0,"&softcy;"],[0,"&ecy;"],[0,"&yucy;"],[0,"&yacy;"],[1,"&iocy;"],[0,"&djcy;"],[0,"&gjcy;"],[0,"&jukcy;"],[0,"&dscy;"],[0,"&iukcy;"],[0,"&yicy;"],[0,"&jsercy;"],[0,"&ljcy;"],[0,"&njcy;"],[0,"&tshcy;"],[0,"&kjcy;"],[1,"&ubrcy;"],[0,"&dzcy;"],[7074,"&ensp;"],[0,"&emsp;"],[0,"&emsp13;"],[0,"&emsp14;"],[1,"&numsp;"],[0,"&puncsp;"],[0,"&ThinSpace;"],[0,"&hairsp;"],[0,"&NegativeMediumSpace;"],[0,"&zwnj;"],[0,"&zwj;"],[0,"&lrm;"],[0,"&rlm;"],[0,"&dash;"],[2,"&ndash;"],[0,"&mdash;"],[0,"&horbar;"],[0,"&Verbar;"],[1,"&lsquo;"],[0,"&CloseCurlyQuote;"],[0,"&lsquor;"],[1,"&ldquo;"],[0,"&CloseCurlyDoubleQuote;"],[0,"&bdquo;"],[1,"&dagger;"],[0,"&Dagger;"],[0,"&bull;"],[2,"&nldr;"],[0,"&hellip;"],[9,"&permil;"],[0,"&pertenk;"],[0,"&prime;"],[0,"&Prime;"],[0,"&tprime;"],[0,"&backprime;"],[3,"&lsaquo;"],[0,"&rsaquo;"],[3,"&oline;"],[2,"&caret;"],[1,"&hybull;"],[0,"&frasl;"],[10,"&bsemi;"],[7,"&qprime;"],[7,{v:"&MediumSpace;",n:8202,o:"&ThickSpace;"}],[0,"&NoBreak;"],[0,"&af;"],[0,"&InvisibleTimes;"],[0,"&ic;"],[72,"&euro;"],[46,"&tdot;"],[0,"&DotDot;"],[37,"&complexes;"],[2,"&incare;"],[4,"&gscr;"],[0,"&hamilt;"],[0,"&Hfr;"],[0,"&Hopf;"],[0,"&planckh;"],[0,"&hbar;"],[0,"&imagline;"],[0,"&Ifr;"],[0,"&lagran;"],[0,"&ell;"],[1,"&naturals;"],[0,"&numero;"],[0,"&copysr;"],[0,"&weierp;"],[0,"&Popf;"],[0,"&Qopf;"],[0,"&realine;"],[0,"&real;"],[0,"&reals;"],[0,"&rx;"],[3,"&trade;"],[1,"&integers;"],[2,"&mho;"],[0,"&zeetrf;"],[0,"&iiota;"],[2,"&bernou;"],[0,"&Cayleys;"],[1,"&escr;"],[0,"&Escr;"],[0,"&Fouriertrf;"],[1,"&Mellintrf;"],[0,"&order;"],[0,"&alefsym;"],[0,"&beth;"],[0,"&gimel;"],[0,"&daleth;"],[12,"&CapitalDifferentialD;"],[0,"&dd;"],[0,"&ee;"],[0,"&ii;"],[10,"&frac13;"],[0,"&frac23;"],[0,"&frac15;"],[0,"&frac25;"],[0,"&frac35;"],[0,"&frac45;"],[0,"&frac16;"],[0,"&frac56;"],[0,"&frac18;"],[0,"&frac38;"],[0,"&frac58;"],[0,"&frac78;"],[49,"&larr;"],[0,"&ShortUpArrow;"],[0,"&rarr;"],[0,"&darr;"],[0,"&harr;"],[0,"&updownarrow;"],[0,"&nwarr;"],[0,"&nearr;"],[0,"&LowerRightArrow;"],[0,"&LowerLeftArrow;"],[0,"&nlarr;"],[0,"&nrarr;"],[1,{v:"&rarrw;",n:824,o:"&nrarrw;"}],[0,"&Larr;"],[0,"&Uarr;"],[0,"&Rarr;"],[0,"&Darr;"],[0,"&larrtl;"],[0,"&rarrtl;"],[0,"&LeftTeeArrow;"],[0,"&mapstoup;"],[0,"&map;"],[0,"&DownTeeArrow;"],[1,"&hookleftarrow;"],[0,"&hookrightarrow;"],[0,"&larrlp;"],[0,"&looparrowright;"],[0,"&harrw;"],[0,"&nharr;"],[1,"&lsh;"],[0,"&rsh;"],[0,"&ldsh;"],[0,"&rdsh;"],[1,"&crarr;"],[0,"&cularr;"],[0,"&curarr;"],[2,"&circlearrowleft;"],[0,"&circlearrowright;"],[0,"&leftharpoonup;"],[0,"&DownLeftVector;"],[0,"&RightUpVector;"],[0,"&LeftUpVector;"],[0,"&rharu;"],[0,"&DownRightVector;"],[0,"&dharr;"],[0,"&dharl;"],[0,"&RightArrowLeftArrow;"],[0,"&udarr;"],[0,"&LeftArrowRightArrow;"],[0,"&leftleftarrows;"],[0,"&upuparrows;"],[0,"&rightrightarrows;"],[0,"&ddarr;"],[0,"&leftrightharpoons;"],[0,"&Equilibrium;"],[0,"&nlArr;"],[0,"&nhArr;"],[0,"&nrArr;"],[0,"&DoubleLeftArrow;"],[0,"&DoubleUpArrow;"],[0,"&DoubleRightArrow;"],[0,"&dArr;"],[0,"&DoubleLeftRightArrow;"],[0,"&DoubleUpDownArrow;"],[0,"&nwArr;"],[0,"&neArr;"],[0,"&seArr;"],[0,"&swArr;"],[0,"&lAarr;"],[0,"&rAarr;"],[1,"&zigrarr;"],[6,"&larrb;"],[0,"&rarrb;"],[15,"&DownArrowUpArrow;"],[7,"&loarr;"],[0,"&roarr;"],[0,"&hoarr;"],[0,"&forall;"],[0,"&comp;"],[0,{v:"&part;",n:824,o:"&npart;"}],[0,"&exist;"],[0,"&nexist;"],[0,"&empty;"],[1,"&Del;"],[0,"&Element;"],[0,"&NotElement;"],[1,"&ni;"],[0,"&notni;"],[2,"&prod;"],[0,"&coprod;"],[0,"&sum;"],[0,"&minus;"],[0,"&MinusPlus;"],[0,"&dotplus;"],[1,"&Backslash;"],[0,"&lowast;"],[0,"&compfn;"],[1,"&radic;"],[2,"&prop;"],[0,"&infin;"],[0,"&angrt;"],[0,{v:"&ang;",n:8402,o:"&nang;"}],[0,"&angmsd;"],[0,"&angsph;"],[0,"&mid;"],[0,"&nmid;"],[0,"&DoubleVerticalBar;"],[0,"&NotDoubleVerticalBar;"],[0,"&and;"],[0,"&or;"],[0,{v:"&cap;",n:65024,o:"&caps;"}],[0,{v:"&cup;",n:65024,o:"&cups;"}],[0,"&int;"],[0,"&Int;"],[0,"&iiint;"],[0,"&conint;"],[0,"&Conint;"],[0,"&Cconint;"],[0,"&cwint;"],[0,"&ClockwiseContourIntegral;"],[0,"&awconint;"],[0,"&there4;"],[0,"&becaus;"],[0,"&ratio;"],[0,"&Colon;"],[0,"&dotminus;"],[1,"&mDDot;"],[0,"&homtht;"],[0,{v:"&sim;",n:8402,o:"&nvsim;"}],[0,{v:"&backsim;",n:817,o:"&race;"}],[0,{v:"&ac;",n:819,o:"&acE;"}],[0,"&acd;"],[0,"&VerticalTilde;"],[0,"&NotTilde;"],[0,{v:"&eqsim;",n:824,o:"&nesim;"}],[0,"&sime;"],[0,"&NotTildeEqual;"],[0,"&cong;"],[0,"&simne;"],[0,"&ncong;"],[0,"&ap;"],[0,"&nap;"],[0,"&ape;"],[0,{v:"&apid;",n:824,o:"&napid;"}],[0,"&backcong;"],[0,{v:"&asympeq;",n:8402,o:"&nvap;"}],[0,{v:"&bump;",n:824,o:"&nbump;"}],[0,{v:"&bumpe;",n:824,o:"&nbumpe;"}],[0,{v:"&doteq;",n:824,o:"&nedot;"}],[0,"&doteqdot;"],[0,"&efDot;"],[0,"&erDot;"],[0,"&Assign;"],[0,"&ecolon;"],[0,"&ecir;"],[0,"&circeq;"],[1,"&wedgeq;"],[0,"&veeeq;"],[1,"&triangleq;"],[2,"&equest;"],[0,"&ne;"],[0,{v:"&Congruent;",n:8421,o:"&bnequiv;"}],[0,"&nequiv;"],[1,{v:"&le;",n:8402,o:"&nvle;"}],[0,{v:"&ge;",n:8402,o:"&nvge;"}],[0,{v:"&lE;",n:824,o:"&nlE;"}],[0,{v:"&gE;",n:824,o:"&ngE;"}],[0,{v:"&lnE;",n:65024,o:"&lvertneqq;"}],[0,{v:"&gnE;",n:65024,o:"&gvertneqq;"}],[0,{v:"&ll;",n:new Map(restoreDiff([[824,"&nLtv;"],[7577,"&nLt;"]]))}],[0,{v:"&gg;",n:new Map(restoreDiff([[824,"&nGtv;"],[7577,"&nGt;"]]))}],[0,"&between;"],[0,"&NotCupCap;"],[0,"&nless;"],[0,"&ngt;"],[0,"&nle;"],[0,"&nge;"],[0,"&lesssim;"],[0,"&GreaterTilde;"],[0,"&nlsim;"],[0,"&ngsim;"],[0,"&LessGreater;"],[0,"&gl;"],[0,"&NotLessGreater;"],[0,"&NotGreaterLess;"],[0,"&pr;"],[0,"&sc;"],[0,"&prcue;"],[0,"&sccue;"],[0,"&PrecedesTilde;"],[0,{v:"&scsim;",n:824,o:"&NotSucceedsTilde;"}],[0,"&NotPrecedes;"],[0,"&NotSucceeds;"],[0,{v:"&sub;",n:8402,o:"&NotSubset;"}],[0,{v:"&sup;",n:8402,o:"&NotSuperset;"}],[0,"&nsub;"],[0,"&nsup;"],[0,"&sube;"],[0,"&supe;"],[0,"&NotSubsetEqual;"],[0,"&NotSupersetEqual;"],[0,{v:"&subne;",n:65024,o:"&varsubsetneq;"}],[0,{v:"&supne;",n:65024,o:"&varsupsetneq;"}],[1,"&cupdot;"],[0,"&UnionPlus;"],[0,{v:"&sqsub;",n:824,o:"&NotSquareSubset;"}],[0,{v:"&sqsup;",n:824,o:"&NotSquareSuperset;"}],[0,"&sqsube;"],[0,"&sqsupe;"],[0,{v:"&sqcap;",n:65024,o:"&sqcaps;"}],[0,{v:"&sqcup;",n:65024,o:"&sqcups;"}],[0,"&CirclePlus;"],[0,"&CircleMinus;"],[0,"&CircleTimes;"],[0,"&osol;"],[0,"&CircleDot;"],[0,"&circledcirc;"],[0,"&circledast;"],[1,"&circleddash;"],[0,"&boxplus;"],[0,"&boxminus;"],[0,"&boxtimes;"],[0,"&dotsquare;"],[0,"&RightTee;"],[0,"&dashv;"],[0,"&DownTee;"],[0,"&bot;"],[1,"&models;"],[0,"&DoubleRightTee;"],[0,"&Vdash;"],[0,"&Vvdash;"],[0,"&VDash;"],[0,"&nvdash;"],[0,"&nvDash;"],[0,"&nVdash;"],[0,"&nVDash;"],[0,"&prurel;"],[1,"&LeftTriangle;"],[0,"&RightTriangle;"],[0,{v:"&LeftTriangleEqual;",n:8402,o:"&nvltrie;"}],[0,{v:"&RightTriangleEqual;",n:8402,o:"&nvrtrie;"}],[0,"&origof;"],[0,"&imof;"],[0,"&multimap;"],[0,"&hercon;"],[0,"&intcal;"],[0,"&veebar;"],[1,"&barvee;"],[0,"&angrtvb;"],[0,"&lrtri;"],[0,"&bigwedge;"],[0,"&bigvee;"],[0,"&bigcap;"],[0,"&bigcup;"],[0,"&diam;"],[0,"&sdot;"],[0,"&sstarf;"],[0,"&divideontimes;"],[0,"&bowtie;"],[0,"&ltimes;"],[0,"&rtimes;"],[0,"&leftthreetimes;"],[0,"&rightthreetimes;"],[0,"&backsimeq;"],[0,"&curlyvee;"],[0,"&curlywedge;"],[0,"&Sub;"],[0,"&Sup;"],[0,"&Cap;"],[0,"&Cup;"],[0,"&fork;"],[0,"&epar;"],[0,"&lessdot;"],[0,"&gtdot;"],[0,{v:"&Ll;",n:824,o:"&nLl;"}],[0,{v:"&Gg;",n:824,o:"&nGg;"}],[0,{v:"&leg;",n:65024,o:"&lesg;"}],[0,{v:"&gel;",n:65024,o:"&gesl;"}],[2,"&cuepr;"],[0,"&cuesc;"],[0,"&NotPrecedesSlantEqual;"],[0,"&NotSucceedsSlantEqual;"],[0,"&NotSquareSubsetEqual;"],[0,"&NotSquareSupersetEqual;"],[2,"&lnsim;"],[0,"&gnsim;"],[0,"&precnsim;"],[0,"&scnsim;"],[0,"&nltri;"],[0,"&NotRightTriangle;"],[0,"&nltrie;"],[0,"&NotRightTriangleEqual;"],[0,"&vellip;"],[0,"&ctdot;"],[0,"&utdot;"],[0,"&dtdot;"],[0,"&disin;"],[0,"&isinsv;"],[0,"&isins;"],[0,{v:"&isindot;",n:824,o:"&notindot;"}],[0,"&notinvc;"],[0,"&notinvb;"],[1,{v:"&isinE;",n:824,o:"&notinE;"}],[0,"&nisd;"],[0,"&xnis;"],[0,"&nis;"],[0,"&notnivc;"],[0,"&notnivb;"],[6,"&barwed;"],[0,"&Barwed;"],[1,"&lceil;"],[0,"&rceil;"],[0,"&LeftFloor;"],[0,"&rfloor;"],[0,"&drcrop;"],[0,"&dlcrop;"],[0,"&urcrop;"],[0,"&ulcrop;"],[0,"&bnot;"],[1,"&profline;"],[0,"&profsurf;"],[1,"&telrec;"],[0,"&target;"],[5,"&ulcorn;"],[0,"&urcorn;"],[0,"&dlcorn;"],[0,"&drcorn;"],[2,"&frown;"],[0,"&smile;"],[9,"&cylcty;"],[0,"&profalar;"],[7,"&topbot;"],[6,"&ovbar;"],[1,"&solbar;"],[60,"&angzarr;"],[51,"&lmoustache;"],[0,"&rmoustache;"],[2,"&OverBracket;"],[0,"&bbrk;"],[0,"&bbrktbrk;"],[37,"&OverParenthesis;"],[0,"&UnderParenthesis;"],[0,"&OverBrace;"],[0,"&UnderBrace;"],[2,"&trpezium;"],[4,"&elinters;"],[59,"&blank;"],[164,"&circledS;"],[55,"&boxh;"],[1,"&boxv;"],[9,"&boxdr;"],[3,"&boxdl;"],[3,"&boxur;"],[3,"&boxul;"],[3,"&boxvr;"],[7,"&boxvl;"],[7,"&boxhd;"],[7,"&boxhu;"],[7,"&boxvh;"],[19,"&boxH;"],[0,"&boxV;"],[0,"&boxdR;"],[0,"&boxDr;"],[0,"&boxDR;"],[0,"&boxdL;"],[0,"&boxDl;"],[0,"&boxDL;"],[0,"&boxuR;"],[0,"&boxUr;"],[0,"&boxUR;"],[0,"&boxuL;"],[0,"&boxUl;"],[0,"&boxUL;"],[0,"&boxvR;"],[0,"&boxVr;"],[0,"&boxVR;"],[0,"&boxvL;"],[0,"&boxVl;"],[0,"&boxVL;"],[0,"&boxHd;"],[0,"&boxhD;"],[0,"&boxHD;"],[0,"&boxHu;"],[0,"&boxhU;"],[0,"&boxHU;"],[0,"&boxvH;"],[0,"&boxVh;"],[0,"&boxVH;"],[19,"&uhblk;"],[3,"&lhblk;"],[3,"&block;"],[8,"&blk14;"],[0,"&blk12;"],[0,"&blk34;"],[13,"&square;"],[8,"&blacksquare;"],[0,"&EmptyVerySmallSquare;"],[1,"&rect;"],[0,"&marker;"],[2,"&fltns;"],[1,"&bigtriangleup;"],[0,"&blacktriangle;"],[0,"&triangle;"],[2,"&blacktriangleright;"],[0,"&rtri;"],[3,"&bigtriangledown;"],[0,"&blacktriangledown;"],[0,"&dtri;"],[2,"&blacktriangleleft;"],[0,"&ltri;"],[6,"&loz;"],[0,"&cir;"],[32,"&tridot;"],[2,"&bigcirc;"],[8,"&ultri;"],[0,"&urtri;"],[0,"&lltri;"],[0,"&EmptySmallSquare;"],[0,"&FilledSmallSquare;"],[8,"&bigstar;"],[0,"&star;"],[7,"&phone;"],[49,"&female;"],[1,"&male;"],[29,"&spades;"],[2,"&clubs;"],[1,"&hearts;"],[0,"&diamondsuit;"],[3,"&sung;"],[2,"&flat;"],[0,"&natural;"],[0,"&sharp;"],[163,"&check;"],[3,"&cross;"],[8,"&malt;"],[21,"&sext;"],[33,"&VerticalSeparator;"],[25,"&lbbrk;"],[0,"&rbbrk;"],[84,"&bsolhsub;"],[0,"&suphsol;"],[28,"&LeftDoubleBracket;"],[0,"&RightDoubleBracket;"],[0,"&lang;"],[0,"&rang;"],[0,"&Lang;"],[0,"&Rang;"],[0,"&loang;"],[0,"&roang;"],[7,"&longleftarrow;"],[0,"&longrightarrow;"],[0,"&longleftrightarrow;"],[0,"&DoubleLongLeftArrow;"],[0,"&DoubleLongRightArrow;"],[0,"&DoubleLongLeftRightArrow;"],[1,"&longmapsto;"],[2,"&dzigrarr;"],[258,"&nvlArr;"],[0,"&nvrArr;"],[0,"&nvHarr;"],[0,"&Map;"],[6,"&lbarr;"],[0,"&bkarow;"],[0,"&lBarr;"],[0,"&dbkarow;"],[0,"&drbkarow;"],[0,"&DDotrahd;"],[0,"&UpArrowBar;"],[0,"&DownArrowBar;"],[2,"&Rarrtl;"],[2,"&latail;"],[0,"&ratail;"],[0,"&lAtail;"],[0,"&rAtail;"],[0,"&larrfs;"],[0,"&rarrfs;"],[0,"&larrbfs;"],[0,"&rarrbfs;"],[2,"&nwarhk;"],[0,"&nearhk;"],[0,"&hksearow;"],[0,"&hkswarow;"],[0,"&nwnear;"],[0,"&nesear;"],[0,"&seswar;"],[0,"&swnwar;"],[8,{v:"&rarrc;",n:824,o:"&nrarrc;"}],[1,"&cudarrr;"],[0,"&ldca;"],[0,"&rdca;"],[0,"&cudarrl;"],[0,"&larrpl;"],[2,"&curarrm;"],[0,"&cularrp;"],[7,"&rarrpl;"],[2,"&harrcir;"],[0,"&Uarrocir;"],[0,"&lurdshar;"],[0,"&ldrushar;"],[2,"&LeftRightVector;"],[0,"&RightUpDownVector;"],[0,"&DownLeftRightVector;"],[0,"&LeftUpDownVector;"],[0,"&LeftVectorBar;"],[0,"&RightVectorBar;"],[0,"&RightUpVectorBar;"],[0,"&RightDownVectorBar;"],[0,"&DownLeftVectorBar;"],[0,"&DownRightVectorBar;"],[0,"&LeftUpVectorBar;"],[0,"&LeftDownVectorBar;"],[0,"&LeftTeeVector;"],[0,"&RightTeeVector;"],[0,"&RightUpTeeVector;"],[0,"&RightDownTeeVector;"],[0,"&DownLeftTeeVector;"],[0,"&DownRightTeeVector;"],[0,"&LeftUpTeeVector;"],[0,"&LeftDownTeeVector;"],[0,"&lHar;"],[0,"&uHar;"],[0,"&rHar;"],[0,"&dHar;"],[0,"&luruhar;"],[0,"&ldrdhar;"],[0,"&ruluhar;"],[0,"&rdldhar;"],[0,"&lharul;"],[0,"&llhard;"],[0,"&rharul;"],[0,"&lrhard;"],[0,"&udhar;"],[0,"&duhar;"],[0,"&RoundImplies;"],[0,"&erarr;"],[0,"&simrarr;"],[0,"&larrsim;"],[0,"&rarrsim;"],[0,"&rarrap;"],[0,"&ltlarr;"],[1,"&gtrarr;"],[0,"&subrarr;"],[1,"&suplarr;"],[0,"&lfisht;"],[0,"&rfisht;"],[0,"&ufisht;"],[0,"&dfisht;"],[5,"&lopar;"],[0,"&ropar;"],[4,"&lbrke;"],[0,"&rbrke;"],[0,"&lbrkslu;"],[0,"&rbrksld;"],[0,"&lbrksld;"],[0,"&rbrkslu;"],[0,"&langd;"],[0,"&rangd;"],[0,"&lparlt;"],[0,"&rpargt;"],[0,"&gtlPar;"],[0,"&ltrPar;"],[3,"&vzigzag;"],[1,"&vangrt;"],[0,"&angrtvbd;"],[6,"&ange;"],[0,"&range;"],[0,"&dwangle;"],[0,"&uwangle;"],[0,"&angmsdaa;"],[0,"&angmsdab;"],[0,"&angmsdac;"],[0,"&angmsdad;"],[0,"&angmsdae;"],[0,"&angmsdaf;"],[0,"&angmsdag;"],[0,"&angmsdah;"],[0,"&bemptyv;"],[0,"&demptyv;"],[0,"&cemptyv;"],[0,"&raemptyv;"],[0,"&laemptyv;"],[0,"&ohbar;"],[0,"&omid;"],[0,"&opar;"],[1,"&operp;"],[1,"&olcross;"],[0,"&odsold;"],[1,"&olcir;"],[0,"&ofcir;"],[0,"&olt;"],[0,"&ogt;"],[0,"&cirscir;"],[0,"&cirE;"],[0,"&solb;"],[0,"&bsolb;"],[3,"&boxbox;"],[3,"&trisb;"],[0,"&rtriltri;"],[0,{v:"&LeftTriangleBar;",n:824,o:"&NotLeftTriangleBar;"}],[0,{v:"&RightTriangleBar;",n:824,o:"&NotRightTriangleBar;"}],[11,"&iinfin;"],[0,"&infintie;"],[0,"&nvinfin;"],[4,"&eparsl;"],[0,"&smeparsl;"],[0,"&eqvparsl;"],[5,"&blacklozenge;"],[8,"&RuleDelayed;"],[1,"&dsol;"],[9,"&bigodot;"],[0,"&bigoplus;"],[0,"&bigotimes;"],[1,"&biguplus;"],[1,"&bigsqcup;"],[5,"&iiiint;"],[0,"&fpartint;"],[2,"&cirfnint;"],[0,"&awint;"],[0,"&rppolint;"],[0,"&scpolint;"],[0,"&npolint;"],[0,"&pointint;"],[0,"&quatint;"],[0,"&intlarhk;"],[10,"&pluscir;"],[0,"&plusacir;"],[0,"&simplus;"],[0,"&plusdu;"],[0,"&plussim;"],[0,"&plustwo;"],[1,"&mcomma;"],[0,"&minusdu;"],[2,"&loplus;"],[0,"&roplus;"],[0,"&Cross;"],[0,"&timesd;"],[0,"&timesbar;"],[1,"&smashp;"],[0,"&lotimes;"],[0,"&rotimes;"],[0,"&otimesas;"],[0,"&Otimes;"],[0,"&odiv;"],[0,"&triplus;"],[0,"&triminus;"],[0,"&tritime;"],[0,"&intprod;"],[2,"&amalg;"],[0,"&capdot;"],[1,"&ncup;"],[0,"&ncap;"],[0,"&capand;"],[0,"&cupor;"],[0,"&cupcap;"],[0,"&capcup;"],[0,"&cupbrcap;"],[0,"&capbrcup;"],[0,"&cupcup;"],[0,"&capcap;"],[0,"&ccups;"],[0,"&ccaps;"],[2,"&ccupssm;"],[2,"&And;"],[0,"&Or;"],[0,"&andand;"],[0,"&oror;"],[0,"&orslope;"],[0,"&andslope;"],[1,"&andv;"],[0,"&orv;"],[0,"&andd;"],[0,"&ord;"],[1,"&wedbar;"],[6,"&sdote;"],[3,"&simdot;"],[2,{v:"&congdot;",n:824,o:"&ncongdot;"}],[0,"&easter;"],[0,"&apacir;"],[0,{v:"&apE;",n:824,o:"&napE;"}],[0,"&eplus;"],[0,"&pluse;"],[0,"&Esim;"],[0,"&Colone;"],[0,"&Equal;"],[1,"&ddotseq;"],[0,"&equivDD;"],[0,"&ltcir;"],[0,"&gtcir;"],[0,"&ltquest;"],[0,"&gtquest;"],[0,{v:"&leqslant;",n:824,o:"&nleqslant;"}],[0,{v:"&geqslant;",n:824,o:"&ngeqslant;"}],[0,"&lesdot;"],[0,"&gesdot;"],[0,"&lesdoto;"],[0,"&gesdoto;"],[0,"&lesdotor;"],[0,"&gesdotol;"],[0,"&lap;"],[0,"&gap;"],[0,"&lne;"],[0,"&gne;"],[0,"&lnap;"],[0,"&gnap;"],[0,"&lEg;"],[0,"&gEl;"],[0,"&lsime;"],[0,"&gsime;"],[0,"&lsimg;"],[0,"&gsiml;"],[0,"&lgE;"],[0,"&glE;"],[0,"&lesges;"],[0,"&gesles;"],[0,"&els;"],[0,"&egs;"],[0,"&elsdot;"],[0,"&egsdot;"],[0,"&el;"],[0,"&eg;"],[2,"&siml;"],[0,"&simg;"],[0,"&simlE;"],[0,"&simgE;"],[0,{v:"&LessLess;",n:824,o:"&NotNestedLessLess;"}],[0,{v:"&GreaterGreater;",n:824,o:"&NotNestedGreaterGreater;"}],[1,"&glj;"],[0,"&gla;"],[0,"&ltcc;"],[0,"&gtcc;"],[0,"&lescc;"],[0,"&gescc;"],[0,"&smt;"],[0,"&lat;"],[0,{v:"&smte;",n:65024,o:"&smtes;"}],[0,{v:"&late;",n:65024,o:"&lates;"}],[0,"&bumpE;"],[0,{v:"&PrecedesEqual;",n:824,o:"&NotPrecedesEqual;"}],[0,{v:"&sce;",n:824,o:"&NotSucceedsEqual;"}],[2,"&prE;"],[0,"&scE;"],[0,"&precneqq;"],[0,"&scnE;"],[0,"&prap;"],[0,"&scap;"],[0,"&precnapprox;"],[0,"&scnap;"],[0,"&Pr;"],[0,"&Sc;"],[0,"&subdot;"],[0,"&supdot;"],[0,"&subplus;"],[0,"&supplus;"],[0,"&submult;"],[0,"&supmult;"],[0,"&subedot;"],[0,"&supedot;"],[0,{v:"&subE;",n:824,o:"&nsubE;"}],[0,{v:"&supE;",n:824,o:"&nsupE;"}],[0,"&subsim;"],[0,"&supsim;"],[2,{v:"&subnE;",n:65024,o:"&varsubsetneqq;"}],[0,{v:"&supnE;",n:65024,o:"&varsupsetneqq;"}],[2,"&csub;"],[0,"&csup;"],[0,"&csube;"],[0,"&csupe;"],[0,"&subsup;"],[0,"&supsub;"],[0,"&subsub;"],[0,"&supsup;"],[0,"&suphsub;"],[0,"&supdsub;"],[0,"&forkv;"],[0,"&topfork;"],[0,"&mlcp;"],[8,"&Dashv;"],[1,"&Vdashl;"],[0,"&Barv;"],[0,"&vBar;"],[0,"&vBarv;"],[1,"&Vbar;"],[0,"&Not;"],[0,"&bNot;"],[0,"&rnmid;"],[0,"&cirmid;"],[0,"&midcir;"],[0,"&topcir;"],[0,"&nhpar;"],[0,"&parsim;"],[9,{v:"&parsl;",n:8421,o:"&nparsl;"}],[44343,{n:new Map(restoreDiff([[56476,"&Ascr;"],[1,"&Cscr;"],[0,"&Dscr;"],[2,"&Gscr;"],[2,"&Jscr;"],[0,"&Kscr;"],[2,"&Nscr;"],[0,"&Oscr;"],[0,"&Pscr;"],[0,"&Qscr;"],[1,"&Sscr;"],[0,"&Tscr;"],[0,"&Uscr;"],[0,"&Vscr;"],[0,"&Wscr;"],[0,"&Xscr;"],[0,"&Yscr;"],[0,"&Zscr;"],[0,"&ascr;"],[0,"&bscr;"],[0,"&cscr;"],[0,"&dscr;"],[1,"&fscr;"],[1,"&hscr;"],[0,"&iscr;"],[0,"&jscr;"],[0,"&kscr;"],[0,"&lscr;"],[0,"&mscr;"],[0,"&nscr;"],[1,"&pscr;"],[0,"&qscr;"],[0,"&rscr;"],[0,"&sscr;"],[0,"&tscr;"],[0,"&uscr;"],[0,"&vscr;"],[0,"&wscr;"],[0,"&xscr;"],[0,"&yscr;"],[0,"&zscr;"],[52,"&Afr;"],[0,"&Bfr;"],[1,"&Dfr;"],[0,"&Efr;"],[0,"&Ffr;"],[0,"&Gfr;"],[2,"&Jfr;"],[0,"&Kfr;"],[0,"&Lfr;"],[0,"&Mfr;"],[0,"&Nfr;"],[0,"&Ofr;"],[0,"&Pfr;"],[0,"&Qfr;"],[1,"&Sfr;"],[0,"&Tfr;"],[0,"&Ufr;"],[0,"&Vfr;"],[0,"&Wfr;"],[0,"&Xfr;"],[0,"&Yfr;"],[1,"&afr;"],[0,"&bfr;"],[0,"&cfr;"],[0,"&dfr;"],[0,"&efr;"],[0,"&ffr;"],[0,"&gfr;"],[0,"&hfr;"],[0,"&ifr;"],[0,"&jfr;"],[0,"&kfr;"],[0,"&lfr;"],[0,"&mfr;"],[0,"&nfr;"],[0,"&ofr;"],[0,"&pfr;"],[0,"&qfr;"],[0,"&rfr;"],[0,"&sfr;"],[0,"&tfr;"],[0,"&ufr;"],[0,"&vfr;"],[0,"&wfr;"],[0,"&xfr;"],[0,"&yfr;"],[0,"&zfr;"],[0,"&Aopf;"],[0,"&Bopf;"],[1,"&Dopf;"],[0,"&Eopf;"],[0,"&Fopf;"],[0,"&Gopf;"],[1,"&Iopf;"],[0,"&Jopf;"],[0,"&Kopf;"],[0,"&Lopf;"],[0,"&Mopf;"],[1,"&Oopf;"],[3,"&Sopf;"],[0,"&Topf;"],[0,"&Uopf;"],[0,"&Vopf;"],[0,"&Wopf;"],[0,"&Xopf;"],[0,"&Yopf;"],[1,"&aopf;"],[0,"&bopf;"],[0,"&copf;"],[0,"&dopf;"],[0,"&eopf;"],[0,"&fopf;"],[0,"&gopf;"],[0,"&hopf;"],[0,"&iopf;"],[0,"&jopf;"],[0,"&kopf;"],[0,"&lopf;"],[0,"&mopf;"],[0,"&nopf;"],[0,"&oopf;"],[0,"&popf;"],[0,"&qopf;"],[0,"&ropf;"],[0,"&sopf;"],[0,"&topf;"],[0,"&uopf;"],[0,"&vopf;"],[0,"&wopf;"],[0,"&xopf;"],[0,"&yopf;"],[0,"&zopf;"]]))}],[8906,"&fflig;"],[0,"&filig;"],[0,"&fllig;"],[0,"&ffilig;"],[0,"&ffllig;"]]));var _escape={};(function(fe){Object.defineProperty(fe,"__esModule",{value:!0}),fe.escapeText=fe.escapeAttribute=fe.escapeUTF8=fe.escape=fe.encodeXML=fe.getCodePoint=fe.xmlReplacer=void 0,fe.xmlReplacer=/["&'<>$\x80-\uFFFF]/g;var ee=new Map([[34,"&quot;"],[38,"&amp;"],[39,"&apos;"],[60,"&lt;"],[62,"&gt;"]]);fe.getCodePoint=String.prototype.codePointAt!=null?function(_e,Ne){return _e.codePointAt(Ne)}:function(_e,Ne){return(_e.charCodeAt(Ne)&64512)===55296?(_e.charCodeAt(Ne)-55296)*1024+_e.charCodeAt(Ne+1)-56320+65536:_e.charCodeAt(Ne)};function ue(_e){for(var Ne="",Ue=0,Ge;(Ge=fe.xmlReplacer.exec(_e))!==null;){var qe=Ge.index,Ke=_e.charCodeAt(qe),Ye=ee.get(Ke);Ye!==void 0?(Ne+=_e.substring(Ue,qe)+Ye,Ue=qe+1):(Ne+="".concat(_e.substring(Ue,qe),"&#x").concat((0,fe.getCodePoint)(_e,qe).toString(16),";"),Ue=fe.xmlReplacer.lastIndex+=+((Ke&64512)===55296))}return Ne+_e.substr(Ue)}fe.encodeXML=ue,fe.escape=ue;function pe(_e,Ne){return function(Ge){for(var qe,Ke=0,Ye="";qe=_e.exec(Ge);)Ke!==qe.index&&(Ye+=Ge.substring(Ke,qe.index)),Ye+=Ne.get(qe[0].charCodeAt(0)),Ke=qe.index+1;return Ye+Ge.substring(Ke)}}fe.escapeUTF8=pe(/[&<>'"]/g,ee),fe.escapeAttribute=pe(/["&\u00A0]/g,new Map([[34,"&quot;"],[38,"&amp;"],[160,"&nbsp;"]])),fe.escapeText=pe(/[&<>\u00A0]/g,new Map([[38,"&amp;"],[60,"&lt;"],[62,"&gt;"],[160,"&nbsp;"]]))})(_escape);var __importDefault$1=commonjsGlobal&&commonjsGlobal.__importDefault||function(fe){return fe&&fe.__esModule?fe:{default:fe}};Object.defineProperty(encode,"__esModule",{value:!0});encode.encodeNonAsciiHTML=encode.encodeHTML=void 0;var encode_html_js_1=__importDefault$1(encodeHtml),escape_js_1=_escape,htmlReplacer=/[\t\n!-,./:-@[-`\f{-}$\x80-\uFFFF]/g;function encodeHTML(fe){return encodeHTMLTrieRe(htmlReplacer,fe)}encode.encodeHTML=encodeHTML;function encodeNonAsciiHTML(fe){return encodeHTMLTrieRe(escape_js_1.xmlReplacer,fe)}encode.encodeNonAsciiHTML=encodeNonAsciiHTML;function encodeHTMLTrieRe(fe,ee){for(var ue="",pe=0,_e;(_e=fe.exec(ee))!==null;){var Ne=_e.index;ue+=ee.substring(pe,Ne);var Ue=ee.charCodeAt(Ne),Ge=encode_html_js_1.default.get(Ue);if(typeof Ge=="object"){if(Ne+1<ee.length){var qe=ee.charCodeAt(Ne+1),Ke=typeof Ge.n=="number"?Ge.n===qe?Ge.o:void 0:Ge.n.get(qe);if(Ke!==void 0){ue+=Ke,pe=fe.lastIndex+=1;continue}}Ge=Ge.v}if(Ge!==void 0)ue+=Ge,pe=Ne+1;else{var Ye=(0,escape_js_1.getCodePoint)(ee,Ne);ue+="&#x".concat(Ye.toString(16),";"),pe=fe.lastIndex+=+(Ye!==Ue)}}return ue+ee.substr(pe)}(function(fe){Object.defineProperty(fe,"__esModule",{value:!0}),fe.decodeXMLStrict=fe.decodeHTML5Strict=fe.decodeHTML4Strict=fe.decodeHTML5=fe.decodeHTML4=fe.decodeHTMLAttribute=fe.decodeHTMLStrict=fe.decodeHTML=fe.decodeXML=fe.DecodingMode=fe.EntityDecoder=fe.encodeHTML5=fe.encodeHTML4=fe.encodeNonAsciiHTML=fe.encodeHTML=fe.escapeText=fe.escapeAttribute=fe.escapeUTF8=fe.escape=fe.encodeXML=fe.encode=fe.decodeStrict=fe.decode=fe.EncodingMode=fe.EntityLevel=void 0;var ee=decode,ue=encode,pe=_escape,_e;(function(Xe){Xe[Xe.XML=0]="XML",Xe[Xe.HTML=1]="HTML"})(_e=fe.EntityLevel||(fe.EntityLevel={}));var Ne;(function(Xe){Xe[Xe.UTF8=0]="UTF8",Xe[Xe.ASCII=1]="ASCII",Xe[Xe.Extensive=2]="Extensive",Xe[Xe.Attribute=3]="Attribute",Xe[Xe.Text=4]="Text"})(Ne=fe.EncodingMode||(fe.EncodingMode={}));function Ue(Xe,Je){Je===void 0&&(Je=_e.XML);var tt=typeof Je=="number"?Je:Je.level;if(tt===_e.HTML){var rt=typeof Je=="object"?Je.mode:void 0;return(0,ee.decodeHTML)(Xe,rt)}return(0,ee.decodeXML)(Xe)}fe.decode=Ue;function Ge(Xe,Je){var tt;Je===void 0&&(Je=_e.XML);var rt=typeof Je=="number"?{level:Je}:Je;return(tt=rt.mode)!==null&&tt!==void 0||(rt.mode=ee.DecodingMode.Strict),Ue(Xe,rt)}fe.decodeStrict=Ge;function qe(Xe,Je){Je===void 0&&(Je=_e.XML);var tt=typeof Je=="number"?{level:Je}:Je;return tt.mode===Ne.UTF8?(0,pe.escapeUTF8)(Xe):tt.mode===Ne.Attribute?(0,pe.escapeAttribute)(Xe):tt.mode===Ne.Text?(0,pe.escapeText)(Xe):tt.level===_e.HTML?tt.mode===Ne.ASCII?(0,ue.encodeNonAsciiHTML)(Xe):(0,ue.encodeHTML)(Xe):(0,pe.encodeXML)(Xe)}fe.encode=qe;var Ke=_escape;Object.defineProperty(fe,"encodeXML",{enumerable:!0,get:function(){return Ke.encodeXML}}),Object.defineProperty(fe,"escape",{enumerable:!0,get:function(){return Ke.escape}}),Object.defineProperty(fe,"escapeUTF8",{enumerable:!0,get:function(){return Ke.escapeUTF8}}),Object.defineProperty(fe,"escapeAttribute",{enumerable:!0,get:function(){return Ke.escapeAttribute}}),Object.defineProperty(fe,"escapeText",{enumerable:!0,get:function(){return Ke.escapeText}});var Ye=encode;Object.defineProperty(fe,"encodeHTML",{enumerable:!0,get:function(){return Ye.encodeHTML}}),Object.defineProperty(fe,"encodeNonAsciiHTML",{enumerable:!0,get:function(){return Ye.encodeNonAsciiHTML}}),Object.defineProperty(fe,"encodeHTML4",{enumerable:!0,get:function(){return Ye.encodeHTML}}),Object.defineProperty(fe,"encodeHTML5",{enumerable:!0,get:function(){return Ye.encodeHTML}});var Ze=decode;Object.defineProperty(fe,"EntityDecoder",{enumerable:!0,get:function(){return Ze.EntityDecoder}}),Object.defineProperty(fe,"DecodingMode",{enumerable:!0,get:function(){return Ze.DecodingMode}}),Object.defineProperty(fe,"decodeXML",{enumerable:!0,get:function(){return Ze.decodeXML}}),Object.defineProperty(fe,"decodeHTML",{enumerable:!0,get:function(){return Ze.decodeHTML}}),Object.defineProperty(fe,"decodeHTMLStrict",{enumerable:!0,get:function(){return Ze.decodeHTMLStrict}}),Object.defineProperty(fe,"decodeHTMLAttribute",{enumerable:!0,get:function(){return Ze.decodeHTMLAttribute}}),Object.defineProperty(fe,"decodeHTML4",{enumerable:!0,get:function(){return Ze.decodeHTML}}),Object.defineProperty(fe,"decodeHTML5",{enumerable:!0,get:function(){return Ze.decodeHTML}}),Object.defineProperty(fe,"decodeHTML4Strict",{enumerable:!0,get:function(){return Ze.decodeHTMLStrict}}),Object.defineProperty(fe,"decodeHTML5Strict",{enumerable:!0,get:function(){return Ze.decodeHTMLStrict}}),Object.defineProperty(fe,"decodeXMLStrict",{enumerable:!0,get:function(){return Ze.decodeXML}})})(lib);var foreignNames={};Object.defineProperty(foreignNames,"__esModule",{value:!0});foreignNames.attributeNames=foreignNames.elementNames=void 0;foreignNames.elementNames=new Map(["altGlyph","altGlyphDef","altGlyphItem","animateColor","animateMotion","animateTransform","clipPath","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","foreignObject","glyphRef","linearGradient","radialGradient","textPath"].map(function(fe){return[fe.toLowerCase(),fe]}));foreignNames.attributeNames=new Map(["definitionURL","attributeName","attributeType","baseFrequency","baseProfile","calcMode","clipPathUnits","diffuseConstant","edgeMode","filterUnits","glyphRef","gradientTransform","gradientUnits","kernelMatrix","kernelUnitLength","keyPoints","keySplines","keyTimes","lengthAdjust","limitingConeAngle","markerHeight","markerUnits","markerWidth","maskContentUnits","maskUnits","numOctaves","pathLength","patternContentUnits","patternTransform","patternUnits","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","refX","refY","repeatCount","repeatDur","requiredExtensions","requiredFeatures","specularConstant","specularExponent","spreadMethod","startOffset","stdDeviation","stitchTiles","surfaceScale","systemLanguage","tableValues","targetX","targetY","textLength","viewBox","viewTarget","xChannelSelector","yChannelSelector","zoomAndPan"].map(function(fe){return[fe.toLowerCase(),fe]}));var __assign$1=commonjsGlobal&&commonjsGlobal.__assign||function(){return __assign$1=Object.assign||function(fe){for(var ee,ue=1,pe=arguments.length;ue<pe;ue++){ee=arguments[ue];for(var _e in ee)Object.prototype.hasOwnProperty.call(ee,_e)&&(fe[_e]=ee[_e])}return fe},__assign$1.apply(this,arguments)},__createBinding=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(fe,ee,ue,pe){pe===void 0&&(pe=ue);var _e=Object.getOwnPropertyDescriptor(ee,ue);(!_e||("get"in _e?!ee.__esModule:_e.writable||_e.configurable))&&(_e={enumerable:!0,get:function(){return ee[ue]}}),Object.defineProperty(fe,pe,_e)}:function(fe,ee,ue,pe){pe===void 0&&(pe=ue),fe[pe]=ee[ue]}),__setModuleDefault=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(fe,ee){Object.defineProperty(fe,"default",{enumerable:!0,value:ee})}:function(fe,ee){fe.default=ee}),__importStar=commonjsGlobal&&commonjsGlobal.__importStar||function(fe){if(fe&&fe.__esModule)return fe;var ee={};if(fe!=null)for(var ue in fe)ue!=="default"&&Object.prototype.hasOwnProperty.call(fe,ue)&&__createBinding(ee,fe,ue);return __setModuleDefault(ee,fe),ee};Object.defineProperty(lib$1,"__esModule",{value:!0});lib$1.render=void 0;var ElementType=__importStar(lib$3),entities_1=lib,foreignNames_js_1=foreignNames,unencodedElements=new Set(["style","script","xmp","iframe","noembed","noframes","plaintext","noscript"]);function replaceQuotes(fe){return fe.replace(/"/g,"&quot;")}function formatAttributes(fe,ee){var ue;if(fe){var pe=((ue=ee.encodeEntities)!==null&&ue!==void 0?ue:ee.decodeEntities)===!1?replaceQuotes:ee.xmlMode||ee.encodeEntities!=="utf8"?entities_1.encodeXML:entities_1.escapeAttribute;return Object.keys(fe).map(function(_e){var Ne,Ue,Ge=(Ne=fe[_e])!==null&&Ne!==void 0?Ne:"";return ee.xmlMode==="foreign"&&(_e=(Ue=foreignNames_js_1.attributeNames.get(_e))!==null&&Ue!==void 0?Ue:_e),!ee.emptyAttrs&&!ee.xmlMode&&Ge===""?_e:"".concat(_e,'="').concat(pe(Ge),'"')}).join(" ")}}var singleTag=new Set(["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"]);function render(fe,ee){ee===void 0&&(ee={});for(var ue=("length"in fe)?fe:[fe],pe="",_e=0;_e<ue.length;_e++)pe+=renderNode(ue[_e],ee);return pe}lib$1.render=render;lib$1.default=render;function renderNode(fe,ee){switch(fe.type){case ElementType.Root:return render(fe.children,ee);case ElementType.Doctype:case ElementType.Directive:return renderDirective(fe);case ElementType.Comment:return renderComment(fe);case ElementType.CDATA:return renderCdata(fe);case ElementType.Script:case ElementType.Style:case ElementType.Tag:return renderTag(fe,ee);case ElementType.Text:return renderText(fe,ee)}}var foreignModeIntegrationPoints=new Set(["mi","mo","mn","ms","mtext","annotation-xml","foreignObject","desc","title"]),foreignElements=new Set(["svg","math"]);function renderTag(fe,ee){var ue;ee.xmlMode==="foreign"&&(fe.name=(ue=foreignNames_js_1.elementNames.get(fe.name))!==null&&ue!==void 0?ue:fe.name,fe.parent&&foreignModeIntegrationPoints.has(fe.parent.name)&&(ee=__assign$1(__assign$1({},ee),{xmlMode:!1}))),!ee.xmlMode&&foreignElements.has(fe.name)&&(ee=__assign$1(__assign$1({},ee),{xmlMode:"foreign"}));var pe="<".concat(fe.name),_e=formatAttributes(fe.attribs,ee);return _e&&(pe+=" ".concat(_e)),fe.children.length===0&&(ee.xmlMode?ee.selfClosingTags!==!1:ee.selfClosingTags&&singleTag.has(fe.name))?(ee.xmlMode||(pe+=" "),pe+="/>"):(pe+=">",fe.children.length>0&&(pe+=render(fe.children,ee)),(ee.xmlMode||!singleTag.has(fe.name))&&(pe+="</".concat(fe.name,">"))),pe}function renderDirective(fe){return"<".concat(fe.data,">")}function renderText(fe,ee){var ue,pe=fe.data||"";return((ue=ee.encodeEntities)!==null&&ue!==void 0?ue:ee.decodeEntities)!==!1&&!(!ee.xmlMode&&fe.parent&&unencodedElements.has(fe.parent.name))&&(pe=ee.xmlMode||ee.encodeEntities!=="utf8"?(0,entities_1.encodeXML)(pe):(0,entities_1.escapeText)(pe)),pe}function renderCdata(fe){return"<![CDATA[".concat(fe.children[0].data,"]]>")}function renderComment(fe){return"<!--".concat(fe.data,"-->")}var __importDefault=commonjsGlobal&&commonjsGlobal.__importDefault||function(fe){return fe&&fe.__esModule?fe:{default:fe}};Object.defineProperty(stringify$5,"__esModule",{value:!0});stringify$5.innerText=stringify$5.textContent=stringify$5.getText=stringify$5.getInnerHTML=stringify$5.getOuterHTML=void 0;var domhandler_1$3=lib$4,dom_serializer_1=__importDefault(lib$1),domelementtype_1=lib$3;function getOuterHTML(fe,ee){return(0,dom_serializer_1.default)(fe,ee)}stringify$5.getOuterHTML=getOuterHTML;function getInnerHTML(fe,ee){return(0,domhandler_1$3.hasChildren)(fe)?fe.children.map(function(ue){return getOuterHTML(ue,ee)}).join(""):""}stringify$5.getInnerHTML=getInnerHTML;function getText(fe){return Array.isArray(fe)?fe.map(getText).join(""):(0,domhandler_1$3.isTag)(fe)?fe.name==="br"?`
`:getText(fe.children):(0,domhandler_1$3.isCDATA)(fe)?getText(fe.children):(0,domhandler_1$3.isText)(fe)?fe.data:""}stringify$5.getText=getText;function textContent(fe){return Array.isArray(fe)?fe.map(textContent).join(""):(0,domhandler_1$3.hasChildren)(fe)&&!(0,domhandler_1$3.isComment)(fe)?textContent(fe.children):(0,domhandler_1$3.isText)(fe)?fe.data:""}stringify$5.textContent=textContent;function innerText(fe){return Array.isArray(fe)?fe.map(innerText).join(""):(0,domhandler_1$3.hasChildren)(fe)&&(fe.type===domelementtype_1.ElementType.Tag||(0,domhandler_1$3.isCDATA)(fe))?innerText(fe.children):(0,domhandler_1$3.isText)(fe)?fe.data:""}stringify$5.innerText=innerText;var traversal={};Object.defineProperty(traversal,"__esModule",{value:!0});traversal.prevElementSibling=traversal.nextElementSibling=traversal.getName=traversal.hasAttrib=traversal.getAttributeValue=traversal.getSiblings=traversal.getParent=traversal.getChildren=void 0;var domhandler_1$2=lib$4;function getChildren(fe){return(0,domhandler_1$2.hasChildren)(fe)?fe.children:[]}traversal.getChildren=getChildren;function getParent(fe){return fe.parent||null}traversal.getParent=getParent;function getSiblings(fe){var ee,ue,pe=getParent(fe);if(pe!=null)return getChildren(pe);for(var _e=[fe],Ne=fe.prev,Ue=fe.next;Ne!=null;)_e.unshift(Ne),ee=Ne,Ne=ee.prev;for(;Ue!=null;)_e.push(Ue),ue=Ue,Ue=ue.next;return _e}traversal.getSiblings=getSiblings;function getAttributeValue(fe,ee){var ue;return(ue=fe.attribs)===null||ue===void 0?void 0:ue[ee]}traversal.getAttributeValue=getAttributeValue;function hasAttrib(fe,ee){return fe.attribs!=null&&Object.prototype.hasOwnProperty.call(fe.attribs,ee)&&fe.attribs[ee]!=null}traversal.hasAttrib=hasAttrib;function getName(fe){return fe.name}traversal.getName=getName;function nextElementSibling(fe){for(var ee,ue=fe.next;ue!==null&&!(0,domhandler_1$2.isTag)(ue);)ee=ue,ue=ee.next;return ue}traversal.nextElementSibling=nextElementSibling;function prevElementSibling(fe){for(var ee,ue=fe.prev;ue!==null&&!(0,domhandler_1$2.isTag)(ue);)ee=ue,ue=ee.prev;return ue}traversal.prevElementSibling=prevElementSibling;var manipulation={};Object.defineProperty(manipulation,"__esModule",{value:!0});manipulation.prepend=manipulation.prependChild=manipulation.append=manipulation.appendChild=manipulation.replaceElement=manipulation.removeElement=void 0;function removeElement(fe){if(fe.prev&&(fe.prev.next=fe.next),fe.next&&(fe.next.prev=fe.prev),fe.parent){var ee=fe.parent.children,ue=ee.lastIndexOf(fe);ue>=0&&ee.splice(ue,1)}fe.next=null,fe.prev=null,fe.parent=null}manipulation.removeElement=removeElement;function replaceElement(fe,ee){var ue=ee.prev=fe.prev;ue&&(ue.next=ee);var pe=ee.next=fe.next;pe&&(pe.prev=ee);var _e=ee.parent=fe.parent;if(_e){var Ne=_e.children;Ne[Ne.lastIndexOf(fe)]=ee,fe.parent=null}}manipulation.replaceElement=replaceElement;function appendChild(fe,ee){if(removeElement(ee),ee.next=null,ee.parent=fe,fe.children.push(ee)>1){var ue=fe.children[fe.children.length-2];ue.next=ee,ee.prev=ue}else ee.prev=null}manipulation.appendChild=appendChild;function append(fe,ee){removeElement(ee);var ue=fe.parent,pe=fe.next;if(ee.next=pe,ee.prev=fe,fe.next=ee,ee.parent=ue,pe){if(pe.prev=ee,ue){var _e=ue.children;_e.splice(_e.lastIndexOf(pe),0,ee)}}else ue&&ue.children.push(ee)}manipulation.append=append;function prependChild(fe,ee){if(removeElement(ee),ee.parent=fe,ee.prev=null,fe.children.unshift(ee)!==1){var ue=fe.children[1];ue.prev=ee,ee.next=ue}else ee.next=null}manipulation.prependChild=prependChild;function prepend(fe,ee){removeElement(ee);var ue=fe.parent;if(ue){var pe=ue.children;pe.splice(pe.indexOf(fe),0,ee)}fe.prev&&(fe.prev.next=ee),ee.parent=ue,ee.prev=fe.prev,ee.next=fe,fe.prev=ee}manipulation.prepend=prepend;var querying={};Object.defineProperty(querying,"__esModule",{value:!0});querying.findAll=querying.existsOne=querying.findOne=querying.findOneChild=querying.find=querying.filter=void 0;var domhandler_1$1=lib$4;function filter$1(fe,ee,ue,pe){return ue===void 0&&(ue=!0),pe===void 0&&(pe=1/0),find(fe,Array.isArray(ee)?ee:[ee],ue,pe)}querying.filter=filter$1;function find(fe,ee,ue,pe){for(var _e=[],Ne=[ee],Ue=[0];;){if(Ue[0]>=Ne[0].length){if(Ue.length===1)return _e;Ne.shift(),Ue.shift();continue}var Ge=Ne[0][Ue[0]++];if(fe(Ge)&&(_e.push(Ge),--pe<=0))return _e;ue&&(0,domhandler_1$1.hasChildren)(Ge)&&Ge.children.length>0&&(Ue.unshift(0),Ne.unshift(Ge.children))}}querying.find=find;function findOneChild(fe,ee){return ee.find(fe)}querying.findOneChild=findOneChild;function findOne(fe,ee,ue){ue===void 0&&(ue=!0);for(var pe=null,_e=0;_e<ee.length&&!pe;_e++){var Ne=ee[_e];if((0,domhandler_1$1.isTag)(Ne))fe(Ne)?pe=Ne:ue&&Ne.children.length>0&&(pe=findOne(fe,Ne.children,!0));else continue}return pe}querying.findOne=findOne;function existsOne(fe,ee){return ee.some(function(ue){return(0,domhandler_1$1.isTag)(ue)&&(fe(ue)||existsOne(fe,ue.children))})}querying.existsOne=existsOne;function findAll(fe,ee){for(var ue=[],pe=[ee],_e=[0];;){if(_e[0]>=pe[0].length){if(pe.length===1)return ue;pe.shift(),_e.shift();continue}var Ne=pe[0][_e[0]++];(0,domhandler_1$1.isTag)(Ne)&&(fe(Ne)&&ue.push(Ne),Ne.children.length>0&&(_e.unshift(0),pe.unshift(Ne.children)))}}querying.findAll=findAll;var legacy={};Object.defineProperty(legacy,"__esModule",{value:!0});legacy.getElementsByTagType=legacy.getElementsByTagName=legacy.getElementById=legacy.getElements=legacy.testElement=void 0;var domhandler_1=lib$4,querying_js_1=querying,Checks={tag_name:function(fe){return typeof fe=="function"?function(ee){return(0,domhandler_1.isTag)(ee)&&fe(ee.name)}:fe==="*"?domhandler_1.isTag:function(ee){return(0,domhandler_1.isTag)(ee)&&ee.name===fe}},tag_type:function(fe){return typeof fe=="function"?function(ee){return fe(ee.type)}:function(ee){return ee.type===fe}},tag_contains:function(fe){return typeof fe=="function"?function(ee){return(0,domhandler_1.isText)(ee)&&fe(ee.data)}:function(ee){return(0,domhandler_1.isText)(ee)&&ee.data===fe}}};function getAttribCheck(fe,ee){return typeof ee=="function"?function(ue){return(0,domhandler_1.isTag)(ue)&&ee(ue.attribs[fe])}:function(ue){return(0,domhandler_1.isTag)(ue)&&ue.attribs[fe]===ee}}function combineFuncs(fe,ee){return function(ue){return fe(ue)||ee(ue)}}function compileTest(fe){var ee=Object.keys(fe).map(function(ue){var pe=fe[ue];return Object.prototype.hasOwnProperty.call(Checks,ue)?Checks[ue](pe):getAttribCheck(ue,pe)});return ee.length===0?null:ee.reduce(combineFuncs)}function testElement(fe,ee){var ue=compileTest(fe);return ue?ue(ee):!0}legacy.testElement=testElement;function getElements(fe,ee,ue,pe){pe===void 0&&(pe=1/0);var _e=compileTest(fe);return _e?(0,querying_js_1.filter)(_e,ee,ue,pe):[]}legacy.getElements=getElements;function getElementById(fe,ee,ue){return ue===void 0&&(ue=!0),Array.isArray(ee)||(ee=[ee]),(0,querying_js_1.findOne)(getAttribCheck("id",fe),ee,ue)}legacy.getElementById=getElementById;function getElementsByTagName(fe,ee,ue,pe){return ue===void 0&&(ue=!0),pe===void 0&&(pe=1/0),(0,querying_js_1.filter)(Checks.tag_name(fe),ee,ue,pe)}legacy.getElementsByTagName=getElementsByTagName;function getElementsByTagType(fe,ee,ue,pe){return ue===void 0&&(ue=!0),pe===void 0&&(pe=1/0),(0,querying_js_1.filter)(Checks.tag_type(fe),ee,ue,pe)}legacy.getElementsByTagType=getElementsByTagType;var helpers={};(function(fe){Object.defineProperty(fe,"__esModule",{value:!0}),fe.uniqueSort=fe.compareDocumentPosition=fe.DocumentPosition=fe.removeSubsets=void 0;var ee=lib$4;function ue(Ue){for(var Ge=Ue.length;--Ge>=0;){var qe=Ue[Ge];if(Ge>0&&Ue.lastIndexOf(qe,Ge-1)>=0){Ue.splice(Ge,1);continue}for(var Ke=qe.parent;Ke;Ke=Ke.parent)if(Ue.includes(Ke)){Ue.splice(Ge,1);break}}return Ue}fe.removeSubsets=ue;var pe;(function(Ue){Ue[Ue.DISCONNECTED=1]="DISCONNECTED",Ue[Ue.PRECEDING=2]="PRECEDING",Ue[Ue.FOLLOWING=4]="FOLLOWING",Ue[Ue.CONTAINS=8]="CONTAINS",Ue[Ue.CONTAINED_BY=16]="CONTAINED_BY"})(pe=fe.DocumentPosition||(fe.DocumentPosition={}));function _e(Ue,Ge){var qe=[],Ke=[];if(Ue===Ge)return 0;for(var Ye=(0,ee.hasChildren)(Ue)?Ue:Ue.parent;Ye;)qe.unshift(Ye),Ye=Ye.parent;for(Ye=(0,ee.hasChildren)(Ge)?Ge:Ge.parent;Ye;)Ke.unshift(Ye),Ye=Ye.parent;for(var Ze=Math.min(qe.length,Ke.length),Xe=0;Xe<Ze&&qe[Xe]===Ke[Xe];)Xe++;if(Xe===0)return pe.DISCONNECTED;var Je=qe[Xe-1],tt=Je.children,rt=qe[Xe],et=Ke[Xe];return tt.indexOf(rt)>tt.indexOf(et)?Je===Ge?pe.FOLLOWING|pe.CONTAINED_BY:pe.FOLLOWING:Je===Ue?pe.PRECEDING|pe.CONTAINS:pe.PRECEDING}fe.compareDocumentPosition=_e;function Ne(Ue){return Ue=Ue.filter(function(Ge,qe,Ke){return!Ke.includes(Ge,qe+1)}),Ue.sort(function(Ge,qe){var Ke=_e(Ge,qe);return Ke&pe.PRECEDING?-1:Ke&pe.FOLLOWING?1:0}),Ue}fe.uniqueSort=Ne})(helpers);var feeds={};Object.defineProperty(feeds,"__esModule",{value:!0});feeds.getFeed=void 0;var stringify_js_1=stringify$5,legacy_js_1=legacy;function getFeed(fe){var ee=getOneElement(isValidFeed,fe);return ee?ee.name==="feed"?getAtomFeed(ee):getRssFeed(ee):null}feeds.getFeed=getFeed;function getAtomFeed(fe){var ee,ue=fe.children,pe={type:"atom",items:(0,legacy_js_1.getElementsByTagName)("entry",ue).map(function(Ue){var Ge,qe=Ue.children,Ke={media:getMediaElements(qe)};addConditionally(Ke,"id","id",qe),addConditionally(Ke,"title","title",qe);var Ye=(Ge=getOneElement("link",qe))===null||Ge===void 0?void 0:Ge.attribs.href;Ye&&(Ke.link=Ye);var Ze=fetch$1("summary",qe)||fetch$1("content",qe);Ze&&(Ke.description=Ze);var Xe=fetch$1("updated",qe);return Xe&&(Ke.pubDate=new Date(Xe)),Ke})};addConditionally(pe,"id","id",ue),addConditionally(pe,"title","title",ue);var _e=(ee=getOneElement("link",ue))===null||ee===void 0?void 0:ee.attribs.href;_e&&(pe.link=_e),addConditionally(pe,"description","subtitle",ue);var Ne=fetch$1("updated",ue);return Ne&&(pe.updated=new Date(Ne)),addConditionally(pe,"author","email",ue,!0),pe}function getRssFeed(fe){var ee,ue,pe=(ue=(ee=getOneElement("channel",fe.children))===null||ee===void 0?void 0:ee.children)!==null&&ue!==void 0?ue:[],_e={type:fe.name.substr(0,3),id:"",items:(0,legacy_js_1.getElementsByTagName)("item",fe.children).map(function(Ue){var Ge=Ue.children,qe={media:getMediaElements(Ge)};addConditionally(qe,"id","guid",Ge),addConditionally(qe,"title","title",Ge),addConditionally(qe,"link","link",Ge),addConditionally(qe,"description","description",Ge);var Ke=fetch$1("pubDate",Ge)||fetch$1("dc:date",Ge);return Ke&&(qe.pubDate=new Date(Ke)),qe})};addConditionally(_e,"title","title",pe),addConditionally(_e,"link","link",pe),addConditionally(_e,"description","description",pe);var Ne=fetch$1("lastBuildDate",pe);return Ne&&(_e.updated=new Date(Ne)),addConditionally(_e,"author","managingEditor",pe,!0),_e}var MEDIA_KEYS_STRING=["url","type","lang"],MEDIA_KEYS_INT=["fileSize","bitrate","framerate","samplingrate","channels","duration","height","width"];function getMediaElements(fe){return(0,legacy_js_1.getElementsByTagName)("media:content",fe).map(function(ee){for(var ue=ee.attribs,pe={medium:ue.medium,isDefault:!!ue.isDefault},_e=0,Ne=MEDIA_KEYS_STRING;_e<Ne.length;_e++){var Ue=Ne[_e];ue[Ue]&&(pe[Ue]=ue[Ue])}for(var Ge=0,qe=MEDIA_KEYS_INT;Ge<qe.length;Ge++){var Ue=qe[Ge];ue[Ue]&&(pe[Ue]=parseInt(ue[Ue],10))}return ue.expression&&(pe.expression=ue.expression),pe})}function getOneElement(fe,ee){return(0,legacy_js_1.getElementsByTagName)(fe,ee,!0,1)[0]}function fetch$1(fe,ee,ue){return ue===void 0&&(ue=!1),(0,stringify_js_1.textContent)((0,legacy_js_1.getElementsByTagName)(fe,ee,ue,1)).trim()}function addConditionally(fe,ee,ue,pe,_e){_e===void 0&&(_e=!1);var Ne=fetch$1(ue,pe,_e);Ne&&(fe[ee]=Ne)}function isValidFeed(fe){return fe==="rss"||fe==="feed"||fe==="rdf:RDF"}(function(fe){var ee=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(_e,Ne,Ue,Ge){Ge===void 0&&(Ge=Ue);var qe=Object.getOwnPropertyDescriptor(Ne,Ue);(!qe||("get"in qe?!Ne.__esModule:qe.writable||qe.configurable))&&(qe={enumerable:!0,get:function(){return Ne[Ue]}}),Object.defineProperty(_e,Ge,qe)}:function(_e,Ne,Ue,Ge){Ge===void 0&&(Ge=Ue),_e[Ge]=Ne[Ue]}),ue=commonjsGlobal&&commonjsGlobal.__exportStar||function(_e,Ne){for(var Ue in _e)Ue!=="default"&&!Object.prototype.hasOwnProperty.call(Ne,Ue)&&ee(Ne,_e,Ue)};Object.defineProperty(fe,"__esModule",{value:!0}),fe.hasChildren=fe.isDocument=fe.isComment=fe.isText=fe.isCDATA=fe.isTag=void 0,ue(stringify$5,fe),ue(traversal,fe),ue(manipulation,fe),ue(querying,fe),ue(legacy,fe),ue(helpers,fe),ue(feeds,fe);var pe=lib$4;Object.defineProperty(fe,"isTag",{enumerable:!0,get:function(){return pe.isTag}}),Object.defineProperty(fe,"isCDATA",{enumerable:!0,get:function(){return pe.isCDATA}}),Object.defineProperty(fe,"isText",{enumerable:!0,get:function(){return pe.isText}}),Object.defineProperty(fe,"isComment",{enumerable:!0,get:function(){return pe.isComment}}),Object.defineProperty(fe,"isDocument",{enumerable:!0,get:function(){return pe.isDocument}}),Object.defineProperty(fe,"hasChildren",{enumerable:!0,get:function(){return pe.hasChildren}})})(lib$2);(function(fe){var ee=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(it,nt,st,lt){lt===void 0&&(lt=st);var _r=Object.getOwnPropertyDescriptor(nt,st);(!_r||("get"in _r?!nt.__esModule:_r.writable||_r.configurable))&&(_r={enumerable:!0,get:function(){return nt[st]}}),Object.defineProperty(it,lt,_r)}:function(it,nt,st,lt){lt===void 0&&(lt=st),it[lt]=nt[st]}),ue=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(it,nt){Object.defineProperty(it,"default",{enumerable:!0,value:nt})}:function(it,nt){it.default=nt}),pe=commonjsGlobal&&commonjsGlobal.__importStar||function(it){if(it&&it.__esModule)return it;var nt={};if(it!=null)for(var st in it)st!=="default"&&Object.prototype.hasOwnProperty.call(it,st)&&ee(nt,it,st);return ue(nt,it),nt},_e=commonjsGlobal&&commonjsGlobal.__importDefault||function(it){return it&&it.__esModule?it:{default:it}};Object.defineProperty(fe,"__esModule",{value:!0}),fe.DomUtils=fe.parseFeed=fe.getFeed=fe.ElementType=fe.Tokenizer=fe.createDomStream=fe.parseDOM=fe.parseDocument=fe.DefaultHandler=fe.DomHandler=fe.Parser=void 0;var Ne=Parser$3,Ue=Parser$3;Object.defineProperty(fe,"Parser",{enumerable:!0,get:function(){return Ue.Parser}});var Ge=lib$4,qe=lib$4;Object.defineProperty(fe,"DomHandler",{enumerable:!0,get:function(){return qe.DomHandler}}),Object.defineProperty(fe,"DefaultHandler",{enumerable:!0,get:function(){return qe.DomHandler}});function Ke(it,nt){var st=new Ge.DomHandler(void 0,nt);return new Ne.Parser(st,nt).end(it),st.root}fe.parseDocument=Ke;function Ye(it,nt){return Ke(it,nt).children}fe.parseDOM=Ye;function Ze(it,nt,st){var lt=new Ge.DomHandler(it,nt,st);return new Ne.Parser(lt,nt)}fe.createDomStream=Ze;var Xe=Tokenizer;Object.defineProperty(fe,"Tokenizer",{enumerable:!0,get:function(){return _e(Xe).default}}),fe.ElementType=pe(lib$3);var Je=lib$2,tt=lib$2;Object.defineProperty(fe,"getFeed",{enumerable:!0,get:function(){return tt.getFeed}});var rt={xmlMode:!0};function et(it,nt){return nt===void 0&&(nt=rt),(0,Je.getFeed)(Ye(it,nt))}fe.parseFeed=et,fe.DomUtils=pe(lib$2)})(lib$5);var escapeStringRegexp$1=fe=>{if(typeof fe!="string")throw new TypeError("Expected a string");return fe.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")},isPlainObject$2={};Object.defineProperty(isPlainObject$2,"__esModule",{value:!0});/*!
 * is-plain-object <https://github.com/jonschlinkert/is-plain-object>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */function isObject(fe){return Object.prototype.toString.call(fe)==="[object Object]"}function isPlainObject$1(fe){var ee,ue;return isObject(fe)===!1?!1:(ee=fe.constructor,ee===void 0?!0:(ue=ee.prototype,!(isObject(ue)===!1||ue.hasOwnProperty("isPrototypeOf")===!1)))}isPlainObject$2.isPlainObject=isPlainObject$1;var isMergeableObject=function(ee){return isNonNullObject(ee)&&!isSpecial(ee)};function isNonNullObject(fe){return!!fe&&typeof fe=="object"}function isSpecial(fe){var ee=Object.prototype.toString.call(fe);return ee==="[object RegExp]"||ee==="[object Date]"||isReactElement(fe)}var canUseSymbol=typeof Symbol=="function"&&Symbol.for,REACT_ELEMENT_TYPE=canUseSymbol?Symbol.for("react.element"):60103;function isReactElement(fe){return fe.$$typeof===REACT_ELEMENT_TYPE}function emptyTarget(fe){return Array.isArray(fe)?[]:{}}function cloneUnlessOtherwiseSpecified(fe,ee){return ee.clone!==!1&&ee.isMergeableObject(fe)?deepmerge$1(emptyTarget(fe),fe,ee):fe}function defaultArrayMerge(fe,ee,ue){return fe.concat(ee).map(function(pe){return cloneUnlessOtherwiseSpecified(pe,ue)})}function getMergeFunction(fe,ee){if(!ee.customMerge)return deepmerge$1;var ue=ee.customMerge(fe);return typeof ue=="function"?ue:deepmerge$1}function getEnumerableOwnPropertySymbols(fe){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(fe).filter(function(ee){return Object.propertyIsEnumerable.call(fe,ee)}):[]}function getKeys(fe){return Object.keys(fe).concat(getEnumerableOwnPropertySymbols(fe))}function propertyIsOnObject(fe,ee){try{return ee in fe}catch{return!1}}function propertyIsUnsafe(fe,ee){return propertyIsOnObject(fe,ee)&&!(Object.hasOwnProperty.call(fe,ee)&&Object.propertyIsEnumerable.call(fe,ee))}function mergeObject(fe,ee,ue){var pe={};return ue.isMergeableObject(fe)&&getKeys(fe).forEach(function(_e){pe[_e]=cloneUnlessOtherwiseSpecified(fe[_e],ue)}),getKeys(ee).forEach(function(_e){propertyIsUnsafe(fe,_e)||(propertyIsOnObject(fe,_e)&&ue.isMergeableObject(ee[_e])?pe[_e]=getMergeFunction(_e,ue)(fe[_e],ee[_e],ue):pe[_e]=cloneUnlessOtherwiseSpecified(ee[_e],ue))}),pe}function deepmerge$1(fe,ee,ue){ue=ue||{},ue.arrayMerge=ue.arrayMerge||defaultArrayMerge,ue.isMergeableObject=ue.isMergeableObject||isMergeableObject,ue.cloneUnlessOtherwiseSpecified=cloneUnlessOtherwiseSpecified;var pe=Array.isArray(ee),_e=Array.isArray(fe),Ne=pe===_e;return Ne?pe?ue.arrayMerge(fe,ee,ue):mergeObject(fe,ee,ue):cloneUnlessOtherwiseSpecified(ee,ue)}deepmerge$1.all=function(ee,ue){if(!Array.isArray(ee))throw new Error("first argument should be an array");return ee.reduce(function(pe,_e){return deepmerge$1(pe,_e,ue)},{})};var deepmerge_1=deepmerge$1,cjs=deepmerge_1,parseSrcset$1={exports:{}};(function(fe){(function(ee,ue){fe.exports?fe.exports=ue():ee.parseSrcset=ue()})(commonjsGlobal,function(){return function(ee){function ue(lt){return lt===" "||lt==="	"||lt===`
`||lt==="\f"||lt==="\r"}function pe(lt){var _r,jr=lt.exec(ee.substring(et));if(jr)return _r=jr[0],et+=_r.length,_r}for(var _e=ee.length,Ne=/^[ \t\n\r\u000c]+/,Ue=/^[, \t\n\r\u000c]+/,Ge=/^[^ \t\n\r\u000c]+/,qe=/[,]+$/,Ke=/^\d+$/,Ye=/^-?(?:[0-9]+|[0-9]*\.[0-9]+)(?:[eE][+-]?[0-9]+)?$/,Ze,Xe,Je,tt,rt,et=0,it=[];;){if(pe(Ue),et>=_e)return it;Ze=pe(Ge),Xe=[],Ze.slice(-1)===","?(Ze=Ze.replace(qe,""),st()):nt()}function nt(){for(pe(Ne),Je="",tt="in descriptor";;){if(rt=ee.charAt(et),tt==="in descriptor")if(ue(rt))Je&&(Xe.push(Je),Je="",tt="after descriptor");else if(rt===","){et+=1,Je&&Xe.push(Je),st();return}else if(rt==="(")Je=Je+rt,tt="in parens";else if(rt===""){Je&&Xe.push(Je),st();return}else Je=Je+rt;else if(tt==="in parens")if(rt===")")Je=Je+rt,tt="in descriptor";else if(rt===""){Xe.push(Je),st();return}else Je=Je+rt;else if(tt==="after descriptor"&&!ue(rt))if(rt===""){st();return}else tt="in descriptor",et-=1;et+=1}}function st(){var lt=!1,_r,jr,Nr,Wr,ri={},Xr,Gr,qr,si,oi;for(Wr=0;Wr<Xe.length;Wr++)Xr=Xe[Wr],Gr=Xr[Xr.length-1],qr=Xr.substring(0,Xr.length-1),si=parseInt(qr,10),oi=parseFloat(qr),Ke.test(qr)&&Gr==="w"?((_r||jr)&&(lt=!0),si===0?lt=!0:_r=si):Ye.test(qr)&&Gr==="x"?((_r||jr||Nr)&&(lt=!0),oi<0?lt=!0:jr=oi):Ke.test(qr)&&Gr==="h"?((Nr||jr)&&(lt=!0),si===0?lt=!0:Nr=si):lt=!0;lt?console&&console.log&&console.log("Invalid srcset descriptor found in '"+ee+"' at '"+Xr+"'."):(ri.url=Ze,_r&&(ri.w=_r),jr&&(ri.d=jr),Nr&&(ri.h=Nr),it.push(ri))}}})})(parseSrcset$1);var parseSrcsetExports=parseSrcset$1.exports,picocolors_browser={exports:{}},x=String,create=function(){return{isColorSupported:!1,reset:x,bold:x,dim:x,italic:x,underline:x,inverse:x,hidden:x,strikethrough:x,black:x,red:x,green:x,yellow:x,blue:x,magenta:x,cyan:x,white:x,gray:x,bgBlack:x,bgRed:x,bgGreen:x,bgYellow:x,bgBlue:x,bgMagenta:x,bgCyan:x,bgWhite:x}};picocolors_browser.exports=create();picocolors_browser.exports.createColors=create;var picocolors_browserExports=picocolors_browser.exports;const __viteBrowserExternal={},__viteBrowserExternal$1=Object.freeze(Object.defineProperty({__proto__:null,default:__viteBrowserExternal},Symbol.toStringTag,{value:"Module"})),require$$2=getAugmentedNamespace(__viteBrowserExternal$1);let pico=picocolors_browserExports,terminalHighlight$1=require$$2,CssSyntaxError$3=class Qi extends Error{constructor(ee,ue,pe,_e,Ne,Ue){super(ee),this.name="CssSyntaxError",this.reason=ee,Ne&&(this.file=Ne),_e&&(this.source=_e),Ue&&(this.plugin=Ue),typeof ue<"u"&&typeof pe<"u"&&(typeof ue=="number"?(this.line=ue,this.column=pe):(this.line=ue.line,this.column=ue.column,this.endLine=pe.line,this.endColumn=pe.column)),this.setMessage(),Error.captureStackTrace&&Error.captureStackTrace(this,Qi)}setMessage(){this.message=this.plugin?this.plugin+": ":"",this.message+=this.file?this.file:"<css input>",typeof this.line<"u"&&(this.message+=":"+this.line+":"+this.column),this.message+=": "+this.reason}showSourceCode(ee){if(!this.source)return"";let ue=this.source;ee==null&&(ee=pico.isColorSupported),terminalHighlight$1&&ee&&(ue=terminalHighlight$1(ue));let pe=ue.split(/\r?\n/),_e=Math.max(this.line-3,0),Ne=Math.min(this.line+2,pe.length),Ue=String(Ne).length,Ge,qe;if(ee){let{bold:Ke,gray:Ye,red:Ze}=pico.createColors(!0);Ge=Xe=>Ke(Ze(Xe)),qe=Xe=>Ye(Xe)}else Ge=qe=Ke=>Ke;return pe.slice(_e,Ne).map((Ke,Ye)=>{let Ze=_e+1+Ye,Xe=" "+(" "+Ze).slice(-Ue)+" | ";if(Ze===this.line){let Je=qe(Xe.replace(/\d/g," "))+Ke.slice(0,this.column-1).replace(/[^\t]/g," ");return Ge(">")+qe(Xe)+Ke+`
 `+Je+Ge("^")}return" "+qe(Xe)+Ke}).join(`
`)}toString(){let ee=this.showSourceCode();return ee&&(ee=`

`+ee+`
`),this.name+": "+this.message+ee}};var cssSyntaxError=CssSyntaxError$3;CssSyntaxError$3.default=CssSyntaxError$3;var symbols={};symbols.isClean=Symbol("isClean");symbols.my=Symbol("my");const DEFAULT_RAW={after:`
`,beforeClose:`
`,beforeComment:`
`,beforeDecl:`
`,beforeOpen:" ",beforeRule:`
`,colon:": ",commentLeft:" ",commentRight:" ",emptyBody:"",indent:"    ",semicolon:!1};function capitalize(fe){return fe[0].toUpperCase()+fe.slice(1)}let Stringifier$2=class{constructor(ee){this.builder=ee}atrule(ee,ue){let pe="@"+ee.name,_e=ee.params?this.rawValue(ee,"params"):"";if(typeof ee.raws.afterName<"u"?pe+=ee.raws.afterName:_e&&(pe+=" "),ee.nodes)this.block(ee,pe+_e);else{let Ne=(ee.raws.between||"")+(ue?";":"");this.builder(pe+_e+Ne,ee)}}beforeAfter(ee,ue){let pe;ee.type==="decl"?pe=this.raw(ee,null,"beforeDecl"):ee.type==="comment"?pe=this.raw(ee,null,"beforeComment"):ue==="before"?pe=this.raw(ee,null,"beforeRule"):pe=this.raw(ee,null,"beforeClose");let _e=ee.parent,Ne=0;for(;_e&&_e.type!=="root";)Ne+=1,_e=_e.parent;if(pe.includes(`
`)){let Ue=this.raw(ee,null,"indent");if(Ue.length)for(let Ge=0;Ge<Ne;Ge++)pe+=Ue}return pe}block(ee,ue){let pe=this.raw(ee,"between","beforeOpen");this.builder(ue+pe+"{",ee,"start");let _e;ee.nodes&&ee.nodes.length?(this.body(ee),_e=this.raw(ee,"after")):_e=this.raw(ee,"after","emptyBody"),_e&&this.builder(_e),this.builder("}",ee,"end")}body(ee){let ue=ee.nodes.length-1;for(;ue>0&&ee.nodes[ue].type==="comment";)ue-=1;let pe=this.raw(ee,"semicolon");for(let _e=0;_e<ee.nodes.length;_e++){let Ne=ee.nodes[_e],Ue=this.raw(Ne,"before");Ue&&this.builder(Ue),this.stringify(Ne,ue!==_e||pe)}}comment(ee){let ue=this.raw(ee,"left","commentLeft"),pe=this.raw(ee,"right","commentRight");this.builder("/*"+ue+ee.text+pe+"*/",ee)}decl(ee,ue){let pe=this.raw(ee,"between","colon"),_e=ee.prop+pe+this.rawValue(ee,"value");ee.important&&(_e+=ee.raws.important||" !important"),ue&&(_e+=";"),this.builder(_e,ee)}document(ee){this.body(ee)}raw(ee,ue,pe){let _e;if(pe||(pe=ue),ue&&(_e=ee.raws[ue],typeof _e<"u"))return _e;let Ne=ee.parent;if(pe==="before"&&(!Ne||Ne.type==="root"&&Ne.first===ee||Ne&&Ne.type==="document"))return"";if(!Ne)return DEFAULT_RAW[pe];let Ue=ee.root();if(Ue.rawCache||(Ue.rawCache={}),typeof Ue.rawCache[pe]<"u")return Ue.rawCache[pe];if(pe==="before"||pe==="after")return this.beforeAfter(ee,pe);{let Ge="raw"+capitalize(pe);this[Ge]?_e=this[Ge](Ue,ee):Ue.walk(qe=>{if(_e=qe.raws[ue],typeof _e<"u")return!1})}return typeof _e>"u"&&(_e=DEFAULT_RAW[pe]),Ue.rawCache[pe]=_e,_e}rawBeforeClose(ee){let ue;return ee.walk(pe=>{if(pe.nodes&&pe.nodes.length>0&&typeof pe.raws.after<"u")return ue=pe.raws.after,ue.includes(`
`)&&(ue=ue.replace(/[^\n]+$/,"")),!1}),ue&&(ue=ue.replace(/\S/g,"")),ue}rawBeforeComment(ee,ue){let pe;return ee.walkComments(_e=>{if(typeof _e.raws.before<"u")return pe=_e.raws.before,pe.includes(`
`)&&(pe=pe.replace(/[^\n]+$/,"")),!1}),typeof pe>"u"?pe=this.raw(ue,null,"beforeDecl"):pe&&(pe=pe.replace(/\S/g,"")),pe}rawBeforeDecl(ee,ue){let pe;return ee.walkDecls(_e=>{if(typeof _e.raws.before<"u")return pe=_e.raws.before,pe.includes(`
`)&&(pe=pe.replace(/[^\n]+$/,"")),!1}),typeof pe>"u"?pe=this.raw(ue,null,"beforeRule"):pe&&(pe=pe.replace(/\S/g,"")),pe}rawBeforeOpen(ee){let ue;return ee.walk(pe=>{if(pe.type!=="decl"&&(ue=pe.raws.between,typeof ue<"u"))return!1}),ue}rawBeforeRule(ee){let ue;return ee.walk(pe=>{if(pe.nodes&&(pe.parent!==ee||ee.first!==pe)&&typeof pe.raws.before<"u")return ue=pe.raws.before,ue.includes(`
`)&&(ue=ue.replace(/[^\n]+$/,"")),!1}),ue&&(ue=ue.replace(/\S/g,"")),ue}rawColon(ee){let ue;return ee.walkDecls(pe=>{if(typeof pe.raws.between<"u")return ue=pe.raws.between.replace(/[^\s:]/g,""),!1}),ue}rawEmptyBody(ee){let ue;return ee.walk(pe=>{if(pe.nodes&&pe.nodes.length===0&&(ue=pe.raws.after,typeof ue<"u"))return!1}),ue}rawIndent(ee){if(ee.raws.indent)return ee.raws.indent;let ue;return ee.walk(pe=>{let _e=pe.parent;if(_e&&_e!==ee&&_e.parent&&_e.parent===ee&&typeof pe.raws.before<"u"){let Ne=pe.raws.before.split(`
`);return ue=Ne[Ne.length-1],ue=ue.replace(/\S/g,""),!1}}),ue}rawSemicolon(ee){let ue;return ee.walk(pe=>{if(pe.nodes&&pe.nodes.length&&pe.last.type==="decl"&&(ue=pe.raws.semicolon,typeof ue<"u"))return!1}),ue}rawValue(ee,ue){let pe=ee[ue],_e=ee.raws[ue];return _e&&_e.value===pe?_e.raw:pe}root(ee){this.body(ee),ee.raws.after&&this.builder(ee.raws.after)}rule(ee){this.block(ee,this.rawValue(ee,"selector")),ee.raws.ownSemicolon&&this.builder(ee.raws.ownSemicolon,ee,"end")}stringify(ee,ue){if(!this[ee.type])throw new Error("Unknown AST node type "+ee.type+". Maybe you need to change PostCSS stringifier.");this[ee.type](ee,ue)}};var stringifier=Stringifier$2;Stringifier$2.default=Stringifier$2;let Stringifier$1=stringifier;function stringify$4(fe,ee){new Stringifier$1(ee).stringify(fe)}var stringify_1=stringify$4;stringify$4.default=stringify$4;let{isClean:isClean$2,my:my$2}=symbols,CssSyntaxError$2=cssSyntaxError,Stringifier=stringifier,stringify$3=stringify_1;function cloneNode(fe,ee){let ue=new fe.constructor;for(let pe in fe){if(!Object.prototype.hasOwnProperty.call(fe,pe)||pe==="proxyCache")continue;let _e=fe[pe],Ne=typeof _e;pe==="parent"&&Ne==="object"?ee&&(ue[pe]=ee):pe==="source"?ue[pe]=_e:Array.isArray(_e)?ue[pe]=_e.map(Ue=>cloneNode(Ue,ue)):(Ne==="object"&&_e!==null&&(_e=cloneNode(_e)),ue[pe]=_e)}return ue}let Node$5=class{constructor(ee={}){this.raws={},this[isClean$2]=!1,this[my$2]=!0;for(let ue in ee)if(ue==="nodes"){this.nodes=[];for(let pe of ee[ue])typeof pe.clone=="function"?this.append(pe.clone()):this.append(pe)}else this[ue]=ee[ue]}addToError(ee){if(ee.postcssNode=this,ee.stack&&this.source&&/\n\s{4}at /.test(ee.stack)){let ue=this.source;ee.stack=ee.stack.replace(/\n\s{4}at /,`$&${ue.input.from}:${ue.start.line}:${ue.start.column}$&`)}return ee}after(ee){return this.parent.insertAfter(this,ee),this}assign(ee={}){for(let ue in ee)this[ue]=ee[ue];return this}before(ee){return this.parent.insertBefore(this,ee),this}cleanRaws(ee){delete this.raws.before,delete this.raws.after,ee||delete this.raws.between}clone(ee={}){let ue=cloneNode(this);for(let pe in ee)ue[pe]=ee[pe];return ue}cloneAfter(ee={}){let ue=this.clone(ee);return this.parent.insertAfter(this,ue),ue}cloneBefore(ee={}){let ue=this.clone(ee);return this.parent.insertBefore(this,ue),ue}error(ee,ue={}){if(this.source){let{end:pe,start:_e}=this.rangeBy(ue);return this.source.input.error(ee,{column:_e.column,line:_e.line},{column:pe.column,line:pe.line},ue)}return new CssSyntaxError$2(ee)}getProxyProcessor(){return{get(ee,ue){return ue==="proxyOf"?ee:ue==="root"?()=>ee.root().toProxy():ee[ue]},set(ee,ue,pe){return ee[ue]===pe||(ee[ue]=pe,(ue==="prop"||ue==="value"||ue==="name"||ue==="params"||ue==="important"||ue==="text")&&ee.markDirty()),!0}}}markDirty(){if(this[isClean$2]){this[isClean$2]=!1;let ee=this;for(;ee=ee.parent;)ee[isClean$2]=!1}}next(){if(!this.parent)return;let ee=this.parent.index(this);return this.parent.nodes[ee+1]}positionBy(ee,ue){let pe=this.source.start;if(ee.index)pe=this.positionInside(ee.index,ue);else if(ee.word){ue=this.toString();let _e=ue.indexOf(ee.word);_e!==-1&&(pe=this.positionInside(_e,ue))}return pe}positionInside(ee,ue){let pe=ue||this.toString(),_e=this.source.start.column,Ne=this.source.start.line;for(let Ue=0;Ue<ee;Ue++)pe[Ue]===`
`?(_e=1,Ne+=1):_e+=1;return{column:_e,line:Ne}}prev(){if(!this.parent)return;let ee=this.parent.index(this);return this.parent.nodes[ee-1]}rangeBy(ee){let ue={column:this.source.start.column,line:this.source.start.line},pe=this.source.end?{column:this.source.end.column+1,line:this.source.end.line}:{column:ue.column+1,line:ue.line};if(ee.word){let _e=this.toString(),Ne=_e.indexOf(ee.word);Ne!==-1&&(ue=this.positionInside(Ne,_e),pe=this.positionInside(Ne+ee.word.length,_e))}else ee.start?ue={column:ee.start.column,line:ee.start.line}:ee.index&&(ue=this.positionInside(ee.index)),ee.end?pe={column:ee.end.column,line:ee.end.line}:ee.endIndex?pe=this.positionInside(ee.endIndex):ee.index&&(pe=this.positionInside(ee.index+1));return(pe.line<ue.line||pe.line===ue.line&&pe.column<=ue.column)&&(pe={column:ue.column+1,line:ue.line}),{end:pe,start:ue}}raw(ee,ue){return new Stringifier().raw(this,ee,ue)}remove(){return this.parent&&this.parent.removeChild(this),this.parent=void 0,this}replaceWith(...ee){if(this.parent){let ue=this,pe=!1;for(let _e of ee)_e===this?pe=!0:pe?(this.parent.insertAfter(ue,_e),ue=_e):this.parent.insertBefore(ue,_e);pe||this.remove()}return this}root(){let ee=this;for(;ee.parent&&ee.parent.type!=="document";)ee=ee.parent;return ee}toJSON(ee,ue){let pe={},_e=ue==null;ue=ue||new Map;let Ne=0;for(let Ue in this){if(!Object.prototype.hasOwnProperty.call(this,Ue)||Ue==="parent"||Ue==="proxyCache")continue;let Ge=this[Ue];if(Array.isArray(Ge))pe[Ue]=Ge.map(qe=>typeof qe=="object"&&qe.toJSON?qe.toJSON(null,ue):qe);else if(typeof Ge=="object"&&Ge.toJSON)pe[Ue]=Ge.toJSON(null,ue);else if(Ue==="source"){let qe=ue.get(Ge.input);qe==null&&(qe=Ne,ue.set(Ge.input,Ne),Ne++),pe[Ue]={end:Ge.end,inputId:qe,start:Ge.start}}else pe[Ue]=Ge}return _e&&(pe.inputs=[...ue.keys()].map(Ue=>Ue.toJSON())),pe}toProxy(){return this.proxyCache||(this.proxyCache=new Proxy(this,this.getProxyProcessor())),this.proxyCache}toString(ee=stringify$3){ee.stringify&&(ee=ee.stringify);let ue="";return ee(this,pe=>{ue+=pe}),ue}warn(ee,ue,pe){let _e={node:this};for(let Ne in pe)_e[Ne]=pe[Ne];return ee.warn(ue,_e)}get proxyOf(){return this}};var node=Node$5;Node$5.default=Node$5;let Node$4=node,Declaration$4=class extends Node$4{constructor(ee){ee&&typeof ee.value<"u"&&typeof ee.value!="string"&&(ee={...ee,value:String(ee.value)}),super(ee),this.type="decl"}get variable(){return this.prop.startsWith("--")||this.prop[0]==="$"}};var declaration=Declaration$4;Declaration$4.default=Declaration$4;let urlAlphabet="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",customAlphabet=(fe,ee=21)=>(ue=ee)=>{let pe="",_e=ue;for(;_e--;)pe+=fe[Math.random()*fe.length|0];return pe},nanoid$1=(fe=21)=>{let ee="",ue=fe;for(;ue--;)ee+=urlAlphabet[Math.random()*64|0];return ee};var nonSecure={nanoid:nanoid$1,customAlphabet};let{SourceMapConsumer:SourceMapConsumer$2,SourceMapGenerator:SourceMapGenerator$2}=require$$2,{existsSync,readFileSync}=require$$2,{dirname:dirname$1,join}=require$$2;function fromBase64(fe){return Buffer?Buffer.from(fe,"base64").toString():window.atob(fe)}let PreviousMap$2=class{constructor(ee,ue){if(ue.map===!1)return;this.loadAnnotation(ee),this.inline=this.startWith(this.annotation,"data:");let pe=ue.map?ue.map.prev:void 0,_e=this.loadMap(ue.from,pe);!this.mapFile&&ue.from&&(this.mapFile=ue.from),this.mapFile&&(this.root=dirname$1(this.mapFile)),_e&&(this.text=_e)}consumer(){return this.consumerCache||(this.consumerCache=new SourceMapConsumer$2(this.text)),this.consumerCache}decodeInline(ee){let ue=/^data:application\/json;charset=utf-?8;base64,/,pe=/^data:application\/json;base64,/,_e=/^data:application\/json;charset=utf-?8,/,Ne=/^data:application\/json,/;if(_e.test(ee)||Ne.test(ee))return decodeURIComponent(ee.substr(RegExp.lastMatch.length));if(ue.test(ee)||pe.test(ee))return fromBase64(ee.substr(RegExp.lastMatch.length));let Ue=ee.match(/data:application\/json;([^,]+),/)[1];throw new Error("Unsupported source map encoding "+Ue)}getAnnotationURL(ee){return ee.replace(/^\/\*\s*# sourceMappingURL=/,"").trim()}isMap(ee){return typeof ee!="object"?!1:typeof ee.mappings=="string"||typeof ee._mappings=="string"||Array.isArray(ee.sections)}loadAnnotation(ee){let ue=ee.match(/\/\*\s*# sourceMappingURL=/gm);if(!ue)return;let pe=ee.lastIndexOf(ue.pop()),_e=ee.indexOf("*/",pe);pe>-1&&_e>-1&&(this.annotation=this.getAnnotationURL(ee.substring(pe,_e)))}loadFile(ee){if(this.root=dirname$1(ee),existsSync(ee))return this.mapFile=ee,readFileSync(ee,"utf-8").toString().trim()}loadMap(ee,ue){if(ue===!1)return!1;if(ue){if(typeof ue=="string")return ue;if(typeof ue=="function"){let pe=ue(ee);if(pe){let _e=this.loadFile(pe);if(!_e)throw new Error("Unable to load previous source map: "+pe.toString());return _e}}else{if(ue instanceof SourceMapConsumer$2)return SourceMapGenerator$2.fromSourceMap(ue).toString();if(ue instanceof SourceMapGenerator$2)return ue.toString();if(this.isMap(ue))return JSON.stringify(ue);throw new Error("Unsupported previous source map format: "+ue.toString())}}else{if(this.inline)return this.decodeInline(this.annotation);if(this.annotation){let pe=this.annotation;return ee&&(pe=join(dirname$1(ee),pe)),this.loadFile(pe)}}}startWith(ee,ue){return ee?ee.substr(0,ue.length)===ue:!1}withContent(){return!!(this.consumer().sourcesContent&&this.consumer().sourcesContent.length>0)}};var previousMap=PreviousMap$2;PreviousMap$2.default=PreviousMap$2;let{SourceMapConsumer:SourceMapConsumer$1,SourceMapGenerator:SourceMapGenerator$1}=require$$2,{fileURLToPath,pathToFileURL:pathToFileURL$1}=require$$2,{isAbsolute,resolve:resolve$1}=require$$2,{nanoid}=nonSecure,terminalHighlight=require$$2,CssSyntaxError$1=cssSyntaxError,PreviousMap$1=previousMap,fromOffsetCache=Symbol("fromOffsetCache"),sourceMapAvailable$1=!!(SourceMapConsumer$1&&SourceMapGenerator$1),pathAvailable$1=!!(resolve$1&&isAbsolute),Input$4=class{constructor(ee,ue={}){if(ee===null||typeof ee>"u"||typeof ee=="object"&&!ee.toString)throw new Error(`PostCSS received ${ee} instead of CSS string`);if(this.css=ee.toString(),this.css[0]==="\uFEFF"||this.css[0]===""?(this.hasBOM=!0,this.css=this.css.slice(1)):this.hasBOM=!1,ue.from&&(!pathAvailable$1||/^\w+:\/\//.test(ue.from)||isAbsolute(ue.from)?this.file=ue.from:this.file=resolve$1(ue.from)),pathAvailable$1&&sourceMapAvailable$1){let pe=new PreviousMap$1(this.css,ue);if(pe.text){this.map=pe;let _e=pe.consumer().file;!this.file&&_e&&(this.file=this.mapResolve(_e))}}this.file||(this.id="<input css "+nanoid(6)+">"),this.map&&(this.map.file=this.from)}error(ee,ue,pe,_e={}){let Ne,Ue,Ge;if(ue&&typeof ue=="object"){let Ke=ue,Ye=pe;if(typeof Ke.offset=="number"){let Ze=this.fromOffset(Ke.offset);ue=Ze.line,pe=Ze.col}else ue=Ke.line,pe=Ke.column;if(typeof Ye.offset=="number"){let Ze=this.fromOffset(Ye.offset);Ue=Ze.line,Ge=Ze.col}else Ue=Ye.line,Ge=Ye.column}else if(!pe){let Ke=this.fromOffset(ue);ue=Ke.line,pe=Ke.col}let qe=this.origin(ue,pe,Ue,Ge);return qe?Ne=new CssSyntaxError$1(ee,qe.endLine===void 0?qe.line:{column:qe.column,line:qe.line},qe.endLine===void 0?qe.column:{column:qe.endColumn,line:qe.endLine},qe.source,qe.file,_e.plugin):Ne=new CssSyntaxError$1(ee,Ue===void 0?ue:{column:pe,line:ue},Ue===void 0?pe:{column:Ge,line:Ue},this.css,this.file,_e.plugin),Ne.input={column:pe,endColumn:Ge,endLine:Ue,line:ue,source:this.css},this.file&&(pathToFileURL$1&&(Ne.input.url=pathToFileURL$1(this.file).toString()),Ne.input.file=this.file),Ne}fromOffset(ee){let ue,pe;if(this[fromOffsetCache])pe=this[fromOffsetCache];else{let Ne=this.css.split(`
`);pe=new Array(Ne.length);let Ue=0;for(let Ge=0,qe=Ne.length;Ge<qe;Ge++)pe[Ge]=Ue,Ue+=Ne[Ge].length+1;this[fromOffsetCache]=pe}ue=pe[pe.length-1];let _e=0;if(ee>=ue)_e=pe.length-1;else{let Ne=pe.length-2,Ue;for(;_e<Ne;)if(Ue=_e+(Ne-_e>>1),ee<pe[Ue])Ne=Ue-1;else if(ee>=pe[Ue+1])_e=Ue+1;else{_e=Ue;break}}return{col:ee-pe[_e]+1,line:_e+1}}mapResolve(ee){return/^\w+:\/\//.test(ee)?ee:resolve$1(this.map.consumer().sourceRoot||this.map.root||".",ee)}origin(ee,ue,pe,_e){if(!this.map)return!1;let Ne=this.map.consumer(),Ue=Ne.originalPositionFor({column:ue,line:ee});if(!Ue.source)return!1;let Ge;typeof pe=="number"&&(Ge=Ne.originalPositionFor({column:_e,line:pe}));let qe;isAbsolute(Ue.source)?qe=pathToFileURL$1(Ue.source):qe=new URL(Ue.source,this.map.consumer().sourceRoot||pathToFileURL$1(this.map.mapFile));let Ke={column:Ue.column,endColumn:Ge&&Ge.column,endLine:Ge&&Ge.line,line:Ue.line,url:qe.toString()};if(qe.protocol==="file:")if(fileURLToPath)Ke.file=fileURLToPath(qe);else throw new Error("file: protocol is not available in this PostCSS build");let Ye=Ne.sourceContentFor(Ue.source);return Ye&&(Ke.source=Ye),Ke}toJSON(){let ee={};for(let ue of["hasBOM","css","file","id"])this[ue]!=null&&(ee[ue]=this[ue]);return this.map&&(ee.map={...this.map},ee.map.consumerCache&&(ee.map.consumerCache=void 0)),ee}get from(){return this.file||this.id}};var input=Input$4;Input$4.default=Input$4;terminalHighlight&&terminalHighlight.registerInput&&terminalHighlight.registerInput(Input$4);let{SourceMapConsumer,SourceMapGenerator}=require$$2,{dirname,relative,resolve,sep}=require$$2,{pathToFileURL}=require$$2,Input$3=input,sourceMapAvailable=!!(SourceMapConsumer&&SourceMapGenerator),pathAvailable=!!(dirname&&resolve&&relative&&sep),MapGenerator$2=class{constructor(ee,ue,pe,_e){this.stringify=ee,this.mapOpts=pe.map||{},this.root=ue,this.opts=pe,this.css=_e,this.usesFileUrls=!this.mapOpts.from&&this.mapOpts.absolute,this.memoizedFileURLs=new Map,this.memoizedPaths=new Map,this.memoizedURLs=new Map}addAnnotation(){let ee;this.isInline()?ee="data:application/json;base64,"+this.toBase64(this.map.toString()):typeof this.mapOpts.annotation=="string"?ee=this.mapOpts.annotation:typeof this.mapOpts.annotation=="function"?ee=this.mapOpts.annotation(this.opts.to,this.root):ee=this.outputFile()+".map";let ue=`
`;this.css.includes(`\r
`)&&(ue=`\r
`),this.css+=ue+"/*# sourceMappingURL="+ee+" */"}applyPrevMaps(){for(let ee of this.previous()){let ue=this.toUrl(this.path(ee.file)),pe=ee.root||dirname(ee.file),_e;this.mapOpts.sourcesContent===!1?(_e=new SourceMapConsumer(ee.text),_e.sourcesContent&&(_e.sourcesContent=_e.sourcesContent.map(()=>null))):_e=ee.consumer(),this.map.applySourceMap(_e,ue,this.toUrl(this.path(pe)))}}clearAnnotation(){if(this.mapOpts.annotation!==!1)if(this.root){let ee;for(let ue=this.root.nodes.length-1;ue>=0;ue--)ee=this.root.nodes[ue],ee.type==="comment"&&ee.text.indexOf("# sourceMappingURL=")===0&&this.root.removeChild(ue)}else this.css&&(this.css=this.css.replace(/(\n)?\/\*#[\S\s]*?\*\/$/gm,""))}generate(){if(this.clearAnnotation(),pathAvailable&&sourceMapAvailable&&this.isMap())return this.generateMap();{let ee="";return this.stringify(this.root,ue=>{ee+=ue}),[ee]}}generateMap(){if(this.root)this.generateString();else if(this.previous().length===1){let ee=this.previous()[0].consumer();ee.file=this.outputFile(),this.map=SourceMapGenerator.fromSourceMap(ee)}else this.map=new SourceMapGenerator({file:this.outputFile()}),this.map.addMapping({generated:{column:0,line:1},original:{column:0,line:1},source:this.opts.from?this.toUrl(this.path(this.opts.from)):"<no source>"});return this.isSourcesContent()&&this.setSourcesContent(),this.root&&this.previous().length>0&&this.applyPrevMaps(),this.isAnnotation()&&this.addAnnotation(),this.isInline()?[this.css]:[this.css,this.map]}generateString(){this.css="",this.map=new SourceMapGenerator({file:this.outputFile()});let ee=1,ue=1,pe="<no source>",_e={generated:{column:0,line:0},original:{column:0,line:0},source:""},Ne,Ue;this.stringify(this.root,(Ge,qe,Ke)=>{if(this.css+=Ge,qe&&Ke!=="end"&&(_e.generated.line=ee,_e.generated.column=ue-1,qe.source&&qe.source.start?(_e.source=this.sourcePath(qe),_e.original.line=qe.source.start.line,_e.original.column=qe.source.start.column-1,this.map.addMapping(_e)):(_e.source=pe,_e.original.line=1,_e.original.column=0,this.map.addMapping(_e))),Ne=Ge.match(/\n/g),Ne?(ee+=Ne.length,Ue=Ge.lastIndexOf(`
`),ue=Ge.length-Ue):ue+=Ge.length,qe&&Ke!=="start"){let Ye=qe.parent||{raws:{}};(!(qe.type==="decl"||qe.type==="atrule"&&!qe.nodes)||qe!==Ye.last||Ye.raws.semicolon)&&(qe.source&&qe.source.end?(_e.source=this.sourcePath(qe),_e.original.line=qe.source.end.line,_e.original.column=qe.source.end.column-1,_e.generated.line=ee,_e.generated.column=ue-2,this.map.addMapping(_e)):(_e.source=pe,_e.original.line=1,_e.original.column=0,_e.generated.line=ee,_e.generated.column=ue-1,this.map.addMapping(_e)))}})}isAnnotation(){return this.isInline()?!0:typeof this.mapOpts.annotation<"u"?this.mapOpts.annotation:this.previous().length?this.previous().some(ee=>ee.annotation):!0}isInline(){if(typeof this.mapOpts.inline<"u")return this.mapOpts.inline;let ee=this.mapOpts.annotation;return typeof ee<"u"&&ee!==!0?!1:this.previous().length?this.previous().some(ue=>ue.inline):!0}isMap(){return typeof this.opts.map<"u"?!!this.opts.map:this.previous().length>0}isSourcesContent(){return typeof this.mapOpts.sourcesContent<"u"?this.mapOpts.sourcesContent:this.previous().length?this.previous().some(ee=>ee.withContent()):!0}outputFile(){return this.opts.to?this.path(this.opts.to):this.opts.from?this.path(this.opts.from):"to.css"}path(ee){if(this.mapOpts.absolute||ee.charCodeAt(0)===60||/^\w+:\/\//.test(ee))return ee;let ue=this.memoizedPaths.get(ee);if(ue)return ue;let pe=this.opts.to?dirname(this.opts.to):".";typeof this.mapOpts.annotation=="string"&&(pe=dirname(resolve(pe,this.mapOpts.annotation)));let _e=relative(pe,ee);return this.memoizedPaths.set(ee,_e),_e}previous(){if(!this.previousMaps)if(this.previousMaps=[],this.root)this.root.walk(ee=>{if(ee.source&&ee.source.input.map){let ue=ee.source.input.map;this.previousMaps.includes(ue)||this.previousMaps.push(ue)}});else{let ee=new Input$3(this.css,this.opts);ee.map&&this.previousMaps.push(ee.map)}return this.previousMaps}setSourcesContent(){let ee={};if(this.root)this.root.walk(ue=>{if(ue.source){let pe=ue.source.input.from;if(pe&&!ee[pe]){ee[pe]=!0;let _e=this.usesFileUrls?this.toFileUrl(pe):this.toUrl(this.path(pe));this.map.setSourceContent(_e,ue.source.input.css)}}});else if(this.css){let ue=this.opts.from?this.toUrl(this.path(this.opts.from)):"<no source>";this.map.setSourceContent(ue,this.css)}}sourcePath(ee){return this.mapOpts.from?this.toUrl(this.mapOpts.from):this.usesFileUrls?this.toFileUrl(ee.source.input.from):this.toUrl(this.path(ee.source.input.from))}toBase64(ee){return Buffer?Buffer.from(ee).toString("base64"):window.btoa(unescape(encodeURIComponent(ee)))}toFileUrl(ee){let ue=this.memoizedFileURLs.get(ee);if(ue)return ue;if(pathToFileURL){let pe=pathToFileURL(ee).toString();return this.memoizedFileURLs.set(ee,pe),pe}else throw new Error("`map.absolute` option is not available in this PostCSS build")}toUrl(ee){let ue=this.memoizedURLs.get(ee);if(ue)return ue;sep==="\\"&&(ee=ee.replace(/\\/g,"/"));let pe=encodeURI(ee).replace(/[#?]/g,encodeURIComponent);return this.memoizedURLs.set(ee,pe),pe}};var mapGenerator=MapGenerator$2;let Node$3=node,Comment$4=class extends Node$3{constructor(ee){super(ee),this.type="comment"}};var comment=Comment$4;Comment$4.default=Comment$4;let{isClean:isClean$1,my:my$1}=symbols,Declaration$3=declaration,Comment$3=comment,Node$2=node,parse$8,Rule$4,AtRule$4,Root$6;function cleanSource(fe){return fe.map(ee=>(ee.nodes&&(ee.nodes=cleanSource(ee.nodes)),delete ee.source,ee))}function markDirtyUp(fe){if(fe[isClean$1]=!1,fe.proxyOf.nodes)for(let ee of fe.proxyOf.nodes)markDirtyUp(ee)}let Container$7=class Ji extends Node$2{append(...ee){for(let ue of ee){let pe=this.normalize(ue,this.last);for(let _e of pe)this.proxyOf.nodes.push(_e)}return this.markDirty(),this}cleanRaws(ee){if(super.cleanRaws(ee),this.nodes)for(let ue of this.nodes)ue.cleanRaws(ee)}each(ee){if(!this.proxyOf.nodes)return;let ue=this.getIterator(),pe,_e;for(;this.indexes[ue]<this.proxyOf.nodes.length&&(pe=this.indexes[ue],_e=ee(this.proxyOf.nodes[pe],pe),_e!==!1);)this.indexes[ue]+=1;return delete this.indexes[ue],_e}every(ee){return this.nodes.every(ee)}getIterator(){this.lastEach||(this.lastEach=0),this.indexes||(this.indexes={}),this.lastEach+=1;let ee=this.lastEach;return this.indexes[ee]=0,ee}getProxyProcessor(){return{get(ee,ue){return ue==="proxyOf"?ee:ee[ue]?ue==="each"||typeof ue=="string"&&ue.startsWith("walk")?(...pe)=>ee[ue](...pe.map(_e=>typeof _e=="function"?(Ne,Ue)=>_e(Ne.toProxy(),Ue):_e)):ue==="every"||ue==="some"?pe=>ee[ue]((_e,...Ne)=>pe(_e.toProxy(),...Ne)):ue==="root"?()=>ee.root().toProxy():ue==="nodes"?ee.nodes.map(pe=>pe.toProxy()):ue==="first"||ue==="last"?ee[ue].toProxy():ee[ue]:ee[ue]},set(ee,ue,pe){return ee[ue]===pe||(ee[ue]=pe,(ue==="name"||ue==="params"||ue==="selector")&&ee.markDirty()),!0}}}index(ee){return typeof ee=="number"?ee:(ee.proxyOf&&(ee=ee.proxyOf),this.proxyOf.nodes.indexOf(ee))}insertAfter(ee,ue){let pe=this.index(ee),_e=this.normalize(ue,this.proxyOf.nodes[pe]).reverse();pe=this.index(ee);for(let Ue of _e)this.proxyOf.nodes.splice(pe+1,0,Ue);let Ne;for(let Ue in this.indexes)Ne=this.indexes[Ue],pe<Ne&&(this.indexes[Ue]=Ne+_e.length);return this.markDirty(),this}insertBefore(ee,ue){let pe=this.index(ee),_e=pe===0?"prepend":!1,Ne=this.normalize(ue,this.proxyOf.nodes[pe],_e).reverse();pe=this.index(ee);for(let Ge of Ne)this.proxyOf.nodes.splice(pe,0,Ge);let Ue;for(let Ge in this.indexes)Ue=this.indexes[Ge],pe<=Ue&&(this.indexes[Ge]=Ue+Ne.length);return this.markDirty(),this}normalize(ee,ue){if(typeof ee=="string")ee=cleanSource(parse$8(ee).nodes);else if(Array.isArray(ee)){ee=ee.slice(0);for(let _e of ee)_e.parent&&_e.parent.removeChild(_e,"ignore")}else if(ee.type==="root"&&this.type!=="document"){ee=ee.nodes.slice(0);for(let _e of ee)_e.parent&&_e.parent.removeChild(_e,"ignore")}else if(ee.type)ee=[ee];else if(ee.prop){if(typeof ee.value>"u")throw new Error("Value field is missed in node creation");typeof ee.value!="string"&&(ee.value=String(ee.value)),ee=[new Declaration$3(ee)]}else if(ee.selector)ee=[new Rule$4(ee)];else if(ee.name)ee=[new AtRule$4(ee)];else if(ee.text)ee=[new Comment$3(ee)];else throw new Error("Unknown node type in node creation");return ee.map(_e=>(_e[my$1]||Ji.rebuild(_e),_e=_e.proxyOf,_e.parent&&_e.parent.removeChild(_e),_e[isClean$1]&&markDirtyUp(_e),typeof _e.raws.before>"u"&&ue&&typeof ue.raws.before<"u"&&(_e.raws.before=ue.raws.before.replace(/\S/g,"")),_e.parent=this.proxyOf,_e))}prepend(...ee){ee=ee.reverse();for(let ue of ee){let pe=this.normalize(ue,this.first,"prepend").reverse();for(let _e of pe)this.proxyOf.nodes.unshift(_e);for(let _e in this.indexes)this.indexes[_e]=this.indexes[_e]+pe.length}return this.markDirty(),this}push(ee){return ee.parent=this,this.proxyOf.nodes.push(ee),this}removeAll(){for(let ee of this.proxyOf.nodes)ee.parent=void 0;return this.proxyOf.nodes=[],this.markDirty(),this}removeChild(ee){ee=this.index(ee),this.proxyOf.nodes[ee].parent=void 0,this.proxyOf.nodes.splice(ee,1);let ue;for(let pe in this.indexes)ue=this.indexes[pe],ue>=ee&&(this.indexes[pe]=ue-1);return this.markDirty(),this}replaceValues(ee,ue,pe){return pe||(pe=ue,ue={}),this.walkDecls(_e=>{ue.props&&!ue.props.includes(_e.prop)||ue.fast&&!_e.value.includes(ue.fast)||(_e.value=_e.value.replace(ee,pe))}),this.markDirty(),this}some(ee){return this.nodes.some(ee)}walk(ee){return this.each((ue,pe)=>{let _e;try{_e=ee(ue,pe)}catch(Ne){throw ue.addToError(Ne)}return _e!==!1&&ue.walk&&(_e=ue.walk(ee)),_e})}walkAtRules(ee,ue){return ue?ee instanceof RegExp?this.walk((pe,_e)=>{if(pe.type==="atrule"&&ee.test(pe.name))return ue(pe,_e)}):this.walk((pe,_e)=>{if(pe.type==="atrule"&&pe.name===ee)return ue(pe,_e)}):(ue=ee,this.walk((pe,_e)=>{if(pe.type==="atrule")return ue(pe,_e)}))}walkComments(ee){return this.walk((ue,pe)=>{if(ue.type==="comment")return ee(ue,pe)})}walkDecls(ee,ue){return ue?ee instanceof RegExp?this.walk((pe,_e)=>{if(pe.type==="decl"&&ee.test(pe.prop))return ue(pe,_e)}):this.walk((pe,_e)=>{if(pe.type==="decl"&&pe.prop===ee)return ue(pe,_e)}):(ue=ee,this.walk((pe,_e)=>{if(pe.type==="decl")return ue(pe,_e)}))}walkRules(ee,ue){return ue?ee instanceof RegExp?this.walk((pe,_e)=>{if(pe.type==="rule"&&ee.test(pe.selector))return ue(pe,_e)}):this.walk((pe,_e)=>{if(pe.type==="rule"&&pe.selector===ee)return ue(pe,_e)}):(ue=ee,this.walk((pe,_e)=>{if(pe.type==="rule")return ue(pe,_e)}))}get first(){if(this.proxyOf.nodes)return this.proxyOf.nodes[0]}get last(){if(this.proxyOf.nodes)return this.proxyOf.nodes[this.proxyOf.nodes.length-1]}};Container$7.registerParse=fe=>{parse$8=fe};Container$7.registerRule=fe=>{Rule$4=fe};Container$7.registerAtRule=fe=>{AtRule$4=fe};Container$7.registerRoot=fe=>{Root$6=fe};var container=Container$7;Container$7.default=Container$7;Container$7.rebuild=fe=>{fe.type==="atrule"?Object.setPrototypeOf(fe,AtRule$4.prototype):fe.type==="rule"?Object.setPrototypeOf(fe,Rule$4.prototype):fe.type==="decl"?Object.setPrototypeOf(fe,Declaration$3.prototype):fe.type==="comment"?Object.setPrototypeOf(fe,Comment$3.prototype):fe.type==="root"&&Object.setPrototypeOf(fe,Root$6.prototype),fe[my$1]=!0,fe.nodes&&fe.nodes.forEach(ee=>{Container$7.rebuild(ee)})};let Container$6=container,LazyResult$4,Processor$3,Document$3=class extends Container$6{constructor(ee){super({type:"document",...ee}),this.nodes||(this.nodes=[])}toResult(ee={}){return new LazyResult$4(new Processor$3,this,ee).stringify()}};Document$3.registerLazyResult=fe=>{LazyResult$4=fe};Document$3.registerProcessor=fe=>{Processor$3=fe};var document$1=Document$3;Document$3.default=Document$3;let Warning$2=class{constructor(ee,ue={}){if(this.type="warning",this.text=ee,ue.node&&ue.node.source){let pe=ue.node.rangeBy(ue);this.line=pe.start.line,this.column=pe.start.column,this.endLine=pe.end.line,this.endColumn=pe.end.column}for(let pe in ue)this[pe]=ue[pe]}toString(){return this.node?this.node.error(this.text,{index:this.index,plugin:this.plugin,word:this.word}).message:this.plugin?this.plugin+": "+this.text:this.text}};var warning=Warning$2;Warning$2.default=Warning$2;let Warning$1=warning,Result$3=class{constructor(ee,ue,pe){this.processor=ee,this.messages=[],this.root=ue,this.opts=pe,this.css=void 0,this.map=void 0}toString(){return this.css}warn(ee,ue={}){ue.plugin||this.lastPlugin&&this.lastPlugin.postcssPlugin&&(ue.plugin=this.lastPlugin.postcssPlugin);let pe=new Warning$1(ee,ue);return this.messages.push(pe),pe}warnings(){return this.messages.filter(ee=>ee.type==="warning")}get content(){return this.css}};var result=Result$3;Result$3.default=Result$3;const SINGLE_QUOTE=39,DOUBLE_QUOTE=34,BACKSLASH=92,SLASH=47,NEWLINE=10,SPACE=32,FEED=12,TAB=9,CR=13,OPEN_SQUARE=91,CLOSE_SQUARE=93,OPEN_PARENTHESES=40,CLOSE_PARENTHESES=41,OPEN_CURLY=123,CLOSE_CURLY=125,SEMICOLON=59,ASTERISK=42,COLON=58,AT=64,RE_AT_END=/[\t\n\f\r "#'()/;[\\\]{}]/g,RE_WORD_END=/[\t\n\f\r !"#'():;@[\\\]{}]|\/(?=\*)/g,RE_BAD_BRACKET=/.[\r\n"'(/\\]/,RE_HEX_ESCAPE=/[\da-f]/i;var tokenize=function(ee,ue={}){let pe=ee.css.valueOf(),_e=ue.ignoreErrors,Ne,Ue,Ge,qe,Ke,Ye,Ze,Xe,Je,tt,rt=pe.length,et=0,it=[],nt=[];function st(){return et}function lt(Wr){throw ee.error("Unclosed "+Wr,et)}function _r(){return nt.length===0&&et>=rt}function jr(Wr){if(nt.length)return nt.pop();if(et>=rt)return;let ri=Wr?Wr.ignoreUnclosed:!1;switch(Ne=pe.charCodeAt(et),Ne){case NEWLINE:case SPACE:case TAB:case CR:case FEED:{Ue=et;do Ue+=1,Ne=pe.charCodeAt(Ue);while(Ne===SPACE||Ne===NEWLINE||Ne===TAB||Ne===CR||Ne===FEED);tt=["space",pe.slice(et,Ue)],et=Ue-1;break}case OPEN_SQUARE:case CLOSE_SQUARE:case OPEN_CURLY:case CLOSE_CURLY:case COLON:case SEMICOLON:case CLOSE_PARENTHESES:{let Xr=String.fromCharCode(Ne);tt=[Xr,Xr,et];break}case OPEN_PARENTHESES:{if(Xe=it.length?it.pop()[1]:"",Je=pe.charCodeAt(et+1),Xe==="url"&&Je!==SINGLE_QUOTE&&Je!==DOUBLE_QUOTE&&Je!==SPACE&&Je!==NEWLINE&&Je!==TAB&&Je!==FEED&&Je!==CR){Ue=et;do{if(Ye=!1,Ue=pe.indexOf(")",Ue+1),Ue===-1)if(_e||ri){Ue=et;break}else lt("bracket");for(Ze=Ue;pe.charCodeAt(Ze-1)===BACKSLASH;)Ze-=1,Ye=!Ye}while(Ye);tt=["brackets",pe.slice(et,Ue+1),et,Ue],et=Ue}else Ue=pe.indexOf(")",et+1),qe=pe.slice(et,Ue+1),Ue===-1||RE_BAD_BRACKET.test(qe)?tt=["(","(",et]:(tt=["brackets",qe,et,Ue],et=Ue);break}case SINGLE_QUOTE:case DOUBLE_QUOTE:{Ge=Ne===SINGLE_QUOTE?"'":'"',Ue=et;do{if(Ye=!1,Ue=pe.indexOf(Ge,Ue+1),Ue===-1)if(_e||ri){Ue=et+1;break}else lt("string");for(Ze=Ue;pe.charCodeAt(Ze-1)===BACKSLASH;)Ze-=1,Ye=!Ye}while(Ye);tt=["string",pe.slice(et,Ue+1),et,Ue],et=Ue;break}case AT:{RE_AT_END.lastIndex=et+1,RE_AT_END.test(pe),RE_AT_END.lastIndex===0?Ue=pe.length-1:Ue=RE_AT_END.lastIndex-2,tt=["at-word",pe.slice(et,Ue+1),et,Ue],et=Ue;break}case BACKSLASH:{for(Ue=et,Ke=!0;pe.charCodeAt(Ue+1)===BACKSLASH;)Ue+=1,Ke=!Ke;if(Ne=pe.charCodeAt(Ue+1),Ke&&Ne!==SLASH&&Ne!==SPACE&&Ne!==NEWLINE&&Ne!==TAB&&Ne!==CR&&Ne!==FEED&&(Ue+=1,RE_HEX_ESCAPE.test(pe.charAt(Ue)))){for(;RE_HEX_ESCAPE.test(pe.charAt(Ue+1));)Ue+=1;pe.charCodeAt(Ue+1)===SPACE&&(Ue+=1)}tt=["word",pe.slice(et,Ue+1),et,Ue],et=Ue;break}default:{Ne===SLASH&&pe.charCodeAt(et+1)===ASTERISK?(Ue=pe.indexOf("*/",et+2)+1,Ue===0&&(_e||ri?Ue=pe.length:lt("comment")),tt=["comment",pe.slice(et,Ue+1),et,Ue],et=Ue):(RE_WORD_END.lastIndex=et+1,RE_WORD_END.test(pe),RE_WORD_END.lastIndex===0?Ue=pe.length-1:Ue=RE_WORD_END.lastIndex-2,tt=["word",pe.slice(et,Ue+1),et,Ue],it.push(tt),et=Ue);break}}return et++,tt}function Nr(Wr){nt.push(Wr)}return{back:Nr,endOfFile:_r,nextToken:jr,position:st}};let Container$5=container,AtRule$3=class extends Container$5{constructor(ee){super(ee),this.type="atrule"}append(...ee){return this.proxyOf.nodes||(this.nodes=[]),super.append(...ee)}prepend(...ee){return this.proxyOf.nodes||(this.nodes=[]),super.prepend(...ee)}};var atRule=AtRule$3;AtRule$3.default=AtRule$3;Container$5.registerAtRule(AtRule$3);let Container$4=container,LazyResult$3,Processor$2,Root$5=class extends Container$4{constructor(ee){super(ee),this.type="root",this.nodes||(this.nodes=[])}normalize(ee,ue,pe){let _e=super.normalize(ee);if(ue){if(pe==="prepend")this.nodes.length>1?ue.raws.before=this.nodes[1].raws.before:delete ue.raws.before;else if(this.first!==ue)for(let Ne of _e)Ne.raws.before=ue.raws.before}return _e}removeChild(ee,ue){let pe=this.index(ee);return!ue&&pe===0&&this.nodes.length>1&&(this.nodes[1].raws.before=this.nodes[pe].raws.before),super.removeChild(ee)}toResult(ee={}){return new LazyResult$3(new Processor$2,this,ee).stringify()}};Root$5.registerLazyResult=fe=>{LazyResult$3=fe};Root$5.registerProcessor=fe=>{Processor$2=fe};var root=Root$5;Root$5.default=Root$5;Container$4.registerRoot(Root$5);let list$2={comma(fe){return list$2.split(fe,[","],!0)},space(fe){let ee=[" ",`
`,"	"];return list$2.split(fe,ee)},split(fe,ee,ue){let pe=[],_e="",Ne=!1,Ue=0,Ge=!1,qe="",Ke=!1;for(let Ye of fe)Ke?Ke=!1:Ye==="\\"?Ke=!0:Ge?Ye===qe&&(Ge=!1):Ye==='"'||Ye==="'"?(Ge=!0,qe=Ye):Ye==="("?Ue+=1:Ye===")"?Ue>0&&(Ue-=1):Ue===0&&ee.includes(Ye)&&(Ne=!0),Ne?(_e!==""&&pe.push(_e.trim()),_e="",Ne=!1):_e+=Ye;return(ue||_e!=="")&&pe.push(_e.trim()),pe}};var list_1=list$2;list$2.default=list$2;let Container$3=container,list$1=list_1,Rule$3=class extends Container$3{constructor(ee){super(ee),this.type="rule",this.nodes||(this.nodes=[])}get selectors(){return list$1.comma(this.selector)}set selectors(ee){let ue=this.selector?this.selector.match(/,\s*/):null,pe=ue?ue[0]:","+this.raw("between","beforeOpen");this.selector=ee.join(pe)}};var rule=Rule$3;Rule$3.default=Rule$3;Container$3.registerRule(Rule$3);let Declaration$2=declaration,tokenizer=tokenize,Comment$2=comment,AtRule$2=atRule,Root$4=root,Rule$2=rule;const SAFE_COMMENT_NEIGHBOR={empty:!0,space:!0};function findLastWithPosition(fe){for(let ee=fe.length-1;ee>=0;ee--){let ue=fe[ee],pe=ue[3]||ue[2];if(pe)return pe}}let Parser$1=class{constructor(ee){this.input=ee,this.root=new Root$4,this.current=this.root,this.spaces="",this.semicolon=!1,this.customProperty=!1,this.createTokenizer(),this.root.source={input:ee,start:{column:1,line:1,offset:0}}}atrule(ee){let ue=new AtRule$2;ue.name=ee[1].slice(1),ue.name===""&&this.unnamedAtrule(ue,ee),this.init(ue,ee[2]);let pe,_e,Ne,Ue=!1,Ge=!1,qe=[],Ke=[];for(;!this.tokenizer.endOfFile();){if(ee=this.tokenizer.nextToken(),pe=ee[0],pe==="("||pe==="["?Ke.push(pe==="("?")":"]"):pe==="{"&&Ke.length>0?Ke.push("}"):pe===Ke[Ke.length-1]&&Ke.pop(),Ke.length===0)if(pe===";"){ue.source.end=this.getPosition(ee[2]),ue.source.end.offset++,this.semicolon=!0;break}else if(pe==="{"){Ge=!0;break}else if(pe==="}"){if(qe.length>0){for(Ne=qe.length-1,_e=qe[Ne];_e&&_e[0]==="space";)_e=qe[--Ne];_e&&(ue.source.end=this.getPosition(_e[3]||_e[2]),ue.source.end.offset++)}this.end(ee);break}else qe.push(ee);else qe.push(ee);if(this.tokenizer.endOfFile()){Ue=!0;break}}ue.raws.between=this.spacesAndCommentsFromEnd(qe),qe.length?(ue.raws.afterName=this.spacesAndCommentsFromStart(qe),this.raw(ue,"params",qe),Ue&&(ee=qe[qe.length-1],ue.source.end=this.getPosition(ee[3]||ee[2]),ue.source.end.offset++,this.spaces=ue.raws.between,ue.raws.between="")):(ue.raws.afterName="",ue.params=""),Ge&&(ue.nodes=[],this.current=ue)}checkMissedSemicolon(ee){let ue=this.colon(ee);if(ue===!1)return;let pe=0,_e;for(let Ne=ue-1;Ne>=0&&(_e=ee[Ne],!(_e[0]!=="space"&&(pe+=1,pe===2)));Ne--);throw this.input.error("Missed semicolon",_e[0]==="word"?_e[3]+1:_e[2])}colon(ee){let ue=0,pe,_e,Ne;for(let[Ue,Ge]of ee.entries()){if(pe=Ge,_e=pe[0],_e==="("&&(ue+=1),_e===")"&&(ue-=1),ue===0&&_e===":")if(!Ne)this.doubleColon(pe);else{if(Ne[0]==="word"&&Ne[1]==="progid")continue;return Ue}Ne=pe}return!1}comment(ee){let ue=new Comment$2;this.init(ue,ee[2]),ue.source.end=this.getPosition(ee[3]||ee[2]),ue.source.end.offset++;let pe=ee[1].slice(2,-2);if(/^\s*$/.test(pe))ue.text="",ue.raws.left=pe,ue.raws.right="";else{let _e=pe.match(/^(\s*)([^]*\S)(\s*)$/);ue.text=_e[2],ue.raws.left=_e[1],ue.raws.right=_e[3]}}createTokenizer(){this.tokenizer=tokenizer(this.input)}decl(ee,ue){let pe=new Declaration$2;this.init(pe,ee[0][2]);let _e=ee[ee.length-1];for(_e[0]===";"&&(this.semicolon=!0,ee.pop()),pe.source.end=this.getPosition(_e[3]||_e[2]||findLastWithPosition(ee)),pe.source.end.offset++;ee[0][0]!=="word";)ee.length===1&&this.unknownWord(ee),pe.raws.before+=ee.shift()[1];for(pe.source.start=this.getPosition(ee[0][2]),pe.prop="";ee.length;){let Ke=ee[0][0];if(Ke===":"||Ke==="space"||Ke==="comment")break;pe.prop+=ee.shift()[1]}pe.raws.between="";let Ne;for(;ee.length;)if(Ne=ee.shift(),Ne[0]===":"){pe.raws.between+=Ne[1];break}else Ne[0]==="word"&&/\w/.test(Ne[1])&&this.unknownWord([Ne]),pe.raws.between+=Ne[1];(pe.prop[0]==="_"||pe.prop[0]==="*")&&(pe.raws.before+=pe.prop[0],pe.prop=pe.prop.slice(1));let Ue=[],Ge;for(;ee.length&&(Ge=ee[0][0],!(Ge!=="space"&&Ge!=="comment"));)Ue.push(ee.shift());this.precheckMissedSemicolon(ee);for(let Ke=ee.length-1;Ke>=0;Ke--){if(Ne=ee[Ke],Ne[1].toLowerCase()==="!important"){pe.important=!0;let Ye=this.stringFrom(ee,Ke);Ye=this.spacesFromEnd(ee)+Ye,Ye!==" !important"&&(pe.raws.important=Ye);break}else if(Ne[1].toLowerCase()==="important"){let Ye=ee.slice(0),Ze="";for(let Xe=Ke;Xe>0;Xe--){let Je=Ye[Xe][0];if(Ze.trim().indexOf("!")===0&&Je!=="space")break;Ze=Ye.pop()[1]+Ze}Ze.trim().indexOf("!")===0&&(pe.important=!0,pe.raws.important=Ze,ee=Ye)}if(Ne[0]!=="space"&&Ne[0]!=="comment")break}ee.some(Ke=>Ke[0]!=="space"&&Ke[0]!=="comment")&&(pe.raws.between+=Ue.map(Ke=>Ke[1]).join(""),Ue=[]),this.raw(pe,"value",Ue.concat(ee),ue),pe.value.includes(":")&&!ue&&this.checkMissedSemicolon(ee)}doubleColon(ee){throw this.input.error("Double colon",{offset:ee[2]},{offset:ee[2]+ee[1].length})}emptyRule(ee){let ue=new Rule$2;this.init(ue,ee[2]),ue.selector="",ue.raws.between="",this.current=ue}end(ee){this.current.nodes&&this.current.nodes.length&&(this.current.raws.semicolon=this.semicolon),this.semicolon=!1,this.current.raws.after=(this.current.raws.after||"")+this.spaces,this.spaces="",this.current.parent?(this.current.source.end=this.getPosition(ee[2]),this.current.source.end.offset++,this.current=this.current.parent):this.unexpectedClose(ee)}endFile(){this.current.parent&&this.unclosedBlock(),this.current.nodes&&this.current.nodes.length&&(this.current.raws.semicolon=this.semicolon),this.current.raws.after=(this.current.raws.after||"")+this.spaces,this.root.source.end=this.getPosition(this.tokenizer.position())}freeSemicolon(ee){if(this.spaces+=ee[1],this.current.nodes){let ue=this.current.nodes[this.current.nodes.length-1];ue&&ue.type==="rule"&&!ue.raws.ownSemicolon&&(ue.raws.ownSemicolon=this.spaces,this.spaces="")}}getPosition(ee){let ue=this.input.fromOffset(ee);return{column:ue.col,line:ue.line,offset:ee}}init(ee,ue){this.current.push(ee),ee.source={input:this.input,start:this.getPosition(ue)},ee.raws.before=this.spaces,this.spaces="",ee.type!=="comment"&&(this.semicolon=!1)}other(ee){let ue=!1,pe=null,_e=!1,Ne=null,Ue=[],Ge=ee[1].startsWith("--"),qe=[],Ke=ee;for(;Ke;){if(pe=Ke[0],qe.push(Ke),pe==="("||pe==="[")Ne||(Ne=Ke),Ue.push(pe==="("?")":"]");else if(Ge&&_e&&pe==="{")Ne||(Ne=Ke),Ue.push("}");else if(Ue.length===0)if(pe===";")if(_e){this.decl(qe,Ge);return}else break;else if(pe==="{"){this.rule(qe);return}else if(pe==="}"){this.tokenizer.back(qe.pop()),ue=!0;break}else pe===":"&&(_e=!0);else pe===Ue[Ue.length-1]&&(Ue.pop(),Ue.length===0&&(Ne=null));Ke=this.tokenizer.nextToken()}if(this.tokenizer.endOfFile()&&(ue=!0),Ue.length>0&&this.unclosedBracket(Ne),ue&&_e){if(!Ge)for(;qe.length&&(Ke=qe[qe.length-1][0],!(Ke!=="space"&&Ke!=="comment"));)this.tokenizer.back(qe.pop());this.decl(qe,Ge)}else this.unknownWord(qe)}parse(){let ee;for(;!this.tokenizer.endOfFile();)switch(ee=this.tokenizer.nextToken(),ee[0]){case"space":this.spaces+=ee[1];break;case";":this.freeSemicolon(ee);break;case"}":this.end(ee);break;case"comment":this.comment(ee);break;case"at-word":this.atrule(ee);break;case"{":this.emptyRule(ee);break;default:this.other(ee);break}this.endFile()}precheckMissedSemicolon(){}raw(ee,ue,pe,_e){let Ne,Ue,Ge=pe.length,qe="",Ke=!0,Ye,Ze;for(let Xe=0;Xe<Ge;Xe+=1)Ne=pe[Xe],Ue=Ne[0],Ue==="space"&&Xe===Ge-1&&!_e?Ke=!1:Ue==="comment"?(Ze=pe[Xe-1]?pe[Xe-1][0]:"empty",Ye=pe[Xe+1]?pe[Xe+1][0]:"empty",!SAFE_COMMENT_NEIGHBOR[Ze]&&!SAFE_COMMENT_NEIGHBOR[Ye]?qe.slice(-1)===","?Ke=!1:qe+=Ne[1]:Ke=!1):qe+=Ne[1];if(!Ke){let Xe=pe.reduce((Je,tt)=>Je+tt[1],"");ee.raws[ue]={raw:Xe,value:qe}}ee[ue]=qe}rule(ee){ee.pop();let ue=new Rule$2;this.init(ue,ee[0][2]),ue.raws.between=this.spacesAndCommentsFromEnd(ee),this.raw(ue,"selector",ee),this.current=ue}spacesAndCommentsFromEnd(ee){let ue,pe="";for(;ee.length&&(ue=ee[ee.length-1][0],!(ue!=="space"&&ue!=="comment"));)pe=ee.pop()[1]+pe;return pe}spacesAndCommentsFromStart(ee){let ue,pe="";for(;ee.length&&(ue=ee[0][0],!(ue!=="space"&&ue!=="comment"));)pe+=ee.shift()[1];return pe}spacesFromEnd(ee){let ue,pe="";for(;ee.length&&(ue=ee[ee.length-1][0],ue==="space");)pe=ee.pop()[1]+pe;return pe}stringFrom(ee,ue){let pe="";for(let _e=ue;_e<ee.length;_e++)pe+=ee[_e][1];return ee.splice(ue,ee.length-ue),pe}unclosedBlock(){let ee=this.current.source.start;throw this.input.error("Unclosed block",ee.line,ee.column)}unclosedBracket(ee){throw this.input.error("Unclosed bracket",{offset:ee[2]},{offset:ee[2]+1})}unexpectedClose(ee){throw this.input.error("Unexpected }",{offset:ee[2]},{offset:ee[2]+1})}unknownWord(ee){throw this.input.error("Unknown word",{offset:ee[0][2]},{offset:ee[0][2]+ee[0][1].length})}unnamedAtrule(ee,ue){throw this.input.error("At-rule without name",{offset:ue[2]},{offset:ue[2]+ue[1].length})}};var parser$1=Parser$1;let Container$2=container,Parser=parser$1,Input$2=input;function parse$7(fe,ee){let ue=new Input$2(fe,ee),pe=new Parser(ue);try{pe.parse()}catch(_e){throw _e}return pe.root}var parse_1=parse$7;parse$7.default=parse$7;Container$2.registerParse(parse$7);let{isClean,my}=symbols,MapGenerator$1=mapGenerator,stringify$2=stringify_1,Container$1=container,Document$2=document$1,Result$2=result,parse$6=parse_1,Root$3=root;const TYPE_TO_CLASS_NAME={atrule:"AtRule",comment:"Comment",decl:"Declaration",document:"Document",root:"Root",rule:"Rule"},PLUGIN_PROPS={AtRule:!0,AtRuleExit:!0,Comment:!0,CommentExit:!0,Declaration:!0,DeclarationExit:!0,Document:!0,DocumentExit:!0,Once:!0,OnceExit:!0,postcssPlugin:!0,prepare:!0,Root:!0,RootExit:!0,Rule:!0,RuleExit:!0},NOT_VISITORS={Once:!0,postcssPlugin:!0,prepare:!0},CHILDREN=0;function isPromise$1(fe){return typeof fe=="object"&&typeof fe.then=="function"}function getEvents(fe){let ee=!1,ue=TYPE_TO_CLASS_NAME[fe.type];return fe.type==="decl"?ee=fe.prop.toLowerCase():fe.type==="atrule"&&(ee=fe.name.toLowerCase()),ee&&fe.append?[ue,ue+"-"+ee,CHILDREN,ue+"Exit",ue+"Exit-"+ee]:ee?[ue,ue+"-"+ee,ue+"Exit",ue+"Exit-"+ee]:fe.append?[ue,CHILDREN,ue+"Exit"]:[ue,ue+"Exit"]}function toStack(fe){let ee;return fe.type==="document"?ee=["Document",CHILDREN,"DocumentExit"]:fe.type==="root"?ee=["Root",CHILDREN,"RootExit"]:ee=getEvents(fe),{eventIndex:0,events:ee,iterator:0,node:fe,visitorIndex:0,visitors:[]}}function cleanMarks(fe){return fe[isClean]=!1,fe.nodes&&fe.nodes.forEach(ee=>cleanMarks(ee)),fe}let postcss$1={},LazyResult$2=class es{constructor(ee,ue,pe){this.stringified=!1,this.processed=!1;let _e;if(typeof ue=="object"&&ue!==null&&(ue.type==="root"||ue.type==="document"))_e=cleanMarks(ue);else if(ue instanceof es||ue instanceof Result$2)_e=cleanMarks(ue.root),ue.map&&(typeof pe.map>"u"&&(pe.map={}),pe.map.inline||(pe.map.inline=!1),pe.map.prev=ue.map);else{let Ne=parse$6;pe.syntax&&(Ne=pe.syntax.parse),pe.parser&&(Ne=pe.parser),Ne.parse&&(Ne=Ne.parse);try{_e=Ne(ue,pe)}catch(Ue){this.processed=!0,this.error=Ue}_e&&!_e[my]&&Container$1.rebuild(_e)}this.result=new Result$2(ee,_e,pe),this.helpers={...postcss$1,postcss:postcss$1,result:this.result},this.plugins=this.processor.plugins.map(Ne=>typeof Ne=="object"&&Ne.prepare?{...Ne,...Ne.prepare(this.result)}:Ne)}async(){return this.error?Promise.reject(this.error):this.processed?Promise.resolve(this.result):(this.processing||(this.processing=this.runAsync()),this.processing)}catch(ee){return this.async().catch(ee)}finally(ee){return this.async().then(ee,ee)}getAsyncError(){throw new Error("Use process(css).then(cb) to work with async plugins")}handleError(ee,ue){let pe=this.result.lastPlugin;try{ue&&ue.addToError(ee),this.error=ee,ee.name==="CssSyntaxError"&&!ee.plugin?(ee.plugin=pe.postcssPlugin,ee.setMessage()):pe.postcssVersion}catch(_e){console&&console.error&&console.error(_e)}return ee}prepareVisitors(){this.listeners={};let ee=(ue,pe,_e)=>{this.listeners[pe]||(this.listeners[pe]=[]),this.listeners[pe].push([ue,_e])};for(let ue of this.plugins)if(typeof ue=="object")for(let pe in ue){if(!PLUGIN_PROPS[pe]&&/^[A-Z]/.test(pe))throw new Error(`Unknown event ${pe} in ${ue.postcssPlugin}. Try to update PostCSS (${this.processor.version} now).`);if(!NOT_VISITORS[pe])if(typeof ue[pe]=="object")for(let _e in ue[pe])_e==="*"?ee(ue,pe,ue[pe][_e]):ee(ue,pe+"-"+_e.toLowerCase(),ue[pe][_e]);else typeof ue[pe]=="function"&&ee(ue,pe,ue[pe])}this.hasListener=Object.keys(this.listeners).length>0}async runAsync(){this.plugin=0;for(let ee=0;ee<this.plugins.length;ee++){let ue=this.plugins[ee],pe=this.runOnRoot(ue);if(isPromise$1(pe))try{await pe}catch(_e){throw this.handleError(_e)}}if(this.prepareVisitors(),this.hasListener){let ee=this.result.root;for(;!ee[isClean];){ee[isClean]=!0;let ue=[toStack(ee)];for(;ue.length>0;){let pe=this.visitTick(ue);if(isPromise$1(pe))try{await pe}catch(_e){let Ne=ue[ue.length-1].node;throw this.handleError(_e,Ne)}}}if(this.listeners.OnceExit)for(let[ue,pe]of this.listeners.OnceExit){this.result.lastPlugin=ue;try{if(ee.type==="document"){let _e=ee.nodes.map(Ne=>pe(Ne,this.helpers));await Promise.all(_e)}else await pe(ee,this.helpers)}catch(_e){throw this.handleError(_e)}}}return this.processed=!0,this.stringify()}runOnRoot(ee){this.result.lastPlugin=ee;try{if(typeof ee=="object"&&ee.Once){if(this.result.root.type==="document"){let ue=this.result.root.nodes.map(pe=>ee.Once(pe,this.helpers));return isPromise$1(ue[0])?Promise.all(ue):ue}return ee.Once(this.result.root,this.helpers)}else if(typeof ee=="function")return ee(this.result.root,this.result)}catch(ue){throw this.handleError(ue)}}stringify(){if(this.error)throw this.error;if(this.stringified)return this.result;this.stringified=!0,this.sync();let ee=this.result.opts,ue=stringify$2;ee.syntax&&(ue=ee.syntax.stringify),ee.stringifier&&(ue=ee.stringifier),ue.stringify&&(ue=ue.stringify);let _e=new MapGenerator$1(ue,this.result.root,this.result.opts).generate();return this.result.css=_e[0],this.result.map=_e[1],this.result}sync(){if(this.error)throw this.error;if(this.processed)return this.result;if(this.processed=!0,this.processing)throw this.getAsyncError();for(let ee of this.plugins){let ue=this.runOnRoot(ee);if(isPromise$1(ue))throw this.getAsyncError()}if(this.prepareVisitors(),this.hasListener){let ee=this.result.root;for(;!ee[isClean];)ee[isClean]=!0,this.walkSync(ee);if(this.listeners.OnceExit)if(ee.type==="document")for(let ue of ee.nodes)this.visitSync(this.listeners.OnceExit,ue);else this.visitSync(this.listeners.OnceExit,ee)}return this.result}then(ee,ue){return this.async().then(ee,ue)}toString(){return this.css}visitSync(ee,ue){for(let[pe,_e]of ee){this.result.lastPlugin=pe;let Ne;try{Ne=_e(ue,this.helpers)}catch(Ue){throw this.handleError(Ue,ue.proxyOf)}if(ue.type!=="root"&&ue.type!=="document"&&!ue.parent)return!0;if(isPromise$1(Ne))throw this.getAsyncError()}}visitTick(ee){let ue=ee[ee.length-1],{node:pe,visitors:_e}=ue;if(pe.type!=="root"&&pe.type!=="document"&&!pe.parent){ee.pop();return}if(_e.length>0&&ue.visitorIndex<_e.length){let[Ue,Ge]=_e[ue.visitorIndex];ue.visitorIndex+=1,ue.visitorIndex===_e.length&&(ue.visitors=[],ue.visitorIndex=0),this.result.lastPlugin=Ue;try{return Ge(pe.toProxy(),this.helpers)}catch(qe){throw this.handleError(qe,pe)}}if(ue.iterator!==0){let Ue=ue.iterator,Ge;for(;Ge=pe.nodes[pe.indexes[Ue]];)if(pe.indexes[Ue]+=1,!Ge[isClean]){Ge[isClean]=!0,ee.push(toStack(Ge));return}ue.iterator=0,delete pe.indexes[Ue]}let Ne=ue.events;for(;ue.eventIndex<Ne.length;){let Ue=Ne[ue.eventIndex];if(ue.eventIndex+=1,Ue===CHILDREN){pe.nodes&&pe.nodes.length&&(pe[isClean]=!0,ue.iterator=pe.getIterator());return}else if(this.listeners[Ue]){ue.visitors=this.listeners[Ue];return}}ee.pop()}walkSync(ee){ee[isClean]=!0;let ue=getEvents(ee);for(let pe of ue)if(pe===CHILDREN)ee.nodes&&ee.each(_e=>{_e[isClean]||this.walkSync(_e)});else{let _e=this.listeners[pe];if(_e&&this.visitSync(_e,ee.toProxy()))return}}warnings(){return this.sync().warnings()}get content(){return this.stringify().content}get css(){return this.stringify().css}get map(){return this.stringify().map}get messages(){return this.sync().messages}get opts(){return this.result.opts}get processor(){return this.result.processor}get root(){return this.sync().root}get[Symbol.toStringTag](){return"LazyResult"}};LazyResult$2.registerPostcss=fe=>{postcss$1=fe};var lazyResult=LazyResult$2;LazyResult$2.default=LazyResult$2;Root$3.registerLazyResult(LazyResult$2);Document$2.registerLazyResult(LazyResult$2);let MapGenerator=mapGenerator,stringify$1=stringify_1,parse$5=parse_1;const Result$1=result;let NoWorkResult$1=class{constructor(ee,ue,pe){ue=ue.toString(),this.stringified=!1,this._processor=ee,this._css=ue,this._opts=pe,this._map=void 0;let _e,Ne=stringify$1;this.result=new Result$1(this._processor,_e,this._opts),this.result.css=ue;let Ue=this;Object.defineProperty(this.result,"root",{get(){return Ue.root}});let Ge=new MapGenerator(Ne,_e,this._opts,ue);if(Ge.isMap()){let[qe,Ke]=Ge.generate();qe&&(this.result.css=qe),Ke&&(this.result.map=Ke)}}async(){return this.error?Promise.reject(this.error):Promise.resolve(this.result)}catch(ee){return this.async().catch(ee)}finally(ee){return this.async().then(ee,ee)}sync(){if(this.error)throw this.error;return this.result}then(ee,ue){return this.async().then(ee,ue)}toString(){return this._css}warnings(){return[]}get content(){return this.result.css}get css(){return this.result.css}get map(){return this.result.map}get messages(){return[]}get opts(){return this.result.opts}get processor(){return this.result.processor}get root(){if(this._root)return this._root;let ee,ue=parse$5;try{ee=ue(this._css,this._opts)}catch(pe){this.error=pe}if(this.error)throw this.error;return this._root=ee,ee}get[Symbol.toStringTag](){return"NoWorkResult"}};var noWorkResult=NoWorkResult$1;NoWorkResult$1.default=NoWorkResult$1;let NoWorkResult=noWorkResult,LazyResult$1=lazyResult,Document$1=document$1,Root$2=root,Processor$1=class{constructor(ee=[]){this.version="8.4.32",this.plugins=this.normalize(ee)}normalize(ee){let ue=[];for(let pe of ee)if(pe.postcss===!0?pe=pe():pe.postcss&&(pe=pe.postcss),typeof pe=="object"&&Array.isArray(pe.plugins))ue=ue.concat(pe.plugins);else if(typeof pe=="object"&&pe.postcssPlugin)ue.push(pe);else if(typeof pe=="function")ue.push(pe);else if(!(typeof pe=="object"&&(pe.parse||pe.stringify)))throw new Error(pe+" is not a PostCSS plugin");return ue}process(ee,ue={}){return this.plugins.length===0&&typeof ue.parser>"u"&&typeof ue.stringifier>"u"&&typeof ue.syntax>"u"?new NoWorkResult(this,ee,ue):new LazyResult$1(this,ee,ue)}use(ee){return this.plugins=this.plugins.concat(this.normalize([ee])),this}};var processor=Processor$1;Processor$1.default=Processor$1;Root$2.registerProcessor(Processor$1);Document$1.registerProcessor(Processor$1);let Declaration$1=declaration,PreviousMap=previousMap,Comment$1=comment,AtRule$1=atRule,Input$1=input,Root$1=root,Rule$1=rule;function fromJSON$1(fe,ee){if(Array.isArray(fe))return fe.map(_e=>fromJSON$1(_e));let{inputs:ue,...pe}=fe;if(ue){ee=[];for(let _e of ue){let Ne={..._e,__proto__:Input$1.prototype};Ne.map&&(Ne.map={...Ne.map,__proto__:PreviousMap.prototype}),ee.push(Ne)}}if(pe.nodes&&(pe.nodes=fe.nodes.map(_e=>fromJSON$1(_e,ee))),pe.source){let{inputId:_e,...Ne}=pe.source;pe.source=Ne,_e!=null&&(pe.source.input=ee[_e])}if(pe.type==="root")return new Root$1(pe);if(pe.type==="decl")return new Declaration$1(pe);if(pe.type==="rule")return new Rule$1(pe);if(pe.type==="comment")return new Comment$1(pe);if(pe.type==="atrule")return new AtRule$1(pe);throw new Error("Unknown node type: "+fe.type)}var fromJSON_1=fromJSON$1;fromJSON$1.default=fromJSON$1;var define_process_env_default={};let CssSyntaxError=cssSyntaxError,Declaration=declaration,LazyResult=lazyResult,Container=container,Processor=processor,stringify=stringify_1,fromJSON=fromJSON_1,Document=document$1,Warning=warning,Comment=comment,AtRule=atRule,Result=result,Input=input,parse$4=parse_1,list=list_1,Rule=rule,Root=root,Node$1=node;function postcss(...fe){return fe.length===1&&Array.isArray(fe[0])&&(fe=fe[0]),new Processor(fe)}postcss.plugin=function(ee,ue){let pe=!1;function _e(...Ue){console&&console.warn&&!pe&&(pe=!0,console.warn(ee+`: postcss.plugin was deprecated. Migration guide:
https://evilmartians.com/chronicles/postcss-8-plugin-migration`),define_process_env_default.LANG&&define_process_env_default.LANG.startsWith("cn")&&console.warn(ee+`:  postcss.plugin . :
https://www.w3ctech.com/topic/2226`));let Ge=ue(...Ue);return Ge.postcssPlugin=ee,Ge.postcssVersion=new Processor().version,Ge}let Ne;return Object.defineProperty(_e,"postcss",{get(){return Ne||(Ne=_e()),Ne}}),_e.process=function(Ue,Ge,qe){return postcss([_e(qe)]).process(Ue,Ge)},_e};postcss.stringify=stringify;postcss.parse=parse$4;postcss.fromJSON=fromJSON;postcss.list=list;postcss.comment=fe=>new Comment(fe);postcss.atRule=fe=>new AtRule(fe);postcss.decl=fe=>new Declaration(fe);postcss.rule=fe=>new Rule(fe);postcss.root=fe=>new Root(fe);postcss.document=fe=>new Document(fe);postcss.CssSyntaxError=CssSyntaxError;postcss.Declaration=Declaration;postcss.Container=Container;postcss.Processor=Processor;postcss.Document=Document;postcss.Comment=Comment;postcss.Warning=Warning;postcss.AtRule=AtRule;postcss.Result=Result;postcss.Input=Input;postcss.Rule=Rule;postcss.Root=Root;postcss.Node=Node$1;LazyResult.registerPostcss(postcss);var postcss_1=postcss;postcss.default=postcss;const htmlparser=lib$5,escapeStringRegexp=escapeStringRegexp$1,{isPlainObject}=isPlainObject$2,deepmerge=cjs,parseSrcset=parseSrcsetExports,{parse:postcssParse}=postcss_1,mediaTags=["img","audio","video","picture","svg","object","map","iframe","embed"],vulnerableTags=["script","style"];function each(fe,ee){fe&&Object.keys(fe).forEach(function(ue){ee(fe[ue],ue)})}function has(fe,ee){return{}.hasOwnProperty.call(fe,ee)}function filter(fe,ee){const ue=[];return each(fe,function(pe){ee(pe)&&ue.push(pe)}),ue}function isEmptyObject(fe){for(const ee in fe)if(has(fe,ee))return!1;return!0}function stringifySrcset(fe){return fe.map(function(ee){if(!ee.url)throw new Error("URL missing");return ee.url+(ee.w?` ${ee.w}w`:"")+(ee.h?` ${ee.h}h`:"")+(ee.d?` ${ee.d}x`:"")}).join(", ")}var sanitizeHtml_1=sanitizeHtml;const VALID_HTML_ATTRIBUTE_NAME=/^[^\0\t\n\f\r /<=>]+$/;function sanitizeHtml(fe,ee,ue){if(fe==null)return"";typeof fe=="number"&&(fe=fe.toString());let pe="",_e="";function Ne(Yr,ii){const ti=this;this.tag=Yr,this.attribs=ii||{},this.tagPosition=pe.length,this.text="",this.mediaChildren=[],this.updateParentNodeText=function(){if(et.length){const ni=et[et.length-1];ni.text+=ti.text}},this.updateParentNodeMediaChildren=function(){et.length&&mediaTags.includes(this.tag)&&et[et.length-1].mediaChildren.push(this.tag)}}ee=Object.assign({},sanitizeHtml.defaults,ee),ee.parser=Object.assign({},htmlParserDefaults,ee.parser);const Ue=function(Yr){return ee.allowedTags===!1||(ee.allowedTags||[]).indexOf(Yr)>-1};vulnerableTags.forEach(function(Yr){Ue(Yr)&&!ee.allowVulnerableTags&&console.warn(`

 Your \`allowedTags\` option includes, \`${Yr}\`, which is inherently
vulnerable to XSS attacks. Please remove it from \`allowedTags\`.
Or, to disable this warning, add the \`allowVulnerableTags\` option
and ensure you are accounting for this risk.

`)});const Ge=ee.nonTextTags||["script","style","textarea","option"];let qe,Ke;ee.allowedAttributes&&(qe={},Ke={},each(ee.allowedAttributes,function(Yr,ii){qe[ii]=[];const ti=[];Yr.forEach(function(ni){typeof ni=="string"&&ni.indexOf("*")>=0?ti.push(escapeStringRegexp(ni).replace(/\\\*/g,".*")):qe[ii].push(ni)}),ti.length&&(Ke[ii]=new RegExp("^("+ti.join("|")+")$"))}));const Ye={},Ze={},Xe={};each(ee.allowedClasses,function(Yr,ii){if(qe&&(has(qe,ii)||(qe[ii]=[]),qe[ii].push("class")),Ye[ii]=Yr,Array.isArray(Yr)){const ti=[];Ye[ii]=[],Xe[ii]=[],Yr.forEach(function(ni){typeof ni=="string"&&ni.indexOf("*")>=0?ti.push(escapeStringRegexp(ni).replace(/\\\*/g,".*")):ni instanceof RegExp?Xe[ii].push(ni):Ye[ii].push(ni)}),ti.length&&(Ze[ii]=new RegExp("^("+ti.join("|")+")$"))}});const Je={};let tt;each(ee.transformTags,function(Yr,ii){let ti;typeof Yr=="function"?ti=Yr:typeof Yr=="string"&&(ti=sanitizeHtml.simpleTransform(Yr)),ii==="*"?tt=ti:Je[ii]=ti});let rt,et,it,nt,st,lt,_r=!1;Nr();const jr=new htmlparser.Parser({onopentag:function(Yr,ii){if(ee.enforceHtmlBoundary&&Yr==="html"&&Nr(),st){lt++;return}const ti=new Ne(Yr,ii);et.push(ti);let ni=!1;const ui=!!ti.text;let yi;if(has(Je,Yr)&&(yi=Je[Yr](Yr,ii),ti.attribs=ii=yi.attribs,yi.text!==void 0&&(ti.innerText=yi.text),Yr!==yi.tagName&&(ti.name=Yr=yi.tagName,nt[rt]=yi.tagName)),tt&&(yi=tt(Yr,ii),ti.attribs=ii=yi.attribs,Yr!==yi.tagName&&(ti.name=Yr=yi.tagName,nt[rt]=yi.tagName)),(!Ue(Yr)||ee.disallowedTagsMode==="recursiveEscape"&&!isEmptyObject(it)||ee.nestingLimit!=null&&rt>=ee.nestingLimit)&&(ni=!0,it[rt]=!0,ee.disallowedTagsMode==="discard"&&Ge.indexOf(Yr)!==-1&&(st=!0,lt=1),it[rt]=!0),rt++,ni){if(ee.disallowedTagsMode==="discard")return;_e=pe,pe=""}pe+="<"+Yr,Yr==="script"&&(ee.allowedScriptHostnames||ee.allowedScriptDomains)&&(ti.innerText=""),(!qe||has(qe,Yr)||qe["*"])&&each(ii,function(hi,pi){if(!VALID_HTML_ATTRIBUTE_NAME.test(pi)){delete ti.attribs[pi];return}if(hi===""&&(ee.nonBooleanAttributes.includes(pi)||ee.nonBooleanAttributes.includes("*"))){delete ti.attribs[pi];return}let Ri=!1;if(!qe||has(qe,Yr)&&qe[Yr].indexOf(pi)!==-1||qe["*"]&&qe["*"].indexOf(pi)!==-1||has(Ke,Yr)&&Ke[Yr].test(pi)||Ke["*"]&&Ke["*"].test(pi))Ri=!0;else if(qe&&qe[Yr]){for(const Ei of qe[Yr])if(isPlainObject(Ei)&&Ei.name&&Ei.name===pi){Ri=!0;let bi="";if(Ei.multiple===!0){const _i=hi.split(" ");for(const vi of _i)Ei.values.indexOf(vi)!==-1&&(bi===""?bi=vi:bi+=" "+vi)}else Ei.values.indexOf(hi)>=0&&(bi=hi);hi=bi}}if(Ri){if(ee.allowedSchemesAppliedToAttributes.indexOf(pi)!==-1&&ri(Yr,hi)){delete ti.attribs[pi];return}if(Yr==="script"&&pi==="src"){let Ei=!0;try{const bi=Xr(hi);if(ee.allowedScriptHostnames||ee.allowedScriptDomains){const _i=(ee.allowedScriptHostnames||[]).find(function(Ti){return Ti===bi.url.hostname}),vi=(ee.allowedScriptDomains||[]).find(function(Ti){return bi.url.hostname===Ti||bi.url.hostname.endsWith(`.${Ti}`)});Ei=_i||vi}}catch{Ei=!1}if(!Ei){delete ti.attribs[pi];return}}if(Yr==="iframe"&&pi==="src"){let Ei=!0;try{const bi=Xr(hi);if(bi.isRelativeUrl)Ei=has(ee,"allowIframeRelativeUrls")?ee.allowIframeRelativeUrls:!ee.allowedIframeHostnames&&!ee.allowedIframeDomains;else if(ee.allowedIframeHostnames||ee.allowedIframeDomains){const _i=(ee.allowedIframeHostnames||[]).find(function(Ti){return Ti===bi.url.hostname}),vi=(ee.allowedIframeDomains||[]).find(function(Ti){return bi.url.hostname===Ti||bi.url.hostname.endsWith(`.${Ti}`)});Ei=_i||vi}}catch{Ei=!1}if(!Ei){delete ti.attribs[pi];return}}if(pi==="srcset")try{let Ei=parseSrcset(hi);if(Ei.forEach(function(bi){ri("srcset",bi.url)&&(bi.evil=!0)}),Ei=filter(Ei,function(bi){return!bi.evil}),Ei.length)hi=stringifySrcset(filter(Ei,function(bi){return!bi.evil})),ti.attribs[pi]=hi;else{delete ti.attribs[pi];return}}catch{delete ti.attribs[pi];return}if(pi==="class"){const Ei=Ye[Yr],bi=Ye["*"],_i=Ze[Yr],vi=Xe[Yr],Ti=Ze["*"],Fi=[_i,Ti].concat(vi).filter(function(Li){return Li});if(Ei&&bi?hi=oi(hi,deepmerge(Ei,bi),Fi):hi=oi(hi,Ei||bi,Fi),!hi.length){delete ti.attribs[pi];return}}if(pi==="style"){if(ee.parseStyleAttributes)try{const Ei=postcssParse(Yr+" {"+hi+"}"),bi=Gr(Ei,ee.allowedStyles);if(hi=qr(bi),hi.length===0){delete ti.attribs[pi];return}}catch{typeof window<"u"&&console.warn('Failed to parse "'+Yr+" {"+hi+`}", If you're running this in a browser, we recommend to disable style parsing: options.parseStyleAttributes: false, since this only works in a node environment due to a postcss dependency, More info: https://github.com/apostrophecms/sanitize-html/issues/547`),delete ti.attribs[pi];return}else if(ee.allowedStyles)throw new Error("allowedStyles option cannot be used together with parseStyleAttributes: false.")}pe+=" "+pi,hi&&hi.length&&(pe+='="'+Wr(hi,!0)+'"')}else delete ti.attribs[pi]}),ee.selfClosing.indexOf(Yr)!==-1?pe+=" />":(pe+=">",ti.innerText&&!ui&&!ee.textFilter&&(pe+=Wr(ti.innerText),_r=!0)),ni&&(pe=_e+Wr(pe),_e="")},ontext:function(Yr){if(st)return;const ii=et[et.length-1];let ti;if(ii&&(ti=ii.tag,Yr=ii.innerText!==void 0?ii.innerText:Yr),ee.disallowedTagsMode==="discard"&&(ti==="script"||ti==="style"))pe+=Yr;else{const ni=Wr(Yr,!1);ee.textFilter&&!_r?pe+=ee.textFilter(ni,ti):_r||(pe+=ni)}if(et.length){const ni=et[et.length-1];ni.text+=Yr}},onclosetag:function(Yr,ii){if(st)if(lt--,!lt)st=!1;else return;const ti=et.pop();if(!ti)return;if(ti.tag!==Yr){et.push(ti);return}st=ee.enforceHtmlBoundary?Yr==="html":!1,rt--;const ni=it[rt];if(ni){if(delete it[rt],ee.disallowedTagsMode==="discard"){ti.updateParentNodeText();return}_e=pe,pe=""}if(nt[rt]&&(Yr=nt[rt],delete nt[rt]),ee.exclusiveFilter&&ee.exclusiveFilter(ti)){pe=pe.substr(0,ti.tagPosition);return}if(ti.updateParentNodeMediaChildren(),ti.updateParentNodeText(),ee.selfClosing.indexOf(Yr)!==-1||ii&&!Ue(Yr)&&["escape","recursiveEscape"].indexOf(ee.disallowedTagsMode)>=0){ni&&(pe=_e,_e="");return}pe+="</"+Yr+">",ni&&(pe=_e+Wr(pe),_e=""),_r=!1}},ee.parser);return jr.write(fe),jr.end(),pe;function Nr(){pe="",rt=0,et=[],it={},nt={},st=!1,lt=0}function Wr(Yr,ii){return typeof Yr!="string"&&(Yr=Yr+""),ee.parser.decodeEntities&&(Yr=Yr.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),ii&&(Yr=Yr.replace(/"/g,"&quot;"))),Yr=Yr.replace(/&(?![a-zA-Z0-9#]{1,20};)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),ii&&(Yr=Yr.replace(/"/g,"&quot;")),Yr}function ri(Yr,ii){for(ii=ii.replace(/[\x00-\x20]+/g,"");;){const ui=ii.indexOf("<!--");if(ui===-1)break;const yi=ii.indexOf("-->",ui+4);if(yi===-1)break;ii=ii.substring(0,ui)+ii.substring(yi+3)}const ti=ii.match(/^([a-zA-Z][a-zA-Z0-9.\-+]*):/);if(!ti)return ii.match(/^[/\\]{2}/)?!ee.allowProtocolRelative:!1;const ni=ti[1].toLowerCase();return has(ee.allowedSchemesByTag,Yr)?ee.allowedSchemesByTag[Yr].indexOf(ni)===-1:!ee.allowedSchemes||ee.allowedSchemes.indexOf(ni)===-1}function Xr(Yr){if(Yr=Yr.replace(/^(\w+:)?\s*[\\/]\s*[\\/]/,"$1//"),Yr.startsWith("relative:"))throw new Error("relative: exploit attempt");let ii="relative://relative-site";for(let ui=0;ui<100;ui++)ii+=`/${ui}`;const ti=new URL(Yr,ii);return{isRelativeUrl:ti&&ti.hostname==="relative-site"&&ti.protocol==="relative:",url:ti}}function Gr(Yr,ii){if(!ii)return Yr;const ti=Yr.nodes[0];let ni;return ii[ti.selector]&&ii["*"]?ni=deepmerge(ii[ti.selector],ii["*"]):ni=ii[ti.selector]||ii["*"],ni&&(Yr.nodes[0].nodes=ti.nodes.reduce(si(ni),[])),Yr}function qr(Yr){return Yr.nodes[0].nodes.reduce(function(ii,ti){return ii.push(`${ti.prop}:${ti.value}${ti.important?" !important":""}`),ii},[]).join(";")}function si(Yr){return function(ii,ti){return has(Yr,ti.prop)&&Yr[ti.prop].some(function(ui){return ui.test(ti.value)})&&ii.push(ti),ii}}function oi(Yr,ii,ti){return ii?(Yr=Yr.split(/\s+/),Yr.filter(function(ni){return ii.indexOf(ni)!==-1||ti.some(function(ui){return ui.test(ni)})}).join(" ")):Yr}}const htmlParserDefaults={decodeEntities:!0};sanitizeHtml.defaults={allowedTags:["address","article","aside","footer","header","h1","h2","h3","h4","h5","h6","hgroup","main","nav","section","blockquote","dd","div","dl","dt","figcaption","figure","hr","li","main","ol","p","pre","ul","a","abbr","b","bdi","bdo","br","cite","code","data","dfn","em","i","kbd","mark","q","rb","rp","rt","rtc","ruby","s","samp","small","span","strong","sub","sup","time","u","var","wbr","caption","col","colgroup","table","tbody","td","tfoot","th","thead","tr"],nonBooleanAttributes:["abbr","accept","accept-charset","accesskey","action","allow","alt","as","autocapitalize","autocomplete","blocking","charset","cite","class","color","cols","colspan","content","contenteditable","coords","crossorigin","data","datetime","decoding","dir","dirname","download","draggable","enctype","enterkeyhint","fetchpriority","for","form","formaction","formenctype","formmethod","formtarget","headers","height","hidden","high","href","hreflang","http-equiv","id","imagesizes","imagesrcset","inputmode","integrity","is","itemid","itemprop","itemref","itemtype","kind","label","lang","list","loading","low","max","maxlength","media","method","min","minlength","name","nonce","optimum","pattern","ping","placeholder","popover","popovertarget","popovertargetaction","poster","preload","referrerpolicy","rel","rows","rowspan","sandbox","scope","shape","size","sizes","slot","span","spellcheck","src","srcdoc","srclang","srcset","start","step","style","tabindex","target","title","translate","type","usemap","value","width","wrap","onauxclick","onafterprint","onbeforematch","onbeforeprint","onbeforeunload","onbeforetoggle","onblur","oncancel","oncanplay","oncanplaythrough","onchange","onclick","onclose","oncontextlost","oncontextmenu","oncontextrestored","oncopy","oncuechange","oncut","ondblclick","ondrag","ondragend","ondragenter","ondragleave","ondragover","ondragstart","ondrop","ondurationchange","onemptied","onended","onerror","onfocus","onformdata","onhashchange","oninput","oninvalid","onkeydown","onkeypress","onkeyup","onlanguagechange","onload","onloadeddata","onloadedmetadata","onloadstart","onmessage","onmessageerror","onmousedown","onmouseenter","onmouseleave","onmousemove","onmouseout","onmouseover","onmouseup","onoffline","ononline","onpagehide","onpageshow","onpaste","onpause","onplay","onplaying","onpopstate","onprogress","onratechange","onreset","onresize","onrejectionhandled","onscroll","onscrollend","onsecuritypolicyviolation","onseeked","onseeking","onselect","onslotchange","onstalled","onstorage","onsubmit","onsuspend","ontimeupdate","ontoggle","onunhandledrejection","onunload","onvolumechange","onwaiting","onwheel"],disallowedTagsMode:"discard",allowedAttributes:{a:["href","name","target"],img:["src","srcset","alt","title","width","height","loading"]},selfClosing:["img","br","hr","area","base","basefont","input","link","meta"],allowedSchemes:["http","https","ftp","mailto","tel"],allowedSchemesByTag:{},allowedSchemesAppliedToAttributes:["href","src","cite"],allowProtocolRelative:!0,enforceHtmlBoundary:!1,parseStyleAttributes:!0};sanitizeHtml.simpleTransform=function(fe,ee,ue){return ue=ue===void 0?!0:ue,ee=ee||{},function(pe,_e){let Ne;if(ue)for(Ne in ee)_e[Ne]=ee[Ne];else _e=ee;return{tagName:fe,attribs:_e}}};const Qe=getDefaultExportFromCjs$1(sanitizeHtml_1);function getDefaultExportFromCjs(fe){return fe&&fe.__esModule&&Object.prototype.hasOwnProperty.call(fe,"default")?fe.default:fe}var urlToolkit={exports:{}};(function(fe,ee){(function(ue){var pe=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,_e=/^(?=([^\/?#]*))\1([^]*)$/,Ne=/(?:\/|^)\.(?=\/)/g,Ue=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,Ge={buildAbsoluteURL:function(qe,Ke,Ye){if(Ye=Ye||{},qe=qe.trim(),Ke=Ke.trim(),!Ke){if(!Ye.alwaysNormalize)return qe;var Ze=Ge.parseURL(qe);if(!Ze)throw new Error("Error trying to parse base URL.");return Ze.path=Ge.normalizePath(Ze.path),Ge.buildURLFromParts(Ze)}var Xe=Ge.parseURL(Ke);if(!Xe)throw new Error("Error trying to parse relative URL.");if(Xe.scheme)return Ye.alwaysNormalize?(Xe.path=Ge.normalizePath(Xe.path),Ge.buildURLFromParts(Xe)):Ke;var Je=Ge.parseURL(qe);if(!Je)throw new Error("Error trying to parse base URL.");if(!Je.netLoc&&Je.path&&Je.path[0]!=="/"){var tt=_e.exec(Je.path);Je.netLoc=tt[1],Je.path=tt[2]}Je.netLoc&&!Je.path&&(Je.path="/");var rt={scheme:Je.scheme,netLoc:Xe.netLoc,path:null,params:Xe.params,query:Xe.query,fragment:Xe.fragment};if(!Xe.netLoc&&(rt.netLoc=Je.netLoc,Xe.path[0]!=="/"))if(!Xe.path)rt.path=Je.path,Xe.params||(rt.params=Je.params,Xe.query||(rt.query=Je.query));else{var et=Je.path,it=et.substring(0,et.lastIndexOf("/")+1)+Xe.path;rt.path=Ge.normalizePath(it)}return rt.path===null&&(rt.path=Ye.alwaysNormalize?Ge.normalizePath(Xe.path):Xe.path),Ge.buildURLFromParts(rt)},parseURL:function(qe){var Ke=pe.exec(qe);return Ke?{scheme:Ke[1]||"",netLoc:Ke[2]||"",path:Ke[3]||"",params:Ke[4]||"",query:Ke[5]||"",fragment:Ke[6]||""}:null},normalizePath:function(qe){for(qe=qe.split("").reverse().join("").replace(Ne,"");qe.length!==(qe=qe.replace(Ue,"")).length;);return qe.split("").reverse().join("")},buildURLFromParts:function(qe){return qe.scheme+qe.netLoc+qe.path+qe.params+qe.query+qe.fragment}};fe.exports=Ge})()})(urlToolkit);var urlToolkitExports=urlToolkit.exports;function ownKeys(fe,ee){var ue=Object.keys(fe);if(Object.getOwnPropertySymbols){var pe=Object.getOwnPropertySymbols(fe);ee&&(pe=pe.filter(function(_e){return Object.getOwnPropertyDescriptor(fe,_e).enumerable})),ue.push.apply(ue,pe)}return ue}function _objectSpread2(fe){for(var ee=1;ee<arguments.length;ee++){var ue=arguments[ee]!=null?arguments[ee]:{};ee%2?ownKeys(Object(ue),!0).forEach(function(pe){_defineProperty(fe,pe,ue[pe])}):Object.getOwnPropertyDescriptors?Object.defineProperties(fe,Object.getOwnPropertyDescriptors(ue)):ownKeys(Object(ue)).forEach(function(pe){Object.defineProperty(fe,pe,Object.getOwnPropertyDescriptor(ue,pe))})}return fe}function _defineProperty(fe,ee,ue){return ee=_toPropertyKey(ee),ee in fe?Object.defineProperty(fe,ee,{value:ue,enumerable:!0,configurable:!0,writable:!0}):fe[ee]=ue,fe}function _extends(){return _extends=Object.assign?Object.assign.bind():function(fe){for(var ee=1;ee<arguments.length;ee++){var ue=arguments[ee];for(var pe in ue)Object.prototype.hasOwnProperty.call(ue,pe)&&(fe[pe]=ue[pe])}return fe},_extends.apply(this,arguments)}function _toPrimitive(fe,ee){if(typeof fe!="object"||fe===null)return fe;var ue=fe[Symbol.toPrimitive];if(ue!==void 0){var pe=ue.call(fe,ee||"default");if(typeof pe!="object")return pe;throw new TypeError("@@toPrimitive must return a primitive value.")}return(ee==="string"?String:Number)(fe)}function _toPropertyKey(fe){var ee=_toPrimitive(fe,"string");return typeof ee=="symbol"?ee:String(ee)}const isFiniteNumber=Number.isFinite||function(fe){return typeof fe=="number"&&isFinite(fe)};let Events=function(fe){return fe.MEDIA_ATTACHING="hlsMediaAttaching",fe.MEDIA_ATTACHED="hlsMediaAttached",fe.MEDIA_DETACHING="hlsMediaDetaching",fe.MEDIA_DETACHED="hlsMediaDetached",fe.BUFFER_RESET="hlsBufferReset",fe.BUFFER_CODECS="hlsBufferCodecs",fe.BUFFER_CREATED="hlsBufferCreated",fe.BUFFER_APPENDING="hlsBufferAppending",fe.BUFFER_APPENDED="hlsBufferAppended",fe.BUFFER_EOS="hlsBufferEos",fe.BUFFER_FLUSHING="hlsBufferFlushing",fe.BUFFER_FLUSHED="hlsBufferFlushed",fe.MANIFEST_LOADING="hlsManifestLoading",fe.MANIFEST_LOADED="hlsManifestLoaded",fe.MANIFEST_PARSED="hlsManifestParsed",fe.LEVEL_SWITCHING="hlsLevelSwitching",fe.LEVEL_SWITCHED="hlsLevelSwitched",fe.LEVEL_LOADING="hlsLevelLoading",fe.LEVEL_LOADED="hlsLevelLoaded",fe.LEVEL_UPDATED="hlsLevelUpdated",fe.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",fe.LEVELS_UPDATED="hlsLevelsUpdated",fe.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",fe.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",fe.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",fe.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",fe.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",fe.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",fe.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",fe.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",fe.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",fe.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",fe.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",fe.CUES_PARSED="hlsCuesParsed",fe.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",fe.INIT_PTS_FOUND="hlsInitPtsFound",fe.FRAG_LOADING="hlsFragLoading",fe.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",fe.FRAG_LOADED="hlsFragLoaded",fe.FRAG_DECRYPTED="hlsFragDecrypted",fe.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",fe.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",fe.FRAG_PARSING_METADATA="hlsFragParsingMetadata",fe.FRAG_PARSED="hlsFragParsed",fe.FRAG_BUFFERED="hlsFragBuffered",fe.FRAG_CHANGED="hlsFragChanged",fe.FPS_DROP="hlsFpsDrop",fe.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",fe.ERROR="hlsError",fe.DESTROYING="hlsDestroying",fe.KEY_LOADING="hlsKeyLoading",fe.KEY_LOADED="hlsKeyLoaded",fe.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",fe.BACK_BUFFER_REACHED="hlsBackBufferReached",fe}({}),ErrorTypes=function(fe){return fe.NETWORK_ERROR="networkError",fe.MEDIA_ERROR="mediaError",fe.KEY_SYSTEM_ERROR="keySystemError",fe.MUX_ERROR="muxError",fe.OTHER_ERROR="otherError",fe}({}),ErrorDetails=function(fe){return fe.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",fe.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",fe.KEY_SYSTEM_NO_SESSION="keySystemNoSession",fe.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",fe.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",fe.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",fe.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",fe.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",fe.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",fe.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",fe.MANIFEST_LOAD_ERROR="manifestLoadError",fe.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",fe.MANIFEST_PARSING_ERROR="manifestParsingError",fe.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",fe.LEVEL_EMPTY_ERROR="levelEmptyError",fe.LEVEL_LOAD_ERROR="levelLoadError",fe.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",fe.LEVEL_PARSING_ERROR="levelParsingError",fe.LEVEL_SWITCH_ERROR="levelSwitchError",fe.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",fe.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",fe.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",fe.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",fe.FRAG_LOAD_ERROR="fragLoadError",fe.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",fe.FRAG_DECRYPT_ERROR="fragDecryptError",fe.FRAG_PARSING_ERROR="fragParsingError",fe.FRAG_GAP="fragGap",fe.REMUX_ALLOC_ERROR="remuxAllocError",fe.KEY_LOAD_ERROR="keyLoadError",fe.KEY_LOAD_TIMEOUT="keyLoadTimeOut",fe.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",fe.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",fe.BUFFER_APPEND_ERROR="bufferAppendError",fe.BUFFER_APPENDING_ERROR="bufferAppendingError",fe.BUFFER_STALLED_ERROR="bufferStalledError",fe.BUFFER_FULL_ERROR="bufferFullError",fe.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",fe.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",fe.INTERNAL_EXCEPTION="internalException",fe.INTERNAL_ABORTED="aborted",fe.UNKNOWN="unknown",fe}({});const noop=function(){},fakeLogger={trace:noop,debug:noop,log:noop,warn:noop,info:noop,error:noop};let exportedLogger=fakeLogger;function consolePrintFn(fe){const ee=self.console[fe];return ee?ee.bind(self.console,`[${fe}] >`):noop}function exportLoggerFunctions(fe,...ee){ee.forEach(function(ue){exportedLogger[ue]=fe[ue]?fe[ue].bind(fe):consolePrintFn(ue)})}function enableLogs(fe,ee){if(self.console&&fe===!0||typeof fe=="object"){exportLoggerFunctions(fe,"debug","log","info","warn","error");try{exportedLogger.log(`Debug logs enabled for "${ee}" in hls.js version 1.4.12`)}catch{exportedLogger=fakeLogger}}else exportedLogger=fakeLogger}const logger=exportedLogger,DECIMAL_RESOLUTION_REGEX=/^(\d+)x(\d+)$/,ATTR_LIST_REGEX=/(.+?)=(".*?"|.*?)(?:,|$)/g;class AttrList{constructor(ee){typeof ee=="string"&&(ee=AttrList.parseAttrList(ee));for(const ue in ee)ee.hasOwnProperty(ue)&&(ue.substring(0,2)==="X-"&&(this.clientAttrs=this.clientAttrs||[],this.clientAttrs.push(ue)),this[ue]=ee[ue])}decimalInteger(ee){const ue=parseInt(this[ee],10);return ue>Number.MAX_SAFE_INTEGER?1/0:ue}hexadecimalInteger(ee){if(this[ee]){let ue=(this[ee]||"0x").slice(2);ue=(ue.length&1?"0":"")+ue;const pe=new Uint8Array(ue.length/2);for(let _e=0;_e<ue.length/2;_e++)pe[_e]=parseInt(ue.slice(_e*2,_e*2+2),16);return pe}else return null}hexadecimalIntegerAsNumber(ee){const ue=parseInt(this[ee],16);return ue>Number.MAX_SAFE_INTEGER?1/0:ue}decimalFloatingPoint(ee){return parseFloat(this[ee])}optionalFloat(ee,ue){const pe=this[ee];return pe?parseFloat(pe):ue}enumeratedString(ee){return this[ee]}bool(ee){return this[ee]==="YES"}decimalResolution(ee){const ue=DECIMAL_RESOLUTION_REGEX.exec(this[ee]);if(ue!==null)return{width:parseInt(ue[1],10),height:parseInt(ue[2],10)}}static parseAttrList(ee){let ue;const pe={},_e='"';for(ATTR_LIST_REGEX.lastIndex=0;(ue=ATTR_LIST_REGEX.exec(ee))!==null;){let Ne=ue[2];Ne.indexOf(_e)===0&&Ne.lastIndexOf(_e)===Ne.length-1&&(Ne=Ne.slice(1,-1));const Ue=ue[1].trim();pe[Ue]=Ne}return pe}}function isDateRangeCueAttribute(fe){return fe!=="ID"&&fe!=="CLASS"&&fe!=="START-DATE"&&fe!=="DURATION"&&fe!=="END-DATE"&&fe!=="END-ON-NEXT"}function isSCTE35Attribute(fe){return fe==="SCTE35-OUT"||fe==="SCTE35-IN"}class DateRange{constructor(ee,ue){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,ue){const pe=ue.attr;for(const _e in pe)if(Object.prototype.hasOwnProperty.call(ee,_e)&&ee[_e]!==pe[_e]){logger.warn(`DATERANGE tag attribute: "${_e}" does not match for tags with ID: "${ee.ID}"`),this._badValueForSameId=_e;break}ee=_extends(new AttrList({}),pe,ee)}if(this.attr=ee,this._startDate=new Date(ee["START-DATE"]),"END-DATE"in this.attr){const pe=new Date(this.attr["END-DATE"]);isFiniteNumber(pe.getTime())&&(this._endDate=pe)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get startDate(){return this._startDate}get endDate(){if(this._endDate)return this._endDate;const ee=this.duration;return ee!==null?new Date(this._startDate.getTime()+ee*1e3):null}get duration(){if("DURATION"in this.attr){const ee=this.attr.decimalFloatingPoint("DURATION");if(isFiniteNumber(ee))return ee}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isValid(){return!!this.id&&!this._badValueForSameId&&isFiniteNumber(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}class LoadStats{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var ElementaryStreamTypes={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class BaseSegment{constructor(ee){this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams={[ElementaryStreamTypes.AUDIO]:null,[ElementaryStreamTypes.VIDEO]:null,[ElementaryStreamTypes.AUDIOVIDEO]:null},this.baseurl=ee}setByteRange(ee,ue){const pe=ee.split("@",2),_e=[];pe.length===1?_e[0]=ue?ue.byteRangeEndOffset:0:_e[0]=parseInt(pe[1]),_e[1]=parseInt(pe[0])+_e[0],this._byteRange=_e}get byteRange(){return this._byteRange?this._byteRange:[]}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=urlToolkitExports.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(ee){this._url=ee}}class Fragment extends BaseSegment{constructor(ee,ue){super(ue),this._decryptdata=null,this.rawProgramDateTime=null,this.programDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.stats=new LoadStats,this.urlId=0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.type=ee}get decryptdata(){const{levelkeys:ee}=this;if(!ee&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const ue=this.levelkeys.identity;if(ue)this._decryptdata=ue.getDecryptData(this.sn);else{const pe=Object.keys(this.levelkeys);if(pe.length===1)return this._decryptdata=this.levelkeys[pe[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null||!isFiniteNumber(this.programDateTime))return null;const ee=isFiniteNumber(this.duration)?this.duration:0;return this.programDateTime+ee*1e3}get encrypted(){var ee;if((ee=this._decryptdata)!=null&&ee.encrypted)return!0;if(this.levelkeys){const ue=Object.keys(this.levelkeys),pe=ue.length;if(pe>1||pe===1&&this.levelkeys[ue[0]].encrypted)return!0}return!1}setKeyFormat(ee){if(this.levelkeys){const ue=this.levelkeys[ee];ue&&!this._decryptdata&&(this._decryptdata=ue.getDecryptData(this.sn))}}abortRequests(){var ee,ue;(ee=this.loader)==null||ee.abort(),(ue=this.keyLoader)==null||ue.abort()}setElementaryStreamInfo(ee,ue,pe,_e,Ne,Ue=!1){const{elementaryStreams:Ge}=this,qe=Ge[ee];if(!qe){Ge[ee]={startPTS:ue,endPTS:pe,startDTS:_e,endDTS:Ne,partial:Ue};return}qe.startPTS=Math.min(qe.startPTS,ue),qe.endPTS=Math.max(qe.endPTS,pe),qe.startDTS=Math.min(qe.startDTS,_e),qe.endDTS=Math.max(qe.endDTS,Ne)}clearElementaryStreamInfo(){const{elementaryStreams:ee}=this;ee[ElementaryStreamTypes.AUDIO]=null,ee[ElementaryStreamTypes.VIDEO]=null,ee[ElementaryStreamTypes.AUDIOVIDEO]=null}}class Part extends BaseSegment{constructor(ee,ue,pe,_e,Ne){super(pe),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.stats=new LoadStats,this.duration=ee.decimalFloatingPoint("DURATION"),this.gap=ee.bool("GAP"),this.independent=ee.bool("INDEPENDENT"),this.relurl=ee.enumeratedString("URI"),this.fragment=ue,this.index=_e;const Ue=ee.enumeratedString("BYTERANGE");Ue&&this.setByteRange(Ue,Ne),Ne&&(this.fragOffset=Ne.fragOffset+Ne.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:ee}=this;return!!(ee.audio||ee.video||ee.audiovideo)}}const DEFAULT_TARGET_DURATION=10;class LevelDetails{constructor(ee){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=ee}reloaded(ee){if(!ee){this.advanced=!0,this.updated=!0;return}const ue=this.lastPartSn-ee.lastPartSn,pe=this.lastPartIndex-ee.lastPartIndex;this.updated=this.endSN!==ee.endSN||!!pe||!!ue||!this.live,this.advanced=this.endSN>ee.endSN||ue>0||ue===0&&pe>0,this.updated||this.advanced?this.misses=Math.floor(ee.misses*.6):this.misses=ee.misses+1,this.availabilityDelay=ee.availabilityDelay}get hasProgramDateTime(){return this.fragments.length?isFiniteNumber(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||DEFAULT_TARGET_DURATION}get drift(){const ee=this.driftEndTime-this.driftStartTime;return ee>0?(this.driftEnd-this.driftStart)*1e3/ee:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var ee;return(ee=this.partList)!=null&&ee.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var ee;return(ee=this.fragments)!=null&&ee.length?this.fragments[this.fragments.length-1].end:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var ee;return(ee=this.partList)!=null&&ee.length?this.partList[this.partList.length-1].index:-1}get lastPartSn(){var ee;return(ee=this.partList)!=null&&ee.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}function base64Decode(fe){return Uint8Array.from(atob(fe),ee=>ee.charCodeAt(0))}function getKeyIdBytes(fe){const ee=strToUtf8array(fe).subarray(0,16),ue=new Uint8Array(16);return ue.set(ee,16-ee.length),ue}function changeEndianness(fe){const ee=function(pe,_e,Ne){const Ue=pe[_e];pe[_e]=pe[Ne],pe[Ne]=Ue};ee(fe,0,3),ee(fe,1,2),ee(fe,4,5),ee(fe,6,7)}function convertDataUriToArrayBytes(fe){const ee=fe.split(":");let ue=null;if(ee[0]==="data"&&ee.length===2){const pe=ee[1].split(";"),_e=pe[pe.length-1].split(",");if(_e.length===2){const Ne=_e[0]==="base64",Ue=_e[1];Ne?(pe.splice(-1,1),ue=base64Decode(Ue)):ue=getKeyIdBytes(Ue)}}return ue}function strToUtf8array(fe){return Uint8Array.from(unescape(encodeURIComponent(fe)),ee=>ee.charCodeAt(0))}var KeySystems={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},KeySystemFormats={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function keySystemFormatToKeySystemDomain(fe){switch(fe){case KeySystemFormats.FAIRPLAY:return KeySystems.FAIRPLAY;case KeySystemFormats.PLAYREADY:return KeySystems.PLAYREADY;case KeySystemFormats.WIDEVINE:return KeySystems.WIDEVINE;case KeySystemFormats.CLEARKEY:return KeySystems.CLEARKEY}}var KeySystemIds={WIDEVINE:"edef8ba979d64acea3c827dcd51d21ed"};function keySystemIdToKeySystemDomain(fe){if(fe===KeySystemIds.WIDEVINE)return KeySystems.WIDEVINE}function keySystemDomainToKeySystemFormat(fe){switch(fe){case KeySystems.FAIRPLAY:return KeySystemFormats.FAIRPLAY;case KeySystems.PLAYREADY:return KeySystemFormats.PLAYREADY;case KeySystems.WIDEVINE:return KeySystemFormats.WIDEVINE;case KeySystems.CLEARKEY:return KeySystemFormats.CLEARKEY}}function getKeySystemsForConfig(fe){const{drmSystems:ee,widevineLicenseUrl:ue}=fe,pe=ee?[KeySystems.FAIRPLAY,KeySystems.WIDEVINE,KeySystems.PLAYREADY,KeySystems.CLEARKEY].filter(_e=>!!ee[_e]):[];return!pe[KeySystems.WIDEVINE]&&ue&&pe.push(KeySystems.WIDEVINE),pe}const requestMediaKeySystemAccess=function(){return typeof self<"u"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function getSupportedMediaKeySystemConfigurations(fe,ee,ue,pe){let _e;switch(fe){case KeySystems.FAIRPLAY:_e=["cenc","sinf"];break;case KeySystems.WIDEVINE:case KeySystems.PLAYREADY:_e=["cenc"];break;case KeySystems.CLEARKEY:_e=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${fe}`)}return createMediaKeySystemConfigurations(_e,ee,ue,pe)}function createMediaKeySystemConfigurations(fe,ee,ue,pe){return[{initDataTypes:fe,persistentState:pe.persistentState||"not-allowed",distinctiveIdentifier:pe.distinctiveIdentifier||"not-allowed",sessionTypes:pe.sessionTypes||[pe.sessionType||"temporary"],audioCapabilities:ee.map(Ne=>({contentType:`audio/mp4; codecs="${Ne}"`,robustness:pe.audioRobustness||"",encryptionScheme:pe.audioEncryptionScheme||null})),videoCapabilities:ue.map(Ne=>({contentType:`video/mp4; codecs="${Ne}"`,robustness:pe.videoRobustness||"",encryptionScheme:pe.videoEncryptionScheme||null}))}]}function sliceUint8(fe,ee,ue){return Uint8Array.prototype.slice?fe.slice(ee,ue):new Uint8Array(Array.prototype.slice.call(fe,ee,ue))}const isHeader$2=(fe,ee)=>ee+10<=fe.length&&fe[ee]===73&&fe[ee+1]===68&&fe[ee+2]===51&&fe[ee+3]<255&&fe[ee+4]<255&&fe[ee+6]<128&&fe[ee+7]<128&&fe[ee+8]<128&&fe[ee+9]<128,isFooter=(fe,ee)=>ee+10<=fe.length&&fe[ee]===51&&fe[ee+1]===68&&fe[ee+2]===73&&fe[ee+3]<255&&fe[ee+4]<255&&fe[ee+6]<128&&fe[ee+7]<128&&fe[ee+8]<128&&fe[ee+9]<128,getID3Data=(fe,ee)=>{const ue=ee;let pe=0;for(;isHeader$2(fe,ee);){pe+=10;const _e=readSize(fe,ee+6);pe+=_e,isFooter(fe,ee+10)&&(pe+=10),ee+=pe}if(pe>0)return fe.subarray(ue,ue+pe)},readSize=(fe,ee)=>{let ue=0;return ue=(fe[ee]&127)<<21,ue|=(fe[ee+1]&127)<<14,ue|=(fe[ee+2]&127)<<7,ue|=fe[ee+3]&127,ue},canParse$2=(fe,ee)=>isHeader$2(fe,ee)&&readSize(fe,ee+6)+10<=fe.length-ee,getTimeStamp=fe=>{const ee=getID3Frames(fe);for(let ue=0;ue<ee.length;ue++){const pe=ee[ue];if(isTimeStampFrame(pe))return readTimeStamp(pe)}},isTimeStampFrame=fe=>fe&&fe.key==="PRIV"&&fe.info==="com.apple.streaming.transportStreamTimestamp",getFrameData=fe=>{const ee=String.fromCharCode(fe[0],fe[1],fe[2],fe[3]),ue=readSize(fe,4),pe=10;return{type:ee,size:ue,data:fe.subarray(pe,pe+ue)}},getID3Frames=fe=>{let ee=0;const ue=[];for(;isHeader$2(fe,ee);){const pe=readSize(fe,ee+6);ee+=10;const _e=ee+pe;for(;ee+8<_e;){const Ne=getFrameData(fe.subarray(ee)),Ue=decodeFrame(Ne);Ue&&ue.push(Ue),ee+=Ne.size+10}isFooter(fe,ee)&&(ee+=10)}return ue},decodeFrame=fe=>fe.type==="PRIV"?decodePrivFrame(fe):fe.type[0]==="W"?decodeURLFrame(fe):decodeTextFrame(fe),decodePrivFrame=fe=>{if(fe.size<2)return;const ee=utf8ArrayToStr(fe.data,!0),ue=new Uint8Array(fe.data.subarray(ee.length+1));return{key:fe.type,info:ee,data:ue.buffer}},decodeTextFrame=fe=>{if(fe.size<2)return;if(fe.type==="TXXX"){let ue=1;const pe=utf8ArrayToStr(fe.data.subarray(ue),!0);ue+=pe.length+1;const _e=utf8ArrayToStr(fe.data.subarray(ue));return{key:fe.type,info:pe,data:_e}}const ee=utf8ArrayToStr(fe.data.subarray(1));return{key:fe.type,data:ee}},decodeURLFrame=fe=>{if(fe.type==="WXXX"){if(fe.size<2)return;let ue=1;const pe=utf8ArrayToStr(fe.data.subarray(ue),!0);ue+=pe.length+1;const _e=utf8ArrayToStr(fe.data.subarray(ue));return{key:fe.type,info:pe,data:_e}}const ee=utf8ArrayToStr(fe.data);return{key:fe.type,data:ee}},readTimeStamp=fe=>{if(fe.data.byteLength===8){const ee=new Uint8Array(fe.data),ue=ee[3]&1;let pe=(ee[4]<<23)+(ee[5]<<15)+(ee[6]<<7)+ee[7];return pe/=45,ue&&(pe+=4772185884e-2),Math.round(pe)}},utf8ArrayToStr=(fe,ee=!1)=>{const ue=getTextDecoder();if(ue){const Ke=ue.decode(fe);if(ee){const Ye=Ke.indexOf("\0");return Ye!==-1?Ke.substring(0,Ye):Ke}return Ke.replace(/\0/g,"")}const pe=fe.length;let _e,Ne,Ue,Ge="",qe=0;for(;qe<pe;){if(_e=fe[qe++],_e===0&&ee)return Ge;if(_e===0||_e===3)continue;switch(_e>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:Ge+=String.fromCharCode(_e);break;case 12:case 13:Ne=fe[qe++],Ge+=String.fromCharCode((_e&31)<<6|Ne&63);break;case 14:Ne=fe[qe++],Ue=fe[qe++],Ge+=String.fromCharCode((_e&15)<<12|(Ne&63)<<6|(Ue&63)<<0);break}}return Ge};let decoder;function getTextDecoder(){return!decoder&&typeof self.TextDecoder<"u"&&(decoder=new self.TextDecoder("utf-8")),decoder}const Hex={hexDump:function(fe){let ee="";for(let ue=0;ue<fe.length;ue++){let pe=fe[ue].toString(16);pe.length<2&&(pe="0"+pe),ee+=pe}return ee}},UINT32_MAX$1=Math.pow(2,32)-1,push=[].push,RemuxerTrackIdConfig={video:1,audio:2,id3:3,text:4};function bin2str(fe){return String.fromCharCode.apply(null,fe)}function readUint16(fe,ee){const ue=fe[ee]<<8|fe[ee+1];return ue<0?65536+ue:ue}function readUint32(fe,ee){const ue=readSint32(fe,ee);return ue<0?4294967296+ue:ue}function readSint32(fe,ee){return fe[ee]<<24|fe[ee+1]<<16|fe[ee+2]<<8|fe[ee+3]}function writeUint32(fe,ee,ue){fe[ee]=ue>>24,fe[ee+1]=ue>>16&255,fe[ee+2]=ue>>8&255,fe[ee+3]=ue&255}function findBox(fe,ee){const ue=[];if(!ee.length)return ue;const pe=fe.byteLength;for(let _e=0;_e<pe;){const Ne=readUint32(fe,_e),Ue=bin2str(fe.subarray(_e+4,_e+8)),Ge=Ne>1?_e+Ne:pe;if(Ue===ee[0])if(ee.length===1)ue.push(fe.subarray(_e+8,Ge));else{const qe=findBox(fe.subarray(_e+8,Ge),ee.slice(1));qe.length&&push.apply(ue,qe)}_e=Ge}return ue}function parseSegmentIndex(fe){const ee=[],ue=fe[0];let pe=8;const _e=readUint32(fe,pe);pe+=4;const Ne=0,Ue=0;ue===0?pe+=8:pe+=16,pe+=2;let Ge=fe.length+Ue;const qe=readUint16(fe,pe);pe+=2;for(let Ke=0;Ke<qe;Ke++){let Ye=pe;const Ze=readUint32(fe,Ye);Ye+=4;const Xe=Ze&2147483647;if((Ze&2147483648)>>>31===1)return logger.warn("SIDX has hierarchical references (not supported)"),null;const tt=readUint32(fe,Ye);Ye+=4,ee.push({referenceSize:Xe,subsegmentDuration:tt,info:{duration:tt/_e,start:Ge,end:Ge+Xe-1}}),Ge+=Xe,Ye+=4,pe=Ye}return{earliestPresentationTime:Ne,timescale:_e,version:ue,referencesCount:qe,references:ee}}function parseInitSegment(fe){const ee=[],ue=findBox(fe,["moov","trak"]);for(let _e=0;_e<ue.length;_e++){const Ne=ue[_e],Ue=findBox(Ne,["tkhd"])[0];if(Ue){let Ge=Ue[0],qe=Ge===0?12:20;const Ke=readUint32(Ue,qe),Ye=findBox(Ne,["mdia","mdhd"])[0];if(Ye){Ge=Ye[0],qe=Ge===0?12:20;const Ze=readUint32(Ye,qe),Xe=findBox(Ne,["mdia","hdlr"])[0];if(Xe){const Je=bin2str(Xe.subarray(8,12)),tt={soun:ElementaryStreamTypes.AUDIO,vide:ElementaryStreamTypes.VIDEO}[Je];if(tt){const rt=findBox(Ne,["mdia","minf","stbl","stsd"])[0];let et;rt&&(et=bin2str(rt.subarray(12,16))),ee[Ke]={timescale:Ze,type:tt},ee[tt]={timescale:Ze,id:Ke,codec:et}}}}}}return findBox(fe,["moov","mvex","trex"]).forEach(_e=>{const Ne=readUint32(_e,4),Ue=ee[Ne];Ue&&(Ue.default={duration:readUint32(_e,12),flags:readUint32(_e,20)})}),ee}function patchEncyptionData(fe,ee){if(!fe||!ee)return fe;const ue=ee.keyId;return ue&&ee.isCommonEncryption&&findBox(fe,["moov","trak"]).forEach(_e=>{const Ue=findBox(_e,["mdia","minf","stbl","stsd"])[0].subarray(8);let Ge=findBox(Ue,["enca"]);const qe=Ge.length>0;qe||(Ge=findBox(Ue,["encv"])),Ge.forEach(Ke=>{const Ye=qe?Ke.subarray(28):Ke.subarray(78);findBox(Ye,["sinf"]).forEach(Xe=>{const Je=parseSinf(Xe);if(Je){const tt=Je.subarray(8,24);tt.some(rt=>rt!==0)||(logger.log(`[eme] Patching keyId in 'enc${qe?"a":"v"}>sinf>>tenc' box: ${Hex.hexDump(tt)} -> ${Hex.hexDump(ue)}`),Je.set(ue,8))}})})}),fe}function parseSinf(fe){const ee=findBox(fe,["schm"])[0];if(ee){const ue=bin2str(ee.subarray(4,8));if(ue==="cbcs"||ue==="cenc")return findBox(fe,["schi","tenc"])[0]}return logger.error("[eme] missing 'schm' box"),null}function getStartDTS(fe,ee){return findBox(ee,["moof","traf"]).reduce((ue,pe)=>{const _e=findBox(pe,["tfdt"])[0],Ne=_e[0],Ue=findBox(pe,["tfhd"]).reduce((Ge,qe)=>{const Ke=readUint32(qe,4),Ye=fe[Ke];if(Ye){let Ze=readUint32(_e,4);if(Ne===1){if(Ze===UINT32_MAX$1)return logger.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),Ge;Ze*=UINT32_MAX$1+1,Ze+=readUint32(_e,8)}const Xe=Ye.timescale||9e4,Je=Ze/Xe;if(isFinite(Je)&&(Ge===null||Je<Ge))return Je}return Ge},null);return Ue!==null&&isFinite(Ue)&&(ue===null||Ue<ue)?Ue:ue},null)}function getDuration(fe,ee){let ue=0,pe=0,_e=0;const Ne=findBox(fe,["moof","traf"]);for(let Ue=0;Ue<Ne.length;Ue++){const Ge=Ne[Ue],qe=findBox(Ge,["tfhd"])[0],Ke=readUint32(qe,4),Ye=ee[Ke];if(!Ye)continue;const Ze=Ye.default,Xe=readUint32(qe,0)|(Ze==null?void 0:Ze.flags);let Je=Ze==null?void 0:Ze.duration;Xe&8&&(Xe&2?Je=readUint32(qe,12):Je=readUint32(qe,8));const tt=Ye.timescale||9e4,rt=findBox(Ge,["trun"]);for(let et=0;et<rt.length;et++){if(ue=computeRawDurationFromSamples(rt[et]),!ue&&Je){const it=readUint32(rt[et],4);ue=Je*it}Ye.type===ElementaryStreamTypes.VIDEO?pe+=ue/tt:Ye.type===ElementaryStreamTypes.AUDIO&&(_e+=ue/tt)}}if(pe===0&&_e===0){let Ue=0;const Ge=findBox(fe,["sidx"]);for(let qe=0;qe<Ge.length;qe++){const Ke=parseSegmentIndex(Ge[qe]);Ke!=null&&Ke.references&&(Ue+=Ke.references.reduce((Ye,Ze)=>Ye+Ze.info.duration||0,0))}return Ue}return pe||_e}function computeRawDurationFromSamples(fe){const ee=readUint32(fe,0);let ue=8;ee&1&&(ue+=4),ee&4&&(ue+=4);let pe=0;const _e=readUint32(fe,4);for(let Ne=0;Ne<_e;Ne++){if(ee&256){const Ue=readUint32(fe,ue);pe+=Ue,ue+=4}ee&512&&(ue+=4),ee&1024&&(ue+=4),ee&2048&&(ue+=4)}return pe}function offsetStartDTS(fe,ee,ue){findBox(ee,["moof","traf"]).forEach(pe=>{findBox(pe,["tfhd"]).forEach(_e=>{const Ne=readUint32(_e,4),Ue=fe[Ne];if(!Ue)return;const Ge=Ue.timescale||9e4;findBox(pe,["tfdt"]).forEach(qe=>{const Ke=qe[0];let Ye=readUint32(qe,4);if(Ke===0)Ye-=ue*Ge,Ye=Math.max(Ye,0),writeUint32(qe,4,Ye);else{Ye*=Math.pow(2,32),Ye+=readUint32(qe,8),Ye-=ue*Ge,Ye=Math.max(Ye,0);const Ze=Math.floor(Ye/(UINT32_MAX$1+1)),Xe=Math.floor(Ye%(UINT32_MAX$1+1));writeUint32(qe,4,Ze),writeUint32(qe,8,Xe)}})})})}function segmentValidRange(fe){const ee={valid:null,remainder:null},ue=findBox(fe,["moof"]);if(ue){if(ue.length<2)return ee.remainder=fe,ee}else return ee;const pe=ue[ue.length-1];return ee.valid=sliceUint8(fe,0,pe.byteOffset-8),ee.remainder=sliceUint8(fe,pe.byteOffset-8),ee}function appendUint8Array(fe,ee){const ue=new Uint8Array(fe.length+ee.length);return ue.set(fe),ue.set(ee,fe.length),ue}function parseSamples(fe,ee){const ue=[],pe=ee.samples,_e=ee.timescale,Ne=ee.id;let Ue=!1;return findBox(pe,["moof"]).map(qe=>{const Ke=qe.byteOffset-8;findBox(qe,["traf"]).map(Ze=>{const Xe=findBox(Ze,["tfdt"]).map(Je=>{const tt=Je[0];let rt=readUint32(Je,4);return tt===1&&(rt*=Math.pow(2,32),rt+=readUint32(Je,8)),rt/_e})[0];return Xe!==void 0&&(fe=Xe),findBox(Ze,["tfhd"]).map(Je=>{const tt=readUint32(Je,4),rt=readUint32(Je,0)&16777215,et=(rt&1)!==0,it=(rt&2)!==0,nt=(rt&8)!==0;let st=0;const lt=(rt&16)!==0;let _r=0;const jr=(rt&32)!==0;let Nr=8;tt===Ne&&(et&&(Nr+=8),it&&(Nr+=4),nt&&(st=readUint32(Je,Nr),Nr+=4),lt&&(_r=readUint32(Je,Nr),Nr+=4),jr&&(Nr+=4),ee.type==="video"&&(Ue=isHEVC(ee.codec)),findBox(Ze,["trun"]).map(Wr=>{const ri=Wr[0],Xr=readUint32(Wr,0)&16777215,Gr=(Xr&1)!==0;let qr=0;const si=(Xr&4)!==0,oi=(Xr&256)!==0;let Yr=0;const ii=(Xr&512)!==0;let ti=0;const ni=(Xr&1024)!==0,ui=(Xr&2048)!==0;let yi=0;const hi=readUint32(Wr,4);let pi=8;Gr&&(qr=readUint32(Wr,pi),pi+=4),si&&(pi+=4);let Ri=qr+Ke;for(let Ei=0;Ei<hi;Ei++){if(oi?(Yr=readUint32(Wr,pi),pi+=4):Yr=st,ii?(ti=readUint32(Wr,pi),pi+=4):ti=_r,ni&&(pi+=4),ui&&(ri===0?yi=readUint32(Wr,pi):yi=readSint32(Wr,pi),pi+=4),ee.type===ElementaryStreamTypes.VIDEO){let bi=0;for(;bi<ti;){const _i=readUint32(pe,Ri);if(Ri+=4,isSEIMessage(Ue,pe[Ri])){const vi=pe.subarray(Ri,Ri+_i);parseSEIMessageFromNALu(vi,Ue?2:1,fe+yi/_e,ue)}Ri+=_i,bi+=_i+4}}fe+=Yr/_e}}))})})}),ue}function isHEVC(fe){if(!fe)return!1;const ee=fe.indexOf("."),ue=ee<0?fe:fe.substring(0,ee);return ue==="hvc1"||ue==="hev1"||ue==="dvh1"||ue==="dvhe"}function isSEIMessage(fe,ee){if(fe){const ue=ee>>1&63;return ue===39||ue===40}else return(ee&31)===6}function parseSEIMessageFromNALu(fe,ee,ue,pe){const _e=discardEPB(fe);let Ne=0;Ne+=ee;let Ue=0,Ge=0,qe=!1,Ke=0;for(;Ne<_e.length;){Ue=0;do{if(Ne>=_e.length)break;Ke=_e[Ne++],Ue+=Ke}while(Ke===255);Ge=0;do{if(Ne>=_e.length)break;Ke=_e[Ne++],Ge+=Ke}while(Ke===255);const Ye=_e.length-Ne;if(!qe&&Ue===4&&Ne<_e.length){if(qe=!0,_e[Ne++]===181){const Xe=readUint16(_e,Ne);if(Ne+=2,Xe===49){const Je=readUint32(_e,Ne);if(Ne+=4,Je===1195456820){const tt=_e[Ne++];if(tt===3){const rt=_e[Ne++],et=31&rt,it=64&rt,nt=it?2+et*3:0,st=new Uint8Array(nt);if(it){st[0]=rt;for(let lt=1;lt<nt;lt++)st[lt]=_e[Ne++]}pe.push({type:tt,payloadType:Ue,pts:ue,bytes:st})}}}}}else if(Ue===5&&Ge<Ye){if(qe=!0,Ge>16){const Ze=[];for(let tt=0;tt<16;tt++){const rt=_e[Ne++].toString(16);Ze.push(rt.length==1?"0"+rt:rt),(tt===3||tt===5||tt===7||tt===9)&&Ze.push("-")}const Xe=Ge-16,Je=new Uint8Array(Xe);for(let tt=0;tt<Xe;tt++)Je[tt]=_e[Ne++];pe.push({payloadType:Ue,pts:ue,uuid:Ze.join(""),userData:utf8ArrayToStr(Je),userDataBytes:Je})}}else if(Ge<Ye)Ne+=Ge;else if(Ge>Ye)break}}function discardEPB(fe){const ee=fe.byteLength,ue=[];let pe=1;for(;pe<ee-2;)fe[pe]===0&&fe[pe+1]===0&&fe[pe+2]===3?(ue.push(pe+2),pe+=2):pe++;if(ue.length===0)return fe;const _e=ee-ue.length,Ne=new Uint8Array(_e);let Ue=0;for(pe=0;pe<_e;Ue++,pe++)Ue===ue[0]&&(Ue++,ue.shift()),Ne[pe]=fe[Ue];return Ne}function parseEmsg(fe){const ee=fe[0];let ue="",pe="",_e=0,Ne=0,Ue=0,Ge=0,qe=0,Ke=0;if(ee===0){for(;bin2str(fe.subarray(Ke,Ke+1))!=="\0";)ue+=bin2str(fe.subarray(Ke,Ke+1)),Ke+=1;for(ue+=bin2str(fe.subarray(Ke,Ke+1)),Ke+=1;bin2str(fe.subarray(Ke,Ke+1))!=="\0";)pe+=bin2str(fe.subarray(Ke,Ke+1)),Ke+=1;pe+=bin2str(fe.subarray(Ke,Ke+1)),Ke+=1,_e=readUint32(fe,12),Ne=readUint32(fe,16),Ge=readUint32(fe,20),qe=readUint32(fe,24),Ke=28}else if(ee===1){Ke+=4,_e=readUint32(fe,Ke),Ke+=4;const Ze=readUint32(fe,Ke);Ke+=4;const Xe=readUint32(fe,Ke);for(Ke+=4,Ue=2**32*Ze+Xe,Number.isSafeInteger(Ue)||(Ue=Number.MAX_SAFE_INTEGER,logger.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),Ge=readUint32(fe,Ke),Ke+=4,qe=readUint32(fe,Ke),Ke+=4;bin2str(fe.subarray(Ke,Ke+1))!=="\0";)ue+=bin2str(fe.subarray(Ke,Ke+1)),Ke+=1;for(ue+=bin2str(fe.subarray(Ke,Ke+1)),Ke+=1;bin2str(fe.subarray(Ke,Ke+1))!=="\0";)pe+=bin2str(fe.subarray(Ke,Ke+1)),Ke+=1;pe+=bin2str(fe.subarray(Ke,Ke+1)),Ke+=1}const Ye=fe.subarray(Ke,fe.byteLength);return{schemeIdUri:ue,value:pe,timeScale:_e,presentationTime:Ue,presentationTimeDelta:Ne,eventDuration:Ge,id:qe,payload:Ye}}function mp4Box(fe,...ee){const ue=ee.length;let pe=8,_e=ue;for(;_e--;)pe+=ee[_e].byteLength;const Ne=new Uint8Array(pe);for(Ne[0]=pe>>24&255,Ne[1]=pe>>16&255,Ne[2]=pe>>8&255,Ne[3]=pe&255,Ne.set(fe,4),_e=0,pe=8;_e<ue;_e++)Ne.set(ee[_e],pe),pe+=ee[_e].byteLength;return Ne}function mp4pssh(fe,ee,ue){if(fe.byteLength!==16)throw new RangeError("Invalid system id");let pe,_e;if(ee){pe=1,_e=new Uint8Array(ee.length*16);for(let Ge=0;Ge<ee.length;Ge++){const qe=ee[Ge];if(qe.byteLength!==16)throw new RangeError("Invalid key");_e.set(qe,Ge*16)}}else pe=0,_e=new Uint8Array;let Ne;pe>0?(Ne=new Uint8Array(4),ee.length>0&&new DataView(Ne.buffer).setUint32(0,ee.length,!1)):Ne=new Uint8Array;const Ue=new Uint8Array(4);return ue&&ue.byteLength>0&&new DataView(Ue.buffer).setUint32(0,ue.byteLength,!1),mp4Box([112,115,115,104],new Uint8Array([pe,0,0,0]),fe,Ne,_e,Ue,ue||new Uint8Array)}function parsePssh(fe){if(!(fe instanceof ArrayBuffer)||fe.byteLength<32)return null;const ee={version:0,systemId:"",kids:null,data:null},ue=new DataView(fe),pe=ue.getUint32(0);if(fe.byteLength!==pe&&pe>44||ue.getUint32(4)!==1886614376||(ee.version=ue.getUint32(8)>>>24,ee.version>1))return null;ee.systemId=Hex.hexDump(new Uint8Array(fe,12,16));const Ne=ue.getUint32(28);if(ee.version===0){if(pe-32<Ne)return null;ee.data=new Uint8Array(fe,32,Ne)}else if(ee.version===1){ee.kids=[];for(let Ue=0;Ue<Ne;Ue++)ee.kids.push(new Uint8Array(fe,32+Ue*16,16))}return ee}let keyUriToKeyIdMap={};class LevelKey{static clearKeyUriToKeyIdMap(){keyUriToKeyIdMap={}}constructor(ee,ue,pe,_e=[1],Ne=null){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=ee,this.uri=ue,this.keyFormat=pe,this.keyFormatVersions=_e,this.iv=Ne,this.encrypted=ee?ee!=="NONE":!1,this.isCommonEncryption=this.encrypted&&ee!=="AES-128"}isSupported(){if(this.method){if(this.method==="AES-128"||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case KeySystemFormats.FAIRPLAY:case KeySystemFormats.WIDEVINE:case KeySystemFormats.PLAYREADY:case KeySystemFormats.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(ee){if(!this.encrypted||!this.uri)return null;if(this.method==="AES-128"&&this.uri&&!this.iv){typeof ee!="number"&&(this.method==="AES-128"&&!this.iv&&logger.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),ee=0);const pe=createInitializationVector(ee);return new LevelKey(this.method,this.uri,"identity",this.keyFormatVersions,pe)}const ue=convertDataUriToArrayBytes(this.uri);if(ue)switch(this.keyFormat){case KeySystemFormats.WIDEVINE:this.pssh=ue,ue.length>=22&&(this.keyId=ue.subarray(ue.length-22,ue.length-6));break;case KeySystemFormats.PLAYREADY:{const pe=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=mp4pssh(pe,null,ue);const _e=new Uint16Array(ue.buffer,ue.byteOffset,ue.byteLength/2),Ne=String.fromCharCode.apply(null,Array.from(_e)),Ue=Ne.substring(Ne.indexOf("<"),Ne.length),Ke=new DOMParser().parseFromString(Ue,"text/xml").getElementsByTagName("KID")[0];if(Ke){const Ye=Ke.childNodes[0]?Ke.childNodes[0].nodeValue:Ke.getAttribute("VALUE");if(Ye){const Ze=base64Decode(Ye).subarray(0,16);changeEndianness(Ze),this.keyId=Ze}}break}default:{let pe=ue.subarray(0,16);if(pe.length!==16){const _e=new Uint8Array(16);_e.set(pe,16-pe.length),pe=_e}this.keyId=pe;break}}if(!this.keyId||this.keyId.byteLength!==16){let pe=keyUriToKeyIdMap[this.uri];if(!pe){const _e=Object.keys(keyUriToKeyIdMap).length%Number.MAX_SAFE_INTEGER;pe=new Uint8Array(16),new DataView(pe.buffer,12,4).setUint32(0,_e),keyUriToKeyIdMap[this.uri]=pe}this.keyId=pe}return this}}function createInitializationVector(fe){const ee=new Uint8Array(16);for(let ue=12;ue<16;ue++)ee[ue]=fe>>8*(15-ue)&255;return ee}const VARIABLE_REPLACEMENT_REGEX=/\{\$([a-zA-Z0-9-_]+)\}/g;function hasVariableReferences(fe){return VARIABLE_REPLACEMENT_REGEX.test(fe)}function substituteVariablesInAttributes(fe,ee,ue){if(fe.variableList!==null||fe.hasVariableRefs)for(let pe=ue.length;pe--;){const _e=ue[pe],Ne=ee[_e];Ne&&(ee[_e]=substituteVariables(fe,Ne))}}function substituteVariables(fe,ee){if(fe.variableList!==null||fe.hasVariableRefs){const ue=fe.variableList;return ee.replace(VARIABLE_REPLACEMENT_REGEX,pe=>{const _e=pe.substring(2,pe.length-1),Ne=ue==null?void 0:ue[_e];return Ne===void 0?(fe.playlistParsingError||(fe.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${_e}"`)),pe):Ne})}return ee}function addVariableDefinition(fe,ee,ue){let pe=fe.variableList;pe||(fe.variableList=pe={});let _e,Ne;if("QUERYPARAM"in ee){_e=ee.QUERYPARAM;try{const Ue=new self.URL(ue).searchParams;if(Ue.has(_e))Ne=Ue.get(_e);else throw new Error(`"${_e}" does not match any query parameter in URI: "${ue}"`)}catch(Ue){fe.playlistParsingError||(fe.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${Ue.message}`))}}else _e=ee.NAME,Ne=ee.VALUE;_e in pe?fe.playlistParsingError||(fe.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${_e}"`)):pe[_e]=Ne||""}function importVariableDefinition(fe,ee,ue){const pe=ee.IMPORT;if(ue&&pe in ue){let _e=fe.variableList;_e||(fe.variableList=_e={}),_e[pe]=ue[pe]}else fe.playlistParsingError||(fe.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${pe}"`))}function getMediaSource(){if(!(typeof self>"u"))return self.MediaSource||self.WebKitMediaSource}const sampleEntryCodesISO={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}},MediaSource$2=getMediaSource();function isCodecType(fe,ee){const ue=sampleEntryCodesISO[ee];return!!ue&&ue[fe.slice(0,4)]===!0}function isCodecSupportedInMp4(fe,ee){var ue;return(ue=MediaSource$2==null?void 0:MediaSource$2.isTypeSupported(`${ee||"video"}/mp4;codecs="${fe}"`))!=null?ue:!1}const MASTER_PLAYLIST_REGEX=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,MASTER_PLAYLIST_MEDIA_REGEX=/#EXT-X-MEDIA:(.*)/g,IS_MEDIA_PLAYLIST=/^#EXT(?:INF|-X-TARGETDURATION):/m,LEVEL_PLAYLIST_REGEX_FAST=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),LEVEL_PLAYLIST_REGEX_SLOW=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class M3U8Parser{static findGroup(ee,ue){for(let pe=0;pe<ee.length;pe++){const _e=ee[pe];if(_e.id===ue)return _e}}static convertAVC1ToAVCOTI(ee){const ue=ee.split(".");if(ue.length>2){let pe=ue.shift()+".";return pe+=parseInt(ue.shift()).toString(16),pe+=("000"+parseInt(ue.shift()).toString(16)).slice(-4),pe}return ee}static resolve(ee,ue){return urlToolkitExports.buildAbsoluteURL(ue,ee,{alwaysNormalize:!0})}static isMediaPlaylist(ee){return IS_MEDIA_PLAYLIST.test(ee)}static parseMasterPlaylist(ee,ue){const pe=hasVariableReferences(ee),_e={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:pe},Ne=[];MASTER_PLAYLIST_REGEX.lastIndex=0;let Ue;for(;(Ue=MASTER_PLAYLIST_REGEX.exec(ee))!=null;)if(Ue[1]){var Ge;const Ke=new AttrList(Ue[1]);substituteVariablesInAttributes(_e,Ke,["CODECS","SUPPLEMENTAL-CODECS","ALLOWED-CPC","PATHWAY-ID","STABLE-VARIANT-ID","AUDIO","VIDEO","SUBTITLES","CLOSED-CAPTIONS","NAME"]);const Ye=substituteVariables(_e,Ue[2]),Ze={attrs:Ke,bitrate:Ke.decimalInteger("AVERAGE-BANDWIDTH")||Ke.decimalInteger("BANDWIDTH"),name:Ke.NAME,url:M3U8Parser.resolve(Ye,ue)},Xe=Ke.decimalResolution("RESOLUTION");Xe&&(Ze.width=Xe.width,Ze.height=Xe.height),setCodecs((Ke.CODECS||"").split(/[ ,]+/).filter(Je=>Je),Ze),Ze.videoCodec&&Ze.videoCodec.indexOf("avc1")!==-1&&(Ze.videoCodec=M3U8Parser.convertAVC1ToAVCOTI(Ze.videoCodec)),(Ge=Ze.unknownCodecs)!=null&&Ge.length||Ne.push(Ze),_e.levels.push(Ze)}else if(Ue[3]){const Ke=Ue[3],Ye=Ue[4];switch(Ke){case"SESSION-DATA":{const Ze=new AttrList(Ye);substituteVariablesInAttributes(_e,Ze,["DATA-ID","LANGUAGE","VALUE","URI"]);const Xe=Ze["DATA-ID"];Xe&&(_e.sessionData===null&&(_e.sessionData={}),_e.sessionData[Xe]=Ze);break}case"SESSION-KEY":{const Ze=parseKey(Ye,ue,_e);Ze.encrypted&&Ze.isSupported()?(_e.sessionKeys===null&&(_e.sessionKeys=[]),_e.sessionKeys.push(Ze)):logger.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${Ye}"`);break}case"DEFINE":{{const Ze=new AttrList(Ye);substituteVariablesInAttributes(_e,Ze,["NAME","VALUE","QUERYPARAM"]),addVariableDefinition(_e,Ze,ue)}break}case"CONTENT-STEERING":{const Ze=new AttrList(Ye);substituteVariablesInAttributes(_e,Ze,["SERVER-URI","PATHWAY-ID"]),_e.contentSteering={uri:M3U8Parser.resolve(Ze["SERVER-URI"],ue),pathwayId:Ze["PATHWAY-ID"]||"."};break}case"START":{_e.startTimeOffset=parseStartTimeOffset(Ye);break}}}const qe=Ne.length>0&&Ne.length<_e.levels.length;return _e.levels=qe?Ne:_e.levels,_e.levels.length===0&&(_e.playlistParsingError=new Error("no levels found in manifest")),_e}static parseMasterPlaylistMedia(ee,ue,pe){let _e;const Ne={},Ue=pe.levels,Ge={AUDIO:Ue.map(Ke=>({id:Ke.attrs.AUDIO,audioCodec:Ke.audioCodec})),SUBTITLES:Ue.map(Ke=>({id:Ke.attrs.SUBTITLES,textCodec:Ke.textCodec})),"CLOSED-CAPTIONS":[]};let qe=0;for(MASTER_PLAYLIST_MEDIA_REGEX.lastIndex=0;(_e=MASTER_PLAYLIST_MEDIA_REGEX.exec(ee))!==null;){const Ke=new AttrList(_e[1]),Ye=Ke.TYPE;if(Ye){const Ze=Ge[Ye],Xe=Ne[Ye]||[];Ne[Ye]=Xe,substituteVariablesInAttributes(pe,Ke,["URI","GROUP-ID","LANGUAGE","ASSOC-LANGUAGE","STABLE-RENDITION-ID","NAME","INSTREAM-ID","CHARACTERISTICS","CHANNELS"]);const Je={attrs:Ke,bitrate:0,id:qe++,groupId:Ke["GROUP-ID"]||"",instreamId:Ke["INSTREAM-ID"],name:Ke.NAME||Ke.LANGUAGE||"",type:Ye,default:Ke.bool("DEFAULT"),autoselect:Ke.bool("AUTOSELECT"),forced:Ke.bool("FORCED"),lang:Ke.LANGUAGE,url:Ke.URI?M3U8Parser.resolve(Ke.URI,ue):""};if(Ze!=null&&Ze.length){const tt=M3U8Parser.findGroup(Ze,Je.groupId)||Ze[0];assignCodec(Je,tt,"audioCodec"),assignCodec(Je,tt,"textCodec")}Xe.push(Je)}}return Ne}static parseLevelPlaylist(ee,ue,pe,_e,Ne,Ue){const Ge=new LevelDetails(ue),qe=Ge.fragments;let Ke=null,Ye=0,Ze=0,Xe=0,Je=0,tt=null,rt=new Fragment(_e,ue),et,it,nt,st=-1,lt=!1;for(LEVEL_PLAYLIST_REGEX_FAST.lastIndex=0,Ge.m3u8=ee,Ge.hasVariableRefs=hasVariableReferences(ee);(et=LEVEL_PLAYLIST_REGEX_FAST.exec(ee))!==null;){lt&&(lt=!1,rt=new Fragment(_e,ue),rt.start=Xe,rt.sn=Ye,rt.cc=Je,rt.level=pe,Ke&&(rt.initSegment=Ke,rt.rawProgramDateTime=Ke.rawProgramDateTime,Ke.rawProgramDateTime=null));const Wr=et[1];if(Wr){rt.duration=parseFloat(Wr);const ri=(" "+et[2]).slice(1);rt.title=ri||null,rt.tagList.push(ri?["INF",Wr,ri]:["INF",Wr])}else if(et[3]){if(isFiniteNumber(rt.duration)){rt.start=Xe,nt&&setFragLevelKeys(rt,nt,Ge),rt.sn=Ye,rt.level=pe,rt.cc=Je,rt.urlId=Ne,qe.push(rt);const ri=(" "+et[3]).slice(1);rt.relurl=substituteVariables(Ge,ri),assignProgramDateTime(rt,tt),tt=rt,Xe+=rt.duration,Ye++,Ze=0,lt=!0}}else if(et[4]){const ri=(" "+et[4]).slice(1);tt?rt.setByteRange(ri,tt):rt.setByteRange(ri)}else if(et[5])rt.rawProgramDateTime=(" "+et[5]).slice(1),rt.tagList.push(["PROGRAM-DATE-TIME",rt.rawProgramDateTime]),st===-1&&(st=qe.length);else{if(et=et[0].match(LEVEL_PLAYLIST_REGEX_SLOW),!et){logger.warn("No matches on slow regex match for level playlist!");continue}for(it=1;it<et.length&&!(typeof et[it]<"u");it++);const ri=(" "+et[it]).slice(1),Xr=(" "+et[it+1]).slice(1),Gr=et[it+2]?(" "+et[it+2]).slice(1):"";switch(ri){case"PLAYLIST-TYPE":Ge.type=Xr.toUpperCase();break;case"MEDIA-SEQUENCE":Ye=Ge.startSN=parseInt(Xr);break;case"SKIP":{const qr=new AttrList(Xr);substituteVariablesInAttributes(Ge,qr,["RECENTLY-REMOVED-DATERANGES"]);const si=qr.decimalInteger("SKIPPED-SEGMENTS");if(isFiniteNumber(si)){Ge.skippedSegments=si;for(let Yr=si;Yr--;)qe.unshift(null);Ye+=si}const oi=qr.enumeratedString("RECENTLY-REMOVED-DATERANGES");oi&&(Ge.recentlyRemovedDateranges=oi.split("	"));break}case"TARGETDURATION":Ge.targetduration=Math.max(parseInt(Xr),1);break;case"VERSION":Ge.version=parseInt(Xr);break;case"EXTM3U":break;case"ENDLIST":Ge.live=!1;break;case"#":(Xr||Gr)&&rt.tagList.push(Gr?[Xr,Gr]:[Xr]);break;case"DISCONTINUITY":Je++,rt.tagList.push(["DIS"]);break;case"GAP":rt.gap=!0,rt.tagList.push([ri]);break;case"BITRATE":rt.tagList.push([ri,Xr]);break;case"DATERANGE":{const qr=new AttrList(Xr);substituteVariablesInAttributes(Ge,qr,["ID","CLASS","START-DATE","END-DATE","SCTE35-CMD","SCTE35-OUT","SCTE35-IN"]),substituteVariablesInAttributes(Ge,qr,qr.clientAttrs);const si=new DateRange(qr,Ge.dateRanges[qr.ID]);si.isValid||Ge.skippedSegments?Ge.dateRanges[si.id]=si:logger.warn(`Ignoring invalid DATERANGE tag: "${Xr}"`),rt.tagList.push(["EXT-X-DATERANGE",Xr]);break}case"DEFINE":{{const qr=new AttrList(Xr);substituteVariablesInAttributes(Ge,qr,["NAME","VALUE","IMPORT","QUERYPARAM"]),"IMPORT"in qr?importVariableDefinition(Ge,qr,Ue):addVariableDefinition(Ge,qr,ue)}break}case"DISCONTINUITY-SEQUENCE":Je=parseInt(Xr);break;case"KEY":{const qr=parseKey(Xr,ue,Ge);if(qr.isSupported()){if(qr.method==="NONE"){nt=void 0;break}nt||(nt={}),nt[qr.keyFormat]&&(nt=_extends({},nt)),nt[qr.keyFormat]=qr}else logger.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${Xr}"`);break}case"START":Ge.startTimeOffset=parseStartTimeOffset(Xr);break;case"MAP":{const qr=new AttrList(Xr);if(substituteVariablesInAttributes(Ge,qr,["BYTERANGE","URI"]),rt.duration){const si=new Fragment(_e,ue);setInitSegment(si,qr,pe,nt),Ke=si,rt.initSegment=Ke,Ke.rawProgramDateTime&&!rt.rawProgramDateTime&&(rt.rawProgramDateTime=Ke.rawProgramDateTime)}else setInitSegment(rt,qr,pe,nt),Ke=rt,lt=!0;break}case"SERVER-CONTROL":{const qr=new AttrList(Xr);Ge.canBlockReload=qr.bool("CAN-BLOCK-RELOAD"),Ge.canSkipUntil=qr.optionalFloat("CAN-SKIP-UNTIL",0),Ge.canSkipDateRanges=Ge.canSkipUntil>0&&qr.bool("CAN-SKIP-DATERANGES"),Ge.partHoldBack=qr.optionalFloat("PART-HOLD-BACK",0),Ge.holdBack=qr.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{const qr=new AttrList(Xr);Ge.partTarget=qr.decimalFloatingPoint("PART-TARGET");break}case"PART":{let qr=Ge.partList;qr||(qr=Ge.partList=[]);const si=Ze>0?qr[qr.length-1]:void 0,oi=Ze++,Yr=new AttrList(Xr);substituteVariablesInAttributes(Ge,Yr,["BYTERANGE","URI"]);const ii=new Part(Yr,rt,ue,oi,si);qr.push(ii),rt.duration+=ii.duration;break}case"PRELOAD-HINT":{const qr=new AttrList(Xr);substituteVariablesInAttributes(Ge,qr,["URI"]),Ge.preloadHint=qr;break}case"RENDITION-REPORT":{const qr=new AttrList(Xr);substituteVariablesInAttributes(Ge,qr,["URI"]),Ge.renditionReports=Ge.renditionReports||[],Ge.renditionReports.push(qr);break}default:logger.warn(`line parsed but not handled: ${et}`);break}}}tt&&!tt.relurl?(qe.pop(),Xe-=tt.duration,Ge.partList&&(Ge.fragmentHint=tt)):Ge.partList&&(assignProgramDateTime(rt,tt),rt.cc=Je,Ge.fragmentHint=rt,nt&&setFragLevelKeys(rt,nt,Ge));const _r=qe.length,jr=qe[0],Nr=qe[_r-1];if(Xe+=Ge.skippedSegments*Ge.targetduration,Xe>0&&_r&&Nr){Ge.averagetargetduration=Xe/_r;const Wr=Nr.sn;Ge.endSN=Wr!=="initSegment"?Wr:0,Ge.live||(Nr.endList=!0),jr&&(Ge.startCC=jr.cc)}else Ge.endSN=0,Ge.startCC=0;return Ge.fragmentHint&&(Xe+=Ge.fragmentHint.duration),Ge.totalduration=Xe,Ge.endCC=Je,st>0&&backfillProgramDateTimes(qe,st),Ge}}function parseKey(fe,ee,ue){var pe,_e;const Ne=new AttrList(fe);substituteVariablesInAttributes(ue,Ne,["KEYFORMAT","KEYFORMATVERSIONS","URI","IV","URI"]);const Ue=(pe=Ne.METHOD)!=null?pe:"",Ge=Ne.URI,qe=Ne.hexadecimalInteger("IV"),Ke=Ne.KEYFORMATVERSIONS,Ye=(_e=Ne.KEYFORMAT)!=null?_e:"identity";Ge&&Ne.IV&&!qe&&logger.error(`Invalid IV: ${Ne.IV}`);const Ze=Ge?M3U8Parser.resolve(Ge,ee):"",Xe=(Ke||"1").split("/").map(Number).filter(Number.isFinite);return new LevelKey(Ue,Ze,Ye,Xe,qe)}function parseStartTimeOffset(fe){const ue=new AttrList(fe).decimalFloatingPoint("TIME-OFFSET");return isFiniteNumber(ue)?ue:null}function setCodecs(fe,ee){["video","audio","text"].forEach(ue=>{const pe=fe.filter(_e=>isCodecType(_e,ue));if(pe.length){const _e=pe.filter(Ne=>Ne.lastIndexOf("avc1",0)===0||Ne.lastIndexOf("mp4a",0)===0);ee[`${ue}Codec`]=_e.length>0?_e[0]:pe[0],fe=fe.filter(Ne=>pe.indexOf(Ne)===-1)}}),ee.unknownCodecs=fe}function assignCodec(fe,ee,ue){const pe=ee[ue];pe&&(fe[ue]=pe)}function backfillProgramDateTimes(fe,ee){let ue=fe[ee];for(let pe=ee;pe--;){const _e=fe[pe];if(!_e)return;_e.programDateTime=ue.programDateTime-_e.duration*1e3,ue=_e}}function assignProgramDateTime(fe,ee){fe.rawProgramDateTime?fe.programDateTime=Date.parse(fe.rawProgramDateTime):ee!=null&&ee.programDateTime&&(fe.programDateTime=ee.endProgramDateTime),isFiniteNumber(fe.programDateTime)||(fe.programDateTime=null,fe.rawProgramDateTime=null)}function setInitSegment(fe,ee,ue,pe){fe.relurl=ee.URI,ee.BYTERANGE&&fe.setByteRange(ee.BYTERANGE),fe.level=ue,fe.sn="initSegment",pe&&(fe.levelkeys=pe),fe.initSegment=null}function setFragLevelKeys(fe,ee,ue){fe.levelkeys=ee;const{encryptedFragments:pe}=ue;(!pe.length||pe[pe.length-1].levelkeys!==ee)&&Object.keys(ee).some(_e=>ee[_e].isCommonEncryption)&&pe.push(fe)}var PlaylistContextType={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},PlaylistLevelType={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};function mapContextToLevelType(fe){const{type:ee}=fe;switch(ee){case PlaylistContextType.AUDIO_TRACK:return PlaylistLevelType.AUDIO;case PlaylistContextType.SUBTITLE_TRACK:return PlaylistLevelType.SUBTITLE;default:return PlaylistLevelType.MAIN}}function getResponseUrl(fe,ee){let ue=fe.url;return(ue===void 0||ue.indexOf("data:")===0)&&(ue=ee.url),ue}class PlaylistLoader{constructor(ee){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=ee,this.registerListeners()}startLoad(ee){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:ee}=this;ee.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),ee.on(Events.LEVEL_LOADING,this.onLevelLoading,this),ee.on(Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),ee.on(Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}unregisterListeners(){const{hls:ee}=this;ee.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),ee.off(Events.LEVEL_LOADING,this.onLevelLoading,this),ee.off(Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),ee.off(Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}createInternalLoader(ee){const ue=this.hls.config,pe=ue.pLoader,_e=ue.loader,Ne=pe||_e,Ue=new Ne(ue);return this.loaders[ee.type]=Ue,Ue}getInternalLoader(ee){return this.loaders[ee.type]}resetInternalLoader(ee){this.loaders[ee]&&delete this.loaders[ee]}destroyInternalLoaders(){for(const ee in this.loaders){const ue=this.loaders[ee];ue&&ue.destroy(),this.resetInternalLoader(ee)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(ee,ue){const{url:pe}=ue;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:PlaylistContextType.MANIFEST,url:pe,deliveryDirectives:null})}onLevelLoading(ee,ue){const{id:pe,level:_e,url:Ne,deliveryDirectives:Ue}=ue;this.load({id:pe,level:_e,responseType:"text",type:PlaylistContextType.LEVEL,url:Ne,deliveryDirectives:Ue})}onAudioTrackLoading(ee,ue){const{id:pe,groupId:_e,url:Ne,deliveryDirectives:Ue}=ue;this.load({id:pe,groupId:_e,level:null,responseType:"text",type:PlaylistContextType.AUDIO_TRACK,url:Ne,deliveryDirectives:Ue})}onSubtitleTrackLoading(ee,ue){const{id:pe,groupId:_e,url:Ne,deliveryDirectives:Ue}=ue;this.load({id:pe,groupId:_e,level:null,responseType:"text",type:PlaylistContextType.SUBTITLE_TRACK,url:Ne,deliveryDirectives:Ue})}load(ee){var ue;const pe=this.hls.config;let _e=this.getInternalLoader(ee);if(_e){const Ke=_e.context;if(Ke&&Ke.url===ee.url){logger.trace("[playlist-loader]: playlist request ongoing");return}logger.log(`[playlist-loader]: aborting previous loader for type: ${ee.type}`),_e.abort()}let Ne;if(ee.type===PlaylistContextType.MANIFEST?Ne=pe.manifestLoadPolicy.default:Ne=_extends({},pe.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),_e=this.createInternalLoader(ee),(ue=ee.deliveryDirectives)!=null&&ue.part){let Ke;if(ee.type===PlaylistContextType.LEVEL&&ee.level!==null?Ke=this.hls.levels[ee.level].details:ee.type===PlaylistContextType.AUDIO_TRACK&&ee.id!==null?Ke=this.hls.audioTracks[ee.id].details:ee.type===PlaylistContextType.SUBTITLE_TRACK&&ee.id!==null&&(Ke=this.hls.subtitleTracks[ee.id].details),Ke){const Ye=Ke.partTarget,Ze=Ke.targetduration;if(Ye&&Ze){const Xe=Math.max(Ye*3,Ze*.8)*1e3;Ne=_extends({},Ne,{maxTimeToFirstByteMs:Math.min(Xe,Ne.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(Xe,Ne.maxTimeToFirstByteMs)})}}}const Ue=Ne.errorRetry||Ne.timeoutRetry||{},Ge={loadPolicy:Ne,timeout:Ne.maxLoadTimeMs,maxRetry:Ue.maxNumRetry||0,retryDelay:Ue.retryDelayMs||0,maxRetryDelay:Ue.maxRetryDelayMs||0},qe={onSuccess:(Ke,Ye,Ze,Xe)=>{const Je=this.getInternalLoader(Ze);this.resetInternalLoader(Ze.type);const tt=Ke.data;if(tt.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(Ke,Ze,new Error("no EXTM3U delimiter"),Xe||null,Ye);return}Ye.parsing.start=performance.now(),M3U8Parser.isMediaPlaylist(tt)?this.handleTrackOrLevelPlaylist(Ke,Ye,Ze,Xe||null,Je):this.handleMasterPlaylist(Ke,Ye,Ze,Xe)},onError:(Ke,Ye,Ze,Xe)=>{this.handleNetworkError(Ye,Ze,!1,Ke,Xe)},onTimeout:(Ke,Ye,Ze)=>{this.handleNetworkError(Ye,Ze,!0,void 0,Ke)}};_e.load(ee,Ge,qe)}handleMasterPlaylist(ee,ue,pe,_e){const Ne=this.hls,Ue=ee.data,Ge=getResponseUrl(ee,pe),qe=M3U8Parser.parseMasterPlaylist(Ue,Ge);if(qe.playlistParsingError){this.handleManifestParsingError(ee,pe,qe.playlistParsingError,_e,ue);return}const{contentSteering:Ke,levels:Ye,sessionData:Ze,sessionKeys:Xe,startTimeOffset:Je,variableList:tt}=qe;this.variableList=tt;const{AUDIO:rt=[],SUBTITLES:et,"CLOSED-CAPTIONS":it}=M3U8Parser.parseMasterPlaylistMedia(Ue,Ge,qe);rt.length&&!rt.some(st=>!st.url)&&Ye[0].audioCodec&&!Ye[0].attrs.AUDIO&&(logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),rt.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new AttrList({}),bitrate:0,url:""})),Ne.trigger(Events.MANIFEST_LOADED,{levels:Ye,audioTracks:rt,subtitles:et,captions:it,contentSteering:Ke,url:Ge,stats:ue,networkDetails:_e,sessionData:Ze,sessionKeys:Xe,startTimeOffset:Je,variableList:tt})}handleTrackOrLevelPlaylist(ee,ue,pe,_e,Ne){const Ue=this.hls,{id:Ge,level:qe,type:Ke}=pe,Ye=getResponseUrl(ee,pe),Ze=isFiniteNumber(Ge)?Ge:0,Xe=isFiniteNumber(qe)?qe:Ze,Je=mapContextToLevelType(pe),tt=M3U8Parser.parseLevelPlaylist(ee.data,Ye,Xe,Je,Ze,this.variableList);if(Ke===PlaylistContextType.MANIFEST){const rt={attrs:new AttrList({}),bitrate:0,details:tt,name:"",url:Ye};Ue.trigger(Events.MANIFEST_LOADED,{levels:[rt],audioTracks:[],url:Ye,stats:ue,networkDetails:_e,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}ue.parsing.end=performance.now(),pe.levelDetails=tt,this.handlePlaylistLoaded(tt,ee,ue,pe,_e,Ne)}handleManifestParsingError(ee,ue,pe,_e,Ne){this.hls.trigger(Events.ERROR,{type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.MANIFEST_PARSING_ERROR,fatal:ue.type===PlaylistContextType.MANIFEST,url:ee.url,err:pe,error:pe,reason:pe.message,response:ee,context:ue,networkDetails:_e,stats:Ne})}handleNetworkError(ee,ue,pe=!1,_e,Ne){let Ue=`A network ${pe?"timeout":"error"+(_e?" (status "+_e.code+")":"")} occurred while loading ${ee.type}`;ee.type===PlaylistContextType.LEVEL?Ue+=`: ${ee.level} id: ${ee.id}`:(ee.type===PlaylistContextType.AUDIO_TRACK||ee.type===PlaylistContextType.SUBTITLE_TRACK)&&(Ue+=` id: ${ee.id} group-id: "${ee.groupId}"`);const Ge=new Error(Ue);logger.warn(`[playlist-loader]: ${Ue}`);let qe=ErrorDetails.UNKNOWN,Ke=!1;const Ye=this.getInternalLoader(ee);switch(ee.type){case PlaylistContextType.MANIFEST:qe=pe?ErrorDetails.MANIFEST_LOAD_TIMEOUT:ErrorDetails.MANIFEST_LOAD_ERROR,Ke=!0;break;case PlaylistContextType.LEVEL:qe=pe?ErrorDetails.LEVEL_LOAD_TIMEOUT:ErrorDetails.LEVEL_LOAD_ERROR,Ke=!1;break;case PlaylistContextType.AUDIO_TRACK:qe=pe?ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:ErrorDetails.AUDIO_TRACK_LOAD_ERROR,Ke=!1;break;case PlaylistContextType.SUBTITLE_TRACK:qe=pe?ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:ErrorDetails.SUBTITLE_LOAD_ERROR,Ke=!1;break}Ye&&this.resetInternalLoader(ee.type);const Ze={type:ErrorTypes.NETWORK_ERROR,details:qe,fatal:Ke,url:ee.url,loader:Ye,context:ee,error:Ge,networkDetails:ue,stats:Ne};if(_e){const Xe=(ue==null?void 0:ue.url)||ee.url;Ze.response=_objectSpread2({url:Xe,data:void 0},_e)}this.hls.trigger(Events.ERROR,Ze)}handlePlaylistLoaded(ee,ue,pe,_e,Ne,Ue){const Ge=this.hls,{type:qe,level:Ke,id:Ye,groupId:Ze,deliveryDirectives:Xe}=_e,Je=getResponseUrl(ue,_e),tt=mapContextToLevelType(_e),rt=typeof _e.level=="number"&&tt===PlaylistLevelType.MAIN?Ke:void 0;if(!ee.fragments.length){const it=new Error("No Segments found in Playlist");Ge.trigger(Events.ERROR,{type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:Je,error:it,reason:it.message,response:ue,context:_e,level:rt,parent:tt,networkDetails:Ne,stats:pe});return}ee.targetduration||(ee.playlistParsingError=new Error("Missing Target Duration"));const et=ee.playlistParsingError;if(et){Ge.trigger(Events.ERROR,{type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.LEVEL_PARSING_ERROR,fatal:!1,url:Je,error:et,reason:et.message,response:ue,context:_e,level:rt,parent:tt,networkDetails:Ne,stats:pe});return}switch(ee.live&&Ue&&(Ue.getCacheAge&&(ee.ageHeader=Ue.getCacheAge()||0),(!Ue.getCacheAge||isNaN(ee.ageHeader))&&(ee.ageHeader=0)),qe){case PlaylistContextType.MANIFEST:case PlaylistContextType.LEVEL:Ge.trigger(Events.LEVEL_LOADED,{details:ee,level:rt||0,id:Ye||0,stats:pe,networkDetails:Ne,deliveryDirectives:Xe});break;case PlaylistContextType.AUDIO_TRACK:Ge.trigger(Events.AUDIO_TRACK_LOADED,{details:ee,id:Ye||0,groupId:Ze||"",stats:pe,networkDetails:Ne,deliveryDirectives:Xe});break;case PlaylistContextType.SUBTITLE_TRACK:Ge.trigger(Events.SUBTITLE_TRACK_LOADED,{details:ee,id:Ye||0,groupId:Ze||"",stats:pe,networkDetails:Ne,deliveryDirectives:Xe});break}}}function sendAddTrackEvent(fe,ee){let ue;try{ue=new Event("addtrack")}catch{ue=document.createEvent("Event"),ue.initEvent("addtrack",!1,!1)}ue.track=fe,ee.dispatchEvent(ue)}function addCueToTrack(fe,ee){const ue=fe.mode;if(ue==="disabled"&&(fe.mode="hidden"),fe.cues&&!fe.cues.getCueById(ee.id))try{if(fe.addCue(ee),!fe.cues.getCueById(ee.id))throw new Error(`addCue is failed for: ${ee}`)}catch(pe){logger.debug(`[texttrack-utils]: ${pe}`);try{const _e=new self.TextTrackCue(ee.startTime,ee.endTime,ee.text);_e.id=ee.id,fe.addCue(_e)}catch(_e){logger.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${_e}`)}}ue==="disabled"&&(fe.mode=ue)}function clearCurrentCues(fe){const ee=fe.mode;if(ee==="disabled"&&(fe.mode="hidden"),fe.cues)for(let ue=fe.cues.length;ue--;)fe.removeCue(fe.cues[ue]);ee==="disabled"&&(fe.mode=ee)}function removeCuesInRange(fe,ee,ue,pe){const _e=fe.mode;if(_e==="disabled"&&(fe.mode="hidden"),fe.cues&&fe.cues.length>0){const Ne=getCuesInRange(fe.cues,ee,ue);for(let Ue=0;Ue<Ne.length;Ue++)(!pe||pe(Ne[Ue]))&&fe.removeCue(Ne[Ue])}_e==="disabled"&&(fe.mode=_e)}function getFirstCueIndexAfterTime(fe,ee){if(ee<fe[0].startTime)return 0;const ue=fe.length-1;if(ee>fe[ue].endTime)return-1;let pe=0,_e=ue;for(;pe<=_e;){const Ne=Math.floor((_e+pe)/2);if(ee<fe[Ne].startTime)_e=Ne-1;else if(ee>fe[Ne].startTime&&pe<ue)pe=Ne+1;else return Ne}return fe[pe].startTime-ee<ee-fe[_e].startTime?pe:_e}function getCuesInRange(fe,ee,ue){const pe=[],_e=getFirstCueIndexAfterTime(fe,ee);if(_e>-1)for(let Ne=_e,Ue=fe.length;Ne<Ue;Ne++){const Ge=fe[Ne];if(Ge.startTime>=ee&&Ge.endTime<=ue)pe.push(Ge);else if(Ge.startTime>ue)return pe}return pe}var MetadataSchema={audioId3:"org.id3",dateRange:"com.apple.quicktime.HLS",emsg:"https://aomedia.org/emsg/ID3"};const MIN_CUE_DURATION=.25;function getCueClass(){if(!(typeof self>"u"))return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}const MAX_CUE_ENDTIME=(()=>{const fe=getCueClass();try{new fe(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();function dateRangeDateToTimelineSeconds(fe,ee){return fe.getTime()/1e3-ee}function hexToArrayBuffer(fe){return Uint8Array.from(fe.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}class ID3TrackController{constructor(ee){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=ee,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null}_registerListeners(){const{hls:ee}=this;ee.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),ee.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),ee.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),ee.on(Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),ee.on(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),ee.on(Events.LEVEL_UPDATED,this.onLevelUpdated,this)}_unregisterListeners(){const{hls:ee}=this;ee.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),ee.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),ee.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),ee.off(Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),ee.off(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),ee.off(Events.LEVEL_UPDATED,this.onLevelUpdated,this)}onMediaAttached(ee,ue){this.media=ue.media}onMediaDetaching(){this.id3Track&&(clearCurrentCues(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(ee){const ue=this.getID3Track(ee.textTracks);return ue.mode="hidden",ue}getID3Track(ee){if(this.media){for(let ue=0;ue<ee.length;ue++){const pe=ee[ue];if(pe.kind==="metadata"&&pe.label==="id3")return sendAddTrackEvent(pe,this.media),pe}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(ee,ue){if(!this.media)return;const{hls:{config:{enableEmsgMetadataCues:pe,enableID3MetadataCues:_e}}}=this;if(!pe&&!_e)return;const{samples:Ne}=ue;this.id3Track||(this.id3Track=this.createTrack(this.media));const Ue=getCueClass();for(let Ge=0;Ge<Ne.length;Ge++){const qe=Ne[Ge].type;if(qe===MetadataSchema.emsg&&!pe||!_e)continue;const Ke=getID3Frames(Ne[Ge].data);if(Ke){const Ye=Ne[Ge].pts;let Ze=Ye+Ne[Ge].duration;Ze>MAX_CUE_ENDTIME&&(Ze=MAX_CUE_ENDTIME),Ze-Ye<=0&&(Ze=Ye+MIN_CUE_DURATION);for(let Je=0;Je<Ke.length;Je++){const tt=Ke[Je];if(!isTimeStampFrame(tt)){this.updateId3CueEnds(Ye,qe);const rt=new Ue(Ye,Ze,"");rt.value=tt,qe&&(rt.type=qe),this.id3Track.addCue(rt)}}}}}updateId3CueEnds(ee,ue){var pe;const _e=(pe=this.id3Track)==null?void 0:pe.cues;if(_e)for(let Ne=_e.length;Ne--;){const Ue=_e[Ne];Ue.type===ue&&Ue.startTime<ee&&Ue.endTime===MAX_CUE_ENDTIME&&(Ue.endTime=ee)}}onBufferFlushing(ee,{startOffset:ue,endOffset:pe,type:_e}){const{id3Track:Ne,hls:Ue}=this;if(!Ue)return;const{config:{enableEmsgMetadataCues:Ge,enableID3MetadataCues:qe}}=Ue;if(Ne&&(Ge||qe)){let Ke;_e==="audio"?Ke=Ye=>Ye.type===MetadataSchema.audioId3&&qe:_e==="video"?Ke=Ye=>Ye.type===MetadataSchema.emsg&&Ge:Ke=Ye=>Ye.type===MetadataSchema.audioId3&&qe||Ye.type===MetadataSchema.emsg&&Ge,removeCuesInRange(Ne,ue,pe,Ke)}}onLevelUpdated(ee,{details:ue}){if(!this.media||!ue.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;const{dateRangeCuesAppended:pe,id3Track:_e}=this,{dateRanges:Ne}=ue,Ue=Object.keys(Ne);if(_e){const Ye=Object.keys(pe).filter(Ze=>!Ue.includes(Ze));for(let Ze=Ye.length;Ze--;){const Xe=Ye[Ze];Object.keys(pe[Xe].cues).forEach(Je=>{_e.removeCue(pe[Xe].cues[Je])}),delete pe[Xe]}}const Ge=ue.fragments[ue.fragments.length-1];if(Ue.length===0||!isFiniteNumber(Ge==null?void 0:Ge.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));const qe=Ge.programDateTime/1e3-Ge.start,Ke=getCueClass();for(let Ye=0;Ye<Ue.length;Ye++){const Ze=Ue[Ye],Xe=Ne[Ze],Je=pe[Ze],tt=(Je==null?void 0:Je.cues)||{};let rt=(Je==null?void 0:Je.durationKnown)||!1;const et=dateRangeDateToTimelineSeconds(Xe.startDate,qe);let it=MAX_CUE_ENDTIME;const nt=Xe.endDate;if(nt)it=dateRangeDateToTimelineSeconds(nt,qe),rt=!0;else if(Xe.endOnNext&&!rt){const lt=Ue.reduce((_r,jr)=>{const Nr=Ne[jr];return Nr.class===Xe.class&&Nr.id!==jr&&Nr.startDate>Xe.startDate&&_r.push(Nr),_r},[]).sort((_r,jr)=>_r.startDate.getTime()-jr.startDate.getTime())[0];lt&&(it=dateRangeDateToTimelineSeconds(lt.startDate,qe),rt=!0)}const st=Object.keys(Xe.attr);for(let lt=0;lt<st.length;lt++){const _r=st[lt];if(!isDateRangeCueAttribute(_r))continue;let jr=tt[_r];if(jr)rt&&!Je.durationKnown&&(jr.endTime=it);else{let Nr=Xe.attr[_r];jr=new Ke(et,it,""),isSCTE35Attribute(_r)&&(Nr=hexToArrayBuffer(Nr)),jr.value={key:_r,data:Nr},jr.type=MetadataSchema.dateRange,jr.id=Ze,this.id3Track.addCue(jr),tt[_r]=jr}}pe[Ze]={cues:tt,dateRange:Xe,durationKnown:rt}}}}class LatencyController{constructor(ee){this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=()=>this.timeupdate(),this.hls=ee,this.config=ee.config,this.registerListeners()}get latency(){return this._latency||0}get maxLatency(){const{config:ee,levelDetails:ue}=this;return ee.liveMaxLatencyDuration!==void 0?ee.liveMaxLatencyDuration:ue?ee.liveMaxLatencyDurationCount*ue.targetduration:0}get targetLatency(){const{levelDetails:ee}=this;if(ee===null)return null;const{holdBack:ue,partHoldBack:pe,targetduration:_e}=ee,{liveSyncDuration:Ne,liveSyncDurationCount:Ue,lowLatencyMode:Ge}=this.config,qe=this.hls.userConfig;let Ke=Ge&&pe||ue;(qe.liveSyncDuration||qe.liveSyncDurationCount||Ke===0)&&(Ke=Ne!==void 0?Ne:Ue*_e);const Ye=_e,Ze=1;return Ke+Math.min(this.stallCount*Ze,Ye)}get liveSyncPosition(){const ee=this.estimateLiveEdge(),ue=this.targetLatency,pe=this.levelDetails;if(ee===null||ue===null||pe===null)return null;const _e=pe.edge,Ne=ee-ue-this.edgeStalled,Ue=_e-pe.totalduration,Ge=_e-(this.config.lowLatencyMode&&pe.partTarget||pe.targetduration);return Math.min(Math.max(Ue,Ne),Ge)}get drift(){const{levelDetails:ee}=this;return ee===null?1:ee.drift}get edgeStalled(){const{levelDetails:ee}=this;if(ee===null)return 0;const ue=(this.config.lowLatencyMode&&ee.partTarget||ee.targetduration)*3;return Math.max(ee.age-ue,0)}get forwardBufferLength(){const{media:ee,levelDetails:ue}=this;if(!ee||!ue)return 0;const pe=ee.buffered.length;return(pe?ee.buffered.end(pe-1):ue.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null}registerListeners(){this.hls.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(Events.ERROR,this.onError,this)}unregisterListeners(){this.hls.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(Events.ERROR,this.onError,this)}onMediaAttached(ee,ue){this.media=ue.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)}onManifestLoading(){this.levelDetails=null,this._latency=null,this.stallCount=0}onLevelUpdated(ee,{details:ue}){this.levelDetails=ue,ue.advanced&&this.timeupdate(),!ue.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)}onError(ee,ue){var pe;ue.details===ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,(pe=this.levelDetails)!=null&&pe.live&&logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))}timeupdate(){const{media:ee,levelDetails:ue}=this;if(!ee||!ue)return;this.currentTime=ee.currentTime;const pe=this.computeLatency();if(pe===null)return;this._latency=pe;const{lowLatencyMode:_e,maxLiveSyncPlaybackRate:Ne}=this.config;if(!_e||Ne===1)return;const Ue=this.targetLatency;if(Ue===null)return;const Ge=pe-Ue,qe=Math.min(this.maxLatency,Ue+ue.targetduration),Ke=Ge<qe;if(ue.live&&Ke&&Ge>.05&&this.forwardBufferLength>1){const Ye=Math.min(2,Math.max(1,Ne)),Ze=Math.round(2/(1+Math.exp(-.75*Ge-this.edgeStalled))*20)/20;ee.playbackRate=Math.min(Ye,Math.max(1,Ze))}else ee.playbackRate!==1&&ee.playbackRate!==0&&(ee.playbackRate=1)}estimateLiveEdge(){const{levelDetails:ee}=this;return ee===null?null:ee.edge+ee.age}computeLatency(){const ee=this.estimateLiveEdge();return ee===null?null:ee-this.currentTime}}const HdcpLevels=["NONE","TYPE-0","TYPE-1",null];var HlsSkip={No:"",Yes:"YES",v2:"v2"};function getSkipValue(fe,ee){const{canSkipUntil:ue,canSkipDateRanges:pe,endSN:_e}=fe,Ne=ee!==void 0?ee-_e:0;return ue&&Ne<ue?pe?HlsSkip.v2:HlsSkip.Yes:HlsSkip.No}class HlsUrlParameters{constructor(ee,ue,pe){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=ee,this.part=ue,this.skip=pe}addDirectives(ee){const ue=new self.URL(ee);return this.msn!==void 0&&ue.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&ue.searchParams.set("_HLS_part",this.part.toString()),this.skip&&ue.searchParams.set("_HLS_skip",this.skip),ue.href}}class Level{constructor(ee){this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[ee.url],this._attrs=[ee.attrs],this.bitrate=ee.bitrate,ee.details&&(this.details=ee.details),this.id=ee.id||0,this.name=ee.name,this.width=ee.width||0,this.height=ee.height||0,this.audioCodec=ee.audioCodec,this.videoCodec=ee.videoCodec,this.unknownCodecs=ee.unknownCodecs,this.codecSet=[ee.videoCodec,ee.audioCodec].filter(ue=>ue).join(",").replace(/\.[^.,]+/g,"")}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get attrs(){return this._attrs[this._urlId]}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get uri(){return this.url[this._urlId]||""}get urlId(){return this._urlId}set urlId(ee){const ue=ee%this.url.length;this._urlId!==ue&&(this.fragmentError=0,this.loadError=0,this.details=void 0,this._urlId=ue)}get audioGroupId(){var ee;return(ee=this.audioGroupIds)==null?void 0:ee[this.urlId]}get textGroupId(){var ee;return(ee=this.textGroupIds)==null?void 0:ee[this.urlId]}addFallback(ee){this.url.push(ee.url),this._attrs.push(ee.attrs)}}function updateFromToPTS(fe,ee){const ue=ee.startPTS;if(isFiniteNumber(ue)){let pe=0,_e;ee.sn>fe.sn?(pe=ue-fe.start,_e=fe):(pe=fe.start-ue,_e=ee),_e.duration!==pe&&(_e.duration=pe)}else ee.sn>fe.sn?fe.cc===ee.cc&&fe.minEndPTS?ee.start=fe.start+(fe.minEndPTS-fe.start):ee.start=fe.start+fe.duration:ee.start=Math.max(fe.start-ee.duration,0)}function updateFragPTSDTS(fe,ee,ue,pe,_e,Ne){pe-ue<=0&&(logger.warn("Fragment should have a positive duration",ee),pe=ue+ee.duration,Ne=_e+ee.duration);let Ge=ue,qe=pe;const Ke=ee.startPTS,Ye=ee.endPTS;if(isFiniteNumber(Ke)){const et=Math.abs(Ke-ue);isFiniteNumber(ee.deltaPTS)?ee.deltaPTS=Math.max(et,ee.deltaPTS):ee.deltaPTS=et,Ge=Math.max(ue,Ke),ue=Math.min(ue,Ke),_e=Math.min(_e,ee.startDTS),qe=Math.min(pe,Ye),pe=Math.max(pe,Ye),Ne=Math.max(Ne,ee.endDTS)}const Ze=ue-ee.start;ee.start!==0&&(ee.start=ue),ee.duration=pe-ee.start,ee.startPTS=ue,ee.maxStartPTS=Ge,ee.startDTS=_e,ee.endPTS=pe,ee.minEndPTS=qe,ee.endDTS=Ne;const Xe=ee.sn;if(!fe||Xe<fe.startSN||Xe>fe.endSN)return 0;let Je;const tt=Xe-fe.startSN,rt=fe.fragments;for(rt[tt]=ee,Je=tt;Je>0;Je--)updateFromToPTS(rt[Je],rt[Je-1]);for(Je=tt;Je<rt.length-1;Je++)updateFromToPTS(rt[Je],rt[Je+1]);return fe.fragmentHint&&updateFromToPTS(rt[rt.length-1],fe.fragmentHint),fe.PTSKnown=fe.alignedSliding=!0,Ze}function mergeDetails(fe,ee){let ue=null;const pe=fe.fragments;for(let qe=pe.length-1;qe>=0;qe--){const Ke=pe[qe].initSegment;if(Ke){ue=Ke;break}}fe.fragmentHint&&delete fe.fragmentHint.endPTS;let _e=0,Ne;if(mapFragmentIntersection(fe,ee,(qe,Ke)=>{qe.relurl&&(_e=qe.cc-Ke.cc),isFiniteNumber(qe.startPTS)&&isFiniteNumber(qe.endPTS)&&(Ke.start=Ke.startPTS=qe.startPTS,Ke.startDTS=qe.startDTS,Ke.maxStartPTS=qe.maxStartPTS,Ke.endPTS=qe.endPTS,Ke.endDTS=qe.endDTS,Ke.minEndPTS=qe.minEndPTS,Ke.duration=qe.endPTS-qe.startPTS,Ke.duration&&(Ne=Ke),ee.PTSKnown=ee.alignedSliding=!0),Ke.elementaryStreams=qe.elementaryStreams,Ke.loader=qe.loader,Ke.stats=qe.stats,Ke.urlId=qe.urlId,qe.initSegment&&(Ke.initSegment=qe.initSegment,ue=qe.initSegment)}),ue&&(ee.fragmentHint?ee.fragments.concat(ee.fragmentHint):ee.fragments).forEach(Ke=>{var Ye;(!Ke.initSegment||Ke.initSegment.relurl===((Ye=ue)==null?void 0:Ye.relurl))&&(Ke.initSegment=ue)}),ee.skippedSegments)if(ee.deltaUpdateFailed=ee.fragments.some(qe=>!qe),ee.deltaUpdateFailed){logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let qe=ee.skippedSegments;qe--;)ee.fragments.shift();ee.startSN=ee.fragments[0].sn,ee.startCC=ee.fragments[0].cc}else ee.canSkipDateRanges&&(ee.dateRanges=mergeDateRanges(fe.dateRanges,ee.dateRanges,ee.recentlyRemovedDateranges));const Ue=ee.fragments;if(_e){logger.warn("discontinuity sliding from playlist, take drift into account");for(let qe=0;qe<Ue.length;qe++)Ue[qe].cc+=_e}ee.skippedSegments&&(ee.startCC=ee.fragments[0].cc),mapPartIntersection(fe.partList,ee.partList,(qe,Ke)=>{Ke.elementaryStreams=qe.elementaryStreams,Ke.stats=qe.stats}),Ne?updateFragPTSDTS(ee,Ne,Ne.startPTS,Ne.endPTS,Ne.startDTS,Ne.endDTS):adjustSliding(fe,ee),Ue.length&&(ee.totalduration=ee.edge-Ue[0].start),ee.driftStartTime=fe.driftStartTime,ee.driftStart=fe.driftStart;const Ge=ee.advancedDateTime;if(ee.advanced&&Ge){const qe=ee.edge;ee.driftStart||(ee.driftStartTime=Ge,ee.driftStart=qe),ee.driftEndTime=Ge,ee.driftEnd=qe}else ee.driftEndTime=fe.driftEndTime,ee.driftEnd=fe.driftEnd,ee.advancedDateTime=fe.advancedDateTime}function mergeDateRanges(fe,ee,ue){const pe=_extends({},fe);return ue&&ue.forEach(_e=>{delete pe[_e]}),Object.keys(ee).forEach(_e=>{const Ne=new DateRange(ee[_e].attr,pe[_e]);Ne.isValid?pe[_e]=Ne:logger.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${JSON.stringify(ee[_e].attr)}"`)}),pe}function mapPartIntersection(fe,ee,ue){if(fe&&ee){let pe=0;for(let _e=0,Ne=fe.length;_e<=Ne;_e++){const Ue=fe[_e],Ge=ee[_e+pe];Ue&&Ge&&Ue.index===Ge.index&&Ue.fragment.sn===Ge.fragment.sn?ue(Ue,Ge):pe--}}}function mapFragmentIntersection(fe,ee,ue){const pe=ee.skippedSegments,_e=Math.max(fe.startSN,ee.startSN)-ee.startSN,Ne=(fe.fragmentHint?1:0)+(pe?ee.endSN:Math.min(fe.endSN,ee.endSN))-ee.startSN,Ue=ee.startSN-fe.startSN,Ge=ee.fragmentHint?ee.fragments.concat(ee.fragmentHint):ee.fragments,qe=fe.fragmentHint?fe.fragments.concat(fe.fragmentHint):fe.fragments;for(let Ke=_e;Ke<=Ne;Ke++){const Ye=qe[Ue+Ke];let Ze=Ge[Ke];pe&&!Ze&&Ke<pe&&(Ze=ee.fragments[Ke]=Ye),Ye&&Ze&&ue(Ye,Ze)}}function adjustSliding(fe,ee){const ue=ee.startSN+ee.skippedSegments-fe.startSN,pe=fe.fragments;ue<0||ue>=pe.length||addSliding(ee,pe[ue].start)}function addSliding(fe,ee){if(ee){const ue=fe.fragments;for(let pe=fe.skippedSegments;pe<ue.length;pe++)ue[pe].start+=ee;fe.fragmentHint&&(fe.fragmentHint.start+=ee)}}function computeReloadInterval(fe,ee=1/0){let ue=1e3*fe.targetduration;if(fe.updated){const pe=fe.fragments,_e=4;if(pe.length&&ue*_e>ee){const Ne=pe[pe.length-1].duration*1e3;Ne<ue&&(ue=Ne)}}else ue/=2;return Math.round(ue)}function getFragmentWithSN(fe,ee,ue){if(!(fe!=null&&fe.details))return null;const pe=fe.details;let _e=pe.fragments[ee-pe.startSN];return _e||(_e=pe.fragmentHint,_e&&_e.sn===ee)?_e:ee<pe.startSN&&ue&&ue.sn===ee?ue:null}function getPartWith(fe,ee,ue){var pe;return fe!=null&&fe.details?findPart((pe=fe.details)==null?void 0:pe.partList,ee,ue):null}function findPart(fe,ee,ue){if(fe)for(let pe=fe.length;pe--;){const _e=fe[pe];if(_e.index===ue&&_e.fragment.sn===ee)return _e}return null}function isTimeoutError(fe){switch(fe.details){case ErrorDetails.FRAG_LOAD_TIMEOUT:case ErrorDetails.KEY_LOAD_TIMEOUT:case ErrorDetails.LEVEL_LOAD_TIMEOUT:case ErrorDetails.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function getRetryConfig(fe,ee){const ue=isTimeoutError(ee);return fe.default[`${ue?"timeout":"error"}Retry`]}function getRetryDelay(fe,ee){const ue=fe.backoff==="linear"?1:Math.pow(2,ee);return Math.min(ue*fe.retryDelayMs,fe.maxRetryDelayMs)}function getLoaderConfigWithoutReties(fe){return _objectSpread2(_objectSpread2({},fe),{errorRetry:null,timeoutRetry:null})}function shouldRetry(fe,ee,ue,pe){return!!fe&&ee<fe.maxNumRetry&&(retryForHttpStatus(pe)||!!ue)}function retryForHttpStatus(fe){return fe===0&&navigator.onLine===!1||!!fe&&(fe<400||fe>499)}const BinarySearch={search:function(fe,ee){let ue=0,pe=fe.length-1,_e=null,Ne=null;for(;ue<=pe;){_e=(ue+pe)/2|0,Ne=fe[_e];const Ue=ee(Ne);if(Ue>0)ue=_e+1;else if(Ue<0)pe=_e-1;else return Ne}return null}};function findFragmentByPDT(fe,ee,ue){if(ee===null||!Array.isArray(fe)||!fe.length||!isFiniteNumber(ee))return null;const pe=fe[0].programDateTime;if(ee<(pe||0))return null;const _e=fe[fe.length-1].endProgramDateTime;if(ee>=(_e||0))return null;ue=ue||0;for(let Ne=0;Ne<fe.length;++Ne){const Ue=fe[Ne];if(pdtWithinToleranceTest(ee,ue,Ue))return Ue}return null}function findFragmentByPTS(fe,ee,ue=0,pe=0){let _e=null;if(fe?_e=ee[fe.sn-ee[0].sn+1]||null:ue===0&&ee[0].start===0&&(_e=ee[0]),_e&&fragmentWithinToleranceTest(ue,pe,_e)===0)return _e;const Ne=BinarySearch.search(ee,fragmentWithinToleranceTest.bind(null,ue,pe));return Ne&&(Ne!==fe||!_e)?Ne:_e}function fragmentWithinToleranceTest(fe=0,ee=0,ue){if(ue.start<=fe&&ue.start+ue.duration>fe)return 0;const pe=Math.min(ee,ue.duration+(ue.deltaPTS?ue.deltaPTS:0));return ue.start+ue.duration-pe<=fe?1:ue.start-pe>fe&&ue.start?-1:0}function pdtWithinToleranceTest(fe,ee,ue){const pe=Math.min(ee,ue.duration+(ue.deltaPTS?ue.deltaPTS:0))*1e3;return(ue.endProgramDateTime||0)-pe>fe}function findFragWithCC(fe,ee){return BinarySearch.search(fe,ue=>ue.cc<ee?1:ue.cc>ee?-1:0)}const RENDITION_PENALTY_DURATION_MS=3e5;var NetworkErrorAction={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},ErrorActionFlags={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,SwitchToSDR:4};class ErrorController{constructor(ee){this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=ee,this.log=logger.log.bind(logger,"[info]:"),this.warn=logger.warn.bind(logger,"[warning]:"),this.error=logger.error.bind(logger,"[error]:"),this.registerListeners()}registerListeners(){const ee=this.hls;ee.on(Events.ERROR,this.onError,this),ee.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),ee.on(Events.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const ee=this.hls;ee&&(ee.off(Events.ERROR,this.onError,this),ee.off(Events.ERROR,this.onErrorOut,this),ee.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),ee.off(Events.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(ee){this.playlistError=0}stopLoad(){}getVariantLevelIndex(ee){return(ee==null?void 0:ee.type)===PlaylistLevelType.MAIN?ee.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(ee,ue){var pe,_e;if(ue.fatal)return;const Ne=this.hls,Ue=ue.context;switch(ue.details){case ErrorDetails.FRAG_LOAD_ERROR:case ErrorDetails.FRAG_LOAD_TIMEOUT:case ErrorDetails.KEY_LOAD_ERROR:case ErrorDetails.KEY_LOAD_TIMEOUT:ue.errorAction=this.getFragRetryOrSwitchAction(ue);return;case ErrorDetails.FRAG_PARSING_ERROR:if((pe=ue.frag)!=null&&pe.gap){ue.errorAction={action:NetworkErrorAction.DoNothing,flags:ErrorActionFlags.None};return}case ErrorDetails.FRAG_GAP:case ErrorDetails.FRAG_DECRYPT_ERROR:{ue.errorAction=this.getFragRetryOrSwitchAction(ue),ue.errorAction.action=NetworkErrorAction.SendAlternateToPenaltyBox;return}case ErrorDetails.LEVEL_EMPTY_ERROR:case ErrorDetails.LEVEL_PARSING_ERROR:{var Ge,qe;const Ke=ue.parent===PlaylistLevelType.MAIN?ue.level:Ne.loadLevel;ue.details===ErrorDetails.LEVEL_EMPTY_ERROR&&((Ge=ue.context)!=null&&(qe=Ge.levelDetails)!=null&&qe.live)?ue.errorAction=this.getPlaylistRetryOrSwitchAction(ue,Ke):(ue.levelRetry=!1,ue.errorAction=this.getLevelSwitchAction(ue,Ke))}return;case ErrorDetails.LEVEL_LOAD_ERROR:case ErrorDetails.LEVEL_LOAD_TIMEOUT:typeof(Ue==null?void 0:Ue.level)=="number"&&(ue.errorAction=this.getPlaylistRetryOrSwitchAction(ue,Ue.level));return;case ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case ErrorDetails.SUBTITLE_LOAD_ERROR:case ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:if(Ue){const Ke=Ne.levels[Ne.loadLevel];if(Ke&&(Ue.type===PlaylistContextType.AUDIO_TRACK&&Ue.groupId===Ke.audioGroupId||Ue.type===PlaylistContextType.SUBTITLE_TRACK&&Ue.groupId===Ke.textGroupId)){ue.errorAction=this.getPlaylistRetryOrSwitchAction(ue,Ne.loadLevel),ue.errorAction.action=NetworkErrorAction.SendAlternateToPenaltyBox,ue.errorAction.flags=ErrorActionFlags.MoveAllAlternatesMatchingHost;return}}return;case ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const Ke=Ne.levels[Ne.loadLevel],Ye=Ke==null?void 0:Ke.attrs["HDCP-LEVEL"];Ye&&(ue.errorAction={action:NetworkErrorAction.SendAlternateToPenaltyBox,flags:ErrorActionFlags.MoveAllAlternatesMatchingHDCP,hdcpLevel:Ye})}return;case ErrorDetails.BUFFER_ADD_CODEC_ERROR:case ErrorDetails.REMUX_ALLOC_ERROR:ue.errorAction=this.getLevelSwitchAction(ue,(_e=ue.level)!=null?_e:Ne.loadLevel);return;case ErrorDetails.INTERNAL_EXCEPTION:case ErrorDetails.BUFFER_APPENDING_ERROR:case ErrorDetails.BUFFER_APPEND_ERROR:case ErrorDetails.BUFFER_FULL_ERROR:case ErrorDetails.LEVEL_SWITCH_ERROR:case ErrorDetails.BUFFER_STALLED_ERROR:case ErrorDetails.BUFFER_SEEK_OVER_HOLE:case ErrorDetails.BUFFER_NUDGE_ON_STALL:ue.errorAction={action:NetworkErrorAction.DoNothing,flags:ErrorActionFlags.None};return}if(ue.type===ErrorTypes.KEY_SYSTEM_ERROR){const Ke=this.getVariantLevelIndex(ue.frag);ue.levelRetry=!1,ue.errorAction=this.getLevelSwitchAction(ue,Ke);return}}getPlaylistRetryOrSwitchAction(ee,ue){var pe;const _e=this.hls,Ne=getRetryConfig(_e.config.playlistLoadPolicy,ee),Ue=this.playlistError++,Ge=(pe=ee.response)==null?void 0:pe.code;if(shouldRetry(Ne,Ue,isTimeoutError(ee),Ge))return{action:NetworkErrorAction.RetryRequest,flags:ErrorActionFlags.None,retryConfig:Ne,retryCount:Ue};const Ke=this.getLevelSwitchAction(ee,ue);return Ne&&(Ke.retryConfig=Ne,Ke.retryCount=Ue),Ke}getFragRetryOrSwitchAction(ee){const ue=this.hls,pe=this.getVariantLevelIndex(ee.frag),_e=ue.levels[pe],{fragLoadPolicy:Ne,keyLoadPolicy:Ue}=ue.config,Ge=getRetryConfig(ee.details.startsWith("key")?Ue:Ne,ee),qe=ue.levels.reduce((Ze,Xe)=>Ze+Xe.fragmentError,0);if(_e){var Ke;ee.details!==ErrorDetails.FRAG_GAP&&_e.fragmentError++;const Ze=(Ke=ee.response)==null?void 0:Ke.code;if(shouldRetry(Ge,qe,isTimeoutError(ee),Ze))return{action:NetworkErrorAction.RetryRequest,flags:ErrorActionFlags.None,retryConfig:Ge,retryCount:qe}}const Ye=this.getLevelSwitchAction(ee,pe);return Ge&&(Ye.retryConfig=Ge,Ye.retryCount=qe),Ye}getLevelSwitchAction(ee,ue){const pe=this.hls;ue==null&&(ue=pe.loadLevel);const _e=this.hls.levels[ue];if(_e&&(_e.loadError++,pe.autoLevelEnabled)){var Ne,Ue;let Ge=-1;const{levels:qe,loadLevel:Ke,minAutoLevel:Ye,maxAutoLevel:Ze}=pe,Xe=(Ne=ee.frag)==null?void 0:Ne.type,{type:Je,groupId:tt}=(Ue=ee.context)!=null?Ue:{};for(let rt=qe.length;rt--;){const et=(rt+Ke)%qe.length;if(et!==Ke&&et>=Ye&&et<=Ze&&qe[et].loadError===0){const it=qe[et];if(ee.details===ErrorDetails.FRAG_GAP&&ee.frag){const nt=qe[et].details;if(nt){const st=findFragmentByPTS(ee.frag,nt.fragments,ee.frag.start);if(st!=null&&st.gap)continue}}else{if(Je===PlaylistContextType.AUDIO_TRACK&&tt===it.audioGroupId||Je===PlaylistContextType.SUBTITLE_TRACK&&tt===it.textGroupId)continue;if(Xe===PlaylistLevelType.AUDIO&&_e.audioGroupId===it.audioGroupId||Xe===PlaylistLevelType.SUBTITLE&&_e.textGroupId===it.textGroupId)continue}Ge=et;break}}if(Ge>-1&&pe.loadLevel!==Ge)return ee.levelRetry=!0,this.playlistError=0,{action:NetworkErrorAction.SendAlternateToPenaltyBox,flags:ErrorActionFlags.None,nextAutoLevel:Ge}}return{action:NetworkErrorAction.SendAlternateToPenaltyBox,flags:ErrorActionFlags.MoveAllAlternatesMatchingHost}}onErrorOut(ee,ue){var pe;switch((pe=ue.errorAction)==null?void 0:pe.action){case NetworkErrorAction.DoNothing:break;case NetworkErrorAction.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(ue),!ue.errorAction.resolved&&ue.details!==ErrorDetails.FRAG_GAP&&(ue.fatal=!0);break}if(ue.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(ee){const ue=this.hls,pe=ee.errorAction;if(!pe)return;const{flags:_e,hdcpLevel:Ne,nextAutoLevel:Ue}=pe;switch(_e){case ErrorActionFlags.None:this.switchLevel(ee,Ue);break;case ErrorActionFlags.MoveAllAlternatesMatchingHost:pe.resolved||(pe.resolved=this.redundantFailover(ee));break;case ErrorActionFlags.MoveAllAlternatesMatchingHDCP:Ne&&(ue.maxHdcpLevel=HdcpLevels[HdcpLevels.indexOf(Ne)-1],pe.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${ue.maxHdcpLevel}" or lower`);break}pe.resolved||this.switchLevel(ee,Ue)}switchLevel(ee,ue){ue!==void 0&&ee.errorAction&&(this.warn(`switching to level ${ue} after ${ee.details}`),this.hls.nextAutoLevel=ue,ee.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)}redundantFailover(ee){const{hls:ue,penalizedRenditions:pe}=this,_e=ee.parent===PlaylistLevelType.MAIN?ee.level:ue.loadLevel,Ne=ue.levels[_e],Ue=Ne.url.length,Ge=ee.frag?ee.frag.urlId:Ne.urlId;Ne.urlId===Ge&&(!ee.frag||Ne.details)&&this.penalizeRendition(Ne,ee);for(let qe=1;qe<Ue;qe++){const Ke=(Ge+qe)%Ue,Ye=pe[Ke];if(!Ye||checkExpired(Ye,ee,pe[Ge]))return this.warn(`Switching to Redundant Stream ${Ke+1}/${Ue}: "${Ne.url[Ke]}" after ${ee.details}`),this.playlistError=0,ue.levels.forEach(Ze=>{Ze.urlId=Ke}),ue.nextLoadLevel=_e,!0}return!1}penalizeRendition(ee,ue){const{penalizedRenditions:pe}=this,_e=pe[ee.urlId]||{lastErrorPerfMs:0,errors:[],details:void 0};_e.lastErrorPerfMs=performance.now(),_e.errors.push(ue),_e.details=ee.details,pe[ee.urlId]=_e}}function checkExpired(fe,ee,ue){if(performance.now()-fe.lastErrorPerfMs>RENDITION_PENALTY_DURATION_MS)return!0;const pe=fe.details;if(ee.details===ErrorDetails.FRAG_GAP&&pe&&ee.frag){const _e=ee.frag.start,Ne=findFragmentByPTS(null,pe.fragments,_e);if(Ne&&!Ne.gap)return!0}if(ue&&fe.errors.length<ue.errors.length){const _e=fe.errors[fe.errors.length-1];if(pe&&_e.frag&&ee.frag&&Math.abs(_e.frag.start-ee.frag.start)>pe.targetduration*3)return!0}return!1}class BasePlaylistController{constructor(ee,ue){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=logger.log.bind(logger,`${ue}:`),this.warn=logger.warn.bind(logger,`${ue}:`),this.hls=ee}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){clearTimeout(this.timer),this.timer=-1}startLoad(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(ee,ue){const pe=ue==null?void 0:ue.renditionReports;if(pe){let _e=-1;for(let Ne=0;Ne<pe.length;Ne++){const Ue=pe[Ne];let Ge;try{Ge=new self.URL(Ue.URI,ue.url).href}catch(qe){logger.warn(`Could not construct new URL for Rendition Report: ${qe}`),Ge=Ue.URI||""}if(Ge===ee){_e=Ne;break}else Ge===ee.substring(0,Ge.length)&&(_e=Ne)}if(_e!==-1){const Ne=pe[_e],Ue=parseInt(Ne["LAST-MSN"])||(ue==null?void 0:ue.lastPartSn);let Ge=parseInt(Ne["LAST-PART"])||(ue==null?void 0:ue.lastPartIndex);if(this.hls.config.lowLatencyMode){const qe=Math.min(ue.age-ue.partTarget,ue.targetduration);Ge>=0&&qe>ue.partTarget&&(Ge+=1)}return new HlsUrlParameters(Ue,Ge>=0?Ge:void 0,HlsSkip.No)}}}loadPlaylist(ee){this.requestScheduled===-1&&(this.requestScheduled=self.performance.now())}shouldLoadPlaylist(ee){return this.canLoad&&!!ee&&!!ee.url&&(!ee.details||ee.details.live)}shouldReloadPlaylist(ee){return this.timer===-1&&this.requestScheduled===-1&&this.shouldLoadPlaylist(ee)}playlistLoaded(ee,ue,pe){const{details:_e,stats:Ne}=ue,Ue=self.performance.now(),Ge=Ne.loading.first?Math.max(0,Ue-Ne.loading.first):0;if(_e.advancedDateTime=Date.now()-Ge,_e.live||pe!=null&&pe.live){if(_e.reloaded(pe),pe&&this.log(`live playlist ${ee} ${_e.advanced?"REFRESHED "+_e.lastPartSn+"-"+_e.lastPartIndex:_e.updated?"UPDATED":"MISSED"}`),pe&&_e.fragments.length>0&&mergeDetails(pe,_e),!this.canLoad||!_e.live)return;let qe,Ke,Ye;if(_e.canBlockReload&&_e.endSN&&_e.advanced){const et=this.hls.config.lowLatencyMode,it=_e.lastPartSn,nt=_e.endSN,st=_e.lastPartIndex,lt=st!==-1,_r=it===nt,jr=et?0:st;lt?(Ke=_r?nt+1:it,Ye=_r?jr:st+1):Ke=nt+1;const Nr=_e.age,Wr=Nr+_e.ageHeader;let ri=Math.min(Wr-_e.partTarget,_e.targetduration*1.5);if(ri>0){if(pe&&ri>pe.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${pe.tuneInGoal} to: ${ri} with playlist age: ${_e.age}`),ri=0;else{const Xr=Math.floor(ri/_e.targetduration);if(Ke+=Xr,Ye!==void 0){const Gr=Math.round(ri%_e.targetduration/_e.partTarget);Ye+=Gr}this.log(`CDN Tune-in age: ${_e.ageHeader}s last advanced ${Nr.toFixed(2)}s goal: ${ri} skip sn ${Xr} to part ${Ye}`)}_e.tuneInGoal=ri}if(qe=this.getDeliveryDirectives(_e,ue.deliveryDirectives,Ke,Ye),et||!_r){this.loadPlaylist(qe);return}}else(_e.canBlockReload||_e.canSkipUntil)&&(qe=this.getDeliveryDirectives(_e,ue.deliveryDirectives,Ke,Ye));const Ze=this.hls.mainForwardBufferInfo,Xe=Ze?Ze.end-Ze.len:0,Je=(_e.edge-Xe)*1e3,tt=computeReloadInterval(_e,Je);_e.updated&&Ue>this.requestScheduled+tt&&(this.requestScheduled=Ne.loading.start),Ke!==void 0&&_e.canBlockReload?this.requestScheduled=Ne.loading.first+tt-(_e.partTarget*1e3||1e3):this.requestScheduled===-1||this.requestScheduled+tt<Ue?this.requestScheduled=Ue:this.requestScheduled-Ue<=0&&(this.requestScheduled+=tt);let rt=this.requestScheduled-Ue;rt=Math.max(0,rt),this.log(`reload live playlist ${ee} in ${Math.round(rt)} ms`),this.timer=self.setTimeout(()=>this.loadPlaylist(qe),rt)}else this.clearTimer()}getDeliveryDirectives(ee,ue,pe,_e){let Ne=getSkipValue(ee,pe);return ue!=null&&ue.skip&&ee.deltaUpdateFailed&&(pe=ue.msn,_e=ue.part,Ne=HlsSkip.No),new HlsUrlParameters(pe,_e,Ne)}checkRetry(ee){const ue=ee.details,pe=isTimeoutError(ee),_e=ee.errorAction,{action:Ne,retryCount:Ue=0,retryConfig:Ge}=_e||{},qe=!!_e&&!!Ge&&(Ne===NetworkErrorAction.RetryRequest||!_e.resolved&&Ne===NetworkErrorAction.SendAlternateToPenaltyBox);if(qe){var Ke;if(this.requestScheduled=-1,Ue>=Ge.maxNumRetry)return!1;if(pe&&(Ke=ee.context)!=null&&Ke.deliveryDirectives)this.warn(`Retrying playlist loading ${Ue+1}/${Ge.maxNumRetry} after "${ue}" without delivery-directives`),this.loadPlaylist();else{const Ye=getRetryDelay(Ge,Ue);this.timer=self.setTimeout(()=>this.loadPlaylist(),Ye),this.warn(`Retrying playlist loading ${Ue+1}/${Ge.maxNumRetry} after "${ue}" in ${Ye}ms`)}ee.levelRetry=!0,_e.resolved=!0}return qe}}let chromeOrFirefox;class LevelController extends BasePlaylistController{constructor(ee,ue){super(ee,"[level-controller]"),this._levels=[],this._firstLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=ue,this._registerListeners()}_registerListeners(){const{hls:ee}=this;ee.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),ee.on(Events.MANIFEST_LOADED,this.onManifestLoaded,this),ee.on(Events.LEVEL_LOADED,this.onLevelLoaded,this),ee.on(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),ee.on(Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),ee.on(Events.FRAG_LOADED,this.onFragLoaded,this),ee.on(Events.ERROR,this.onError,this)}_unregisterListeners(){const{hls:ee}=this;ee.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),ee.off(Events.MANIFEST_LOADED,this.onManifestLoaded,this),ee.off(Events.LEVEL_LOADED,this.onLevelLoaded,this),ee.off(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),ee.off(Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),ee.off(Events.FRAG_LOADED,this.onFragLoaded,this),ee.off(Events.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}startLoad(){this._levels.forEach(ue=>{ue.loadError=0,ue.fragmentError=0}),super.startLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[]}onManifestLoading(ee,ue){this.resetLevels()}onManifestLoaded(ee,ue){const pe=[],_e={};let Ne;ue.levels.forEach(Ue=>{var Ge;const qe=Ue.attrs;((Ge=Ue.audioCodec)==null?void 0:Ge.indexOf("mp4a.40.34"))!==-1&&(chromeOrFirefox||(chromeOrFirefox=/chrome|firefox/i.test(navigator.userAgent)),chromeOrFirefox&&(Ue.audioCodec=void 0));const{AUDIO:Ke,CODECS:Ye,"FRAME-RATE":Ze,"PATHWAY-ID":Xe,RESOLUTION:Je,SUBTITLES:tt}=qe,et=`${`${Xe||"."}-`}${Ue.bitrate}-${Je}-${Ze}-${Ye}`;Ne=_e[et],Ne?Ne.addFallback(Ue):(Ne=new Level(Ue),_e[et]=Ne,pe.push(Ne)),addGroupId(Ne,"audio",Ke),addGroupId(Ne,"text",tt)}),this.filterAndSortMediaOptions(pe,ue)}filterAndSortMediaOptions(ee,ue){let pe=[],_e=[],Ne=!1,Ue=!1,Ge=!1,qe=ee.filter(({audioCodec:Je,videoCodec:tt,width:rt,height:et,unknownCodecs:it})=>(Ne||(Ne=!!(rt&&et)),Ue||(Ue=!!tt),Ge||(Ge=!!Je),!(it!=null&&it.length)&&(!Je||isCodecSupportedInMp4(Je,"audio"))&&(!tt||isCodecSupportedInMp4(tt,"video"))));if((Ne||Ue)&&Ge&&(qe=qe.filter(({videoCodec:Je,width:tt,height:rt})=>!!Je||!!(tt&&rt))),qe.length===0){Promise.resolve().then(()=>{if(this.hls){const Je=new Error("no level with compatible codecs found in manifest");this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:ue.url,error:Je,reason:Je.message})}});return}ue.audioTracks&&(pe=ue.audioTracks.filter(Je=>!Je.audioCodec||isCodecSupportedInMp4(Je.audioCodec,"audio")),assignTrackIdsByGroup(pe)),ue.subtitles&&(_e=ue.subtitles,assignTrackIdsByGroup(_e));const Ke=qe.slice(0);qe.sort((Je,tt)=>Je.attrs["HDCP-LEVEL"]!==tt.attrs["HDCP-LEVEL"]?(Je.attrs["HDCP-LEVEL"]||"")>(tt.attrs["HDCP-LEVEL"]||"")?1:-1:Je.bitrate!==tt.bitrate?Je.bitrate-tt.bitrate:Je.attrs["FRAME-RATE"]!==tt.attrs["FRAME-RATE"]?Je.attrs.decimalFloatingPoint("FRAME-RATE")-tt.attrs.decimalFloatingPoint("FRAME-RATE"):Je.attrs.SCORE!==tt.attrs.SCORE?Je.attrs.decimalFloatingPoint("SCORE")-tt.attrs.decimalFloatingPoint("SCORE"):Ne&&Je.height!==tt.height?Je.height-tt.height:0);let Ye=Ke[0];if(this.steering&&(qe=this.steering.filterParsedLevels(qe),qe.length!==Ke.length)){for(let Je=0;Je<Ke.length;Je++)if(Ke[Je].pathwayId===qe[0].pathwayId){Ye=Ke[Je];break}}this._levels=qe;for(let Je=0;Je<qe.length;Je++)if(qe[Je]===Ye){this._firstLevel=Je,this.log(`manifest loaded, ${qe.length} level(s) found, first bitrate: ${Ye.bitrate}`);break}const Ze=Ge&&!Ue,Xe={levels:qe,audioTracks:pe,subtitleTracks:_e,sessionData:ue.sessionData,sessionKeys:ue.sessionKeys,firstLevel:this._firstLevel,stats:ue.stats,audio:Ge,video:Ue,altAudio:!Ze&&pe.some(Je=>!!Je.url)};this.hls.trigger(Events.MANIFEST_PARSED,Xe),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}get levels(){return this._levels.length===0?null:this._levels}get level(){return this.currentLevelIndex}set level(ee){const ue=this._levels;if(ue.length===0)return;if(ee<0||ee>=ue.length){const Ye=new Error("invalid level idx"),Ze=ee<0;if(this.hls.trigger(Events.ERROR,{type:ErrorTypes.OTHER_ERROR,details:ErrorDetails.LEVEL_SWITCH_ERROR,level:ee,fatal:Ze,error:Ye,reason:Ye.message}),Ze)return;ee=Math.min(ee,ue.length-1)}const pe=this.currentLevelIndex,_e=this.currentLevel,Ne=_e?_e.attrs["PATHWAY-ID"]:void 0,Ue=ue[ee],Ge=Ue.attrs["PATHWAY-ID"];if(this.currentLevelIndex=ee,this.currentLevel=Ue,pe===ee&&Ue.details&&_e&&Ne===Ge)return;this.log(`Switching to level ${ee}${Ge?" with Pathway "+Ge:""} from level ${pe}${Ne?" with Pathway "+Ne:""}`);const qe=_extends({},Ue,{level:ee,maxBitrate:Ue.maxBitrate,attrs:Ue.attrs,uri:Ue.uri,urlId:Ue.urlId});delete qe._attrs,delete qe._urlId,this.hls.trigger(Events.LEVEL_SWITCHING,qe);const Ke=Ue.details;if(!Ke||Ke.live){const Ye=this.switchParams(Ue.uri,_e==null?void 0:_e.details);this.loadPlaylist(Ye)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(ee){this.manualLevelIndex=ee,this._startLevel===void 0&&(this._startLevel=ee),ee!==-1&&(this.level=ee)}get firstLevel(){return this._firstLevel}set firstLevel(ee){this._firstLevel=ee}get startLevel(){if(this._startLevel===void 0){const ee=this.hls.config.startLevel;return ee!==void 0?ee:this._firstLevel}else return this._startLevel}set startLevel(ee){this._startLevel=ee}onError(ee,ue){ue.fatal||!ue.context||ue.context.type===PlaylistContextType.LEVEL&&ue.context.level===this.level&&this.checkRetry(ue)}onFragLoaded(ee,{frag:ue}){if(ue!==void 0&&ue.type===PlaylistLevelType.MAIN){const pe=this._levels[ue.level];pe!==void 0&&(pe.loadError=0)}}onLevelLoaded(ee,ue){var pe;const{level:_e,details:Ne}=ue,Ue=this._levels[_e];if(!Ue){var Ge;this.warn(`Invalid level index ${_e}`),(Ge=ue.deliveryDirectives)!=null&&Ge.skip&&(Ne.deltaUpdateFailed=!0);return}_e===this.currentLevelIndex?(Ue.fragmentError===0&&(Ue.loadError=0),this.playlistLoaded(_e,ue,Ue.details)):(pe=ue.deliveryDirectives)!=null&&pe.skip&&(Ne.deltaUpdateFailed=!0)}onAudioTrackSwitched(ee,ue){const pe=this.currentLevel;if(!pe)return;const _e=this.hls.audioTracks[ue.id].groupId;if(pe.audioGroupIds&&pe.audioGroupId!==_e){let Ne=-1;for(let Ue=0;Ue<pe.audioGroupIds.length;Ue++)if(pe.audioGroupIds[Ue]===_e){Ne=Ue;break}Ne!==-1&&Ne!==pe.urlId&&(pe.urlId=Ne,this.canLoad&&this.startLoad())}}loadPlaylist(ee){super.loadPlaylist();const ue=this.currentLevelIndex,pe=this.currentLevel;if(pe&&this.shouldLoadPlaylist(pe)){const _e=pe.urlId;let Ne=pe.uri;if(ee)try{Ne=ee.addDirectives(Ne)}catch(Ge){this.warn(`Could not construct new URL with HLS Delivery Directives: ${Ge}`)}const Ue=pe.attrs["PATHWAY-ID"];this.log(`Loading level index ${ue}${(ee==null?void 0:ee.msn)!==void 0?" at sn "+ee.msn+" part "+ee.part:""} with${Ue?" Pathway "+Ue:""} URI ${_e+1}/${pe.url.length} ${Ne}`),this.clearTimer(),this.hls.trigger(Events.LEVEL_LOADING,{url:Ne,level:ue,id:_e,deliveryDirectives:ee||null})}}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(ee){this.level=ee,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=ee)}removeLevel(ee,ue){const pe=(Ne,Ue)=>Ue!==ue,_e=this._levels.filter((Ne,Ue)=>Ue!==ee?!0:Ne.url.length>1&&ue!==void 0?(Ne.url=Ne.url.filter(pe),Ne.audioGroupIds&&(Ne.audioGroupIds=Ne.audioGroupIds.filter(pe)),Ne.textGroupIds&&(Ne.textGroupIds=Ne.textGroupIds.filter(pe)),Ne.urlId=0,!0):(this.steering&&this.steering.removeLevel(Ne),!1));this.hls.trigger(Events.LEVELS_UPDATED,{levels:_e})}onLevelsUpdated(ee,{levels:ue}){ue.forEach((pe,_e)=>{const{details:Ne}=pe;Ne!=null&&Ne.fragments&&Ne.fragments.forEach(Ue=>{Ue.level=_e})}),this._levels=ue}}function addGroupId(fe,ee,ue){ue&&(ee==="audio"?(fe.audioGroupIds||(fe.audioGroupIds=[]),fe.audioGroupIds[fe.url.length-1]=ue):ee==="text"&&(fe.textGroupIds||(fe.textGroupIds=[]),fe.textGroupIds[fe.url.length-1]=ue))}function assignTrackIdsByGroup(fe){const ee={};fe.forEach(ue=>{const pe=ue.groupId||"";ue.id=ee[pe]=ee[pe]||0,ee[pe]++})}var FragmentState={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class FragmentTracker{constructor(ee){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=ee,this._registerListeners()}_registerListeners(){const{hls:ee}=this;ee.on(Events.BUFFER_APPENDED,this.onBufferAppended,this),ee.on(Events.FRAG_BUFFERED,this.onFragBuffered,this),ee.on(Events.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){const{hls:ee}=this;ee.off(Events.BUFFER_APPENDED,this.onBufferAppended,this),ee.off(Events.FRAG_BUFFERED,this.onFragBuffered,this),ee.off(Events.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(ee,ue){const pe=this.activePartLists[ue];if(pe)for(let _e=pe.length;_e--;){const Ne=pe[_e];if(!Ne)break;const Ue=Ne.end;if(Ne.start<=ee&&Ue!==null&&ee<=Ue)return Ne}return this.getBufferedFrag(ee,ue)}getBufferedFrag(ee,ue){const{fragments:pe}=this,_e=Object.keys(pe);for(let Ne=_e.length;Ne--;){const Ue=pe[_e[Ne]];if((Ue==null?void 0:Ue.body.type)===ue&&Ue.buffered){const Ge=Ue.body;if(Ge.start<=ee&&ee<=Ge.end)return Ge}}return null}detectEvictedFragments(ee,ue,pe,_e){this.timeRanges&&(this.timeRanges[ee]=ue);const Ne=(_e==null?void 0:_e.fragment.sn)||-1;Object.keys(this.fragments).forEach(Ue=>{const Ge=this.fragments[Ue];if(!Ge||Ne>=Ge.body.sn)return;if(!Ge.buffered&&!Ge.loaded){Ge.body.type===pe&&this.removeFragment(Ge.body);return}const qe=Ge.range[ee];qe&&qe.time.some(Ke=>{const Ye=!this.isTimeBuffered(Ke.startPTS,Ke.endPTS,ue);return Ye&&this.removeFragment(Ge.body),Ye})})}detectPartialFragments(ee){const ue=this.timeRanges,{frag:pe,part:_e}=ee;if(!ue||pe.sn==="initSegment")return;const Ne=getFragmentKey(pe),Ue=this.fragments[Ne];if(!Ue||Ue.buffered&&pe.gap)return;const Ge=!pe.relurl;Object.keys(ue).forEach(qe=>{const Ke=pe.elementaryStreams[qe];if(!Ke)return;const Ye=ue[qe],Ze=Ge||Ke.partial===!0;Ue.range[qe]=this.getBufferedTimes(pe,_e,Ze,Ye)}),Ue.loaded=null,Object.keys(Ue.range).length?(Ue.buffered=!0,(Ue.body.endList=pe.endList||Ue.body.endList)&&(this.endListFragments[Ue.body.type]=Ue),isPartial(Ue)||this.removeParts(pe.sn-1,pe.type)):this.removeFragment(Ue.body)}removeParts(ee,ue){const pe=this.activePartLists[ue];pe&&(this.activePartLists[ue]=pe.filter(_e=>_e.fragment.sn>=ee))}fragBuffered(ee,ue){const pe=getFragmentKey(ee);let _e=this.fragments[pe];!_e&&ue&&(_e=this.fragments[pe]={body:ee,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},ee.gap&&(this.hasGaps=!0)),_e&&(_e.loaded=null,_e.buffered=!0)}getBufferedTimes(ee,ue,pe,_e){const Ne={time:[],partial:pe},Ue=ee.start,Ge=ee.end,qe=ee.minEndPTS||Ge,Ke=ee.maxStartPTS||Ue;for(let Ye=0;Ye<_e.length;Ye++){const Ze=_e.start(Ye)-this.bufferPadding,Xe=_e.end(Ye)+this.bufferPadding;if(Ke>=Ze&&qe<=Xe){Ne.time.push({startPTS:Math.max(Ue,_e.start(Ye)),endPTS:Math.min(Ge,_e.end(Ye))});break}else if(Ue<Xe&&Ge>Ze)Ne.partial=!0,Ne.time.push({startPTS:Math.max(Ue,_e.start(Ye)),endPTS:Math.min(Ge,_e.end(Ye))});else if(Ge<=Ze)break}return Ne}getPartialFragment(ee){let ue=null,pe,_e,Ne,Ue=0;const{bufferPadding:Ge,fragments:qe}=this;return Object.keys(qe).forEach(Ke=>{const Ye=qe[Ke];Ye&&isPartial(Ye)&&(_e=Ye.body.start-Ge,Ne=Ye.body.end+Ge,ee>=_e&&ee<=Ne&&(pe=Math.min(ee-_e,Ne-ee),Ue<=pe&&(ue=Ye.body,Ue=pe)))}),ue}isEndListAppended(ee){const ue=this.endListFragments[ee];return ue!==void 0&&(ue.buffered||isPartial(ue))}getState(ee){const ue=getFragmentKey(ee),pe=this.fragments[ue];return pe?pe.buffered?isPartial(pe)?FragmentState.PARTIAL:FragmentState.OK:FragmentState.APPENDING:FragmentState.NOT_LOADED}isTimeBuffered(ee,ue,pe){let _e,Ne;for(let Ue=0;Ue<pe.length;Ue++){if(_e=pe.start(Ue)-this.bufferPadding,Ne=pe.end(Ue)+this.bufferPadding,ee>=_e&&ue<=Ne)return!0;if(ue<=_e)return!1}return!1}onFragLoaded(ee,ue){const{frag:pe,part:_e}=ue;if(pe.sn==="initSegment"||pe.bitrateTest)return;const Ne=_e?null:ue,Ue=getFragmentKey(pe);this.fragments[Ue]={body:pe,appendedPTS:null,loaded:Ne,buffered:!1,range:Object.create(null)}}onBufferAppended(ee,ue){const{frag:pe,part:_e,timeRanges:Ne}=ue;if(pe.sn==="initSegment")return;const Ue=pe.type;if(_e){let Ge=this.activePartLists[Ue];Ge||(this.activePartLists[Ue]=Ge=[]),Ge.push(_e)}this.timeRanges=Ne,Object.keys(Ne).forEach(Ge=>{const qe=Ne[Ge];this.detectEvictedFragments(Ge,qe,Ue,_e)})}onFragBuffered(ee,ue){this.detectPartialFragments(ue)}hasFragment(ee){const ue=getFragmentKey(ee);return!!this.fragments[ue]}hasParts(ee){var ue;return!!((ue=this.activePartLists[ee])!=null&&ue.length)}removeFragmentsInRange(ee,ue,pe,_e,Ne){_e&&!this.hasGaps||Object.keys(this.fragments).forEach(Ue=>{const Ge=this.fragments[Ue];if(!Ge)return;const qe=Ge.body;qe.type!==pe||_e&&!qe.gap||qe.start<ue&&qe.end>ee&&(Ge.buffered||Ne)&&this.removeFragment(qe)})}removeFragment(ee){const ue=getFragmentKey(ee);ee.stats.loaded=0,ee.clearElementaryStreamInfo();const pe=this.activePartLists[ee.type];if(pe){const _e=ee.sn;this.activePartLists[ee.type]=pe.filter(Ne=>Ne.fragment.sn!==_e)}delete this.fragments[ue],ee.endList&&delete this.endListFragments[ee.type]}removeAllFragments(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1}}function isPartial(fe){var ee,ue,pe;return fe.buffered&&(fe.body.gap||((ee=fe.range.video)==null?void 0:ee.partial)||((ue=fe.range.audio)==null?void 0:ue.partial)||((pe=fe.range.audiovideo)==null?void 0:pe.partial))}function getFragmentKey(fe){return`${fe.type}_${fe.level}_${fe.urlId}_${fe.sn}`}const MIN_CHUNK_SIZE=Math.pow(2,17);class FragmentLoader{constructor(ee){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=ee}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(ee,ue){const pe=ee.url;if(!pe)return Promise.reject(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:ee,error:new Error(`Fragment does not have a ${pe?"part list":"url"}`),networkDetails:null}));this.abort();const _e=this.config,Ne=_e.fLoader,Ue=_e.loader;return new Promise((Ge,qe)=>{if(this.loader&&this.loader.destroy(),ee.gap)if(ee.tagList.some(Je=>Je[0]==="GAP")){qe(createGapLoadError(ee));return}else ee.gap=!1;const Ke=this.loader=ee.loader=Ne?new Ne(_e):new Ue(_e),Ye=createLoaderContext(ee),Ze=getLoaderConfigWithoutReties(_e.fragLoadPolicy.default),Xe={loadPolicy:Ze,timeout:Ze.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:ee.sn==="initSegment"?1/0:MIN_CHUNK_SIZE};ee.stats=Ke.stats,Ke.load(Ye,Xe,{onSuccess:(Je,tt,rt,et)=>{this.resetLoader(ee,Ke);let it=Je.data;rt.resetIV&&ee.decryptdata&&(ee.decryptdata.iv=new Uint8Array(it.slice(0,16)),it=it.slice(16)),Ge({frag:ee,part:null,payload:it,networkDetails:et})},onError:(Je,tt,rt,et)=>{this.resetLoader(ee,Ke),qe(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:ee,response:_objectSpread2({url:pe,data:void 0},Je),error:new Error(`HTTP Error ${Je.code} ${Je.text}`),networkDetails:rt,stats:et}))},onAbort:(Je,tt,rt)=>{this.resetLoader(ee,Ke),qe(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:ee,error:new Error("Aborted"),networkDetails:rt,stats:Je}))},onTimeout:(Je,tt,rt)=>{this.resetLoader(ee,Ke),qe(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:ee,error:new Error(`Timeout after ${Xe.timeout}ms`),networkDetails:rt,stats:Je}))},onProgress:(Je,tt,rt,et)=>{ue&&ue({frag:ee,part:null,payload:rt,networkDetails:et})}})})}loadPart(ee,ue,pe){this.abort();const _e=this.config,Ne=_e.fLoader,Ue=_e.loader;return new Promise((Ge,qe)=>{if(this.loader&&this.loader.destroy(),ee.gap||ue.gap){qe(createGapLoadError(ee,ue));return}const Ke=this.loader=ee.loader=Ne?new Ne(_e):new Ue(_e),Ye=createLoaderContext(ee,ue),Ze=getLoaderConfigWithoutReties(_e.fragLoadPolicy.default),Xe={loadPolicy:Ze,timeout:Ze.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:MIN_CHUNK_SIZE};ue.stats=Ke.stats,Ke.load(Ye,Xe,{onSuccess:(Je,tt,rt,et)=>{this.resetLoader(ee,Ke),this.updateStatsFromPart(ee,ue);const it={frag:ee,part:ue,payload:Je.data,networkDetails:et};pe(it),Ge(it)},onError:(Je,tt,rt,et)=>{this.resetLoader(ee,Ke),qe(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:ee,part:ue,response:_objectSpread2({url:Ye.url,data:void 0},Je),error:new Error(`HTTP Error ${Je.code} ${Je.text}`),networkDetails:rt,stats:et}))},onAbort:(Je,tt,rt)=>{ee.stats.aborted=ue.stats.aborted,this.resetLoader(ee,Ke),qe(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:ee,part:ue,error:new Error("Aborted"),networkDetails:rt,stats:Je}))},onTimeout:(Je,tt,rt)=>{this.resetLoader(ee,Ke),qe(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:ee,part:ue,error:new Error(`Timeout after ${Xe.timeout}ms`),networkDetails:rt,stats:Je}))}})})}updateStatsFromPart(ee,ue){const pe=ee.stats,_e=ue.stats,Ne=_e.total;if(pe.loaded+=_e.loaded,Ne){const qe=Math.round(ee.duration/ue.duration),Ke=Math.min(Math.round(pe.loaded/Ne),qe),Ze=(qe-Ke)*Math.round(pe.loaded/Ke);pe.total=pe.loaded+Ze}else pe.total=Math.max(pe.loaded,pe.total);const Ue=pe.loading,Ge=_e.loading;Ue.start?Ue.first+=Ge.first-Ge.start:(Ue.start=Ge.start,Ue.first=Ge.first),Ue.end=Ge.end}resetLoader(ee,ue){ee.loader=null,this.loader===ue&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),ue.destroy()}}function createLoaderContext(fe,ee=null){const ue=ee||fe,pe={frag:fe,part:ee,responseType:"arraybuffer",url:ue.url,headers:{},rangeStart:0,rangeEnd:0},_e=ue.byteRangeStartOffset,Ne=ue.byteRangeEndOffset;if(isFiniteNumber(_e)&&isFiniteNumber(Ne)){var Ue;let Ge=_e,qe=Ne;if(fe.sn==="initSegment"&&((Ue=fe.decryptdata)==null?void 0:Ue.method)==="AES-128"){const Ke=Ne-_e;Ke%16&&(qe=Ne+(16-Ke%16)),_e!==0&&(pe.resetIV=!0,Ge=_e-16)}pe.rangeStart=Ge,pe.rangeEnd=qe}return pe}function createGapLoadError(fe,ee){const ue=new Error(`GAP ${fe.gap?"tag":"attribute"} found`),pe={type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_GAP,fatal:!1,frag:fe,error:ue,networkDetails:null};return ee&&(pe.part=ee),(ee||fe).stats.aborted=!0,new LoadError(pe)}class LoadError extends Error{constructor(ee){super(ee.error.message),this.data=void 0,this.data=ee}}class KeyLoader{constructor(ee){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=ee}abort(ee){for(const ue in this.keyUriToKeyInfo){const pe=this.keyUriToKeyInfo[ue].loader;if(pe){if(ee&&ee!==pe.context.frag.type)return;pe.abort()}}}detach(){for(const ee in this.keyUriToKeyInfo){const ue=this.keyUriToKeyInfo[ee];(ue.mediaKeySessionContext||ue.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[ee]}}destroy(){this.detach();for(const ee in this.keyUriToKeyInfo){const ue=this.keyUriToKeyInfo[ee].loader;ue&&ue.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(ee,ue=ErrorDetails.KEY_LOAD_ERROR,pe,_e,Ne){return new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ue,fatal:!1,frag:ee,response:Ne,error:pe,networkDetails:_e})}loadClear(ee,ue){if(this.emeController&&this.config.emeEnabled){const{sn:pe,cc:_e}=ee;for(let Ne=0;Ne<ue.length;Ne++){const Ue=ue[Ne];if(_e<=Ue.cc&&(pe==="initSegment"||Ue.sn==="initSegment"||pe<Ue.sn)){this.emeController.selectKeySystemFormat(Ue).then(Ge=>{Ue.setKeyFormat(Ge)});break}}}}load(ee){return!ee.decryptdata&&ee.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(ee).then(ue=>this.loadInternal(ee,ue)):this.loadInternal(ee)}loadInternal(ee,ue){var pe,_e;ue&&ee.setKeyFormat(ue);const Ne=ee.decryptdata;if(!Ne){const Ke=new Error(ue?`Expected frag.decryptdata to be defined after setting format ${ue}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(ee,ErrorDetails.KEY_LOAD_ERROR,Ke))}const Ue=Ne.uri;if(!Ue)return Promise.reject(this.createKeyLoadError(ee,ErrorDetails.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${Ue}"`)));let Ge=this.keyUriToKeyInfo[Ue];if((pe=Ge)!=null&&pe.decryptdata.key)return Ne.key=Ge.decryptdata.key,Promise.resolve({frag:ee,keyInfo:Ge});if((_e=Ge)!=null&&_e.keyLoadPromise){var qe;switch((qe=Ge.mediaKeySessionContext)==null?void 0:qe.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return Ge.keyLoadPromise.then(Ke=>(Ne.key=Ke.keyInfo.decryptdata.key,{frag:ee,keyInfo:Ge}))}}switch(Ge=this.keyUriToKeyInfo[Ue]={decryptdata:Ne,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},Ne.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return Ne.keyFormat==="identity"?this.loadKeyHTTP(Ge,ee):this.loadKeyEME(Ge,ee);case"AES-128":return this.loadKeyHTTP(Ge,ee);default:return Promise.reject(this.createKeyLoadError(ee,ErrorDetails.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${Ne.method}"`)))}}loadKeyEME(ee,ue){const pe={frag:ue,keyInfo:ee};if(this.emeController&&this.config.emeEnabled){const _e=this.emeController.loadKey(pe);if(_e)return(ee.keyLoadPromise=_e.then(Ne=>(ee.mediaKeySessionContext=Ne,pe))).catch(Ne=>{throw ee.keyLoadPromise=null,Ne})}return Promise.resolve(pe)}loadKeyHTTP(ee,ue){const pe=this.config,_e=pe.loader,Ne=new _e(pe);return ue.keyLoader=ee.loader=Ne,ee.keyLoadPromise=new Promise((Ue,Ge)=>{const qe={keyInfo:ee,frag:ue,responseType:"arraybuffer",url:ee.decryptdata.uri},Ke=pe.keyLoadPolicy.default,Ye={loadPolicy:Ke,timeout:Ke.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},Ze={onSuccess:(Xe,Je,tt,rt)=>{const{frag:et,keyInfo:it,url:nt}=tt;if(!et.decryptdata||it!==this.keyUriToKeyInfo[nt])return Ge(this.createKeyLoadError(et,ErrorDetails.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),rt));it.decryptdata.key=et.decryptdata.key=new Uint8Array(Xe.data),et.keyLoader=null,it.loader=null,Ue({frag:et,keyInfo:it})},onError:(Xe,Je,tt,rt)=>{this.resetLoader(Je),Ge(this.createKeyLoadError(ue,ErrorDetails.KEY_LOAD_ERROR,new Error(`HTTP Error ${Xe.code} loading key ${Xe.text}`),tt,_objectSpread2({url:qe.url,data:void 0},Xe)))},onTimeout:(Xe,Je,tt)=>{this.resetLoader(Je),Ge(this.createKeyLoadError(ue,ErrorDetails.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),tt))},onAbort:(Xe,Je,tt)=>{this.resetLoader(Je),Ge(this.createKeyLoadError(ue,ErrorDetails.INTERNAL_ABORTED,new Error("key loading aborted"),tt))}};Ne.load(qe,Ye,Ze)})}resetLoader(ee){const{frag:ue,keyInfo:pe,url:_e}=ee,Ne=pe.loader;ue.keyLoader===Ne&&(ue.keyLoader=null,pe.loader=null),delete this.keyUriToKeyInfo[_e],Ne&&Ne.destroy()}}class TaskLoop{constructor(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(ee){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,ee),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}const noopBuffered={length:0,start:()=>0,end:()=>0};class BufferHelper{static isBuffered(ee,ue){try{if(ee){const pe=BufferHelper.getBuffered(ee);for(let _e=0;_e<pe.length;_e++)if(ue>=pe.start(_e)&&ue<=pe.end(_e))return!0}}catch{}return!1}static bufferInfo(ee,ue,pe){try{if(ee){const _e=BufferHelper.getBuffered(ee),Ne=[];let Ue;for(Ue=0;Ue<_e.length;Ue++)Ne.push({start:_e.start(Ue),end:_e.end(Ue)});return this.bufferedInfo(Ne,ue,pe)}}catch{}return{len:0,start:ue,end:ue,nextStart:void 0}}static bufferedInfo(ee,ue,pe){ue=Math.max(0,ue),ee.sort(function(Ke,Ye){const Ze=Ke.start-Ye.start;return Ze||Ye.end-Ke.end});let _e=[];if(pe)for(let Ke=0;Ke<ee.length;Ke++){const Ye=_e.length;if(Ye){const Ze=_e[Ye-1].end;ee[Ke].start-Ze<pe?ee[Ke].end>Ze&&(_e[Ye-1].end=ee[Ke].end):_e.push(ee[Ke])}else _e.push(ee[Ke])}else _e=ee;let Ne=0,Ue,Ge=ue,qe=ue;for(let Ke=0;Ke<_e.length;Ke++){const Ye=_e[Ke].start,Ze=_e[Ke].end;if(ue+pe>=Ye&&ue<Ze)Ge=Ye,qe=Ze,Ne=qe-ue;else if(ue+pe<Ye){Ue=Ye;break}}return{len:Ne,start:Ge||0,end:qe||0,nextStart:Ue}}static getBuffered(ee){try{return ee.buffered}catch(ue){return logger.log("failed to get media.buffered",ue),noopBuffered}}}class ChunkMetadata{constructor(ee,ue,pe,_e=0,Ne=-1,Ue=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=getNewPerformanceTiming(),this.buffering={audio:getNewPerformanceTiming(),video:getNewPerformanceTiming(),audiovideo:getNewPerformanceTiming()},this.level=ee,this.sn=ue,this.id=pe,this.size=_e,this.part=Ne,this.partial=Ue}}function getNewPerformanceTiming(){return{start:0,executeStart:0,executeEnd:0,end:0}}function findFirstFragWithCC(fe,ee){let ue=null;for(let pe=0,_e=fe.length;pe<_e;pe++){const Ne=fe[pe];if(Ne&&Ne.cc===ee){ue=Ne;break}}return ue}function shouldAlignOnDiscontinuities(fe,ee,ue){return!!(ee.details&&(ue.endCC>ue.startCC||fe&&fe.cc<ue.startCC))}function findDiscontinuousReferenceFrag(fe,ee,ue=0){const pe=fe.fragments,_e=ee.fragments;if(!_e.length||!pe.length){logger.log("No fragments to align");return}const Ne=findFirstFragWithCC(pe,_e[0].cc);if(!Ne||Ne&&!Ne.startPTS){logger.log("No frag in previous level to align on");return}return Ne}function adjustFragmentStart(fe,ee){if(fe){const ue=fe.start+ee;fe.start=fe.startPTS=ue,fe.endPTS=ue+fe.duration}}function adjustSlidingStart(fe,ee){const ue=ee.fragments;for(let pe=0,_e=ue.length;pe<_e;pe++)adjustFragmentStart(ue[pe],fe);ee.fragmentHint&&adjustFragmentStart(ee.fragmentHint,fe),ee.alignedSliding=!0}function alignStream(fe,ee,ue){ee&&(alignDiscontinuities(fe,ue,ee),!ue.alignedSliding&&ee.details&&alignPDT(ue,ee.details),!ue.alignedSliding&&ee.details&&!ue.skippedSegments&&adjustSliding(ee.details,ue))}function alignDiscontinuities(fe,ee,ue){if(shouldAlignOnDiscontinuities(fe,ue,ee)){const pe=findDiscontinuousReferenceFrag(ue.details,ee);pe&&isFiniteNumber(pe.start)&&(logger.log(`Adjusting PTS using last level due to CC increase within current level ${ee.url}`),adjustSlidingStart(pe.start,ee))}}function alignPDT(fe,ee){if(!ee.fragments.length||!fe.hasProgramDateTime||!ee.hasProgramDateTime)return;const ue=ee.fragments[0].programDateTime,pe=fe.fragments[0].programDateTime,_e=(pe-ue)/1e3+ee.fragments[0].start;_e&&isFiniteNumber(_e)&&(logger.log(`Adjusting PTS using programDateTime delta ${pe-ue}ms, sliding:${_e.toFixed(3)} ${fe.url} `),adjustSlidingStart(_e,fe))}function alignMediaPlaylistByPDT(fe,ee){if(!fe.hasProgramDateTime||!ee.hasProgramDateTime)return;const ue=fe.fragments,pe=ee.fragments;if(!ue.length||!pe.length)return;const _e=Math.round(pe.length/2)-1,Ne=pe[_e],Ue=findFirstFragWithCC(ue,Ne.cc)||ue[Math.round(ue.length/2)-1],Ge=Ne.programDateTime,qe=Ue.programDateTime;if(Ge===null||qe===null)return;const Ke=(qe-Ge)/1e3-(Ue.start-Ne.start);adjustSlidingStart(Ke,fe)}class AESCrypto{constructor(ee,ue){this.subtle=void 0,this.aesIV=void 0,this.subtle=ee,this.aesIV=ue}decrypt(ee,ue){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},ue,ee)}}class FastAESKey{constructor(ee,ue){this.subtle=void 0,this.key=void 0,this.subtle=ee,this.key=ue}expandKey(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}function removePadding(fe){const ee=fe.byteLength,ue=ee&&new DataView(fe.buffer).getUint8(ee-1);return ue?sliceUint8(fe,0,ee-ue):fe}class AESDecryptor{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(ee){const ue=new DataView(ee),pe=new Uint32Array(4);for(let _e=0;_e<4;_e++)pe[_e]=ue.getUint32(_e*4);return pe}initTable(){const ee=this.sBox,ue=this.invSBox,pe=this.subMix,_e=pe[0],Ne=pe[1],Ue=pe[2],Ge=pe[3],qe=this.invSubMix,Ke=qe[0],Ye=qe[1],Ze=qe[2],Xe=qe[3],Je=new Uint32Array(256);let tt=0,rt=0,et=0;for(et=0;et<256;et++)et<128?Je[et]=et<<1:Je[et]=et<<1^283;for(et=0;et<256;et++){let it=rt^rt<<1^rt<<2^rt<<3^rt<<4;it=it>>>8^it&255^99,ee[tt]=it,ue[it]=tt;const nt=Je[tt],st=Je[nt],lt=Je[st];let _r=Je[it]*257^it*16843008;_e[tt]=_r<<24|_r>>>8,Ne[tt]=_r<<16|_r>>>16,Ue[tt]=_r<<8|_r>>>24,Ge[tt]=_r,_r=lt*16843009^st*65537^nt*257^tt*16843008,Ke[it]=_r<<24|_r>>>8,Ye[it]=_r<<16|_r>>>16,Ze[it]=_r<<8|_r>>>24,Xe[it]=_r,tt?(tt=nt^Je[Je[Je[lt^nt]]],rt^=Je[Je[rt]]):tt=rt=1}}expandKey(ee){const ue=this.uint8ArrayToUint32Array_(ee);let pe=!0,_e=0;for(;_e<ue.length&&pe;)pe=ue[_e]===this.key[_e],_e++;if(pe)return;this.key=ue;const Ne=this.keySize=ue.length;if(Ne!==4&&Ne!==6&&Ne!==8)throw new Error("Invalid aes key size="+Ne);const Ue=this.ksRows=(Ne+6+1)*4;let Ge,qe;const Ke=this.keySchedule=new Uint32Array(Ue),Ye=this.invKeySchedule=new Uint32Array(Ue),Ze=this.sBox,Xe=this.rcon,Je=this.invSubMix,tt=Je[0],rt=Je[1],et=Je[2],it=Je[3];let nt,st;for(Ge=0;Ge<Ue;Ge++){if(Ge<Ne){nt=Ke[Ge]=ue[Ge];continue}st=nt,Ge%Ne===0?(st=st<<8|st>>>24,st=Ze[st>>>24]<<24|Ze[st>>>16&255]<<16|Ze[st>>>8&255]<<8|Ze[st&255],st^=Xe[Ge/Ne|0]<<24):Ne>6&&Ge%Ne===4&&(st=Ze[st>>>24]<<24|Ze[st>>>16&255]<<16|Ze[st>>>8&255]<<8|Ze[st&255]),Ke[Ge]=nt=(Ke[Ge-Ne]^st)>>>0}for(qe=0;qe<Ue;qe++)Ge=Ue-qe,qe&3?st=Ke[Ge]:st=Ke[Ge-4],qe<4||Ge<=4?Ye[qe]=st:Ye[qe]=tt[Ze[st>>>24]]^rt[Ze[st>>>16&255]]^et[Ze[st>>>8&255]]^it[Ze[st&255]],Ye[qe]=Ye[qe]>>>0}networkToHostOrderSwap(ee){return ee<<24|(ee&65280)<<8|(ee&16711680)>>8|ee>>>24}decrypt(ee,ue,pe){const _e=this.keySize+6,Ne=this.invKeySchedule,Ue=this.invSBox,Ge=this.invSubMix,qe=Ge[0],Ke=Ge[1],Ye=Ge[2],Ze=Ge[3],Xe=this.uint8ArrayToUint32Array_(pe);let Je=Xe[0],tt=Xe[1],rt=Xe[2],et=Xe[3];const it=new Int32Array(ee),nt=new Int32Array(it.length);let st,lt,_r,jr,Nr,Wr,ri,Xr,Gr,qr,si,oi,Yr,ii;const ti=this.networkToHostOrderSwap;for(;ue<it.length;){for(Gr=ti(it[ue]),qr=ti(it[ue+1]),si=ti(it[ue+2]),oi=ti(it[ue+3]),Nr=Gr^Ne[0],Wr=oi^Ne[1],ri=si^Ne[2],Xr=qr^Ne[3],Yr=4,ii=1;ii<_e;ii++)st=qe[Nr>>>24]^Ke[Wr>>16&255]^Ye[ri>>8&255]^Ze[Xr&255]^Ne[Yr],lt=qe[Wr>>>24]^Ke[ri>>16&255]^Ye[Xr>>8&255]^Ze[Nr&255]^Ne[Yr+1],_r=qe[ri>>>24]^Ke[Xr>>16&255]^Ye[Nr>>8&255]^Ze[Wr&255]^Ne[Yr+2],jr=qe[Xr>>>24]^Ke[Nr>>16&255]^Ye[Wr>>8&255]^Ze[ri&255]^Ne[Yr+3],Nr=st,Wr=lt,ri=_r,Xr=jr,Yr=Yr+4;st=Ue[Nr>>>24]<<24^Ue[Wr>>16&255]<<16^Ue[ri>>8&255]<<8^Ue[Xr&255]^Ne[Yr],lt=Ue[Wr>>>24]<<24^Ue[ri>>16&255]<<16^Ue[Xr>>8&255]<<8^Ue[Nr&255]^Ne[Yr+1],_r=Ue[ri>>>24]<<24^Ue[Xr>>16&255]<<16^Ue[Nr>>8&255]<<8^Ue[Wr&255]^Ne[Yr+2],jr=Ue[Xr>>>24]<<24^Ue[Nr>>16&255]<<16^Ue[Wr>>8&255]<<8^Ue[ri&255]^Ne[Yr+3],nt[ue]=ti(st^Je),nt[ue+1]=ti(jr^tt),nt[ue+2]=ti(_r^rt),nt[ue+3]=ti(lt^et),Je=Gr,tt=qr,rt=si,et=oi,ue=ue+4}return nt.buffer}}const CHUNK_SIZE=16;class Decrypter{constructor(ee,{removePKCS7Padding:ue=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=ee.enableSoftwareAES,this.removePKCS7Padding=ue,ue)try{const pe=self.crypto;pe&&(this.subtle=pe.subtle||pe.webkitSubtle)}catch{}this.subtle===null&&(this.useSoftware=!0)}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:ee,remainderData:ue}=this;if(!ee||ue)return this.reset(),null;const pe=new Uint8Array(ee);return this.reset(),this.removePKCS7Padding?removePadding(pe):pe}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(ee,ue,pe){return this.useSoftware?new Promise((_e,Ne)=>{this.softwareDecrypt(new Uint8Array(ee),ue,pe);const Ue=this.flush();Ue?_e(Ue.buffer):Ne(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(ee),ue,pe)}softwareDecrypt(ee,ue,pe){const{currentIV:_e,currentResult:Ne,remainderData:Ue}=this;this.logOnce("JS AES decrypt"),Ue&&(ee=appendUint8Array(Ue,ee),this.remainderData=null);const Ge=this.getValidChunk(ee);if(!Ge.length)return null;_e&&(pe=_e);let qe=this.softwareDecrypter;qe||(qe=this.softwareDecrypter=new AESDecryptor),qe.expandKey(ue);const Ke=Ne;return this.currentResult=qe.decrypt(Ge.buffer,0,pe),this.currentIV=sliceUint8(Ge,-16).buffer,Ke||null}webCryptoDecrypt(ee,ue,pe){const _e=this.subtle;return(this.key!==ue||!this.fastAesKey)&&(this.key=ue,this.fastAesKey=new FastAESKey(_e,ue)),this.fastAesKey.expandKey().then(Ne=>_e?(this.logOnce("WebCrypto AES decrypt"),new AESCrypto(_e,new Uint8Array(pe)).decrypt(ee.buffer,Ne)):Promise.reject(new Error("web crypto not initialized"))).catch(Ne=>(logger.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${Ne.name}: ${Ne.message}`),this.onWebCryptoError(ee,ue,pe)))}onWebCryptoError(ee,ue,pe){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(ee,ue,pe);const _e=this.flush();if(_e)return _e.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")}getValidChunk(ee){let ue=ee;const pe=ee.length-ee.length%CHUNK_SIZE;return pe!==ee.length&&(ue=sliceUint8(ee,0,pe),this.remainderData=sliceUint8(ee,pe)),ue}logOnce(ee){this.logEnabled&&(logger.log(`[decrypter]: ${ee}`),this.logEnabled=!1)}}const TimeRanges={toString:function(fe){let ee="";const ue=fe.length;for(let pe=0;pe<ue;pe++)ee+=`[${fe.start(pe).toFixed(3)}-${fe.end(pe).toFixed(3)}]`;return ee}},State={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class BaseStreamController extends TaskLoop{constructor(ee,ue,pe,_e,Ne){super(),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=State.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.loadedmetadata=!1,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.onvseeking=null,this.onvended=null,this.logPrefix="",this.log=void 0,this.warn=void 0,this.playlistType=Ne,this.logPrefix=_e,this.log=logger.log.bind(logger,`${_e}:`),this.warn=logger.warn.bind(logger,`${_e}:`),this.hls=ee,this.fragmentLoader=new FragmentLoader(ee.config),this.keyLoader=pe,this.fragmentTracker=ue,this.config=ee.config,this.decrypter=new Decrypter(ee.config),ee.on(Events.MANIFEST_LOADED,this.onManifestLoaded,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(ee){}stopLoad(){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const ee=this.fragCurrent;ee!=null&&ee.loader&&(ee.abortRequests(),this.fragmentTracker.removeFragment(ee)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=State.STOPPED}_streamEnded(ee,ue){if(ue.live||ee.nextStart||!ee.end||!this.media)return!1;const pe=ue.partList;if(pe!=null&&pe.length){const Ne=pe[pe.length-1];return BufferHelper.isBuffered(this.media,Ne.start+Ne.duration/2)}const _e=ue.fragments[ue.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(_e)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null){var ee;return(ee=this.levels[this.levelLastLoaded])==null?void 0:ee.details}}onMediaAttached(ee,ue){const pe=this.media=this.mediaBuffer=ue.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),pe.addEventListener("seeking",this.onvseeking),pe.addEventListener("ended",this.onvended);const _e=this.config;this.levels&&_e.autoStartLoad&&this.state===State.STOPPED&&this.startLoad(_e.startPosition)}onMediaDetaching(){const ee=this.media;ee!=null&&ee.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),ee&&this.onvseeking&&this.onvended&&(ee.removeEventListener("seeking",this.onvseeking),ee.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}onMediaSeeking(){const{config:ee,fragCurrent:ue,media:pe,mediaBuffer:_e,state:Ne}=this,Ue=pe?pe.currentTime:0,Ge=BufferHelper.bufferInfo(_e||pe,Ue,ee.maxBufferHole);if(this.log(`media seeking to ${isFiniteNumber(Ue)?Ue.toFixed(3):Ue}, state: ${Ne}`),this.state===State.ENDED)this.resetLoadingState();else if(ue){const qe=ee.maxFragLookUpTolerance,Ke=ue.start-qe,Ye=ue.start+ue.duration+qe;if(!Ge.len||Ye<Ge.start||Ke>Ge.end){const Ze=Ue>Ye;(Ue<Ke||Ze)&&(Ze&&ue.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),ue.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}pe&&(this.fragmentTracker.removeFragmentsInRange(Ue,1/0,this.playlistType,!0),this.lastCurrentTime=Ue),!this.loadedmetadata&&!Ge.len&&(this.nextLoadPosition=this.startPosition=Ue),this.tickImmediate()}onMediaEnded(){this.startPosition=this.lastCurrentTime=0}onManifestLoaded(ee,ue){this.startTimeOffset=ue.startTimeOffset,this.initPTS=[]}onHandlerDestroying(){this.stopLoad(),super.onHandlerDestroying()}onHandlerDestroyed(){this.state=State.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(ee,ue,pe){this._loadFragForPlayback(ee,ue,pe)}_loadFragForPlayback(ee,ue,pe){const _e=Ne=>{if(this.fragContextChanged(ee)){this.warn(`Fragment ${ee.sn}${Ne.part?" p: "+Ne.part.index:""} of level ${ee.level} was dropped during download.`),this.fragmentTracker.removeFragment(ee);return}ee.stats.chunkCount++,this._handleFragmentLoadProgress(Ne)};this._doFragLoad(ee,ue,pe,_e).then(Ne=>{if(!Ne)return;const Ue=this.state;if(this.fragContextChanged(ee)){(Ue===State.FRAG_LOADING||!this.fragCurrent&&Ue===State.PARSING)&&(this.fragmentTracker.removeFragment(ee),this.state=State.IDLE);return}"payload"in Ne&&(this.log(`Loaded fragment ${ee.sn} of level ${ee.level}`),this.hls.trigger(Events.FRAG_LOADED,Ne)),this._handleFragmentLoadComplete(Ne)}).catch(Ne=>{this.state===State.STOPPED||this.state===State.ERROR||(this.warn(Ne),this.resetFragmentLoading(ee))})}clearTrackerIfNeeded(ee){var ue;const{fragmentTracker:pe}=this;if(pe.getState(ee)===FragmentState.APPENDING){const Ne=ee.type,Ue=this.getFwdBufferInfo(this.mediaBuffer,Ne),Ge=Math.max(ee.duration,Ue?Ue.len:this.config.maxBufferLength);this.reduceMaxBufferLength(Ge)&&pe.removeFragment(ee)}else((ue=this.mediaBuffer)==null?void 0:ue.buffered.length)===0?pe.removeAllFragments():pe.hasParts(ee.type)&&(pe.detectPartialFragments({frag:ee,part:null,stats:ee.stats,id:ee.type}),pe.getState(ee)===FragmentState.PARTIAL&&pe.removeFragment(ee))}checkLiveUpdate(ee){if(ee.updated&&!ee.live){const ue=ee.fragments[ee.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:ue,part:null,stats:ue.stats,id:ue.type})}ee.fragments[0]||(ee.deltaUpdateFailed=!0)}flushMainBuffer(ee,ue,pe=null){if(!(ee-ue))return;const _e={startOffset:ee,endOffset:ue,type:pe};this.hls.trigger(Events.BUFFER_FLUSHING,_e)}_loadInitSegment(ee,ue){this._doFragLoad(ee,ue).then(pe=>{if(!pe||this.fragContextChanged(ee)||!this.levels)throw new Error("init load aborted");return pe}).then(pe=>{const{hls:_e}=this,{payload:Ne}=pe,Ue=ee.decryptdata;if(Ne&&Ne.byteLength>0&&Ue&&Ue.key&&Ue.iv&&Ue.method==="AES-128"){const Ge=self.performance.now();return this.decrypter.decrypt(new Uint8Array(Ne),Ue.key.buffer,Ue.iv.buffer).catch(qe=>{throw _e.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!1,error:qe,reason:qe.message,frag:ee}),qe}).then(qe=>{const Ke=self.performance.now();return _e.trigger(Events.FRAG_DECRYPTED,{frag:ee,payload:qe,stats:{tstart:Ge,tdecrypt:Ke}}),pe.payload=qe,pe})}return pe}).then(pe=>{const{fragCurrent:_e,hls:Ne,levels:Ue}=this;if(!Ue)throw new Error("init load aborted, missing levels");const Ge=ee.stats;this.state=State.IDLE,ue.fragmentError=0,ee.data=new Uint8Array(pe.payload),Ge.parsing.start=Ge.buffering.start=self.performance.now(),Ge.parsing.end=Ge.buffering.end=self.performance.now(),pe.frag===_e&&Ne.trigger(Events.FRAG_BUFFERED,{stats:Ge,frag:_e,part:null,id:ee.type}),this.tick()}).catch(pe=>{this.state===State.STOPPED||this.state===State.ERROR||(this.warn(pe),this.resetFragmentLoading(ee))})}fragContextChanged(ee){const{fragCurrent:ue}=this;return!ee||!ue||ee.level!==ue.level||ee.sn!==ue.sn||ee.urlId!==ue.urlId}fragBufferedComplete(ee,ue){var pe,_e,Ne,Ue;const Ge=this.mediaBuffer?this.mediaBuffer:this.media;this.log(`Buffered ${ee.type} sn: ${ee.sn}${ue?" part: "+ue.index:""} of ${this.playlistType===PlaylistLevelType.MAIN?"level":"track"} ${ee.level} (frag:[${((pe=ee.startPTS)!=null?pe:NaN).toFixed(3)}-${((_e=ee.endPTS)!=null?_e:NaN).toFixed(3)}] > buffer:${Ge?TimeRanges.toString(BufferHelper.getBuffered(Ge)):"(detached)"})`),this.state=State.IDLE,Ge&&(!this.loadedmetadata&&ee.type==PlaylistLevelType.MAIN&&Ge.buffered.length&&((Ne=this.fragCurrent)==null?void 0:Ne.sn)===((Ue=this.fragPrevious)==null?void 0:Ue.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())}seekToStartPos(){}_handleFragmentLoadComplete(ee){const{transmuxer:ue}=this;if(!ue)return;const{frag:pe,part:_e,partsLoaded:Ne}=ee,Ue=!Ne||Ne.length===0||Ne.some(qe=>!qe),Ge=new ChunkMetadata(pe.level,pe.sn,pe.stats.chunkCount+1,0,_e?_e.index:-1,!Ue);ue.flush(Ge)}_handleFragmentLoadProgress(ee){}_doFragLoad(ee,ue,pe=null,_e){var Ne;const Ue=ue==null?void 0:ue.details;if(!this.levels||!Ue)throw new Error(`frag load aborted, missing level${Ue?"":" detail"}s`);let Ge=null;if(ee.encrypted&&!((Ne=ee.decryptdata)!=null&&Ne.key)?(this.log(`Loading key for ${ee.sn} of [${Ue.startSN}-${Ue.endSN}], ${this.logPrefix==="[stream-controller]"?"level":"track"} ${ee.level}`),this.state=State.KEY_LOADING,this.fragCurrent=ee,Ge=this.keyLoader.load(ee).then(Ye=>{if(!this.fragContextChanged(Ye.frag))return this.hls.trigger(Events.KEY_LOADED,Ye),this.state===State.KEY_LOADING&&(this.state=State.IDLE),Ye}),this.hls.trigger(Events.KEY_LOADING,{frag:ee}),this.fragCurrent===null&&(Ge=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))):!ee.encrypted&&Ue.encryptedFragments.length&&this.keyLoader.loadClear(ee,Ue.encryptedFragments),pe=Math.max(ee.start,pe||0),this.config.lowLatencyMode&&ee.sn!=="initSegment"){const Ye=Ue.partList;if(Ye&&_e){pe>ee.end&&Ue.fragmentHint&&(ee=Ue.fragmentHint);const Ze=this.getNextPart(Ye,ee,pe);if(Ze>-1){const Xe=Ye[Ze];this.log(`Loading part sn: ${ee.sn} p: ${Xe.index} cc: ${ee.cc} of playlist [${Ue.startSN}-${Ue.endSN}] parts [0-${Ze}-${Ye.length-1}] ${this.logPrefix==="[stream-controller]"?"level":"track"}: ${ee.level}, target: ${parseFloat(pe.toFixed(3))}`),this.nextLoadPosition=Xe.start+Xe.duration,this.state=State.FRAG_LOADING;let Je;return Ge?Je=Ge.then(tt=>!tt||this.fragContextChanged(tt.frag)?null:this.doFragPartsLoad(ee,Xe,ue,_e)).catch(tt=>this.handleFragLoadError(tt)):Je=this.doFragPartsLoad(ee,Xe,ue,_e).catch(tt=>this.handleFragLoadError(tt)),this.hls.trigger(Events.FRAG_LOADING,{frag:ee,part:Xe,targetBufferTime:pe}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):Je}else if(!ee.url||this.loadedEndOfParts(Ye,pe))return Promise.resolve(null)}}this.log(`Loading fragment ${ee.sn} cc: ${ee.cc} ${Ue?"of ["+Ue.startSN+"-"+Ue.endSN+"] ":""}${this.logPrefix==="[stream-controller]"?"level":"track"}: ${ee.level}, target: ${parseFloat(pe.toFixed(3))}`),isFiniteNumber(ee.sn)&&!this.bitrateTest&&(this.nextLoadPosition=ee.start+ee.duration),this.state=State.FRAG_LOADING;const qe=this.config.progressive;let Ke;return qe&&Ge?Ke=Ge.then(Ye=>!Ye||this.fragContextChanged(Ye==null?void 0:Ye.frag)?null:this.fragmentLoader.load(ee,_e)).catch(Ye=>this.handleFragLoadError(Ye)):Ke=Promise.all([this.fragmentLoader.load(ee,qe?_e:void 0),Ge]).then(([Ye])=>(!qe&&Ye&&_e&&_e(Ye),Ye)).catch(Ye=>this.handleFragLoadError(Ye)),this.hls.trigger(Events.FRAG_LOADING,{frag:ee,targetBufferTime:pe}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):Ke}doFragPartsLoad(ee,ue,pe,_e){return new Promise((Ne,Ue)=>{var Ge;const qe=[],Ke=(Ge=pe.details)==null?void 0:Ge.partList,Ye=Ze=>{this.fragmentLoader.loadPart(ee,Ze,_e).then(Xe=>{qe[Ze.index]=Xe;const Je=Xe.part;this.hls.trigger(Events.FRAG_LOADED,Xe);const tt=getPartWith(pe,ee.sn,Ze.index+1)||findPart(Ke,ee.sn,Ze.index+1);if(tt)Ye(tt);else return Ne({frag:ee,part:Je,partsLoaded:qe})}).catch(Ue)};Ye(ue)})}handleFragLoadError(ee){if("data"in ee){const ue=ee.data;ee.data&&ue.details===ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(ue.frag,ue.part):this.hls.trigger(Events.ERROR,ue)}else this.hls.trigger(Events.ERROR,{type:ErrorTypes.OTHER_ERROR,details:ErrorDetails.INTERNAL_EXCEPTION,err:ee,error:ee,fatal:!0});return null}_handleTransmuxerFlush(ee){const ue=this.getCurrentContext(ee);if(!ue||this.state!==State.PARSING){!this.fragCurrent&&this.state!==State.STOPPED&&this.state!==State.ERROR&&(this.state=State.IDLE);return}const{frag:pe,part:_e,level:Ne}=ue,Ue=self.performance.now();pe.stats.parsing.end=Ue,_e&&(_e.stats.parsing.end=Ue),this.updateLevelTiming(pe,_e,Ne,ee.partial)}getCurrentContext(ee){const{levels:ue,fragCurrent:pe}=this,{level:_e,sn:Ne,part:Ue}=ee;if(!(ue!=null&&ue[_e]))return this.warn(`Levels object was unset while buffering fragment ${Ne} of level ${_e}. The current chunk will not be buffered.`),null;const Ge=ue[_e],qe=Ue>-1?getPartWith(Ge,Ne,Ue):null,Ke=qe?qe.fragment:getFragmentWithSN(Ge,Ne,pe);return Ke?(pe&&pe!==Ke&&(Ke.stats=pe.stats),{frag:Ke,part:qe,level:Ge}):null}bufferFragmentData(ee,ue,pe,_e,Ne){var Ue;if(!ee||this.state!==State.PARSING)return;const{data1:Ge,data2:qe}=ee;let Ke=Ge;if(Ge&&qe&&(Ke=appendUint8Array(Ge,qe)),!((Ue=Ke)!=null&&Ue.length))return;const Ye={type:ee.type,frag:ue,part:pe,chunkMeta:_e,parent:ue.type,data:Ke};if(this.hls.trigger(Events.BUFFER_APPENDING,Ye),ee.dropped&&ee.independent&&!pe){if(Ne)return;this.flushBufferGap(ue)}}flushBufferGap(ee){const ue=this.media;if(!ue)return;if(!BufferHelper.isBuffered(ue,ue.currentTime)){this.flushMainBuffer(0,ee.start);return}const pe=ue.currentTime,_e=BufferHelper.bufferInfo(ue,pe,0),Ne=ee.duration,Ue=Math.min(this.config.maxFragLookUpTolerance*2,Ne*.25),Ge=Math.max(Math.min(ee.start-Ue,_e.end-Ue),pe+Ue);ee.start-Ge>Ue&&this.flushMainBuffer(Ge,ee.start)}getFwdBufferInfo(ee,ue){const pe=this.getLoadPosition();return isFiniteNumber(pe)?this.getFwdBufferInfoAtPos(ee,pe,ue):null}getFwdBufferInfoAtPos(ee,ue,pe){const{config:{maxBufferHole:_e}}=this,Ne=BufferHelper.bufferInfo(ee,ue,_e);if(Ne.len===0&&Ne.nextStart!==void 0){const Ue=this.fragmentTracker.getBufferedFrag(ue,pe);if(Ue&&Ne.nextStart<Ue.end)return BufferHelper.bufferInfo(ee,ue,Math.max(Ne.nextStart,_e))}return Ne}getMaxBufferLength(ee){const{config:ue}=this;let pe;return ee?pe=Math.max(8*ue.maxBufferSize/ee,ue.maxBufferLength):pe=ue.maxBufferLength,Math.min(pe,ue.maxMaxBufferLength)}reduceMaxBufferLength(ee){const ue=this.config,pe=ee||ue.maxBufferLength;return ue.maxMaxBufferLength>=pe?(ue.maxMaxBufferLength/=2,this.warn(`Reduce max buffer length to ${ue.maxMaxBufferLength}s`),!0):!1}getAppendedFrag(ee,ue=PlaylistLevelType.MAIN){const pe=this.fragmentTracker.getAppendedFrag(ee,PlaylistLevelType.MAIN);return pe&&"fragment"in pe?pe.fragment:pe}getNextFragment(ee,ue){const pe=ue.fragments,_e=pe.length;if(!_e)return null;const{config:Ne}=this,Ue=pe[0].start;let Ge;if(ue.live){const qe=Ne.initialLiveManifestSize;if(_e<qe)return this.warn(`Not enough fragments to start playback (have: ${_e}, need: ${qe})`),null;!ue.PTSKnown&&!this.startFragRequested&&this.startPosition===-1&&(Ge=this.getInitialLiveFragment(ue,pe),this.startPosition=Ge?this.hls.liveSyncPosition||Ge.start:ee)}else ee<=Ue&&(Ge=pe[0]);if(!Ge){const qe=Ne.lowLatencyMode?ue.partEnd:ue.fragmentEnd;Ge=this.getFragmentAtPosition(ee,qe,ue)}return this.mapToInitFragWhenRequired(Ge)}isLoopLoading(ee,ue){const pe=this.fragmentTracker.getState(ee);return(pe===FragmentState.OK||pe===FragmentState.PARTIAL&&!!ee.gap)&&this.nextLoadPosition>ue}getNextFragmentLoopLoading(ee,ue,pe,_e,Ne){const Ue=ee.gap,Ge=this.getNextFragment(this.nextLoadPosition,ue);if(Ge===null)return Ge;if(ee=Ge,Ue&&ee&&!ee.gap&&pe.nextStart){const qe=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,pe.nextStart,_e);if(qe!==null&&pe.len+qe.len>=Ne)return this.log(`buffer full after gaps in "${_e}" playlist starting at sn: ${ee.sn}`),null}return ee}mapToInitFragWhenRequired(ee){return ee!=null&&ee.initSegment&&!(ee!=null&&ee.initSegment.data)&&!this.bitrateTest?ee.initSegment:ee}getNextPart(ee,ue,pe){let _e=-1,Ne=!1,Ue=!0;for(let Ge=0,qe=ee.length;Ge<qe;Ge++){const Ke=ee[Ge];if(Ue=Ue&&!Ke.independent,_e>-1&&pe<Ke.start)break;const Ye=Ke.loaded;Ye?_e=-1:(Ne||Ke.independent||Ue)&&Ke.fragment===ue&&(_e=Ge),Ne=Ye}return _e}loadedEndOfParts(ee,ue){const pe=ee[ee.length-1];return pe&&ue>pe.start&&pe.loaded}getInitialLiveFragment(ee,ue){const pe=this.fragPrevious;let _e=null;if(pe){if(ee.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${pe.programDateTime}`),_e=findFragmentByPDT(ue,pe.endProgramDateTime,this.config.maxFragLookUpTolerance)),!_e){const Ne=pe.sn+1;if(Ne>=ee.startSN&&Ne<=ee.endSN){const Ue=ue[Ne-ee.startSN];pe.cc===Ue.cc&&(_e=Ue,this.log(`Live playlist, switching playlist, load frag with next SN: ${_e.sn}`))}_e||(_e=findFragWithCC(ue,pe.cc),_e&&this.log(`Live playlist, switching playlist, load frag with same CC: ${_e.sn}`))}}else{const Ne=this.hls.liveSyncPosition;Ne!==null&&(_e=this.getFragmentAtPosition(Ne,this.bitrateTest?ee.fragmentEnd:ee.edge,ee))}return _e}getFragmentAtPosition(ee,ue,pe){const{config:_e}=this;let{fragPrevious:Ne}=this,{fragments:Ue,endSN:Ge}=pe;const{fragmentHint:qe}=pe,Ke=_e.maxFragLookUpTolerance,Ye=pe.partList,Ze=!!(_e.lowLatencyMode&&Ye!=null&&Ye.length&&qe);Ze&&qe&&!this.bitrateTest&&(Ue=Ue.concat(qe),Ge=qe.sn);let Xe;if(ee<ue){const Je=ee>ue-Ke?0:Ke;Xe=findFragmentByPTS(Ne,Ue,ee,Je)}else Xe=Ue[Ue.length-1];if(Xe){const Je=Xe.sn-pe.startSN,tt=this.fragmentTracker.getState(Xe);if((tt===FragmentState.OK||tt===FragmentState.PARTIAL&&Xe.gap)&&(Ne=Xe),Ne&&Xe.sn===Ne.sn&&(!Ze||Ye[0].fragment.sn>Xe.sn)&&Ne&&Xe.level===Ne.level){const et=Ue[Je+1];Xe.sn<Ge&&this.fragmentTracker.getState(et)!==FragmentState.OK?Xe=et:Xe=null}}return Xe}synchronizeToLiveEdge(ee){const{config:ue,media:pe}=this;if(!pe)return;const _e=this.hls.liveSyncPosition,Ne=pe.currentTime,Ue=ee.fragments[0].start,Ge=ee.edge,qe=Ne>=Ue-ue.maxFragLookUpTolerance&&Ne<=Ge;if(_e!==null&&pe.duration>_e&&(Ne<_e||!qe)){const Ke=ue.liveMaxLatencyDuration!==void 0?ue.liveMaxLatencyDuration:ue.liveMaxLatencyDurationCount*ee.targetduration;(!qe&&pe.readyState<4||Ne<Ge-Ke)&&(this.loadedmetadata||(this.nextLoadPosition=_e),pe.readyState&&(this.warn(`Playback: ${Ne.toFixed(3)} is located too far from the end of live sliding playlist: ${Ge}, reset currentTime to : ${_e.toFixed(3)}`),pe.currentTime=_e))}}alignPlaylists(ee,ue){const{levels:pe,levelLastLoaded:_e,fragPrevious:Ne}=this,Ue=_e!==null?pe[_e]:null,Ge=ee.fragments.length;if(!Ge)return this.warn("No fragments in live playlist"),0;const qe=ee.fragments[0].start,Ke=!ue,Ye=ee.alignedSliding&&isFiniteNumber(qe);if(Ke||!Ye&&!qe){alignStream(Ne,Ue,ee);const Ze=ee.fragments[0].start;return this.log(`Live playlist sliding: ${Ze.toFixed(2)} start-sn: ${ue?ue.startSN:"na"}->${ee.startSN} prev-sn: ${Ne?Ne.sn:"na"} fragments: ${Ge}`),Ze}return qe}waitForCdnTuneIn(ee){return ee.live&&ee.canBlockReload&&ee.partTarget&&ee.tuneInGoal>Math.max(ee.partHoldBack,ee.partTarget*3)}setStartPosition(ee,ue){let pe=this.startPosition;if(pe<ue&&(pe=-1),pe===-1||this.lastCurrentTime===-1){const _e=this.startTimeOffset!==null,Ne=_e?this.startTimeOffset:ee.startTimeOffset;Ne!==null&&isFiniteNumber(Ne)?(pe=ue+Ne,Ne<0&&(pe+=ee.totalduration),pe=Math.min(Math.max(ue,pe),ue+ee.totalduration),this.log(`Start time offset ${Ne} found in ${_e?"multivariant":"media"} playlist, adjust startPosition to ${pe}`),this.startPosition=pe):ee.live?pe=this.hls.liveSyncPosition||ue:this.startPosition=pe=0,this.lastCurrentTime=pe}this.nextLoadPosition=pe}getLoadPosition(){const{media:ee}=this;let ue=0;return this.loadedmetadata&&ee?ue=ee.currentTime:this.nextLoadPosition&&(ue=this.nextLoadPosition),ue}handleFragLoadAborted(ee,ue){this.transmuxer&&ee.sn!=="initSegment"&&ee.stats.aborted&&(this.warn(`Fragment ${ee.sn}${ue?" part "+ue.index:""} of level ${ee.level} was aborted`),this.resetFragmentLoading(ee))}resetFragmentLoading(ee){(!this.fragCurrent||!this.fragContextChanged(ee)&&this.state!==State.FRAG_LOADING_WAITING_RETRY)&&(this.state=State.IDLE)}onFragmentOrKeyLoadError(ee,ue){if(ue.chunkMeta&&!ue.frag){const Ze=this.getCurrentContext(ue.chunkMeta);Ze&&(ue.frag=Ze.frag)}const pe=ue.frag;if(!pe||pe.type!==ee||!this.levels)return;if(this.fragContextChanged(pe)){var _e;this.warn(`Frag load error must match current frag to retry ${pe.url} > ${(_e=this.fragCurrent)==null?void 0:_e.url}`);return}const Ne=ue.details===ErrorDetails.FRAG_GAP;Ne&&this.fragmentTracker.fragBuffered(pe,!0);const Ue=ue.errorAction,{action:Ge,retryCount:qe=0,retryConfig:Ke}=Ue||{};if(Ue&&Ge===NetworkErrorAction.RetryRequest&&Ke){var Ye;this.resetStartWhenNotLoaded((Ye=this.levelLastLoaded)!=null?Ye:pe.level);const Ze=getRetryDelay(Ke,qe);this.warn(`Fragment ${pe.sn} of ${ee} ${pe.level} errored with ${ue.details}, retrying loading ${qe+1}/${Ke.maxNumRetry} in ${Ze}ms`),Ue.resolved=!0,this.retryDate=self.performance.now()+Ze,this.state=State.FRAG_LOADING_WAITING_RETRY}else Ke&&Ue?(this.resetFragmentErrors(ee),qe<Ke.maxNumRetry?Ne||(Ue.resolved=!0):logger.warn(`${ue.details} reached or exceeded max retry (${qe})`)):(Ue==null?void 0:Ue.action)===NetworkErrorAction.SendAlternateToPenaltyBox?this.state=State.WAITING_LEVEL:this.state=State.ERROR;this.tickImmediate()}reduceLengthAndFlushBuffer(ee){if(this.state===State.PARSING||this.state===State.PARSED){const ue=ee.parent,pe=this.getFwdBufferInfo(this.mediaBuffer,ue),_e=pe&&pe.len>.5;_e&&this.reduceMaxBufferLength(pe.len);const Ne=!_e;return Ne&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${ue} buffer`),ee.frag&&(this.fragmentTracker.removeFragment(ee.frag),this.nextLoadPosition=ee.frag.start),this.resetLoadingState(),Ne}return!1}resetFragmentErrors(ee){ee===PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),this.state!==State.STOPPED&&(this.state=State.IDLE)}afterBufferFlushed(ee,ue,pe){if(!ee)return;const _e=BufferHelper.getBuffered(ee);this.fragmentTracker.detectEvictedFragments(ue,_e,pe),this.state===State.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=State.IDLE}resetStartWhenNotLoaded(ee){if(!this.loadedmetadata){this.startFragRequested=!1;const ue=this.levels?this.levels[ee].details:null;ue!=null&&ue.live?(this.startPosition=-1,this.setStartPosition(ue,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(ee){var ue;this.warn(`The loading context changed while buffering fragment ${ee.sn} of level ${ee.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded((ue=this.levelLastLoaded)!=null?ue:ee.level),this.resetLoadingState()}removeUnbufferedFrags(ee=0){this.fragmentTracker.removeFragmentsInRange(ee,1/0,this.playlistType,!1,!0)}updateLevelTiming(ee,ue,pe,_e){var Ne;const Ue=pe.details;if(!Ue){this.warn("level.details undefined");return}if(Object.keys(ee.elementaryStreams).reduce((qe,Ke)=>{const Ye=ee.elementaryStreams[Ke];if(Ye){const Ze=Ye.endPTS-Ye.startPTS;if(Ze<=0)return this.warn(`Could not parse fragment ${ee.sn} ${Ke} duration reliably (${Ze})`),qe||!1;const Xe=_e?0:updateFragPTSDTS(Ue,ee,Ye.startPTS,Ye.endPTS,Ye.startDTS,Ye.endDTS);return this.hls.trigger(Events.LEVEL_PTS_UPDATED,{details:Ue,level:pe,drift:Xe,type:Ke,frag:ee,start:Ye.startPTS,end:Ye.endPTS}),!0}return qe},!1))pe.fragmentError=0;else if(((Ne=this.transmuxer)==null?void 0:Ne.error)===null){const qe=new Error(`Found no media in fragment ${ee.sn} of level ${ee.level} resetting transmuxer to fallback to playlist timing`);if(pe.fragmentError===0&&(pe.fragmentError++,ee.gap=!0,this.fragmentTracker.removeFragment(ee),this.fragmentTracker.fragBuffered(ee,!0)),this.warn(qe.message),this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,error:qe,frag:ee,reason:`Found no media in msn ${ee.sn} of level "${pe.url}"`}),!this.hls)return;this.resetTransmuxer()}this.state=State.PARSED,this.hls.trigger(Events.FRAG_PARSED,{frag:ee,part:ue})}resetTransmuxer(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)}recoverWorkerError(ee){if(ee.event==="demuxerWorker"){var ue,pe,_e;this.fragmentTracker.removeAllFragments(),this.resetTransmuxer(),this.resetStartWhenNotLoaded((ue=(pe=this.levelLastLoaded)!=null?pe:(_e=this.fragCurrent)==null?void 0:_e.level)!=null?ue:0),this.resetLoadingState()}}set state(ee){const ue=this._state;ue!==ee&&(this._state=ee,this.log(`${ue}->${ee}`))}get state(){return this._state}}function getSourceBuffer(){return self.SourceBuffer||self.WebKitSourceBuffer}function isSupported(){const fe=getMediaSource();if(!fe)return!1;const ee=getSourceBuffer(),ue=fe&&typeof fe.isTypeSupported=="function"&&fe.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),pe=!ee||ee.prototype&&typeof ee.prototype.appendBuffer=="function"&&typeof ee.prototype.remove=="function";return!!ue&&!!pe}function changeTypeSupported(){var fe;const ee=getSourceBuffer();return typeof(ee==null||(fe=ee.prototype)==null?void 0:fe.changeType)=="function"}function hasUMDWorker(){return typeof __HLS_WORKER_BUNDLE__=="function"}function injectWorker(){const fe=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),ee=self.URL.createObjectURL(fe);return{worker:new self.Worker(ee),objectURL:ee}}function loadWorker(fe){const ee=new self.URL(fe,self.location.href).href;return{worker:new self.Worker(ee),scriptURL:ee}}function dummyTrack(fe="",ee=9e4){return{type:fe,id:-1,pid:-1,inputTimeScale:ee,sequenceNumber:-1,samples:[],dropped:0}}class BaseAudioDemuxer{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(ee,ue,pe,_e){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(ee){this.initPTS=ee,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(ee,ue){return!1}appendFrame(ee,ue,pe){}demux(ee,ue){this.cachedData&&(ee=appendUint8Array(this.cachedData,ee),this.cachedData=null);let pe=getID3Data(ee,0),_e=pe?pe.length:0,Ne;const Ue=this._audioTrack,Ge=this._id3Track,qe=pe?getTimeStamp(pe):void 0,Ke=ee.length;for((this.basePTS===null||this.frameIndex===0&&isFiniteNumber(qe))&&(this.basePTS=initPTSFn(qe,ue,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),pe&&pe.length>0&&Ge.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:pe,type:MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});_e<Ke;){if(this.canParse(ee,_e)){const Ye=this.appendFrame(Ue,ee,_e);Ye?(this.frameIndex++,this.lastPTS=Ye.sample.pts,_e+=Ye.length,Ne=_e):_e=Ke}else canParse$2(ee,_e)?(pe=getID3Data(ee,_e),Ge.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:pe,type:MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY}),_e+=pe.length,Ne=_e):_e++;if(_e===Ke&&Ne!==Ke){const Ye=sliceUint8(ee,Ne);this.cachedData?this.cachedData=appendUint8Array(this.cachedData,Ye):this.cachedData=Ye}}return{audioTrack:Ue,videoTrack:dummyTrack(),id3Track:Ge,textTrack:dummyTrack()}}demuxSampleAes(ee,ue,pe){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(ee){const ue=this.cachedData;return ue&&(this.cachedData=null,this.demux(ue,0)),{audioTrack:this._audioTrack,videoTrack:dummyTrack(),id3Track:this._id3Track,textTrack:dummyTrack()}}destroy(){}}const initPTSFn=(fe,ee,ue)=>{if(isFiniteNumber(fe))return fe*90;const pe=ue?ue.baseTime*9e4/ue.timescale:0;return ee*9e4+pe};function getAudioConfig(fe,ee,ue,pe){let _e,Ne,Ue,Ge;const qe=navigator.userAgent.toLowerCase(),Ke=pe,Ye=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];_e=((ee[ue+2]&192)>>>6)+1;const Ze=(ee[ue+2]&60)>>>2;if(Ze>Ye.length-1){fe.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:`invalid ADTS sampling index:${Ze}`});return}return Ue=(ee[ue+2]&1)<<2,Ue|=(ee[ue+3]&192)>>>6,logger.log(`manifest codec:${pe}, ADTS type:${_e}, samplingIndex:${Ze}`),/firefox/i.test(qe)?Ze>=6?(_e=5,Ge=new Array(4),Ne=Ze-3):(_e=2,Ge=new Array(2),Ne=Ze):qe.indexOf("android")!==-1?(_e=2,Ge=new Array(2),Ne=Ze):(_e=5,Ge=new Array(4),pe&&(pe.indexOf("mp4a.40.29")!==-1||pe.indexOf("mp4a.40.5")!==-1)||!pe&&Ze>=6?Ne=Ze-3:((pe&&pe.indexOf("mp4a.40.2")!==-1&&(Ze>=6&&Ue===1||/vivaldi/i.test(qe))||!pe&&Ue===1)&&(_e=2,Ge=new Array(2)),Ne=Ze)),Ge[0]=_e<<3,Ge[0]|=(Ze&14)>>1,Ge[1]|=(Ze&1)<<7,Ge[1]|=Ue<<3,_e===5&&(Ge[1]|=(Ne&14)>>1,Ge[2]=(Ne&1)<<7,Ge[2]|=8,Ge[3]=0),{config:Ge,samplerate:Ye[Ze],channelCount:Ue,codec:"mp4a.40."+_e,manifestCodec:Ke}}function isHeaderPattern$1(fe,ee){return fe[ee]===255&&(fe[ee+1]&246)===240}function getHeaderLength(fe,ee){return fe[ee+1]&1?7:9}function getFullFrameLength(fe,ee){return(fe[ee+3]&3)<<11|fe[ee+4]<<3|(fe[ee+5]&224)>>>5}function canGetFrameLength(fe,ee){return ee+5<fe.length}function isHeader$1(fe,ee){return ee+1<fe.length&&isHeaderPattern$1(fe,ee)}function canParse$1(fe,ee){return canGetFrameLength(fe,ee)&&isHeaderPattern$1(fe,ee)&&getFullFrameLength(fe,ee)<=fe.length-ee}function probe$1(fe,ee){if(isHeader$1(fe,ee)){const ue=getHeaderLength(fe,ee);if(ee+ue>=fe.length)return!1;const pe=getFullFrameLength(fe,ee);if(pe<=ue)return!1;const _e=ee+pe;return _e===fe.length||isHeader$1(fe,_e)}return!1}function initTrackConfig(fe,ee,ue,pe,_e){if(!fe.samplerate){const Ne=getAudioConfig(ee,ue,pe,_e);if(!Ne)return;fe.config=Ne.config,fe.samplerate=Ne.samplerate,fe.channelCount=Ne.channelCount,fe.codec=Ne.codec,fe.manifestCodec=Ne.manifestCodec,logger.log(`parsed codec:${fe.codec}, rate:${Ne.samplerate}, channels:${Ne.channelCount}`)}}function getFrameDuration(fe){return 1024*9e4/fe}function parseFrameHeader(fe,ee){const ue=getHeaderLength(fe,ee);if(ee+ue<=fe.length){const pe=getFullFrameLength(fe,ee)-ue;if(pe>0)return{headerLength:ue,frameLength:pe}}}function appendFrame$1(fe,ee,ue,pe,_e){const Ne=getFrameDuration(fe.samplerate),Ue=pe+_e*Ne,Ge=parseFrameHeader(ee,ue);let qe;if(Ge){const{frameLength:Ze,headerLength:Xe}=Ge,Je=Xe+Ze,tt=Math.max(0,ue+Je-ee.length);tt?(qe=new Uint8Array(Je-Xe),qe.set(ee.subarray(ue+Xe,ee.length),0)):qe=ee.subarray(ue+Xe,ue+Je);const rt={unit:qe,pts:Ue};return tt||fe.samples.push(rt),{sample:rt,length:Je,missing:tt}}const Ke=ee.length-ue;return qe=new Uint8Array(Ke),qe.set(ee.subarray(ue,ee.length),0),{sample:{unit:qe,pts:Ue},length:Ke,missing:-1}}class AACDemuxer extends BaseAudioDemuxer{constructor(ee,ue){super(),this.observer=void 0,this.config=void 0,this.observer=ee,this.config=ue}resetInitSegment(ee,ue,pe,_e){super.resetInitSegment(ee,ue,pe,_e),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:ue,duration:_e,inputTimeScale:9e4,dropped:0}}static probe(ee){if(!ee)return!1;let pe=(getID3Data(ee,0)||[]).length;for(let _e=ee.length;pe<_e;pe++)if(probe$1(ee,pe))return logger.log("ADTS sync word found !"),!0;return!1}canParse(ee,ue){return canParse$1(ee,ue)}appendFrame(ee,ue,pe){initTrackConfig(ee,this.observer,ue,pe,ee.manifestCodec);const _e=appendFrame$1(ee,ue,pe,this.basePTS,this.frameIndex);if(_e&&_e.missing===0)return _e}}const emsgSchemePattern=/\/emsg[-/]ID3/i;class MP4Demuxer{constructor(ee,ue){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=ue}resetTimeStamp(){}resetInitSegment(ee,ue,pe,_e){const Ne=this.videoTrack=dummyTrack("video",1),Ue=this.audioTrack=dummyTrack("audio",1),Ge=this.txtTrack=dummyTrack("text",1);if(this.id3Track=dummyTrack("id3",1),this.timeOffset=0,!(ee!=null&&ee.byteLength))return;const qe=parseInitSegment(ee);if(qe.video){const{id:Ke,timescale:Ye,codec:Ze}=qe.video;Ne.id=Ke,Ne.timescale=Ge.timescale=Ye,Ne.codec=Ze}if(qe.audio){const{id:Ke,timescale:Ye,codec:Ze}=qe.audio;Ue.id=Ke,Ue.timescale=Ye,Ue.codec=Ze}Ge.id=RemuxerTrackIdConfig.text,Ne.sampleDuration=0,Ne.duration=Ue.duration=_e}resetContiguity(){this.remainderData=null}static probe(ee){return ee=ee.length>16384?ee.subarray(0,16384):ee,findBox(ee,["moof"]).length>0}demux(ee,ue){this.timeOffset=ue;let pe=ee;const _e=this.videoTrack,Ne=this.txtTrack;if(this.config.progressive){this.remainderData&&(pe=appendUint8Array(this.remainderData,ee));const Ge=segmentValidRange(pe);this.remainderData=Ge.remainder,_e.samples=Ge.valid||new Uint8Array}else _e.samples=pe;const Ue=this.extractID3Track(_e,ue);return Ne.samples=parseSamples(ue,_e),{videoTrack:_e,audioTrack:this.audioTrack,id3Track:Ue,textTrack:this.txtTrack}}flush(){const ee=this.timeOffset,ue=this.videoTrack,pe=this.txtTrack;ue.samples=this.remainderData||new Uint8Array,this.remainderData=null;const _e=this.extractID3Track(ue,this.timeOffset);return pe.samples=parseSamples(ee,ue),{videoTrack:ue,audioTrack:dummyTrack(),id3Track:_e,textTrack:dummyTrack()}}extractID3Track(ee,ue){const pe=this.id3Track;if(ee.samples.length){const _e=findBox(ee.samples,["emsg"]);_e&&_e.forEach(Ne=>{const Ue=parseEmsg(Ne);if(emsgSchemePattern.test(Ue.schemeIdUri)){const Ge=isFiniteNumber(Ue.presentationTime)?Ue.presentationTime/Ue.timeScale:ue+Ue.presentationTimeDelta/Ue.timeScale;let qe=Ue.eventDuration===4294967295?Number.POSITIVE_INFINITY:Ue.eventDuration/Ue.timeScale;qe<=.001&&(qe=Number.POSITIVE_INFINITY);const Ke=Ue.payload;pe.samples.push({data:Ke,len:Ke.byteLength,dts:Ge,pts:Ge,type:MetadataSchema.emsg,duration:qe})}})}return pe}demuxSampleAes(ee,ue,pe){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){}}let chromeVersion$1=null;const BitratesMap=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot=[0,1,1,4];function appendFrame(fe,ee,ue,pe,_e){if(ue+24>ee.length)return;const Ne=parseHeader(ee,ue);if(Ne&&ue+Ne.frameLength<=ee.length){const Ue=Ne.samplesPerFrame*9e4/Ne.sampleRate,Ge=pe+_e*Ue,qe={unit:ee.subarray(ue,ue+Ne.frameLength),pts:Ge,dts:Ge};return fe.config=[],fe.channelCount=Ne.channelCount,fe.samplerate=Ne.sampleRate,fe.samples.push(qe),{sample:qe,length:Ne.frameLength,missing:0}}}function parseHeader(fe,ee){const ue=fe[ee+1]>>3&3,pe=fe[ee+1]>>1&3,_e=fe[ee+2]>>4&15,Ne=fe[ee+2]>>2&3;if(ue!==1&&_e!==0&&_e!==15&&Ne!==3){const Ue=fe[ee+2]>>1&1,Ge=fe[ee+3]>>6,qe=ue===3?3-pe:pe===3?3:4,Ke=BitratesMap[qe*14+_e-1]*1e3,Ze=SamplingRateMap[(ue===3?0:ue===2?1:2)*3+Ne],Xe=Ge===3?1:2,Je=SamplesCoefficients[ue][pe],tt=BytesInSlot[pe],rt=Je*8*tt,et=Math.floor(Je*Ke/Ze+Ue)*tt;if(chromeVersion$1===null){const st=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);chromeVersion$1=st?parseInt(st[1]):0}return!!chromeVersion$1&&chromeVersion$1<=87&&pe===2&&Ke>=224e3&&Ge===0&&(fe[ee+3]=fe[ee+3]|128),{sampleRate:Ze,channelCount:Xe,frameLength:et,samplesPerFrame:rt}}}function isHeaderPattern(fe,ee){return fe[ee]===255&&(fe[ee+1]&224)===224&&(fe[ee+1]&6)!==0}function isHeader(fe,ee){return ee+1<fe.length&&isHeaderPattern(fe,ee)}function canParse(fe,ee){return isHeaderPattern(fe,ee)&&4<=fe.length-ee}function probe(fe,ee){if(ee+1<fe.length&&isHeaderPattern(fe,ee)){const pe=parseHeader(fe,ee);let _e=4;pe!=null&&pe.frameLength&&(_e=pe.frameLength);const Ne=ee+_e;return Ne===fe.length||isHeader(fe,Ne)}return!1}class ExpGolomb{constructor(ee){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=ee,this.bytesAvailable=ee.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const ee=this.data,ue=this.bytesAvailable,pe=ee.byteLength-ue,_e=new Uint8Array(4),Ne=Math.min(4,ue);if(Ne===0)throw new Error("no bytes available");_e.set(ee.subarray(pe,pe+Ne)),this.word=new DataView(_e.buffer).getUint32(0),this.bitsAvailable=Ne*8,this.bytesAvailable-=Ne}skipBits(ee){let ue;ee=Math.min(ee,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>ee?(this.word<<=ee,this.bitsAvailable-=ee):(ee-=this.bitsAvailable,ue=ee>>3,ee-=ue<<3,this.bytesAvailable-=ue,this.loadWord(),this.word<<=ee,this.bitsAvailable-=ee)}readBits(ee){let ue=Math.min(this.bitsAvailable,ee);const pe=this.word>>>32-ue;if(ee>32&&logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=ue,this.bitsAvailable>0)this.word<<=ue;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return ue=ee-ue,ue>0&&this.bitsAvailable?pe<<ue|this.readBits(ue):pe}skipLZ(){let ee;for(ee=0;ee<this.bitsAvailable;++ee)if(this.word&2147483648>>>ee)return this.word<<=ee,this.bitsAvailable-=ee,ee;return this.loadWord(),ee+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const ee=this.skipLZ();return this.readBits(ee+1)-1}readEG(){const ee=this.readUEG();return 1&ee?1+ee>>>1:-1*(ee>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}skipScalingList(ee){let ue=8,pe=8,_e;for(let Ne=0;Ne<ee;Ne++)pe!==0&&(_e=this.readEG(),pe=(ue+_e+256)%256),ue=pe===0?ue:pe}readSPS(){let ee=0,ue=0,pe=0,_e=0,Ne,Ue,Ge;const qe=this.readUByte.bind(this),Ke=this.readBits.bind(this),Ye=this.readUEG.bind(this),Ze=this.readBoolean.bind(this),Xe=this.skipBits.bind(this),Je=this.skipEG.bind(this),tt=this.skipUEG.bind(this),rt=this.skipScalingList.bind(this);qe();const et=qe();if(Ke(5),Xe(3),qe(),tt(),et===100||et===110||et===122||et===244||et===44||et===83||et===86||et===118||et===128){const jr=Ye();if(jr===3&&Xe(1),tt(),tt(),Xe(1),Ze())for(Ue=jr!==3?8:12,Ge=0;Ge<Ue;Ge++)Ze()&&(Ge<6?rt(16):rt(64))}tt();const it=Ye();if(it===0)Ye();else if(it===1)for(Xe(1),Je(),Je(),Ne=Ye(),Ge=0;Ge<Ne;Ge++)Je();tt(),Xe(1);const nt=Ye(),st=Ye(),lt=Ke(1);lt===0&&Xe(1),Xe(1),Ze()&&(ee=Ye(),ue=Ye(),pe=Ye(),_e=Ye());let _r=[1,1];if(Ze()&&Ze())switch(qe()){case 1:_r=[1,1];break;case 2:_r=[12,11];break;case 3:_r=[10,11];break;case 4:_r=[16,11];break;case 5:_r=[40,33];break;case 6:_r=[24,11];break;case 7:_r=[20,11];break;case 8:_r=[32,11];break;case 9:_r=[80,33];break;case 10:_r=[18,11];break;case 11:_r=[15,11];break;case 12:_r=[64,33];break;case 13:_r=[160,99];break;case 14:_r=[4,3];break;case 15:_r=[3,2];break;case 16:_r=[2,1];break;case 255:{_r=[qe()<<8|qe(),qe()<<8|qe()];break}}return{width:Math.ceil((nt+1)*16-ee*2-ue*2),height:(2-lt)*(st+1)*16-(lt?2:4)*(pe+_e),pixelRatio:_r}}readSliceType(){return this.readUByte(),this.readUEG(),this.readUEG()}}class SampleAesDecrypter{constructor(ee,ue,pe){this.keyData=void 0,this.decrypter=void 0,this.keyData=pe,this.decrypter=new Decrypter(ue,{removePKCS7Padding:!1})}decryptBuffer(ee){return this.decrypter.decrypt(ee,this.keyData.key.buffer,this.keyData.iv.buffer)}decryptAacSample(ee,ue,pe){const _e=ee[ue].unit;if(_e.length<=16)return;const Ne=_e.subarray(16,_e.length-_e.length%16),Ue=Ne.buffer.slice(Ne.byteOffset,Ne.byteOffset+Ne.length);this.decryptBuffer(Ue).then(Ge=>{const qe=new Uint8Array(Ge);_e.set(qe,16),this.decrypter.isSync()||this.decryptAacSamples(ee,ue+1,pe)})}decryptAacSamples(ee,ue,pe){for(;;ue++){if(ue>=ee.length){pe();return}if(!(ee[ue].unit.length<32)&&(this.decryptAacSample(ee,ue,pe),!this.decrypter.isSync()))return}}getAvcEncryptedData(ee){const ue=Math.floor((ee.length-48)/160)*16+16,pe=new Int8Array(ue);let _e=0;for(let Ne=32;Ne<ee.length-16;Ne+=160,_e+=16)pe.set(ee.subarray(Ne,Ne+16),_e);return pe}getAvcDecryptedUnit(ee,ue){const pe=new Uint8Array(ue);let _e=0;for(let Ne=32;Ne<ee.length-16;Ne+=160,_e+=16)ee.set(pe.subarray(_e,_e+16),Ne);return ee}decryptAvcSample(ee,ue,pe,_e,Ne){const Ue=discardEPB(Ne.data),Ge=this.getAvcEncryptedData(Ue);this.decryptBuffer(Ge.buffer).then(qe=>{Ne.data=this.getAvcDecryptedUnit(Ue,qe),this.decrypter.isSync()||this.decryptAvcSamples(ee,ue,pe+1,_e)})}decryptAvcSamples(ee,ue,pe,_e){if(ee instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;ue++,pe=0){if(ue>=ee.length){_e();return}const Ne=ee[ue].units;for(;!(pe>=Ne.length);pe++){const Ue=Ne[pe];if(!(Ue.data.length<=48||Ue.type!==1&&Ue.type!==5)&&(this.decryptAvcSample(ee,ue,pe,_e,Ue),!this.decrypter.isSync()))return}}}}const PACKET_LENGTH=188;class TSDemuxer{constructor(ee,ue,pe){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=ee,this.config=ue,this.typeSupported=pe}static probe(ee){const ue=TSDemuxer.syncOffset(ee);return ue>0&&logger.warn(`MPEG2-TS detected but first sync word found @ offset ${ue}`),ue!==-1}static syncOffset(ee){const ue=ee.length;let pe=Math.min(PACKET_LENGTH*5,ee.length-PACKET_LENGTH)+1,_e=0;for(;_e<pe;){let Ne=!1,Ue=-1,Ge=0;for(let qe=_e;qe<ue;qe+=PACKET_LENGTH)if(ee[qe]===71){if(Ge++,Ue===-1&&(Ue=qe,Ue!==0&&(pe=Math.min(Ue+PACKET_LENGTH*99,ee.length-PACKET_LENGTH)+1)),Ne||(Ne=parsePID(ee,qe)===0),Ne&&Ge>1&&(Ue===0&&Ge>2||qe+PACKET_LENGTH>pe))return Ue}else{if(Ge)return-1;break}_e++}return-1}static createTrack(ee,ue){return{container:ee==="video"||ee==="audio"?"video/mp2t":void 0,type:ee,id:RemuxerTrackIdConfig[ee],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:ee==="audio"?ue:void 0}}resetInitSegment(ee,ue,pe,_e){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=TSDemuxer.createTrack("video"),this._audioTrack=TSDemuxer.createTrack("audio",_e),this._id3Track=TSDemuxer.createTrack("id3"),this._txtTrack=TSDemuxer.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=ue,this.videoCodec=pe,this._duration=_e}resetTimeStamp(){}resetContiguity(){const{_audioTrack:ee,_avcTrack:ue,_id3Track:pe}=this;ee&&(ee.pesData=null),ue&&(ue.pesData=null),pe&&(pe.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null}demux(ee,ue,pe=!1,_e=!1){pe||(this.sampleAes=null);let Ne;const Ue=this._avcTrack,Ge=this._audioTrack,qe=this._id3Track,Ke=this._txtTrack;let Ye=Ue.pid,Ze=Ue.pesData,Xe=Ge.pid,Je=qe.pid,tt=Ge.pesData,rt=qe.pesData,et=null,it=this.pmtParsed,nt=this._pmtId,st=ee.length;if(this.remainderData&&(ee=appendUint8Array(this.remainderData,ee),st=ee.length,this.remainderData=null),st<PACKET_LENGTH&&!_e)return this.remainderData=ee,{audioTrack:Ge,videoTrack:Ue,id3Track:qe,textTrack:Ke};const lt=Math.max(0,TSDemuxer.syncOffset(ee));st-=(st-lt)%PACKET_LENGTH,st<ee.byteLength&&!_e&&(this.remainderData=new Uint8Array(ee.buffer,st,ee.buffer.byteLength-st));let _r=0;for(let Nr=lt;Nr<st;Nr+=PACKET_LENGTH)if(ee[Nr]===71){const Wr=!!(ee[Nr+1]&64),ri=parsePID(ee,Nr),Xr=(ee[Nr+3]&48)>>4;let Gr;if(Xr>1){if(Gr=Nr+5+ee[Nr+4],Gr===Nr+PACKET_LENGTH)continue}else Gr=Nr+4;switch(ri){case Ye:Wr&&(Ze&&(Ne=parsePES(Ze))&&this.parseAVCPES(Ue,Ke,Ne,!1),Ze={data:[],size:0}),Ze&&(Ze.data.push(ee.subarray(Gr,Nr+PACKET_LENGTH)),Ze.size+=Nr+PACKET_LENGTH-Gr);break;case Xe:if(Wr){if(tt&&(Ne=parsePES(tt)))switch(Ge.segmentCodec){case"aac":this.parseAACPES(Ge,Ne);break;case"mp3":this.parseMPEGPES(Ge,Ne);break}tt={data:[],size:0}}tt&&(tt.data.push(ee.subarray(Gr,Nr+PACKET_LENGTH)),tt.size+=Nr+PACKET_LENGTH-Gr);break;case Je:Wr&&(rt&&(Ne=parsePES(rt))&&this.parseID3PES(qe,Ne),rt={data:[],size:0}),rt&&(rt.data.push(ee.subarray(Gr,Nr+PACKET_LENGTH)),rt.size+=Nr+PACKET_LENGTH-Gr);break;case 0:Wr&&(Gr+=ee[Gr]+1),nt=this._pmtId=parsePAT(ee,Gr);break;case nt:{Wr&&(Gr+=ee[Gr]+1);const qr=parsePMT(ee,Gr,this.typeSupported,pe);Ye=qr.avc,Ye>0&&(Ue.pid=Ye),Xe=qr.audio,Xe>0&&(Ge.pid=Xe,Ge.segmentCodec=qr.segmentCodec),Je=qr.id3,Je>0&&(qe.pid=Je),et!==null&&!it&&(logger.warn(`MPEG-TS PMT found at ${Nr} after unknown PID '${et}'. Backtracking to sync byte @${lt} to parse all TS packets.`),et=null,Nr=lt-188),it=this.pmtParsed=!0;break}case 17:case 8191:break;default:et=ri;break}}else _r++;if(_r>0){const Nr=new Error(`Found ${_r} TS packet/s that do not start with 0x47`);this.observer.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,error:Nr,reason:Nr.message})}Ue.pesData=Ze,Ge.pesData=tt,qe.pesData=rt;const jr={audioTrack:Ge,videoTrack:Ue,id3Track:qe,textTrack:Ke};return _e&&this.extractRemainingSamples(jr),jr}flush(){const{remainderData:ee}=this;this.remainderData=null;let ue;return ee?ue=this.demux(ee,-1,!1,!0):ue={videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(ue),this.sampleAes?this.decrypt(ue,this.sampleAes):ue}extractRemainingSamples(ee){const{audioTrack:ue,videoTrack:pe,id3Track:_e,textTrack:Ne}=ee,Ue=pe.pesData,Ge=ue.pesData,qe=_e.pesData;let Ke;if(Ue&&(Ke=parsePES(Ue))?(this.parseAVCPES(pe,Ne,Ke,!0),pe.pesData=null):pe.pesData=Ue,Ge&&(Ke=parsePES(Ge))){switch(ue.segmentCodec){case"aac":this.parseAACPES(ue,Ke);break;case"mp3":this.parseMPEGPES(ue,Ke);break}ue.pesData=null}else Ge!=null&&Ge.size&&logger.log("last AAC PES packet truncated,might overlap between fragments"),ue.pesData=Ge;qe&&(Ke=parsePES(qe))?(this.parseID3PES(_e,Ke),_e.pesData=null):_e.pesData=qe}demuxSampleAes(ee,ue,pe){const _e=this.demux(ee,pe,!0,!this.config.progressive),Ne=this.sampleAes=new SampleAesDecrypter(this.observer,this.config,ue);return this.decrypt(_e,Ne)}decrypt(ee,ue){return new Promise(pe=>{const{audioTrack:_e,videoTrack:Ne}=ee;_e.samples&&_e.segmentCodec==="aac"?ue.decryptAacSamples(_e.samples,0,()=>{Ne.samples?ue.decryptAvcSamples(Ne.samples,0,0,()=>{pe(ee)}):pe(ee)}):Ne.samples&&ue.decryptAvcSamples(Ne.samples,0,0,()=>{pe(ee)})})}destroy(){this._duration=0}parseAVCPES(ee,ue,pe,_e){const Ne=this.parseAVCNALu(ee,pe.data);let Ue=this.avcSample,Ge,qe=!1;pe.data=null,Ue&&Ne.length&&!ee.audFound&&(pushAccessUnit(Ue,ee),Ue=this.avcSample=createAVCSample(!1,pe.pts,pe.dts,"")),Ne.forEach(Ke=>{var Ye;switch(Ke.type){case 1:{let Xe=!1;Ge=!0;const Je=Ke.data;if(qe&&Je.length>4){const tt=new ExpGolomb(Je).readSliceType();(tt===2||tt===4||tt===7||tt===9)&&(Xe=!0)}if(Xe){var Ze;(Ze=Ue)!=null&&Ze.frame&&!Ue.key&&(pushAccessUnit(Ue,ee),Ue=this.avcSample=null)}Ue||(Ue=this.avcSample=createAVCSample(!0,pe.pts,pe.dts,"")),Ue.frame=!0,Ue.key=Xe;break}case 5:Ge=!0,(Ye=Ue)!=null&&Ye.frame&&!Ue.key&&(pushAccessUnit(Ue,ee),Ue=this.avcSample=null),Ue||(Ue=this.avcSample=createAVCSample(!0,pe.pts,pe.dts,"")),Ue.key=!0,Ue.frame=!0;break;case 6:{Ge=!0,parseSEIMessageFromNALu(Ke.data,1,pe.pts,ue.samples);break}case 7:if(Ge=!0,qe=!0,!ee.sps){const Xe=Ke.data,tt=new ExpGolomb(Xe).readSPS();ee.width=tt.width,ee.height=tt.height,ee.pixelRatio=tt.pixelRatio,ee.sps=[Xe],ee.duration=this._duration;const rt=Xe.subarray(1,4);let et="avc1.";for(let it=0;it<3;it++){let nt=rt[it].toString(16);nt.length<2&&(nt="0"+nt),et+=nt}ee.codec=et}break;case 8:Ge=!0,ee.pps||(ee.pps=[Ke.data]);break;case 9:Ge=!1,ee.audFound=!0,Ue&&pushAccessUnit(Ue,ee),Ue=this.avcSample=createAVCSample(!1,pe.pts,pe.dts,"");break;case 12:Ge=!0;break;default:Ge=!1,Ue&&(Ue.debug+="unknown NAL "+Ke.type+" ");break}Ue&&Ge&&Ue.units.push(Ke)}),_e&&Ue&&(pushAccessUnit(Ue,ee),this.avcSample=null)}getLastNalUnit(ee){var ue;let pe=this.avcSample,_e;if((!pe||pe.units.length===0)&&(pe=ee[ee.length-1]),(ue=pe)!=null&&ue.units){const Ne=pe.units;_e=Ne[Ne.length-1]}return _e}parseAVCNALu(ee,ue){const pe=ue.byteLength;let _e=ee.naluState||0;const Ne=_e,Ue=[];let Ge=0,qe,Ke,Ye,Ze=-1,Xe=0;for(_e===-1&&(Ze=0,Xe=ue[0]&31,_e=0,Ge=1);Ge<pe;){if(qe=ue[Ge++],!_e){_e=qe?0:1;continue}if(_e===1){_e=qe?0:2;continue}if(!qe)_e=3;else if(qe===1){if(Ze>=0){const Je={data:ue.subarray(Ze,Ge-_e-1),type:Xe};Ue.push(Je)}else{const Je=this.getLastNalUnit(ee.samples);if(Je&&(Ne&&Ge<=4-Ne&&Je.state&&(Je.data=Je.data.subarray(0,Je.data.byteLength-Ne)),Ke=Ge-_e-1,Ke>0)){const tt=new Uint8Array(Je.data.byteLength+Ke);tt.set(Je.data,0),tt.set(ue.subarray(0,Ke),Je.data.byteLength),Je.data=tt,Je.state=0}}Ge<pe?(Ye=ue[Ge]&31,Ze=Ge,Xe=Ye,_e=0):_e=-1}else _e=0}if(Ze>=0&&_e>=0){const Je={data:ue.subarray(Ze,pe),type:Xe,state:_e};Ue.push(Je)}if(Ue.length===0){const Je=this.getLastNalUnit(ee.samples);if(Je){const tt=new Uint8Array(Je.data.byteLength+ue.byteLength);tt.set(Je.data,0),tt.set(ue,Je.data.byteLength),Je.data=tt}}return ee.naluState=_e,Ue}parseAACPES(ee,ue){let pe=0;const _e=this.aacOverFlow;let Ne=ue.data;if(_e){this.aacOverFlow=null;const Ze=_e.missing,Xe=_e.sample.unit.byteLength;if(Ze===-1){const Je=new Uint8Array(Xe+Ne.byteLength);Je.set(_e.sample.unit,0),Je.set(Ne,Xe),Ne=Je}else{const Je=Xe-Ze;_e.sample.unit.set(Ne.subarray(0,Ze),Je),ee.samples.push(_e.sample),pe=_e.missing}}let Ue,Ge;for(Ue=pe,Ge=Ne.length;Ue<Ge-1&&!isHeader$1(Ne,Ue);Ue++);if(Ue!==pe){let Ze;const Xe=Ue<Ge-1;Xe?Ze=`AAC PES did not start with ADTS header,offset:${Ue}`:Ze="No ADTS header found in AAC PES";const Je=new Error(Ze);if(logger.warn(`parsing error: ${Ze}`),this.observer.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,levelRetry:Xe,error:Je,reason:Ze}),!Xe)return}initTrackConfig(ee,this.observer,Ne,Ue,this.audioCodec);let qe;if(ue.pts!==void 0)qe=ue.pts;else if(_e){const Ze=getFrameDuration(ee.samplerate);qe=_e.sample.pts+Ze}else{logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let Ke=0,Ye;for(;Ue<Ge;)if(Ye=appendFrame$1(ee,Ne,Ue,qe,Ke),Ue+=Ye.length,Ye.missing){this.aacOverFlow=Ye;break}else for(Ke++;Ue<Ge-1&&!isHeader$1(Ne,Ue);Ue++);}parseMPEGPES(ee,ue){const pe=ue.data,_e=pe.length;let Ne=0,Ue=0;const Ge=ue.pts;if(Ge===void 0){logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;Ue<_e;)if(isHeader(pe,Ue)){const qe=appendFrame(ee,pe,Ue,Ge,Ne);if(qe)Ue+=qe.length,Ne++;else break}else Ue++}parseID3PES(ee,ue){if(ue.pts===void 0){logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const pe=_extends({},ue,{type:this._avcTrack?MetadataSchema.emsg:MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});ee.samples.push(pe)}}function createAVCSample(fe,ee,ue,pe){return{key:fe,frame:!1,pts:ee,dts:ue,units:[],debug:pe,length:0}}function parsePID(fe,ee){return((fe[ee+1]&31)<<8)+fe[ee+2]}function parsePAT(fe,ee){return(fe[ee+10]&31)<<8|fe[ee+11]}function parsePMT(fe,ee,ue,pe){const _e={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},Ne=(fe[ee+1]&15)<<8|fe[ee+2],Ue=ee+3+Ne-4,Ge=(fe[ee+10]&15)<<8|fe[ee+11];for(ee+=12+Ge;ee<Ue;){const qe=parsePID(fe,ee);switch(fe[ee]){case 207:if(!pe){logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:_e.audio===-1&&(_e.audio=qe);break;case 21:_e.id3===-1&&(_e.id3=qe);break;case 219:if(!pe){logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:_e.avc===-1&&(_e.avc=qe);break;case 3:case 4:ue.mpeg!==!0&&ue.mp3!==!0?logger.log("MPEG audio found, not supported in this browser"):_e.audio===-1&&(_e.audio=qe,_e.segmentCodec="mp3");break;case 36:logger.warn("Unsupported HEVC stream type found");break}ee+=((fe[ee+3]&15)<<8|fe[ee+4])+5}return _e}function parsePES(fe){let ee=0,ue,pe,_e,Ne,Ue;const Ge=fe.data;if(!fe||fe.size===0)return null;for(;Ge[0].length<19&&Ge.length>1;){const Ke=new Uint8Array(Ge[0].length+Ge[1].length);Ke.set(Ge[0]),Ke.set(Ge[1],Ge[0].length),Ge[0]=Ke,Ge.splice(1,1)}if(ue=Ge[0],(ue[0]<<16)+(ue[1]<<8)+ue[2]===1){if(pe=(ue[4]<<8)+ue[5],pe&&pe>fe.size-6)return null;const Ke=ue[7];Ke&192&&(Ne=(ue[9]&14)*536870912+(ue[10]&255)*4194304+(ue[11]&254)*16384+(ue[12]&255)*128+(ue[13]&254)/2,Ke&64?(Ue=(ue[14]&14)*536870912+(ue[15]&255)*4194304+(ue[16]&254)*16384+(ue[17]&255)*128+(ue[18]&254)/2,Ne-Ue>60*9e4&&(logger.warn(`${Math.round((Ne-Ue)/9e4)}s delta between PTS and DTS, align them`),Ne=Ue)):Ue=Ne),_e=ue[8];let Ye=_e+9;if(fe.size<=Ye)return null;fe.size-=Ye;const Ze=new Uint8Array(fe.size);for(let Xe=0,Je=Ge.length;Xe<Je;Xe++){ue=Ge[Xe];let tt=ue.byteLength;if(Ye)if(Ye>tt){Ye-=tt;continue}else ue=ue.subarray(Ye),tt-=Ye,Ye=0;Ze.set(ue,ee),ee+=tt}return pe&&(pe-=_e+3),{data:Ze,pts:Ne,dts:Ue,len:pe}}return null}function pushAccessUnit(fe,ee){if(fe.units.length&&fe.frame){if(fe.pts===void 0){const ue=ee.samples,pe=ue.length;if(pe){const _e=ue[pe-1];fe.pts=_e.pts,fe.dts=_e.dts}else{ee.dropped++;return}}ee.samples.push(fe)}fe.debug.length&&logger.log(fe.pts+"/"+fe.dts+":"+fe.debug)}class MP3Demuxer extends BaseAudioDemuxer{resetInitSegment(ee,ue,pe,_e){super.resetInitSegment(ee,ue,pe,_e),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:ue,duration:_e,inputTimeScale:9e4,dropped:0}}static probe(ee){if(!ee)return!1;let pe=(getID3Data(ee,0)||[]).length;for(let _e=ee.length;pe<_e;pe++)if(probe(ee,pe))return logger.log("MPEG Audio sync word found !"),!0;return!1}canParse(ee,ue){return canParse(ee,ue)}appendFrame(ee,ue,pe){if(this.basePTS!==null)return appendFrame(ee,ue,pe,this.basePTS,this.frameIndex)}}class AAC{static getSilentFrame(ee,ue){switch(ee){case"mp4a.40.2":if(ue===1)return new Uint8Array([0,200,0,128,35,128]);if(ue===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(ue===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(ue===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(ue===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(ue===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(ue===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(ue===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(ue===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const UINT32_MAX=Math.pow(2,32)-1;class MP4{static init(){MP4.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let ee;for(ee in MP4.types)MP4.types.hasOwnProperty(ee)&&(MP4.types[ee]=[ee.charCodeAt(0),ee.charCodeAt(1),ee.charCodeAt(2),ee.charCodeAt(3)]);const ue=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),pe=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);MP4.HDLR_TYPES={video:ue,audio:pe};const _e=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),Ne=new Uint8Array([0,0,0,0,0,0,0,0]);MP4.STTS=MP4.STSC=MP4.STCO=Ne,MP4.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),MP4.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),MP4.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),MP4.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const Ue=new Uint8Array([105,115,111,109]),Ge=new Uint8Array([97,118,99,49]),qe=new Uint8Array([0,0,0,1]);MP4.FTYP=MP4.box(MP4.types.ftyp,Ue,qe,Ue,Ge),MP4.DINF=MP4.box(MP4.types.dinf,MP4.box(MP4.types.dref,_e))}static box(ee,...ue){let pe=8,_e=ue.length;const Ne=_e;for(;_e--;)pe+=ue[_e].byteLength;const Ue=new Uint8Array(pe);for(Ue[0]=pe>>24&255,Ue[1]=pe>>16&255,Ue[2]=pe>>8&255,Ue[3]=pe&255,Ue.set(ee,4),_e=0,pe=8;_e<Ne;_e++)Ue.set(ue[_e],pe),pe+=ue[_e].byteLength;return Ue}static hdlr(ee){return MP4.box(MP4.types.hdlr,MP4.HDLR_TYPES[ee])}static mdat(ee){return MP4.box(MP4.types.mdat,ee)}static mdhd(ee,ue){ue*=ee;const pe=Math.floor(ue/(UINT32_MAX+1)),_e=Math.floor(ue%(UINT32_MAX+1));return MP4.box(MP4.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,ee>>24&255,ee>>16&255,ee>>8&255,ee&255,pe>>24,pe>>16&255,pe>>8&255,pe&255,_e>>24,_e>>16&255,_e>>8&255,_e&255,85,196,0,0]))}static mdia(ee){return MP4.box(MP4.types.mdia,MP4.mdhd(ee.timescale,ee.duration),MP4.hdlr(ee.type),MP4.minf(ee))}static mfhd(ee){return MP4.box(MP4.types.mfhd,new Uint8Array([0,0,0,0,ee>>24,ee>>16&255,ee>>8&255,ee&255]))}static minf(ee){return ee.type==="audio"?MP4.box(MP4.types.minf,MP4.box(MP4.types.smhd,MP4.SMHD),MP4.DINF,MP4.stbl(ee)):MP4.box(MP4.types.minf,MP4.box(MP4.types.vmhd,MP4.VMHD),MP4.DINF,MP4.stbl(ee))}static moof(ee,ue,pe){return MP4.box(MP4.types.moof,MP4.mfhd(ee),MP4.traf(pe,ue))}static moov(ee){let ue=ee.length;const pe=[];for(;ue--;)pe[ue]=MP4.trak(ee[ue]);return MP4.box.apply(null,[MP4.types.moov,MP4.mvhd(ee[0].timescale,ee[0].duration)].concat(pe).concat(MP4.mvex(ee)))}static mvex(ee){let ue=ee.length;const pe=[];for(;ue--;)pe[ue]=MP4.trex(ee[ue]);return MP4.box.apply(null,[MP4.types.mvex,...pe])}static mvhd(ee,ue){ue*=ee;const pe=Math.floor(ue/(UINT32_MAX+1)),_e=Math.floor(ue%(UINT32_MAX+1)),Ne=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,ee>>24&255,ee>>16&255,ee>>8&255,ee&255,pe>>24,pe>>16&255,pe>>8&255,pe&255,_e>>24,_e>>16&255,_e>>8&255,_e&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return MP4.box(MP4.types.mvhd,Ne)}static sdtp(ee){const ue=ee.samples||[],pe=new Uint8Array(4+ue.length);let _e,Ne;for(_e=0;_e<ue.length;_e++)Ne=ue[_e].flags,pe[_e+4]=Ne.dependsOn<<4|Ne.isDependedOn<<2|Ne.hasRedundancy;return MP4.box(MP4.types.sdtp,pe)}static stbl(ee){return MP4.box(MP4.types.stbl,MP4.stsd(ee),MP4.box(MP4.types.stts,MP4.STTS),MP4.box(MP4.types.stsc,MP4.STSC),MP4.box(MP4.types.stsz,MP4.STSZ),MP4.box(MP4.types.stco,MP4.STCO))}static avc1(ee){let ue=[],pe=[],_e,Ne,Ue;for(_e=0;_e<ee.sps.length;_e++)Ne=ee.sps[_e],Ue=Ne.byteLength,ue.push(Ue>>>8&255),ue.push(Ue&255),ue=ue.concat(Array.prototype.slice.call(Ne));for(_e=0;_e<ee.pps.length;_e++)Ne=ee.pps[_e],Ue=Ne.byteLength,pe.push(Ue>>>8&255),pe.push(Ue&255),pe=pe.concat(Array.prototype.slice.call(Ne));const Ge=MP4.box(MP4.types.avcC,new Uint8Array([1,ue[3],ue[4],ue[5],255,224|ee.sps.length].concat(ue).concat([ee.pps.length]).concat(pe))),qe=ee.width,Ke=ee.height,Ye=ee.pixelRatio[0],Ze=ee.pixelRatio[1];return MP4.box(MP4.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,qe>>8&255,qe&255,Ke>>8&255,Ke&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),Ge,MP4.box(MP4.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),MP4.box(MP4.types.pasp,new Uint8Array([Ye>>24,Ye>>16&255,Ye>>8&255,Ye&255,Ze>>24,Ze>>16&255,Ze>>8&255,Ze&255])))}static esds(ee){const ue=ee.config.length;return new Uint8Array([0,0,0,0,3,23+ue,0,1,0,4,15+ue,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([ue]).concat(ee.config).concat([6,1,2]))}static mp4a(ee){const ue=ee.samplerate;return MP4.box(MP4.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,ee.channelCount,0,16,0,0,0,0,ue>>8&255,ue&255,0,0]),MP4.box(MP4.types.esds,MP4.esds(ee)))}static mp3(ee){const ue=ee.samplerate;return MP4.box(MP4.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,ee.channelCount,0,16,0,0,0,0,ue>>8&255,ue&255,0,0]))}static stsd(ee){return ee.type==="audio"?ee.segmentCodec==="mp3"&&ee.codec==="mp3"?MP4.box(MP4.types.stsd,MP4.STSD,MP4.mp3(ee)):MP4.box(MP4.types.stsd,MP4.STSD,MP4.mp4a(ee)):MP4.box(MP4.types.stsd,MP4.STSD,MP4.avc1(ee))}static tkhd(ee){const ue=ee.id,pe=ee.duration*ee.timescale,_e=ee.width,Ne=ee.height,Ue=Math.floor(pe/(UINT32_MAX+1)),Ge=Math.floor(pe%(UINT32_MAX+1));return MP4.box(MP4.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,ue>>24&255,ue>>16&255,ue>>8&255,ue&255,0,0,0,0,Ue>>24,Ue>>16&255,Ue>>8&255,Ue&255,Ge>>24,Ge>>16&255,Ge>>8&255,Ge&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,_e>>8&255,_e&255,0,0,Ne>>8&255,Ne&255,0,0]))}static traf(ee,ue){const pe=MP4.sdtp(ee),_e=ee.id,Ne=Math.floor(ue/(UINT32_MAX+1)),Ue=Math.floor(ue%(UINT32_MAX+1));return MP4.box(MP4.types.traf,MP4.box(MP4.types.tfhd,new Uint8Array([0,0,0,0,_e>>24,_e>>16&255,_e>>8&255,_e&255])),MP4.box(MP4.types.tfdt,new Uint8Array([1,0,0,0,Ne>>24,Ne>>16&255,Ne>>8&255,Ne&255,Ue>>24,Ue>>16&255,Ue>>8&255,Ue&255])),MP4.trun(ee,pe.length+16+20+8+16+8+8),pe)}static trak(ee){return ee.duration=ee.duration||4294967295,MP4.box(MP4.types.trak,MP4.tkhd(ee),MP4.mdia(ee))}static trex(ee){const ue=ee.id;return MP4.box(MP4.types.trex,new Uint8Array([0,0,0,0,ue>>24,ue>>16&255,ue>>8&255,ue&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(ee,ue){const pe=ee.samples||[],_e=pe.length,Ne=12+16*_e,Ue=new Uint8Array(Ne);let Ge,qe,Ke,Ye,Ze,Xe;for(ue+=8+Ne,Ue.set([ee.type==="video"?1:0,0,15,1,_e>>>24&255,_e>>>16&255,_e>>>8&255,_e&255,ue>>>24&255,ue>>>16&255,ue>>>8&255,ue&255],0),Ge=0;Ge<_e;Ge++)qe=pe[Ge],Ke=qe.duration,Ye=qe.size,Ze=qe.flags,Xe=qe.cts,Ue.set([Ke>>>24&255,Ke>>>16&255,Ke>>>8&255,Ke&255,Ye>>>24&255,Ye>>>16&255,Ye>>>8&255,Ye&255,Ze.isLeading<<2|Ze.dependsOn,Ze.isDependedOn<<6|Ze.hasRedundancy<<4|Ze.paddingValue<<1|Ze.isNonSync,Ze.degradPrio&61440,Ze.degradPrio&15,Xe>>>24&255,Xe>>>16&255,Xe>>>8&255,Xe&255],12+16*Ge);return MP4.box(MP4.types.trun,Ue)}static initSegment(ee){MP4.types||MP4.init();const ue=MP4.moov(ee),pe=new Uint8Array(MP4.FTYP.byteLength+ue.byteLength);return pe.set(MP4.FTYP),pe.set(ue,MP4.FTYP.byteLength),pe}}MP4.types=void 0;MP4.HDLR_TYPES=void 0;MP4.STTS=void 0;MP4.STSC=void 0;MP4.STCO=void 0;MP4.STSZ=void 0;MP4.VMHD=void 0;MP4.SMHD=void 0;MP4.STSD=void 0;MP4.FTYP=void 0;MP4.DINF=void 0;const MPEG_TS_CLOCK_FREQ_HZ=9e4;function toTimescaleFromBase(fe,ee,ue=1,pe=!1){const _e=fe*ee*ue;return pe?Math.round(_e):_e}function toTimescaleFromScale(fe,ee,ue=1,pe=!1){return toTimescaleFromBase(fe,ee,1/ue,pe)}function toMsFromMpegTsClock(fe,ee=!1){return toTimescaleFromBase(fe,1e3,1/MPEG_TS_CLOCK_FREQ_HZ,ee)}function toMpegTsClockFromTimescale(fe,ee=1){return toTimescaleFromBase(fe,MPEG_TS_CLOCK_FREQ_HZ,1/ee)}const MAX_SILENT_FRAME_DURATION=10*1e3,AAC_SAMPLES_PER_FRAME=1024,MPEG_AUDIO_SAMPLE_PER_FRAME=1152;let chromeVersion=null,safariWebkitVersion=null;class MP4Remuxer{constructor(ee,ue,pe,_e=""){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=ee,this.config=ue,this.typeSupported=pe,this.ISGenerated=!1,chromeVersion===null){const Ue=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);chromeVersion=Ue?parseInt(Ue[1]):0}if(safariWebkitVersion===null){const Ne=navigator.userAgent.match(/Safari\/(\d+)/i);safariWebkitVersion=Ne?parseInt(Ne[1]):0}}destroy(){}resetTimeStamp(ee){logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=ee}resetNextTimestamp(){logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1}getVideoStartPts(ee){let ue=!1;const pe=ee.reduce((_e,Ne)=>{const Ue=Ne.pts-_e;return Ue<-4294967296?(ue=!0,normalizePts(_e,Ne.pts)):Ue>0?_e:Ne.pts},ee[0].pts);return ue&&logger.debug("PTS rollover detected"),pe}remux(ee,ue,pe,_e,Ne,Ue,Ge,qe){let Ke,Ye,Ze,Xe,Je,tt,rt=Ne,et=Ne;const it=ee.pid>-1,nt=ue.pid>-1,st=ue.samples.length,lt=ee.samples.length>0,_r=Ge&&st>0||st>1;if((!it||lt)&&(!nt||_r)||this.ISGenerated||Ge){this.ISGenerated||(Ze=this.generateIS(ee,ue,Ne,Ue));const Nr=this.isVideoContiguous;let Wr=-1,ri;if(_r&&(Wr=findKeyframeIndex(ue.samples),!Nr&&this.config.forceKeyFrameOnDiscontinuity))if(tt=!0,Wr>0){logger.warn(`[mp4-remuxer]: Dropped ${Wr} out of ${st} video samples due to a missing keyframe`);const Xr=this.getVideoStartPts(ue.samples);ue.samples=ue.samples.slice(Wr),ue.dropped+=Wr,et+=(ue.samples[0].pts-Xr)/ue.inputTimeScale,ri=et}else Wr===-1&&(logger.warn(`[mp4-remuxer]: No keyframe found out of ${st} video samples`),tt=!1);if(this.ISGenerated){if(lt&&_r){const Xr=this.getVideoStartPts(ue.samples),qr=(normalizePts(ee.samples[0].pts,Xr)-Xr)/ue.inputTimeScale;rt+=Math.max(0,qr),et+=Math.max(0,-qr)}if(lt){if(ee.samplerate||(logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),Ze=this.generateIS(ee,ue,Ne,Ue)),Ye=this.remuxAudio(ee,rt,this.isAudioContiguous,Ue,nt||_r||qe===PlaylistLevelType.AUDIO?et:void 0),_r){const Xr=Ye?Ye.endPTS-Ye.startPTS:0;ue.inputTimeScale||(logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),Ze=this.generateIS(ee,ue,Ne,Ue)),Ke=this.remuxVideo(ue,et,Nr,Xr)}}else _r&&(Ke=this.remuxVideo(ue,et,Nr,0));Ke&&(Ke.firstKeyFrame=Wr,Ke.independent=Wr!==-1,Ke.firstKeyFramePTS=ri)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(pe.samples.length&&(Je=flushTextTrackMetadataCueSamples(pe,Ne,this._initPTS,this._initDTS)),_e.samples.length&&(Xe=flushTextTrackUserdataCueSamples(_e,Ne,this._initPTS))),{audio:Ye,video:Ke,initSegment:Ze,independent:tt,text:Xe,id3:Je}}generateIS(ee,ue,pe,_e){const Ne=ee.samples,Ue=ue.samples,Ge=this.typeSupported,qe={},Ke=this._initPTS;let Ye=!Ke||_e,Ze="audio/mp4",Xe,Je,tt;if(Ye&&(Xe=Je=1/0),ee.config&&Ne.length){switch(ee.timescale=ee.samplerate,ee.segmentCodec){case"mp3":Ge.mpeg?(Ze="audio/mpeg",ee.codec=""):Ge.mp3&&(ee.codec="mp3");break}qe.audio={id:"audio",container:Ze,codec:ee.codec,initSegment:ee.segmentCodec==="mp3"&&Ge.mpeg?new Uint8Array(0):MP4.initSegment([ee]),metadata:{channelCount:ee.channelCount}},Ye&&(tt=ee.inputTimeScale,!Ke||tt!==Ke.timescale?Xe=Je=Ne[0].pts-Math.round(tt*pe):Ye=!1)}if(ue.sps&&ue.pps&&Ue.length&&(ue.timescale=ue.inputTimeScale,qe.video={id:"main",container:"video/mp4",codec:ue.codec,initSegment:MP4.initSegment([ue]),metadata:{width:ue.width,height:ue.height}},Ye))if(tt=ue.inputTimeScale,!Ke||tt!==Ke.timescale){const rt=this.getVideoStartPts(Ue),et=Math.round(tt*pe);Je=Math.min(Je,normalizePts(Ue[0].dts,rt)-et),Xe=Math.min(Xe,rt-et)}else Ye=!1;if(Object.keys(qe).length)return this.ISGenerated=!0,Ye?(this._initPTS={baseTime:Xe,timescale:tt},this._initDTS={baseTime:Je,timescale:tt}):Xe=tt=void 0,{tracks:qe,initPTS:Xe,timescale:tt}}remuxVideo(ee,ue,pe,_e){const Ne=ee.inputTimeScale,Ue=ee.samples,Ge=[],qe=Ue.length,Ke=this._initPTS;let Ye=this.nextAvcDts,Ze=8,Xe=this.videoSampleDuration,Je,tt,rt=Number.POSITIVE_INFINITY,et=Number.NEGATIVE_INFINITY,it=!1;if(!pe||Ye===null){const ni=ue*Ne,ui=Ue[0].pts-normalizePts(Ue[0].dts,Ue[0].pts);Ye=ni-ui}const nt=Ke.baseTime*Ne/Ke.timescale;for(let ni=0;ni<qe;ni++){const ui=Ue[ni];ui.pts=normalizePts(ui.pts-nt,Ye),ui.dts=normalizePts(ui.dts-nt,Ye),ui.dts<Ue[ni>0?ni-1:ni].dts&&(it=!0)}it&&Ue.sort(function(ni,ui){const yi=ni.dts-ui.dts,hi=ni.pts-ui.pts;return yi||hi}),Je=Ue[0].dts,tt=Ue[Ue.length-1].dts;const st=tt-Je,lt=st?Math.round(st/(qe-1)):Xe||ee.inputTimeScale/30;if(pe){const ni=Je-Ye,ui=ni>lt,yi=ni<-1;if((ui||yi)&&(ui?logger.warn(`AVC: ${toMsFromMpegTsClock(ni,!0)} ms (${ni}dts) hole between fragments detected, filling it`):logger.warn(`AVC: ${toMsFromMpegTsClock(-ni,!0)} ms (${ni}dts) overlapping between fragments detected`),!yi||Ye>=Ue[0].pts)){Je=Ye;const hi=Ue[0].pts-ni;Ue[0].dts=Je,Ue[0].pts=hi,logger.log(`Video: First PTS/DTS adjusted: ${toMsFromMpegTsClock(hi,!0)}/${toMsFromMpegTsClock(Je,!0)}, delta: ${toMsFromMpegTsClock(ni,!0)} ms`)}}Je=Math.max(0,Je);let _r=0,jr=0;for(let ni=0;ni<qe;ni++){const ui=Ue[ni],yi=ui.units,hi=yi.length;let pi=0;for(let Ri=0;Ri<hi;Ri++)pi+=yi[Ri].data.length;jr+=pi,_r+=hi,ui.length=pi,ui.dts=Math.max(ui.dts,Je),rt=Math.min(ui.pts,rt),et=Math.max(ui.pts,et)}tt=Ue[qe-1].dts;const Nr=jr+4*_r+8;let Wr;try{Wr=new Uint8Array(Nr)}catch(ni){this.observer.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MUX_ERROR,details:ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,error:ni,bytes:Nr,reason:`fail allocating video mdat ${Nr}`});return}const ri=new DataView(Wr.buffer);ri.setUint32(0,Nr),Wr.set(MP4.types.mdat,4);let Xr=!1,Gr=Number.POSITIVE_INFINITY,qr=Number.POSITIVE_INFINITY,si=Number.NEGATIVE_INFINITY,oi=Number.NEGATIVE_INFINITY;for(let ni=0;ni<qe;ni++){const ui=Ue[ni],yi=ui.units;let hi=0;for(let Ei=0,bi=yi.length;Ei<bi;Ei++){const _i=yi[Ei],vi=_i.data,Ti=_i.data.byteLength;ri.setUint32(Ze,Ti),Ze+=4,Wr.set(vi,Ze),Ze+=Ti,hi+=4+Ti}let pi;if(ni<qe-1)Xe=Ue[ni+1].dts-ui.dts,pi=Ue[ni+1].pts-ui.pts;else{const Ei=this.config,bi=ni>0?ui.dts-Ue[ni-1].dts:lt;if(pi=ni>0?ui.pts-Ue[ni-1].pts:lt,Ei.stretchShortVideoTrack&&this.nextAudioPts!==null){const _i=Math.floor(Ei.maxBufferHole*Ne),vi=(_e?rt+_e*Ne:this.nextAudioPts)-ui.pts;vi>_i?(Xe=vi-bi,Xe<0?Xe=bi:Xr=!0,logger.log(`[mp4-remuxer]: It is approximately ${vi/90} ms to the next segment; using duration ${Xe/90} ms for the last video frame.`)):Xe=bi}else Xe=bi}const Ri=Math.round(ui.pts-ui.dts);Gr=Math.min(Gr,Xe),si=Math.max(si,Xe),qr=Math.min(qr,pi),oi=Math.max(oi,pi),Ge.push(new Mp4Sample(ui.key,Xe,hi,Ri))}if(Ge.length){if(chromeVersion){if(chromeVersion<70){const ni=Ge[0].flags;ni.dependsOn=2,ni.isNonSync=0}}else if(safariWebkitVersion&&oi-qr<si-Gr&&lt/si<.025&&Ge[0].cts===0){logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let ni=Je;for(let ui=0,yi=Ge.length;ui<yi;ui++){const hi=ni+Ge[ui].duration,pi=ni+Ge[ui].cts;if(ui<yi-1){const Ri=hi+Ge[ui+1].cts;Ge[ui].duration=Ri-pi}else Ge[ui].duration=ui?Ge[ui-1].duration:lt;Ge[ui].cts=0,ni=hi}}}Xe=Xr||!Xe?lt:Xe,this.nextAvcDts=Ye=tt+Xe,this.videoSampleDuration=Xe,this.isVideoContiguous=!0;const Yr=MP4.moof(ee.sequenceNumber++,Je,_extends({},ee,{samples:Ge})),ii="video",ti={data1:Yr,data2:Wr,startPTS:rt/Ne,endPTS:(et+Xe)/Ne,startDTS:Je/Ne,endDTS:Ye/Ne,type:ii,hasAudio:!1,hasVideo:!0,nb:Ge.length,dropped:ee.dropped};return ee.samples=[],ee.dropped=0,ti}remuxAudio(ee,ue,pe,_e,Ne){const Ue=ee.inputTimeScale,Ge=ee.samplerate?ee.samplerate:Ue,qe=Ue/Ge,Ke=ee.segmentCodec==="aac"?AAC_SAMPLES_PER_FRAME:MPEG_AUDIO_SAMPLE_PER_FRAME,Ye=Ke*qe,Ze=this._initPTS,Xe=ee.segmentCodec==="mp3"&&this.typeSupported.mpeg,Je=[],tt=Ne!==void 0;let rt=ee.samples,et=Xe?0:8,it=this.nextAudioPts||-1;const nt=ue*Ue,st=Ze.baseTime*Ue/Ze.timescale;if(this.isAudioContiguous=pe=pe||rt.length&&it>0&&(_e&&Math.abs(nt-it)<9e3||Math.abs(normalizePts(rt[0].pts-st,nt)-it)<20*Ye),rt.forEach(function(ii){ii.pts=normalizePts(ii.pts-st,nt)}),!pe||it<0){if(rt=rt.filter(ii=>ii.pts>=0),!rt.length)return;Ne===0?it=0:_e&&!tt?it=Math.max(0,nt):it=rt[0].pts}if(ee.segmentCodec==="aac"){const ii=this.config.maxAudioFramesDrift;for(let ti=0,ni=it;ti<rt.length;ti++){const ui=rt[ti],yi=ui.pts,hi=yi-ni,pi=Math.abs(1e3*hi/Ue);if(hi<=-ii*Ye&&tt)ti===0&&(logger.warn(`Audio frame @ ${(yi/Ue).toFixed(3)}s overlaps nextAudioPts by ${Math.round(1e3*hi/Ue)} ms.`),this.nextAudioPts=it=ni=yi);else if(hi>=ii*Ye&&pi<MAX_SILENT_FRAME_DURATION&&tt){let Ri=Math.round(hi/Ye);ni=yi-Ri*Ye,ni<0&&(Ri--,ni+=Ye),ti===0&&(this.nextAudioPts=it=ni),logger.warn(`[mp4-remuxer]: Injecting ${Ri} audio frame @ ${(ni/Ue).toFixed(3)}s due to ${Math.round(1e3*hi/Ue)} ms gap.`);for(let Ei=0;Ei<Ri;Ei++){const bi=Math.max(ni,0);let _i=AAC.getSilentFrame(ee.manifestCodec||ee.codec,ee.channelCount);_i||(logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),_i=ui.unit.subarray()),rt.splice(ti,0,{unit:_i,pts:bi}),ni+=Ye,ti++}}ui.pts=ni,ni+=Ye}}let lt=null,_r=null,jr,Nr=0,Wr=rt.length;for(;Wr--;)Nr+=rt[Wr].unit.byteLength;for(let ii=0,ti=rt.length;ii<ti;ii++){const ni=rt[ii],ui=ni.unit;let yi=ni.pts;if(_r!==null){const pi=Je[ii-1];pi.duration=Math.round((yi-_r)/qe)}else if(pe&&ee.segmentCodec==="aac"&&(yi=it),lt=yi,Nr>0){Nr+=et;try{jr=new Uint8Array(Nr)}catch(pi){this.observer.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MUX_ERROR,details:ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,error:pi,bytes:Nr,reason:`fail allocating audio mdat ${Nr}`});return}Xe||(new DataView(jr.buffer).setUint32(0,Nr),jr.set(MP4.types.mdat,4))}else return;jr.set(ui,et);const hi=ui.byteLength;et+=hi,Je.push(new Mp4Sample(!0,Ke,hi,0)),_r=yi}const ri=Je.length;if(!ri)return;const Xr=Je[Je.length-1];this.nextAudioPts=it=_r+qe*Xr.duration;const Gr=Xe?new Uint8Array(0):MP4.moof(ee.sequenceNumber++,lt/qe,_extends({},ee,{samples:Je}));ee.samples=[];const qr=lt/Ue,si=it/Ue,Yr={data1:Gr,data2:jr,startPTS:qr,endPTS:si,startDTS:qr,endDTS:si,type:"audio",hasAudio:!0,hasVideo:!1,nb:ri};return this.isAudioContiguous=!0,Yr}remuxEmptyAudio(ee,ue,pe,_e){const Ne=ee.inputTimeScale,Ue=ee.samplerate?ee.samplerate:Ne,Ge=Ne/Ue,qe=this.nextAudioPts,Ke=this._initDTS,Ye=Ke.baseTime*9e4/Ke.timescale,Ze=(qe!==null?qe:_e.startDTS*Ne)+Ye,Xe=_e.endDTS*Ne+Ye,Je=Ge*AAC_SAMPLES_PER_FRAME,tt=Math.ceil((Xe-Ze)/Je),rt=AAC.getSilentFrame(ee.manifestCodec||ee.codec,ee.channelCount);if(logger.warn("[mp4-remuxer]: remux empty Audio"),!rt){logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}const et=[];for(let it=0;it<tt;it++){const nt=Ze+it*Je;et.push({unit:rt,pts:nt,dts:nt})}return ee.samples=et,this.remuxAudio(ee,ue,pe,!1)}}function normalizePts(fe,ee){let ue;if(ee===null)return fe;for(ee<fe?ue=-8589934592:ue=8589934592;Math.abs(fe-ee)>4294967296;)fe+=ue;return fe}function findKeyframeIndex(fe){for(let ee=0;ee<fe.length;ee++)if(fe[ee].key)return ee;return-1}function flushTextTrackMetadataCueSamples(fe,ee,ue,pe){const _e=fe.samples.length;if(!_e)return;const Ne=fe.inputTimeScale;for(let Ge=0;Ge<_e;Ge++){const qe=fe.samples[Ge];qe.pts=normalizePts(qe.pts-ue.baseTime*Ne/ue.timescale,ee*Ne)/Ne,qe.dts=normalizePts(qe.dts-pe.baseTime*Ne/pe.timescale,ee*Ne)/Ne}const Ue=fe.samples;return fe.samples=[],{samples:Ue}}function flushTextTrackUserdataCueSamples(fe,ee,ue){const pe=fe.samples.length;if(!pe)return;const _e=fe.inputTimeScale;for(let Ue=0;Ue<pe;Ue++){const Ge=fe.samples[Ue];Ge.pts=normalizePts(Ge.pts-ue.baseTime*_e/ue.timescale,ee*_e)/_e}fe.samples.sort((Ue,Ge)=>Ue.pts-Ge.pts);const Ne=fe.samples;return fe.samples=[],{samples:Ne}}class Mp4Sample{constructor(ee,ue,pe,_e){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=ue,this.size=pe,this.cts=_e,this.flags=new Mp4SampleFlags(ee)}}class Mp4SampleFlags{constructor(ee){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=ee?2:1,this.isNonSync=ee?0:1}}class PassThroughRemuxer{constructor(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}destroy(){}resetTimeStamp(ee){this.initPTS=ee,this.lastEndTime=null}resetNextTimestamp(){this.lastEndTime=null}resetInitSegment(ee,ue,pe,_e){this.audioCodec=ue,this.videoCodec=pe,this.generateInitSegment(patchEncyptionData(ee,_e)),this.emitInitSegment=!0}generateInitSegment(ee){let{audioCodec:ue,videoCodec:pe}=this;if(!(ee!=null&&ee.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const _e=this.initData=parseInitSegment(ee);ue||(ue=getParsedTrackCodec(_e.audio,ElementaryStreamTypes.AUDIO)),pe||(pe=getParsedTrackCodec(_e.video,ElementaryStreamTypes.VIDEO));const Ne={};_e.audio&&_e.video?Ne.audiovideo={container:"video/mp4",codec:ue+","+pe,initSegment:ee,id:"main"}:_e.audio?Ne.audio={container:"audio/mp4",codec:ue,initSegment:ee,id:"audio"}:_e.video?Ne.video={container:"video/mp4",codec:pe,initSegment:ee,id:"main"}:logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=Ne}remux(ee,ue,pe,_e,Ne,Ue){var Ge,qe;let{initPTS:Ke,lastEndTime:Ye}=this;const Ze={audio:void 0,video:void 0,text:_e,id3:pe,initSegment:void 0};isFiniteNumber(Ye)||(Ye=this.lastEndTime=Ne||0);const Xe=ue.samples;if(!(Xe!=null&&Xe.length))return Ze;const Je={initPTS:void 0,timescale:1};let tt=this.initData;if((Ge=tt)!=null&&Ge.length||(this.generateInitSegment(Xe),tt=this.initData),!((qe=tt)!=null&&qe.length))return logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),Ze;this.emitInitSegment&&(Je.tracks=this.initTracks,this.emitInitSegment=!1);const rt=getDuration(Xe,tt),et=getStartDTS(tt,Xe),it=et===null?Ne:et;(isInvalidInitPts(Ke,it,Ne,rt)||Je.timescale!==Ke.timescale&&Ue)&&(Je.initPTS=it-Ne,Ke&&Ke.timescale===1&&logger.warn(`Adjusting initPTS by ${Je.initPTS-Ke.baseTime}`),this.initPTS=Ke={baseTime:Je.initPTS,timescale:1});const nt=ee?it-Ke.baseTime/Ke.timescale:Ye,st=nt+rt;offsetStartDTS(tt,Xe,Ke.baseTime/Ke.timescale),rt>0?this.lastEndTime=st:(logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const lt=!!tt.audio,_r=!!tt.video;let jr="";lt&&(jr+="audio"),_r&&(jr+="video");const Nr={data1:Xe,startPTS:nt,startDTS:nt,endPTS:st,endDTS:st,type:jr,hasAudio:lt,hasVideo:_r,nb:1,dropped:0};return Ze.audio=Nr.type==="audio"?Nr:void 0,Ze.video=Nr.type!=="audio"?Nr:void 0,Ze.initSegment=Je,Ze.id3=flushTextTrackMetadataCueSamples(pe,Ne,Ke,Ke),_e.samples.length&&(Ze.text=flushTextTrackUserdataCueSamples(_e,Ne,Ke)),Ze}}function isInvalidInitPts(fe,ee,ue,pe){if(fe===null)return!0;const _e=Math.max(pe,1),Ne=ee-fe.baseTime/fe.timescale;return Math.abs(Ne-ue)>_e}function getParsedTrackCodec(fe,ee){const ue=fe==null?void 0:fe.codec;return ue&&ue.length>4?ue:ue==="hvc1"||ue==="hev1"?"hvc1.1.6.L120.90":ue==="av01"?"av01.0.04M.08":ue==="avc1"||ee===ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}let now;try{now=self.performance.now.bind(self.performance)}catch{logger.debug("Unable to use Performance API on this environment"),now=typeof self<"u"&&self.Date.now}const muxConfig=[{demux:MP4Demuxer,remux:PassThroughRemuxer},{demux:TSDemuxer,remux:MP4Remuxer},{demux:AACDemuxer,remux:MP4Remuxer},{demux:MP3Demuxer,remux:MP4Remuxer}];class Transmuxer{constructor(ee,ue,pe,_e,Ne){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=ee,this.typeSupported=ue,this.config=pe,this.vendor=_e,this.id=Ne}configure(ee){this.transmuxConfig=ee,this.decrypter&&this.decrypter.reset()}push(ee,ue,pe,_e){const Ne=pe.transmuxing;Ne.executeStart=now();let Ue=new Uint8Array(ee);const{currentTransmuxState:Ge,transmuxConfig:qe}=this;_e&&(this.currentTransmuxState=_e);const{contiguous:Ke,discontinuity:Ye,trackSwitch:Ze,accurateTimeOffset:Xe,timeOffset:Je,initSegmentChange:tt}=_e||Ge,{audioCodec:rt,videoCodec:et,defaultInitPts:it,duration:nt,initSegmentData:st}=qe,lt=getEncryptionType(Ue,ue);if(lt&&lt.method==="AES-128"){const Wr=this.getDecrypter();if(Wr.isSync()){let ri=Wr.softwareDecrypt(Ue,lt.key.buffer,lt.iv.buffer);if(pe.part>-1&&(ri=Wr.flush()),!ri)return Ne.executeEnd=now(),emptyResult(pe);Ue=new Uint8Array(ri)}else return this.decryptionPromise=Wr.webCryptoDecrypt(Ue,lt.key.buffer,lt.iv.buffer).then(ri=>{const Xr=this.push(ri,null,pe);return this.decryptionPromise=null,Xr}),this.decryptionPromise}const _r=this.needsProbing(Ye,Ze);if(_r){const Wr=this.configureTransmuxer(Ue);if(Wr)return logger.warn(`[transmuxer] ${Wr.message}`),this.observer.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,error:Wr,reason:Wr.message}),Ne.executeEnd=now(),emptyResult(pe)}(Ye||Ze||tt||_r)&&this.resetInitSegment(st,rt,et,nt,ue),(Ye||tt||_r)&&this.resetInitialTimestamp(it),Ke||this.resetContiguity();const jr=this.transmux(Ue,lt,Je,Xe,pe),Nr=this.currentTransmuxState;return Nr.contiguous=!0,Nr.discontinuity=!1,Nr.trackSwitch=!1,Ne.executeEnd=now(),jr}flush(ee){const ue=ee.transmuxing;ue.executeStart=now();const{decrypter:pe,currentTransmuxState:_e,decryptionPromise:Ne}=this;if(Ne)return Ne.then(()=>this.flush(ee));const Ue=[],{timeOffset:Ge}=_e;if(pe){const Ze=pe.flush();Ze&&Ue.push(this.push(Ze,null,ee))}const{demuxer:qe,remuxer:Ke}=this;if(!qe||!Ke)return ue.executeEnd=now(),[emptyResult(ee)];const Ye=qe.flush(Ge);return isPromise(Ye)?Ye.then(Ze=>(this.flushRemux(Ue,Ze,ee),Ue)):(this.flushRemux(Ue,Ye,ee),Ue)}flushRemux(ee,ue,pe){const{audioTrack:_e,videoTrack:Ne,id3Track:Ue,textTrack:Ge}=ue,{accurateTimeOffset:qe,timeOffset:Ke}=this.currentTransmuxState;logger.log(`[transmuxer.ts]: Flushed fragment ${pe.sn}${pe.part>-1?" p: "+pe.part:""} of level ${pe.level}`);const Ye=this.remuxer.remux(_e,Ne,Ue,Ge,Ke,qe,!0,this.id);ee.push({remuxResult:Ye,chunkMeta:pe}),pe.transmuxing.executeEnd=now()}resetInitialTimestamp(ee){const{demuxer:ue,remuxer:pe}=this;!ue||!pe||(ue.resetTimeStamp(ee),pe.resetTimeStamp(ee))}resetContiguity(){const{demuxer:ee,remuxer:ue}=this;!ee||!ue||(ee.resetContiguity(),ue.resetNextTimestamp())}resetInitSegment(ee,ue,pe,_e,Ne){const{demuxer:Ue,remuxer:Ge}=this;!Ue||!Ge||(Ue.resetInitSegment(ee,ue,pe,_e),Ge.resetInitSegment(ee,ue,pe,Ne))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(ee,ue,pe,_e,Ne){let Ue;return ue&&ue.method==="SAMPLE-AES"?Ue=this.transmuxSampleAes(ee,ue,pe,_e,Ne):Ue=this.transmuxUnencrypted(ee,pe,_e,Ne),Ue}transmuxUnencrypted(ee,ue,pe,_e){const{audioTrack:Ne,videoTrack:Ue,id3Track:Ge,textTrack:qe}=this.demuxer.demux(ee,ue,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(Ne,Ue,Ge,qe,ue,pe,!1,this.id),chunkMeta:_e}}transmuxSampleAes(ee,ue,pe,_e,Ne){return this.demuxer.demuxSampleAes(ee,ue,pe).then(Ue=>({remuxResult:this.remuxer.remux(Ue.audioTrack,Ue.videoTrack,Ue.id3Track,Ue.textTrack,pe,_e,!1,this.id),chunkMeta:Ne}))}configureTransmuxer(ee){const{config:ue,observer:pe,typeSupported:_e,vendor:Ne}=this;let Ue;for(let Ze=0,Xe=muxConfig.length;Ze<Xe;Ze++)if(muxConfig[Ze].demux.probe(ee)){Ue=muxConfig[Ze];break}if(!Ue)return new Error("Failed to find demuxer by probing fragment data");const Ge=this.demuxer,qe=this.remuxer,Ke=Ue.remux,Ye=Ue.demux;(!qe||!(qe instanceof Ke))&&(this.remuxer=new Ke(pe,ue,_e,Ne)),(!Ge||!(Ge instanceof Ye))&&(this.demuxer=new Ye(pe,ue,_e),this.probe=Ye.probe)}needsProbing(ee,ue){return!this.demuxer||!this.remuxer||ee||ue}getDecrypter(){let ee=this.decrypter;return ee||(ee=this.decrypter=new Decrypter(this.config)),ee}}function getEncryptionType(fe,ee){let ue=null;return fe.byteLength>0&&ee!=null&&ee.key!=null&&ee.iv!==null&&ee.method!=null&&(ue=ee),ue}const emptyResult=fe=>({remuxResult:{},chunkMeta:fe});function isPromise(fe){return"then"in fe&&fe.then instanceof Function}class TransmuxConfig{constructor(ee,ue,pe,_e,Ne){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=ee,this.videoCodec=ue,this.initSegmentData=pe,this.duration=_e,this.defaultInitPts=Ne||null}}class TransmuxState{constructor(ee,ue,pe,_e,Ne,Ue){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=ee,this.contiguous=ue,this.accurateTimeOffset=pe,this.trackSwitch=_e,this.timeOffset=Ne,this.initSegmentChange=Ue}}var eventemitter3={exports:{}};(function(fe){var ee=Object.prototype.hasOwnProperty,ue="~";function pe(){}Object.create&&(pe.prototype=Object.create(null),new pe().__proto__||(ue=!1));function _e(qe,Ke,Ye){this.fn=qe,this.context=Ke,this.once=Ye||!1}function Ne(qe,Ke,Ye,Ze,Xe){if(typeof Ye!="function")throw new TypeError("The listener must be a function");var Je=new _e(Ye,Ze||qe,Xe),tt=ue?ue+Ke:Ke;return qe._events[tt]?qe._events[tt].fn?qe._events[tt]=[qe._events[tt],Je]:qe._events[tt].push(Je):(qe._events[tt]=Je,qe._eventsCount++),qe}function Ue(qe,Ke){--qe._eventsCount===0?qe._events=new pe:delete qe._events[Ke]}function Ge(){this._events=new pe,this._eventsCount=0}Ge.prototype.eventNames=function(){var Ke=[],Ye,Ze;if(this._eventsCount===0)return Ke;for(Ze in Ye=this._events)ee.call(Ye,Ze)&&Ke.push(ue?Ze.slice(1):Ze);return Object.getOwnPropertySymbols?Ke.concat(Object.getOwnPropertySymbols(Ye)):Ke},Ge.prototype.listeners=function(Ke){var Ye=ue?ue+Ke:Ke,Ze=this._events[Ye];if(!Ze)return[];if(Ze.fn)return[Ze.fn];for(var Xe=0,Je=Ze.length,tt=new Array(Je);Xe<Je;Xe++)tt[Xe]=Ze[Xe].fn;return tt},Ge.prototype.listenerCount=function(Ke){var Ye=ue?ue+Ke:Ke,Ze=this._events[Ye];return Ze?Ze.fn?1:Ze.length:0},Ge.prototype.emit=function(Ke,Ye,Ze,Xe,Je,tt){var rt=ue?ue+Ke:Ke;if(!this._events[rt])return!1;var et=this._events[rt],it=arguments.length,nt,st;if(et.fn){switch(et.once&&this.removeListener(Ke,et.fn,void 0,!0),it){case 1:return et.fn.call(et.context),!0;case 2:return et.fn.call(et.context,Ye),!0;case 3:return et.fn.call(et.context,Ye,Ze),!0;case 4:return et.fn.call(et.context,Ye,Ze,Xe),!0;case 5:return et.fn.call(et.context,Ye,Ze,Xe,Je),!0;case 6:return et.fn.call(et.context,Ye,Ze,Xe,Je,tt),!0}for(st=1,nt=new Array(it-1);st<it;st++)nt[st-1]=arguments[st];et.fn.apply(et.context,nt)}else{var lt=et.length,_r;for(st=0;st<lt;st++)switch(et[st].once&&this.removeListener(Ke,et[st].fn,void 0,!0),it){case 1:et[st].fn.call(et[st].context);break;case 2:et[st].fn.call(et[st].context,Ye);break;case 3:et[st].fn.call(et[st].context,Ye,Ze);break;case 4:et[st].fn.call(et[st].context,Ye,Ze,Xe);break;default:if(!nt)for(_r=1,nt=new Array(it-1);_r<it;_r++)nt[_r-1]=arguments[_r];et[st].fn.apply(et[st].context,nt)}}return!0},Ge.prototype.on=function(Ke,Ye,Ze){return Ne(this,Ke,Ye,Ze,!1)},Ge.prototype.once=function(Ke,Ye,Ze){return Ne(this,Ke,Ye,Ze,!0)},Ge.prototype.removeListener=function(Ke,Ye,Ze,Xe){var Je=ue?ue+Ke:Ke;if(!this._events[Je])return this;if(!Ye)return Ue(this,Je),this;var tt=this._events[Je];if(tt.fn)tt.fn===Ye&&(!Xe||tt.once)&&(!Ze||tt.context===Ze)&&Ue(this,Je);else{for(var rt=0,et=[],it=tt.length;rt<it;rt++)(tt[rt].fn!==Ye||Xe&&!tt[rt].once||Ze&&tt[rt].context!==Ze)&&et.push(tt[rt]);et.length?this._events[Je]=et.length===1?et[0]:et:Ue(this,Je)}return this},Ge.prototype.removeAllListeners=function(Ke){var Ye;return Ke?(Ye=ue?ue+Ke:Ke,this._events[Ye]&&Ue(this,Ye)):(this._events=new pe,this._eventsCount=0),this},Ge.prototype.off=Ge.prototype.removeListener,Ge.prototype.addListener=Ge.prototype.on,Ge.prefixed=ue,Ge.EventEmitter=Ge,fe.exports=Ge})(eventemitter3);var eventemitter3Exports=eventemitter3.exports,EventEmitter=getDefaultExportFromCjs(eventemitter3Exports);const MediaSource$1=getMediaSource()||{isTypeSupported:()=>!1};class TransmuxerInterface{constructor(ee,ue,pe,_e){this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;const Ne=ee.config;this.hls=ee,this.id=ue,this.useWorker=!!Ne.enableWorker,this.onTransmuxComplete=pe,this.onFlush=_e;const Ue=(Ke,Ye)=>{Ye=Ye||{},Ye.frag=this.frag,Ye.id=this.id,Ke===Events.ERROR&&(this.error=Ye.error),this.hls.trigger(Ke,Ye)};this.observer=new EventEmitter,this.observer.on(Events.FRAG_DECRYPTED,Ue),this.observer.on(Events.ERROR,Ue);const Ge={mp4:MediaSource$1.isTypeSupported("video/mp4"),mpeg:MediaSource$1.isTypeSupported("audio/mpeg"),mp3:MediaSource$1.isTypeSupported('audio/mp4; codecs="mp3"')},qe=navigator.vendor;if(this.useWorker&&typeof Worker<"u"&&(Ne.workerPath||hasUMDWorker())){try{Ne.workerPath?(logger.log(`loading Web Worker ${Ne.workerPath} for "${ue}"`),this.workerContext=loadWorker(Ne.workerPath)):(logger.log(`injecting Web Worker for "${ue}"`),this.workerContext=injectWorker()),this.onwmsg=Ze=>this.onWorkerMessage(Ze);const{worker:Ye}=this.workerContext;Ye.addEventListener("message",this.onwmsg),Ye.onerror=Ze=>{const Xe=new Error(`${Ze.message}  (${Ze.filename}:${Ze.lineno})`);Ne.enableWorker=!1,logger.warn(`Error in "${ue}" Web Worker, fallback to inline`),this.hls.trigger(Events.ERROR,{type:ErrorTypes.OTHER_ERROR,details:ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:Xe})},Ye.postMessage({cmd:"init",typeSupported:Ge,vendor:qe,id:ue,config:JSON.stringify(Ne)})}catch(Ye){logger.warn(`Error setting up "${ue}" Web Worker, fallback to inline`,Ye),this.resetWorker(),this.error=null,this.transmuxer=new Transmuxer(this.observer,Ge,Ne,qe,ue)}return}this.transmuxer=new Transmuxer(this.observer,Ge,Ne,qe,ue)}resetWorker(){if(this.workerContext){const{worker:ee,objectURL:ue}=this.workerContext;ue&&self.URL.revokeObjectURL(ue),ee.removeEventListener("message",this.onwmsg),ee.onerror=null,ee.terminate(),this.workerContext=null}}destroy(){if(this.workerContext)this.resetWorker(),this.onwmsg=void 0;else{const ue=this.transmuxer;ue&&(ue.destroy(),this.transmuxer=null)}const ee=this.observer;ee&&ee.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null}push(ee,ue,pe,_e,Ne,Ue,Ge,qe,Ke,Ye){var Ze,Xe;Ke.transmuxing.start=self.performance.now();const{transmuxer:Je}=this,tt=Ue?Ue.start:Ne.start,rt=Ne.decryptdata,et=this.frag,it=!(et&&Ne.cc===et.cc),nt=!(et&&Ke.level===et.level),st=et?Ke.sn-et.sn:-1,lt=this.part?Ke.part-this.part.index:-1,_r=st===0&&Ke.id>1&&Ke.id===(et==null?void 0:et.stats.chunkCount),jr=!nt&&(st===1||st===0&&(lt===1||_r&&lt<=0)),Nr=self.performance.now();(nt||st||Ne.stats.parsing.start===0)&&(Ne.stats.parsing.start=Nr),Ue&&(lt||!jr)&&(Ue.stats.parsing.start=Nr);const Wr=!(et&&((Ze=Ne.initSegment)==null?void 0:Ze.url)===((Xe=et.initSegment)==null?void 0:Xe.url)),ri=new TransmuxState(it,jr,qe,nt,tt,Wr);if(!jr||it||Wr){logger.log(`[transmuxer-interface, ${Ne.type}]: Starting new transmux session for sn: ${Ke.sn} p: ${Ke.part} level: ${Ke.level} id: ${Ke.id}
        discontinuity: ${it}
        trackSwitch: ${nt}
        contiguous: ${jr}
        accurateTimeOffset: ${qe}
        timeOffset: ${tt}
        initSegmentChange: ${Wr}`);const Xr=new TransmuxConfig(pe,_e,ue,Ge,Ye);this.configureTransmuxer(Xr)}if(this.frag=Ne,this.part=Ue,this.workerContext)this.workerContext.worker.postMessage({cmd:"demux",data:ee,decryptdata:rt,chunkMeta:Ke,state:ri},ee instanceof ArrayBuffer?[ee]:[]);else if(Je){const Xr=Je.push(ee,rt,Ke,ri);isPromise(Xr)?(Je.async=!0,Xr.then(Gr=>{this.handleTransmuxComplete(Gr)}).catch(Gr=>{this.transmuxerError(Gr,Ke,"transmuxer-interface push error")})):(Je.async=!1,this.handleTransmuxComplete(Xr))}}flush(ee){ee.transmuxing.start=self.performance.now();const{transmuxer:ue}=this;if(this.workerContext)this.workerContext.worker.postMessage({cmd:"flush",chunkMeta:ee});else if(ue){let pe=ue.flush(ee);isPromise(pe)||ue.async?(isPromise(pe)||(pe=Promise.resolve(pe)),pe.then(Ne=>{this.handleFlushResult(Ne,ee)}).catch(Ne=>{this.transmuxerError(Ne,ee,"transmuxer-interface flush error")})):this.handleFlushResult(pe,ee)}}transmuxerError(ee,ue,pe){this.hls&&(this.error=ee,this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:ue,fatal:!1,error:ee,err:ee,reason:pe}))}handleFlushResult(ee,ue){ee.forEach(pe=>{this.handleTransmuxComplete(pe)}),this.onFlush(ue)}onWorkerMessage(ee){const ue=ee.data,pe=this.hls;switch(ue.event){case"init":{var _e;const Ne=(_e=this.workerContext)==null?void 0:_e.objectURL;Ne&&self.URL.revokeObjectURL(Ne);break}case"transmuxComplete":{this.handleTransmuxComplete(ue.data);break}case"flush":{this.onFlush(ue.data);break}case"workerLog":logger[ue.data.logType]&&logger[ue.data.logType](ue.data.message);break;default:{ue.data=ue.data||{},ue.data.frag=this.frag,ue.data.id=this.id,pe.trigger(ue.event,ue.data);break}}}configureTransmuxer(ee){const{transmuxer:ue}=this;this.workerContext?this.workerContext.worker.postMessage({cmd:"configure",config:ee}):ue&&ue.configure(ee)}handleTransmuxComplete(ee){ee.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(ee)}}const STALL_MINIMUM_DURATION_MS=250,MAX_START_GAP_JUMP=2,SKIP_BUFFER_HOLE_STEP_SECONDS=.1,SKIP_BUFFER_RANGE_START=.05;class GapController{constructor(ee,ue,pe,_e){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=ee,this.media=ue,this.fragmentTracker=pe,this.hls=_e}destroy(){this.media=null,this.hls=this.fragmentTracker=null}poll(ee,ue){const{config:pe,media:_e,stalled:Ne}=this;if(_e===null)return;const{currentTime:Ue,seeking:Ge}=_e,qe=this.seeking&&!Ge,Ke=!this.seeking&&Ge;if(this.seeking=Ge,Ue!==ee){if(this.moved=!0,Ne!==null){if(this.stallReported){const it=self.performance.now()-Ne;logger.warn(`playback not stuck anymore @${Ue}, after ${Math.round(it)}ms`),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if(Ke||qe){this.stalled=null;return}if(_e.paused&&!Ge||_e.ended||_e.playbackRate===0||!BufferHelper.getBuffered(_e).length)return;const Ye=BufferHelper.bufferInfo(_e,Ue,0),Ze=Ye.len>0,Xe=Ye.nextStart||0;if(!Ze&&!Xe)return;if(Ge){const it=Ye.len>MAX_START_GAP_JUMP,nt=!Xe||ue&&ue.start<=Ue||Xe-Ue>MAX_START_GAP_JUMP&&!this.fragmentTracker.getPartialFragment(Ue);if(it||nt)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var Je;const it=Math.max(Xe,Ye.start||0)-Ue,nt=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,lt=(nt==null||(Je=nt.details)==null?void 0:Je.live)?nt.details.targetduration*2:MAX_START_GAP_JUMP,_r=this.fragmentTracker.getPartialFragment(Ue);if(it>0&&(it<=lt||_r)){this._trySkipBufferHole(_r);return}}const tt=self.performance.now();if(Ne===null){this.stalled=tt;return}const rt=tt-Ne;if(!Ge&&rt>=STALL_MINIMUM_DURATION_MS&&(this._reportStall(Ye),!this.media))return;const et=BufferHelper.bufferInfo(_e,Ue,pe.maxBufferHole);this._tryFixBufferStall(et,rt)}_tryFixBufferStall(ee,ue){const{config:pe,fragmentTracker:_e,media:Ne}=this;if(Ne===null)return;const Ue=Ne.currentTime,Ge=_e.getPartialFragment(Ue);Ge&&(this._trySkipBufferHole(Ge)||!this.media)||(ee.len>pe.maxBufferHole||ee.nextStart&&ee.nextStart-Ue<pe.maxBufferHole)&&ue>pe.highBufferWatchdogPeriod*1e3&&(logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}_reportStall(ee){const{hls:ue,media:pe,stallReported:_e}=this;if(!_e&&pe){this.stallReported=!0;const Ne=new Error(`Playback stalling at @${pe.currentTime} due to low buffer (${JSON.stringify(ee)})`);logger.warn(Ne.message),ue.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,error:Ne,buffer:ee.len})}}_trySkipBufferHole(ee){const{config:ue,hls:pe,media:_e}=this;if(_e===null)return 0;const Ne=_e.currentTime,Ue=BufferHelper.bufferInfo(_e,Ne,0),Ge=Ne<Ue.start?Ue.start:Ue.nextStart;if(Ge){const qe=Ue.len<=ue.maxBufferHole,Ke=Ue.len>0&&Ue.len<1&&_e.readyState<3,Ye=Ge-Ne;if(Ye>0&&(qe||Ke)){if(Ye>ue.maxBufferHole){const{fragmentTracker:Xe}=this;let Je=!1;if(Ne===0){const tt=Xe.getAppendedFrag(0,PlaylistLevelType.MAIN);tt&&Ge<tt.end&&(Je=!0)}if(!Je){const tt=ee||Xe.getAppendedFrag(Ne,PlaylistLevelType.MAIN);if(tt){let rt=!1,et=tt.end;for(;et<Ge;){const it=Xe.getPartialFragment(et);if(it)et+=it.duration;else{rt=!0;break}}if(rt)return 0}}}const Ze=Math.max(Ge+SKIP_BUFFER_RANGE_START,Ne+SKIP_BUFFER_HOLE_STEP_SECONDS);if(logger.warn(`skipping hole, adjusting currentTime from ${Ne} to ${Ze}`),this.moved=!0,this.stalled=null,_e.currentTime=Ze,ee&&!ee.gap){const Xe=new Error(`fragment loaded with buffer holes, seeking from ${Ne} to ${Ze}`);pe.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:Xe,reason:Xe.message,frag:ee})}return Ze}}return 0}_tryNudgeBuffer(){const{config:ee,hls:ue,media:pe,nudgeRetry:_e}=this;if(pe===null)return;const Ne=pe.currentTime;if(this.nudgeRetry++,_e<ee.nudgeMaxRetry){const Ue=Ne+(_e+1)*ee.nudgeOffset,Ge=new Error(`Nudging 'currentTime' from ${Ne} to ${Ue}`);logger.warn(Ge.message),pe.currentTime=Ue,ue.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_NUDGE_ON_STALL,error:Ge,fatal:!1})}else{const Ue=new Error(`Playhead still not moving while enough data buffered @${Ne} after ${ee.nudgeMaxRetry} nudges`);logger.error(Ue.message),ue.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_STALLED_ERROR,error:Ue,fatal:!0})}}}const TICK_INTERVAL$2=100;class StreamController extends BaseStreamController{constructor(ee,ue,pe){super(ee,ue,pe,"[stream-controller]",PlaylistLevelType.MAIN),this.audioCodecSwap=!1,this.gapController=null,this.level=-1,this._forceStartLoad=!1,this.altAudio=!1,this.audioOnly=!1,this.fragPlaying=null,this.onvplaying=null,this.onvseeked=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this._registerListeners()}_registerListeners(){const{hls:ee}=this;ee.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),ee.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),ee.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),ee.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),ee.on(Events.LEVEL_LOADING,this.onLevelLoading,this),ee.on(Events.LEVEL_LOADED,this.onLevelLoaded,this),ee.on(Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),ee.on(Events.ERROR,this.onError,this),ee.on(Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),ee.on(Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),ee.on(Events.BUFFER_CREATED,this.onBufferCreated,this),ee.on(Events.BUFFER_FLUSHED,this.onBufferFlushed,this),ee.on(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),ee.on(Events.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:ee}=this;ee.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),ee.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),ee.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),ee.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),ee.off(Events.LEVEL_LOADED,this.onLevelLoaded,this),ee.off(Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),ee.off(Events.ERROR,this.onError,this),ee.off(Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),ee.off(Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),ee.off(Events.BUFFER_CREATED,this.onBufferCreated,this),ee.off(Events.BUFFER_FLUSHED,this.onBufferFlushed,this),ee.off(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),ee.off(Events.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this._unregisterListeners(),this.onMediaDetaching()}startLoad(ee){if(this.levels){const{lastCurrentTime:ue,hls:pe}=this;if(this.stopLoad(),this.setInterval(TICK_INTERVAL$2),this.level=-1,!this.startFragRequested){let _e=pe.startLevel;_e===-1&&(pe.config.testBandwidth&&this.levels.length>1?(_e=0,this.bitrateTest=!0):_e=pe.nextAutoLevel),this.level=pe.nextLoadLevel=_e,this.loadedmetadata=!1}ue>0&&ee===-1&&(this.log(`Override startPosition with lastCurrentTime @${ue.toFixed(3)}`),ee=ue),this.state=State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=ee,this.tick()}else this._forceStartLoad=!0,this.state=State.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case State.WAITING_LEVEL:{var ee;const{levels:pe,level:_e}=this,Ne=pe==null||(ee=pe[_e])==null?void 0:ee.details;if(Ne&&(!Ne.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(Ne))break;this.state=State.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=State.IDLE;break}break}case State.FRAG_LOADING_WAITING_RETRY:{var ue;const pe=self.performance.now(),_e=this.retryDate;(!_e||pe>=_e||(ue=this.media)!=null&&ue.seeking)&&(this.resetStartWhenNotLoaded(this.level),this.state=State.IDLE)}break}this.state===State.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){super.onTickEnd(),this.checkBuffer(),this.checkFragmentChanged()}doTickIdle(){const{hls:ee,levelLastLoaded:ue,levels:pe,media:_e}=this,{config:Ne,nextLoadLevel:Ue}=ee;if(ue===null||!_e&&(this.startFragRequested||!Ne.startFragPrefetch)||this.altAudio&&this.audioOnly||!(pe!=null&&pe[Ue]))return;const Ge=pe[Ue],qe=this.getMainFwdBufferInfo();if(qe===null)return;const Ke=this.getLevelDetails();if(Ke&&this._streamEnded(qe,Ke)){const et={};this.altAudio&&(et.type="video"),this.hls.trigger(Events.BUFFER_EOS,et),this.state=State.ENDED;return}ee.loadLevel!==Ue&&ee.manualLevel===-1&&this.log(`Adapting to level ${Ue} from level ${this.level}`),this.level=ee.nextLoadLevel=Ue;const Ye=Ge.details;if(!Ye||this.state===State.WAITING_LEVEL||Ye.live&&this.levelLastLoaded!==Ue){this.level=Ue,this.state=State.WAITING_LEVEL;return}const Ze=qe.len,Xe=this.getMaxBufferLength(Ge.maxBitrate);if(Ze>=Xe)return;this.backtrackFragment&&this.backtrackFragment.start>qe.end&&(this.backtrackFragment=null);const Je=this.backtrackFragment?this.backtrackFragment.start:qe.end;let tt=this.getNextFragment(Je,Ye);if(this.couldBacktrack&&!this.fragPrevious&&tt&&tt.sn!=="initSegment"&&this.fragmentTracker.getState(tt)!==FragmentState.OK){var rt;const it=((rt=this.backtrackFragment)!=null?rt:tt).sn-Ye.startSN,nt=Ye.fragments[it-1];nt&&tt.cc===nt.cc&&(tt=nt,this.fragmentTracker.removeFragment(nt))}else this.backtrackFragment&&qe.len&&(this.backtrackFragment=null);if(tt&&this.isLoopLoading(tt,Je)){if(!tt.gap){const it=this.audioOnly&&!this.altAudio?ElementaryStreamTypes.AUDIO:ElementaryStreamTypes.VIDEO,nt=(it===ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;nt&&this.afterBufferFlushed(nt,it,PlaylistLevelType.MAIN)}tt=this.getNextFragmentLoopLoading(tt,Ye,qe,PlaylistLevelType.MAIN,Xe)}tt&&(tt.initSegment&&!tt.initSegment.data&&!this.bitrateTest&&(tt=tt.initSegment),this.loadFragment(tt,Ge,Je))}loadFragment(ee,ue,pe){const _e=this.fragmentTracker.getState(ee);this.fragCurrent=ee,_e===FragmentState.NOT_LOADED||_e===FragmentState.PARTIAL?ee.sn==="initSegment"?this._loadInitSegment(ee,ue):this.bitrateTest?(this.log(`Fragment ${ee.sn} of level ${ee.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(ee,ue)):(this.startFragRequested=!0,super.loadFragment(ee,ue,pe)):this.clearTrackerIfNeeded(ee)}getBufferedFrag(ee){return this.fragmentTracker.getBufferedFrag(ee,PlaylistLevelType.MAIN)}followingBufferedFrag(ee){return ee?this.getBufferedFrag(ee.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:ee,media:ue}=this;if(ue!=null&&ue.readyState){let pe;const _e=this.getAppendedFrag(ue.currentTime);_e&&_e.start>1&&this.flushMainBuffer(0,_e.start-1);const Ne=this.getLevelDetails();if(Ne!=null&&Ne.live){const Ge=this.getMainFwdBufferInfo();if(!Ge||Ge.len<Ne.targetduration*2)return}if(!ue.paused&&ee){const Ge=this.hls.nextLoadLevel,qe=ee[Ge],Ke=this.fragLastKbps;Ke&&this.fragCurrent?pe=this.fragCurrent.duration*qe.maxBitrate/(1e3*Ke)+1:pe=0}else pe=0;const Ue=this.getBufferedFrag(ue.currentTime+pe);if(Ue){const Ge=this.followingBufferedFrag(Ue);if(Ge){this.abortCurrentFrag();const qe=Ge.maxStartPTS?Ge.maxStartPTS:Ge.start,Ke=Ge.duration,Ye=Math.max(Ue.end,qe+Math.min(Math.max(Ke-this.config.maxFragLookUpTolerance,Ke*.5),Ke*.75));this.flushMainBuffer(Ye,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const ee=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,ee&&(ee.abortRequests(),this.fragmentTracker.removeFragment(ee)),this.state){case State.KEY_LOADING:case State.FRAG_LOADING:case State.FRAG_LOADING_WAITING_RETRY:case State.PARSING:case State.PARSED:this.state=State.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(ee,ue){super.flushMainBuffer(ee,ue,this.altAudio?"video":null)}onMediaAttached(ee,ue){super.onMediaAttached(ee,ue);const pe=ue.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),pe.addEventListener("playing",this.onvplaying),pe.addEventListener("seeked",this.onvseeked),this.gapController=new GapController(this.config,pe,this.fragmentTracker,this.hls)}onMediaDetaching(){const{media:ee}=this;ee&&this.onvplaying&&this.onvseeked&&(ee.removeEventListener("playing",this.onvplaying),ee.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),super.onMediaDetaching()}onMediaPlaying(){this.tick()}onMediaSeeked(){const ee=this.media,ue=ee?ee.currentTime:null;isFiniteNumber(ue)&&this.log(`Media seeked to ${ue.toFixed(3)}`);const pe=this.getMainFwdBufferInfo();if(pe===null||pe.len===0){this.warn(`Main forward buffer length on "seeked" event ${pe?pe.len:"empty"})`);return}this.tick()}onManifestLoading(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.levels=this.fragPlaying=this.backtrackFragment=null,this.altAudio=this.audioOnly=!1}onManifestParsed(ee,ue){let pe=!1,_e=!1,Ne;ue.levels.forEach(Ue=>{Ne=Ue.audioCodec,Ne&&(Ne.indexOf("mp4a.40.2")!==-1&&(pe=!0),Ne.indexOf("mp4a.40.5")!==-1&&(_e=!0))}),this.audioCodecSwitch=pe&&_e&&!changeTypeSupported(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=ue.levels,this.startFragRequested=!1}onLevelLoading(ee,ue){const{levels:pe}=this;if(!pe||this.state!==State.IDLE)return;const _e=pe[ue.level];(!_e.details||_e.details.live&&this.levelLastLoaded!==ue.level||this.waitForCdnTuneIn(_e.details))&&(this.state=State.WAITING_LEVEL)}onLevelLoaded(ee,ue){var pe;const{levels:_e}=this,Ne=ue.level,Ue=ue.details,Ge=Ue.totalduration;if(!_e){this.warn(`Levels were reset while loading level ${Ne}`);return}this.log(`Level ${Ne} loaded [${Ue.startSN},${Ue.endSN}]${Ue.lastPartSn?`[part-${Ue.lastPartSn}-${Ue.lastPartIndex}]`:""}, cc [${Ue.startCC}, ${Ue.endCC}] duration:${Ge}`);const qe=_e[Ne],Ke=this.fragCurrent;Ke&&(this.state===State.FRAG_LOADING||this.state===State.FRAG_LOADING_WAITING_RETRY)&&(Ke.level!==ue.level||Ke.urlId!==qe.urlId)&&Ke.loader&&this.abortCurrentFrag();let Ye=0;if(Ue.live||(pe=qe.details)!=null&&pe.live){if(this.checkLiveUpdate(Ue),Ue.deltaUpdateFailed)return;Ye=this.alignPlaylists(Ue,qe.details)}if(qe.details=Ue,this.levelLastLoaded=Ne,this.hls.trigger(Events.LEVEL_UPDATED,{details:Ue,level:Ne}),this.state===State.WAITING_LEVEL){if(this.waitForCdnTuneIn(Ue))return;this.state=State.IDLE}this.startFragRequested?Ue.live&&this.synchronizeToLiveEdge(Ue):this.setStartPosition(Ue,Ye),this.tick()}_handleFragmentLoadProgress(ee){var ue;const{frag:pe,part:_e,payload:Ne}=ee,{levels:Ue}=this;if(!Ue){this.warn(`Levels were reset while fragment load was in progress. Fragment ${pe.sn} of level ${pe.level} will not be buffered`);return}const Ge=Ue[pe.level],qe=Ge.details;if(!qe){this.warn(`Dropping fragment ${pe.sn} of level ${pe.level} after level details were reset`),this.fragmentTracker.removeFragment(pe);return}const Ke=Ge.videoCodec,Ye=qe.PTSKnown||!qe.live,Ze=(ue=pe.initSegment)==null?void 0:ue.data,Xe=this._getAudioCodec(Ge),Je=this.transmuxer=this.transmuxer||new TransmuxerInterface(this.hls,PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),tt=_e?_e.index:-1,rt=tt!==-1,et=new ChunkMetadata(pe.level,pe.sn,pe.stats.chunkCount,Ne.byteLength,tt,rt),it=this.initPTS[pe.cc];Je.push(Ne,Ze,Xe,Ke,pe,_e,qe.totalduration,Ye,et,it)}onAudioTrackSwitching(ee,ue){const pe=this.altAudio;if(!!!ue.url){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const Ue=this.fragCurrent;Ue&&(this.log("Switching to main audio track, cancel main fragment load"),Ue.abortRequests(),this.fragmentTracker.removeFragment(Ue)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();const Ne=this.hls;pe&&(Ne.trigger(Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null}),this.fragmentTracker.removeAllFragments()),Ne.trigger(Events.AUDIO_TRACK_SWITCHED,ue)}}onAudioTrackSwitched(ee,ue){const pe=ue.id,_e=!!this.hls.audioTracks[pe].url;if(_e){const Ne=this.videoBuffer;Ne&&this.mediaBuffer!==Ne&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=Ne)}this.altAudio=_e,this.tick()}onBufferCreated(ee,ue){const pe=ue.tracks;let _e,Ne,Ue=!1;for(const Ge in pe){const qe=pe[Ge];if(qe.id==="main"){if(Ne=Ge,_e=qe,Ge==="video"){const Ke=pe[Ge];Ke&&(this.videoBuffer=Ke.buffer)}}else Ue=!0}Ue&&_e?(this.log(`Alternate track found, use ${Ne}.buffered to schedule main fragment loading`),this.mediaBuffer=_e.buffer):this.mediaBuffer=this.media}onFragBuffered(ee,ue){const{frag:pe,part:_e}=ue;if(pe&&pe.type!==PlaylistLevelType.MAIN)return;if(this.fragContextChanged(pe)){this.warn(`Fragment ${pe.sn}${_e?" p: "+_e.index:""} of level ${pe.level} finished buffering, but was aborted. state: ${this.state}`),this.state===State.PARSED&&(this.state=State.IDLE);return}const Ne=_e?_e.stats:pe.stats;this.fragLastKbps=Math.round(8*Ne.total/(Ne.buffering.end-Ne.loading.first)),pe.sn!=="initSegment"&&(this.fragPrevious=pe),this.fragBufferedComplete(pe,_e)}onError(ee,ue){var pe;if(ue.fatal){this.state=State.ERROR;return}switch(ue.details){case ErrorDetails.FRAG_GAP:case ErrorDetails.FRAG_PARSING_ERROR:case ErrorDetails.FRAG_DECRYPT_ERROR:case ErrorDetails.FRAG_LOAD_ERROR:case ErrorDetails.FRAG_LOAD_TIMEOUT:case ErrorDetails.KEY_LOAD_ERROR:case ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(PlaylistLevelType.MAIN,ue);break;case ErrorDetails.LEVEL_LOAD_ERROR:case ErrorDetails.LEVEL_LOAD_TIMEOUT:case ErrorDetails.LEVEL_PARSING_ERROR:!ue.levelRetry&&this.state===State.WAITING_LEVEL&&((pe=ue.context)==null?void 0:pe.type)===PlaylistContextType.LEVEL&&(this.state=State.IDLE);break;case ErrorDetails.BUFFER_FULL_ERROR:if(!ue.parent||ue.parent!=="main")return;this.reduceLengthAndFlushBuffer(ue)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case ErrorDetails.INTERNAL_EXCEPTION:this.recoverWorkerError(ue);break}}checkBuffer(){const{media:ee,gapController:ue}=this;if(!(!ee||!ue||!ee.readyState)){if(this.loadedmetadata||!BufferHelper.getBuffered(ee).length){const pe=this.state!==State.IDLE?this.fragCurrent:null;ue.poll(this.lastCurrentTime,pe)}this.lastCurrentTime=ee.currentTime}}onFragLoadEmergencyAborted(){this.state=State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()}onBufferFlushed(ee,{type:ue}){if(ue!==ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){const pe=(ue===ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(pe,ue,PlaylistLevelType.MAIN)}}onLevelsUpdated(ee,ue){this.levels=ue.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:ee}=this;if(!ee)return;const ue=ee.currentTime;let pe=this.startPosition;if(pe>=0&&ue<pe){if(ee.seeking){this.log(`could not seek to ${pe}, already seeking at ${ue}`);return}const _e=BufferHelper.getBuffered(ee),Ue=(_e.length?_e.start(0):0)-pe;Ue>0&&(Ue<this.config.maxBufferHole||Ue<this.config.maxFragLookUpTolerance)&&(this.log(`adjusting start position by ${Ue} to match buffer start`),pe+=Ue,this.startPosition=pe),this.log(`seek to target start position ${pe} from current time ${ue}`),ee.currentTime=pe}}_getAudioCodec(ee){let ue=this.config.defaultAudioCodec||ee.audioCodec;return this.audioCodecSwap&&ue&&(this.log("Swapping audio codec"),ue.indexOf("mp4a.40.5")!==-1?ue="mp4a.40.2":ue="mp4a.40.5"),ue}_loadBitrateTestFrag(ee,ue){ee.bitrateTest=!0,this._doFragLoad(ee,ue).then(pe=>{const{hls:_e}=this;if(!pe||this.fragContextChanged(ee))return;ue.fragmentError=0,this.state=State.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const Ne=ee.stats;Ne.parsing.start=Ne.parsing.end=Ne.buffering.start=Ne.buffering.end=self.performance.now(),_e.trigger(Events.FRAG_LOADED,pe),ee.bitrateTest=!1})}_handleTransmuxComplete(ee){var ue;const pe="main",{hls:_e}=this,{remuxResult:Ne,chunkMeta:Ue}=ee,Ge=this.getCurrentContext(Ue);if(!Ge){this.resetWhenMissingContext(Ue);return}const{frag:qe,part:Ke,level:Ye}=Ge,{video:Ze,text:Xe,id3:Je,initSegment:tt}=Ne,{details:rt}=Ye,et=this.altAudio?void 0:Ne.audio;if(this.fragContextChanged(qe)){this.fragmentTracker.removeFragment(qe);return}if(this.state=State.PARSING,tt){if(tt!=null&&tt.tracks){const st=qe.initSegment||qe;this._bufferInitSegment(Ye,tt.tracks,st,Ue),_e.trigger(Events.FRAG_PARSING_INIT_SEGMENT,{frag:st,id:pe,tracks:tt.tracks})}const it=tt.initPTS,nt=tt.timescale;isFiniteNumber(it)&&(this.initPTS[qe.cc]={baseTime:it,timescale:nt},_e.trigger(Events.INIT_PTS_FOUND,{frag:qe,id:pe,initPTS:it,timescale:nt}))}if(Ze&&rt&&qe.sn!=="initSegment"){const it=rt.fragments[qe.sn-1-rt.startSN],nt=qe.sn===rt.startSN,st=!it||qe.cc>it.cc;if(Ne.independent!==!1){const{startPTS:lt,endPTS:_r,startDTS:jr,endDTS:Nr}=Ze;if(Ke)Ke.elementaryStreams[Ze.type]={startPTS:lt,endPTS:_r,startDTS:jr,endDTS:Nr};else if(Ze.firstKeyFrame&&Ze.independent&&Ue.id===1&&!st&&(this.couldBacktrack=!0),Ze.dropped&&Ze.independent){const Wr=this.getMainFwdBufferInfo(),ri=(Wr?Wr.end:this.getLoadPosition())+this.config.maxBufferHole,Xr=Ze.firstKeyFramePTS?Ze.firstKeyFramePTS:lt;if(!nt&&ri<Xr-this.config.maxBufferHole&&!st){this.backtrack(qe);return}else st&&(qe.gap=!0);qe.setElementaryStreamInfo(Ze.type,qe.start,_r,qe.start,Nr,!0)}qe.setElementaryStreamInfo(Ze.type,lt,_r,jr,Nr),this.backtrackFragment&&(this.backtrackFragment=qe),this.bufferFragmentData(Ze,qe,Ke,Ue,nt||st)}else if(nt||st)qe.gap=!0;else{this.backtrack(qe);return}}if(et){const{startPTS:it,endPTS:nt,startDTS:st,endDTS:lt}=et;Ke&&(Ke.elementaryStreams[ElementaryStreamTypes.AUDIO]={startPTS:it,endPTS:nt,startDTS:st,endDTS:lt}),qe.setElementaryStreamInfo(ElementaryStreamTypes.AUDIO,it,nt,st,lt),this.bufferFragmentData(et,qe,Ke,Ue)}if(rt&&Je!=null&&(ue=Je.samples)!=null&&ue.length){const it={id:pe,frag:qe,details:rt,samples:Je.samples};_e.trigger(Events.FRAG_PARSING_METADATA,it)}if(rt&&Xe){const it={id:pe,frag:qe,details:rt,samples:Xe.samples};_e.trigger(Events.FRAG_PARSING_USERDATA,it)}}_bufferInitSegment(ee,ue,pe,_e){if(this.state!==State.PARSING)return;this.audioOnly=!!ue.audio&&!ue.video,this.altAudio&&!this.audioOnly&&delete ue.audio;const{audio:Ne,video:Ue,audiovideo:Ge}=ue;if(Ne){let qe=ee.audioCodec;const Ke=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(qe&&(qe.indexOf("mp4a.40.5")!==-1?qe="mp4a.40.2":qe="mp4a.40.5"),Ne.metadata.channelCount!==1&&Ke.indexOf("firefox")===-1&&(qe="mp4a.40.5")),Ke.indexOf("android")!==-1&&Ne.container!=="audio/mpeg"&&(qe="mp4a.40.2",this.log(`Android: force audio codec to ${qe}`)),ee.audioCodec&&ee.audioCodec!==qe&&this.log(`Swapping manifest audio codec "${ee.audioCodec}" for "${qe}"`),Ne.levelCodec=qe,Ne.id="main",this.log(`Init audio buffer, container:${Ne.container}, codecs[selected/level/parsed]=[${qe||""}/${ee.audioCodec||""}/${Ne.codec}]`)}Ue&&(Ue.levelCodec=ee.videoCodec,Ue.id="main",this.log(`Init video buffer, container:${Ue.container}, codecs[level/parsed]=[${ee.videoCodec||""}/${Ue.codec}]`)),Ge&&this.log(`Init audiovideo buffer, container:${Ge.container}, codecs[level/parsed]=[${ee.attrs.CODECS||""}/${Ge.codec}]`),this.hls.trigger(Events.BUFFER_CODECS,ue),Object.keys(ue).forEach(qe=>{const Ye=ue[qe].initSegment;Ye!=null&&Ye.byteLength&&this.hls.trigger(Events.BUFFER_APPENDING,{type:qe,data:Ye,frag:pe,part:null,chunkMeta:_e,parent:pe.type})}),this.tick()}getMainFwdBufferInfo(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,PlaylistLevelType.MAIN)}backtrack(ee){this.couldBacktrack=!0,this.backtrackFragment=ee,this.resetTransmuxer(),this.flushBufferGap(ee),this.fragmentTracker.removeFragment(ee),this.fragPrevious=null,this.nextLoadPosition=ee.start,this.state=State.IDLE}checkFragmentChanged(){const ee=this.media;let ue=null;if(ee&&ee.readyState>1&&ee.seeking===!1){const pe=ee.currentTime;if(BufferHelper.isBuffered(ee,pe)?ue=this.getAppendedFrag(pe):BufferHelper.isBuffered(ee,pe+.1)&&(ue=this.getAppendedFrag(pe+.1)),ue){this.backtrackFragment=null;const _e=this.fragPlaying,Ne=ue.level;(!_e||ue.sn!==_e.sn||_e.level!==Ne||ue.urlId!==_e.urlId)&&(this.fragPlaying=ue,this.hls.trigger(Events.FRAG_CHANGED,{frag:ue}),(!_e||_e.level!==Ne)&&this.hls.trigger(Events.LEVEL_SWITCHED,{level:Ne}))}}}get nextLevel(){const ee=this.nextBufferedFrag;return ee?ee.level:-1}get currentFrag(){const ee=this.media;return ee?this.fragPlaying||this.getAppendedFrag(ee.currentTime):null}get currentProgramDateTime(){const ee=this.media;if(ee){const ue=ee.currentTime,pe=this.currentFrag;if(pe&&isFiniteNumber(ue)&&isFiniteNumber(pe.programDateTime)){const _e=pe.programDateTime+(ue-pe.start)*1e3;return new Date(_e)}}return null}get currentLevel(){const ee=this.currentFrag;return ee?ee.level:-1}get nextBufferedFrag(){const ee=this.currentFrag;return ee?this.followingBufferedFrag(ee):null}get forceStartLoad(){return this._forceStartLoad}}class EWMA{constructor(ee,ue=0,pe=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=ee,this.alpha_=ee?Math.exp(Math.log(.5)/ee):0,this.estimate_=ue,this.totalWeight_=pe}sample(ee,ue){const pe=Math.pow(this.alpha_,ee);this.estimate_=ue*(1-pe)+pe*this.estimate_,this.totalWeight_+=ee}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const ee=1-Math.pow(this.alpha_,this.totalWeight_);if(ee)return this.estimate_/ee}return this.estimate_}}class EwmaBandWidthEstimator{constructor(ee,ue,pe,_e=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=pe,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new EWMA(ee),this.fast_=new EWMA(ue),this.defaultTTFB_=_e,this.ttfb_=new EWMA(ee)}update(ee,ue){const{slow_:pe,fast_:_e,ttfb_:Ne}=this;pe.halfLife!==ee&&(this.slow_=new EWMA(ee,pe.getEstimate(),pe.getTotalWeight())),_e.halfLife!==ue&&(this.fast_=new EWMA(ue,_e.getEstimate(),_e.getTotalWeight())),Ne.halfLife!==ee&&(this.ttfb_=new EWMA(ee,Ne.getEstimate(),Ne.getTotalWeight()))}sample(ee,ue){ee=Math.max(ee,this.minDelayMs_);const pe=8*ue,_e=ee/1e3,Ne=pe/_e;this.fast_.sample(_e,Ne),this.slow_.sample(_e,Ne)}sampleTTFB(ee){const ue=ee/1e3,pe=Math.sqrt(2)*Math.exp(-Math.pow(ue,2)/2);this.ttfb_.sample(pe,Math.max(ee,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}destroy(){}}class AbrController{constructor(ee){this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=-1,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=ee;const ue=ee.config;this.bwEstimator=new EwmaBandWidthEstimator(ue.abrEwmaSlowVoD,ue.abrEwmaFastVoD,ue.abrEwmaDefaultEstimate),this.registerListeners()}registerListeners(){const{hls:ee}=this;ee.on(Events.FRAG_LOADING,this.onFragLoading,this),ee.on(Events.FRAG_LOADED,this.onFragLoaded,this),ee.on(Events.FRAG_BUFFERED,this.onFragBuffered,this),ee.on(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),ee.on(Events.LEVEL_LOADED,this.onLevelLoaded,this)}unregisterListeners(){const{hls:ee}=this;ee.off(Events.FRAG_LOADING,this.onFragLoading,this),ee.off(Events.FRAG_LOADED,this.onFragLoaded,this),ee.off(Events.FRAG_BUFFERED,this.onFragBuffered,this),ee.off(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),ee.off(Events.LEVEL_LOADED,this.onLevelLoaded,this)}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null}onFragLoading(ee,ue){var pe;const _e=ue.frag;this.ignoreFragment(_e)||(this.fragCurrent=_e,this.partCurrent=(pe=ue.part)!=null?pe:null,this.clearTimer(),this.timer=self.setInterval(this.onCheck,100))}onLevelSwitching(ee,ue){this.clearTimer()}getTimeToLoadFrag(ee,ue,pe,_e){const Ne=ee+pe/ue,Ue=_e?this.lastLevelLoadSec:0;return Ne+Ue}onLevelLoaded(ee,ue){const pe=this.hls.config,{total:_e,bwEstimate:Ne}=ue.stats;isFiniteNumber(_e)&&isFiniteNumber(Ne)&&(this.lastLevelLoadSec=8*_e/Ne),ue.details.live?this.bwEstimator.update(pe.abrEwmaSlowLive,pe.abrEwmaFastLive):this.bwEstimator.update(pe.abrEwmaSlowVoD,pe.abrEwmaFastVoD)}_abandonRulesCheck(){const{fragCurrent:ee,partCurrent:ue,hls:pe}=this,{autoLevelEnabled:_e,media:Ne}=pe;if(!ee||!Ne)return;const Ue=performance.now(),Ge=ue?ue.stats:ee.stats,qe=ue?ue.duration:ee.duration,Ke=Ue-Ge.loading.start;if(Ge.aborted||Ge.loaded&&Ge.loaded===Ge.total||ee.level===0){this.clearTimer(),this._nextAutoLevel=-1;return}if(!_e||Ne.paused||!Ne.playbackRate||!Ne.readyState)return;const Ye=pe.mainForwardBufferInfo;if(Ye===null)return;const Ze=this.bwEstimator.getEstimateTTFB(),Xe=Math.abs(Ne.playbackRate);if(Ke<=Math.max(Ze,1e3*(qe/(Xe*2))))return;const Je=Ye.len/Xe;if(Je>=2*qe/Xe)return;const tt=Ge.loading.first?Ge.loading.first-Ge.loading.start:-1,rt=Ge.loaded&&tt>-1,et=this.bwEstimator.getEstimate(),{levels:it,minAutoLevel:nt}=pe,st=it[ee.level],lt=Ge.total||Math.max(Ge.loaded,Math.round(qe*st.maxBitrate/8));let _r=Ke-tt;_r<1&&rt&&(_r=Math.min(Ke,Ge.loaded*8/et));const jr=rt?Ge.loaded*1e3/_r:0,Nr=jr?(lt-Ge.loaded)/jr:lt*8/et+Ze/1e3;if(Nr<=Je)return;const Wr=jr?jr*8:et;let ri=Number.POSITIVE_INFINITY,Xr;for(Xr=ee.level-1;Xr>nt;Xr--){const Gr=it[Xr].maxBitrate;if(ri=this.getTimeToLoadFrag(Ze/1e3,Wr,qe*Gr,!it[Xr].details),ri<Je)break}ri>=Nr||ri>qe*10||(pe.nextLoadLevel=Xr,rt?this.bwEstimator.sample(Ke-Math.min(Ze,tt),Ge.loaded):this.bwEstimator.sampleTTFB(Ke),this.clearTimer(),logger.warn(`[abr] Fragment ${ee.sn}${ue?" part "+ue.index:""} of level ${ee.level} is loading too slowly;
      Time to underbuffer: ${Je.toFixed(3)} s
      Estimated load time for current fragment: ${Nr.toFixed(3)} s
      Estimated load time for down switch fragment: ${ri.toFixed(3)} s
      TTFB estimate: ${tt}
      Current BW estimate: ${isFiniteNumber(et)?(et/1024).toFixed(3):"Unknown"} Kb/s
      New BW estimate: ${(this.bwEstimator.getEstimate()/1024).toFixed(3)} Kb/s
      Aborting and switching to level ${Xr}`),ee.loader&&(this.fragCurrent=this.partCurrent=null,ee.abortRequests()),pe.trigger(Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:ee,part:ue,stats:Ge}))}onFragLoaded(ee,{frag:ue,part:pe}){const _e=pe?pe.stats:ue.stats;if(ue.type===PlaylistLevelType.MAIN&&this.bwEstimator.sampleTTFB(_e.loading.first-_e.loading.start),!this.ignoreFragment(ue)){if(this.clearTimer(),this.lastLoadedFragLevel=ue.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){const Ne=pe?pe.duration:ue.duration,Ue=this.hls.levels[ue.level],Ge=(Ue.loaded?Ue.loaded.bytes:0)+_e.loaded,qe=(Ue.loaded?Ue.loaded.duration:0)+Ne;Ue.loaded={bytes:Ge,duration:qe},Ue.realBitrate=Math.round(8*Ge/qe)}if(ue.bitrateTest){const Ne={stats:_e,frag:ue,part:pe,id:ue.type};this.onFragBuffered(Events.FRAG_BUFFERED,Ne),ue.bitrateTest=!1}}}onFragBuffered(ee,ue){const{frag:pe,part:_e}=ue,Ne=_e!=null&&_e.stats.loaded?_e.stats:pe.stats;if(Ne.aborted||this.ignoreFragment(pe))return;const Ue=Ne.parsing.end-Ne.loading.start-Math.min(Ne.loading.first-Ne.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(Ue,Ne.loaded),Ne.bwEstimate=this.bwEstimator.getEstimate(),pe.bitrateTest?this.bitrateTestDelay=Ue/1e3:this.bitrateTestDelay=0}ignoreFragment(ee){return ee.type!==PlaylistLevelType.MAIN||ee.sn==="initSegment"}clearTimer(){self.clearInterval(this.timer)}get nextAutoLevel(){const ee=this._nextAutoLevel,ue=this.bwEstimator;if(ee!==-1&&!ue.canEstimate())return ee;let pe=this.getNextABRAutoLevel();if(ee!==-1){const _e=this.hls.levels;if(_e.length>Math.max(ee,pe)&&_e[ee].loadError<=_e[pe].loadError)return ee}return ee!==-1&&(pe=Math.min(ee,pe)),pe}getNextABRAutoLevel(){const{fragCurrent:ee,partCurrent:ue,hls:pe}=this,{maxAutoLevel:_e,config:Ne,minAutoLevel:Ue,media:Ge}=pe,qe=ue?ue.duration:ee?ee.duration:0,Ke=Ge&&Ge.playbackRate!==0?Math.abs(Ge.playbackRate):1,Ye=this.bwEstimator?this.bwEstimator.getEstimate():Ne.abrEwmaDefaultEstimate,Ze=pe.mainForwardBufferInfo,Xe=(Ze?Ze.len:0)/Ke;let Je=this.findBestLevel(Ye,Ue,_e,Xe,Ne.abrBandWidthFactor,Ne.abrBandWidthUpFactor);if(Je>=0)return Je;logger.trace(`[abr] ${Xe?"rebuffering expected":"buffer is empty"}, finding optimal quality level`);let tt=qe?Math.min(qe,Ne.maxStarvationDelay):Ne.maxStarvationDelay,rt=Ne.abrBandWidthFactor,et=Ne.abrBandWidthUpFactor;if(!Xe){const it=this.bitrateTestDelay;it&&(tt=(qe?Math.min(qe,Ne.maxLoadingDelay):Ne.maxLoadingDelay)-it,logger.trace(`[abr] bitrate test took ${Math.round(1e3*it)}ms, set first fragment max fetchDuration to ${Math.round(1e3*tt)} ms`),rt=et=1)}return Je=this.findBestLevel(Ye,Ue,_e,Xe+tt,rt,et),Math.max(Je,0)}findBestLevel(ee,ue,pe,_e,Ne,Ue){var Ge;const{fragCurrent:qe,partCurrent:Ke,lastLoadedFragLevel:Ye}=this,{levels:Ze}=this.hls,Xe=Ze[Ye],Je=!!(Xe!=null&&(Ge=Xe.details)!=null&&Ge.live),tt=Xe==null?void 0:Xe.codecSet,rt=Ke?Ke.duration:qe?qe.duration:0,et=this.bwEstimator.getEstimateTTFB()/1e3;let it=ue,nt=-1;for(let st=pe;st>=ue;st--){const lt=Ze[st];if(!lt||tt&&lt.codecSet!==tt){lt&&(it=Math.min(st,it),nt=Math.max(st,nt));continue}nt!==-1&&logger.trace(`[abr] Skipped level(s) ${it}-${nt} with CODECS:"${Ze[nt].attrs.CODECS}"; not compatible with "${Xe.attrs.CODECS}"`);const _r=lt.details,jr=(Ke?_r==null?void 0:_r.partTarget:_r==null?void 0:_r.averagetargetduration)||rt;let Nr;st<=Ye?Nr=Ne*ee:Nr=Ue*ee;const Wr=Ze[st].maxBitrate,ri=this.getTimeToLoadFrag(et,Nr,Wr*jr,_r===void 0);if(logger.trace(`[abr] level:${st} adjustedbw-bitrate:${Math.round(Nr-Wr)} avgDuration:${jr.toFixed(1)} maxFetchDuration:${_e.toFixed(1)} fetchDuration:${ri.toFixed(1)}`),Nr>Wr&&(ri===0||!isFiniteNumber(ri)||Je&&!this.bitrateTestDelay||ri<_e))return st}return-1}set nextAutoLevel(ee){this._nextAutoLevel=ee}}class ChunkCache{constructor(){this.chunks=[],this.dataLength=0}push(ee){this.chunks.push(ee),this.dataLength+=ee.length}flush(){const{chunks:ee,dataLength:ue}=this;let pe;if(ee.length)ee.length===1?pe=ee[0]:pe=concatUint8Arrays(ee,ue);else return new Uint8Array(0);return this.reset(),pe}reset(){this.chunks.length=0,this.dataLength=0}}function concatUint8Arrays(fe,ee){const ue=new Uint8Array(ee);let pe=0;for(let _e=0;_e<fe.length;_e++){const Ne=fe[_e];ue.set(Ne,pe),pe+=Ne.length}return ue}const TICK_INTERVAL$1=100;class AudioStreamController extends BaseStreamController{constructor(ee,ue,pe){super(ee,ue,pe,"[audio-stream-controller]",PlaylistLevelType.AUDIO),this.videoBuffer=null,this.videoTrackCC=-1,this.waitingVideoCC=-1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),this.mainDetails=null,this.bufferedTrack=null,this.switchingTrack=null}_registerListeners(){const{hls:ee}=this;ee.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),ee.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),ee.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),ee.on(Events.LEVEL_LOADED,this.onLevelLoaded,this),ee.on(Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),ee.on(Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),ee.on(Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),ee.on(Events.ERROR,this.onError,this),ee.on(Events.BUFFER_RESET,this.onBufferReset,this),ee.on(Events.BUFFER_CREATED,this.onBufferCreated,this),ee.on(Events.BUFFER_FLUSHED,this.onBufferFlushed,this),ee.on(Events.INIT_PTS_FOUND,this.onInitPtsFound,this),ee.on(Events.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:ee}=this;ee.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),ee.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),ee.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),ee.off(Events.LEVEL_LOADED,this.onLevelLoaded,this),ee.off(Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),ee.off(Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),ee.off(Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),ee.off(Events.ERROR,this.onError,this),ee.off(Events.BUFFER_RESET,this.onBufferReset,this),ee.off(Events.BUFFER_CREATED,this.onBufferCreated,this),ee.off(Events.BUFFER_FLUSHED,this.onBufferFlushed,this),ee.off(Events.INIT_PTS_FOUND,this.onInitPtsFound,this),ee.off(Events.FRAG_BUFFERED,this.onFragBuffered,this)}onInitPtsFound(ee,{frag:ue,id:pe,initPTS:_e,timescale:Ne}){if(pe==="main"){const Ue=ue.cc;this.initPTS[ue.cc]={baseTime:_e,timescale:Ne},this.log(`InitPTS for cc: ${Ue} found from main: ${_e}`),this.videoTrackCC=Ue,this.state===State.WAITING_INIT_PTS&&this.tick()}}startLoad(ee){if(!this.levels){this.startPosition=ee,this.state=State.STOPPED;return}const ue=this.lastCurrentTime;this.stopLoad(),this.setInterval(TICK_INTERVAL$1),ue>0&&ee===-1?(this.log(`Override startPosition with lastCurrentTime @${ue.toFixed(3)}`),ee=ue,this.state=State.IDLE):(this.loadedmetadata=!1,this.state=State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=ee,this.tick()}doTick(){switch(this.state){case State.IDLE:this.doTickIdle();break;case State.WAITING_TRACK:{var ee;const{levels:pe,trackId:_e}=this,Ne=pe==null||(ee=pe[_e])==null?void 0:ee.details;if(Ne){if(this.waitForCdnTuneIn(Ne))break;this.state=State.WAITING_INIT_PTS}break}case State.FRAG_LOADING_WAITING_RETRY:{var ue;const pe=performance.now(),_e=this.retryDate;(!_e||pe>=_e||(ue=this.media)!=null&&ue.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=State.IDLE);break}case State.WAITING_INIT_PTS:{const pe=this.waitingData;if(pe){const{frag:_e,part:Ne,cache:Ue,complete:Ge}=pe;if(this.initPTS[_e.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=State.FRAG_LOADING;const qe=Ue.flush(),Ke={frag:_e,part:Ne,payload:qe,networkDetails:null};this._handleFragmentLoadProgress(Ke),Ge&&super._handleFragmentLoadComplete(Ke)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log(`Waiting fragment cc (${_e.cc}) cancelled because video is at cc ${this.videoTrackCC}`),this.clearWaitingFragment();else{const qe=this.getLoadPosition(),Ke=BufferHelper.bufferInfo(this.mediaBuffer,qe,this.config.maxBufferHole);fragmentWithinToleranceTest(Ke.end,this.config.maxFragLookUpTolerance,_e)<0&&(this.log(`Waiting fragment cc (${_e.cc}) @ ${_e.start} cancelled because another fragment at ${Ke.end} is needed`),this.clearWaitingFragment())}}else this.state=State.IDLE}}this.onTickEnd()}clearWaitingFragment(){const ee=this.waitingData;ee&&(this.fragmentTracker.removeFragment(ee.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=State.IDLE)}resetLoadingState(){this.clearWaitingFragment(),super.resetLoadingState()}onTickEnd(){const{media:ee}=this;ee!=null&&ee.readyState&&(this.lastCurrentTime=ee.currentTime)}doTickIdle(){const{hls:ee,levels:ue,media:pe,trackId:_e}=this,Ne=ee.config;if(!(ue!=null&&ue[_e])||!pe&&(this.startFragRequested||!Ne.startFragPrefetch))return;const Ue=ue[_e],Ge=Ue.details;if(!Ge||Ge.live&&this.levelLastLoaded!==_e||this.waitForCdnTuneIn(Ge)){this.state=State.WAITING_TRACK;return}const qe=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&qe&&(this.bufferFlushed=!1,this.afterBufferFlushed(qe,ElementaryStreamTypes.AUDIO,PlaylistLevelType.AUDIO));const Ke=this.getFwdBufferInfo(qe,PlaylistLevelType.AUDIO);if(Ke===null)return;const{bufferedTrack:Ye,switchingTrack:Ze}=this;if(!Ze&&this._streamEnded(Ke,Ge)){ee.trigger(Events.BUFFER_EOS,{type:"audio"}),this.state=State.ENDED;return}const Xe=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,PlaylistLevelType.MAIN),Je=Ke.len,tt=this.getMaxBufferLength(Xe==null?void 0:Xe.len);if(Je>=tt&&!Ze)return;const et=Ge.fragments[0].start;let it=Ke.end;if(Ze&&pe){const _r=this.getLoadPosition();Ye&&Ze.attrs!==Ye.attrs&&(it=_r),Ge.PTSKnown&&_r<et&&(Ke.end>et||Ke.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),pe.currentTime=et+.05)}let nt=this.getNextFragment(it,Ge),st=!1;if(nt&&this.isLoopLoading(nt,it)&&(st=!!nt.gap,nt=this.getNextFragmentLoopLoading(nt,Ge,Ke,PlaylistLevelType.MAIN,tt)),!nt){this.bufferFlushed=!0;return}const lt=Xe&&nt.start>Xe.end+Ge.targetduration;if(lt||!(Xe!=null&&Xe.len)&&Ke.len){const _r=this.getAppendedFrag(nt.start,PlaylistLevelType.MAIN);if(_r===null||(st||(st=!!_r.gap||!!lt&&Xe.len===0),lt&&!st||st&&Ke.nextStart&&Ke.nextStart<_r.end))return}this.loadFragment(nt,Ue,it)}getMaxBufferLength(ee){const ue=super.getMaxBufferLength();return ee?Math.min(Math.max(ue,ee),this.config.maxMaxBufferLength):ue}onMediaDetaching(){this.videoBuffer=null,super.onMediaDetaching()}onAudioTracksUpdated(ee,{audioTracks:ue}){this.resetTransmuxer(),this.levels=ue.map(pe=>new Level(pe))}onAudioTrackSwitching(ee,ue){const pe=!!ue.url;this.trackId=ue.id;const{fragCurrent:_e}=this;_e&&(_e.abortRequests(),this.removeUnbufferedFrags(_e.start)),this.resetLoadingState(),pe?this.setInterval(TICK_INTERVAL$1):this.resetTransmuxer(),pe?(this.switchingTrack=ue,this.state=State.IDLE):(this.switchingTrack=null,this.bufferedTrack=ue,this.state=State.STOPPED),this.tick()}onManifestLoading(){this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1,this.levels=this.mainDetails=this.waitingData=this.bufferedTrack=this.cachedTrackLoadedData=this.switchingTrack=null,this.startFragRequested=!1,this.trackId=this.videoTrackCC=this.waitingVideoCC=-1}onLevelLoaded(ee,ue){this.mainDetails=ue.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(Events.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)}onAudioTrackLoaded(ee,ue){var pe;if(this.mainDetails==null){this.cachedTrackLoadedData=ue;return}const{levels:_e}=this,{details:Ne,id:Ue}=ue;if(!_e){this.warn(`Audio tracks were reset while loading level ${Ue}`);return}this.log(`Track ${Ue} loaded [${Ne.startSN},${Ne.endSN}]${Ne.lastPartSn?`[part-${Ne.lastPartSn}-${Ne.lastPartIndex}]`:""},duration:${Ne.totalduration}`);const Ge=_e[Ue];let qe=0;if(Ne.live||(pe=Ge.details)!=null&&pe.live){this.checkLiveUpdate(Ne);const Ke=this.mainDetails;if(Ne.deltaUpdateFailed||!Ke)return;!Ge.details&&Ne.hasProgramDateTime&&Ke.hasProgramDateTime?(alignMediaPlaylistByPDT(Ne,Ke),qe=Ne.fragments[0].start):qe=this.alignPlaylists(Ne,Ge.details)}Ge.details=Ne,this.levelLastLoaded=Ue,!this.startFragRequested&&(this.mainDetails||!Ne.live)&&this.setStartPosition(Ge.details,qe),this.state===State.WAITING_TRACK&&!this.waitForCdnTuneIn(Ne)&&(this.state=State.IDLE),this.tick()}_handleFragmentLoadProgress(ee){var ue;const{frag:pe,part:_e,payload:Ne}=ee,{config:Ue,trackId:Ge,levels:qe}=this;if(!qe){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${pe.sn} of level ${pe.level} will not be buffered`);return}const Ke=qe[Ge];if(!Ke){this.warn("Audio track is undefined on fragment load progress");return}const Ye=Ke.details;if(!Ye){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(pe.start);return}const Ze=Ue.defaultAudioCodec||Ke.audioCodec||"mp4a.40.2";let Xe=this.transmuxer;Xe||(Xe=this.transmuxer=new TransmuxerInterface(this.hls,PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const Je=this.initPTS[pe.cc],tt=(ue=pe.initSegment)==null?void 0:ue.data;if(Je!==void 0){const et=_e?_e.index:-1,it=et!==-1,nt=new ChunkMetadata(pe.level,pe.sn,pe.stats.chunkCount,Ne.byteLength,et,it);Xe.push(Ne,tt,Ze,"",pe,_e,Ye.totalduration,!1,nt,Je)}else{this.log(`Unknown video PTS for cc ${pe.cc}, waiting for video PTS before demuxing audio frag ${pe.sn} of [${Ye.startSN} ,${Ye.endSN}],track ${Ge}`);const{cache:rt}=this.waitingData=this.waitingData||{frag:pe,part:_e,cache:new ChunkCache,complete:!1};rt.push(new Uint8Array(Ne)),this.waitingVideoCC=this.videoTrackCC,this.state=State.WAITING_INIT_PTS}}_handleFragmentLoadComplete(ee){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(ee)}onBufferReset(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1}onBufferCreated(ee,ue){const pe=ue.tracks.audio;pe&&(this.mediaBuffer=pe.buffer||null),ue.tracks.video&&(this.videoBuffer=ue.tracks.video.buffer||null)}onFragBuffered(ee,ue){const{frag:pe,part:_e}=ue;if(pe.type!==PlaylistLevelType.AUDIO){if(!this.loadedmetadata&&pe.type===PlaylistLevelType.MAIN){const Ne=this.videoBuffer||this.media;Ne&&BufferHelper.getBuffered(Ne).length&&(this.loadedmetadata=!0)}return}if(this.fragContextChanged(pe)){this.warn(`Fragment ${pe.sn}${_e?" p: "+_e.index:""} of level ${pe.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(pe.sn!=="initSegment"){this.fragPrevious=pe;const Ne=this.switchingTrack;Ne&&(this.bufferedTrack=Ne,this.switchingTrack=null,this.hls.trigger(Events.AUDIO_TRACK_SWITCHED,_objectSpread2({},Ne)))}this.fragBufferedComplete(pe,_e)}onError(ee,ue){var pe;if(ue.fatal){this.state=State.ERROR;return}switch(ue.details){case ErrorDetails.FRAG_GAP:case ErrorDetails.FRAG_PARSING_ERROR:case ErrorDetails.FRAG_DECRYPT_ERROR:case ErrorDetails.FRAG_LOAD_ERROR:case ErrorDetails.FRAG_LOAD_TIMEOUT:case ErrorDetails.KEY_LOAD_ERROR:case ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(PlaylistLevelType.AUDIO,ue);break;case ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case ErrorDetails.LEVEL_PARSING_ERROR:!ue.levelRetry&&this.state===State.WAITING_TRACK&&((pe=ue.context)==null?void 0:pe.type)===PlaylistContextType.AUDIO_TRACK&&(this.state=State.IDLE);break;case ErrorDetails.BUFFER_FULL_ERROR:if(!ue.parent||ue.parent!=="audio")return;this.reduceLengthAndFlushBuffer(ue)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case ErrorDetails.INTERNAL_EXCEPTION:this.recoverWorkerError(ue);break}}onBufferFlushed(ee,{type:ue}){ue===ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0,this.state===State.ENDED&&(this.state=State.IDLE))}_handleTransmuxComplete(ee){var ue;const pe="audio",{hls:_e}=this,{remuxResult:Ne,chunkMeta:Ue}=ee,Ge=this.getCurrentContext(Ue);if(!Ge){this.resetWhenMissingContext(Ue);return}const{frag:qe,part:Ke,level:Ye}=Ge,{details:Ze}=Ye,{audio:Xe,text:Je,id3:tt,initSegment:rt}=Ne;if(this.fragContextChanged(qe)||!Ze){this.fragmentTracker.removeFragment(qe);return}if(this.state=State.PARSING,this.switchingTrack&&Xe&&this.completeAudioSwitch(this.switchingTrack),rt!=null&&rt.tracks){const et=qe.initSegment||qe;this._bufferInitSegment(rt.tracks,et,Ue),_e.trigger(Events.FRAG_PARSING_INIT_SEGMENT,{frag:et,id:pe,tracks:rt.tracks})}if(Xe){const{startPTS:et,endPTS:it,startDTS:nt,endDTS:st}=Xe;Ke&&(Ke.elementaryStreams[ElementaryStreamTypes.AUDIO]={startPTS:et,endPTS:it,startDTS:nt,endDTS:st}),qe.setElementaryStreamInfo(ElementaryStreamTypes.AUDIO,et,it,nt,st),this.bufferFragmentData(Xe,qe,Ke,Ue)}if(tt!=null&&(ue=tt.samples)!=null&&ue.length){const et=_extends({id:pe,frag:qe,details:Ze},tt);_e.trigger(Events.FRAG_PARSING_METADATA,et)}if(Je){const et=_extends({id:pe,frag:qe,details:Ze},Je);_e.trigger(Events.FRAG_PARSING_USERDATA,et)}}_bufferInitSegment(ee,ue,pe){if(this.state!==State.PARSING)return;ee.video&&delete ee.video;const _e=ee.audio;if(!_e)return;_e.levelCodec=_e.codec,_e.id="audio",this.log(`Init audio buffer, container:${_e.container}, codecs[parsed]=[${_e.codec}]`),this.hls.trigger(Events.BUFFER_CODECS,ee);const Ne=_e.initSegment;if(Ne!=null&&Ne.byteLength){const Ue={type:"audio",frag:ue,part:null,chunkMeta:pe,parent:ue.type,data:Ne};this.hls.trigger(Events.BUFFER_APPENDING,Ue)}this.tick()}loadFragment(ee,ue,pe){const _e=this.fragmentTracker.getState(ee);if(this.fragCurrent=ee,this.switchingTrack||_e===FragmentState.NOT_LOADED||_e===FragmentState.PARTIAL){var Ne;ee.sn==="initSegment"?this._loadInitSegment(ee,ue):(Ne=ue.details)!=null&&Ne.live&&!this.initPTS[ee.cc]?(this.log(`Waiting for video PTS in continuity counter ${ee.cc} of live stream before loading audio fragment ${ee.sn} of level ${this.trackId}`),this.state=State.WAITING_INIT_PTS):(this.startFragRequested=!0,super.loadFragment(ee,ue,pe))}else this.clearTrackerIfNeeded(ee)}completeAudioSwitch(ee){const{hls:ue,media:pe,bufferedTrack:_e}=this,Ne=_e==null?void 0:_e.attrs,Ue=ee.attrs;pe&&Ne&&(Ne.CHANNELS!==Ue.CHANNELS||Ne.NAME!==Ue.NAME||Ne.LANGUAGE!==Ue.LANGUAGE)&&(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio")),this.bufferedTrack=ee,this.switchingTrack=null,ue.trigger(Events.AUDIO_TRACK_SWITCHED,_objectSpread2({},ee))}}class AudioTrackController extends BasePlaylistController{constructor(ee){super(ee,"[audio-track-controller]"),this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:ee}=this;ee.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),ee.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),ee.on(Events.LEVEL_LOADING,this.onLevelLoading,this),ee.on(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),ee.on(Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),ee.on(Events.ERROR,this.onError,this)}unregisterListeners(){const{hls:ee}=this;ee.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),ee.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),ee.off(Events.LEVEL_LOADING,this.onLevelLoading,this),ee.off(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),ee.off(Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),ee.off(Events.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(ee,ue){this.tracks=ue.audioTracks||[]}onAudioTrackLoaded(ee,ue){const{id:pe,groupId:_e,details:Ne}=ue,Ue=this.tracksInGroup[pe];if(!Ue||Ue.groupId!==_e){this.warn(`Track with id:${pe} and group:${_e} not found in active group ${Ue.groupId}`);return}const Ge=Ue.details;Ue.details=ue.details,this.log(`audio-track ${pe} "${Ue.name}" lang:${Ue.lang} group:${_e} loaded [${Ne.startSN}-${Ne.endSN}]`),pe===this.trackId&&this.playlistLoaded(pe,ue,Ge)}onLevelLoading(ee,ue){this.switchLevel(ue.level)}onLevelSwitching(ee,ue){this.switchLevel(ue.level)}switchLevel(ee){const ue=this.hls.levels[ee];if(!(ue!=null&&ue.audioGroupIds))return;const pe=ue.audioGroupIds[ue.urlId];if(this.groupId!==pe){this.groupId=pe||null;const _e=this.tracks.filter(Ue=>!pe||Ue.groupId===pe);this.selectDefaultTrack&&!_e.some(Ue=>Ue.default)&&(this.selectDefaultTrack=!1),this.tracksInGroup=_e;const Ne={audioTracks:_e};this.log(`Updating audio tracks, ${_e.length} track(s) found in group:${pe}`),this.hls.trigger(Events.AUDIO_TRACKS_UPDATED,Ne),this.selectInitialTrack()}else this.shouldReloadPlaylist(this.currentTrack)&&this.setAudioTrack(this.trackId)}onError(ee,ue){ue.fatal||!ue.context||ue.context.type===PlaylistContextType.AUDIO_TRACK&&ue.context.id===this.trackId&&ue.context.groupId===this.groupId&&(this.requestScheduled=-1,this.checkRetry(ue))}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(ee){this.selectDefaultTrack=!1,this.setAudioTrack(ee)}setAudioTrack(ee){const ue=this.tracksInGroup;if(ee<0||ee>=ue.length){this.warn("Invalid id passed to audio-track controller");return}this.clearTimer();const pe=this.currentTrack;ue[this.trackId];const _e=ue[ee],{groupId:Ne,name:Ue}=_e;if(this.log(`Switching to audio-track ${ee} "${Ue}" lang:${_e.lang} group:${Ne}`),this.trackId=ee,this.currentTrack=_e,this.selectDefaultTrack=!1,this.hls.trigger(Events.AUDIO_TRACK_SWITCHING,_objectSpread2({},_e)),_e.details&&!_e.details.live)return;const Ge=this.switchParams(_e.url,pe==null?void 0:pe.details);this.loadPlaylist(Ge)}selectInitialTrack(){const ee=this.tracksInGroup,ue=this.findTrackId(this.currentTrack)|this.findTrackId(null);if(ue!==-1)this.setAudioTrack(ue);else{const pe=new Error(`No track found for running audio group-ID: ${this.groupId} track count: ${ee.length}`);this.warn(pe.message),this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:pe})}}findTrackId(ee){const ue=this.tracksInGroup;for(let pe=0;pe<ue.length;pe++){const _e=ue[pe];if((!this.selectDefaultTrack||_e.default)&&(!ee||ee.attrs["STABLE-RENDITION-ID"]!==void 0&&ee.attrs["STABLE-RENDITION-ID"]===_e.attrs["STABLE-RENDITION-ID"]||ee.name===_e.name&&ee.lang===_e.lang))return _e.id}return-1}loadPlaylist(ee){super.loadPlaylist();const ue=this.tracksInGroup[this.trackId];if(this.shouldLoadPlaylist(ue)){const pe=ue.id,_e=ue.groupId;let Ne=ue.url;if(ee)try{Ne=ee.addDirectives(Ne)}catch(Ue){this.warn(`Could not construct new URL with HLS Delivery Directives: ${Ue}`)}this.log(`loading audio-track playlist ${pe} "${ue.name}" lang:${ue.lang} group:${_e}`),this.clearTimer(),this.hls.trigger(Events.AUDIO_TRACK_LOADING,{url:Ne,id:pe,groupId:_e,deliveryDirectives:ee||null})}}}function subtitleOptionsIdentical(fe,ee){if(fe.length!==ee.length)return!1;for(let ue=0;ue<fe.length;ue++)if(!subtitleAttributesIdentical(fe[ue].attrs,ee[ue].attrs))return!1;return!0}function subtitleAttributesIdentical(fe,ee){const ue=fe["STABLE-RENDITION-ID"];return ue?ue===ee["STABLE-RENDITION-ID"]:!["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED"].some(pe=>fe[pe]!==ee[pe])}const TICK_INTERVAL=500;class SubtitleStreamController extends BaseStreamController{constructor(ee,ue,pe){super(ee,ue,pe,"[subtitle-stream-controller]",PlaylistLevelType.SUBTITLE),this.levels=[],this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),this.mainDetails=null}_registerListeners(){const{hls:ee}=this;ee.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),ee.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),ee.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),ee.on(Events.LEVEL_LOADED,this.onLevelLoaded,this),ee.on(Events.ERROR,this.onError,this),ee.on(Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),ee.on(Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),ee.on(Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),ee.on(Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),ee.on(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),ee.on(Events.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:ee}=this;ee.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),ee.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),ee.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),ee.off(Events.LEVEL_LOADED,this.onLevelLoaded,this),ee.off(Events.ERROR,this.onError,this),ee.off(Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),ee.off(Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),ee.off(Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),ee.off(Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),ee.off(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),ee.off(Events.FRAG_BUFFERED,this.onFragBuffered,this)}startLoad(ee){this.stopLoad(),this.state=State.IDLE,this.setInterval(TICK_INTERVAL),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=ee,this.tick()}onManifestLoading(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()}onMediaDetaching(){this.tracksBuffered=[],super.onMediaDetaching()}onLevelLoaded(ee,ue){this.mainDetails=ue.details}onSubtitleFragProcessed(ee,ue){const{frag:pe,success:_e}=ue;if(this.fragPrevious=pe,this.state=State.IDLE,!_e)return;const Ne=this.tracksBuffered[this.currentTrackId];if(!Ne)return;let Ue;const Ge=pe.start;for(let Ke=0;Ke<Ne.length;Ke++)if(Ge>=Ne[Ke].start&&Ge<=Ne[Ke].end){Ue=Ne[Ke];break}const qe=pe.start+pe.duration;Ue?Ue.end=qe:(Ue={start:Ge,end:qe},Ne.push(Ue)),this.fragmentTracker.fragBuffered(pe)}onBufferFlushing(ee,ue){const{startOffset:pe,endOffset:_e}=ue;if(pe===0&&_e!==Number.POSITIVE_INFINITY){const Ne=_e-1;if(Ne<=0)return;ue.endOffsetSubtitles=Math.max(0,Ne),this.tracksBuffered.forEach(Ue=>{for(let Ge=0;Ge<Ue.length;){if(Ue[Ge].end<=Ne){Ue.shift();continue}else if(Ue[Ge].start<Ne)Ue[Ge].start=Ne;else break;Ge++}}),this.fragmentTracker.removeFragmentsInRange(pe,Ne,PlaylistLevelType.SUBTITLE)}}onFragBuffered(ee,ue){if(!this.loadedmetadata&&ue.frag.type===PlaylistLevelType.MAIN){var pe;(pe=this.media)!=null&&pe.buffered.length&&(this.loadedmetadata=!0)}}onError(ee,ue){const pe=ue.frag;(pe==null?void 0:pe.type)===PlaylistLevelType.SUBTITLE&&(this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==State.STOPPED&&(this.state=State.IDLE))}onSubtitleTracksUpdated(ee,{subtitleTracks:ue}){if(subtitleOptionsIdentical(this.levels,ue)){this.levels=ue.map(pe=>new Level(pe));return}this.tracksBuffered=[],this.levels=ue.map(pe=>{const _e=new Level(pe);return this.tracksBuffered[_e.id]=[],_e}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,PlaylistLevelType.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(ee,ue){if(this.currentTrackId=ue.id,!this.levels.length||this.currentTrackId===-1){this.clearInterval();return}const pe=this.levels[this.currentTrackId];pe!=null&&pe.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,pe&&this.setInterval(TICK_INTERVAL)}onSubtitleTrackLoaded(ee,ue){var pe;const{details:_e,id:Ne}=ue,{currentTrackId:Ue,levels:Ge}=this;if(!Ge.length)return;const qe=Ge[Ue];if(Ne>=Ge.length||Ne!==Ue||!qe)return;this.mediaBuffer=this.mediaBufferTimeRanges;let Ke=0;if(_e.live||(pe=qe.details)!=null&&pe.live){const Ye=this.mainDetails;if(_e.deltaUpdateFailed||!Ye)return;const Ze=Ye.fragments[0];qe.details?(Ke=this.alignPlaylists(_e,qe.details),Ke===0&&Ze&&(Ke=Ze.start,addSliding(_e,Ke))):_e.hasProgramDateTime&&Ye.hasProgramDateTime?(alignMediaPlaylistByPDT(_e,Ye),Ke=_e.fragments[0].start):Ze&&(Ke=Ze.start,addSliding(_e,Ke))}qe.details=_e,this.levelLastLoaded=Ne,!this.startFragRequested&&(this.mainDetails||!_e.live)&&this.setStartPosition(qe.details,Ke),this.tick(),_e.live&&!this.fragCurrent&&this.media&&this.state===State.IDLE&&(findFragmentByPTS(null,_e.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),qe.details=void 0))}_handleFragmentLoadComplete(ee){const{frag:ue,payload:pe}=ee,_e=ue.decryptdata,Ne=this.hls;if(!this.fragContextChanged(ue)&&pe&&pe.byteLength>0&&_e&&_e.key&&_e.iv&&_e.method==="AES-128"){const Ue=performance.now();this.decrypter.decrypt(new Uint8Array(pe),_e.key.buffer,_e.iv.buffer).catch(Ge=>{throw Ne.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!1,error:Ge,reason:Ge.message,frag:ue}),Ge}).then(Ge=>{const qe=performance.now();Ne.trigger(Events.FRAG_DECRYPTED,{frag:ue,payload:Ge,stats:{tstart:Ue,tdecrypt:qe}})}).catch(Ge=>{this.warn(`${Ge.name}: ${Ge.message}`),this.state=State.IDLE})}}doTick(){if(!this.media){this.state=State.IDLE;return}if(this.state===State.IDLE){const{currentTrackId:ee,levels:ue}=this,pe=ue[ee];if(!ue.length||!pe||!pe.details)return;const{config:_e}=this,Ne=this.getLoadPosition(),Ue=BufferHelper.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],Ne,_e.maxBufferHole),{end:Ge,len:qe}=Ue,Ke=this.getFwdBufferInfo(this.media,PlaylistLevelType.MAIN),Ye=pe.details,Ze=this.getMaxBufferLength(Ke==null?void 0:Ke.len)+Ye.levelTargetDuration;if(qe>Ze)return;const Xe=Ye.fragments,Je=Xe.length,tt=Ye.edge;let rt=null;const et=this.fragPrevious;if(Ge<tt){const it=_e.maxFragLookUpTolerance,nt=Ge>tt-it?0:it;rt=findFragmentByPTS(et,Xe,Math.max(Xe[0].start,Ge),nt),!rt&&et&&et.start<Xe[0].start&&(rt=Xe[0])}else rt=Xe[Je-1];if(!rt)return;if(rt=this.mapToInitFragWhenRequired(rt),rt.sn!=="initSegment"){const it=rt.sn-Ye.startSN,nt=Xe[it-1];nt&&nt.cc===rt.cc&&this.fragmentTracker.getState(nt)===FragmentState.NOT_LOADED&&(rt=nt)}this.fragmentTracker.getState(rt)===FragmentState.NOT_LOADED&&this.loadFragment(rt,pe,Ge)}}getMaxBufferLength(ee){const ue=super.getMaxBufferLength();return ee?Math.max(ue,ee):ue}loadFragment(ee,ue,pe){this.fragCurrent=ee,ee.sn==="initSegment"?this._loadInitSegment(ee,ue):(this.startFragRequested=!0,super.loadFragment(ee,ue,pe))}get mediaBufferTimeRanges(){return new BufferableInstance(this.tracksBuffered[this.currentTrackId]||[])}}class BufferableInstance{constructor(ee){this.buffered=void 0;const ue=(pe,_e,Ne)=>{if(_e=_e>>>0,_e>Ne-1)throw new DOMException(`Failed to execute '${pe}' on 'TimeRanges': The index provided (${_e}) is greater than the maximum bound (${Ne})`);return ee[_e][pe]};this.buffered={get length(){return ee.length},end(pe){return ue("end",pe,ee.length)},start(pe){return ue("start",pe,ee.length)}}}}class SubtitleTrackController extends BasePlaylistController{constructor(ee){super(ee,"[subtitle-track-controller]"),this.media=null,this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.trackChangeListener=()=>this.onTextTracksChanged(),this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(ee){this._subtitleDisplay=ee,this.trackId>-1&&this.toggleTrackModes(this.trackId)}registerListeners(){const{hls:ee}=this;ee.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),ee.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),ee.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),ee.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),ee.on(Events.LEVEL_LOADING,this.onLevelLoading,this),ee.on(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),ee.on(Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),ee.on(Events.ERROR,this.onError,this)}unregisterListeners(){const{hls:ee}=this;ee.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),ee.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),ee.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),ee.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),ee.off(Events.LEVEL_LOADING,this.onLevelLoading,this),ee.off(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),ee.off(Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),ee.off(Events.ERROR,this.onError,this)}onMediaAttached(ee,ue){this.media=ue.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(ee){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,ee)}onMediaDetaching(){if(!this.media)return;self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),filterSubtitleTracks(this.media.textTracks).forEach(ue=>{clearCurrentCues(ue)}),this.subtitleTrack=-1,this.media=null}onManifestLoading(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(ee,ue){this.tracks=ue.subtitleTracks}onSubtitleTrackLoaded(ee,ue){const{id:pe,details:_e}=ue,{trackId:Ne}=this,Ue=this.tracksInGroup[Ne];if(!Ue){this.warn(`Invalid subtitle track id ${pe}`);return}const Ge=Ue.details;Ue.details=ue.details,this.log(`subtitle track ${pe} loaded [${_e.startSN}-${_e.endSN}]`),pe===this.trackId&&this.playlistLoaded(pe,ue,Ge)}onLevelLoading(ee,ue){this.switchLevel(ue.level)}onLevelSwitching(ee,ue){this.switchLevel(ue.level)}switchLevel(ee){const ue=this.hls.levels[ee];if(!(ue!=null&&ue.textGroupIds))return;const pe=ue.textGroupIds[ue.urlId],_e=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;if(this.groupId!==pe){const Ne=this.tracks.filter(qe=>!pe||qe.groupId===pe);this.tracksInGroup=Ne;const Ue=this.findTrackId(_e==null?void 0:_e.name)||this.findTrackId();this.groupId=pe||null;const Ge={subtitleTracks:Ne};this.log(`Updating subtitle tracks, ${Ne.length} track(s) found in "${pe}" group-id`),this.hls.trigger(Events.SUBTITLE_TRACKS_UPDATED,Ge),Ue!==-1&&this.setSubtitleTrack(Ue,_e)}else this.shouldReloadPlaylist(_e)&&this.setSubtitleTrack(this.trackId,_e)}findTrackId(ee){const ue=this.tracksInGroup;for(let pe=0;pe<ue.length;pe++){const _e=ue[pe];if((!this.selectDefaultTrack||_e.default)&&(!ee||ee===_e.name))return _e.id}return-1}onError(ee,ue){ue.fatal||!ue.context||ue.context.type===PlaylistContextType.SUBTITLE_TRACK&&ue.context.id===this.trackId&&ue.context.groupId===this.groupId&&this.checkRetry(ue)}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(ee){this.selectDefaultTrack=!1;const ue=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(ee,ue)}loadPlaylist(ee){super.loadPlaylist();const ue=this.tracksInGroup[this.trackId];if(this.shouldLoadPlaylist(ue)){const pe=ue.id,_e=ue.groupId;let Ne=ue.url;if(ee)try{Ne=ee.addDirectives(Ne)}catch(Ue){this.warn(`Could not construct new URL with HLS Delivery Directives: ${Ue}`)}this.log(`Loading subtitle playlist for id ${pe}`),this.hls.trigger(Events.SUBTITLE_TRACK_LOADING,{url:Ne,id:pe,groupId:_e,deliveryDirectives:ee||null})}}toggleTrackModes(ee){const{media:ue,trackId:pe}=this;if(!ue)return;const _e=filterSubtitleTracks(ue.textTracks),Ne=_e.filter(Ge=>Ge.groupId===this.groupId);if(ee===-1)[].slice.call(_e).forEach(Ge=>{Ge.mode="disabled"});else{const Ge=Ne[pe];Ge&&(Ge.mode="disabled")}const Ue=Ne[ee];Ue&&(Ue.mode=this.subtitleDisplay?"showing":"hidden")}setSubtitleTrack(ee,ue){var pe;const _e=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=ee;return}if(this.trackId!==ee&&this.toggleTrackModes(ee),this.trackId===ee&&(ee===-1||(pe=_e[ee])!=null&&pe.details)||ee<-1||ee>=_e.length)return;this.clearTimer();const Ne=_e[ee];if(this.log(`Switching to subtitle-track ${ee}`+(Ne?` "${Ne.name}" lang:${Ne.lang} group:${Ne.groupId}`:"")),this.trackId=ee,Ne){const{id:Ue,groupId:Ge="",name:qe,type:Ke,url:Ye}=Ne;this.hls.trigger(Events.SUBTITLE_TRACK_SWITCH,{id:Ue,groupId:Ge,name:qe,type:Ke,url:Ye});const Ze=this.switchParams(Ne.url,ue==null?void 0:ue.details);this.loadPlaylist(Ze)}else this.hls.trigger(Events.SUBTITLE_TRACK_SWITCH,{id:ee})}onTextTracksChanged(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let ee=-1;const ue=filterSubtitleTracks(this.media.textTracks);for(let pe=0;pe<ue.length;pe++)if(ue[pe].mode==="hidden")ee=pe;else if(ue[pe].mode==="showing"){ee=pe;break}this.subtitleTrack!==ee&&(this.subtitleTrack=ee)}}function filterSubtitleTracks(fe){const ee=[];for(let ue=0;ue<fe.length;ue++){const pe=fe[ue];(pe.kind==="subtitles"||pe.kind==="captions")&&pe.label&&ee.push(fe[ue])}return ee}class BufferOperationQueue{constructor(ee){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=ee}append(ee,ue){const pe=this.queues[ue];pe.push(ee),pe.length===1&&this.buffers[ue]&&this.executeNext(ue)}insertAbort(ee,ue){this.queues[ue].unshift(ee),this.executeNext(ue)}appendBlocker(ee){let ue;const pe=new Promise(Ne=>{ue=Ne}),_e={execute:ue,onStart:()=>{},onComplete:()=>{},onError:()=>{}};return this.append(_e,ee),pe}executeNext(ee){const{buffers:ue,queues:pe}=this,_e=ue[ee],Ne=pe[ee];if(Ne.length){const Ue=Ne[0];try{Ue.execute()}catch(Ge){logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),Ue.onError(Ge),_e!=null&&_e.updating||(Ne.shift(),this.executeNext(ee))}}}shiftAndExecuteNext(ee){this.queues[ee].shift(),this.executeNext(ee)}current(ee){return this.queues[ee][0]}}const MediaSource=getMediaSource(),VIDEO_CODEC_PROFILE_REPACE=/([ha]vc.)(?:\.[^.,]+)+/;class BufferController{constructor(ee){this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=()=>{const{media:ue,mediaSource:pe}=this;logger.log("[buffer-controller]: Media source opened"),ue&&(ue.removeEventListener("emptied",this._onMediaEmptied),this.updateMediaElementDuration(),this.hls.trigger(Events.MEDIA_ATTACHED,{media:ue})),pe&&pe.removeEventListener("sourceopen",this._onMediaSourceOpen),this.checkPendingTracks()},this._onMediaSourceClose=()=>{logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=()=>{logger.log("[buffer-controller]: Media source ended")},this._onMediaEmptied=()=>{const{media:ue,_objectUrl:pe}=this;ue&&ue.src!==pe&&logger.error(`Media element src was set while attaching MediaSource (${pe} > ${ue.src})`)},this.hls=ee,this._initSourceBuffer(),this.registerListeners()}hasSourceTypes(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null}registerListeners(){const{hls:ee}=this;ee.on(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),ee.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),ee.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),ee.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),ee.on(Events.BUFFER_RESET,this.onBufferReset,this),ee.on(Events.BUFFER_APPENDING,this.onBufferAppending,this),ee.on(Events.BUFFER_CODECS,this.onBufferCodecs,this),ee.on(Events.BUFFER_EOS,this.onBufferEos,this),ee.on(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),ee.on(Events.LEVEL_UPDATED,this.onLevelUpdated,this),ee.on(Events.FRAG_PARSED,this.onFragParsed,this),ee.on(Events.FRAG_CHANGED,this.onFragChanged,this)}unregisterListeners(){const{hls:ee}=this;ee.off(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),ee.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),ee.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),ee.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),ee.off(Events.BUFFER_RESET,this.onBufferReset,this),ee.off(Events.BUFFER_APPENDING,this.onBufferAppending,this),ee.off(Events.BUFFER_CODECS,this.onBufferCodecs,this),ee.off(Events.BUFFER_EOS,this.onBufferEos,this),ee.off(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),ee.off(Events.LEVEL_UPDATED,this.onLevelUpdated,this),ee.off(Events.FRAG_PARSED,this.onFragParsed,this),ee.off(Events.FRAG_CHANGED,this.onFragChanged,this)}_initSourceBuffer(){this.sourceBuffer={},this.operationQueue=new BufferOperationQueue(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.lastMpegAudioChunk=null}onManifestLoading(){this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=0,this.details=null}onManifestParsed(ee,ue){let pe=2;(ue.audio&&!ue.video||!ue.altAudio)&&(pe=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=pe,logger.log(`${this.bufferCodecEventsExpected} bufferCodec event(s) expected`)}onMediaAttaching(ee,ue){const pe=this.media=ue.media;if(pe&&MediaSource){const _e=this.mediaSource=new MediaSource;_e.addEventListener("sourceopen",this._onMediaSourceOpen),_e.addEventListener("sourceended",this._onMediaSourceEnded),_e.addEventListener("sourceclose",this._onMediaSourceClose),pe.src=self.URL.createObjectURL(_e),this._objectUrl=pe.src,pe.addEventListener("emptied",this._onMediaEmptied)}}onMediaDetaching(){const{media:ee,mediaSource:ue,_objectUrl:pe}=this;if(ue){if(logger.log("[buffer-controller]: media source detaching"),ue.readyState==="open")try{ue.endOfStream()}catch(_e){logger.warn(`[buffer-controller]: onMediaDetaching: ${_e.message} while calling endOfStream`)}this.onBufferReset(),ue.removeEventListener("sourceopen",this._onMediaSourceOpen),ue.removeEventListener("sourceended",this._onMediaSourceEnded),ue.removeEventListener("sourceclose",this._onMediaSourceClose),ee&&(ee.removeEventListener("emptied",this._onMediaEmptied),pe&&self.URL.revokeObjectURL(pe),ee.src===pe?(ee.removeAttribute("src"),ee.load()):logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(Events.MEDIA_DETACHED,void 0)}onBufferReset(){this.getSourceBufferTypes().forEach(ee=>{const ue=this.sourceBuffer[ee];try{ue&&(this.removeBufferListeners(ee),this.mediaSource&&this.mediaSource.removeSourceBuffer(ue),this.sourceBuffer[ee]=void 0)}catch(pe){logger.warn(`[buffer-controller]: Failed to reset the ${ee} buffer`,pe)}}),this._initSourceBuffer()}onBufferCodecs(ee,ue){const pe=this.getSourceBufferTypes().length;Object.keys(ue).forEach(_e=>{if(pe){const Ne=this.tracks[_e];if(Ne&&typeof Ne.buffer.changeType=="function"){const{id:Ue,codec:Ge,levelCodec:qe,container:Ke,metadata:Ye}=ue[_e],Ze=(Ne.levelCodec||Ne.codec).replace(VIDEO_CODEC_PROFILE_REPACE,"$1"),Xe=(qe||Ge).replace(VIDEO_CODEC_PROFILE_REPACE,"$1");if(Ze!==Xe){const Je=`${Ke};codecs=${qe||Ge}`;this.appendChangeType(_e,Je),logger.log(`[buffer-controller]: switching codec ${Ze} to ${Xe}`),this.tracks[_e]={buffer:Ne.buffer,codec:Ge,container:Ke,levelCodec:qe,metadata:Ye,id:Ue}}}}else this.pendingTracks[_e]=ue[_e]}),!pe&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())}appendChangeType(ee,ue){const{operationQueue:pe}=this,_e={execute:()=>{const Ne=this.sourceBuffer[ee];Ne&&(logger.log(`[buffer-controller]: changing ${ee} sourceBuffer type to ${ue}`),Ne.changeType(ue)),pe.shiftAndExecuteNext(ee)},onStart:()=>{},onComplete:()=>{},onError:Ne=>{logger.warn(`[buffer-controller]: Failed to change ${ee} SourceBuffer type`,Ne)}};pe.append(_e,ee)}onBufferAppending(ee,ue){const{hls:pe,operationQueue:_e,tracks:Ne}=this,{data:Ue,type:Ge,frag:qe,part:Ke,chunkMeta:Ye}=ue,Ze=Ye.buffering[Ge],Xe=self.performance.now();Ze.start=Xe;const Je=qe.stats.buffering,tt=Ke?Ke.stats.buffering:null;Je.start===0&&(Je.start=Xe),tt&&tt.start===0&&(tt.start=Xe);const rt=Ne.audio;let et=!1;Ge==="audio"&&(rt==null?void 0:rt.container)==="audio/mpeg"&&(et=!this.lastMpegAudioChunk||Ye.id===1||this.lastMpegAudioChunk.sn!==Ye.sn,this.lastMpegAudioChunk=Ye);const it=qe.start,nt={execute:()=>{if(Ze.executeStart=self.performance.now(),et){const st=this.sourceBuffer[Ge];if(st){const lt=it-st.timestampOffset;Math.abs(lt)>=.1&&(logger.log(`[buffer-controller]: Updating audio SourceBuffer timestampOffset to ${it} (delta: ${lt}) sn: ${qe.sn})`),st.timestampOffset=it)}}this.appendExecutor(Ue,Ge)},onStart:()=>{},onComplete:()=>{const st=self.performance.now();Ze.executeEnd=Ze.end=st,Je.first===0&&(Je.first=st),tt&&tt.first===0&&(tt.first=st);const{sourceBuffer:lt}=this,_r={};for(const jr in lt)_r[jr]=BufferHelper.getBuffered(lt[jr]);this.appendError=0,this.hls.trigger(Events.BUFFER_APPENDED,{type:Ge,frag:qe,part:Ke,chunkMeta:Ye,parent:qe.type,timeRanges:_r})},onError:st=>{logger.error(`[buffer-controller]: Error encountered while trying to append to the ${Ge} SourceBuffer`,st);const lt={type:ErrorTypes.MEDIA_ERROR,parent:qe.type,details:ErrorDetails.BUFFER_APPEND_ERROR,frag:qe,part:Ke,chunkMeta:Ye,error:st,err:st,fatal:!1};st.code===DOMException.QUOTA_EXCEEDED_ERR?lt.details=ErrorDetails.BUFFER_FULL_ERROR:(this.appendError++,lt.details=ErrorDetails.BUFFER_APPEND_ERROR,this.appendError>pe.config.appendErrorMaxRetry&&(logger.error(`[buffer-controller]: Failed ${pe.config.appendErrorMaxRetry} times to append segment in sourceBuffer`),lt.fatal=!0)),pe.trigger(Events.ERROR,lt)}};_e.append(nt,Ge)}onBufferFlushing(ee,ue){const{operationQueue:pe}=this,_e=Ne=>({execute:this.removeExecutor.bind(this,Ne,ue.startOffset,ue.endOffset),onStart:()=>{},onComplete:()=>{this.hls.trigger(Events.BUFFER_FLUSHED,{type:Ne})},onError:Ue=>{logger.warn(`[buffer-controller]: Failed to remove from ${Ne} SourceBuffer`,Ue)}});ue.type?pe.append(_e(ue.type),ue.type):this.getSourceBufferTypes().forEach(Ne=>{pe.append(_e(Ne),Ne)})}onFragParsed(ee,ue){const{frag:pe,part:_e}=ue,Ne=[],Ue=_e?_e.elementaryStreams:pe.elementaryStreams;Ue[ElementaryStreamTypes.AUDIOVIDEO]?Ne.push("audiovideo"):(Ue[ElementaryStreamTypes.AUDIO]&&Ne.push("audio"),Ue[ElementaryStreamTypes.VIDEO]&&Ne.push("video"));const Ge=()=>{const qe=self.performance.now();pe.stats.buffering.end=qe,_e&&(_e.stats.buffering.end=qe);const Ke=_e?_e.stats:pe.stats;this.hls.trigger(Events.FRAG_BUFFERED,{frag:pe,part:_e,stats:Ke,id:pe.type})};Ne.length===0&&logger.warn(`Fragments must have at least one ElementaryStreamType set. type: ${pe.type} level: ${pe.level} sn: ${pe.sn}`),this.blockBuffers(Ge,Ne)}onFragChanged(ee,ue){this.flushBackBuffer()}onBufferEos(ee,ue){this.getSourceBufferTypes().reduce((_e,Ne)=>{const Ue=this.sourceBuffer[Ne];return Ue&&(!ue.type||ue.type===Ne)&&(Ue.ending=!0,Ue.ended||(Ue.ended=!0,logger.log(`[buffer-controller]: ${Ne} sourceBuffer now EOS`))),_e&&!!(!Ue||Ue.ended)},!0)&&(logger.log("[buffer-controller]: Queueing mediaSource.endOfStream()"),this.blockBuffers(()=>{this.getSourceBufferTypes().forEach(Ne=>{const Ue=this.sourceBuffer[Ne];Ue&&(Ue.ending=!1)});const{mediaSource:_e}=this;if(!_e||_e.readyState!=="open"){_e&&logger.info(`[buffer-controller]: Could not call mediaSource.endOfStream(). mediaSource.readyState: ${_e.readyState}`);return}logger.log("[buffer-controller]: Calling mediaSource.endOfStream()"),_e.endOfStream()}))}onLevelUpdated(ee,{details:ue}){ue.fragments.length&&(this.details=ue,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())}flushBackBuffer(){const{hls:ee,details:ue,media:pe,sourceBuffer:_e}=this;if(!pe||ue===null)return;const Ne=this.getSourceBufferTypes();if(!Ne.length)return;const Ue=ue.live&&ee.config.liveBackBufferLength!==null?ee.config.liveBackBufferLength:ee.config.backBufferLength;if(!isFiniteNumber(Ue)||Ue<0)return;const Ge=pe.currentTime,qe=ue.levelTargetDuration,Ke=Math.max(Ue,qe),Ye=Math.floor(Ge/qe)*qe-Ke;Ne.forEach(Ze=>{const Xe=_e[Ze];if(Xe){const Je=BufferHelper.getBuffered(Xe);if(Je.length>0&&Ye>Je.start(0)){if(ee.trigger(Events.BACK_BUFFER_REACHED,{bufferEnd:Ye}),ue.live)ee.trigger(Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:Ye});else if(Xe.ended&&Je.end(Je.length-1)-Ge<qe*2){logger.info(`[buffer-controller]: Cannot flush ${Ze} back buffer while SourceBuffer is in ended state`);return}ee.trigger(Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Ye,type:Ze})}}})}updateMediaElementDuration(){if(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")return;const{details:ee,hls:ue,media:pe,mediaSource:_e}=this,Ne=ee.fragments[0].start+ee.totalduration,Ue=pe.duration,Ge=isFiniteNumber(_e.duration)?_e.duration:0;ee.live&&ue.config.liveDurationInfinity?(logger.log("[buffer-controller]: Media Source duration is set to Infinity"),_e.duration=1/0,this.updateSeekableRange(ee)):(Ne>Ge&&Ne>Ue||!isFiniteNumber(Ue))&&(logger.log(`[buffer-controller]: Updating Media Source duration to ${Ne.toFixed(3)}`),_e.duration=Ne)}updateSeekableRange(ee){const ue=this.mediaSource,pe=ee.fragments;if(pe.length&&ee.live&&ue!=null&&ue.setLiveSeekableRange){const Ne=Math.max(0,pe[0].start),Ue=Math.max(Ne,Ne+ee.totalduration);ue.setLiveSeekableRange(Ne,Ue)}}checkPendingTracks(){const{bufferCodecEventsExpected:ee,operationQueue:ue,pendingTracks:pe}=this,_e=Object.keys(pe).length;if(_e&&!ee||_e===2){this.createSourceBuffers(pe),this.pendingTracks={};const Ne=this.getSourceBufferTypes();if(Ne.length)this.hls.trigger(Events.BUFFER_CREATED,{tracks:this.tracks}),Ne.forEach(Ue=>{ue.executeNext(Ue)});else{const Ue=new Error("could not create source buffer for media codec(s)");this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:Ue,reason:Ue.message})}}}createSourceBuffers(ee){const{sourceBuffer:ue,mediaSource:pe}=this;if(!pe)throw Error("createSourceBuffers called when mediaSource was null");for(const _e in ee)if(!ue[_e]){const Ne=ee[_e];if(!Ne)throw Error(`source buffer exists for track ${_e}, however track does not`);const Ue=Ne.levelCodec||Ne.codec,Ge=`${Ne.container};codecs=${Ue}`;logger.log(`[buffer-controller]: creating sourceBuffer(${Ge})`);try{const qe=ue[_e]=pe.addSourceBuffer(Ge),Ke=_e;this.addBufferListener(Ke,"updatestart",this._onSBUpdateStart),this.addBufferListener(Ke,"updateend",this._onSBUpdateEnd),this.addBufferListener(Ke,"error",this._onSBUpdateError),this.tracks[_e]={buffer:qe,codec:Ue,container:Ne.container,levelCodec:Ne.levelCodec,metadata:Ne.metadata,id:Ne.id}}catch(qe){logger.error(`[buffer-controller]: error while trying to add sourceBuffer: ${qe.message}`),this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:qe,mimeType:Ge})}}}_onSBUpdateStart(ee){const{operationQueue:ue}=this;ue.current(ee).onStart()}_onSBUpdateEnd(ee){const{operationQueue:ue}=this;ue.current(ee).onComplete(),ue.shiftAndExecuteNext(ee)}_onSBUpdateError(ee,ue){const pe=new Error(`${ee} SourceBuffer error`);logger.error(`[buffer-controller]: ${pe}`,ue),this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_APPENDING_ERROR,error:pe,fatal:!1});const _e=this.operationQueue.current(ee);_e&&_e.onError(ue)}removeExecutor(ee,ue,pe){const{media:_e,mediaSource:Ne,operationQueue:Ue,sourceBuffer:Ge}=this,qe=Ge[ee];if(!_e||!Ne||!qe){logger.warn(`[buffer-controller]: Attempting to remove from the ${ee} SourceBuffer, but it does not exist`),Ue.shiftAndExecuteNext(ee);return}const Ke=isFiniteNumber(_e.duration)?_e.duration:1/0,Ye=isFiniteNumber(Ne.duration)?Ne.duration:1/0,Ze=Math.max(0,ue),Xe=Math.min(pe,Ke,Ye);Xe>Ze&&!qe.ending?(qe.ended=!1,logger.log(`[buffer-controller]: Removing [${Ze},${Xe}] from the ${ee} SourceBuffer`),qe.remove(Ze,Xe)):Ue.shiftAndExecuteNext(ee)}appendExecutor(ee,ue){const{operationQueue:pe,sourceBuffer:_e}=this,Ne=_e[ue];if(!Ne){logger.warn(`[buffer-controller]: Attempting to append to the ${ue} SourceBuffer, but it does not exist`),pe.shiftAndExecuteNext(ue);return}Ne.ended=!1,Ne.appendBuffer(ee)}blockBuffers(ee,ue=this.getSourceBufferTypes()){if(!ue.length){logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(ee);return}const{operationQueue:pe}=this,_e=ue.map(Ne=>pe.appendBlocker(Ne));Promise.all(_e).then(()=>{ee(),ue.forEach(Ne=>{const Ue=this.sourceBuffer[Ne];Ue!=null&&Ue.updating||pe.shiftAndExecuteNext(Ne)})})}getSourceBufferTypes(){return Object.keys(this.sourceBuffer)}addBufferListener(ee,ue,pe){const _e=this.sourceBuffer[ee];if(!_e)return;const Ne=pe.bind(this,ee);this.listeners[ee].push({event:ue,listener:Ne}),_e.addEventListener(ue,Ne)}removeBufferListeners(ee){const ue=this.sourceBuffer[ee];ue&&this.listeners[ee].forEach(pe=>{ue.removeEventListener(pe.event,pe.listener)})}}const specialCea608CharsCodes={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},getCharForByte=function(ee){let ue=ee;return specialCea608CharsCodes.hasOwnProperty(ee)&&(ue=specialCea608CharsCodes[ee]),String.fromCharCode(ue)},NR_ROWS=15,NR_COLS=100,rowsLowCh1={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},rowsHighCh1={17:2,18:4,21:6,22:8,23:10,19:13,20:15},rowsLowCh2={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},rowsHighCh2={25:2,26:4,29:6,30:8,31:10,27:13,28:15},backgroundColors=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class CaptionsLogger{constructor(){this.time=null,this.verboseLevel=0}log(ee,ue){if(this.verboseLevel>=ee){const pe=typeof ue=="function"?ue():ue;logger.log(`${this.time} [${ee}] ${pe}`)}}}const numArrayToHexArray=function(ee){const ue=[];for(let pe=0;pe<ee.length;pe++)ue.push(ee[pe].toString(16));return ue};class PenState{constructor(ee,ue,pe,_e,Ne){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=ee||"white",this.underline=ue||!1,this.italics=pe||!1,this.background=_e||"black",this.flash=Ne||!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(ee){const ue=["foreground","underline","italics","background","flash"];for(let pe=0;pe<ue.length;pe++){const _e=ue[pe];ee.hasOwnProperty(_e)&&(this[_e]=ee[_e])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(ee){return this.foreground===ee.foreground&&this.underline===ee.underline&&this.italics===ee.italics&&this.background===ee.background&&this.flash===ee.flash}copy(ee){this.foreground=ee.foreground,this.underline=ee.underline,this.italics=ee.italics,this.background=ee.background,this.flash=ee.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class StyledUnicodeChar{constructor(ee,ue,pe,_e,Ne,Ue){this.uchar=void 0,this.penState=void 0,this.uchar=ee||" ",this.penState=new PenState(ue,pe,_e,Ne,Ue)}reset(){this.uchar=" ",this.penState.reset()}setChar(ee,ue){this.uchar=ee,this.penState.copy(ue)}setPenState(ee){this.penState.copy(ee)}equals(ee){return this.uchar===ee.uchar&&this.penState.equals(ee.penState)}copy(ee){this.uchar=ee.uchar,this.penState.copy(ee.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class Row{constructor(ee){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(let ue=0;ue<NR_COLS;ue++)this.chars.push(new StyledUnicodeChar);this.logger=ee,this.pos=0,this.currPenState=new PenState}equals(ee){let ue=!0;for(let pe=0;pe<NR_COLS;pe++)if(!this.chars[pe].equals(ee.chars[pe])){ue=!1;break}return ue}copy(ee){for(let ue=0;ue<NR_COLS;ue++)this.chars[ue].copy(ee.chars[ue])}isEmpty(){let ee=!0;for(let ue=0;ue<NR_COLS;ue++)if(!this.chars[ue].isEmpty()){ee=!1;break}return ee}setCursor(ee){this.pos!==ee&&(this.pos=ee),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>NR_COLS&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=NR_COLS)}moveCursor(ee){const ue=this.pos+ee;if(ee>1)for(let pe=this.pos+1;pe<ue+1;pe++)this.chars[pe].setPenState(this.currPenState);this.setCursor(ue)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(ee){ee>=144&&this.backSpace();const ue=getCharForByte(ee);if(this.pos>=NR_COLS){this.logger.log(0,()=>"Cannot insert "+ee.toString(16)+" ("+ue+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(ue,this.currPenState),this.moveCursor(1)}clearFromPos(ee){let ue;for(ue=ee;ue<NR_COLS;ue++)this.chars[ue].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const ee=[];let ue=!0;for(let pe=0;pe<NR_COLS;pe++){const _e=this.chars[pe].uchar;_e!==" "&&(ue=!1),ee.push(_e)}return ue?"":ee.join("")}setPenStyles(ee){this.currPenState.setStyles(ee),this.chars[this.pos].setPenState(this.currPenState)}}class CaptionScreen{constructor(ee){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(let ue=0;ue<NR_ROWS;ue++)this.rows.push(new Row(ee));this.logger=ee,this.currRow=NR_ROWS-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}reset(){for(let ee=0;ee<NR_ROWS;ee++)this.rows[ee].clear();this.currRow=NR_ROWS-1}equals(ee){let ue=!0;for(let pe=0;pe<NR_ROWS;pe++)if(!this.rows[pe].equals(ee.rows[pe])){ue=!1;break}return ue}copy(ee){for(let ue=0;ue<NR_ROWS;ue++)this.rows[ue].copy(ee.rows[ue])}isEmpty(){let ee=!0;for(let ue=0;ue<NR_ROWS;ue++)if(!this.rows[ue].isEmpty()){ee=!1;break}return ee}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(ee){this.rows[this.currRow].insertChar(ee)}setPen(ee){this.rows[this.currRow].setPenStyles(ee)}moveCursor(ee){this.rows[this.currRow].moveCursor(ee)}setCursor(ee){this.logger.log(2,"setCursor: "+ee),this.rows[this.currRow].setCursor(ee)}setPAC(ee){this.logger.log(2,()=>"pacData = "+JSON.stringify(ee));let ue=ee.row-1;if(this.nrRollUpRows&&ue<this.nrRollUpRows-1&&(ue=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==ue){for(let Ge=0;Ge<NR_ROWS;Ge++)this.rows[Ge].clear();const Ne=this.currRow+1-this.nrRollUpRows,Ue=this.lastOutputScreen;if(Ue){const Ge=Ue.rows[Ne].cueStartTime,qe=this.logger.time;if(Ge&&qe!==null&&Ge<qe)for(let Ke=0;Ke<this.nrRollUpRows;Ke++)this.rows[ue-this.nrRollUpRows+Ke+1].copy(Ue.rows[Ne+Ke])}}this.currRow=ue;const pe=this.rows[this.currRow];if(ee.indent!==null){const Ne=ee.indent,Ue=Math.max(Ne-1,0);pe.setCursor(ee.indent),ee.color=pe.chars[Ue].penState.foreground}const _e={foreground:ee.color,underline:ee.underline,italics:ee.italics,background:"black",flash:!1};this.setPen(_e)}setBkgData(ee){this.logger.log(2,()=>"bkgData = "+JSON.stringify(ee)),this.backSpace(),this.setPen(ee),this.insertChar(32)}setRollUpRows(ee){this.nrRollUpRows=ee}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const ee=this.currRow+1-this.nrRollUpRows,ue=this.rows.splice(ee,1)[0];ue.clear(),this.rows.splice(this.currRow,0,ue),this.logger.log(2,"Rolling up")}getDisplayText(ee){ee=ee||!1;const ue=[];let pe="",_e=-1;for(let Ne=0;Ne<NR_ROWS;Ne++){const Ue=this.rows[Ne].getTextString();Ue&&(_e=Ne+1,ee?ue.push("Row "+_e+": '"+Ue+"'"):ue.push(Ue.trim()))}return ue.length>0&&(ee?pe="["+ue.join(" | ")+"]":pe=ue.join(`
`)),pe}getTextAndFormat(){return this.rows}}class Cea608Channel{constructor(ee,ue,pe){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=ee,this.outputFilter=ue,this.mode=null,this.verbose=0,this.displayedMemory=new CaptionScreen(pe),this.nonDisplayedMemory=new CaptionScreen(pe),this.lastOutputScreen=new CaptionScreen(pe),this.currRollUpRow=this.displayedMemory.rows[NR_ROWS-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=pe}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[NR_ROWS-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(ee){this.outputFilter=ee}setPAC(ee){this.writeScreen.setPAC(ee)}setBkgData(ee){this.writeScreen.setBkgData(ee)}setMode(ee){ee!==this.mode&&(this.mode=ee,this.logger.log(2,()=>"MODE="+ee),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=ee)}insertChars(ee){for(let pe=0;pe<ee.length;pe++)this.writeScreen.insertChar(ee[pe]);const ue=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>ue+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(ee){this.logger.log(2,"RU("+ee+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(ee)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const ee=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=ee,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(ee){this.logger.log(2,"TO("+ee+") - Tab Offset"),this.writeScreen.moveCursor(ee)}ccMIDROW(ee){const ue={flash:!1};if(ue.underline=ee%2===1,ue.italics=ee>=46,ue.italics)ue.foreground="white";else{const pe=Math.floor(ee/2)-16,_e=["white","green","blue","cyan","red","yellow","magenta"];ue.foreground=_e[pe]}this.logger.log(2,"MIDROW: "+JSON.stringify(ue)),this.writeScreen.setPen(ue)}outputDataUpdate(ee=!1){const ue=this.logger.time;ue!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=ue:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,ue,this.lastOutputScreen),ee&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:ue),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(ee){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,ee,this.displayedMemory),this.cueStartTime=ee))}}class Cea608Parser{constructor(ee,ue,pe){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;const _e=new CaptionsLogger;this.channels=[null,new Cea608Channel(ee,ue,_e),new Cea608Channel(ee+1,pe,_e)],this.cmdHistory=createCmdHistory(),this.logger=_e}getHandler(ee){return this.channels[ee].getHandler()}setHandler(ee,ue){this.channels[ee].setHandler(ue)}addData(ee,ue){let pe,_e,Ne,Ue=!1;this.logger.time=ee;for(let Ge=0;Ge<ue.length;Ge+=2)if(_e=ue[Ge]&127,Ne=ue[Ge+1]&127,!(_e===0&&Ne===0)){if(this.logger.log(3,"["+numArrayToHexArray([ue[Ge],ue[Ge+1]])+"] -> ("+numArrayToHexArray([_e,Ne])+")"),pe=this.parseCmd(_e,Ne),pe||(pe=this.parseMidrow(_e,Ne)),pe||(pe=this.parsePAC(_e,Ne)),pe||(pe=this.parseBackgroundAttributes(_e,Ne)),!pe&&(Ue=this.parseChars(_e,Ne),Ue)){const qe=this.currentChannel;qe&&qe>0?this.channels[qe].insertChars(Ue):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!pe&&!Ue&&this.logger.log(2,"Couldn't parse cleaned data "+numArrayToHexArray([_e,Ne])+" orig: "+numArrayToHexArray([ue[Ge],ue[Ge+1]]))}}parseCmd(ee,ue){const{cmdHistory:pe}=this,_e=(ee===20||ee===28||ee===21||ee===29)&&ue>=32&&ue<=47,Ne=(ee===23||ee===31)&&ue>=33&&ue<=35;if(!(_e||Ne))return!1;if(hasCmdRepeated(ee,ue,pe))return setLastCmd(null,null,pe),this.logger.log(3,"Repeated command ("+numArrayToHexArray([ee,ue])+") is dropped"),!0;const Ue=ee===20||ee===21||ee===23?1:2,Ge=this.channels[Ue];return ee===20||ee===21||ee===28||ee===29?ue===32?Ge.ccRCL():ue===33?Ge.ccBS():ue===34?Ge.ccAOF():ue===35?Ge.ccAON():ue===36?Ge.ccDER():ue===37?Ge.ccRU(2):ue===38?Ge.ccRU(3):ue===39?Ge.ccRU(4):ue===40?Ge.ccFON():ue===41?Ge.ccRDC():ue===42?Ge.ccTR():ue===43?Ge.ccRTD():ue===44?Ge.ccEDM():ue===45?Ge.ccCR():ue===46?Ge.ccENM():ue===47&&Ge.ccEOC():Ge.ccTO(ue-32),setLastCmd(ee,ue,pe),this.currentChannel=Ue,!0}parseMidrow(ee,ue){let pe=0;if((ee===17||ee===25)&&ue>=32&&ue<=47){if(ee===17?pe=1:pe=2,pe!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const _e=this.channels[pe];return _e?(_e.ccMIDROW(ue),this.logger.log(3,"MIDROW ("+numArrayToHexArray([ee,ue])+")"),!0):!1}return!1}parsePAC(ee,ue){let pe;const _e=this.cmdHistory,Ne=(ee>=17&&ee<=23||ee>=25&&ee<=31)&&ue>=64&&ue<=127,Ue=(ee===16||ee===24)&&ue>=64&&ue<=95;if(!(Ne||Ue))return!1;if(hasCmdRepeated(ee,ue,_e))return setLastCmd(null,null,_e),!0;const Ge=ee<=23?1:2;ue>=64&&ue<=95?pe=Ge===1?rowsLowCh1[ee]:rowsLowCh2[ee]:pe=Ge===1?rowsHighCh1[ee]:rowsHighCh2[ee];const qe=this.channels[Ge];return qe?(qe.setPAC(this.interpretPAC(pe,ue)),setLastCmd(ee,ue,_e),this.currentChannel=Ge,!0):!1}interpretPAC(ee,ue){let pe;const _e={color:null,italics:!1,indent:null,underline:!1,row:ee};return ue>95?pe=ue-96:pe=ue-64,_e.underline=(pe&1)===1,pe<=13?_e.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(pe/2)]:pe<=15?(_e.italics=!0,_e.color="white"):_e.indent=Math.floor((pe-16)/2)*4,_e}parseChars(ee,ue){let pe,_e=null,Ne=null;if(ee>=25?(pe=2,Ne=ee-8):(pe=1,Ne=ee),Ne>=17&&Ne<=19){let Ue;Ne===17?Ue=ue+80:Ne===18?Ue=ue+112:Ue=ue+144,this.logger.log(2,"Special char '"+getCharForByte(Ue)+"' in channel "+pe),_e=[Ue]}else ee>=32&&ee<=127&&(_e=ue===0?[ee]:[ee,ue]);if(_e){const Ue=numArrayToHexArray(_e);this.logger.log(3,"Char codes =  "+Ue.join(",")),setLastCmd(ee,ue,this.cmdHistory)}return _e}parseBackgroundAttributes(ee,ue){const pe=(ee===16||ee===24)&&ue>=32&&ue<=47,_e=(ee===23||ee===31)&&ue>=45&&ue<=47;if(!(pe||_e))return!1;let Ne;const Ue={};ee===16||ee===24?(Ne=Math.floor((ue-32)/2),Ue.background=backgroundColors[Ne],ue%2===1&&(Ue.background=Ue.background+"_semi")):ue===45?Ue.background="transparent":(Ue.foreground="black",ue===47&&(Ue.underline=!0));const Ge=ee<=23?1:2;return this.channels[Ge].setBkgData(Ue),setLastCmd(ee,ue,this.cmdHistory),!0}reset(){for(let ee=0;ee<Object.keys(this.channels).length;ee++){const ue=this.channels[ee];ue&&ue.reset()}this.cmdHistory=createCmdHistory()}cueSplitAtTime(ee){for(let ue=0;ue<this.channels.length;ue++){const pe=this.channels[ue];pe&&pe.cueSplitAtTime(ee)}}}function setLastCmd(fe,ee,ue){ue.a=fe,ue.b=ee}function hasCmdRepeated(fe,ee,ue){return ue.a===fe&&ue.b===ee}function createCmdHistory(){return{a:null,b:null}}class OutputFilter{constructor(ee,ue){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=ee,this.trackName=ue}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(ee,ue,pe){(this.startTime===null||this.startTime>ee)&&(this.startTime=ee),this.endTime=ue,this.screen=pe,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}var VTTCue=function(){if(typeof self<"u"&&self.VTTCue)return self.VTTCue;const fe=["","lr","rl"],ee=["start","middle","end","left","right"];function ue(Ge,qe){if(typeof qe!="string"||!Array.isArray(Ge))return!1;const Ke=qe.toLowerCase();return~Ge.indexOf(Ke)?Ke:!1}function pe(Ge){return ue(fe,Ge)}function _e(Ge){return ue(ee,Ge)}function Ne(Ge,...qe){let Ke=1;for(;Ke<arguments.length;Ke++){const Ye=arguments[Ke];for(const Ze in Ye)Ge[Ze]=Ye[Ze]}return Ge}function Ue(Ge,qe,Ke){const Ye=this,Ze={enumerable:!0};Ye.hasBeenReset=!1;let Xe="",Je=!1,tt=Ge,rt=qe,et=Ke,it=null,nt="",st=!0,lt="auto",_r="start",jr=50,Nr="middle",Wr=50,ri="middle";Object.defineProperty(Ye,"id",Ne({},Ze,{get:function(){return Xe},set:function(Xr){Xe=""+Xr}})),Object.defineProperty(Ye,"pauseOnExit",Ne({},Ze,{get:function(){return Je},set:function(Xr){Je=!!Xr}})),Object.defineProperty(Ye,"startTime",Ne({},Ze,{get:function(){return tt},set:function(Xr){if(typeof Xr!="number")throw new TypeError("Start time must be set to a number.");tt=Xr,this.hasBeenReset=!0}})),Object.defineProperty(Ye,"endTime",Ne({},Ze,{get:function(){return rt},set:function(Xr){if(typeof Xr!="number")throw new TypeError("End time must be set to a number.");rt=Xr,this.hasBeenReset=!0}})),Object.defineProperty(Ye,"text",Ne({},Ze,{get:function(){return et},set:function(Xr){et=""+Xr,this.hasBeenReset=!0}})),Object.defineProperty(Ye,"region",Ne({},Ze,{get:function(){return it},set:function(Xr){it=Xr,this.hasBeenReset=!0}})),Object.defineProperty(Ye,"vertical",Ne({},Ze,{get:function(){return nt},set:function(Xr){const Gr=pe(Xr);if(Gr===!1)throw new SyntaxError("An invalid or illegal string was specified.");nt=Gr,this.hasBeenReset=!0}})),Object.defineProperty(Ye,"snapToLines",Ne({},Ze,{get:function(){return st},set:function(Xr){st=!!Xr,this.hasBeenReset=!0}})),Object.defineProperty(Ye,"line",Ne({},Ze,{get:function(){return lt},set:function(Xr){if(typeof Xr!="number"&&Xr!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");lt=Xr,this.hasBeenReset=!0}})),Object.defineProperty(Ye,"lineAlign",Ne({},Ze,{get:function(){return _r},set:function(Xr){const Gr=_e(Xr);if(!Gr)throw new SyntaxError("An invalid or illegal string was specified.");_r=Gr,this.hasBeenReset=!0}})),Object.defineProperty(Ye,"position",Ne({},Ze,{get:function(){return jr},set:function(Xr){if(Xr<0||Xr>100)throw new Error("Position must be between 0 and 100.");jr=Xr,this.hasBeenReset=!0}})),Object.defineProperty(Ye,"positionAlign",Ne({},Ze,{get:function(){return Nr},set:function(Xr){const Gr=_e(Xr);if(!Gr)throw new SyntaxError("An invalid or illegal string was specified.");Nr=Gr,this.hasBeenReset=!0}})),Object.defineProperty(Ye,"size",Ne({},Ze,{get:function(){return Wr},set:function(Xr){if(Xr<0||Xr>100)throw new Error("Size must be between 0 and 100.");Wr=Xr,this.hasBeenReset=!0}})),Object.defineProperty(Ye,"align",Ne({},Ze,{get:function(){return ri},set:function(Xr){const Gr=_e(Xr);if(!Gr)throw new SyntaxError("An invalid or illegal string was specified.");ri=Gr,this.hasBeenReset=!0}})),Ye.displayState=void 0}return Ue.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},Ue}();class StringDecoder{decode(ee,ue){if(!ee)return"";if(typeof ee!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(ee))}}function parseTimeStamp(fe){function ee(pe,_e,Ne,Ue){return(pe|0)*3600+(_e|0)*60+(Ne|0)+parseFloat(Ue||0)}const ue=fe.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return ue?parseFloat(ue[2])>59?ee(ue[2],ue[3],0,ue[4]):ee(ue[1],ue[2],ue[3],ue[4]):null}class Settings{constructor(){this.values=Object.create(null)}set(ee,ue){!this.get(ee)&&ue!==""&&(this.values[ee]=ue)}get(ee,ue,pe){return pe?this.has(ee)?this.values[ee]:ue[pe]:this.has(ee)?this.values[ee]:ue}has(ee){return ee in this.values}alt(ee,ue,pe){for(let _e=0;_e<pe.length;++_e)if(ue===pe[_e]){this.set(ee,ue);break}}integer(ee,ue){/^-?\d+$/.test(ue)&&this.set(ee,parseInt(ue,10))}percent(ee,ue){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(ue)){const pe=parseFloat(ue);if(pe>=0&&pe<=100)return this.set(ee,pe),!0}return!1}}function parseOptions(fe,ee,ue,pe){const _e=pe?fe.split(pe):[fe];for(const Ne in _e){if(typeof _e[Ne]!="string")continue;const Ue=_e[Ne].split(ue);if(Ue.length!==2)continue;const Ge=Ue[0],qe=Ue[1];ee(Ge,qe)}}const defaults=new VTTCue(0,0,""),center=defaults.align==="middle"?"middle":"center";function parseCue$1(fe,ee,ue){const pe=fe;function _e(){const Ge=parseTimeStamp(fe);if(Ge===null)throw new Error("Malformed timestamp: "+pe);return fe=fe.replace(/^[^\sa-zA-Z-]+/,""),Ge}function Ne(Ge,qe){const Ke=new Settings;parseOptions(Ge,function(Xe,Je){let tt;switch(Xe){case"region":for(let rt=ue.length-1;rt>=0;rt--)if(ue[rt].id===Je){Ke.set(Xe,ue[rt].region);break}break;case"vertical":Ke.alt(Xe,Je,["rl","lr"]);break;case"line":tt=Je.split(","),Ke.integer(Xe,tt[0]),Ke.percent(Xe,tt[0])&&Ke.set("snapToLines",!1),Ke.alt(Xe,tt[0],["auto"]),tt.length===2&&Ke.alt("lineAlign",tt[1],["start",center,"end"]);break;case"position":tt=Je.split(","),Ke.percent(Xe,tt[0]),tt.length===2&&Ke.alt("positionAlign",tt[1],["start",center,"end","line-left","line-right","auto"]);break;case"size":Ke.percent(Xe,Je);break;case"align":Ke.alt(Xe,Je,["start",center,"end","left","right"]);break}},/:/,/\s/),qe.region=Ke.get("region",null),qe.vertical=Ke.get("vertical","");let Ye=Ke.get("line","auto");Ye==="auto"&&defaults.line===-1&&(Ye=-1),qe.line=Ye,qe.lineAlign=Ke.get("lineAlign","start"),qe.snapToLines=Ke.get("snapToLines",!0),qe.size=Ke.get("size",100),qe.align=Ke.get("align",center);let Ze=Ke.get("position","auto");Ze==="auto"&&defaults.position===50&&(Ze=qe.align==="start"||qe.align==="left"?0:qe.align==="end"||qe.align==="right"?100:50),qe.position=Ze}function Ue(){fe=fe.replace(/^\s+/,"")}if(Ue(),ee.startTime=_e(),Ue(),fe.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+pe);fe=fe.slice(3),Ue(),ee.endTime=_e(),Ue(),Ne(fe,ee)}function fixLineBreaks(fe){return fe.replace(/<br(?: \/)?>/gi,`
`)}class VTTParser{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new StringDecoder,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(ee){const ue=this;ee&&(ue.buffer+=ue.decoder.decode(ee,{stream:!0}));function pe(){let Ne=ue.buffer,Ue=0;for(Ne=fixLineBreaks(Ne);Ue<Ne.length&&Ne[Ue]!=="\r"&&Ne[Ue]!==`
`;)++Ue;const Ge=Ne.slice(0,Ue);return Ne[Ue]==="\r"&&++Ue,Ne[Ue]===`
`&&++Ue,ue.buffer=Ne.slice(Ue),Ge}function _e(Ne){parseOptions(Ne,function(Ue,Ge){},/:/)}try{let Ne="";if(ue.state==="INITIAL"){if(!/\r\n|\n/.test(ue.buffer))return this;Ne=pe();const Ge=Ne.match(/^()?WEBVTT([ \t].*)?$/);if(!(Ge!=null&&Ge[0]))throw new Error("Malformed WebVTT signature.");ue.state="HEADER"}let Ue=!1;for(;ue.buffer;){if(!/\r\n|\n/.test(ue.buffer))return this;switch(Ue?Ue=!1:Ne=pe(),ue.state){case"HEADER":/:/.test(Ne)?_e(Ne):Ne||(ue.state="ID");continue;case"NOTE":Ne||(ue.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(Ne)){ue.state="NOTE";break}if(!Ne)continue;if(ue.cue=new VTTCue(0,0,""),ue.state="CUE",Ne.indexOf("-->")===-1){ue.cue.id=Ne;continue}case"CUE":if(!ue.cue){ue.state="BADCUE";continue}try{parseCue$1(Ne,ue.cue,ue.regionList)}catch{ue.cue=null,ue.state="BADCUE";continue}ue.state="CUETEXT";continue;case"CUETEXT":{const Ge=Ne.indexOf("-->")!==-1;if(!Ne||Ge&&(Ue=!0)){ue.oncue&&ue.cue&&ue.oncue(ue.cue),ue.cue=null,ue.state="ID";continue}if(ue.cue===null)continue;ue.cue.text&&(ue.cue.text+=`
`),ue.cue.text+=Ne}continue;case"BADCUE":Ne||(ue.state="ID")}}}catch{ue.state==="CUETEXT"&&ue.cue&&ue.oncue&&ue.oncue(ue.cue),ue.cue=null,ue.state=ue.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const ee=this;try{if((ee.cue||ee.state==="HEADER")&&(ee.buffer+=`

`,ee.parse()),ee.state==="INITIAL"||ee.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(ue){ee.onparsingerror&&ee.onparsingerror(ue)}return ee.onflush&&ee.onflush(),this}}const LINEBREAKS=/\r\n|\n\r|\n|\r/g,startsWith=function(ee,ue,pe=0){return ee.slice(pe,pe+ue.length)===ue},cueString2millis=function(ee){let ue=parseInt(ee.slice(-3));const pe=parseInt(ee.slice(-6,-4)),_e=parseInt(ee.slice(-9,-7)),Ne=ee.length>9?parseInt(ee.substring(0,ee.indexOf(":"))):0;if(!isFiniteNumber(ue)||!isFiniteNumber(pe)||!isFiniteNumber(_e)||!isFiniteNumber(Ne))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${ee}`);return ue+=1e3*pe,ue+=60*1e3*_e,ue+=60*60*1e3*Ne,ue},hash=function(ee){let ue=5381,pe=ee.length;for(;pe;)ue=ue*33^ee.charCodeAt(--pe);return(ue>>>0).toString()};function generateCueId(fe,ee,ue){return hash(fe.toString())+hash(ee.toString())+hash(ue)}const calculateOffset=function(ee,ue,pe){let _e=ee[ue],Ne=ee[_e.prevCC];if(!Ne||!Ne.new&&_e.new){ee.ccOffset=ee.presentationOffset=_e.start,_e.new=!1;return}for(;(Ue=Ne)!=null&&Ue.new;){var Ue;ee.ccOffset+=_e.start-Ne.start,_e.new=!1,_e=Ne,Ne=ee[_e.prevCC]}ee.presentationOffset=pe};function parseWebVTT(fe,ee,ue,pe,_e,Ne,Ue){const Ge=new VTTParser,qe=utf8ArrayToStr(new Uint8Array(fe)).trim().replace(LINEBREAKS,`
`).split(`
`),Ke=[],Ye=ee?toMpegTsClockFromTimescale(ee.baseTime,ee.timescale):0;let Ze="00:00.000",Xe=0,Je=0,tt,rt=!0;Ge.oncue=function(et){const it=ue[pe];let nt=ue.ccOffset;const st=(Xe-Ye)/9e4;if(it!=null&&it.new&&(Je!==void 0?nt=ue.ccOffset=it.start:calculateOffset(ue,pe,st)),st){if(!ee){tt=new Error("Missing initPTS for VTT MPEGTS");return}nt=st-ue.presentationOffset}const lt=et.endTime-et.startTime,_r=normalizePts((et.startTime+nt-Je)*9e4,_e*9e4)/9e4;et.startTime=Math.max(_r,0),et.endTime=Math.max(_r+lt,0);const jr=et.text.trim();et.text=decodeURIComponent(encodeURIComponent(jr)),et.id||(et.id=generateCueId(et.startTime,et.endTime,jr)),et.endTime>0&&Ke.push(et)},Ge.onparsingerror=function(et){tt=et},Ge.onflush=function(){if(tt){Ue(tt);return}Ne(Ke)},qe.forEach(et=>{if(rt)if(startsWith(et,"X-TIMESTAMP-MAP=")){rt=!1,et.slice(16).split(",").forEach(it=>{startsWith(it,"LOCAL:")?Ze=it.slice(6):startsWith(it,"MPEGTS:")&&(Xe=parseInt(it.slice(7)))});try{Je=cueString2millis(Ze)/1e3}catch(it){tt=it}return}else et===""&&(rt=!1);Ge.parse(et+`
`)}),Ge.flush()}const IMSC1_CODEC="stpp.ttml.im1t",HMSF_REGEX=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,TIME_UNIT_REGEX=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,textAlignToLineAlign={left:"start",center:"center",right:"end",start:"start",end:"end"};function parseIMSC1(fe,ee,ue,pe){const _e=findBox(new Uint8Array(fe),["mdat"]);if(_e.length===0){pe(new Error("Could not parse IMSC1 mdat"));return}const Ne=_e.map(Ge=>utf8ArrayToStr(Ge)),Ue=toTimescaleFromScale(ee.baseTime,1,ee.timescale);try{Ne.forEach(Ge=>ue(parseTTML(Ge,Ue)))}catch(Ge){pe(Ge)}}function parseTTML(fe,ee){const _e=new DOMParser().parseFromString(fe,"text/xml").getElementsByTagName("tt")[0];if(!_e)throw new Error("Invalid ttml");const Ne={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},Ue=Object.keys(Ne).reduce((Ze,Xe)=>(Ze[Xe]=_e.getAttribute(`ttp:${Xe}`)||Ne[Xe],Ze),{}),Ge=_e.getAttribute("xml:space")!=="preserve",qe=collectionToDictionary(getElementCollection(_e,"styling","style")),Ke=collectionToDictionary(getElementCollection(_e,"layout","region")),Ye=getElementCollection(_e,"body","[begin]");return[].map.call(Ye,Ze=>{const Xe=getTextContent(Ze,Ge);if(!Xe||!Ze.hasAttribute("begin"))return null;const Je=parseTtmlTime(Ze.getAttribute("begin"),Ue),tt=parseTtmlTime(Ze.getAttribute("dur"),Ue);let rt=parseTtmlTime(Ze.getAttribute("end"),Ue);if(Je===null)throw timestampParsingError(Ze);if(rt===null){if(tt===null)throw timestampParsingError(Ze);rt=Je+tt}const et=new VTTCue(Je-ee,rt-ee,Xe);et.id=generateCueId(et.startTime,et.endTime,et.text);const it=Ke[Ze.getAttribute("region")],nt=qe[Ze.getAttribute("style")],st=getTtmlStyles(it,nt,qe),{textAlign:lt}=st;if(lt){const _r=textAlignToLineAlign[lt];_r&&(et.lineAlign=_r),et.align=lt}return _extends(et,st),et}).filter(Ze=>Ze!==null)}function getElementCollection(fe,ee,ue){const pe=fe.getElementsByTagName(ee)[0];return pe?[].slice.call(pe.querySelectorAll(ue)):[]}function collectionToDictionary(fe){return fe.reduce((ee,ue)=>{const pe=ue.getAttribute("xml:id");return pe&&(ee[pe]=ue),ee},{})}function getTextContent(fe,ee){return[].slice.call(fe.childNodes).reduce((ue,pe,_e)=>{var Ne;return pe.nodeName==="br"&&_e?ue+`
`:(Ne=pe.childNodes)!=null&&Ne.length?getTextContent(pe,ee):ee?ue+pe.textContent.trim().replace(/\s+/g," "):ue+pe.textContent},"")}function getTtmlStyles(fe,ee,ue){const pe="http://www.w3.org/ns/ttml#styling";let _e=null;const Ne=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],Ue=fe!=null&&fe.hasAttribute("style")?fe.getAttribute("style"):null;return Ue&&ue.hasOwnProperty(Ue)&&(_e=ue[Ue]),Ne.reduce((Ge,qe)=>{const Ke=getAttributeNS(ee,pe,qe)||getAttributeNS(fe,pe,qe)||getAttributeNS(_e,pe,qe);return Ke&&(Ge[qe]=Ke),Ge},{})}function getAttributeNS(fe,ee,ue){return fe&&fe.hasAttributeNS(ee,ue)?fe.getAttributeNS(ee,ue):null}function timestampParsingError(fe){return new Error(`Could not parse ttml timestamp ${fe}`)}function parseTtmlTime(fe,ee){if(!fe)return null;let ue=parseTimeStamp(fe);return ue===null&&(HMSF_REGEX.test(fe)?ue=parseHoursMinutesSecondsFrames(fe,ee):TIME_UNIT_REGEX.test(fe)&&(ue=parseTimeUnits(fe,ee))),ue}function parseHoursMinutesSecondsFrames(fe,ee){const ue=HMSF_REGEX.exec(fe),pe=(ue[4]|0)+(ue[5]|0)/ee.subFrameRate;return(ue[1]|0)*3600+(ue[2]|0)*60+(ue[3]|0)+pe/ee.frameRate}function parseTimeUnits(fe,ee){const ue=TIME_UNIT_REGEX.exec(fe),pe=Number(ue[1]);switch(ue[2]){case"h":return pe*3600;case"m":return pe*60;case"ms":return pe*1e3;case"f":return pe/ee.frameRate;case"t":return pe/ee.tickRate}return pe}class TimelineController{constructor(ee){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=newVTTCCs(),this.captionsProperties=void 0,this.hls=ee,this.config=ee.config,this.Cues=ee.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){const ue=new OutputFilter(this,"textTrack1"),pe=new OutputFilter(this,"textTrack2"),_e=new OutputFilter(this,"textTrack3"),Ne=new OutputFilter(this,"textTrack4");this.cea608Parser1=new Cea608Parser(1,ue,pe),this.cea608Parser2=new Cea608Parser(3,_e,Ne)}ee.on(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),ee.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),ee.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),ee.on(Events.MANIFEST_LOADED,this.onManifestLoaded,this),ee.on(Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),ee.on(Events.FRAG_LOADING,this.onFragLoading,this),ee.on(Events.FRAG_LOADED,this.onFragLoaded,this),ee.on(Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),ee.on(Events.FRAG_DECRYPTED,this.onFragDecrypted,this),ee.on(Events.INIT_PTS_FOUND,this.onInitPtsFound,this),ee.on(Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),ee.on(Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:ee}=this;ee.off(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),ee.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),ee.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),ee.off(Events.MANIFEST_LOADED,this.onManifestLoaded,this),ee.off(Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),ee.off(Events.FRAG_LOADING,this.onFragLoading,this),ee.off(Events.FRAG_LOADED,this.onFragLoaded,this),ee.off(Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),ee.off(Events.FRAG_DECRYPTED,this.onFragDecrypted,this),ee.off(Events.INIT_PTS_FOUND,this.onInitPtsFound,this),ee.off(Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),ee.off(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null}addCues(ee,ue,pe,_e,Ne){let Ue=!1;for(let Ge=Ne.length;Ge--;){const qe=Ne[Ge],Ke=intersection(qe[0],qe[1],ue,pe);if(Ke>=0&&(qe[0]=Math.min(qe[0],ue),qe[1]=Math.max(qe[1],pe),Ue=!0,Ke/(pe-ue)>.5))return}if(Ue||Ne.push([ue,pe]),this.config.renderTextTracksNatively){const Ge=this.captionsTracks[ee];this.Cues.newCue(Ge,ue,pe,_e)}else{const Ge=this.Cues.newCue(null,ue,pe,_e);this.hls.trigger(Events.CUES_PARSED,{type:"captions",cues:Ge,track:ee})}}onInitPtsFound(ee,{frag:ue,id:pe,initPTS:_e,timescale:Ne}){const{unparsedVttFrags:Ue}=this;pe==="main"&&(this.initPTS[ue.cc]={baseTime:_e,timescale:Ne}),Ue.length&&(this.unparsedVttFrags=[],Ue.forEach(Ge=>{this.onFragLoaded(Events.FRAG_LOADED,Ge)}))}getExistingTrack(ee){const{media:ue}=this;if(ue)for(let pe=0;pe<ue.textTracks.length;pe++){const _e=ue.textTracks[pe];if(_e[ee])return _e}return null}createCaptionsTrack(ee){this.config.renderTextTracksNatively?this.createNativeTrack(ee):this.createNonNativeTrack(ee)}createNativeTrack(ee){if(this.captionsTracks[ee])return;const{captionsProperties:ue,captionsTracks:pe,media:_e}=this,{label:Ne,languageCode:Ue}=ue[ee],Ge=this.getExistingTrack(ee);if(Ge)pe[ee]=Ge,clearCurrentCues(pe[ee]),sendAddTrackEvent(pe[ee],_e);else{const qe=this.createTextTrack("captions",Ne,Ue);qe&&(qe[ee]=!0,pe[ee]=qe)}}createNonNativeTrack(ee){if(this.nonNativeCaptionsTracks[ee])return;const ue=this.captionsProperties[ee];if(!ue)return;const pe=ue.label,_e={_id:ee,label:pe,kind:"captions",default:ue.media?!!ue.media.default:!1,closedCaptions:ue.media};this.nonNativeCaptionsTracks[ee]=_e,this.hls.trigger(Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[_e]})}createTextTrack(ee,ue,pe){const _e=this.media;if(_e)return _e.addTextTrack(ee,ue,pe)}onMediaAttaching(ee,ue){this.media=ue.media,this._cleanTracks()}onMediaDetaching(){const{captionsTracks:ee}=this;Object.keys(ee).forEach(ue=>{clearCurrentCues(ee[ue]),delete ee[ue]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=newVTTCCs(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:ee}=this;if(!ee)return;const ue=ee.textTracks;if(ue)for(let pe=0;pe<ue.length;pe++)clearCurrentCues(ue[pe])}onSubtitleTracksUpdated(ee,ue){const pe=ue.subtitleTracks||[],_e=pe.some(Ne=>Ne.textCodec===IMSC1_CODEC);if(this.config.enableWebVTT||_e&&this.config.enableIMSC1){if(subtitleOptionsIdentical(this.tracks,pe)){this.tracks=pe;return}if(this.textTracks=[],this.tracks=pe,this.config.renderTextTracksNatively){const Ue=this.media?this.media.textTracks:null;this.tracks.forEach((Ge,qe)=>{let Ke;if(Ue&&qe<Ue.length){let Ye=null;for(let Ze=0;Ze<Ue.length;Ze++)if(canReuseVttTextTrack(Ue[Ze],Ge)){Ye=Ue[Ze];break}Ye&&(Ke=Ye)}if(Ke)clearCurrentCues(Ke);else{const Ye=this._captionsOrSubtitlesFromCharacteristics(Ge);Ke=this.createTextTrack(Ye,Ge.name,Ge.lang),Ke&&(Ke.mode="disabled")}Ke&&(Ke.groupId=Ge.groupId,this.textTracks.push(Ke))})}else if(this.tracks.length){const Ue=this.tracks.map(Ge=>({label:Ge.name,kind:Ge.type.toLowerCase(),default:Ge.default,subtitleTrack:Ge}));this.hls.trigger(Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:Ue})}}}_captionsOrSubtitlesFromCharacteristics(ee){if(ee.attrs.CHARACTERISTICS){const ue=/transcribes-spoken-dialog/gi.test(ee.attrs.CHARACTERISTICS),pe=/describes-music-and-sound/gi.test(ee.attrs.CHARACTERISTICS);if(ue&&pe)return"captions"}return"subtitles"}onManifestLoaded(ee,ue){this.config.enableCEA708Captions&&ue.captions&&ue.captions.forEach(pe=>{const _e=/(?:CC|SERVICE)([1-4])/.exec(pe.instreamId);if(!_e)return;const Ne=`textTrack${_e[1]}`,Ue=this.captionsProperties[Ne];Ue&&(Ue.label=pe.name,pe.lang&&(Ue.languageCode=pe.lang),Ue.media=pe)})}closedCaptionsForLevel(ee){const ue=this.hls.levels[ee.level];return ue==null?void 0:ue.attrs["CLOSED-CAPTIONS"]}onFragLoading(ee,ue){const{cea608Parser1:pe,cea608Parser2:_e,lastSn:Ne,lastPartIndex:Ue}=this;if(!(!this.enabled||!(pe&&_e))&&ue.frag.type===PlaylistLevelType.MAIN){var Ge,qe;const Ke=ue.frag.sn,Ye=(Ge=ue==null||(qe=ue.part)==null?void 0:qe.index)!=null?Ge:-1;Ke===Ne+1||Ke===Ne&&Ye===Ue+1||(pe.reset(),_e.reset()),this.lastSn=Ke,this.lastPartIndex=Ye}}onFragLoaded(ee,ue){const{frag:pe,payload:_e}=ue;if(pe.type===PlaylistLevelType.SUBTITLE)if(_e.byteLength){const Ne=pe.decryptdata,Ue="stats"in ue;if(Ne==null||!Ne.encrypted||Ue){const Ge=this.tracks[pe.level],qe=this.vttCCs;qe[pe.cc]||(qe[pe.cc]={start:pe.start,prevCC:this.prevCC,new:!0},this.prevCC=pe.cc),Ge&&Ge.textCodec===IMSC1_CODEC?this._parseIMSC1(pe,_e):this._parseVTTs(ue)}}else this.hls.trigger(Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:pe,error:new Error("Empty subtitle payload")})}_parseIMSC1(ee,ue){const pe=this.hls;parseIMSC1(ue,this.initPTS[ee.cc],_e=>{this._appendCues(_e,ee.level),pe.trigger(Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:ee})},_e=>{logger.log(`Failed to parse IMSC1: ${_e}`),pe.trigger(Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:ee,error:_e})})}_parseVTTs(ee){var ue;const{frag:pe,payload:_e}=ee,{initPTS:Ne,unparsedVttFrags:Ue}=this,Ge=Ne.length-1;if(!Ne[pe.cc]&&Ge===-1){Ue.push(ee);return}const qe=this.hls,Ke=(ue=pe.initSegment)!=null&&ue.data?appendUint8Array(pe.initSegment.data,new Uint8Array(_e)):_e;parseWebVTT(Ke,this.initPTS[pe.cc],this.vttCCs,pe.cc,pe.start,Ye=>{this._appendCues(Ye,pe.level),qe.trigger(Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:pe})},Ye=>{const Ze=Ye.message==="Missing initPTS for VTT MPEGTS";Ze?Ue.push(ee):this._fallbackToIMSC1(pe,_e),logger.log(`Failed to parse VTT cue: ${Ye}`),!(Ze&&Ge>pe.cc)&&qe.trigger(Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:pe,error:Ye})})}_fallbackToIMSC1(ee,ue){const pe=this.tracks[ee.level];pe.textCodec||parseIMSC1(ue,this.initPTS[ee.cc],()=>{pe.textCodec=IMSC1_CODEC,this._parseIMSC1(ee,ue)},()=>{pe.textCodec="wvtt"})}_appendCues(ee,ue){const pe=this.hls;if(this.config.renderTextTracksNatively){const _e=this.textTracks[ue];if(!_e||_e.mode==="disabled")return;ee.forEach(Ne=>addCueToTrack(_e,Ne))}else{const _e=this.tracks[ue];if(!_e)return;const Ne=_e.default?"default":"subtitles"+ue;pe.trigger(Events.CUES_PARSED,{type:"subtitles",cues:ee,track:Ne})}}onFragDecrypted(ee,ue){const{frag:pe}=ue;pe.type===PlaylistLevelType.SUBTITLE&&this.onFragLoaded(Events.FRAG_LOADED,ue)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(ee,ue){const{cea608Parser1:pe,cea608Parser2:_e}=this;if(!this.enabled||!(pe&&_e))return;const{frag:Ne,samples:Ue}=ue;if(!(Ne.type===PlaylistLevelType.MAIN&&this.closedCaptionsForLevel(Ne)==="NONE"))for(let Ge=0;Ge<Ue.length;Ge++){const qe=Ue[Ge].bytes;if(qe){const Ke=this.extractCea608Data(qe);pe.addData(Ue[Ge].pts,Ke[0]),_e.addData(Ue[Ge].pts,Ke[1])}}}onBufferFlushing(ee,{startOffset:ue,endOffset:pe,endOffsetSubtitles:_e,type:Ne}){const{media:Ue}=this;if(!(!Ue||Ue.currentTime<pe)){if(!Ne||Ne==="video"){const{captionsTracks:Ge}=this;Object.keys(Ge).forEach(qe=>removeCuesInRange(Ge[qe],ue,pe))}if(this.config.renderTextTracksNatively&&ue===0&&_e!==void 0){const{textTracks:Ge}=this;Object.keys(Ge).forEach(qe=>removeCuesInRange(Ge[qe],ue,_e))}}}extractCea608Data(ee){const ue=[[],[]],pe=ee[0]&31;let _e=2;for(let Ne=0;Ne<pe;Ne++){const Ue=ee[_e++],Ge=127&ee[_e++],qe=127&ee[_e++];if(Ge===0&&qe===0)continue;if((4&Ue)!==0){const Ye=3&Ue;(Ye===0||Ye===1)&&(ue[Ye].push(Ge),ue[Ye].push(qe))}}return ue}}function canReuseVttTextTrack(fe,ee){return!!fe&&fe.label===ee.name&&!(fe.textTrack1||fe.textTrack2)}function intersection(fe,ee,ue,pe){return Math.min(ee,pe)-Math.max(fe,ue)}function newVTTCCs(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}class CapLevelController{constructor(ee){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=ee,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(ee){this.streamController=ee}destroy(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:ee}=this;ee.on(Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),ee.on(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),ee.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),ee.on(Events.BUFFER_CODECS,this.onBufferCodecs,this),ee.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:ee}=this;ee.off(Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),ee.off(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),ee.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),ee.off(Events.BUFFER_CODECS,this.onBufferCodecs,this),ee.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(ee,ue){const pe=this.hls.levels[ue.droppedLevel];this.isLevelAllowed(pe)&&this.restrictedLevels.push({bitrate:pe.bitrate,height:pe.height,width:pe.width})}onMediaAttaching(ee,ue){this.media=ue.media instanceof HTMLVideoElement?ue.media:null,this.clientRect=null}onManifestParsed(ee,ue){const pe=this.hls;this.restrictedLevels=[],this.firstLevel=ue.firstLevel,pe.config.capLevelToPlayerSize&&ue.video&&this.startCapping()}onBufferCodecs(ee,ue){this.hls.config.capLevelToPlayerSize&&ue.video&&this.startCapping()}onMediaDetaching(){this.stopCapping()}detectPlayerSize(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){const ee=this.hls.levels;if(ee.length){const ue=this.hls;ue.autoLevelCapping=this.getMaxLevel(ee.length-1),ue.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=ue.autoLevelCapping}}}getMaxLevel(ee){const ue=this.hls.levels;if(!ue.length)return-1;const pe=ue.filter((_e,Ne)=>this.isLevelAllowed(_e)&&Ne<=ee);return this.clientRect=null,CapLevelController.getMaxLevelByMediaSize(pe,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const ee=this.media,ue={width:0,height:0};if(ee){const pe=ee.getBoundingClientRect();ue.width=pe.width,ue.height=pe.height,!ue.width&&!ue.height&&(ue.width=pe.right-pe.left||ee.width||0,ue.height=pe.bottom-pe.top||ee.height||0)}return this.clientRect=ue,ue}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let ee=1;if(!this.hls.config.ignoreDevicePixelRatio)try{ee=self.devicePixelRatio}catch{}return ee}isLevelAllowed(ee){return!this.restrictedLevels.some(pe=>ee.bitrate===pe.bitrate&&ee.width===pe.width&&ee.height===pe.height)}static getMaxLevelByMediaSize(ee,ue,pe){if(!(ee!=null&&ee.length))return-1;const _e=(Ue,Ge)=>Ge?Ue.width!==Ge.width||Ue.height!==Ge.height:!0;let Ne=ee.length-1;for(let Ue=0;Ue<ee.length;Ue+=1){const Ge=ee[Ue];if((Ge.width>=ue||Ge.height>=pe)&&_e(Ge,ee[Ue+1])){Ne=Ue;break}}return Ne}}class FPSController{constructor(ee){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=ee,this.registerListeners()}setStreamController(ee){this.streamController=ee}registerListeners(){this.hls.on(Events.MEDIA_ATTACHING,this.onMediaAttaching,this)}unregisterListeners(){this.hls.off(Events.MEDIA_ATTACHING,this.onMediaAttaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(ee,ue){const pe=this.hls.config;if(pe.capLevelOnFPSDrop){const _e=ue.media instanceof self.HTMLVideoElement?ue.media:null;this.media=_e,_e&&typeof _e.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),pe.fpsDroppedMonitoringPeriod)}}checkFPS(ee,ue,pe){const _e=performance.now();if(ue){if(this.lastTime){const Ne=_e-this.lastTime,Ue=pe-this.lastDroppedFrames,Ge=ue-this.lastDecodedFrames,qe=1e3*Ue/Ne,Ke=this.hls;if(Ke.trigger(Events.FPS_DROP,{currentDropped:Ue,currentDecoded:Ge,totalDroppedFrames:pe}),qe>0&&Ue>Ke.config.fpsDroppedMonitoringThreshold*Ge){let Ye=Ke.currentLevel;logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+Ye),Ye>0&&(Ke.autoLevelCapping===-1||Ke.autoLevelCapping>=Ye)&&(Ye=Ye-1,Ke.trigger(Events.FPS_DROP_LEVEL_CAPPING,{level:Ye,droppedLevel:Ke.currentLevel}),Ke.autoLevelCapping=Ye,this.streamController.nextLevelSwitch())}}this.lastTime=_e,this.lastDroppedFrames=pe,this.lastDecodedFrames=ue}}checkFPSInterval(){const ee=this.media;if(ee)if(this.isVideoPlaybackQualityAvailable){const ue=ee.getVideoPlaybackQuality();this.checkFPS(ee,ue.totalVideoFrames,ue.droppedVideoFrames)}else this.checkFPS(ee,ee.webkitDecodedFrameCount,ee.webkitDroppedFrameCount)}}const LOGGER_PREFIX="[eme]";class EMEController{constructor(ee){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=EMEController.CDMCleanupPromise?[EMEController.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=logger.debug.bind(logger,LOGGER_PREFIX),this.log=logger.log.bind(logger,LOGGER_PREFIX),this.warn=logger.warn.bind(logger,LOGGER_PREFIX),this.error=logger.error.bind(logger,LOGGER_PREFIX),this.hls=ee,this.config=ee.config,this.registerListeners()}destroy(){this.unregisterListeners(),this.onMediaDetached();const ee=this.config;ee.requestMediaKeySystemAccessFunc=null,ee.licenseXhrSetup=ee.licenseResponseCallback=void 0,ee.drmSystems=ee.drmSystemOptions={},this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null,this.config=null}registerListeners(){this.hls.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(Events.MANIFEST_LOADED,this.onManifestLoaded,this)}unregisterListeners(){this.hls.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(Events.MANIFEST_LOADED,this.onManifestLoaded,this)}getLicenseServerUrl(ee){const{drmSystems:ue,widevineLicenseUrl:pe}=this.config,_e=ue[ee];if(_e)return _e.licenseUrl;if(ee===KeySystems.WIDEVINE&&pe)return pe;throw new Error(`no license server URL configured for key-system "${ee}"`)}getServerCertificateUrl(ee){const{drmSystems:ue}=this.config,pe=ue[ee];if(pe)return pe.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${ee}"]`)}attemptKeySystemAccess(ee){const ue=this.hls.levels,pe=(Ue,Ge,qe)=>!!Ue&&qe.indexOf(Ue)===Ge,_e=ue.map(Ue=>Ue.audioCodec).filter(pe),Ne=ue.map(Ue=>Ue.videoCodec).filter(pe);return _e.length+Ne.length===0&&Ne.push("avc1.42e01e"),new Promise((Ue,Ge)=>{const qe=Ke=>{const Ye=Ke.shift();this.getMediaKeysPromise(Ye,_e,Ne).then(Ze=>Ue({keySystem:Ye,mediaKeys:Ze})).catch(Ze=>{Ke.length?qe(Ke):Ze instanceof EMEKeyError?Ge(Ze):Ge(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_NO_ACCESS,error:Ze,fatal:!0},Ze.message))})};qe(ee)})}requestMediaKeySystemAccess(ee,ue){const{requestMediaKeySystemAccessFunc:pe}=this.config;if(typeof pe!="function"){let _e=`Configured requestMediaKeySystemAccess is not a function ${pe}`;return requestMediaKeySystemAccess===null&&self.location.protocol==="http:"&&(_e=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(_e))}return pe(ee,ue)}getMediaKeysPromise(ee,ue,pe){const _e=getSupportedMediaKeySystemConfigurations(ee,ue,pe,this.config.drmSystemOptions),Ne=this.keySystemAccessPromises[ee];let Ue=Ne==null?void 0:Ne.keySystemAccess;if(!Ue){this.log(`Requesting encrypted media "${ee}" key-system access with config: ${JSON.stringify(_e)}`),Ue=this.requestMediaKeySystemAccess(ee,_e);const Ge=this.keySystemAccessPromises[ee]={keySystemAccess:Ue};return Ue.catch(qe=>{this.log(`Failed to obtain access to key-system "${ee}": ${qe}`)}),Ue.then(qe=>{this.log(`Access for key-system "${qe.keySystem}" obtained`);const Ke=this.fetchServerCertificate(ee);return this.log(`Create media-keys for "${ee}"`),Ge.mediaKeys=qe.createMediaKeys().then(Ye=>(this.log(`Media-keys created for "${ee}"`),Ke.then(Ze=>Ze?this.setMediaKeysServerCertificate(Ye,ee,Ze):Ye))),Ge.mediaKeys.catch(Ye=>{this.error(`Failed to create media-keys for "${ee}"}: ${Ye}`)}),Ge.mediaKeys})}return Ue.then(()=>Ne.mediaKeys)}createMediaKeySessionContext({decryptdata:ee,keySystem:ue,mediaKeys:pe}){this.log(`Creating key-system session "${ue}" keyId: ${Hex.hexDump(ee.keyId||[])}`);const _e=pe.createSession(),Ne={decryptdata:ee,keySystem:ue,mediaKeys:pe,mediaKeysSession:_e,keyStatus:"status-pending"};return this.mediaKeySessions.push(Ne),Ne}renewKeySession(ee){const ue=ee.decryptdata;if(ue.pssh){const pe=this.createMediaKeySessionContext(ee),_e=this.getKeyIdString(ue),Ne="cenc";this.keyIdToKeySessionPromise[_e]=this.generateRequestWithPreferredKeySession(pe,Ne,ue.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(ee)}getKeyIdString(ee){if(!ee)throw new Error("Could not read keyId of undefined decryptdata");if(ee.keyId===null)throw new Error("keyId is null");return Hex.hexDump(ee.keyId)}updateKeySession(ee,ue){var pe;const _e=ee.mediaKeysSession;return this.log(`Updating key-session "${_e.sessionId}" for keyID ${Hex.hexDump(((pe=ee.decryptdata)==null?void 0:pe.keyId)||[])}
      } (data length: ${ue&&ue.byteLength})`),_e.update(ue)}selectKeySystemFormat(ee){const ue=Object.keys(ee.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${ee.sn} ${ee.type}: ${ee.level}) key formats ${ue.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(ue)),this.keyFormatPromise}getKeyFormatPromise(ee){return new Promise((ue,pe)=>{const _e=getKeySystemsForConfig(this.config),Ne=ee.map(keySystemFormatToKeySystemDomain).filter(Ue=>!!Ue&&_e.indexOf(Ue)!==-1);return this.getKeySystemSelectionPromise(Ne).then(({keySystem:Ue})=>{const Ge=keySystemDomainToKeySystemFormat(Ue);Ge?ue(Ge):pe(new Error(`Unable to find format for key-system "${Ue}"`))}).catch(pe)})}loadKey(ee){const ue=ee.keyInfo.decryptdata,pe=this.getKeyIdString(ue),_e=`(keyId: ${pe} format: "${ue.keyFormat}" method: ${ue.method} uri: ${ue.uri})`;this.log(`Starting session for key ${_e}`);let Ne=this.keyIdToKeySessionPromise[pe];return Ne||(Ne=this.keyIdToKeySessionPromise[pe]=this.getKeySystemForKeyPromise(ue).then(({keySystem:Ue,mediaKeys:Ge})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${ee.frag.sn} ${ee.frag.type}: ${ee.frag.level} using key ${_e}`),this.attemptSetMediaKeys(Ue,Ge).then(()=>{this.throwIfDestroyed();const qe=this.createMediaKeySessionContext({keySystem:Ue,mediaKeys:Ge,decryptdata:ue}),Ke="cenc";return this.generateRequestWithPreferredKeySession(qe,Ke,ue.pssh,"playlist-key")}))),Ne.catch(Ue=>this.handleError(Ue))),Ne}throwIfDestroyed(ee="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(ee){this.hls&&(this.error(ee.message),ee instanceof EMEKeyError?this.hls.trigger(Events.ERROR,ee.data):this.hls.trigger(Events.ERROR,{type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_NO_KEYS,error:ee,fatal:!0}))}getKeySystemForKeyPromise(ee){const ue=this.getKeyIdString(ee),pe=this.keyIdToKeySessionPromise[ue];if(!pe){const _e=keySystemFormatToKeySystemDomain(ee.keyFormat),Ne=_e?[_e]:getKeySystemsForConfig(this.config);return this.attemptKeySystemAccess(Ne)}return pe}getKeySystemSelectionPromise(ee){if(ee.length||(ee=getKeySystemsForConfig(this.config)),ee.length===0)throw new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${JSON.stringify({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(ee)}_onMediaEncrypted(ee){const{initDataType:ue,initData:pe}=ee;if(this.debug(`"${ee.type}" event: init data type: "${ue}"`),pe===null)return;let _e,Ne;if(ue==="sinf"&&this.config.drmSystems[KeySystems.FAIRPLAY]){const Ye=bin2str(new Uint8Array(pe));try{const Ze=base64Decode(JSON.parse(Ye).sinf),Xe=parseSinf(new Uint8Array(Ze));if(!Xe)return;_e=Xe.subarray(8,24),Ne=KeySystems.FAIRPLAY}catch{this.warn('Failed to parse sinf "encrypted" event message initData');return}}else{const Ye=parsePssh(pe);if(Ye===null)return;Ye.version===0&&Ye.systemId===KeySystemIds.WIDEVINE&&Ye.data&&(_e=Ye.data.subarray(8,24)),Ne=keySystemIdToKeySystemDomain(Ye.systemId)}if(!Ne||!_e)return;const Ue=Hex.hexDump(_e),{keyIdToKeySessionPromise:Ge,mediaKeySessions:qe}=this;let Ke=Ge[Ue];for(let Ye=0;Ye<qe.length;Ye++){const Ze=qe[Ye],Xe=Ze.decryptdata;if(Xe.pssh||!Xe.keyId)continue;const Je=Hex.hexDump(Xe.keyId);if(Ue===Je||Xe.uri.replace(/-/g,"").indexOf(Ue)!==-1){Ke=Ge[Je],delete Ge[Je],Xe.pssh=new Uint8Array(pe),Xe.keyId=_e,Ke=Ge[Ue]=Ke.then(()=>this.generateRequestWithPreferredKeySession(Ze,ue,pe,"encrypted-event-key-match"));break}}Ke||(Ke=Ge[Ue]=this.getKeySystemSelectionPromise([Ne]).then(({keySystem:Ye,mediaKeys:Ze})=>{var Xe;this.throwIfDestroyed();const Je=new LevelKey("ISO-23001-7",Ue,(Xe=keySystemDomainToKeySystemFormat(Ye))!=null?Xe:"");return Je.pssh=new Uint8Array(pe),Je.keyId=_e,this.attemptSetMediaKeys(Ye,Ze).then(()=>{this.throwIfDestroyed();const tt=this.createMediaKeySessionContext({decryptdata:Je,keySystem:Ye,mediaKeys:Ze});return this.generateRequestWithPreferredKeySession(tt,ue,pe,"encrypted-event-no-match")})})),Ke.catch(Ye=>this.handleError(Ye))}_onWaitingForKey(ee){this.log(`"${ee.type}" event`)}attemptSetMediaKeys(ee,ue){const pe=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${ee}"`);const _e=Promise.all(pe).then(()=>{if(!this.media)throw new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(ue)});return this.setMediaKeysQueue.push(_e),_e.then(()=>{this.log(`Media-keys set for "${ee}"`),pe.push(_e),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(Ne=>pe.indexOf(Ne)===-1)})}generateRequestWithPreferredKeySession(ee,ue,pe,_e){var Ne,Ue;const Ge=(Ne=this.config.drmSystems)==null||(Ue=Ne[ee.keySystem])==null?void 0:Ue.generateRequest;if(Ge)try{const Xe=Ge.call(this.hls,ue,pe,ee);if(!Xe)throw new Error("Invalid response from configured generateRequest filter");ue=Xe.initDataType,pe=ee.decryptdata.pssh=Xe.initData?new Uint8Array(Xe.initData):null}catch(Xe){var qe;if(this.warn(Xe.message),(qe=this.hls)!=null&&qe.config.debug)throw Xe}if(pe===null)return this.log(`Skipping key-session request for "${_e}" (no initData)`),Promise.resolve(ee);const Ke=this.getKeyIdString(ee.decryptdata);this.log(`Generating key-session request for "${_e}": ${Ke} (init data type: ${ue} length: ${pe?pe.byteLength:null})`);const Ye=new EventEmitter;ee.mediaKeysSession.onmessage=Xe=>{const Je=ee.mediaKeysSession;if(!Je){Ye.emit("error",new Error("invalid state"));return}const{messageType:tt,message:rt}=Xe;this.log(`"${tt}" message event for session "${Je.sessionId}" message size: ${rt.byteLength}`),tt==="license-request"||tt==="license-renewal"?this.renewLicense(ee,rt).catch(et=>{this.handleError(et),Ye.emit("error",et)}):tt==="license-release"?ee.keySystem===KeySystems.FAIRPLAY&&(this.updateKeySession(ee,strToUtf8array("acknowledged")),this.removeSession(ee)):this.warn(`unhandled media key message type "${tt}"`)},ee.mediaKeysSession.onkeystatuseschange=Xe=>{if(!ee.mediaKeysSession){Ye.emit("error",new Error("invalid state"));return}this.onKeyStatusChange(ee);const tt=ee.keyStatus;Ye.emit("keyStatus",tt),tt==="expired"&&(this.warn(`${ee.keySystem} expired for key ${Ke}`),this.renewKeySession(ee))};const Ze=new Promise((Xe,Je)=>{Ye.on("error",Je),Ye.on("keyStatus",tt=>{tt.startsWith("usable")?Xe():tt==="output-restricted"?Je(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):tt==="internal-error"?Je(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${tt}"`)):tt==="expired"?Je(new Error("key expired while generating request")):this.warn(`unhandled key status change "${tt}"`)})});return ee.mediaKeysSession.generateRequest(ue,pe).then(()=>{var Xe;this.log(`Request generated for key-session "${(Xe=ee.mediaKeysSession)==null?void 0:Xe.sessionId}" keyId: ${Ke}`)}).catch(Xe=>{throw new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_NO_SESSION,error:Xe,fatal:!1},`Error generating key-session request: ${Xe}`)}).then(()=>Ze).catch(Xe=>{throw Ye.removeAllListeners(),this.removeSession(ee),Xe}).then(()=>(Ye.removeAllListeners(),ee))}onKeyStatusChange(ee){ee.mediaKeysSession.keyStatuses.forEach((ue,pe)=>{this.log(`key status change "${ue}" for keyStatuses keyId: ${Hex.hexDump("buffer"in pe?new Uint8Array(pe.buffer,pe.byteOffset,pe.byteLength):new Uint8Array(pe))} session keyId: ${Hex.hexDump(new Uint8Array(ee.decryptdata.keyId||[]))} uri: ${ee.decryptdata.uri}`),ee.keyStatus=ue})}fetchServerCertificate(ee){const ue=this.config,pe=ue.loader,_e=new pe(ue),Ne=this.getServerCertificateUrl(ee);return Ne?(this.log(`Fetching serverCertificate for "${ee}"`),new Promise((Ue,Ge)=>{const qe={responseType:"arraybuffer",url:Ne},Ke=ue.certLoadPolicy.default,Ye={loadPolicy:Ke,timeout:Ke.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},Ze={onSuccess:(Xe,Je,tt,rt)=>{Ue(Xe.data)},onError:(Xe,Je,tt,rt)=>{Ge(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:tt,response:_objectSpread2({url:qe.url,data:void 0},Xe)},`"${ee}" certificate request failed (${Ne}). Status: ${Xe.code} (${Xe.text})`))},onTimeout:(Xe,Je,tt)=>{Ge(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:tt,response:{url:qe.url,data:void 0}},`"${ee}" certificate request timed out (${Ne})`))},onAbort:(Xe,Je,tt)=>{Ge(new Error("aborted"))}};_e.load(qe,Ye,Ze)})):Promise.resolve()}setMediaKeysServerCertificate(ee,ue,pe){return new Promise((_e,Ne)=>{ee.setServerCertificate(pe).then(Ue=>{this.log(`setServerCertificate ${Ue?"success":"not supported by CDM"} (${pe==null?void 0:pe.byteLength}) on "${ue}"`),_e(ee)}).catch(Ue=>{Ne(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:Ue,fatal:!0},Ue.message))})})}renewLicense(ee,ue){return this.requestLicense(ee,new Uint8Array(ue)).then(pe=>this.updateKeySession(ee,new Uint8Array(pe)).catch(_e=>{throw new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:_e,fatal:!0},_e.message)}))}setupLicenseXHR(ee,ue,pe,_e){const Ne=this.config.licenseXhrSetup;return Ne?Promise.resolve().then(()=>{if(!pe.decryptdata)throw new Error("Key removed");return Ne.call(this.hls,ee,ue,pe,_e)}).catch(Ue=>{if(!pe.decryptdata)throw Ue;return ee.open("POST",ue,!0),Ne.call(this.hls,ee,ue,pe,_e)}).then(Ue=>(ee.readyState||ee.open("POST",ue,!0),{xhr:ee,licenseChallenge:Ue||_e})):(ee.open("POST",ue,!0),Promise.resolve({xhr:ee,licenseChallenge:_e}))}requestLicense(ee,ue){const pe=this.config.keyLoadPolicy.default;return new Promise((_e,Ne)=>{const Ue=this.getLicenseServerUrl(ee.keySystem);this.log(`Sending license request to URL: ${Ue}`);const Ge=new XMLHttpRequest;Ge.responseType="arraybuffer",Ge.onreadystatechange=()=>{if(!this.hls||!ee.mediaKeysSession)return Ne(new Error("invalid state"));if(Ge.readyState===4)if(Ge.status===200){this._requestLicenseFailureCount=0;let qe=Ge.response;this.log(`License received ${qe instanceof ArrayBuffer?qe.byteLength:qe}`);const Ke=this.config.licenseResponseCallback;if(Ke)try{qe=Ke.call(this.hls,Ge,Ue,ee)}catch(Ye){this.error(Ye)}_e(qe)}else{const qe=pe.errorRetry,Ke=qe?qe.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>Ke||Ge.status>=400&&Ge.status<500)Ne(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:Ge,response:{url:Ue,data:void 0,code:Ge.status,text:Ge.statusText}},`License Request XHR failed (${Ue}). Status: ${Ge.status} (${Ge.statusText})`));else{const Ye=Ke-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${Ye} attempts left`),this.requestLicense(ee,ue).then(_e,Ne)}}},ee.licenseXhr&&ee.licenseXhr.readyState!==XMLHttpRequest.DONE&&ee.licenseXhr.abort(),ee.licenseXhr=Ge,this.setupLicenseXHR(Ge,Ue,ee,ue).then(({xhr:qe,licenseChallenge:Ke})=>{qe.send(Ke)})})}onMediaAttached(ee,ue){if(!this.config.emeEnabled)return;const pe=ue.media;this.media=pe,pe.addEventListener("encrypted",this.onMediaEncrypted),pe.addEventListener("waitingforkey",this.onWaitingForKey)}onMediaDetached(){const ee=this.media,ue=this.mediaKeySessions;ee&&(ee.removeEventListener("encrypted",this.onMediaEncrypted),ee.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},LevelKey.clearKeyUriToKeyIdMap();const pe=ue.length;EMEController.CDMCleanupPromise=Promise.all(ue.map(_e=>this.removeSession(_e)).concat(ee==null?void 0:ee.setMediaKeys(null).catch(_e=>{this.log(`Could not clear media keys: ${_e}. media.src: ${ee==null?void 0:ee.src}`)}))).then(()=>{pe&&(this.log("finished closing key sessions and clearing media keys"),ue.length=0)}).catch(_e=>{this.log(`Could not close sessions and clear media keys: ${_e}. media.src: ${ee==null?void 0:ee.src}`)})}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(ee,{sessionKeys:ue}){if(!(!ue||!this.config.emeEnabled)&&!this.keyFormatPromise){const pe=ue.reduce((_e,Ne)=>(_e.indexOf(Ne.keyFormat)===-1&&_e.push(Ne.keyFormat),_e),[]);this.log(`Selecting key-system from session-keys ${pe.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(pe)}}removeSession(ee){const{mediaKeysSession:ue,licenseXhr:pe}=ee;if(ue){this.log(`Remove licenses and keys and close session ${ue.sessionId}`),ue.onmessage=null,ue.onkeystatuseschange=null,pe&&pe.readyState!==XMLHttpRequest.DONE&&pe.abort(),ee.mediaKeysSession=ee.decryptdata=ee.licenseXhr=void 0;const _e=this.mediaKeySessions.indexOf(ee);return _e>-1&&this.mediaKeySessions.splice(_e,1),ue.remove().catch(Ne=>{this.log(`Could not remove session: ${Ne}`)}).then(()=>ue.close()).catch(Ne=>{this.log(`Could not close session: ${Ne}`)})}}}EMEController.CDMCleanupPromise=void 0;class EMEKeyError extends Error{constructor(ee,ue){super(ue),this.data=void 0,ee.error||(ee.error=new Error(ue)),this.data=ee,ee.err=ee.error}}const CMCDVersion=1;var CMCDObjectType={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"};const CMCDStreamingFormatHLS="h";class CMCDController{constructor(ee){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=_e=>{try{this.apply(_e,{ot:CMCDObjectType.MANIFEST,su:!this.initialized})}catch(Ne){logger.warn("Could not generate manifest CMCD data.",Ne)}},this.applyFragmentData=_e=>{try{const Ne=_e.frag,Ue=this.hls.levels[Ne.level],Ge=this.getObjectType(Ne),qe={d:Ne.duration*1e3,ot:Ge};(Ge===CMCDObjectType.VIDEO||Ge===CMCDObjectType.AUDIO||Ge==CMCDObjectType.MUXED)&&(qe.br=Ue.bitrate/1e3,qe.tb=this.getTopBandwidth(Ge)/1e3,qe.bl=this.getBufferLength(Ge)),this.apply(_e,qe)}catch(Ne){logger.warn("Could not generate segment CMCD data.",Ne)}},this.hls=ee;const ue=this.config=ee.config,{cmcd:pe}=ue;pe!=null&&(ue.pLoader=this.createPlaylistLoader(),ue.fLoader=this.createFragmentLoader(),this.sid=pe.sessionId||CMCDController.uuid(),this.cid=pe.contentId,this.useHeaders=pe.useHeaders===!0,this.registerListeners())}registerListeners(){const ee=this.hls;ee.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),ee.on(Events.MEDIA_DETACHED,this.onMediaDetached,this),ee.on(Events.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const ee=this.hls;ee.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),ee.off(Events.MEDIA_DETACHED,this.onMediaDetached,this),ee.off(Events.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null}onMediaAttached(ee,ue){this.media=ue.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(ee,ue){var pe,_e;this.audioBuffer=(pe=ue.tracks.audio)==null?void 0:pe.buffer,this.videoBuffer=(_e=ue.tracks.video)==null?void 0:_e.buffer}createData(){var ee;return{v:CMCDVersion,sf:CMCDStreamingFormatHLS,sid:this.sid,cid:this.cid,pr:(ee=this.media)==null?void 0:ee.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(ee,ue={}){_extends(ue,this.createData());const pe=ue.ot===CMCDObjectType.INIT||ue.ot===CMCDObjectType.VIDEO||ue.ot===CMCDObjectType.MUXED;if(this.starved&&pe&&(ue.bs=!0,ue.su=!0,this.starved=!1),ue.su==null&&(ue.su=this.buffering),this.useHeaders){const _e=CMCDController.toHeaders(ue);if(!Object.keys(_e).length)return;ee.headers||(ee.headers={}),_extends(ee.headers,_e)}else{const _e=CMCDController.toQuery(ue);if(!_e)return;ee.url=CMCDController.appendQueryToUri(ee.url,_e)}}getObjectType(ee){const{type:ue}=ee;if(ue==="subtitle")return CMCDObjectType.TIMED_TEXT;if(ee.sn==="initSegment")return CMCDObjectType.INIT;if(ue==="audio")return CMCDObjectType.AUDIO;if(ue==="main")return this.hls.audioTracks.length?CMCDObjectType.VIDEO:CMCDObjectType.MUXED}getTopBandwidth(ee){let ue=0,pe;const _e=this.hls;if(ee===CMCDObjectType.AUDIO)pe=_e.audioTracks;else{const Ne=_e.maxAutoLevel,Ue=Ne>-1?Ne+1:_e.levels.length;pe=_e.levels.slice(0,Ue)}for(const Ne of pe)Ne.bitrate>ue&&(ue=Ne.bitrate);return ue>0?ue:NaN}getBufferLength(ee){const ue=this.hls.media,pe=ee===CMCDObjectType.AUDIO?this.audioBuffer:this.videoBuffer;return!pe||!ue?NaN:BufferHelper.bufferInfo(pe,ue.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:ee}=this.config,ue=this.applyPlaylistData,pe=ee||this.config.loader;return class{constructor(Ne){this.loader=void 0,this.loader=new pe(Ne)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(Ne,Ue,Ge){ue(Ne),this.loader.load(Ne,Ue,Ge)}}}createFragmentLoader(){const{fLoader:ee}=this.config,ue=this.applyFragmentData,pe=ee||this.config.loader;return class{constructor(Ne){this.loader=void 0,this.loader=new pe(Ne)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(Ne,Ue,Ge){ue(Ne),this.loader.load(Ne,Ue,Ge)}}}static uuid(){const ee=URL.createObjectURL(new Blob),ue=ee.toString();return URL.revokeObjectURL(ee),ue.slice(ue.lastIndexOf("/")+1)}static serialize(ee){const ue=[],pe=Ke=>!Number.isNaN(Ke)&&Ke!=null&&Ke!==""&&Ke!==!1,_e=Ke=>Math.round(Ke),Ne=Ke=>_e(Ke/100)*100,Ge={br:_e,d:_e,bl:Ne,dl:Ne,mtp:Ne,nor:Ke=>encodeURIComponent(Ke),rtp:Ne,tb:_e},qe=Object.keys(ee||{}).sort();for(const Ke of qe){let Ye=ee[Ke];if(!pe(Ye)||Ke==="v"&&Ye===1||Ke=="pr"&&Ye===1)continue;const Ze=Ge[Ke];Ze&&(Ye=Ze(Ye));const Xe=typeof Ye;let Je;Ke==="ot"||Ke==="sf"||Ke==="st"?Je=`${Ke}=${Ye}`:Xe==="boolean"?Je=Ke:Xe==="number"?Je=`${Ke}=${Ye}`:Je=`${Ke}=${JSON.stringify(Ye)}`,ue.push(Je)}return ue.join(",")}static toHeaders(ee){const ue=Object.keys(ee),pe={},_e=["Object","Request","Session","Status"],Ne=[{},{},{},{}],Ue={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3};for(const Ge of ue){const qe=Ue[Ge]!=null?Ue[Ge]:1;Ne[qe][Ge]=ee[Ge]}for(let Ge=0;Ge<Ne.length;Ge++){const qe=CMCDController.serialize(Ne[Ge]);qe&&(pe[`CMCD-${_e[Ge]}`]=qe)}return pe}static toQuery(ee){return`CMCD=${encodeURIComponent(CMCDController.serialize(ee))}`}static appendQueryToUri(ee,ue){if(!ue)return ee;const pe=ee.includes("?")?"&":"?";return`${ee}${pe}${ue}`}}const PATHWAY_PENALTY_DURATION_MS=3e5;class ContentSteeringController{constructor(ee){this.hls=void 0,this.log=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this.pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=ee,this.log=logger.log.bind(logger,"[content-steering]:"),this.registerListeners()}registerListeners(){const ee=this.hls;ee.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),ee.on(Events.MANIFEST_LOADED,this.onManifestLoaded,this),ee.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),ee.on(Events.ERROR,this.onError,this)}unregisterListeners(){const ee=this.hls;ee&&(ee.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),ee.off(Events.MANIFEST_LOADED,this.onManifestLoaded,this),ee.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),ee.off(Events.ERROR,this.onError,this))}startLoad(){if(this.started=!0,self.clearTimeout(this.reloadTimer),this.enabled&&this.uri)if(this.updated){const ee=Math.max(this.timeToLoad*1e3-(performance.now()-this.updated),0);this.scheduleRefresh(this.uri,ee)}else this.loadSteeringManifest(this.uri)}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),self.clearTimeout(this.reloadTimer)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(ee){const ue=this.levels;ue&&(this.levels=ue.filter(pe=>pe!==ee))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(ee,ue){const{contentSteering:pe}=ue;pe!==null&&(this.pathwayId=pe.pathwayId,this.uri=pe.uri,this.started&&this.startLoad())}onManifestParsed(ee,ue){this.audioTracks=ue.audioTracks,this.subtitleTracks=ue.subtitleTracks}onError(ee,ue){const{errorAction:pe}=ue;if((pe==null?void 0:pe.action)===NetworkErrorAction.SendAlternateToPenaltyBox&&pe.flags===ErrorActionFlags.MoveAllAlternatesMatchingHost){let _e=this.pathwayPriority;const Ne=this.pathwayId;this.penalizedPathways[Ne]||(this.penalizedPathways[Ne]=performance.now()),!_e&&this.levels&&(_e=this.levels.reduce((Ue,Ge)=>(Ue.indexOf(Ge.pathwayId)===-1&&Ue.push(Ge.pathwayId),Ue),[])),_e&&_e.length>1&&(this.updatePathwayPriority(_e),pe.resolved=this.pathwayId!==Ne)}}filterParsedLevels(ee){this.levels=ee;let ue=this.getLevelsForPathway(this.pathwayId);if(ue.length===0){const pe=ee[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${pe}"`),ue=this.getLevelsForPathway(pe),this.pathwayId=pe}return ue.length!==ee.length?(this.log(`Found ${ue.length}/${ee.length} levels in Pathway "${this.pathwayId}"`),ue):ee}getLevelsForPathway(ee){return this.levels===null?[]:this.levels.filter(ue=>ee===ue.pathwayId)}updatePathwayPriority(ee){this.pathwayPriority=ee;let ue;const pe=this.penalizedPathways,_e=performance.now();Object.keys(pe).forEach(Ne=>{_e-pe[Ne]>PATHWAY_PENALTY_DURATION_MS&&delete pe[Ne]});for(let Ne=0;Ne<ee.length;Ne++){const Ue=ee[Ne];if(pe[Ue])continue;if(Ue===this.pathwayId)return;const Ge=this.hls.nextLoadLevel,qe=this.hls.levels[Ge];if(ue=this.getLevelsForPathway(Ue),ue.length>0){this.log(`Setting Pathway to "${Ue}"`),this.pathwayId=Ue,this.hls.trigger(Events.LEVELS_UPDATED,{levels:ue});const Ke=this.hls.levels[Ge];qe&&Ke&&this.levels&&(Ke.attrs["STABLE-VARIANT-ID"]!==qe.attrs["STABLE-VARIANT-ID"]&&Ke.bitrate!==qe.bitrate&&this.log(`Unstable Pathways change from bitrate ${qe.bitrate} to ${Ke.bitrate}`),this.hls.nextLoadLevel=Ge);break}}}clonePathways(ee){const ue=this.levels;if(!ue)return;const pe={},_e={};ee.forEach(Ne=>{const{ID:Ue,"BASE-ID":Ge,"URI-REPLACEMENT":qe}=Ne;if(ue.some(Ye=>Ye.pathwayId===Ue))return;const Ke=this.getLevelsForPathway(Ge).map(Ye=>{const Ze=_extends({},Ye);Ze.details=void 0,Ze.url=performUriReplacement(Ye.uri,Ye.attrs["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",qe);const Xe=new AttrList(Ye.attrs);Xe["PATHWAY-ID"]=Ue;const Je=Xe.AUDIO&&`${Xe.AUDIO}_clone_${Ue}`,tt=Xe.SUBTITLES&&`${Xe.SUBTITLES}_clone_${Ue}`;Je&&(pe[Xe.AUDIO]=Je,Xe.AUDIO=Je),tt&&(_e[Xe.SUBTITLES]=tt,Xe.SUBTITLES=tt),Ze.attrs=Xe;const rt=new Level(Ze);return addGroupId(rt,"audio",Je),addGroupId(rt,"text",tt),rt});ue.push(...Ke),cloneRenditionGroups(this.audioTracks,pe,qe,Ue),cloneRenditionGroups(this.subtitleTracks,_e,qe,Ue)})}loadSteeringManifest(ee){const ue=this.hls.config,pe=ue.loader;this.loader&&this.loader.destroy(),this.loader=new pe(ue);let _e;try{_e=new self.URL(ee)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${ee}`);return}if(_e.protocol!=="data:"){const Ye=(this.hls.bandwidthEstimate||ue.abrEwmaDefaultEstimate)|0;_e.searchParams.set("_HLS_pathway",this.pathwayId),_e.searchParams.set("_HLS_throughput",""+Ye)}const Ne={responseType:"json",url:_e.href},Ue=ue.steeringManifestLoadPolicy.default,Ge=Ue.errorRetry||Ue.timeoutRetry||{},qe={loadPolicy:Ue,timeout:Ue.maxLoadTimeMs,maxRetry:Ge.maxNumRetry||0,retryDelay:Ge.retryDelayMs||0,maxRetryDelay:Ge.maxRetryDelayMs||0},Ke={onSuccess:(Ye,Ze,Xe,Je)=>{this.log(`Loaded steering manifest: "${_e}"`);const tt=Ye.data;if(tt.VERSION!==1){this.log(`Steering VERSION ${tt.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=tt.TTL;const{"RELOAD-URI":rt,"PATHWAY-CLONES":et,"PATHWAY-PRIORITY":it}=tt;if(rt)try{this.uri=new self.URL(rt,_e).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${rt}`);return}this.scheduleRefresh(this.uri||Xe.url),et&&this.clonePathways(et),it&&this.updatePathwayPriority(it)},onError:(Ye,Ze,Xe,Je)=>{if(this.log(`Error loading steering manifest: ${Ye.code} ${Ye.text} (${Ze.url})`),this.stopLoad(),Ye.code===410){this.enabled=!1,this.log(`Steering manifest ${Ze.url} no longer available`);return}let tt=this.timeToLoad*1e3;if(Ye.code===429){const rt=this.loader;if(typeof(rt==null?void 0:rt.getResponseHeader)=="function"){const et=rt.getResponseHeader("Retry-After");et&&(tt=parseFloat(et)*1e3)}this.log(`Steering manifest ${Ze.url} rate limited`);return}this.scheduleRefresh(this.uri||Ze.url,tt)},onTimeout:(Ye,Ze,Xe)=>{this.log(`Timeout loading steering manifest (${Ze.url})`),this.scheduleRefresh(this.uri||Ze.url)}};this.log(`Requesting steering manifest: ${_e}`),this.loader.load(Ne,qe,Ke)}scheduleRefresh(ee,ue=this.timeToLoad*1e3){self.clearTimeout(this.reloadTimer),this.reloadTimer=self.setTimeout(()=>{this.loadSteeringManifest(ee)},ue)}}function cloneRenditionGroups(fe,ee,ue,pe){fe&&Object.keys(ee).forEach(_e=>{const Ne=fe.filter(Ue=>Ue.groupId===_e).map(Ue=>{const Ge=_extends({},Ue);return Ge.details=void 0,Ge.attrs=new AttrList(Ge.attrs),Ge.url=Ge.attrs.URI=performUriReplacement(Ue.url,Ue.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",ue),Ge.groupId=Ge.attrs["GROUP-ID"]=ee[_e],Ge.attrs["PATHWAY-ID"]=pe,Ge});fe.push(...Ne)})}function performUriReplacement(fe,ee,ue,pe){const{HOST:_e,PARAMS:Ne,[ue]:Ue}=pe;let Ge;ee&&(Ge=Ue==null?void 0:Ue[ee],Ge&&(fe=Ge));const qe=new self.URL(fe);return _e&&!Ge&&(qe.host=_e),Ne&&Object.keys(Ne).sort().forEach(Ke=>{Ke&&qe.searchParams.set(Ke,Ne[Ke])}),qe.href}const AGE_HEADER_LINE_REGEX=/^age:\s*[\d.]+\s*$/im;class XhrLoader{constructor(ee){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=ee&&ee.xhrSetup||null,this.stats=new LoadStats,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null}abortInternal(){const ee=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),ee&&(ee.onreadystatechange=null,ee.onprogress=null,ee.readyState!==4&&(this.stats.aborted=!0,ee.abort()))}abort(){var ee;this.abortInternal(),(ee=this.callbacks)!=null&&ee.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(ee,ue,pe){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=ee,this.config=ue,this.callbacks=pe,this.loadInternal()}loadInternal(){const{config:ee,context:ue}=this;if(!ee)return;const pe=this.loader=new self.XMLHttpRequest,_e=this.stats;_e.loading.first=0,_e.loaded=0,_e.aborted=!1;const Ne=this.xhrSetup;Ne?Promise.resolve().then(()=>{if(!this.stats.aborted)return Ne(pe,ue.url)}).catch(Ue=>(pe.open("GET",ue.url,!0),Ne(pe,ue.url))).then(()=>{this.stats.aborted||this.openAndSendXhr(pe,ue,ee)}).catch(Ue=>{this.callbacks.onError({code:pe.status,text:Ue.message},ue,pe,_e)}):this.openAndSendXhr(pe,ue,ee)}openAndSendXhr(ee,ue,pe){ee.readyState||ee.open("GET",ue.url,!0);const _e=this.context.headers,{maxTimeToFirstByteMs:Ne,maxLoadTimeMs:Ue}=pe.loadPolicy;if(_e)for(const Ge in _e)ee.setRequestHeader(Ge,_e[Ge]);ue.rangeEnd&&ee.setRequestHeader("Range","bytes="+ue.rangeStart+"-"+(ue.rangeEnd-1)),ee.onreadystatechange=this.readystatechange.bind(this),ee.onprogress=this.loadprogress.bind(this),ee.responseType=ue.responseType,self.clearTimeout(this.requestTimeout),pe.timeout=Ne&&isFiniteNumber(Ne)?Ne:Ue,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),pe.timeout),ee.send()}readystatechange(){const{context:ee,loader:ue,stats:pe}=this;if(!ee||!ue)return;const _e=ue.readyState,Ne=this.config;if(!pe.aborted&&_e>=2&&(pe.loading.first===0&&(pe.loading.first=Math.max(self.performance.now(),pe.loading.start),Ne.timeout!==Ne.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),Ne.timeout=Ne.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),Ne.loadPolicy.maxLoadTimeMs-(pe.loading.first-pe.loading.start)))),_e===4)){self.clearTimeout(this.requestTimeout),ue.onreadystatechange=null,ue.onprogress=null;const Ue=ue.status,Ge=ue.responseType!=="text";if(Ue>=200&&Ue<300&&(Ge&&ue.response||ue.responseText!==null)){pe.loading.end=Math.max(self.performance.now(),pe.loading.first);const qe=Ge?ue.response:ue.responseText,Ke=ue.responseType==="arraybuffer"?qe.byteLength:qe.length;if(pe.loaded=pe.total=Ke,pe.bwEstimate=pe.total*8e3/(pe.loading.end-pe.loading.first),!this.callbacks)return;const Ye=this.callbacks.onProgress;if(Ye&&Ye(pe,ee,qe,ue),!this.callbacks)return;const Ze={url:ue.responseURL,data:qe,code:Ue};this.callbacks.onSuccess(Ze,pe,ee,ue)}else{const qe=Ne.loadPolicy.errorRetry,Ke=pe.retry;shouldRetry(qe,Ke,!1,Ue)?this.retry(qe):(logger.error(`${Ue} while loading ${ee.url}`),this.callbacks.onError({code:Ue,text:ue.statusText},ee,ue,pe))}}}loadtimeout(){var ee;const ue=(ee=this.config)==null?void 0:ee.loadPolicy.timeoutRetry,pe=this.stats.retry;if(shouldRetry(ue,pe,!0))this.retry(ue);else{logger.warn(`timeout while loading ${this.context.url}`);const _e=this.callbacks;_e&&(this.abortInternal(),_e.onTimeout(this.stats,this.context,this.loader))}}retry(ee){const{context:ue,stats:pe}=this;this.retryDelay=getRetryDelay(ee,pe.retry),pe.retry++,logger.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${ue.url}, retrying ${pe.retry}/${ee.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(ee){const ue=this.stats;ue.loaded=ee.loaded,ee.lengthComputable&&(ue.total=ee.total)}getCacheAge(){let ee=null;if(this.loader&&AGE_HEADER_LINE_REGEX.test(this.loader.getAllResponseHeaders())){const ue=this.loader.getResponseHeader("age");ee=ue?parseFloat(ue):null}return ee}getResponseHeader(ee){return this.loader&&new RegExp(`^${ee}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(ee):null}}function fetchSupported(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const BYTERANGE=/(\d+)-(\d+)\/(\d+)/;class FetchLoader{constructor(ee){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=ee.fetchSetup||getRequest,this.controller=new self.AbortController,this.stats=new LoadStats}destroy(){this.loader=this.callbacks=null,this.abortInternal()}abortInternal(){const ee=this.response;ee!=null&&ee.ok||(this.stats.aborted=!0,this.controller.abort())}abort(){var ee;this.abortInternal(),(ee=this.callbacks)!=null&&ee.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(ee,ue,pe){const _e=this.stats;if(_e.loading.start)throw new Error("Loader can only be used once.");_e.loading.start=self.performance.now();const Ne=getRequestParameters(ee,this.controller.signal),Ue=pe.onProgress,Ge=ee.responseType==="arraybuffer",qe=Ge?"byteLength":"length",{maxTimeToFirstByteMs:Ke,maxLoadTimeMs:Ye}=ue.loadPolicy;this.context=ee,this.config=ue,this.callbacks=pe,this.request=this.fetchSetup(ee,Ne),self.clearTimeout(this.requestTimeout),ue.timeout=Ke&&isFiniteNumber(Ke)?Ke:Ye,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),pe.onTimeout(_e,ee,this.response)},ue.timeout),self.fetch(this.request).then(Ze=>{this.response=this.loader=Ze;const Xe=Math.max(self.performance.now(),_e.loading.start);if(self.clearTimeout(this.requestTimeout),ue.timeout=Ye,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),pe.onTimeout(_e,ee,this.response)},Ye-(Xe-_e.loading.start)),!Ze.ok){const{status:Je,statusText:tt}=Ze;throw new FetchError(tt||"fetch, bad network response",Je,Ze)}return _e.loading.first=Xe,_e.total=getContentLength(Ze.headers)||_e.total,Ue&&isFiniteNumber(ue.highWaterMark)?this.loadProgressively(Ze,_e,ee,ue.highWaterMark,Ue):Ge?Ze.arrayBuffer():ee.responseType==="json"?Ze.json():Ze.text()}).then(Ze=>{const{response:Xe}=this;self.clearTimeout(this.requestTimeout),_e.loading.end=Math.max(self.performance.now(),_e.loading.first);const Je=Ze[qe];Je&&(_e.loaded=_e.total=Je);const tt={url:Xe.url,data:Ze,code:Xe.status};Ue&&!isFiniteNumber(ue.highWaterMark)&&Ue(_e,ee,Ze,Xe),pe.onSuccess(tt,_e,ee,Xe)}).catch(Ze=>{if(self.clearTimeout(this.requestTimeout),_e.aborted)return;const Xe=Ze&&Ze.code||0,Je=Ze?Ze.message:null;pe.onError({code:Xe,text:Je},ee,Ze?Ze.details:null,_e)})}getCacheAge(){let ee=null;if(this.response){const ue=this.response.headers.get("age");ee=ue?parseFloat(ue):null}return ee}getResponseHeader(ee){return this.response?this.response.headers.get(ee):null}loadProgressively(ee,ue,pe,_e=0,Ne){const Ue=new ChunkCache,Ge=ee.body.getReader(),qe=()=>Ge.read().then(Ke=>{if(Ke.done)return Ue.dataLength&&Ne(ue,pe,Ue.flush(),ee),Promise.resolve(new ArrayBuffer(0));const Ye=Ke.value,Ze=Ye.length;return ue.loaded+=Ze,Ze<_e||Ue.dataLength?(Ue.push(Ye),Ue.dataLength>=_e&&Ne(ue,pe,Ue.flush(),ee)):Ne(ue,pe,Ye,ee),qe()}).catch(()=>Promise.reject());return qe()}}function getRequestParameters(fe,ee){const ue={method:"GET",mode:"cors",credentials:"same-origin",signal:ee,headers:new self.Headers(_extends({},fe.headers))};return fe.rangeEnd&&ue.headers.set("Range","bytes="+fe.rangeStart+"-"+String(fe.rangeEnd-1)),ue}function getByteRangeLength(fe){const ee=BYTERANGE.exec(fe);if(ee)return parseInt(ee[2])-parseInt(ee[1])+1}function getContentLength(fe){const ee=fe.get("Content-Range");if(ee){const pe=getByteRangeLength(ee);if(isFiniteNumber(pe))return pe}const ue=fe.get("Content-Length");if(ue)return parseInt(ue)}function getRequest(fe,ee){return new self.Request(fe.url,ee)}class FetchError extends Error{constructor(ee,ue,pe){super(ee),this.code=void 0,this.details=void 0,this.code=ue,this.details=pe}}const WHITESPACE_CHAR=/\s/,Cues={newCue(fe,ee,ue,pe){const _e=[];let Ne,Ue,Ge,qe,Ke;const Ye=self.VTTCue||self.TextTrackCue;for(let Xe=0;Xe<pe.rows.length;Xe++)if(Ne=pe.rows[Xe],Ge=!0,qe=0,Ke="",!Ne.isEmpty()){var Ze;for(let rt=0;rt<Ne.chars.length;rt++)WHITESPACE_CHAR.test(Ne.chars[rt].uchar)&&Ge?qe++:(Ke+=Ne.chars[rt].uchar,Ge=!1);Ne.cueStartTime=ee,ee===ue&&(ue+=1e-4),qe>=16?qe--:qe++;const Je=fixLineBreaks(Ke.trim()),tt=generateCueId(ee,ue,Je);fe!=null&&(Ze=fe.cues)!=null&&Ze.getCueById(tt)||(Ue=new Ye(ee,ue,Je),Ue.id=tt,Ue.line=Xe+1,Ue.align="left",Ue.position=10+Math.min(80,Math.floor(qe*8/32)*10),_e.push(Ue))}return fe&&_e.length&&(_e.sort((Xe,Je)=>Xe.line==="auto"||Je.line==="auto"?0:Xe.line>8&&Je.line>8?Je.line-Xe.line:Xe.line-Je.line),_e.forEach(Xe=>addCueToTrack(fe,Xe))),_e}},defaultLoadPolicy={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},hlsDefaultConfig=_objectSpread2(_objectSpread2({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:XhrLoader,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:AbrController,bufferController:BufferController,capLevelController:CapLevelController,errorController:ErrorController,fpsController:FPSController,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,certLoadPolicy:{default:defaultLoadPolicy},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},timelineConfig()),{},{subtitleStreamController:SubtitleStreamController,subtitleTrackController:SubtitleTrackController,timelineController:TimelineController,audioStreamController:AudioStreamController,audioTrackController:AudioTrackController,emeController:EMEController,cmcdController:CMCDController,contentSteeringController:ContentSteeringController});function timelineConfig(){return{cueHandler:Cues,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function mergeConfig(fe,ee){if((ee.liveSyncDurationCount||ee.liveMaxLatencyDurationCount)&&(ee.liveSyncDuration||ee.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(ee.liveMaxLatencyDurationCount!==void 0&&(ee.liveSyncDurationCount===void 0||ee.liveMaxLatencyDurationCount<=ee.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(ee.liveMaxLatencyDuration!==void 0&&(ee.liveSyncDuration===void 0||ee.liveMaxLatencyDuration<=ee.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const ue=deepCpy(fe),pe=["manifest","level","frag"],_e=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return pe.forEach(Ne=>{const Ue=`${Ne==="level"?"playlist":Ne}LoadPolicy`,Ge=ee[Ue]===void 0,qe=[];_e.forEach(Ke=>{const Ye=`${Ne}Loading${Ke}`,Ze=ee[Ye];if(Ze!==void 0&&Ge){qe.push(Ye);const Xe=ue[Ue].default;switch(ee[Ue]={default:Xe},Ke){case"TimeOut":Xe.maxLoadTimeMs=Ze,Xe.maxTimeToFirstByteMs=Ze;break;case"MaxRetry":Xe.errorRetry.maxNumRetry=Ze,Xe.timeoutRetry.maxNumRetry=Ze;break;case"RetryDelay":Xe.errorRetry.retryDelayMs=Ze,Xe.timeoutRetry.retryDelayMs=Ze;break;case"MaxRetryTimeout":Xe.errorRetry.maxRetryDelayMs=Ze,Xe.timeoutRetry.maxRetryDelayMs=Ze;break}}}),qe.length&&logger.warn(`hls.js config: "${qe.join('", "')}" setting(s) are deprecated, use "${Ue}": ${JSON.stringify(ee[Ue])}`)}),_objectSpread2(_objectSpread2({},ue),ee)}function deepCpy(fe){return fe&&typeof fe=="object"?Array.isArray(fe)?fe.map(deepCpy):Object.keys(fe).reduce((ee,ue)=>(ee[ue]=deepCpy(fe[ue]),ee),{}):fe}function enableStreamingMode(fe){const ee=fe.loader;ee!==FetchLoader&&ee!==XhrLoader?(logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),fe.progressive=!1):fetchSupported()&&(fe.loader=FetchLoader,fe.progressive=!0,fe.enableSoftwareAES=!0,logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}class Hls{static get version(){return"1.4.12"}static isSupported(){return isSupported()}static get Events(){return Events}static get ErrorTypes(){return ErrorTypes}static get ErrorDetails(){return ErrorDetails}static get DefaultConfig(){return Hls.defaultConfig?Hls.defaultConfig:hlsDefaultConfig}static set DefaultConfig(ee){Hls.defaultConfig=ee}constructor(ee={}){this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new EventEmitter,this._autoLevelCapping=void 0,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null,enableLogs(ee.debug||!1,"Hls instance");const ue=this.config=mergeConfig(Hls.DefaultConfig,ee);this.userConfig=ee,this._autoLevelCapping=-1,ue.progressive&&enableStreamingMode(ue);const{abrController:pe,bufferController:_e,capLevelController:Ne,errorController:Ue,fpsController:Ge}=ue,qe=new Ue(this),Ke=this.abrController=new pe(this),Ye=this.bufferController=new _e(this),Ze=this.capLevelController=new Ne(this),Xe=new Ge(this),Je=new PlaylistLoader(this),tt=new ID3TrackController(this),rt=ue.contentSteeringController,et=rt?new rt(this):null,it=this.levelController=new LevelController(this,et),nt=new FragmentTracker(this),st=new KeyLoader(this.config),lt=this.streamController=new StreamController(this,nt,st);Ze.setStreamController(lt),Xe.setStreamController(lt);const _r=[Je,it,lt];et&&_r.splice(1,0,et),this.networkControllers=_r;const jr=[Ke,Ye,Ze,Xe,tt,nt];this.audioTrackController=this.createController(ue.audioTrackController,_r);const Nr=ue.audioStreamController;Nr&&_r.push(new Nr(this,nt,st)),this.subtitleTrackController=this.createController(ue.subtitleTrackController,_r);const Wr=ue.subtitleStreamController;Wr&&_r.push(new Wr(this,nt,st)),this.createController(ue.timelineController,jr),st.emeController=this.emeController=this.createController(ue.emeController,jr),this.cmcdController=this.createController(ue.cmcdController,jr),this.latencyController=this.createController(LatencyController,jr),this.coreComponents=jr,_r.push(qe);const ri=qe.onErrorOut;typeof ri=="function"&&this.on(Events.ERROR,ri,qe)}createController(ee,ue){if(ee){const pe=new ee(this);return ue&&ue.push(pe),pe}return null}on(ee,ue,pe=this){this._emitter.on(ee,ue,pe)}once(ee,ue,pe=this){this._emitter.once(ee,ue,pe)}removeAllListeners(ee){this._emitter.removeAllListeners(ee)}off(ee,ue,pe=this,_e){this._emitter.off(ee,ue,pe,_e)}listeners(ee){return this._emitter.listeners(ee)}emit(ee,ue,pe){return this._emitter.emit(ee,ue,pe)}trigger(ee,ue){if(this.config.debug)return this.emit(ee,ee,ue);try{return this.emit(ee,ee,ue)}catch(pe){logger.error("An internal error happened while handling event "+ee+'. Error message: "'+pe.message+'". Here is a stacktrace:',pe),this.trigger(Events.ERROR,{type:ErrorTypes.OTHER_ERROR,details:ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:ee,error:pe})}return!1}listenerCount(ee){return this._emitter.listenerCount(ee)}destroy(){logger.log("destroy"),this.trigger(Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(ue=>ue.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(ue=>ue.destroy()),this.coreComponents.length=0;const ee=this.config;ee.xhrSetup=ee.fetchSetup=void 0,this.userConfig=null}attachMedia(ee){logger.log("attachMedia"),this._media=ee,this.trigger(Events.MEDIA_ATTACHING,{media:ee})}detachMedia(){logger.log("detachMedia"),this.trigger(Events.MEDIA_DETACHING,void 0),this._media=null}loadSource(ee){this.stopLoad();const ue=this.media,pe=this.url,_e=this.url=urlToolkitExports.buildAbsoluteURL(self.location.href,ee,{alwaysNormalize:!0});logger.log(`loadSource:${_e}`),ue&&pe&&(pe!==_e||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(ue)),this.trigger(Events.MANIFEST_LOADING,{url:ee})}startLoad(ee=-1){logger.log(`startLoad(${ee})`),this.networkControllers.forEach(ue=>{ue.startLoad(ee)})}stopLoad(){logger.log("stopLoad"),this.networkControllers.forEach(ee=>{ee.stopLoad()})}swapAudioCodec(){logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){logger.log("recoverMediaError");const ee=this._media;this.detachMedia(),ee&&this.attachMedia(ee)}removeLevel(ee,ue=0){this.levelController.removeLevel(ee,ue)}get levels(){const ee=this.levelController.levels;return ee||[]}get currentLevel(){return this.streamController.currentLevel}set currentLevel(ee){logger.log(`set currentLevel:${ee}`),this.loadLevel=ee,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(ee){logger.log(`set nextLevel:${ee}`),this.levelController.manualLevel=ee,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(ee){logger.log(`set loadLevel:${ee}`),this.levelController.manualLevel=ee}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(ee){this.levelController.nextLoadLevel=ee}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(ee){logger.log(`set firstLevel:${ee}`),this.levelController.firstLevel=ee}get startLevel(){return this.levelController.startLevel}set startLevel(ee){logger.log(`set startLevel:${ee}`),ee!==-1&&(ee=Math.max(ee,this.minAutoLevel)),this.levelController.startLevel=ee}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(ee){const ue=!!ee;ue!==this.config.capLevelToPlayerSize&&(ue?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=ue)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:ee}=this.abrController;return ee?ee.getEstimate():NaN}get ttfbEstimate(){const{bwEstimator:ee}=this.abrController;return ee?ee.getEstimateTTFB():NaN}set autoLevelCapping(ee){this._autoLevelCapping!==ee&&(logger.log(`set autoLevelCapping:${ee}`),this._autoLevelCapping=ee)}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(ee){HdcpLevels.indexOf(ee)>-1&&(this._maxHdcpLevel=ee)}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:ee,config:{minAutoBitrate:ue}}=this;if(!ee)return 0;const pe=ee.length;for(let _e=0;_e<pe;_e++)if(ee[_e].maxBitrate>=ue)return _e;return 0}get maxAutoLevel(){const{levels:ee,autoLevelCapping:ue,maxHdcpLevel:pe}=this;let _e;if(ue===-1&&ee&&ee.length?_e=ee.length-1:_e=ue,pe)for(let Ne=_e;Ne--;){const Ue=ee[Ne].attrs["HDCP-LEVEL"];if(Ue&&Ue<=pe)return Ne}return _e}get nextAutoLevel(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)}set nextAutoLevel(ee){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,ee)}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get audioTracks(){const ee=this.audioTrackController;return ee?ee.audioTracks:[]}get audioTrack(){const ee=this.audioTrackController;return ee?ee.audioTrack:-1}set audioTrack(ee){const ue=this.audioTrackController;ue&&(ue.audioTrack=ee)}get subtitleTracks(){const ee=this.subtitleTrackController;return ee?ee.subtitleTracks:[]}get subtitleTrack(){const ee=this.subtitleTrackController;return ee?ee.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(ee){const ue=this.subtitleTrackController;ue&&(ue.subtitleTrack=ee)}get subtitleDisplay(){const ee=this.subtitleTrackController;return ee?ee.subtitleDisplay:!1}set subtitleDisplay(ee){const ue=this.subtitleTrackController;ue&&(ue.subtitleDisplay=ee)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(ee){this.config.lowLatencyMode=ee}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}}Hls.defaultConfig=void 0;let getRandomValues;const rnds8=new Uint8Array(16);function rng(){if(!getRandomValues&&(getRandomValues=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!getRandomValues))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return getRandomValues(rnds8)}const byteToHex=[];for(let fe=0;fe<256;++fe)byteToHex.push((fe+256).toString(16).slice(1));function unsafeStringify(fe,ee=0){return byteToHex[fe[ee+0]]+byteToHex[fe[ee+1]]+byteToHex[fe[ee+2]]+byteToHex[fe[ee+3]]+"-"+byteToHex[fe[ee+4]]+byteToHex[fe[ee+5]]+"-"+byteToHex[fe[ee+6]]+byteToHex[fe[ee+7]]+"-"+byteToHex[fe[ee+8]]+byteToHex[fe[ee+9]]+"-"+byteToHex[fe[ee+10]]+byteToHex[fe[ee+11]]+byteToHex[fe[ee+12]]+byteToHex[fe[ee+13]]+byteToHex[fe[ee+14]]+byteToHex[fe[ee+15]]}const randomUUID=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),native={randomUUID};function v4(fe,ee,ue){if(native.randomUUID&&!ee&&!fe)return native.randomUUID();fe=fe||{};const pe=fe.random||(fe.rng||rng)();if(pe[6]=pe[6]&15|64,pe[8]=pe[8]&63|128,ee){ue=ue||0;for(let _e=0;_e<16;++_e)ee[ue+_e]=pe[_e];return ee}return unsafeStringify(pe)}function $db6c3485150b8e66$export$1ab7ae714698c4b8(fe){const[ee,ue]=reactExports.useState(void 0);return $9f79659886946c16$export$e5c5a5f917a5871c(()=>{if(fe){ue({width:fe.offsetWidth,height:fe.offsetHeight});const pe=new ResizeObserver(_e=>{if(!Array.isArray(_e)||!_e.length)return;const Ne=_e[0];let Ue,Ge;if("borderBoxSize"in Ne){const qe=Ne.borderBoxSize,Ke=Array.isArray(qe)?qe[0]:qe;Ue=Ke.inlineSize,Ge=Ke.blockSize}else Ue=fe.offsetWidth,Ge=fe.offsetHeight;ue({width:Ue,height:Ge})});return pe.observe(fe,{box:"border-box"}),()=>pe.unobserve(fe)}else ue(void 0)},[fe]),ee}function $010c2913dbd2fe3d$export$5cae361ad82dce8b(fe){const ee=reactExports.useRef({value:fe,previous:fe});return reactExports.useMemo(()=>(ee.current.value!==fe&&(ee.current.previous=ee.current.value,ee.current.value=fe),ee.current.previous),[fe])}const $ce77a8961b41be9e$var$RADIO_NAME="Radio",[$ce77a8961b41be9e$var$createRadioContext,$ce77a8961b41be9e$export$67d2296460f1b002]=$c512c27ab02ef895$export$50c7b4e9d9f19c1($ce77a8961b41be9e$var$RADIO_NAME),[$ce77a8961b41be9e$var$RadioProvider,$ce77a8961b41be9e$var$useRadioContext]=$ce77a8961b41be9e$var$createRadioContext($ce77a8961b41be9e$var$RADIO_NAME),$ce77a8961b41be9e$export$d7b12c4107be0d61=reactExports.forwardRef((fe,ee)=>{const{__scopeRadio:ue,name:pe,checked:_e=!1,required:Ne,disabled:Ue,value:Ge="on",onCheck:qe,...Ke}=fe,[Ye,Ze]=reactExports.useState(null),Xe=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(ee,rt=>Ze(rt)),Je=reactExports.useRef(!1),tt=Ye?!!Ye.closest("form"):!0;return reactExports.createElement($ce77a8961b41be9e$var$RadioProvider,{scope:ue,checked:_e,disabled:Ue},reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.button,_extends$1({type:"button",role:"radio","aria-checked":_e,"data-state":$ce77a8961b41be9e$var$getState(_e),"data-disabled":Ue?"":void 0,disabled:Ue,value:Ge},Ke,{ref:Xe,onClick:$e42e1063c40fb3ef$export$b9ecd428b558ff10(fe.onClick,rt=>{_e||qe==null||qe(),tt&&(Je.current=rt.isPropagationStopped(),Je.current||rt.stopPropagation())})})),tt&&reactExports.createElement($ce77a8961b41be9e$var$BubbleInput,{control:Ye,bubbles:!Je.current,name:pe,value:Ge,checked:_e,required:Ne,disabled:Ue,style:{transform:"translateX(-100%)"}}))}),$ce77a8961b41be9e$var$BubbleInput=fe=>{const{control:ee,checked:ue,bubbles:pe=!0,..._e}=fe,Ne=reactExports.useRef(null),Ue=$010c2913dbd2fe3d$export$5cae361ad82dce8b(ue),Ge=$db6c3485150b8e66$export$1ab7ae714698c4b8(ee);return reactExports.useEffect(()=>{const qe=Ne.current,Ke=window.HTMLInputElement.prototype,Ze=Object.getOwnPropertyDescriptor(Ke,"checked").set;if(Ue!==ue&&Ze){const Xe=new Event("click",{bubbles:pe});Ze.call(qe,ue),qe.dispatchEvent(Xe)}},[Ue,ue,pe]),reactExports.createElement("input",_extends$1({type:"radio","aria-hidden":!0,defaultChecked:ue},_e,{tabIndex:-1,ref:Ne,style:{...fe.style,...Ge,position:"absolute",pointerEvents:"none",opacity:0,margin:0}}))};function $ce77a8961b41be9e$var$getState(fe){return fe?"checked":"unchecked"}const $f99a8c78507165f7$var$ARROW_KEYS=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],$f99a8c78507165f7$var$RADIO_GROUP_NAME="RadioGroup",[$f99a8c78507165f7$var$createRadioGroupContext,$f99a8c78507165f7$export$c547093f11b76da2]=$c512c27ab02ef895$export$50c7b4e9d9f19c1($f99a8c78507165f7$var$RADIO_GROUP_NAME,[$d7bdfb9eb0fdf311$export$c7109489551a4f4,$ce77a8961b41be9e$export$67d2296460f1b002]),$f99a8c78507165f7$var$useRovingFocusGroupScope=$d7bdfb9eb0fdf311$export$c7109489551a4f4(),$f99a8c78507165f7$var$useRadioScope=$ce77a8961b41be9e$export$67d2296460f1b002(),[$f99a8c78507165f7$var$RadioGroupProvider,$f99a8c78507165f7$var$useRadioGroupContext]=$f99a8c78507165f7$var$createRadioGroupContext($f99a8c78507165f7$var$RADIO_GROUP_NAME),$f99a8c78507165f7$export$a98f0dcb43a68a25=reactExports.forwardRef((fe,ee)=>{const{__scopeRadioGroup:ue,name:pe,defaultValue:_e,value:Ne,required:Ue=!1,disabled:Ge=!1,orientation:qe,dir:Ke,loop:Ye=!0,onValueChange:Ze,...Xe}=fe,Je=$f99a8c78507165f7$var$useRovingFocusGroupScope(ue),tt=$f631663db3294ace$export$b39126d51d94e6f3(Ke),[rt,et]=$71cd76cc60e0454e$export$6f32135080cb4c3({prop:Ne,defaultProp:_e,onChange:Ze});return reactExports.createElement($f99a8c78507165f7$var$RadioGroupProvider,{scope:ue,name:pe,required:Ue,disabled:Ge,value:rt,onValueChange:et},reactExports.createElement($d7bdfb9eb0fdf311$export$be92b6f5f03c0fe9,_extends$1({asChild:!0},Je,{orientation:qe,dir:tt,loop:Ye}),reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({role:"radiogroup","aria-required":Ue,"aria-orientation":qe,"data-disabled":Ge?"":void 0,dir:tt},Xe,{ref:ee}))))}),$f99a8c78507165f7$var$ITEM_NAME="RadioGroupItem",$f99a8c78507165f7$export$9f866c100ef519e4=reactExports.forwardRef((fe,ee)=>{const{__scopeRadioGroup:ue,disabled:pe,..._e}=fe,Ne=$f99a8c78507165f7$var$useRadioGroupContext($f99a8c78507165f7$var$ITEM_NAME,ue),Ue=Ne.disabled||pe,Ge=$f99a8c78507165f7$var$useRovingFocusGroupScope(ue),qe=$f99a8c78507165f7$var$useRadioScope(ue),Ke=reactExports.useRef(null),Ye=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(ee,Ke),Ze=Ne.value===_e.value,Xe=reactExports.useRef(!1);return reactExports.useEffect(()=>{const Je=rt=>{$f99a8c78507165f7$var$ARROW_KEYS.includes(rt.key)&&(Xe.current=!0)},tt=()=>Xe.current=!1;return document.addEventListener("keydown",Je),document.addEventListener("keyup",tt),()=>{document.removeEventListener("keydown",Je),document.removeEventListener("keyup",tt)}},[]),reactExports.createElement($d7bdfb9eb0fdf311$export$6d08773d2e66f8f2,_extends$1({asChild:!0},Ge,{focusable:!Ue,active:Ze}),reactExports.createElement($ce77a8961b41be9e$export$d7b12c4107be0d61,_extends$1({disabled:Ue,required:Ne.required,checked:Ze},qe,_e,{name:Ne.name,ref:Ye,onCheck:()=>Ne.onValueChange(_e.value),onKeyDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(Je=>{Je.key==="Enter"&&Je.preventDefault()}),onFocus:$e42e1063c40fb3ef$export$b9ecd428b558ff10(_e.onFocus,()=>{var Je;Xe.current&&((Je=Ke.current)===null||Je===void 0||Je.click())})})))}),$f99a8c78507165f7$export$be92b6f5f03c0fe9=$f99a8c78507165f7$export$a98f0dcb43a68a25,$f99a8c78507165f7$export$6d08773d2e66f8f2=$f99a8c78507165f7$export$9f866c100ef519e4;function ParserError(fe,ee){this.message=fe,this.error=ee}ParserError.prototype=Object.create(Error.prototype);const TIMESTAMP_REGEXP=/([0-9]+)?:?([0-9]{2}):([0-9]{2}\.[0-9]{2,3})/;function parse$3(fe,ee){ee||(ee={});const{meta:ue=!1,strict:pe=!0}=ee;if(typeof fe!="string")throw new ParserError("Input must be a string");fe=fe.trim(),fe=fe.replace(/\r\n/g,`
`),fe=fe.replace(/\r/g,`
`);const _e=fe.split(`

`),Ne=_e.shift();if(!Ne.startsWith("WEBVTT"))throw new ParserError('Must start with "WEBVTT"');const Ue=Ne.split(`
`),Ge=Ue[0].replace("WEBVTT","");if(Ge.length>0&&Ge[0]!==" "&&Ge[0]!=="	")throw new ParserError("Header comment must start with space or tab");if(_e.length===0&&Ue.length===1)return{valid:!0,strict:pe,cues:[],errors:[]};if(!ue&&Ue.length>1&&Ue[1]!=="")throw new ParserError("Missing blank line after signature");const{cues:qe,errors:Ke}=parseCues(_e,pe);if(pe&&Ke.length>0)throw Ke[0];const Ye=ue?parseMeta(Ue):null,Ze={valid:Ke.length===0,strict:pe,cues:qe,errors:Ke};return ue&&(Ze.meta=Ye),Ze}function parseMeta(fe){const ee={};return fe.slice(1).forEach(ue=>{const pe=ue.indexOf(":"),_e=ue.slice(0,pe).trim(),Ne=ue.slice(pe+1).trim();ee[_e]=Ne}),Object.keys(ee).length>0?ee:null}function parseCues(fe,ee){const ue=[];return{cues:fe.map((_e,Ne)=>{try{return parseCue(_e,Ne,ee)}catch(Ue){return ue.push(Ue),null}}).filter(Boolean),errors:ue}}function parseCue(fe,ee,ue){let pe="",_e=0,Ne=.01,Ue="",Ge="";const qe=fe.split(`
`).filter(Boolean);if(qe.length>0&&qe[0].trim().startsWith("NOTE"))return null;if(qe.length===1&&!qe[0].includes("-->"))throw new ParserError(`Cue identifier cannot be standalone (cue #${ee})`);if(qe.length>1&&!(qe[0].includes("-->")||qe[1].includes("-->"))){const Ye=`Cue identifier needs to be followed by timestamp (cue #${ee})`;throw new ParserError(Ye)}qe.length>1&&qe[1].includes("-->")&&(pe=qe.shift());const Ke=typeof qe[0]=="string"&&qe[0].split(" --> ");if(Ke.length!==2||!validTimestamp(Ke[0])||!validTimestamp(Ke[1]))throw new ParserError(`Invalid cue timestamp (cue #${ee})`);if(_e=parseTimestamp(Ke[0]),Ne=parseTimestamp(Ke[1]),ue){if(_e>Ne)throw new ParserError(`Start timestamp greater than end (cue #${ee})`);if(Ne<=_e)throw new ParserError(`End must be greater than start (cue #${ee})`)}if(!ue&&Ne<_e)throw new ParserError(`End must be greater or equal to start when not strict (cue #${ee})`);return Ge=Ke[1].replace(TIMESTAMP_REGEXP,"").trim(),qe.shift(),Ue=qe.join(`
`),Ue?{identifier:pe,start:_e,end:Ne,text:Ue,styles:Ge}:!1}function validTimestamp(fe){return TIMESTAMP_REGEXP.test(fe)}function parseTimestamp(fe){const ee=fe.match(TIMESTAMP_REGEXP);let ue=parseFloat(ee[1]||0)*60*60;return ue+=parseFloat(ee[2])*60,ue+=parseFloat(ee[3]),ue}var parser={ParserError,parse:parse$3};function CompilerError(fe,ee){this.message=fe,this.error=ee}CompilerError.prototype=Object.create(Error.prototype);function compile$1(fe){if(!fe)throw new CompilerError("Input must be non-null");if(typeof fe!="object")throw new CompilerError("Input must be an object");if(Array.isArray(fe))throw new CompilerError("Input cannot be array");if(!fe.valid)throw new CompilerError("Input must be valid");let ee=`WEBVTT
`;if(fe.meta){if(typeof fe.meta!="object"||Array.isArray(fe.meta))throw new CompilerError("Metadata must be an object");Object.entries(fe.meta).forEach(pe=>{if(typeof pe[1]!="string")throw new CompilerError(`Metadata value for "${pe[0]}" must be string`);ee+=`${pe[0]}: ${pe[1]}
`})}let ue=null;return fe.cues.forEach((pe,_e)=>{if(ue&&ue>pe.start)throw new CompilerError(`Cue number ${_e} is not in chronological order`);ue=pe.start,ee+=`
`,ee+=compileCue(pe),ee+=`
`}),ee}function compileCue(fe){if(typeof fe!="object")throw new CompilerError("Cue malformed: not of type object");if(typeof fe.identifier!="string"&&typeof fe.identifier!="number"&&fe.identifier!==null)throw new CompilerError(`Cue malformed: identifier value is not a string.
    ${JSON.stringify(fe)}`);if(isNaN(fe.start))throw new CompilerError(`Cue malformed: null start value.
    ${JSON.stringify(fe)}`);if(isNaN(fe.end))throw new CompilerError(`Cue malformed: null end value.
    ${JSON.stringify(fe)}`);if(fe.start>=fe.end)throw new CompilerError(`Cue malformed: start timestamp greater than end
    ${JSON.stringify(fe)}`);if(typeof fe.text!="string")throw new CompilerError(`Cue malformed: null text value.
    ${JSON.stringify(fe)}`);if(typeof fe.styles!="string")throw new CompilerError(`Cue malformed: null styles value.
    ${JSON.stringify(fe)}`);let ee="";fe.identifier.length>0&&(ee+=`${fe.identifier}
`);const ue=convertTimestamp(fe.start),pe=convertTimestamp(fe.end);return ee+=`${ue} --> ${pe}`,ee+=fe.styles?` ${fe.styles}`:"",ee+=`
${fe.text}`,ee}function convertTimestamp(fe){const ee=pad$1(calculateHours(fe),2),ue=pad$1(calculateMinutes(fe),2),pe=pad$1(calculateSeconds(fe),2),_e=pad$1(calculateMs(fe),3);return`${ee}:${ue}:${pe}.${_e}`}function pad$1(fe,ee){let ue=`${fe}`;for(;ue.length<ee;)ue=`0${ue}`;return ue}function calculateHours(fe){return Math.floor(fe/60/60)}function calculateMinutes(fe){return Math.floor(fe/60)%60}function calculateSeconds(fe){return Math.floor(fe%60)}function calculateMs(fe){return Math.floor((fe%1).toFixed(4)*1e3)}var compiler={CompilerError,compile:compile$1};const parse$2=parser.parse;function segment$2(fe,ee){ee=ee||10;const ue=parse$2(fe),pe=[];let _e=[],Ne=null,Ue=0,Ge=0;return ue.cues.forEach((qe,Ke)=>{const Ye=Ke===0,Ze=Ke===ue.cues.length-1,Xe=qe.start,Je=qe.end,tt=Ze?1/0:ue.cues[Ke+1].start,rt=Ye?Je:Je-Xe,et=Ye?0:Xe-ue.cues[Ke-1].end;Ue=Ue+rt+et,`${Ke}`,pe.length+1,Ne&&(_e.push(Ne),Ue+=Ne.end-Ge,Ne=null),_e.push(qe);let it=tt-Je<ee&&et<ee&&Ue>ee;if(shouldSegment(Ge,ee,tt,et)){const nt=segmentDuration(Ze,Je,ee,Ue,Ge);pe.push({duration:nt,cues:_e}),Ge+=nt,Ue=0,_e=[]}else it=!1;it&&(Ne=qe)}),pe}function shouldSegment(fe,ee,ue,pe){const _e=alignToSegmentLength(pe,ee);return(pe<=ee||_e+fe<ue)&&ue-fe>=ee}function segmentDuration(fe,ee,ue,pe,_e){let Ne=ue;return pe>ue&&(Ne=alignToSegmentLength(pe-ue,ue)),fe?Ne=parseFloat((ee-_e).toFixed(2)):Ne=Math.round(Ne),Ne}function alignToSegmentLength(fe,ee){return fe+=ee-fe%ee,fe}function debug(fe){}var segmenter={segment:segment$2};const segment$1=segmenter.segment;function hlsSegment(fe,ee,ue){typeof ue>"u"&&(ue="900000");const pe=segment$1(fe,ee),_e=[];return pe.forEach((Ne,Ue)=>{const Ge=`WEBVTT
X-TIMESTAMP-MAP=MPEGTS:${ue},LOCAL:00:00:00.000

${printableCues(Ne.cues)}
`,qe=generateSegmentFilename(Ue);_e.push({filename:qe,content:Ge})}),_e}function hlsSegmentPlaylist(fe,ee){const ue=segment$1(fe,ee),pe=printableSegments(ue);return`#EXTM3U
#EXT-X-TARGETDURATION:${Math.round(findLongestSegment(ue))}
#EXT-X-VERSION:3
#EXT-X-MEDIA-SEQUENCE:0
#EXT-X-PLAYLIST-TYPE:VOD
${pe}
#EXT-X-ENDLIST
`}function pad(fe,ee){return`${"0".repeat(Math.max(0,ee-fe.toString().length))}${fe}`}function generateSegmentFilename(fe){return`${fe}.vtt`}function printableSegments(fe){const ee=[];return fe.forEach((ue,pe)=>{ee.push(`#EXTINF:${ue.duration.toFixed(5)},
${generateSegmentFilename(pe)}`)}),ee.join(`
`)}function findLongestSegment(fe){let ee=0;return fe.forEach(ue=>{ue.duration>ee&&(ee=ue.duration)}),ee}function printableCues(fe){const ee=[];return fe.forEach(ue=>{ee.push(printableCue(ue))}),ee.join(`

`)}function printableCue(fe){const ee=[];fe.identifier&&ee.push(fe.identifier);const ue=printableTimestamp(fe.start),pe=printableTimestamp(fe.end),_e=fe.styles?`${fe.styles}`:"";return ee.push(`${ue} --> ${pe} ${_e}`),ee.push(fe.text),ee.join(`
`)}function printableTimestamp(fe){const ee=(fe%1).toFixed(3);fe=Math.round(fe-ee);const ue=Math.floor(fe/3600),pe=Math.floor((fe-ue*3600)/60),_e=fe-ue*3600-pe*60;return`${`${pad(ue,2)}:`}${pad(pe,2)}:${pad(_e,2)}.${pad(ee*1e3,3)}`}var hls$1={hlsSegment,hlsSegmentPlaylist};const parse$1=parser.parse,compile=compiler.compile,segment=segmenter.segment,hls=hls$1;var nodeWebvtt={parse:parse$1,compile,segment,hls};function $addc16e1bbe58fd0$export$3a72a57244d6e765(fe,ee=globalThis==null?void 0:globalThis.document){const ue=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(fe);reactExports.useEffect(()=>{const pe=_e=>{_e.key==="Escape"&&ue(_e)};return ee.addEventListener("keydown",pe),()=>ee.removeEventListener("keydown",pe)},[ue,ee])}const $5cb92bef7577960e$var$CONTEXT_UPDATE$1="dismissableLayer.update",$5cb92bef7577960e$var$POINTER_DOWN_OUTSIDE$1="dismissableLayer.pointerDownOutside",$5cb92bef7577960e$var$FOCUS_OUTSIDE$1="dismissableLayer.focusOutside";let $5cb92bef7577960e$var$originalBodyPointerEvents$1;const $5cb92bef7577960e$var$DismissableLayerContext$1=reactExports.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),$5cb92bef7577960e$export$177fb62ff3ec1f22$1=reactExports.forwardRef((fe,ee)=>{var ue;const{disableOutsidePointerEvents:pe=!1,onEscapeKeyDown:_e,onPointerDownOutside:Ne,onFocusOutside:Ue,onInteractOutside:Ge,onDismiss:qe,...Ke}=fe,Ye=reactExports.useContext($5cb92bef7577960e$var$DismissableLayerContext$1),[Ze,Xe]=reactExports.useState(null),Je=(ue=Ze==null?void 0:Ze.ownerDocument)!==null&&ue!==void 0?ue:globalThis==null?void 0:globalThis.document,[,tt]=reactExports.useState({}),rt=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(ee,Wr=>Xe(Wr)),et=Array.from(Ye.layers),[it]=[...Ye.layersWithOutsidePointerEventsDisabled].slice(-1),nt=et.indexOf(it),st=Ze?et.indexOf(Ze):-1,lt=Ye.layersWithOutsidePointerEventsDisabled.size>0,_r=st>=nt,jr=$5cb92bef7577960e$var$usePointerDownOutside$1(Wr=>{const ri=Wr.target,Xr=[...Ye.branches].some(Gr=>Gr.contains(ri));!_r||Xr||(Ne==null||Ne(Wr),Ge==null||Ge(Wr),Wr.defaultPrevented||qe==null||qe())},Je),Nr=$5cb92bef7577960e$var$useFocusOutside$1(Wr=>{const ri=Wr.target;[...Ye.branches].some(Gr=>Gr.contains(ri))||(Ue==null||Ue(Wr),Ge==null||Ge(Wr),Wr.defaultPrevented||qe==null||qe())},Je);return $addc16e1bbe58fd0$export$3a72a57244d6e765(Wr=>{st===Ye.layers.size-1&&(_e==null||_e(Wr),!Wr.defaultPrevented&&qe&&(Wr.preventDefault(),qe()))},Je),reactExports.useEffect(()=>{if(Ze)return pe&&(Ye.layersWithOutsidePointerEventsDisabled.size===0&&($5cb92bef7577960e$var$originalBodyPointerEvents$1=Je.body.style.pointerEvents,Je.body.style.pointerEvents="none"),Ye.layersWithOutsidePointerEventsDisabled.add(Ze)),Ye.layers.add(Ze),$5cb92bef7577960e$var$dispatchUpdate$1(),()=>{pe&&Ye.layersWithOutsidePointerEventsDisabled.size===1&&(Je.body.style.pointerEvents=$5cb92bef7577960e$var$originalBodyPointerEvents$1)}},[Ze,Je,pe,Ye]),reactExports.useEffect(()=>()=>{Ze&&(Ye.layers.delete(Ze),Ye.layersWithOutsidePointerEventsDisabled.delete(Ze),$5cb92bef7577960e$var$dispatchUpdate$1())},[Ze,Ye]),reactExports.useEffect(()=>{const Wr=()=>tt({});return document.addEventListener($5cb92bef7577960e$var$CONTEXT_UPDATE$1,Wr),()=>document.removeEventListener($5cb92bef7577960e$var$CONTEXT_UPDATE$1,Wr)},[]),reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({},Ke,{ref:rt,style:{pointerEvents:lt?_r?"auto":"none":void 0,...fe.style},onFocusCapture:$e42e1063c40fb3ef$export$b9ecd428b558ff10(fe.onFocusCapture,Nr.onFocusCapture),onBlurCapture:$e42e1063c40fb3ef$export$b9ecd428b558ff10(fe.onBlurCapture,Nr.onBlurCapture),onPointerDownCapture:$e42e1063c40fb3ef$export$b9ecd428b558ff10(fe.onPointerDownCapture,jr.onPointerDownCapture)}))});function $5cb92bef7577960e$var$usePointerDownOutside$1(fe,ee=globalThis==null?void 0:globalThis.document){const ue=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(fe),pe=reactExports.useRef(!1),_e=reactExports.useRef(()=>{});return reactExports.useEffect(()=>{const Ne=Ge=>{if(Ge.target&&!pe.current){let Ke=function(){$5cb92bef7577960e$var$handleAndDispatchCustomEvent$1($5cb92bef7577960e$var$POINTER_DOWN_OUTSIDE$1,ue,qe,{discrete:!0})};const qe={originalEvent:Ge};Ge.pointerType==="touch"?(ee.removeEventListener("click",_e.current),_e.current=Ke,ee.addEventListener("click",_e.current,{once:!0})):Ke()}else ee.removeEventListener("click",_e.current);pe.current=!1},Ue=window.setTimeout(()=>{ee.addEventListener("pointerdown",Ne)},0);return()=>{window.clearTimeout(Ue),ee.removeEventListener("pointerdown",Ne),ee.removeEventListener("click",_e.current)}},[ee,ue]),{onPointerDownCapture:()=>pe.current=!0}}function $5cb92bef7577960e$var$useFocusOutside$1(fe,ee=globalThis==null?void 0:globalThis.document){const ue=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(fe),pe=reactExports.useRef(!1);return reactExports.useEffect(()=>{const _e=Ne=>{Ne.target&&!pe.current&&$5cb92bef7577960e$var$handleAndDispatchCustomEvent$1($5cb92bef7577960e$var$FOCUS_OUTSIDE$1,ue,{originalEvent:Ne},{discrete:!1})};return ee.addEventListener("focusin",_e),()=>ee.removeEventListener("focusin",_e)},[ee,ue]),{onFocusCapture:()=>pe.current=!0,onBlurCapture:()=>pe.current=!1}}function $5cb92bef7577960e$var$dispatchUpdate$1(){const fe=new CustomEvent($5cb92bef7577960e$var$CONTEXT_UPDATE$1);document.dispatchEvent(fe)}function $5cb92bef7577960e$var$handleAndDispatchCustomEvent$1(fe,ee,ue,{discrete:pe}){const _e=ue.originalEvent.target,Ne=new CustomEvent(fe,{bubbles:!1,cancelable:!0,detail:ue});ee&&_e.addEventListener(fe,ee,{once:!0}),pe?$8927f6f2acc4f386$export$6d1a0317bde7de7f(_e,Ne):_e.dispatchEvent(Ne)}let $3db38b7d1fb3fe6a$var$count=0;function $3db38b7d1fb3fe6a$export$b7ece24a22aeda8c(){reactExports.useEffect(()=>{var fe,ee;const ue=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",(fe=ue[0])!==null&&fe!==void 0?fe:$3db38b7d1fb3fe6a$var$createFocusGuard()),document.body.insertAdjacentElement("beforeend",(ee=ue[1])!==null&&ee!==void 0?ee:$3db38b7d1fb3fe6a$var$createFocusGuard()),$3db38b7d1fb3fe6a$var$count++,()=>{$3db38b7d1fb3fe6a$var$count===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(pe=>pe.remove()),$3db38b7d1fb3fe6a$var$count--}},[])}function $3db38b7d1fb3fe6a$var$createFocusGuard(){const fe=document.createElement("span");return fe.setAttribute("data-radix-focus-guard",""),fe.tabIndex=0,fe.style.cssText="outline: none; opacity: 0; position: fixed; pointer-events: none",fe}const $d3863c46a17e8a28$var$AUTOFOCUS_ON_MOUNT$1="focusScope.autoFocusOnMount",$d3863c46a17e8a28$var$AUTOFOCUS_ON_UNMOUNT$1="focusScope.autoFocusOnUnmount",$d3863c46a17e8a28$var$EVENT_OPTIONS$1={bubbles:!1,cancelable:!0},$d3863c46a17e8a28$export$20e40289641fbbb6$1=reactExports.forwardRef((fe,ee)=>{const{loop:ue=!1,trapped:pe=!1,onMountAutoFocus:_e,onUnmountAutoFocus:Ne,...Ue}=fe,[Ge,qe]=reactExports.useState(null),Ke=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(_e),Ye=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(Ne),Ze=reactExports.useRef(null),Xe=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(ee,rt=>qe(rt)),Je=reactExports.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;reactExports.useEffect(()=>{if(pe){let rt=function(st){if(Je.paused||!Ge)return;const lt=st.target;Ge.contains(lt)?Ze.current=lt:$d3863c46a17e8a28$var$focus$1(Ze.current,{select:!0})},et=function(st){if(Je.paused||!Ge)return;const lt=st.relatedTarget;lt!==null&&(Ge.contains(lt)||$d3863c46a17e8a28$var$focus$1(Ze.current,{select:!0}))},it=function(st){if(document.activeElement===document.body)for(const _r of st)_r.removedNodes.length>0&&$d3863c46a17e8a28$var$focus$1(Ge)};document.addEventListener("focusin",rt),document.addEventListener("focusout",et);const nt=new MutationObserver(it);return Ge&&nt.observe(Ge,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",rt),document.removeEventListener("focusout",et),nt.disconnect()}}},[pe,Ge,Je.paused]),reactExports.useEffect(()=>{if(Ge){$d3863c46a17e8a28$var$focusScopesStack$1.add(Je);const rt=document.activeElement;if(!Ge.contains(rt)){const it=new CustomEvent($d3863c46a17e8a28$var$AUTOFOCUS_ON_MOUNT$1,$d3863c46a17e8a28$var$EVENT_OPTIONS$1);Ge.addEventListener($d3863c46a17e8a28$var$AUTOFOCUS_ON_MOUNT$1,Ke),Ge.dispatchEvent(it),it.defaultPrevented||($d3863c46a17e8a28$var$focusFirst$1($d3863c46a17e8a28$var$removeLinks$1($d3863c46a17e8a28$var$getTabbableCandidates$1(Ge)),{select:!0}),document.activeElement===rt&&$d3863c46a17e8a28$var$focus$1(Ge))}return()=>{Ge.removeEventListener($d3863c46a17e8a28$var$AUTOFOCUS_ON_MOUNT$1,Ke),setTimeout(()=>{const it=new CustomEvent($d3863c46a17e8a28$var$AUTOFOCUS_ON_UNMOUNT$1,$d3863c46a17e8a28$var$EVENT_OPTIONS$1);Ge.addEventListener($d3863c46a17e8a28$var$AUTOFOCUS_ON_UNMOUNT$1,Ye),Ge.dispatchEvent(it),it.defaultPrevented||$d3863c46a17e8a28$var$focus$1(rt??document.body,{select:!0}),Ge.removeEventListener($d3863c46a17e8a28$var$AUTOFOCUS_ON_UNMOUNT$1,Ye),$d3863c46a17e8a28$var$focusScopesStack$1.remove(Je)},0)}}},[Ge,Ke,Ye,Je]);const tt=reactExports.useCallback(rt=>{if(!ue&&!pe||Je.paused)return;const et=rt.key==="Tab"&&!rt.altKey&&!rt.ctrlKey&&!rt.metaKey,it=document.activeElement;if(et&&it){const nt=rt.currentTarget,[st,lt]=$d3863c46a17e8a28$var$getTabbableEdges$1(nt);st&&lt?!rt.shiftKey&&it===lt?(rt.preventDefault(),ue&&$d3863c46a17e8a28$var$focus$1(st,{select:!0})):rt.shiftKey&&it===st&&(rt.preventDefault(),ue&&$d3863c46a17e8a28$var$focus$1(lt,{select:!0})):it===nt&&rt.preventDefault()}},[ue,pe,Je.paused]);return reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({tabIndex:-1},Ue,{ref:Xe,onKeyDown:tt}))});function $d3863c46a17e8a28$var$focusFirst$1(fe,{select:ee=!1}={}){const ue=document.activeElement;for(const pe of fe)if($d3863c46a17e8a28$var$focus$1(pe,{select:ee}),document.activeElement!==ue)return}function $d3863c46a17e8a28$var$getTabbableEdges$1(fe){const ee=$d3863c46a17e8a28$var$getTabbableCandidates$1(fe),ue=$d3863c46a17e8a28$var$findVisible$1(ee,fe),pe=$d3863c46a17e8a28$var$findVisible$1(ee.reverse(),fe);return[ue,pe]}function $d3863c46a17e8a28$var$getTabbableCandidates$1(fe){const ee=[],ue=document.createTreeWalker(fe,NodeFilter.SHOW_ELEMENT,{acceptNode:pe=>{const _e=pe.tagName==="INPUT"&&pe.type==="hidden";return pe.disabled||pe.hidden||_e?NodeFilter.FILTER_SKIP:pe.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;ue.nextNode();)ee.push(ue.currentNode);return ee}function $d3863c46a17e8a28$var$findVisible$1(fe,ee){for(const ue of fe)if(!$d3863c46a17e8a28$var$isHidden$1(ue,{upTo:ee}))return ue}function $d3863c46a17e8a28$var$isHidden$1(fe,{upTo:ee}){if(getComputedStyle(fe).visibility==="hidden")return!0;for(;fe;){if(ee!==void 0&&fe===ee)return!1;if(getComputedStyle(fe).display==="none")return!0;fe=fe.parentElement}return!1}function $d3863c46a17e8a28$var$isSelectableInput$1(fe){return fe instanceof HTMLInputElement&&"select"in fe}function $d3863c46a17e8a28$var$focus$1(fe,{select:ee=!1}={}){if(fe&&fe.focus){const ue=document.activeElement;fe.focus({preventScroll:!0}),fe!==ue&&$d3863c46a17e8a28$var$isSelectableInput$1(fe)&&ee&&fe.select()}}const $d3863c46a17e8a28$var$focusScopesStack$1=$d3863c46a17e8a28$var$createFocusScopesStack$1();function $d3863c46a17e8a28$var$createFocusScopesStack$1(){let fe=[];return{add(ee){const ue=fe[0];ee!==ue&&(ue==null||ue.pause()),fe=$d3863c46a17e8a28$var$arrayRemove$1(fe,ee),fe.unshift(ee)},remove(ee){var ue;fe=$d3863c46a17e8a28$var$arrayRemove$1(fe,ee),(ue=fe[0])===null||ue===void 0||ue.resume()}}}function $d3863c46a17e8a28$var$arrayRemove$1(fe,ee){const ue=[...fe],pe=ue.indexOf(ee);return pe!==-1&&ue.splice(pe,1),ue}function $d3863c46a17e8a28$var$removeLinks$1(fe){return fe.filter(ee=>ee.tagName!=="A")}const sides=["top","right","bottom","left"],min=Math.min,max=Math.max,round=Math.round,floor=Math.floor,createCoords=fe=>({x:fe,y:fe}),oppositeSideMap={left:"right",right:"left",bottom:"top",top:"bottom"},oppositeAlignmentMap={start:"end",end:"start"};function clamp(fe,ee,ue){return max(fe,min(ee,ue))}function evaluate(fe,ee){return typeof fe=="function"?fe(ee):fe}function getSide(fe){return fe.split("-")[0]}function getAlignment(fe){return fe.split("-")[1]}function getOppositeAxis(fe){return fe==="x"?"y":"x"}function getAxisLength(fe){return fe==="y"?"height":"width"}function getSideAxis(fe){return["top","bottom"].includes(getSide(fe))?"y":"x"}function getAlignmentAxis(fe){return getOppositeAxis(getSideAxis(fe))}function getAlignmentSides(fe,ee,ue){ue===void 0&&(ue=!1);const pe=getAlignment(fe),_e=getAlignmentAxis(fe),Ne=getAxisLength(_e);let Ue=_e==="x"?pe===(ue?"end":"start")?"right":"left":pe==="start"?"bottom":"top";return ee.reference[Ne]>ee.floating[Ne]&&(Ue=getOppositePlacement(Ue)),[Ue,getOppositePlacement(Ue)]}function getExpandedPlacements(fe){const ee=getOppositePlacement(fe);return[getOppositeAlignmentPlacement(fe),ee,getOppositeAlignmentPlacement(ee)]}function getOppositeAlignmentPlacement(fe){return fe.replace(/start|end/g,ee=>oppositeAlignmentMap[ee])}function getSideList(fe,ee,ue){const pe=["left","right"],_e=["right","left"],Ne=["top","bottom"],Ue=["bottom","top"];switch(fe){case"top":case"bottom":return ue?ee?_e:pe:ee?pe:_e;case"left":case"right":return ee?Ne:Ue;default:return[]}}function getOppositeAxisPlacements(fe,ee,ue,pe){const _e=getAlignment(fe);let Ne=getSideList(getSide(fe),ue==="start",pe);return _e&&(Ne=Ne.map(Ue=>Ue+"-"+_e),ee&&(Ne=Ne.concat(Ne.map(getOppositeAlignmentPlacement)))),Ne}function getOppositePlacement(fe){return fe.replace(/left|right|bottom|top/g,ee=>oppositeSideMap[ee])}function expandPaddingObject(fe){return{top:0,right:0,bottom:0,left:0,...fe}}function getPaddingObject(fe){return typeof fe!="number"?expandPaddingObject(fe):{top:fe,right:fe,bottom:fe,left:fe}}function rectToClientRect(fe){return{...fe,top:fe.y,left:fe.x,right:fe.x+fe.width,bottom:fe.y+fe.height}}function computeCoordsFromPlacement(fe,ee,ue){let{reference:pe,floating:_e}=fe;const Ne=getSideAxis(ee),Ue=getAlignmentAxis(ee),Ge=getAxisLength(Ue),qe=getSide(ee),Ke=Ne==="y",Ye=pe.x+pe.width/2-_e.width/2,Ze=pe.y+pe.height/2-_e.height/2,Xe=pe[Ge]/2-_e[Ge]/2;let Je;switch(qe){case"top":Je={x:Ye,y:pe.y-_e.height};break;case"bottom":Je={x:Ye,y:pe.y+pe.height};break;case"right":Je={x:pe.x+pe.width,y:Ze};break;case"left":Je={x:pe.x-_e.width,y:Ze};break;default:Je={x:pe.x,y:pe.y}}switch(getAlignment(ee)){case"start":Je[Ue]-=Xe*(ue&&Ke?-1:1);break;case"end":Je[Ue]+=Xe*(ue&&Ke?-1:1);break}return Je}const computePosition$1=async(fe,ee,ue)=>{const{placement:pe="bottom",strategy:_e="absolute",middleware:Ne=[],platform:Ue}=ue,Ge=Ne.filter(Boolean),qe=await(Ue.isRTL==null?void 0:Ue.isRTL(ee));let Ke=await Ue.getElementRects({reference:fe,floating:ee,strategy:_e}),{x:Ye,y:Ze}=computeCoordsFromPlacement(Ke,pe,qe),Xe=pe,Je={},tt=0;for(let rt=0;rt<Ge.length;rt++){const{name:et,fn:it}=Ge[rt],{x:nt,y:st,data:lt,reset:_r}=await it({x:Ye,y:Ze,initialPlacement:pe,placement:Xe,strategy:_e,middlewareData:Je,rects:Ke,platform:Ue,elements:{reference:fe,floating:ee}});if(Ye=nt??Ye,Ze=st??Ze,Je={...Je,[et]:{...Je[et],...lt}},_r&&tt<=50){tt++,typeof _r=="object"&&(_r.placement&&(Xe=_r.placement),_r.rects&&(Ke=_r.rects===!0?await Ue.getElementRects({reference:fe,floating:ee,strategy:_e}):_r.rects),{x:Ye,y:Ze}=computeCoordsFromPlacement(Ke,Xe,qe)),rt=-1;continue}}return{x:Ye,y:Ze,placement:Xe,strategy:_e,middlewareData:Je}};async function detectOverflow(fe,ee){var ue;ee===void 0&&(ee={});const{x:pe,y:_e,platform:Ne,rects:Ue,elements:Ge,strategy:qe}=fe,{boundary:Ke="clippingAncestors",rootBoundary:Ye="viewport",elementContext:Ze="floating",altBoundary:Xe=!1,padding:Je=0}=evaluate(ee,fe),tt=getPaddingObject(Je),et=Ge[Xe?Ze==="floating"?"reference":"floating":Ze],it=rectToClientRect(await Ne.getClippingRect({element:(ue=await(Ne.isElement==null?void 0:Ne.isElement(et)))==null||ue?et:et.contextElement||await(Ne.getDocumentElement==null?void 0:Ne.getDocumentElement(Ge.floating)),boundary:Ke,rootBoundary:Ye,strategy:qe})),nt=Ze==="floating"?{...Ue.floating,x:pe,y:_e}:Ue.reference,st=await(Ne.getOffsetParent==null?void 0:Ne.getOffsetParent(Ge.floating)),lt=await(Ne.isElement==null?void 0:Ne.isElement(st))?await(Ne.getScale==null?void 0:Ne.getScale(st))||{x:1,y:1}:{x:1,y:1},_r=rectToClientRect(Ne.convertOffsetParentRelativeRectToViewportRelativeRect?await Ne.convertOffsetParentRelativeRectToViewportRelativeRect({rect:nt,offsetParent:st,strategy:qe}):nt);return{top:(it.top-_r.top+tt.top)/lt.y,bottom:(_r.bottom-it.bottom+tt.bottom)/lt.y,left:(it.left-_r.left+tt.left)/lt.x,right:(_r.right-it.right+tt.right)/lt.x}}const arrow$1=fe=>({name:"arrow",options:fe,async fn(ee){const{x:ue,y:pe,placement:_e,rects:Ne,platform:Ue,elements:Ge,middlewareData:qe}=ee,{element:Ke,padding:Ye=0}=evaluate(fe,ee)||{};if(Ke==null)return{};const Ze=getPaddingObject(Ye),Xe={x:ue,y:pe},Je=getAlignmentAxis(_e),tt=getAxisLength(Je),rt=await Ue.getDimensions(Ke),et=Je==="y",it=et?"top":"left",nt=et?"bottom":"right",st=et?"clientHeight":"clientWidth",lt=Ne.reference[tt]+Ne.reference[Je]-Xe[Je]-Ne.floating[tt],_r=Xe[Je]-Ne.reference[Je],jr=await(Ue.getOffsetParent==null?void 0:Ue.getOffsetParent(Ke));let Nr=jr?jr[st]:0;(!Nr||!await(Ue.isElement==null?void 0:Ue.isElement(jr)))&&(Nr=Ge.floating[st]||Ne.floating[tt]);const Wr=lt/2-_r/2,ri=Nr/2-rt[tt]/2-1,Xr=min(Ze[it],ri),Gr=min(Ze[nt],ri),qr=Xr,si=Nr-rt[tt]-Gr,oi=Nr/2-rt[tt]/2+Wr,Yr=clamp(qr,oi,si),ii=!qe.arrow&&getAlignment(_e)!=null&&oi!=Yr&&Ne.reference[tt]/2-(oi<qr?Xr:Gr)-rt[tt]/2<0,ti=ii?oi<qr?oi-qr:oi-si:0;return{[Je]:Xe[Je]+ti,data:{[Je]:Yr,centerOffset:oi-Yr-ti,...ii&&{alignmentOffset:ti}},reset:ii}}}),flip=function(fe){return fe===void 0&&(fe={}),{name:"flip",options:fe,async fn(ee){var ue,pe;const{placement:_e,middlewareData:Ne,rects:Ue,initialPlacement:Ge,platform:qe,elements:Ke}=ee,{mainAxis:Ye=!0,crossAxis:Ze=!0,fallbackPlacements:Xe,fallbackStrategy:Je="bestFit",fallbackAxisSideDirection:tt="none",flipAlignment:rt=!0,...et}=evaluate(fe,ee);if((ue=Ne.arrow)!=null&&ue.alignmentOffset)return{};const it=getSide(_e),nt=getSide(Ge)===Ge,st=await(qe.isRTL==null?void 0:qe.isRTL(Ke.floating)),lt=Xe||(nt||!rt?[getOppositePlacement(Ge)]:getExpandedPlacements(Ge));!Xe&&tt!=="none"&&lt.push(...getOppositeAxisPlacements(Ge,rt,tt,st));const _r=[Ge,...lt],jr=await detectOverflow(ee,et),Nr=[];let Wr=((pe=Ne.flip)==null?void 0:pe.overflows)||[];if(Ye&&Nr.push(jr[it]),Ze){const qr=getAlignmentSides(_e,Ue,st);Nr.push(jr[qr[0]],jr[qr[1]])}if(Wr=[...Wr,{placement:_e,overflows:Nr}],!Nr.every(qr=>qr<=0)){var ri,Xr;const qr=(((ri=Ne.flip)==null?void 0:ri.index)||0)+1,si=_r[qr];if(si)return{data:{index:qr,overflows:Wr},reset:{placement:si}};let oi=(Xr=Wr.filter(Yr=>Yr.overflows[0]<=0).sort((Yr,ii)=>Yr.overflows[1]-ii.overflows[1])[0])==null?void 0:Xr.placement;if(!oi)switch(Je){case"bestFit":{var Gr;const Yr=(Gr=Wr.map(ii=>[ii.placement,ii.overflows.filter(ti=>ti>0).reduce((ti,ni)=>ti+ni,0)]).sort((ii,ti)=>ii[1]-ti[1])[0])==null?void 0:Gr[0];Yr&&(oi=Yr);break}case"initialPlacement":oi=Ge;break}if(_e!==oi)return{reset:{placement:oi}}}return{}}}};function getSideOffsets(fe,ee){return{top:fe.top-ee.height,right:fe.right-ee.width,bottom:fe.bottom-ee.height,left:fe.left-ee.width}}function isAnySideFullyClipped(fe){return sides.some(ee=>fe[ee]>=0)}const hide=function(fe){return fe===void 0&&(fe={}),{name:"hide",options:fe,async fn(ee){const{rects:ue}=ee,{strategy:pe="referenceHidden",..._e}=evaluate(fe,ee);switch(pe){case"referenceHidden":{const Ne=await detectOverflow(ee,{..._e,elementContext:"reference"}),Ue=getSideOffsets(Ne,ue.reference);return{data:{referenceHiddenOffsets:Ue,referenceHidden:isAnySideFullyClipped(Ue)}}}case"escaped":{const Ne=await detectOverflow(ee,{..._e,altBoundary:!0}),Ue=getSideOffsets(Ne,ue.floating);return{data:{escapedOffsets:Ue,escaped:isAnySideFullyClipped(Ue)}}}default:return{}}}}};async function convertValueToCoords(fe,ee){const{placement:ue,platform:pe,elements:_e}=fe,Ne=await(pe.isRTL==null?void 0:pe.isRTL(_e.floating)),Ue=getSide(ue),Ge=getAlignment(ue),qe=getSideAxis(ue)==="y",Ke=["left","top"].includes(Ue)?-1:1,Ye=Ne&&qe?-1:1,Ze=evaluate(ee,fe);let{mainAxis:Xe,crossAxis:Je,alignmentAxis:tt}=typeof Ze=="number"?{mainAxis:Ze,crossAxis:0,alignmentAxis:null}:{mainAxis:0,crossAxis:0,alignmentAxis:null,...Ze};return Ge&&typeof tt=="number"&&(Je=Ge==="end"?tt*-1:tt),qe?{x:Je*Ye,y:Xe*Ke}:{x:Xe*Ke,y:Je*Ye}}const offset=function(fe){return fe===void 0&&(fe=0),{name:"offset",options:fe,async fn(ee){const{x:ue,y:pe}=ee,_e=await convertValueToCoords(ee,fe);return{x:ue+_e.x,y:pe+_e.y,data:_e}}}},shift=function(fe){return fe===void 0&&(fe={}),{name:"shift",options:fe,async fn(ee){const{x:ue,y:pe,placement:_e}=ee,{mainAxis:Ne=!0,crossAxis:Ue=!1,limiter:Ge={fn:et=>{let{x:it,y:nt}=et;return{x:it,y:nt}}},...qe}=evaluate(fe,ee),Ke={x:ue,y:pe},Ye=await detectOverflow(ee,qe),Ze=getSideAxis(getSide(_e)),Xe=getOppositeAxis(Ze);let Je=Ke[Xe],tt=Ke[Ze];if(Ne){const et=Xe==="y"?"top":"left",it=Xe==="y"?"bottom":"right",nt=Je+Ye[et],st=Je-Ye[it];Je=clamp(nt,Je,st)}if(Ue){const et=Ze==="y"?"top":"left",it=Ze==="y"?"bottom":"right",nt=tt+Ye[et],st=tt-Ye[it];tt=clamp(nt,tt,st)}const rt=Ge.fn({...ee,[Xe]:Je,[Ze]:tt});return{...rt,data:{x:rt.x-ue,y:rt.y-pe}}}}},limitShift=function(fe){return fe===void 0&&(fe={}),{options:fe,fn(ee){const{x:ue,y:pe,placement:_e,rects:Ne,middlewareData:Ue}=ee,{offset:Ge=0,mainAxis:qe=!0,crossAxis:Ke=!0}=evaluate(fe,ee),Ye={x:ue,y:pe},Ze=getSideAxis(_e),Xe=getOppositeAxis(Ze);let Je=Ye[Xe],tt=Ye[Ze];const rt=evaluate(Ge,ee),et=typeof rt=="number"?{mainAxis:rt,crossAxis:0}:{mainAxis:0,crossAxis:0,...rt};if(qe){const st=Xe==="y"?"height":"width",lt=Ne.reference[Xe]-Ne.floating[st]+et.mainAxis,_r=Ne.reference[Xe]+Ne.reference[st]-et.mainAxis;Je<lt?Je=lt:Je>_r&&(Je=_r)}if(Ke){var it,nt;const st=Xe==="y"?"width":"height",lt=["top","left"].includes(getSide(_e)),_r=Ne.reference[Ze]-Ne.floating[st]+(lt&&((it=Ue.offset)==null?void 0:it[Ze])||0)+(lt?0:et.crossAxis),jr=Ne.reference[Ze]+Ne.reference[st]+(lt?0:((nt=Ue.offset)==null?void 0:nt[Ze])||0)-(lt?et.crossAxis:0);tt<_r?tt=_r:tt>jr&&(tt=jr)}return{[Xe]:Je,[Ze]:tt}}}},size=function(fe){return fe===void 0&&(fe={}),{name:"size",options:fe,async fn(ee){const{placement:ue,rects:pe,platform:_e,elements:Ne}=ee,{apply:Ue=()=>{},...Ge}=evaluate(fe,ee),qe=await detectOverflow(ee,Ge),Ke=getSide(ue),Ye=getAlignment(ue),Ze=getSideAxis(ue)==="y",{width:Xe,height:Je}=pe.floating;let tt,rt;Ke==="top"||Ke==="bottom"?(tt=Ke,rt=Ye===(await(_e.isRTL==null?void 0:_e.isRTL(Ne.floating))?"start":"end")?"left":"right"):(rt=Ke,tt=Ye==="end"?"top":"bottom");const et=Je-qe[tt],it=Xe-qe[rt],nt=!ee.middlewareData.shift;let st=et,lt=it;if(Ze){const jr=Xe-qe.left-qe.right;lt=Ye||nt?min(it,jr):jr}else{const jr=Je-qe.top-qe.bottom;st=Ye||nt?min(et,jr):jr}if(nt&&!Ye){const jr=max(qe.left,0),Nr=max(qe.right,0),Wr=max(qe.top,0),ri=max(qe.bottom,0);Ze?lt=Xe-2*(jr!==0||Nr!==0?jr+Nr:max(qe.left,qe.right)):st=Je-2*(Wr!==0||ri!==0?Wr+ri:max(qe.top,qe.bottom))}await Ue({...ee,availableWidth:lt,availableHeight:st});const _r=await _e.getDimensions(Ne.floating);return Xe!==_r.width||Je!==_r.height?{reset:{rects:!0}}:{}}}};function getNodeName(fe){return isNode(fe)?(fe.nodeName||"").toLowerCase():"#document"}function getWindow(fe){var ee;return(fe==null||(ee=fe.ownerDocument)==null?void 0:ee.defaultView)||window}function getDocumentElement(fe){var ee;return(ee=(isNode(fe)?fe.ownerDocument:fe.document)||window.document)==null?void 0:ee.documentElement}function isNode(fe){return fe instanceof Node||fe instanceof getWindow(fe).Node}function isElement(fe){return fe instanceof Element||fe instanceof getWindow(fe).Element}function isHTMLElement(fe){return fe instanceof HTMLElement||fe instanceof getWindow(fe).HTMLElement}function isShadowRoot(fe){return typeof ShadowRoot>"u"?!1:fe instanceof ShadowRoot||fe instanceof getWindow(fe).ShadowRoot}function isOverflowElement(fe){const{overflow:ee,overflowX:ue,overflowY:pe,display:_e}=getComputedStyle$1(fe);return/auto|scroll|overlay|hidden|clip/.test(ee+pe+ue)&&!["inline","contents"].includes(_e)}function isTableElement(fe){return["table","td","th"].includes(getNodeName(fe))}function isContainingBlock(fe){const ee=isWebKit(),ue=getComputedStyle$1(fe);return ue.transform!=="none"||ue.perspective!=="none"||(ue.containerType?ue.containerType!=="normal":!1)||!ee&&(ue.backdropFilter?ue.backdropFilter!=="none":!1)||!ee&&(ue.filter?ue.filter!=="none":!1)||["transform","perspective","filter"].some(pe=>(ue.willChange||"").includes(pe))||["paint","layout","strict","content"].some(pe=>(ue.contain||"").includes(pe))}function getContainingBlock(fe){let ee=getParentNode(fe);for(;isHTMLElement(ee)&&!isLastTraversableNode(ee);){if(isContainingBlock(ee))return ee;ee=getParentNode(ee)}return null}function isWebKit(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function isLastTraversableNode(fe){return["html","body","#document"].includes(getNodeName(fe))}function getComputedStyle$1(fe){return getWindow(fe).getComputedStyle(fe)}function getNodeScroll(fe){return isElement(fe)?{scrollLeft:fe.scrollLeft,scrollTop:fe.scrollTop}:{scrollLeft:fe.pageXOffset,scrollTop:fe.pageYOffset}}function getParentNode(fe){if(getNodeName(fe)==="html")return fe;const ee=fe.assignedSlot||fe.parentNode||isShadowRoot(fe)&&fe.host||getDocumentElement(fe);return isShadowRoot(ee)?ee.host:ee}function getNearestOverflowAncestor(fe){const ee=getParentNode(fe);return isLastTraversableNode(ee)?fe.ownerDocument?fe.ownerDocument.body:fe.body:isHTMLElement(ee)&&isOverflowElement(ee)?ee:getNearestOverflowAncestor(ee)}function getOverflowAncestors(fe,ee,ue){var pe;ee===void 0&&(ee=[]),ue===void 0&&(ue=!0);const _e=getNearestOverflowAncestor(fe),Ne=_e===((pe=fe.ownerDocument)==null?void 0:pe.body),Ue=getWindow(_e);return Ne?ee.concat(Ue,Ue.visualViewport||[],isOverflowElement(_e)?_e:[],Ue.frameElement&&ue?getOverflowAncestors(Ue.frameElement):[]):ee.concat(_e,getOverflowAncestors(_e,[],ue))}function getCssDimensions(fe){const ee=getComputedStyle$1(fe);let ue=parseFloat(ee.width)||0,pe=parseFloat(ee.height)||0;const _e=isHTMLElement(fe),Ne=_e?fe.offsetWidth:ue,Ue=_e?fe.offsetHeight:pe,Ge=round(ue)!==Ne||round(pe)!==Ue;return Ge&&(ue=Ne,pe=Ue),{width:ue,height:pe,$:Ge}}function unwrapElement(fe){return isElement(fe)?fe:fe.contextElement}function getScale(fe){const ee=unwrapElement(fe);if(!isHTMLElement(ee))return createCoords(1);const ue=ee.getBoundingClientRect(),{width:pe,height:_e,$:Ne}=getCssDimensions(ee);let Ue=(Ne?round(ue.width):ue.width)/pe,Ge=(Ne?round(ue.height):ue.height)/_e;return(!Ue||!Number.isFinite(Ue))&&(Ue=1),(!Ge||!Number.isFinite(Ge))&&(Ge=1),{x:Ue,y:Ge}}const noOffsets=createCoords(0);function getVisualOffsets(fe){const ee=getWindow(fe);return!isWebKit()||!ee.visualViewport?noOffsets:{x:ee.visualViewport.offsetLeft,y:ee.visualViewport.offsetTop}}function shouldAddVisualOffsets(fe,ee,ue){return ee===void 0&&(ee=!1),!ue||ee&&ue!==getWindow(fe)?!1:ee}function getBoundingClientRect(fe,ee,ue,pe){ee===void 0&&(ee=!1),ue===void 0&&(ue=!1);const _e=fe.getBoundingClientRect(),Ne=unwrapElement(fe);let Ue=createCoords(1);ee&&(pe?isElement(pe)&&(Ue=getScale(pe)):Ue=getScale(fe));const Ge=shouldAddVisualOffsets(Ne,ue,pe)?getVisualOffsets(Ne):createCoords(0);let qe=(_e.left+Ge.x)/Ue.x,Ke=(_e.top+Ge.y)/Ue.y,Ye=_e.width/Ue.x,Ze=_e.height/Ue.y;if(Ne){const Xe=getWindow(Ne),Je=pe&&isElement(pe)?getWindow(pe):pe;let tt=Xe.frameElement;for(;tt&&pe&&Je!==Xe;){const rt=getScale(tt),et=tt.getBoundingClientRect(),it=getComputedStyle$1(tt),nt=et.left+(tt.clientLeft+parseFloat(it.paddingLeft))*rt.x,st=et.top+(tt.clientTop+parseFloat(it.paddingTop))*rt.y;qe*=rt.x,Ke*=rt.y,Ye*=rt.x,Ze*=rt.y,qe+=nt,Ke+=st,tt=getWindow(tt).frameElement}}return rectToClientRect({width:Ye,height:Ze,x:qe,y:Ke})}function convertOffsetParentRelativeRectToViewportRelativeRect(fe){let{rect:ee,offsetParent:ue,strategy:pe}=fe;const _e=isHTMLElement(ue),Ne=getDocumentElement(ue);if(ue===Ne)return ee;let Ue={scrollLeft:0,scrollTop:0},Ge=createCoords(1);const qe=createCoords(0);if((_e||!_e&&pe!=="fixed")&&((getNodeName(ue)!=="body"||isOverflowElement(Ne))&&(Ue=getNodeScroll(ue)),isHTMLElement(ue))){const Ke=getBoundingClientRect(ue);Ge=getScale(ue),qe.x=Ke.x+ue.clientLeft,qe.y=Ke.y+ue.clientTop}return{width:ee.width*Ge.x,height:ee.height*Ge.y,x:ee.x*Ge.x-Ue.scrollLeft*Ge.x+qe.x,y:ee.y*Ge.y-Ue.scrollTop*Ge.y+qe.y}}function getClientRects(fe){return Array.from(fe.getClientRects())}function getWindowScrollBarX(fe){return getBoundingClientRect(getDocumentElement(fe)).left+getNodeScroll(fe).scrollLeft}function getDocumentRect(fe){const ee=getDocumentElement(fe),ue=getNodeScroll(fe),pe=fe.ownerDocument.body,_e=max(ee.scrollWidth,ee.clientWidth,pe.scrollWidth,pe.clientWidth),Ne=max(ee.scrollHeight,ee.clientHeight,pe.scrollHeight,pe.clientHeight);let Ue=-ue.scrollLeft+getWindowScrollBarX(fe);const Ge=-ue.scrollTop;return getComputedStyle$1(pe).direction==="rtl"&&(Ue+=max(ee.clientWidth,pe.clientWidth)-_e),{width:_e,height:Ne,x:Ue,y:Ge}}function getViewportRect(fe,ee){const ue=getWindow(fe),pe=getDocumentElement(fe),_e=ue.visualViewport;let Ne=pe.clientWidth,Ue=pe.clientHeight,Ge=0,qe=0;if(_e){Ne=_e.width,Ue=_e.height;const Ke=isWebKit();(!Ke||Ke&&ee==="fixed")&&(Ge=_e.offsetLeft,qe=_e.offsetTop)}return{width:Ne,height:Ue,x:Ge,y:qe}}function getInnerBoundingClientRect(fe,ee){const ue=getBoundingClientRect(fe,!0,ee==="fixed"),pe=ue.top+fe.clientTop,_e=ue.left+fe.clientLeft,Ne=isHTMLElement(fe)?getScale(fe):createCoords(1),Ue=fe.clientWidth*Ne.x,Ge=fe.clientHeight*Ne.y,qe=_e*Ne.x,Ke=pe*Ne.y;return{width:Ue,height:Ge,x:qe,y:Ke}}function getClientRectFromClippingAncestor(fe,ee,ue){let pe;if(ee==="viewport")pe=getViewportRect(fe,ue);else if(ee==="document")pe=getDocumentRect(getDocumentElement(fe));else if(isElement(ee))pe=getInnerBoundingClientRect(ee,ue);else{const _e=getVisualOffsets(fe);pe={...ee,x:ee.x-_e.x,y:ee.y-_e.y}}return rectToClientRect(pe)}function hasFixedPositionAncestor(fe,ee){const ue=getParentNode(fe);return ue===ee||!isElement(ue)||isLastTraversableNode(ue)?!1:getComputedStyle$1(ue).position==="fixed"||hasFixedPositionAncestor(ue,ee)}function getClippingElementAncestors(fe,ee){const ue=ee.get(fe);if(ue)return ue;let pe=getOverflowAncestors(fe,[],!1).filter(Ge=>isElement(Ge)&&getNodeName(Ge)!=="body"),_e=null;const Ne=getComputedStyle$1(fe).position==="fixed";let Ue=Ne?getParentNode(fe):fe;for(;isElement(Ue)&&!isLastTraversableNode(Ue);){const Ge=getComputedStyle$1(Ue),qe=isContainingBlock(Ue);!qe&&Ge.position==="fixed"&&(_e=null),(Ne?!qe&&!_e:!qe&&Ge.position==="static"&&!!_e&&["absolute","fixed"].includes(_e.position)||isOverflowElement(Ue)&&!qe&&hasFixedPositionAncestor(fe,Ue))?pe=pe.filter(Ye=>Ye!==Ue):_e=Ge,Ue=getParentNode(Ue)}return ee.set(fe,pe),pe}function getClippingRect(fe){let{element:ee,boundary:ue,rootBoundary:pe,strategy:_e}=fe;const Ue=[...ue==="clippingAncestors"?getClippingElementAncestors(ee,this._c):[].concat(ue),pe],Ge=Ue[0],qe=Ue.reduce((Ke,Ye)=>{const Ze=getClientRectFromClippingAncestor(ee,Ye,_e);return Ke.top=max(Ze.top,Ke.top),Ke.right=min(Ze.right,Ke.right),Ke.bottom=min(Ze.bottom,Ke.bottom),Ke.left=max(Ze.left,Ke.left),Ke},getClientRectFromClippingAncestor(ee,Ge,_e));return{width:qe.right-qe.left,height:qe.bottom-qe.top,x:qe.left,y:qe.top}}function getDimensions(fe){return getCssDimensions(fe)}function getRectRelativeToOffsetParent(fe,ee,ue){const pe=isHTMLElement(ee),_e=getDocumentElement(ee),Ne=ue==="fixed",Ue=getBoundingClientRect(fe,!0,Ne,ee);let Ge={scrollLeft:0,scrollTop:0};const qe=createCoords(0);if(pe||!pe&&!Ne)if((getNodeName(ee)!=="body"||isOverflowElement(_e))&&(Ge=getNodeScroll(ee)),pe){const Ke=getBoundingClientRect(ee,!0,Ne,ee);qe.x=Ke.x+ee.clientLeft,qe.y=Ke.y+ee.clientTop}else _e&&(qe.x=getWindowScrollBarX(_e));return{x:Ue.left+Ge.scrollLeft-qe.x,y:Ue.top+Ge.scrollTop-qe.y,width:Ue.width,height:Ue.height}}function getTrueOffsetParent(fe,ee){return!isHTMLElement(fe)||getComputedStyle$1(fe).position==="fixed"?null:ee?ee(fe):fe.offsetParent}function getOffsetParent(fe,ee){const ue=getWindow(fe);if(!isHTMLElement(fe))return ue;let pe=getTrueOffsetParent(fe,ee);for(;pe&&isTableElement(pe)&&getComputedStyle$1(pe).position==="static";)pe=getTrueOffsetParent(pe,ee);return pe&&(getNodeName(pe)==="html"||getNodeName(pe)==="body"&&getComputedStyle$1(pe).position==="static"&&!isContainingBlock(pe))?ue:pe||getContainingBlock(fe)||ue}const getElementRects=async function(fe){let{reference:ee,floating:ue,strategy:pe}=fe;const _e=this.getOffsetParent||getOffsetParent,Ne=this.getDimensions;return{reference:getRectRelativeToOffsetParent(ee,await _e(ue),pe),floating:{x:0,y:0,...await Ne(ue)}}};function isRTL(fe){return getComputedStyle$1(fe).direction==="rtl"}const platform={convertOffsetParentRelativeRectToViewportRelativeRect,getDocumentElement,getClippingRect,getOffsetParent,getElementRects,getClientRects,getDimensions,getScale,isElement,isRTL};function observeMove(fe,ee){let ue=null,pe;const _e=getDocumentElement(fe);function Ne(){clearTimeout(pe),ue&&ue.disconnect(),ue=null}function Ue(Ge,qe){Ge===void 0&&(Ge=!1),qe===void 0&&(qe=1),Ne();const{left:Ke,top:Ye,width:Ze,height:Xe}=fe.getBoundingClientRect();if(Ge||ee(),!Ze||!Xe)return;const Je=floor(Ye),tt=floor(_e.clientWidth-(Ke+Ze)),rt=floor(_e.clientHeight-(Ye+Xe)),et=floor(Ke),nt={rootMargin:-Je+"px "+-tt+"px "+-rt+"px "+-et+"px",threshold:max(0,min(1,qe))||1};let st=!0;function lt(_r){const jr=_r[0].intersectionRatio;if(jr!==qe){if(!st)return Ue();jr?Ue(!1,jr):pe=setTimeout(()=>{Ue(!1,1e-7)},100)}st=!1}try{ue=new IntersectionObserver(lt,{...nt,root:_e.ownerDocument})}catch{ue=new IntersectionObserver(lt,nt)}ue.observe(fe)}return Ue(!0),Ne}function autoUpdate(fe,ee,ue,pe){pe===void 0&&(pe={});const{ancestorScroll:_e=!0,ancestorResize:Ne=!0,elementResize:Ue=typeof ResizeObserver=="function",layoutShift:Ge=typeof IntersectionObserver=="function",animationFrame:qe=!1}=pe,Ke=unwrapElement(fe),Ye=_e||Ne?[...Ke?getOverflowAncestors(Ke):[],...getOverflowAncestors(ee)]:[];Ye.forEach(it=>{_e&&it.addEventListener("scroll",ue,{passive:!0}),Ne&&it.addEventListener("resize",ue)});const Ze=Ke&&Ge?observeMove(Ke,ue):null;let Xe=-1,Je=null;Ue&&(Je=new ResizeObserver(it=>{let[nt]=it;nt&&nt.target===Ke&&Je&&(Je.unobserve(ee),cancelAnimationFrame(Xe),Xe=requestAnimationFrame(()=>{Je&&Je.observe(ee)})),ue()}),Ke&&!qe&&Je.observe(Ke),Je.observe(ee));let tt,rt=qe?getBoundingClientRect(fe):null;qe&&et();function et(){const it=getBoundingClientRect(fe);rt&&(it.x!==rt.x||it.y!==rt.y||it.width!==rt.width||it.height!==rt.height)&&ue(),rt=it,tt=requestAnimationFrame(et)}return ue(),()=>{Ye.forEach(it=>{_e&&it.removeEventListener("scroll",ue),Ne&&it.removeEventListener("resize",ue)}),Ze&&Ze(),Je&&Je.disconnect(),Je=null,qe&&cancelAnimationFrame(tt)}}const computePosition=(fe,ee,ue)=>{const pe=new Map,_e={platform,...ue},Ne={..._e.platform,_c:pe};return computePosition$1(fe,ee,{..._e,platform:Ne})},arrow=fe=>{function ee(ue){return{}.hasOwnProperty.call(ue,"current")}return{name:"arrow",options:fe,fn(ue){const{element:pe,padding:_e}=typeof fe=="function"?fe(ue):fe;return pe&&ee(pe)?pe.current!=null?arrow$1({element:pe.current,padding:_e}).fn(ue):{}:pe?arrow$1({element:pe,padding:_e}).fn(ue):{}}}};var index=typeof document<"u"?reactExports.useLayoutEffect:reactExports.useEffect;function deepEqual(fe,ee){if(fe===ee)return!0;if(typeof fe!=typeof ee)return!1;if(typeof fe=="function"&&fe.toString()===ee.toString())return!0;let ue,pe,_e;if(fe&&ee&&typeof fe=="object"){if(Array.isArray(fe)){if(ue=fe.length,ue!=ee.length)return!1;for(pe=ue;pe--!==0;)if(!deepEqual(fe[pe],ee[pe]))return!1;return!0}if(_e=Object.keys(fe),ue=_e.length,ue!==Object.keys(ee).length)return!1;for(pe=ue;pe--!==0;)if(!{}.hasOwnProperty.call(ee,_e[pe]))return!1;for(pe=ue;pe--!==0;){const Ne=_e[pe];if(!(Ne==="_owner"&&fe.$$typeof)&&!deepEqual(fe[Ne],ee[Ne]))return!1}return!0}return fe!==fe&&ee!==ee}function getDPR(fe){return typeof window>"u"?1:(fe.ownerDocument.defaultView||window).devicePixelRatio||1}function roundByDPR(fe,ee){const ue=getDPR(fe);return Math.round(ee*ue)/ue}function useLatestRef(fe){const ee=reactExports.useRef(fe);return index(()=>{ee.current=fe}),ee}function useFloating(fe){fe===void 0&&(fe={});const{placement:ee="bottom",strategy:ue="absolute",middleware:pe=[],platform:_e,elements:{reference:Ne,floating:Ue}={},transform:Ge=!0,whileElementsMounted:qe,open:Ke}=fe,[Ye,Ze]=reactExports.useState({x:0,y:0,strategy:ue,placement:ee,middlewareData:{},isPositioned:!1}),[Xe,Je]=reactExports.useState(pe);deepEqual(Xe,pe)||Je(pe);const[tt,rt]=reactExports.useState(null),[et,it]=reactExports.useState(null),nt=reactExports.useCallback(ii=>{ii!=jr.current&&(jr.current=ii,rt(ii))},[rt]),st=reactExports.useCallback(ii=>{ii!==Nr.current&&(Nr.current=ii,it(ii))},[it]),lt=Ne||tt,_r=Ue||et,jr=reactExports.useRef(null),Nr=reactExports.useRef(null),Wr=reactExports.useRef(Ye),ri=useLatestRef(qe),Xr=useLatestRef(_e),Gr=reactExports.useCallback(()=>{if(!jr.current||!Nr.current)return;const ii={placement:ee,strategy:ue,middleware:Xe};Xr.current&&(ii.platform=Xr.current),computePosition(jr.current,Nr.current,ii).then(ti=>{const ni={...ti,isPositioned:!0};qr.current&&!deepEqual(Wr.current,ni)&&(Wr.current=ni,reactDomExports.flushSync(()=>{Ze(ni)}))})},[Xe,ee,ue,Xr]);index(()=>{Ke===!1&&Wr.current.isPositioned&&(Wr.current.isPositioned=!1,Ze(ii=>({...ii,isPositioned:!1})))},[Ke]);const qr=reactExports.useRef(!1);index(()=>(qr.current=!0,()=>{qr.current=!1}),[]),index(()=>{if(lt&&(jr.current=lt),_r&&(Nr.current=_r),lt&&_r){if(ri.current)return ri.current(lt,_r,Gr);Gr()}},[lt,_r,Gr,ri]);const si=reactExports.useMemo(()=>({reference:jr,floating:Nr,setReference:nt,setFloating:st}),[nt,st]),oi=reactExports.useMemo(()=>({reference:lt,floating:_r}),[lt,_r]),Yr=reactExports.useMemo(()=>{const ii={position:ue,left:0,top:0};if(!oi.floating)return ii;const ti=roundByDPR(oi.floating,Ye.x),ni=roundByDPR(oi.floating,Ye.y);return Ge?{...ii,transform:"translate("+ti+"px, "+ni+"px)",...getDPR(oi.floating)>=1.5&&{willChange:"transform"}}:{position:ue,left:ti,top:ni}},[ue,Ge,oi.floating,Ye.x,Ye.y]);return reactExports.useMemo(()=>({...Ye,update:Gr,refs:si,elements:oi,floatingStyles:Yr}),[Ye,Gr,si,oi,Yr])}const $7e8f5cd07187803e$export$21b07c8f274aebd5=reactExports.forwardRef((fe,ee)=>{const{children:ue,width:pe=10,height:_e=5,...Ne}=fe;return reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.svg,_extends$1({},Ne,{ref:ee,width:pe,height:_e,viewBox:"0 0 30 10",preserveAspectRatio:"none"}),fe.asChild?ue:reactExports.createElement("polygon",{points:"0,0 30,0 15,10"}))}),$7e8f5cd07187803e$export$be92b6f5f03c0fe9=$7e8f5cd07187803e$export$21b07c8f274aebd5,$cf1ac5d9fe0e8206$var$POPPER_NAME$1="Popper",[$cf1ac5d9fe0e8206$var$createPopperContext$1,$cf1ac5d9fe0e8206$export$722aac194ae923$1]=$c512c27ab02ef895$export$50c7b4e9d9f19c1($cf1ac5d9fe0e8206$var$POPPER_NAME$1),[$cf1ac5d9fe0e8206$var$PopperProvider$1,$cf1ac5d9fe0e8206$var$usePopperContext$1]=$cf1ac5d9fe0e8206$var$createPopperContext$1($cf1ac5d9fe0e8206$var$POPPER_NAME$1),$cf1ac5d9fe0e8206$export$badac9ada3a0bdf9$1=fe=>{const{__scopePopper:ee,children:ue}=fe,[pe,_e]=reactExports.useState(null);return reactExports.createElement($cf1ac5d9fe0e8206$var$PopperProvider$1,{scope:ee,anchor:pe,onAnchorChange:_e},ue)},$cf1ac5d9fe0e8206$var$ANCHOR_NAME$1="PopperAnchor",$cf1ac5d9fe0e8206$export$ecd4e1ccab6ed6d$1=reactExports.forwardRef((fe,ee)=>{const{__scopePopper:ue,virtualRef:pe,..._e}=fe,Ne=$cf1ac5d9fe0e8206$var$usePopperContext$1($cf1ac5d9fe0e8206$var$ANCHOR_NAME$1,ue),Ue=reactExports.useRef(null),Ge=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(ee,Ue);return reactExports.useEffect(()=>{Ne.onAnchorChange((pe==null?void 0:pe.current)||Ue.current)}),pe?null:reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({},_e,{ref:Ge}))}),$cf1ac5d9fe0e8206$var$CONTENT_NAME$1="PopperContent",[$cf1ac5d9fe0e8206$var$PopperContentProvider$1,$cf1ac5d9fe0e8206$var$useContentContext$1]=$cf1ac5d9fe0e8206$var$createPopperContext$1($cf1ac5d9fe0e8206$var$CONTENT_NAME$1),$cf1ac5d9fe0e8206$export$bc4ae5855d3c4fc$1=reactExports.forwardRef((fe,ee)=>{var ue,pe,_e,Ne,Ue,Ge,qe,Ke;const{__scopePopper:Ye,side:Ze="bottom",sideOffset:Xe=0,align:Je="center",alignOffset:tt=0,arrowPadding:rt=0,avoidCollisions:et=!0,collisionBoundary:it=[],collisionPadding:nt=0,sticky:st="partial",hideWhenDetached:lt=!1,updatePositionStrategy:_r="optimized",onPlaced:jr,...Nr}=fe,Wr=$cf1ac5d9fe0e8206$var$usePopperContext$1($cf1ac5d9fe0e8206$var$CONTENT_NAME$1,Ye),[ri,Xr]=reactExports.useState(null),Gr=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(ee,ai=>Xr(ai)),[qr,si]=reactExports.useState(null),oi=$db6c3485150b8e66$export$1ab7ae714698c4b8(qr),Yr=(ue=oi==null?void 0:oi.width)!==null&&ue!==void 0?ue:0,ii=(pe=oi==null?void 0:oi.height)!==null&&pe!==void 0?pe:0,ti=Ze+(Je!=="center"?"-"+Je:""),ni=typeof nt=="number"?nt:{top:0,right:0,bottom:0,left:0,...nt},ui=Array.isArray(it)?it:[it],yi=ui.length>0,hi={padding:ni,boundary:ui.filter($cf1ac5d9fe0e8206$var$isNotNull$1),altBoundary:yi},{refs:pi,floatingStyles:Ri,placement:Ei,isPositioned:bi,middlewareData:_i}=useFloating({strategy:"fixed",placement:ti,whileElementsMounted:(...ai)=>autoUpdate(...ai,{animationFrame:_r==="always"}),elements:{reference:Wr.anchor},middleware:[offset({mainAxis:Xe+ii,alignmentAxis:tt}),et&&shift({mainAxis:!0,crossAxis:!1,limiter:st==="partial"?limitShift():void 0,...hi}),et&&flip({...hi}),size({...hi,apply:({elements:ai,rects:li,availableWidth:ci,availableHeight:Ci})=>{const{width:mi,height:Ii}=li.reference,Ni=ai.floating.style;Ni.setProperty("--radix-popper-available-width",`${ci}px`),Ni.setProperty("--radix-popper-available-height",`${Ci}px`),Ni.setProperty("--radix-popper-anchor-width",`${mi}px`),Ni.setProperty("--radix-popper-anchor-height",`${Ii}px`)}}),qr&&arrow({element:qr,padding:rt}),$cf1ac5d9fe0e8206$var$transformOrigin$1({arrowWidth:Yr,arrowHeight:ii}),lt&&hide({strategy:"referenceHidden",...hi})]}),[vi,Ti]=$cf1ac5d9fe0e8206$var$getSideAndAlignFromPlacement$1(Ei),Fi=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(jr);$9f79659886946c16$export$e5c5a5f917a5871c(()=>{bi&&(Fi==null||Fi())},[bi,Fi]);const Li=(_e=_i.arrow)===null||_e===void 0?void 0:_e.x,Di=(Ne=_i.arrow)===null||Ne===void 0?void 0:Ne.y,Oi=((Ue=_i.arrow)===null||Ue===void 0?void 0:Ue.centerOffset)!==0,[ot,Ur]=reactExports.useState();return $9f79659886946c16$export$e5c5a5f917a5871c(()=>{ri&&Ur(window.getComputedStyle(ri).zIndex)},[ri]),reactExports.createElement("div",{ref:pi.setFloating,"data-radix-popper-content-wrapper":"",style:{...Ri,transform:bi?Ri.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:ot,"--radix-popper-transform-origin":[(Ge=_i.transformOrigin)===null||Ge===void 0?void 0:Ge.x,(qe=_i.transformOrigin)===null||qe===void 0?void 0:qe.y].join(" ")},dir:fe.dir},reactExports.createElement($cf1ac5d9fe0e8206$var$PopperContentProvider$1,{scope:Ye,placedSide:vi,onArrowChange:si,arrowX:Li,arrowY:Di,shouldHideArrow:Oi},reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({"data-side":vi,"data-align":Ti},Nr,{ref:Gr,style:{...Nr.style,animation:bi?void 0:"none",opacity:(Ke=_i.hide)!==null&&Ke!==void 0&&Ke.referenceHidden?0:void 0}}))))}),$cf1ac5d9fe0e8206$var$ARROW_NAME="PopperArrow",$cf1ac5d9fe0e8206$var$OPPOSITE_SIDE={top:"bottom",right:"left",bottom:"top",left:"right"},$cf1ac5d9fe0e8206$export$79d62cd4e10a3fd0=reactExports.forwardRef(function(ee,ue){const{__scopePopper:pe,..._e}=ee,Ne=$cf1ac5d9fe0e8206$var$useContentContext$1($cf1ac5d9fe0e8206$var$ARROW_NAME,pe),Ue=$cf1ac5d9fe0e8206$var$OPPOSITE_SIDE[Ne.placedSide];return reactExports.createElement("span",{ref:Ne.onArrowChange,style:{position:"absolute",left:Ne.arrowX,top:Ne.arrowY,[Ue]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[Ne.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[Ne.placedSide],visibility:Ne.shouldHideArrow?"hidden":void 0}},reactExports.createElement($7e8f5cd07187803e$export$be92b6f5f03c0fe9,_extends$1({},_e,{ref:ue,style:{..._e.style,display:"block"}})))});function $cf1ac5d9fe0e8206$var$isNotNull$1(fe){return fe!==null}const $cf1ac5d9fe0e8206$var$transformOrigin$1=fe=>({name:"transformOrigin",options:fe,fn(ee){var ue,pe,_e,Ne,Ue;const{placement:Ge,rects:qe,middlewareData:Ke}=ee,Ze=((ue=Ke.arrow)===null||ue===void 0?void 0:ue.centerOffset)!==0,Xe=Ze?0:fe.arrowWidth,Je=Ze?0:fe.arrowHeight,[tt,rt]=$cf1ac5d9fe0e8206$var$getSideAndAlignFromPlacement$1(Ge),et={start:"0%",center:"50%",end:"100%"}[rt],it=((pe=(_e=Ke.arrow)===null||_e===void 0?void 0:_e.x)!==null&&pe!==void 0?pe:0)+Xe/2,nt=((Ne=(Ue=Ke.arrow)===null||Ue===void 0?void 0:Ue.y)!==null&&Ne!==void 0?Ne:0)+Je/2;let st="",lt="";return tt==="bottom"?(st=Ze?et:`${it}px`,lt=`${-Je}px`):tt==="top"?(st=Ze?et:`${it}px`,lt=`${qe.floating.height+Je}px`):tt==="right"?(st=`${-Je}px`,lt=Ze?et:`${nt}px`):tt==="left"&&(st=`${qe.floating.width+Je}px`,lt=Ze?et:`${nt}px`),{data:{x:st,y:lt}}}});function $cf1ac5d9fe0e8206$var$getSideAndAlignFromPlacement$1(fe){const[ee,ue="center"]=fe.split("-");return[ee,ue]}const $cf1ac5d9fe0e8206$export$be92b6f5f03c0fe9$1=$cf1ac5d9fe0e8206$export$badac9ada3a0bdf9$1,$cf1ac5d9fe0e8206$export$b688253958b8dfe7$1=$cf1ac5d9fe0e8206$export$ecd4e1ccab6ed6d$1,$cf1ac5d9fe0e8206$export$7c6e2c02157bb7d2$1=$cf1ac5d9fe0e8206$export$bc4ae5855d3c4fc$1,$cf1ac5d9fe0e8206$export$21b07c8f274aebd5=$cf1ac5d9fe0e8206$export$79d62cd4e10a3fd0;var getDefaultParent=function(fe){if(typeof document>"u")return null;var ee=Array.isArray(fe)?fe[0]:fe;return ee.ownerDocument.body},counterMap=new WeakMap,uncontrolledNodes=new WeakMap,markerMap={},lockCount=0,unwrapHost=function(fe){return fe&&(fe.host||unwrapHost(fe.parentNode))},correctTargets=function(fe,ee){return ee.map(function(ue){if(fe.contains(ue))return ue;var pe=unwrapHost(ue);return pe&&fe.contains(pe)?pe:(console.error("aria-hidden",ue,"in not contained inside",fe,". Doing nothing"),null)}).filter(function(ue){return!!ue})},applyAttributeToOthers=function(fe,ee,ue,pe){var _e=correctTargets(ee,Array.isArray(fe)?fe:[fe]);markerMap[ue]||(markerMap[ue]=new WeakMap);var Ne=markerMap[ue],Ue=[],Ge=new Set,qe=new Set(_e),Ke=function(Ze){!Ze||Ge.has(Ze)||(Ge.add(Ze),Ke(Ze.parentNode))};_e.forEach(Ke);var Ye=function(Ze){!Ze||qe.has(Ze)||Array.prototype.forEach.call(Ze.children,function(Xe){if(Ge.has(Xe))Ye(Xe);else{var Je=Xe.getAttribute(pe),tt=Je!==null&&Je!=="false",rt=(counterMap.get(Xe)||0)+1,et=(Ne.get(Xe)||0)+1;counterMap.set(Xe,rt),Ne.set(Xe,et),Ue.push(Xe),rt===1&&tt&&uncontrolledNodes.set(Xe,!0),et===1&&Xe.setAttribute(ue,"true"),tt||Xe.setAttribute(pe,"true")}})};return Ye(ee),Ge.clear(),lockCount++,function(){Ue.forEach(function(Ze){var Xe=counterMap.get(Ze)-1,Je=Ne.get(Ze)-1;counterMap.set(Ze,Xe),Ne.set(Ze,Je),Xe||(uncontrolledNodes.has(Ze)||Ze.removeAttribute(pe),uncontrolledNodes.delete(Ze)),Je||Ze.removeAttribute(ue)}),lockCount--,lockCount||(counterMap=new WeakMap,counterMap=new WeakMap,uncontrolledNodes=new WeakMap,markerMap={})}},hideOthers=function(fe,ee,ue){ue===void 0&&(ue="data-aria-hidden");var pe=Array.from(Array.isArray(fe)?fe:[fe]),_e=ee||getDefaultParent(fe);return _e?(pe.push.apply(pe,Array.from(_e.querySelectorAll("[aria-live]"))),applyAttributeToOthers(pe,_e,ue,"aria-hidden")):function(){return null}},__assign=function(){return __assign=Object.assign||function(ee){for(var ue,pe=1,_e=arguments.length;pe<_e;pe++){ue=arguments[pe];for(var Ne in ue)Object.prototype.hasOwnProperty.call(ue,Ne)&&(ee[Ne]=ue[Ne])}return ee},__assign.apply(this,arguments)};function __rest(fe,ee){var ue={};for(var pe in fe)Object.prototype.hasOwnProperty.call(fe,pe)&&ee.indexOf(pe)<0&&(ue[pe]=fe[pe]);if(fe!=null&&typeof Object.getOwnPropertySymbols=="function")for(var _e=0,pe=Object.getOwnPropertySymbols(fe);_e<pe.length;_e++)ee.indexOf(pe[_e])<0&&Object.prototype.propertyIsEnumerable.call(fe,pe[_e])&&(ue[pe[_e]]=fe[pe[_e]]);return ue}function __spreadArray(fe,ee,ue){if(ue||arguments.length===2)for(var pe=0,_e=ee.length,Ne;pe<_e;pe++)(Ne||!(pe in ee))&&(Ne||(Ne=Array.prototype.slice.call(ee,0,pe)),Ne[pe]=ee[pe]);return fe.concat(Ne||Array.prototype.slice.call(ee))}typeof SuppressedError=="function"&&SuppressedError;var zeroRightClassName="right-scroll-bar-position",fullWidthClassName="width-before-scroll-bar",noScrollbarsClassName="with-scroll-bars-hidden",removedBarSizeVariable="--removed-body-scroll-bar-size";function assignRef(fe,ee){return typeof fe=="function"?fe(ee):fe&&(fe.current=ee),fe}function useCallbackRef(fe,ee){var ue=reactExports.useState(function(){return{value:fe,callback:ee,facade:{get current(){return ue.value},set current(pe){var _e=ue.value;_e!==pe&&(ue.value=pe,ue.callback(pe,_e))}}}})[0];return ue.callback=ee,ue.facade}function useMergeRefs(fe,ee){return useCallbackRef(ee||null,function(ue){return fe.forEach(function(pe){return assignRef(pe,ue)})})}function ItoI(fe){return fe}function innerCreateMedium(fe,ee){ee===void 0&&(ee=ItoI);var ue=[],pe=!1,_e={read:function(){if(pe)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return ue.length?ue[ue.length-1]:fe},useMedium:function(Ne){var Ue=ee(Ne,pe);return ue.push(Ue),function(){ue=ue.filter(function(Ge){return Ge!==Ue})}},assignSyncMedium:function(Ne){for(pe=!0;ue.length;){var Ue=ue;ue=[],Ue.forEach(Ne)}ue={push:function(Ge){return Ne(Ge)},filter:function(){return ue}}},assignMedium:function(Ne){pe=!0;var Ue=[];if(ue.length){var Ge=ue;ue=[],Ge.forEach(Ne),Ue=ue}var qe=function(){var Ye=Ue;Ue=[],Ye.forEach(Ne)},Ke=function(){return Promise.resolve().then(qe)};Ke(),ue={push:function(Ye){Ue.push(Ye),Ke()},filter:function(Ye){return Ue=Ue.filter(Ye),ue}}}};return _e}function createSidecarMedium(fe){fe===void 0&&(fe={});var ee=innerCreateMedium(null);return ee.options=__assign({async:!0,ssr:!1},fe),ee}var SideCar$1=function(fe){var ee=fe.sideCar,ue=__rest(fe,["sideCar"]);if(!ee)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var pe=ee.read();if(!pe)throw new Error("Sidecar medium not found");return reactExports.createElement(pe,__assign({},ue))};SideCar$1.isSideCarExport=!0;function exportSidecar(fe,ee){return fe.useMedium(ee),SideCar$1}var effectCar=createSidecarMedium(),nothing=function(){},RemoveScroll=reactExports.forwardRef(function(fe,ee){var ue=reactExports.useRef(null),pe=reactExports.useState({onScrollCapture:nothing,onWheelCapture:nothing,onTouchMoveCapture:nothing}),_e=pe[0],Ne=pe[1],Ue=fe.forwardProps,Ge=fe.children,qe=fe.className,Ke=fe.removeScrollBar,Ye=fe.enabled,Ze=fe.shards,Xe=fe.sideCar,Je=fe.noIsolation,tt=fe.inert,rt=fe.allowPinchZoom,et=fe.as,it=et===void 0?"div":et,nt=__rest(fe,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as"]),st=Xe,lt=useMergeRefs([ue,ee]),_r=__assign(__assign({},nt),_e);return reactExports.createElement(reactExports.Fragment,null,Ye&&reactExports.createElement(st,{sideCar:effectCar,removeScrollBar:Ke,shards:Ze,noIsolation:Je,inert:tt,setCallbacks:Ne,allowPinchZoom:!!rt,lockRef:ue}),Ue?reactExports.cloneElement(reactExports.Children.only(Ge),__assign(__assign({},_r),{ref:lt})):reactExports.createElement(it,__assign({},_r,{className:qe,ref:lt}),Ge))});RemoveScroll.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};RemoveScroll.classNames={fullWidth:fullWidthClassName,zeroRight:zeroRightClassName};var currentNonce,getNonce=function(){if(currentNonce)return currentNonce;if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function makeStyleTag(){if(!document)return null;var fe=document.createElement("style");fe.type="text/css";var ee=getNonce();return ee&&fe.setAttribute("nonce",ee),fe}function injectStyles(fe,ee){fe.styleSheet?fe.styleSheet.cssText=ee:fe.appendChild(document.createTextNode(ee))}function insertStyleTag(fe){var ee=document.head||document.getElementsByTagName("head")[0];ee.appendChild(fe)}var stylesheetSingleton=function(){var fe=0,ee=null;return{add:function(ue){fe==0&&(ee=makeStyleTag())&&(injectStyles(ee,ue),insertStyleTag(ee)),fe++},remove:function(){fe--,!fe&&ee&&(ee.parentNode&&ee.parentNode.removeChild(ee),ee=null)}}},styleHookSingleton=function(){var fe=stylesheetSingleton();return function(ee,ue){reactExports.useEffect(function(){return fe.add(ee),function(){fe.remove()}},[ee&&ue])}},styleSingleton=function(){var fe=styleHookSingleton(),ee=function(ue){var pe=ue.styles,_e=ue.dynamic;return fe(pe,_e),null};return ee},zeroGap={left:0,top:0,right:0,gap:0},parse=function(fe){return parseInt(fe||"",10)||0},getOffset=function(fe){var ee=window.getComputedStyle(document.body),ue=ee[fe==="padding"?"paddingLeft":"marginLeft"],pe=ee[fe==="padding"?"paddingTop":"marginTop"],_e=ee[fe==="padding"?"paddingRight":"marginRight"];return[parse(ue),parse(pe),parse(_e)]},getGapWidth=function(fe){if(fe===void 0&&(fe="margin"),typeof window>"u")return zeroGap;var ee=getOffset(fe),ue=document.documentElement.clientWidth,pe=window.innerWidth;return{left:ee[0],top:ee[1],right:ee[2],gap:Math.max(0,pe-ue+ee[2]-ee[0])}},Style=styleSingleton(),getStyles=function(fe,ee,ue,pe){var _e=fe.left,Ne=fe.top,Ue=fe.right,Ge=fe.gap;return ue===void 0&&(ue="margin"),`
  .`.concat(noScrollbarsClassName,` {
   overflow: hidden `).concat(pe,`;
   padding-right: `).concat(Ge,"px ").concat(pe,`;
  }
  body {
    overflow: hidden `).concat(pe,`;
    overscroll-behavior: contain;
    `).concat([ee&&"position: relative ".concat(pe,";"),ue==="margin"&&`
    padding-left: `.concat(_e,`px;
    padding-top: `).concat(Ne,`px;
    padding-right: `).concat(Ue,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(Ge,"px ").concat(pe,`;
    `),ue==="padding"&&"padding-right: ".concat(Ge,"px ").concat(pe,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(zeroRightClassName,` {
    right: `).concat(Ge,"px ").concat(pe,`;
  }
  
  .`).concat(fullWidthClassName,` {
    margin-right: `).concat(Ge,"px ").concat(pe,`;
  }
  
  .`).concat(zeroRightClassName," .").concat(zeroRightClassName,` {
    right: 0 `).concat(pe,`;
  }
  
  .`).concat(fullWidthClassName," .").concat(fullWidthClassName,` {
    margin-right: 0 `).concat(pe,`;
  }
  
  body {
    `).concat(removedBarSizeVariable,": ").concat(Ge,`px;
  }
`)},RemoveScrollBar=function(fe){var ee=fe.noRelative,ue=fe.noImportant,pe=fe.gapMode,_e=pe===void 0?"margin":pe,Ne=reactExports.useMemo(function(){return getGapWidth(_e)},[_e]);return reactExports.createElement(Style,{styles:getStyles(Ne,!ee,_e,ue?"":"!important")})},passiveSupported=!1;if(typeof window<"u")try{var options=Object.defineProperty({},"passive",{get:function(){return passiveSupported=!0,!0}});window.addEventListener("test",options,options),window.removeEventListener("test",options,options)}catch{passiveSupported=!1}var nonPassive=passiveSupported?{passive:!1}:!1,alwaysContainsScroll=function(fe){return fe.tagName==="TEXTAREA"},elementCanBeScrolled=function(fe,ee){var ue=window.getComputedStyle(fe);return ue[ee]!=="hidden"&&!(ue.overflowY===ue.overflowX&&!alwaysContainsScroll(fe)&&ue[ee]==="visible")},elementCouldBeVScrolled=function(fe){return elementCanBeScrolled(fe,"overflowY")},elementCouldBeHScrolled=function(fe){return elementCanBeScrolled(fe,"overflowX")},locationCouldBeScrolled=function(fe,ee){var ue=ee;do{typeof ShadowRoot<"u"&&ue instanceof ShadowRoot&&(ue=ue.host);var pe=elementCouldBeScrolled(fe,ue);if(pe){var _e=getScrollVariables(fe,ue),Ne=_e[1],Ue=_e[2];if(Ne>Ue)return!0}ue=ue.parentNode}while(ue&&ue!==document.body);return!1},getVScrollVariables=function(fe){var ee=fe.scrollTop,ue=fe.scrollHeight,pe=fe.clientHeight;return[ee,ue,pe]},getHScrollVariables=function(fe){var ee=fe.scrollLeft,ue=fe.scrollWidth,pe=fe.clientWidth;return[ee,ue,pe]},elementCouldBeScrolled=function(fe,ee){return fe==="v"?elementCouldBeVScrolled(ee):elementCouldBeHScrolled(ee)},getScrollVariables=function(fe,ee){return fe==="v"?getVScrollVariables(ee):getHScrollVariables(ee)},getDirectionFactor=function(fe,ee){return fe==="h"&&ee==="rtl"?-1:1},handleScroll=function(fe,ee,ue,pe,_e){var Ne=getDirectionFactor(fe,window.getComputedStyle(ee).direction),Ue=Ne*pe,Ge=ue.target,qe=ee.contains(Ge),Ke=!1,Ye=Ue>0,Ze=0,Xe=0;do{var Je=getScrollVariables(fe,Ge),tt=Je[0],rt=Je[1],et=Je[2],it=rt-et-Ne*tt;(tt||it)&&elementCouldBeScrolled(fe,Ge)&&(Ze+=it,Xe+=tt),Ge=Ge.parentNode}while(!qe&&Ge!==document.body||qe&&(ee.contains(Ge)||ee===Ge));return(Ye&&(_e&&Ze===0||!_e&&Ue>Ze)||!Ye&&(_e&&Xe===0||!_e&&-Ue>Xe))&&(Ke=!0),Ke},getTouchXY=function(fe){return"changedTouches"in fe?[fe.changedTouches[0].clientX,fe.changedTouches[0].clientY]:[0,0]},getDeltaXY=function(fe){return[fe.deltaX,fe.deltaY]},extractRef=function(fe){return fe&&"current"in fe?fe.current:fe},deltaCompare=function(fe,ee){return fe[0]===ee[0]&&fe[1]===ee[1]},generateStyle=function(fe){return`
  .block-interactivity-`.concat(fe,` {pointer-events: none;}
  .allow-interactivity-`).concat(fe,` {pointer-events: all;}
`)},idCounter=0,lockStack=[];function RemoveScrollSideCar(fe){var ee=reactExports.useRef([]),ue=reactExports.useRef([0,0]),pe=reactExports.useRef(),_e=reactExports.useState(idCounter++)[0],Ne=reactExports.useState(function(){return styleSingleton()})[0],Ue=reactExports.useRef(fe);reactExports.useEffect(function(){Ue.current=fe},[fe]),reactExports.useEffect(function(){if(fe.inert){document.body.classList.add("block-interactivity-".concat(_e));var rt=__spreadArray([fe.lockRef.current],(fe.shards||[]).map(extractRef),!0).filter(Boolean);return rt.forEach(function(et){return et.classList.add("allow-interactivity-".concat(_e))}),function(){document.body.classList.remove("block-interactivity-".concat(_e)),rt.forEach(function(et){return et.classList.remove("allow-interactivity-".concat(_e))})}}},[fe.inert,fe.lockRef.current,fe.shards]);var Ge=reactExports.useCallback(function(rt,et){if("touches"in rt&&rt.touches.length===2)return!Ue.current.allowPinchZoom;var it=getTouchXY(rt),nt=ue.current,st="deltaX"in rt?rt.deltaX:nt[0]-it[0],lt="deltaY"in rt?rt.deltaY:nt[1]-it[1],_r,jr=rt.target,Nr=Math.abs(st)>Math.abs(lt)?"h":"v";if("touches"in rt&&Nr==="h"&&jr.type==="range")return!1;var Wr=locationCouldBeScrolled(Nr,jr);if(!Wr)return!0;if(Wr?_r=Nr:(_r=Nr==="v"?"h":"v",Wr=locationCouldBeScrolled(Nr,jr)),!Wr)return!1;if(!pe.current&&"changedTouches"in rt&&(st||lt)&&(pe.current=_r),!_r)return!0;var ri=pe.current||_r;return handleScroll(ri,et,rt,ri==="h"?st:lt,!0)},[]),qe=reactExports.useCallback(function(rt){var et=rt;if(!(!lockStack.length||lockStack[lockStack.length-1]!==Ne)){var it="deltaY"in et?getDeltaXY(et):getTouchXY(et),nt=ee.current.filter(function(_r){return _r.name===et.type&&_r.target===et.target&&deltaCompare(_r.delta,it)})[0];if(nt&&nt.should){et.cancelable&&et.preventDefault();return}if(!nt){var st=(Ue.current.shards||[]).map(extractRef).filter(Boolean).filter(function(_r){return _r.contains(et.target)}),lt=st.length>0?Ge(et,st[0]):!Ue.current.noIsolation;lt&&et.cancelable&&et.preventDefault()}}},[]),Ke=reactExports.useCallback(function(rt,et,it,nt){var st={name:rt,delta:et,target:it,should:nt};ee.current.push(st),setTimeout(function(){ee.current=ee.current.filter(function(lt){return lt!==st})},1)},[]),Ye=reactExports.useCallback(function(rt){ue.current=getTouchXY(rt),pe.current=void 0},[]),Ze=reactExports.useCallback(function(rt){Ke(rt.type,getDeltaXY(rt),rt.target,Ge(rt,fe.lockRef.current))},[]),Xe=reactExports.useCallback(function(rt){Ke(rt.type,getTouchXY(rt),rt.target,Ge(rt,fe.lockRef.current))},[]);reactExports.useEffect(function(){return lockStack.push(Ne),fe.setCallbacks({onScrollCapture:Ze,onWheelCapture:Ze,onTouchMoveCapture:Xe}),document.addEventListener("wheel",qe,nonPassive),document.addEventListener("touchmove",qe,nonPassive),document.addEventListener("touchstart",Ye,nonPassive),function(){lockStack=lockStack.filter(function(rt){return rt!==Ne}),document.removeEventListener("wheel",qe,nonPassive),document.removeEventListener("touchmove",qe,nonPassive),document.removeEventListener("touchstart",Ye,nonPassive)}},[]);var Je=fe.removeScrollBar,tt=fe.inert;return reactExports.createElement(reactExports.Fragment,null,tt?reactExports.createElement(Ne,{styles:generateStyle(_e)}):null,Je?reactExports.createElement(RemoveScrollBar,{gapMode:"margin"}):null)}const SideCar=exportSidecar(effectCar,RemoveScrollSideCar);var ReactRemoveScroll=reactExports.forwardRef(function(fe,ee){return reactExports.createElement(RemoveScroll,__assign({},fe,{ref:ee,sideCar:SideCar}))});ReactRemoveScroll.classNames=RemoveScroll.classNames;const $01b9c$RemoveScroll=ReactRemoveScroll,$cb5cc270b50c6fcd$var$POPOVER_NAME="Popover",[$cb5cc270b50c6fcd$var$createPopoverContext,$cb5cc270b50c6fcd$export$c8393c9e73286932]=$c512c27ab02ef895$export$50c7b4e9d9f19c1($cb5cc270b50c6fcd$var$POPOVER_NAME,[$cf1ac5d9fe0e8206$export$722aac194ae923$1]),$cb5cc270b50c6fcd$var$usePopperScope=$cf1ac5d9fe0e8206$export$722aac194ae923$1(),[$cb5cc270b50c6fcd$var$PopoverProvider,$cb5cc270b50c6fcd$var$usePopoverContext]=$cb5cc270b50c6fcd$var$createPopoverContext($cb5cc270b50c6fcd$var$POPOVER_NAME),$cb5cc270b50c6fcd$export$5b6b19405a83ff9d=fe=>{const{__scopePopover:ee,children:ue,open:pe,defaultOpen:_e,onOpenChange:Ne,modal:Ue=!1}=fe,Ge=$cb5cc270b50c6fcd$var$usePopperScope(ee),qe=reactExports.useRef(null),[Ke,Ye]=reactExports.useState(!1),[Ze=!1,Xe]=$71cd76cc60e0454e$export$6f32135080cb4c3({prop:pe,defaultProp:_e,onChange:Ne});return reactExports.createElement($cf1ac5d9fe0e8206$export$be92b6f5f03c0fe9$1,Ge,reactExports.createElement($cb5cc270b50c6fcd$var$PopoverProvider,{scope:ee,contentId:$1746a345f3d73bb7$export$f680877a34711e37(),triggerRef:qe,open:Ze,onOpenChange:Xe,onOpenToggle:reactExports.useCallback(()=>Xe(Je=>!Je),[Xe]),hasCustomAnchor:Ke,onCustomAnchorAdd:reactExports.useCallback(()=>Ye(!0),[]),onCustomAnchorRemove:reactExports.useCallback(()=>Ye(!1),[]),modal:Ue},ue))},$cb5cc270b50c6fcd$var$TRIGGER_NAME="PopoverTrigger",$cb5cc270b50c6fcd$export$7dacb05d26466c3=reactExports.forwardRef((fe,ee)=>{const{__scopePopover:ue,...pe}=fe,_e=$cb5cc270b50c6fcd$var$usePopoverContext($cb5cc270b50c6fcd$var$TRIGGER_NAME,ue),Ne=$cb5cc270b50c6fcd$var$usePopperScope(ue),Ue=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(ee,_e.triggerRef),Ge=reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.button,_extends$1({type:"button","aria-haspopup":"dialog","aria-expanded":_e.open,"aria-controls":_e.contentId,"data-state":$cb5cc270b50c6fcd$var$getState(_e.open)},pe,{ref:Ue,onClick:$e42e1063c40fb3ef$export$b9ecd428b558ff10(fe.onClick,_e.onOpenToggle)}));return _e.hasCustomAnchor?Ge:reactExports.createElement($cf1ac5d9fe0e8206$export$b688253958b8dfe7$1,_extends$1({asChild:!0},Ne),Ge)}),$cb5cc270b50c6fcd$var$PORTAL_NAME="PopoverPortal",[$cb5cc270b50c6fcd$var$PortalProvider,$cb5cc270b50c6fcd$var$usePortalContext]=$cb5cc270b50c6fcd$var$createPopoverContext($cb5cc270b50c6fcd$var$PORTAL_NAME,{forceMount:void 0}),$cb5cc270b50c6fcd$var$CONTENT_NAME="PopoverContent",$cb5cc270b50c6fcd$export$d7e1f420b25549ff=reactExports.forwardRef((fe,ee)=>{const ue=$cb5cc270b50c6fcd$var$usePortalContext($cb5cc270b50c6fcd$var$CONTENT_NAME,fe.__scopePopover),{forceMount:pe=ue.forceMount,..._e}=fe,Ne=$cb5cc270b50c6fcd$var$usePopoverContext($cb5cc270b50c6fcd$var$CONTENT_NAME,fe.__scopePopover);return reactExports.createElement($921a889cee6df7e8$export$99c2b779aa4e8b8b,{present:pe||Ne.open},Ne.modal?reactExports.createElement($cb5cc270b50c6fcd$var$PopoverContentModal,_extends$1({},_e,{ref:ee})):reactExports.createElement($cb5cc270b50c6fcd$var$PopoverContentNonModal,_extends$1({},_e,{ref:ee})))}),$cb5cc270b50c6fcd$var$PopoverContentModal=reactExports.forwardRef((fe,ee)=>{const ue=$cb5cc270b50c6fcd$var$usePopoverContext($cb5cc270b50c6fcd$var$CONTENT_NAME,fe.__scopePopover),pe=reactExports.useRef(null),_e=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(ee,pe),Ne=reactExports.useRef(!1);return reactExports.useEffect(()=>{const Ue=pe.current;if(Ue)return hideOthers(Ue)},[]),reactExports.createElement($01b9c$RemoveScroll,{as:$5e63c961fc1ce211$export$8c6ed5c666ac1360,allowPinchZoom:!0},reactExports.createElement($cb5cc270b50c6fcd$var$PopoverContentImpl,_extends$1({},fe,{ref:_e,trapFocus:ue.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:$e42e1063c40fb3ef$export$b9ecd428b558ff10(fe.onCloseAutoFocus,Ue=>{var Ge;Ue.preventDefault(),Ne.current||(Ge=ue.triggerRef.current)===null||Ge===void 0||Ge.focus()}),onPointerDownOutside:$e42e1063c40fb3ef$export$b9ecd428b558ff10(fe.onPointerDownOutside,Ue=>{const Ge=Ue.detail.originalEvent,qe=Ge.button===0&&Ge.ctrlKey===!0,Ke=Ge.button===2||qe;Ne.current=Ke},{checkForDefaultPrevented:!1}),onFocusOutside:$e42e1063c40fb3ef$export$b9ecd428b558ff10(fe.onFocusOutside,Ue=>Ue.preventDefault(),{checkForDefaultPrevented:!1})})))}),$cb5cc270b50c6fcd$var$PopoverContentNonModal=reactExports.forwardRef((fe,ee)=>{const ue=$cb5cc270b50c6fcd$var$usePopoverContext($cb5cc270b50c6fcd$var$CONTENT_NAME,fe.__scopePopover),pe=reactExports.useRef(!1),_e=reactExports.useRef(!1);return reactExports.createElement($cb5cc270b50c6fcd$var$PopoverContentImpl,_extends$1({},fe,{ref:ee,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:Ne=>{var Ue;if((Ue=fe.onCloseAutoFocus)===null||Ue===void 0||Ue.call(fe,Ne),!Ne.defaultPrevented){var Ge;pe.current||(Ge=ue.triggerRef.current)===null||Ge===void 0||Ge.focus(),Ne.preventDefault()}pe.current=!1,_e.current=!1},onInteractOutside:Ne=>{var Ue,Ge;(Ue=fe.onInteractOutside)===null||Ue===void 0||Ue.call(fe,Ne),Ne.defaultPrevented||(pe.current=!0,Ne.detail.originalEvent.type==="pointerdown"&&(_e.current=!0));const qe=Ne.target;((Ge=ue.triggerRef.current)===null||Ge===void 0?void 0:Ge.contains(qe))&&Ne.preventDefault(),Ne.detail.originalEvent.type==="focusin"&&_e.current&&Ne.preventDefault()}}))}),$cb5cc270b50c6fcd$var$PopoverContentImpl=reactExports.forwardRef((fe,ee)=>{const{__scopePopover:ue,trapFocus:pe,onOpenAutoFocus:_e,onCloseAutoFocus:Ne,disableOutsidePointerEvents:Ue,onEscapeKeyDown:Ge,onPointerDownOutside:qe,onFocusOutside:Ke,onInteractOutside:Ye,...Ze}=fe,Xe=$cb5cc270b50c6fcd$var$usePopoverContext($cb5cc270b50c6fcd$var$CONTENT_NAME,ue),Je=$cb5cc270b50c6fcd$var$usePopperScope(ue);return $3db38b7d1fb3fe6a$export$b7ece24a22aeda8c(),reactExports.createElement($d3863c46a17e8a28$export$20e40289641fbbb6$1,{asChild:!0,loop:!0,trapped:pe,onMountAutoFocus:_e,onUnmountAutoFocus:Ne},reactExports.createElement($5cb92bef7577960e$export$177fb62ff3ec1f22$1,{asChild:!0,disableOutsidePointerEvents:Ue,onInteractOutside:Ye,onEscapeKeyDown:Ge,onPointerDownOutside:qe,onFocusOutside:Ke,onDismiss:()=>Xe.onOpenChange(!1)},reactExports.createElement($cf1ac5d9fe0e8206$export$7c6e2c02157bb7d2$1,_extends$1({"data-state":$cb5cc270b50c6fcd$var$getState(Xe.open),role:"dialog",id:Xe.contentId},Je,Ze,{ref:ee,style:{...Ze.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}}))))}),$cb5cc270b50c6fcd$var$CLOSE_NAME="PopoverClose",$cb5cc270b50c6fcd$export$d6ac43ebaa40d53e=reactExports.forwardRef((fe,ee)=>{const{__scopePopover:ue,...pe}=fe,_e=$cb5cc270b50c6fcd$var$usePopoverContext($cb5cc270b50c6fcd$var$CLOSE_NAME,ue);return reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.button,_extends$1({type:"button"},pe,{ref:ee,onClick:$e42e1063c40fb3ef$export$b9ecd428b558ff10(fe.onClick,()=>_e.onOpenChange(!1))}))}),$cb5cc270b50c6fcd$export$3152841115e061b2=reactExports.forwardRef((fe,ee)=>{const{__scopePopover:ue,...pe}=fe,_e=$cb5cc270b50c6fcd$var$usePopperScope(ue);return reactExports.createElement($cf1ac5d9fe0e8206$export$21b07c8f274aebd5,_extends$1({},_e,pe,{ref:ee}))});function $cb5cc270b50c6fcd$var$getState(fe){return fe?"open":"closed"}const $cb5cc270b50c6fcd$export$be92b6f5f03c0fe9=$cb5cc270b50c6fcd$export$5b6b19405a83ff9d,$cb5cc270b50c6fcd$export$41fb9f06171c75f4=$cb5cc270b50c6fcd$export$7dacb05d26466c3,$cb5cc270b50c6fcd$export$7c6e2c02157bb7d2=$cb5cc270b50c6fcd$export$d7e1f420b25549ff,$cb5cc270b50c6fcd$export$f39c2d165cd861fe=$cb5cc270b50c6fcd$export$d6ac43ebaa40d53e,$cb5cc270b50c6fcd$export$21b07c8f274aebd5=$cb5cc270b50c6fcd$export$3152841115e061b2;function $ae6933e535247d3d$export$7d15b64cf5a3a4c4(fe,[ee,ue]){return Math.min(ue,Math.max(ee,fe))}const $5cb92bef7577960e$var$CONTEXT_UPDATE="dismissableLayer.update",$5cb92bef7577960e$var$POINTER_DOWN_OUTSIDE="dismissableLayer.pointerDownOutside",$5cb92bef7577960e$var$FOCUS_OUTSIDE="dismissableLayer.focusOutside";let $5cb92bef7577960e$var$originalBodyPointerEvents;const $5cb92bef7577960e$var$DismissableLayerContext=reactExports.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),$5cb92bef7577960e$export$177fb62ff3ec1f22=reactExports.forwardRef((fe,ee)=>{var ue;const{disableOutsidePointerEvents:pe=!1,onEscapeKeyDown:_e,onPointerDownOutside:Ne,onFocusOutside:Ue,onInteractOutside:Ge,onDismiss:qe,...Ke}=fe,Ye=reactExports.useContext($5cb92bef7577960e$var$DismissableLayerContext),[Ze,Xe]=reactExports.useState(null),Je=(ue=Ze==null?void 0:Ze.ownerDocument)!==null&&ue!==void 0?ue:globalThis==null?void 0:globalThis.document,[,tt]=reactExports.useState({}),rt=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(ee,Wr=>Xe(Wr)),et=Array.from(Ye.layers),[it]=[...Ye.layersWithOutsidePointerEventsDisabled].slice(-1),nt=et.indexOf(it),st=Ze?et.indexOf(Ze):-1,lt=Ye.layersWithOutsidePointerEventsDisabled.size>0,_r=st>=nt,jr=$5cb92bef7577960e$var$usePointerDownOutside(Wr=>{const ri=Wr.target,Xr=[...Ye.branches].some(Gr=>Gr.contains(ri));!_r||Xr||(Ne==null||Ne(Wr),Ge==null||Ge(Wr),Wr.defaultPrevented||qe==null||qe())},Je),Nr=$5cb92bef7577960e$var$useFocusOutside(Wr=>{const ri=Wr.target;[...Ye.branches].some(Gr=>Gr.contains(ri))||(Ue==null||Ue(Wr),Ge==null||Ge(Wr),Wr.defaultPrevented||qe==null||qe())},Je);return $addc16e1bbe58fd0$export$3a72a57244d6e765(Wr=>{st===Ye.layers.size-1&&(_e==null||_e(Wr),!Wr.defaultPrevented&&qe&&(Wr.preventDefault(),qe()))},Je),reactExports.useEffect(()=>{if(Ze)return pe&&(Ye.layersWithOutsidePointerEventsDisabled.size===0&&($5cb92bef7577960e$var$originalBodyPointerEvents=Je.body.style.pointerEvents,Je.body.style.pointerEvents="none"),Ye.layersWithOutsidePointerEventsDisabled.add(Ze)),Ye.layers.add(Ze),$5cb92bef7577960e$var$dispatchUpdate(),()=>{pe&&Ye.layersWithOutsidePointerEventsDisabled.size===1&&(Je.body.style.pointerEvents=$5cb92bef7577960e$var$originalBodyPointerEvents)}},[Ze,Je,pe,Ye]),reactExports.useEffect(()=>()=>{Ze&&(Ye.layers.delete(Ze),Ye.layersWithOutsidePointerEventsDisabled.delete(Ze),$5cb92bef7577960e$var$dispatchUpdate())},[Ze,Ye]),reactExports.useEffect(()=>{const Wr=()=>tt({});return document.addEventListener($5cb92bef7577960e$var$CONTEXT_UPDATE,Wr),()=>document.removeEventListener($5cb92bef7577960e$var$CONTEXT_UPDATE,Wr)},[]),reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({},Ke,{ref:rt,style:{pointerEvents:lt?_r?"auto":"none":void 0,...fe.style},onFocusCapture:$e42e1063c40fb3ef$export$b9ecd428b558ff10(fe.onFocusCapture,Nr.onFocusCapture),onBlurCapture:$e42e1063c40fb3ef$export$b9ecd428b558ff10(fe.onBlurCapture,Nr.onBlurCapture),onPointerDownCapture:$e42e1063c40fb3ef$export$b9ecd428b558ff10(fe.onPointerDownCapture,jr.onPointerDownCapture)}))});function $5cb92bef7577960e$var$usePointerDownOutside(fe,ee=globalThis==null?void 0:globalThis.document){const ue=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(fe),pe=reactExports.useRef(!1),_e=reactExports.useRef(()=>{});return reactExports.useEffect(()=>{const Ne=Ge=>{if(Ge.target&&!pe.current){let Ke=function(){$5cb92bef7577960e$var$handleAndDispatchCustomEvent($5cb92bef7577960e$var$POINTER_DOWN_OUTSIDE,ue,qe,{discrete:!0})};const qe={originalEvent:Ge};Ge.pointerType==="touch"?(ee.removeEventListener("click",_e.current),_e.current=Ke,ee.addEventListener("click",_e.current,{once:!0})):Ke()}pe.current=!1},Ue=window.setTimeout(()=>{ee.addEventListener("pointerdown",Ne)},0);return()=>{window.clearTimeout(Ue),ee.removeEventListener("pointerdown",Ne),ee.removeEventListener("click",_e.current)}},[ee,ue]),{onPointerDownCapture:()=>pe.current=!0}}function $5cb92bef7577960e$var$useFocusOutside(fe,ee=globalThis==null?void 0:globalThis.document){const ue=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(fe),pe=reactExports.useRef(!1);return reactExports.useEffect(()=>{const _e=Ne=>{Ne.target&&!pe.current&&$5cb92bef7577960e$var$handleAndDispatchCustomEvent($5cb92bef7577960e$var$FOCUS_OUTSIDE,ue,{originalEvent:Ne},{discrete:!1})};return ee.addEventListener("focusin",_e),()=>ee.removeEventListener("focusin",_e)},[ee,ue]),{onFocusCapture:()=>pe.current=!0,onBlurCapture:()=>pe.current=!1}}function $5cb92bef7577960e$var$dispatchUpdate(){const fe=new CustomEvent($5cb92bef7577960e$var$CONTEXT_UPDATE);document.dispatchEvent(fe)}function $5cb92bef7577960e$var$handleAndDispatchCustomEvent(fe,ee,ue,{discrete:pe}){const _e=ue.originalEvent.target,Ne=new CustomEvent(fe,{bubbles:!1,cancelable:!0,detail:ue});ee&&_e.addEventListener(fe,ee,{once:!0}),pe?$8927f6f2acc4f386$export$6d1a0317bde7de7f(_e,Ne):_e.dispatchEvent(Ne)}const $d3863c46a17e8a28$var$AUTOFOCUS_ON_MOUNT="focusScope.autoFocusOnMount",$d3863c46a17e8a28$var$AUTOFOCUS_ON_UNMOUNT="focusScope.autoFocusOnUnmount",$d3863c46a17e8a28$var$EVENT_OPTIONS={bubbles:!1,cancelable:!0},$d3863c46a17e8a28$export$20e40289641fbbb6=reactExports.forwardRef((fe,ee)=>{const{loop:ue=!1,trapped:pe=!1,onMountAutoFocus:_e,onUnmountAutoFocus:Ne,...Ue}=fe,[Ge,qe]=reactExports.useState(null),Ke=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(_e),Ye=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(Ne),Ze=reactExports.useRef(null),Xe=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(ee,rt=>qe(rt)),Je=reactExports.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;reactExports.useEffect(()=>{if(pe){let rt=function(st){if(Je.paused||!Ge)return;const lt=st.target;Ge.contains(lt)?Ze.current=lt:$d3863c46a17e8a28$var$focus(Ze.current,{select:!0})},et=function(st){if(Je.paused||!Ge)return;const lt=st.relatedTarget;lt!==null&&(Ge.contains(lt)||$d3863c46a17e8a28$var$focus(Ze.current,{select:!0}))},it=function(st){const lt=document.activeElement;for(const _r of st)_r.removedNodes.length>0&&(Ge!=null&&Ge.contains(lt)||$d3863c46a17e8a28$var$focus(Ge))};document.addEventListener("focusin",rt),document.addEventListener("focusout",et);const nt=new MutationObserver(it);return Ge&&nt.observe(Ge,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",rt),document.removeEventListener("focusout",et),nt.disconnect()}}},[pe,Ge,Je.paused]),reactExports.useEffect(()=>{if(Ge){$d3863c46a17e8a28$var$focusScopesStack.add(Je);const rt=document.activeElement;if(!Ge.contains(rt)){const it=new CustomEvent($d3863c46a17e8a28$var$AUTOFOCUS_ON_MOUNT,$d3863c46a17e8a28$var$EVENT_OPTIONS);Ge.addEventListener($d3863c46a17e8a28$var$AUTOFOCUS_ON_MOUNT,Ke),Ge.dispatchEvent(it),it.defaultPrevented||($d3863c46a17e8a28$var$focusFirst($d3863c46a17e8a28$var$removeLinks($d3863c46a17e8a28$var$getTabbableCandidates(Ge)),{select:!0}),document.activeElement===rt&&$d3863c46a17e8a28$var$focus(Ge))}return()=>{Ge.removeEventListener($d3863c46a17e8a28$var$AUTOFOCUS_ON_MOUNT,Ke),setTimeout(()=>{const it=new CustomEvent($d3863c46a17e8a28$var$AUTOFOCUS_ON_UNMOUNT,$d3863c46a17e8a28$var$EVENT_OPTIONS);Ge.addEventListener($d3863c46a17e8a28$var$AUTOFOCUS_ON_UNMOUNT,Ye),Ge.dispatchEvent(it),it.defaultPrevented||$d3863c46a17e8a28$var$focus(rt??document.body,{select:!0}),Ge.removeEventListener($d3863c46a17e8a28$var$AUTOFOCUS_ON_UNMOUNT,Ye),$d3863c46a17e8a28$var$focusScopesStack.remove(Je)},0)}}},[Ge,Ke,Ye,Je]);const tt=reactExports.useCallback(rt=>{if(!ue&&!pe||Je.paused)return;const et=rt.key==="Tab"&&!rt.altKey&&!rt.ctrlKey&&!rt.metaKey,it=document.activeElement;if(et&&it){const nt=rt.currentTarget,[st,lt]=$d3863c46a17e8a28$var$getTabbableEdges(nt);st&&lt?!rt.shiftKey&&it===lt?(rt.preventDefault(),ue&&$d3863c46a17e8a28$var$focus(st,{select:!0})):rt.shiftKey&&it===st&&(rt.preventDefault(),ue&&$d3863c46a17e8a28$var$focus(lt,{select:!0})):it===nt&&rt.preventDefault()}},[ue,pe,Je.paused]);return reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({tabIndex:-1},Ue,{ref:Xe,onKeyDown:tt}))});function $d3863c46a17e8a28$var$focusFirst(fe,{select:ee=!1}={}){const ue=document.activeElement;for(const pe of fe)if($d3863c46a17e8a28$var$focus(pe,{select:ee}),document.activeElement!==ue)return}function $d3863c46a17e8a28$var$getTabbableEdges(fe){const ee=$d3863c46a17e8a28$var$getTabbableCandidates(fe),ue=$d3863c46a17e8a28$var$findVisible(ee,fe),pe=$d3863c46a17e8a28$var$findVisible(ee.reverse(),fe);return[ue,pe]}function $d3863c46a17e8a28$var$getTabbableCandidates(fe){const ee=[],ue=document.createTreeWalker(fe,NodeFilter.SHOW_ELEMENT,{acceptNode:pe=>{const _e=pe.tagName==="INPUT"&&pe.type==="hidden";return pe.disabled||pe.hidden||_e?NodeFilter.FILTER_SKIP:pe.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;ue.nextNode();)ee.push(ue.currentNode);return ee}function $d3863c46a17e8a28$var$findVisible(fe,ee){for(const ue of fe)if(!$d3863c46a17e8a28$var$isHidden(ue,{upTo:ee}))return ue}function $d3863c46a17e8a28$var$isHidden(fe,{upTo:ee}){if(getComputedStyle(fe).visibility==="hidden")return!0;for(;fe;){if(ee!==void 0&&fe===ee)return!1;if(getComputedStyle(fe).display==="none")return!0;fe=fe.parentElement}return!1}function $d3863c46a17e8a28$var$isSelectableInput(fe){return fe instanceof HTMLInputElement&&"select"in fe}function $d3863c46a17e8a28$var$focus(fe,{select:ee=!1}={}){if(fe&&fe.focus){const ue=document.activeElement;fe.focus({preventScroll:!0}),fe!==ue&&$d3863c46a17e8a28$var$isSelectableInput(fe)&&ee&&fe.select()}}const $d3863c46a17e8a28$var$focusScopesStack=$d3863c46a17e8a28$var$createFocusScopesStack();function $d3863c46a17e8a28$var$createFocusScopesStack(){let fe=[];return{add(ee){const ue=fe[0];ee!==ue&&(ue==null||ue.pause()),fe=$d3863c46a17e8a28$var$arrayRemove(fe,ee),fe.unshift(ee)},remove(ee){var ue;fe=$d3863c46a17e8a28$var$arrayRemove(fe,ee),(ue=fe[0])===null||ue===void 0||ue.resume()}}}function $d3863c46a17e8a28$var$arrayRemove(fe,ee){const ue=[...fe],pe=ue.indexOf(ee);return pe!==-1&&ue.splice(pe,1),ue}function $d3863c46a17e8a28$var$removeLinks(fe){return fe.filter(ee=>ee.tagName!=="A")}const $cf1ac5d9fe0e8206$var$POPPER_NAME="Popper",[$cf1ac5d9fe0e8206$var$createPopperContext,$cf1ac5d9fe0e8206$export$722aac194ae923]=$c512c27ab02ef895$export$50c7b4e9d9f19c1($cf1ac5d9fe0e8206$var$POPPER_NAME),[$cf1ac5d9fe0e8206$var$PopperProvider,$cf1ac5d9fe0e8206$var$usePopperContext]=$cf1ac5d9fe0e8206$var$createPopperContext($cf1ac5d9fe0e8206$var$POPPER_NAME),$cf1ac5d9fe0e8206$export$badac9ada3a0bdf9=fe=>{const{__scopePopper:ee,children:ue}=fe,[pe,_e]=reactExports.useState(null);return reactExports.createElement($cf1ac5d9fe0e8206$var$PopperProvider,{scope:ee,anchor:pe,onAnchorChange:_e},ue)},$cf1ac5d9fe0e8206$var$ANCHOR_NAME="PopperAnchor",$cf1ac5d9fe0e8206$export$ecd4e1ccab6ed6d=reactExports.forwardRef((fe,ee)=>{const{__scopePopper:ue,virtualRef:pe,..._e}=fe,Ne=$cf1ac5d9fe0e8206$var$usePopperContext($cf1ac5d9fe0e8206$var$ANCHOR_NAME,ue),Ue=reactExports.useRef(null),Ge=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(ee,Ue);return reactExports.useEffect(()=>{Ne.onAnchorChange((pe==null?void 0:pe.current)||Ue.current)}),pe?null:reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({},_e,{ref:Ge}))}),$cf1ac5d9fe0e8206$var$CONTENT_NAME="PopperContent",[$cf1ac5d9fe0e8206$var$PopperContentProvider,$cf1ac5d9fe0e8206$var$useContentContext]=$cf1ac5d9fe0e8206$var$createPopperContext($cf1ac5d9fe0e8206$var$CONTENT_NAME),$cf1ac5d9fe0e8206$export$bc4ae5855d3c4fc=reactExports.forwardRef((fe,ee)=>{var ue,pe,_e,Ne,Ue,Ge,qe,Ke;const{__scopePopper:Ye,side:Ze="bottom",sideOffset:Xe=0,align:Je="center",alignOffset:tt=0,arrowPadding:rt=0,collisionBoundary:et=[],collisionPadding:it=0,sticky:nt="partial",hideWhenDetached:st=!1,avoidCollisions:lt=!0,onPlaced:_r,...jr}=fe,Nr=$cf1ac5d9fe0e8206$var$usePopperContext($cf1ac5d9fe0e8206$var$CONTENT_NAME,Ye),[Wr,ri]=reactExports.useState(null),Xr=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(ee,Ur=>ri(Ur)),[Gr,qr]=reactExports.useState(null),si=$db6c3485150b8e66$export$1ab7ae714698c4b8(Gr),oi=(ue=si==null?void 0:si.width)!==null&&ue!==void 0?ue:0,Yr=(pe=si==null?void 0:si.height)!==null&&pe!==void 0?pe:0,ii=Ze+(Je!=="center"?"-"+Je:""),ti=typeof it=="number"?it:{top:0,right:0,bottom:0,left:0,...it},ni=Array.isArray(et)?et:[et],ui=ni.length>0,yi={padding:ti,boundary:ni.filter($cf1ac5d9fe0e8206$var$isNotNull),altBoundary:ui},{refs:hi,floatingStyles:pi,placement:Ri,isPositioned:Ei,middlewareData:bi}=useFloating({strategy:"fixed",placement:ii,whileElementsMounted:autoUpdate,elements:{reference:Nr.anchor},middleware:[offset({mainAxis:Xe+Yr,alignmentAxis:tt}),lt&&shift({mainAxis:!0,crossAxis:!1,limiter:nt==="partial"?limitShift():void 0,...yi}),lt&&flip({...yi}),size({...yi,apply:({elements:Ur,rects:ai,availableWidth:li,availableHeight:ci})=>{const{width:Ci,height:mi}=ai.reference,Ii=Ur.floating.style;Ii.setProperty("--radix-popper-available-width",`${li}px`),Ii.setProperty("--radix-popper-available-height",`${ci}px`),Ii.setProperty("--radix-popper-anchor-width",`${Ci}px`),Ii.setProperty("--radix-popper-anchor-height",`${mi}px`)}}),Gr&&arrow({element:Gr,padding:rt}),$cf1ac5d9fe0e8206$var$transformOrigin({arrowWidth:oi,arrowHeight:Yr}),st&&hide({strategy:"referenceHidden"})]}),[_i,vi]=$cf1ac5d9fe0e8206$var$getSideAndAlignFromPlacement(Ri),Ti=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(_r);$9f79659886946c16$export$e5c5a5f917a5871c(()=>{Ei&&(Ti==null||Ti())},[Ei,Ti]);const Fi=(_e=bi.arrow)===null||_e===void 0?void 0:_e.x,Li=(Ne=bi.arrow)===null||Ne===void 0?void 0:Ne.y,Di=((Ue=bi.arrow)===null||Ue===void 0?void 0:Ue.centerOffset)!==0,[Oi,ot]=reactExports.useState();return $9f79659886946c16$export$e5c5a5f917a5871c(()=>{Wr&&ot(window.getComputedStyle(Wr).zIndex)},[Wr]),reactExports.createElement("div",{ref:hi.setFloating,"data-radix-popper-content-wrapper":"",style:{...pi,transform:Ei?pi.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Oi,"--radix-popper-transform-origin":[(Ge=bi.transformOrigin)===null||Ge===void 0?void 0:Ge.x,(qe=bi.transformOrigin)===null||qe===void 0?void 0:qe.y].join(" ")},dir:fe.dir},reactExports.createElement($cf1ac5d9fe0e8206$var$PopperContentProvider,{scope:Ye,placedSide:_i,onArrowChange:qr,arrowX:Fi,arrowY:Li,shouldHideArrow:Di},reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({"data-side":_i,"data-align":vi},jr,{ref:Xr,style:{...jr.style,animation:Ei?void 0:"none",opacity:(Ke=bi.hide)!==null&&Ke!==void 0&&Ke.referenceHidden?0:void 0}}))))});function $cf1ac5d9fe0e8206$var$isNotNull(fe){return fe!==null}const $cf1ac5d9fe0e8206$var$transformOrigin=fe=>({name:"transformOrigin",options:fe,fn(ee){var ue,pe,_e,Ne,Ue;const{placement:Ge,rects:qe,middlewareData:Ke}=ee,Ze=((ue=Ke.arrow)===null||ue===void 0?void 0:ue.centerOffset)!==0,Xe=Ze?0:fe.arrowWidth,Je=Ze?0:fe.arrowHeight,[tt,rt]=$cf1ac5d9fe0e8206$var$getSideAndAlignFromPlacement(Ge),et={start:"0%",center:"50%",end:"100%"}[rt],it=((pe=(_e=Ke.arrow)===null||_e===void 0?void 0:_e.x)!==null&&pe!==void 0?pe:0)+Xe/2,nt=((Ne=(Ue=Ke.arrow)===null||Ue===void 0?void 0:Ue.y)!==null&&Ne!==void 0?Ne:0)+Je/2;let st="",lt="";return tt==="bottom"?(st=Ze?et:`${it}px`,lt=`${-Je}px`):tt==="top"?(st=Ze?et:`${it}px`,lt=`${qe.floating.height+Je}px`):tt==="right"?(st=`${-Je}px`,lt=Ze?et:`${nt}px`):tt==="left"&&(st=`${qe.floating.width+Je}px`,lt=Ze?et:`${nt}px`),{data:{x:st,y:lt}}}});function $cf1ac5d9fe0e8206$var$getSideAndAlignFromPlacement(fe){const[ee,ue="center"]=fe.split("-");return[ee,ue]}const $cf1ac5d9fe0e8206$export$be92b6f5f03c0fe9=$cf1ac5d9fe0e8206$export$badac9ada3a0bdf9,$cf1ac5d9fe0e8206$export$b688253958b8dfe7=$cf1ac5d9fe0e8206$export$ecd4e1ccab6ed6d,$cf1ac5d9fe0e8206$export$7c6e2c02157bb7d2=$cf1ac5d9fe0e8206$export$bc4ae5855d3c4fc,$f1701beae083dbae$export$602eac185826482c=reactExports.forwardRef((fe,ee)=>{var ue;const{container:pe=globalThis==null||(ue=globalThis.document)===null||ue===void 0?void 0:ue.body,..._e}=fe;return pe?$7SXl2$reactdom.createPortal(reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({},_e,{ref:ee})),pe):null}),$ea1ef594cf570d83$export$439d29a4e110a164=reactExports.forwardRef((fe,ee)=>reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.span,_extends$1({},fe,{ref:ee,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...fe.style}}))),$cc7e05a45900e73f$var$OPEN_KEYS=[" ","Enter","ArrowUp","ArrowDown"],$cc7e05a45900e73f$var$SELECTION_KEYS=[" ","Enter"],$cc7e05a45900e73f$var$SELECT_NAME="Select",[$cc7e05a45900e73f$var$Collection,$cc7e05a45900e73f$var$useCollection,$cc7e05a45900e73f$var$createCollectionScope]=$e02a7d9cb1dc128c$export$c74125a8e3af6bb2($cc7e05a45900e73f$var$SELECT_NAME),[$cc7e05a45900e73f$var$createSelectContext,$cc7e05a45900e73f$export$286727a75dc039bd]=$c512c27ab02ef895$export$50c7b4e9d9f19c1($cc7e05a45900e73f$var$SELECT_NAME,[$cc7e05a45900e73f$var$createCollectionScope,$cf1ac5d9fe0e8206$export$722aac194ae923]),$cc7e05a45900e73f$var$usePopperScope=$cf1ac5d9fe0e8206$export$722aac194ae923(),[$cc7e05a45900e73f$var$SelectProvider,$cc7e05a45900e73f$var$useSelectContext]=$cc7e05a45900e73f$var$createSelectContext($cc7e05a45900e73f$var$SELECT_NAME),[$cc7e05a45900e73f$var$SelectNativeOptionsProvider,$cc7e05a45900e73f$var$useSelectNativeOptionsContext]=$cc7e05a45900e73f$var$createSelectContext($cc7e05a45900e73f$var$SELECT_NAME),$cc7e05a45900e73f$export$ef9b1a59e592288f=fe=>{const{__scopeSelect:ee,children:ue,open:pe,defaultOpen:_e,onOpenChange:Ne,value:Ue,defaultValue:Ge,onValueChange:qe,dir:Ke,name:Ye,autoComplete:Ze,disabled:Xe,required:Je}=fe,tt=$cc7e05a45900e73f$var$usePopperScope(ee),[rt,et]=reactExports.useState(null),[it,nt]=reactExports.useState(null),[st,lt]=reactExports.useState(!1),_r=$f631663db3294ace$export$b39126d51d94e6f3(Ke),[jr=!1,Nr]=$71cd76cc60e0454e$export$6f32135080cb4c3({prop:pe,defaultProp:_e,onChange:Ne}),[Wr,ri]=$71cd76cc60e0454e$export$6f32135080cb4c3({prop:Ue,defaultProp:Ge,onChange:qe}),Xr=reactExports.useRef(null),Gr=rt?!!rt.closest("form"):!0,[qr,si]=reactExports.useState(new Set),oi=Array.from(qr).map(Yr=>Yr.props.value).join(";");return reactExports.createElement($cf1ac5d9fe0e8206$export$be92b6f5f03c0fe9,tt,reactExports.createElement($cc7e05a45900e73f$var$SelectProvider,{required:Je,scope:ee,trigger:rt,onTriggerChange:et,valueNode:it,onValueNodeChange:nt,valueNodeHasChildren:st,onValueNodeHasChildrenChange:lt,contentId:$1746a345f3d73bb7$export$f680877a34711e37(),value:Wr,onValueChange:ri,open:jr,onOpenChange:Nr,dir:_r,triggerPointerDownPosRef:Xr,disabled:Xe},reactExports.createElement($cc7e05a45900e73f$var$Collection.Provider,{scope:ee},reactExports.createElement($cc7e05a45900e73f$var$SelectNativeOptionsProvider,{scope:fe.__scopeSelect,onNativeOptionAdd:reactExports.useCallback(Yr=>{si(ii=>new Set(ii).add(Yr))},[]),onNativeOptionRemove:reactExports.useCallback(Yr=>{si(ii=>{const ti=new Set(ii);return ti.delete(Yr),ti})},[])},ue)),Gr?reactExports.createElement($cc7e05a45900e73f$var$BubbleSelect,{key:oi,"aria-hidden":!0,required:Je,tabIndex:-1,name:Ye,autoComplete:Ze,value:Wr,onChange:Yr=>ri(Yr.target.value),disabled:Xe},Wr===void 0?reactExports.createElement("option",{value:""}):null,Array.from(qr)):null))},$cc7e05a45900e73f$var$TRIGGER_NAME="SelectTrigger",$cc7e05a45900e73f$export$3ac1e88a1c0b9f1=reactExports.forwardRef((fe,ee)=>{const{__scopeSelect:ue,disabled:pe=!1,..._e}=fe,Ne=$cc7e05a45900e73f$var$usePopperScope(ue),Ue=$cc7e05a45900e73f$var$useSelectContext($cc7e05a45900e73f$var$TRIGGER_NAME,ue),Ge=Ue.disabled||pe,qe=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(ee,Ue.onTriggerChange),Ke=$cc7e05a45900e73f$var$useCollection(ue),[Ye,Ze,Xe]=$cc7e05a45900e73f$var$useTypeaheadSearch(tt=>{const rt=Ke().filter(nt=>!nt.disabled),et=rt.find(nt=>nt.value===Ue.value),it=$cc7e05a45900e73f$var$findNextItem(rt,tt,et);it!==void 0&&Ue.onValueChange(it.value)}),Je=()=>{Ge||(Ue.onOpenChange(!0),Xe())};return reactExports.createElement($cf1ac5d9fe0e8206$export$b688253958b8dfe7,_extends$1({asChild:!0},Ne),reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.button,_extends$1({type:"button",role:"combobox","aria-controls":Ue.contentId,"aria-expanded":Ue.open,"aria-required":Ue.required,"aria-autocomplete":"none",dir:Ue.dir,"data-state":Ue.open?"open":"closed",disabled:Ge,"data-disabled":Ge?"":void 0,"data-placeholder":Ue.value===void 0?"":void 0},_e,{ref:qe,onClick:$e42e1063c40fb3ef$export$b9ecd428b558ff10(_e.onClick,tt=>{tt.currentTarget.focus()}),onPointerDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(_e.onPointerDown,tt=>{const rt=tt.target;rt.hasPointerCapture(tt.pointerId)&&rt.releasePointerCapture(tt.pointerId),tt.button===0&&tt.ctrlKey===!1&&(Je(),Ue.triggerPointerDownPosRef.current={x:Math.round(tt.pageX),y:Math.round(tt.pageY)},tt.preventDefault())}),onKeyDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(_e.onKeyDown,tt=>{const rt=Ye.current!=="";!(tt.ctrlKey||tt.altKey||tt.metaKey)&&tt.key.length===1&&Ze(tt.key),!(rt&&tt.key===" ")&&$cc7e05a45900e73f$var$OPEN_KEYS.includes(tt.key)&&(Je(),tt.preventDefault())})})))}),$cc7e05a45900e73f$var$VALUE_NAME="SelectValue",$cc7e05a45900e73f$export$e288731fd71264f0=reactExports.forwardRef((fe,ee)=>{const{__scopeSelect:ue,className:pe,style:_e,children:Ne,placeholder:Ue,...Ge}=fe,qe=$cc7e05a45900e73f$var$useSelectContext($cc7e05a45900e73f$var$VALUE_NAME,ue),{onValueNodeHasChildrenChange:Ke}=qe,Ye=Ne!==void 0,Ze=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(ee,qe.onValueNodeChange);return $9f79659886946c16$export$e5c5a5f917a5871c(()=>{Ke(Ye)},[Ke,Ye]),reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.span,_extends$1({},Ge,{ref:Ze,style:{pointerEvents:"none"}}),qe.value===void 0&&Ue!==void 0?Ue:Ne)}),$cc7e05a45900e73f$export$99b400cabb58c515=reactExports.forwardRef((fe,ee)=>{const{__scopeSelect:ue,children:pe,..._e}=fe;return reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.span,_extends$1({"aria-hidden":!0},_e,{ref:ee}),pe||"")}),$cc7e05a45900e73f$export$b2af6c9944296213=fe=>reactExports.createElement($f1701beae083dbae$export$602eac185826482c,_extends$1({asChild:!0},fe)),$cc7e05a45900e73f$var$CONTENT_NAME="SelectContent",$cc7e05a45900e73f$export$c973a4b3cb86a03d=reactExports.forwardRef((fe,ee)=>{const ue=$cc7e05a45900e73f$var$useSelectContext($cc7e05a45900e73f$var$CONTENT_NAME,fe.__scopeSelect),[pe,_e]=reactExports.useState();if($9f79659886946c16$export$e5c5a5f917a5871c(()=>{_e(new DocumentFragment)},[]),!ue.open){const Ne=pe;return Ne?reactDomExports.createPortal(reactExports.createElement($cc7e05a45900e73f$var$SelectContentProvider,{scope:fe.__scopeSelect},reactExports.createElement($cc7e05a45900e73f$var$Collection.Slot,{scope:fe.__scopeSelect},reactExports.createElement("div",null,fe.children))),Ne):null}return reactExports.createElement($cc7e05a45900e73f$var$SelectContentImpl,_extends$1({},fe,{ref:ee}))}),$cc7e05a45900e73f$var$CONTENT_MARGIN=10,[$cc7e05a45900e73f$var$SelectContentProvider,$cc7e05a45900e73f$var$useSelectContentContext]=$cc7e05a45900e73f$var$createSelectContext($cc7e05a45900e73f$var$CONTENT_NAME),$cc7e05a45900e73f$var$SelectContentImpl=reactExports.forwardRef((fe,ee)=>{const{__scopeSelect:ue,position:pe="item-aligned",onCloseAutoFocus:_e,onEscapeKeyDown:Ne,onPointerDownOutside:Ue,side:Ge,sideOffset:qe,align:Ke,alignOffset:Ye,arrowPadding:Ze,collisionBoundary:Xe,collisionPadding:Je,sticky:tt,hideWhenDetached:rt,avoidCollisions:et,...it}=fe,nt=$cc7e05a45900e73f$var$useSelectContext($cc7e05a45900e73f$var$CONTENT_NAME,ue),[st,lt]=reactExports.useState(null),[_r,jr]=reactExports.useState(null),Nr=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(ee,vi=>lt(vi)),[Wr,ri]=reactExports.useState(null),[Xr,Gr]=reactExports.useState(null),qr=$cc7e05a45900e73f$var$useCollection(ue),[si,oi]=reactExports.useState(!1),Yr=reactExports.useRef(!1);reactExports.useEffect(()=>{if(st)return hideOthers(st)},[st]),$3db38b7d1fb3fe6a$export$b7ece24a22aeda8c();const ii=reactExports.useCallback(vi=>{const[Ti,...Fi]=qr().map(Oi=>Oi.ref.current),[Li]=Fi.slice(-1),Di=document.activeElement;for(const Oi of vi)if(Oi===Di||(Oi==null||Oi.scrollIntoView({block:"nearest"}),Oi===Ti&&_r&&(_r.scrollTop=0),Oi===Li&&_r&&(_r.scrollTop=_r.scrollHeight),Oi==null||Oi.focus(),document.activeElement!==Di))return},[qr,_r]),ti=reactExports.useCallback(()=>ii([Wr,st]),[ii,Wr,st]);reactExports.useEffect(()=>{si&&ti()},[si,ti]);const{onOpenChange:ni,triggerPointerDownPosRef:ui}=nt;reactExports.useEffect(()=>{if(st){let vi={x:0,y:0};const Ti=Li=>{var Di,Oi,ot,Ur;vi={x:Math.abs(Math.round(Li.pageX)-((Di=(Oi=ui.current)===null||Oi===void 0?void 0:Oi.x)!==null&&Di!==void 0?Di:0)),y:Math.abs(Math.round(Li.pageY)-((ot=(Ur=ui.current)===null||Ur===void 0?void 0:Ur.y)!==null&&ot!==void 0?ot:0))}},Fi=Li=>{vi.x<=10&&vi.y<=10?Li.preventDefault():st.contains(Li.target)||ni(!1),document.removeEventListener("pointermove",Ti),ui.current=null};return ui.current!==null&&(document.addEventListener("pointermove",Ti),document.addEventListener("pointerup",Fi,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",Ti),document.removeEventListener("pointerup",Fi,{capture:!0})}}},[st,ni,ui]),reactExports.useEffect(()=>{const vi=()=>ni(!1);return window.addEventListener("blur",vi),window.addEventListener("resize",vi),()=>{window.removeEventListener("blur",vi),window.removeEventListener("resize",vi)}},[ni]);const[yi,hi]=$cc7e05a45900e73f$var$useTypeaheadSearch(vi=>{const Ti=qr().filter(Di=>!Di.disabled),Fi=Ti.find(Di=>Di.ref.current===document.activeElement),Li=$cc7e05a45900e73f$var$findNextItem(Ti,vi,Fi);Li&&setTimeout(()=>Li.ref.current.focus())}),pi=reactExports.useCallback((vi,Ti,Fi)=>{const Li=!Yr.current&&!Fi;(nt.value!==void 0&&nt.value===Ti||Li)&&(ri(vi),Li&&(Yr.current=!0))},[nt.value]),Ri=reactExports.useCallback(()=>st==null?void 0:st.focus(),[st]),Ei=reactExports.useCallback((vi,Ti,Fi)=>{const Li=!Yr.current&&!Fi;(nt.value!==void 0&&nt.value===Ti||Li)&&Gr(vi)},[nt.value]),bi=pe==="popper"?$cc7e05a45900e73f$var$SelectPopperPosition:$cc7e05a45900e73f$var$SelectItemAlignedPosition,_i=bi===$cc7e05a45900e73f$var$SelectPopperPosition?{side:Ge,sideOffset:qe,align:Ke,alignOffset:Ye,arrowPadding:Ze,collisionBoundary:Xe,collisionPadding:Je,sticky:tt,hideWhenDetached:rt,avoidCollisions:et}:{};return reactExports.createElement($cc7e05a45900e73f$var$SelectContentProvider,{scope:ue,content:st,viewport:_r,onViewportChange:jr,itemRefCallback:pi,selectedItem:Wr,onItemLeave:Ri,itemTextRefCallback:Ei,focusSelectedItem:ti,selectedItemText:Xr,position:pe,isPositioned:si,searchRef:yi},reactExports.createElement($01b9c$RemoveScroll,{as:$5e63c961fc1ce211$export$8c6ed5c666ac1360,allowPinchZoom:!0},reactExports.createElement($d3863c46a17e8a28$export$20e40289641fbbb6,{asChild:!0,trapped:nt.open,onMountAutoFocus:vi=>{vi.preventDefault()},onUnmountAutoFocus:$e42e1063c40fb3ef$export$b9ecd428b558ff10(_e,vi=>{var Ti;(Ti=nt.trigger)===null||Ti===void 0||Ti.focus({preventScroll:!0}),vi.preventDefault()})},reactExports.createElement($5cb92bef7577960e$export$177fb62ff3ec1f22,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:Ne,onPointerDownOutside:Ue,onFocusOutside:vi=>vi.preventDefault(),onDismiss:()=>nt.onOpenChange(!1)},reactExports.createElement(bi,_extends$1({role:"listbox",id:nt.contentId,"data-state":nt.open?"open":"closed",dir:nt.dir,onContextMenu:vi=>vi.preventDefault()},it,_i,{onPlaced:()=>oi(!0),ref:Nr,style:{display:"flex",flexDirection:"column",outline:"none",...it.style},onKeyDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(it.onKeyDown,vi=>{const Ti=vi.ctrlKey||vi.altKey||vi.metaKey;if(vi.key==="Tab"&&vi.preventDefault(),!Ti&&vi.key.length===1&&hi(vi.key),["ArrowUp","ArrowDown","Home","End"].includes(vi.key)){let Li=qr().filter(Di=>!Di.disabled).map(Di=>Di.ref.current);if(["ArrowUp","End"].includes(vi.key)&&(Li=Li.slice().reverse()),["ArrowUp","ArrowDown"].includes(vi.key)){const Di=vi.target,Oi=Li.indexOf(Di);Li=Li.slice(Oi+1)}setTimeout(()=>ii(Li)),vi.preventDefault()}})}))))))}),$cc7e05a45900e73f$var$SelectItemAlignedPosition=reactExports.forwardRef((fe,ee)=>{const{__scopeSelect:ue,onPlaced:pe,..._e}=fe,Ne=$cc7e05a45900e73f$var$useSelectContext($cc7e05a45900e73f$var$CONTENT_NAME,ue),Ue=$cc7e05a45900e73f$var$useSelectContentContext($cc7e05a45900e73f$var$CONTENT_NAME,ue),[Ge,qe]=reactExports.useState(null),[Ke,Ye]=reactExports.useState(null),Ze=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(ee,Nr=>Ye(Nr)),Xe=$cc7e05a45900e73f$var$useCollection(ue),Je=reactExports.useRef(!1),tt=reactExports.useRef(!0),{viewport:rt,selectedItem:et,selectedItemText:it,focusSelectedItem:nt}=Ue,st=reactExports.useCallback(()=>{if(Ne.trigger&&Ne.valueNode&&Ge&&Ke&&rt&&et&&it){const Nr=Ne.trigger.getBoundingClientRect(),Wr=Ke.getBoundingClientRect(),ri=Ne.valueNode.getBoundingClientRect(),Xr=it.getBoundingClientRect();if(Ne.dir!=="rtl"){const Di=Xr.left-Wr.left,Oi=ri.left-Di,ot=Nr.left-Oi,Ur=Nr.width+ot,ai=Math.max(Ur,Wr.width),li=window.innerWidth-$cc7e05a45900e73f$var$CONTENT_MARGIN,ci=$ae6933e535247d3d$export$7d15b64cf5a3a4c4(Oi,[$cc7e05a45900e73f$var$CONTENT_MARGIN,li-ai]);Ge.style.minWidth=Ur+"px",Ge.style.left=ci+"px"}else{const Di=Wr.right-Xr.right,Oi=window.innerWidth-ri.right-Di,ot=window.innerWidth-Nr.right-Oi,Ur=Nr.width+ot,ai=Math.max(Ur,Wr.width),li=window.innerWidth-$cc7e05a45900e73f$var$CONTENT_MARGIN,ci=$ae6933e535247d3d$export$7d15b64cf5a3a4c4(Oi,[$cc7e05a45900e73f$var$CONTENT_MARGIN,li-ai]);Ge.style.minWidth=Ur+"px",Ge.style.right=ci+"px"}const Gr=Xe(),qr=window.innerHeight-$cc7e05a45900e73f$var$CONTENT_MARGIN*2,si=rt.scrollHeight,oi=window.getComputedStyle(Ke),Yr=parseInt(oi.borderTopWidth,10),ii=parseInt(oi.paddingTop,10),ti=parseInt(oi.borderBottomWidth,10),ni=parseInt(oi.paddingBottom,10),ui=Yr+ii+si+ni+ti,yi=Math.min(et.offsetHeight*5,ui),hi=window.getComputedStyle(rt),pi=parseInt(hi.paddingTop,10),Ri=parseInt(hi.paddingBottom,10),Ei=Nr.top+Nr.height/2-$cc7e05a45900e73f$var$CONTENT_MARGIN,bi=qr-Ei,_i=et.offsetHeight/2,vi=et.offsetTop+_i,Ti=Yr+ii+vi,Fi=ui-Ti;if(Ti<=Ei){const Di=et===Gr[Gr.length-1].ref.current;Ge.style.bottom="0px";const Oi=Ke.clientHeight-rt.offsetTop-rt.offsetHeight,ot=Math.max(bi,_i+(Di?Ri:0)+Oi+ti),Ur=Ti+ot;Ge.style.height=Ur+"px"}else{const Di=et===Gr[0].ref.current;Ge.style.top="0px";const ot=Math.max(Ei,Yr+rt.offsetTop+(Di?pi:0)+_i)+Fi;Ge.style.height=ot+"px",rt.scrollTop=Ti-Ei+rt.offsetTop}Ge.style.margin=`${$cc7e05a45900e73f$var$CONTENT_MARGIN}px 0`,Ge.style.minHeight=yi+"px",Ge.style.maxHeight=qr+"px",pe==null||pe(),requestAnimationFrame(()=>Je.current=!0)}},[Xe,Ne.trigger,Ne.valueNode,Ge,Ke,rt,et,it,Ne.dir,pe]);$9f79659886946c16$export$e5c5a5f917a5871c(()=>st(),[st]);const[lt,_r]=reactExports.useState();$9f79659886946c16$export$e5c5a5f917a5871c(()=>{Ke&&_r(window.getComputedStyle(Ke).zIndex)},[Ke]);const jr=reactExports.useCallback(Nr=>{Nr&&tt.current===!0&&(st(),nt==null||nt(),tt.current=!1)},[st,nt]);return reactExports.createElement($cc7e05a45900e73f$var$SelectViewportProvider,{scope:ue,contentWrapper:Ge,shouldExpandOnScrollRef:Je,onScrollButtonChange:jr},reactExports.createElement("div",{ref:qe,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:lt}},reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({},_e,{ref:Ze,style:{boxSizing:"border-box",maxHeight:"100%",..._e.style}}))))}),$cc7e05a45900e73f$var$SelectPopperPosition=reactExports.forwardRef((fe,ee)=>{const{__scopeSelect:ue,align:pe="start",collisionPadding:_e=$cc7e05a45900e73f$var$CONTENT_MARGIN,...Ne}=fe,Ue=$cc7e05a45900e73f$var$usePopperScope(ue);return reactExports.createElement($cf1ac5d9fe0e8206$export$7c6e2c02157bb7d2,_extends$1({},Ue,Ne,{ref:ee,align:pe,collisionPadding:_e,style:{boxSizing:"border-box",...Ne.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}}))}),[$cc7e05a45900e73f$var$SelectViewportProvider,$cc7e05a45900e73f$var$useSelectViewportContext]=$cc7e05a45900e73f$var$createSelectContext($cc7e05a45900e73f$var$CONTENT_NAME,{}),$cc7e05a45900e73f$var$VIEWPORT_NAME="SelectViewport",$cc7e05a45900e73f$export$9ed6e7b40248d36d=reactExports.forwardRef((fe,ee)=>{const{__scopeSelect:ue,...pe}=fe,_e=$cc7e05a45900e73f$var$useSelectContentContext($cc7e05a45900e73f$var$VIEWPORT_NAME,ue),Ne=$cc7e05a45900e73f$var$useSelectViewportContext($cc7e05a45900e73f$var$VIEWPORT_NAME,ue),Ue=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(ee,_e.onViewportChange),Ge=reactExports.useRef(0);return reactExports.createElement(reactExports.Fragment,null,reactExports.createElement("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"}}),reactExports.createElement($cc7e05a45900e73f$var$Collection.Slot,{scope:ue},reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({"data-radix-select-viewport":"",role:"presentation"},pe,{ref:Ue,style:{position:"relative",flex:1,overflow:"auto",...pe.style},onScroll:$e42e1063c40fb3ef$export$b9ecd428b558ff10(pe.onScroll,qe=>{const Ke=qe.currentTarget,{contentWrapper:Ye,shouldExpandOnScrollRef:Ze}=Ne;if(Ze!=null&&Ze.current&&Ye){const Xe=Math.abs(Ge.current-Ke.scrollTop);if(Xe>0){const Je=window.innerHeight-$cc7e05a45900e73f$var$CONTENT_MARGIN*2,tt=parseFloat(Ye.style.minHeight),rt=parseFloat(Ye.style.height),et=Math.max(tt,rt);if(et<Je){const it=et+Xe,nt=Math.min(Je,it),st=it-nt;Ye.style.height=nt+"px",Ye.style.bottom==="0px"&&(Ke.scrollTop=st>0?st:0,Ye.style.justifyContent="flex-end")}}}Ge.current=Ke.scrollTop})}))))}),$cc7e05a45900e73f$var$GROUP_NAME="SelectGroup",[$cc7e05a45900e73f$var$SelectGroupContextProvider,$cc7e05a45900e73f$var$useSelectGroupContext]=$cc7e05a45900e73f$var$createSelectContext($cc7e05a45900e73f$var$GROUP_NAME),$cc7e05a45900e73f$export$ee25a334c55de1f4=reactExports.forwardRef((fe,ee)=>{const{__scopeSelect:ue,...pe}=fe,_e=$1746a345f3d73bb7$export$f680877a34711e37();return reactExports.createElement($cc7e05a45900e73f$var$SelectGroupContextProvider,{scope:ue,id:_e},reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({role:"group","aria-labelledby":_e},pe,{ref:ee})))}),$cc7e05a45900e73f$var$LABEL_NAME="SelectLabel",$cc7e05a45900e73f$export$f67338d29bd972f8=reactExports.forwardRef((fe,ee)=>{const{__scopeSelect:ue,...pe}=fe,_e=$cc7e05a45900e73f$var$useSelectGroupContext($cc7e05a45900e73f$var$LABEL_NAME,ue);return reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({id:_e.id},pe,{ref:ee}))}),$cc7e05a45900e73f$var$ITEM_NAME="SelectItem",[$cc7e05a45900e73f$var$SelectItemContextProvider,$cc7e05a45900e73f$var$useSelectItemContext]=$cc7e05a45900e73f$var$createSelectContext($cc7e05a45900e73f$var$ITEM_NAME),$cc7e05a45900e73f$export$13ef48a934230896=reactExports.forwardRef((fe,ee)=>{const{__scopeSelect:ue,value:pe,disabled:_e=!1,textValue:Ne,...Ue}=fe,Ge=$cc7e05a45900e73f$var$useSelectContext($cc7e05a45900e73f$var$ITEM_NAME,ue),qe=$cc7e05a45900e73f$var$useSelectContentContext($cc7e05a45900e73f$var$ITEM_NAME,ue),Ke=Ge.value===pe,[Ye,Ze]=reactExports.useState(Ne??""),[Xe,Je]=reactExports.useState(!1),tt=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(ee,it=>{var nt;return(nt=qe.itemRefCallback)===null||nt===void 0?void 0:nt.call(qe,it,pe,_e)}),rt=$1746a345f3d73bb7$export$f680877a34711e37(),et=()=>{_e||(Ge.onValueChange(pe),Ge.onOpenChange(!1))};return reactExports.createElement($cc7e05a45900e73f$var$SelectItemContextProvider,{scope:ue,value:pe,disabled:_e,textId:rt,isSelected:Ke,onItemTextChange:reactExports.useCallback(it=>{Ze(nt=>{var st;return nt||((st=it==null?void 0:it.textContent)!==null&&st!==void 0?st:"").trim()})},[])},reactExports.createElement($cc7e05a45900e73f$var$Collection.ItemSlot,{scope:ue,value:pe,disabled:_e,textValue:Ye},reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({role:"option","aria-labelledby":rt,"data-highlighted":Xe?"":void 0,"aria-selected":Ke&&Xe,"data-state":Ke?"checked":"unchecked","aria-disabled":_e||void 0,"data-disabled":_e?"":void 0,tabIndex:_e?void 0:-1},Ue,{ref:tt,onFocus:$e42e1063c40fb3ef$export$b9ecd428b558ff10(Ue.onFocus,()=>Je(!0)),onBlur:$e42e1063c40fb3ef$export$b9ecd428b558ff10(Ue.onBlur,()=>Je(!1)),onPointerUp:$e42e1063c40fb3ef$export$b9ecd428b558ff10(Ue.onPointerUp,et),onPointerMove:$e42e1063c40fb3ef$export$b9ecd428b558ff10(Ue.onPointerMove,it=>{if(_e){var nt;(nt=qe.onItemLeave)===null||nt===void 0||nt.call(qe)}else it.currentTarget.focus({preventScroll:!0})}),onPointerLeave:$e42e1063c40fb3ef$export$b9ecd428b558ff10(Ue.onPointerLeave,it=>{if(it.currentTarget===document.activeElement){var nt;(nt=qe.onItemLeave)===null||nt===void 0||nt.call(qe)}}),onKeyDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(Ue.onKeyDown,it=>{var nt;((nt=qe.searchRef)===null||nt===void 0?void 0:nt.current)!==""&&it.key===" "||($cc7e05a45900e73f$var$SELECTION_KEYS.includes(it.key)&&et(),it.key===" "&&it.preventDefault())})}))))}),$cc7e05a45900e73f$var$ITEM_TEXT_NAME="SelectItemText",$cc7e05a45900e73f$export$3572fb0fb821ff49=reactExports.forwardRef((fe,ee)=>{const{__scopeSelect:ue,className:pe,style:_e,...Ne}=fe,Ue=$cc7e05a45900e73f$var$useSelectContext($cc7e05a45900e73f$var$ITEM_TEXT_NAME,ue),Ge=$cc7e05a45900e73f$var$useSelectContentContext($cc7e05a45900e73f$var$ITEM_TEXT_NAME,ue),qe=$cc7e05a45900e73f$var$useSelectItemContext($cc7e05a45900e73f$var$ITEM_TEXT_NAME,ue),Ke=$cc7e05a45900e73f$var$useSelectNativeOptionsContext($cc7e05a45900e73f$var$ITEM_TEXT_NAME,ue),[Ye,Ze]=reactExports.useState(null),Xe=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(ee,it=>Ze(it),qe.onItemTextChange,it=>{var nt;return(nt=Ge.itemTextRefCallback)===null||nt===void 0?void 0:nt.call(Ge,it,qe.value,qe.disabled)}),Je=Ye==null?void 0:Ye.textContent,tt=reactExports.useMemo(()=>reactExports.createElement("option",{key:qe.value,value:qe.value,disabled:qe.disabled},Je),[qe.disabled,qe.value,Je]),{onNativeOptionAdd:rt,onNativeOptionRemove:et}=Ke;return $9f79659886946c16$export$e5c5a5f917a5871c(()=>(rt(tt),()=>et(tt)),[rt,et,tt]),reactExports.createElement(reactExports.Fragment,null,reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.span,_extends$1({id:qe.textId},Ne,{ref:Xe})),qe.isSelected&&Ue.valueNode&&!Ue.valueNodeHasChildren?reactDomExports.createPortal(Ne.children,Ue.valueNode):null)}),$cc7e05a45900e73f$var$ITEM_INDICATOR_NAME="SelectItemIndicator",$cc7e05a45900e73f$export$6b9198de19accfe6=reactExports.forwardRef((fe,ee)=>{const{__scopeSelect:ue,...pe}=fe;return $cc7e05a45900e73f$var$useSelectItemContext($cc7e05a45900e73f$var$ITEM_INDICATOR_NAME,ue).isSelected?reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.span,_extends$1({"aria-hidden":!0},pe,{ref:ee})):null}),$cc7e05a45900e73f$var$SCROLL_UP_BUTTON_NAME="SelectScrollUpButton",$cc7e05a45900e73f$export$d8117927658af6d7=reactExports.forwardRef((fe,ee)=>{const ue=$cc7e05a45900e73f$var$useSelectContentContext($cc7e05a45900e73f$var$SCROLL_UP_BUTTON_NAME,fe.__scopeSelect),pe=$cc7e05a45900e73f$var$useSelectViewportContext($cc7e05a45900e73f$var$SCROLL_UP_BUTTON_NAME,fe.__scopeSelect),[_e,Ne]=reactExports.useState(!1),Ue=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(ee,pe.onScrollButtonChange);return $9f79659886946c16$export$e5c5a5f917a5871c(()=>{if(ue.viewport&&ue.isPositioned){let qe=function(){const Ke=Ge.scrollTop>0;Ne(Ke)};const Ge=ue.viewport;return qe(),Ge.addEventListener("scroll",qe),()=>Ge.removeEventListener("scroll",qe)}},[ue.viewport,ue.isPositioned]),_e?reactExports.createElement($cc7e05a45900e73f$var$SelectScrollButtonImpl,_extends$1({},fe,{ref:Ue,onAutoScroll:()=>{const{viewport:Ge,selectedItem:qe}=ue;Ge&&qe&&(Ge.scrollTop=Ge.scrollTop-qe.offsetHeight)}})):null}),$cc7e05a45900e73f$var$SCROLL_DOWN_BUTTON_NAME="SelectScrollDownButton",$cc7e05a45900e73f$export$ff951e476c12189=reactExports.forwardRef((fe,ee)=>{const ue=$cc7e05a45900e73f$var$useSelectContentContext($cc7e05a45900e73f$var$SCROLL_DOWN_BUTTON_NAME,fe.__scopeSelect),pe=$cc7e05a45900e73f$var$useSelectViewportContext($cc7e05a45900e73f$var$SCROLL_DOWN_BUTTON_NAME,fe.__scopeSelect),[_e,Ne]=reactExports.useState(!1),Ue=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(ee,pe.onScrollButtonChange);return $9f79659886946c16$export$e5c5a5f917a5871c(()=>{if(ue.viewport&&ue.isPositioned){let qe=function(){const Ke=Ge.scrollHeight-Ge.clientHeight,Ye=Math.ceil(Ge.scrollTop)<Ke;Ne(Ye)};const Ge=ue.viewport;return qe(),Ge.addEventListener("scroll",qe),()=>Ge.removeEventListener("scroll",qe)}},[ue.viewport,ue.isPositioned]),_e?reactExports.createElement($cc7e05a45900e73f$var$SelectScrollButtonImpl,_extends$1({},fe,{ref:Ue,onAutoScroll:()=>{const{viewport:Ge,selectedItem:qe}=ue;Ge&&qe&&(Ge.scrollTop=Ge.scrollTop+qe.offsetHeight)}})):null}),$cc7e05a45900e73f$var$SelectScrollButtonImpl=reactExports.forwardRef((fe,ee)=>{const{__scopeSelect:ue,onAutoScroll:pe,..._e}=fe,Ne=$cc7e05a45900e73f$var$useSelectContentContext("SelectScrollButton",ue),Ue=reactExports.useRef(null),Ge=$cc7e05a45900e73f$var$useCollection(ue),qe=reactExports.useCallback(()=>{Ue.current!==null&&(window.clearInterval(Ue.current),Ue.current=null)},[]);return reactExports.useEffect(()=>()=>qe(),[qe]),$9f79659886946c16$export$e5c5a5f917a5871c(()=>{var Ke;const Ye=Ge().find(Ze=>Ze.ref.current===document.activeElement);Ye==null||(Ke=Ye.ref.current)===null||Ke===void 0||Ke.scrollIntoView({block:"nearest"})},[Ge]),reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({"aria-hidden":!0},_e,{ref:ee,style:{flexShrink:0,..._e.style},onPointerDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(_e.onPointerDown,()=>{Ue.current===null&&(Ue.current=window.setInterval(pe,50))}),onPointerMove:$e42e1063c40fb3ef$export$b9ecd428b558ff10(_e.onPointerMove,()=>{var Ke;(Ke=Ne.onItemLeave)===null||Ke===void 0||Ke.call(Ne),Ue.current===null&&(Ue.current=window.setInterval(pe,50))}),onPointerLeave:$e42e1063c40fb3ef$export$b9ecd428b558ff10(_e.onPointerLeave,()=>{qe()})}))}),$cc7e05a45900e73f$var$BubbleSelect=reactExports.forwardRef((fe,ee)=>{const{value:ue,...pe}=fe,_e=reactExports.useRef(null),Ne=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(ee,_e),Ue=$010c2913dbd2fe3d$export$5cae361ad82dce8b(ue);return reactExports.useEffect(()=>{const Ge=_e.current,qe=window.HTMLSelectElement.prototype,Ye=Object.getOwnPropertyDescriptor(qe,"value").set;if(Ue!==ue&&Ye){const Ze=new Event("change",{bubbles:!0});Ye.call(Ge,ue),Ge.dispatchEvent(Ze)}},[Ue,ue]),reactExports.createElement($ea1ef594cf570d83$export$439d29a4e110a164,{asChild:!0},reactExports.createElement("select",_extends$1({},pe,{ref:Ne,defaultValue:ue})))});$cc7e05a45900e73f$var$BubbleSelect.displayName="BubbleSelect";function $cc7e05a45900e73f$var$useTypeaheadSearch(fe){const ee=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(fe),ue=reactExports.useRef(""),pe=reactExports.useRef(0),_e=reactExports.useCallback(Ue=>{const Ge=ue.current+Ue;ee(Ge),function qe(Ke){ue.current=Ke,window.clearTimeout(pe.current),Ke!==""&&(pe.current=window.setTimeout(()=>qe(""),1e3))}(Ge)},[ee]),Ne=reactExports.useCallback(()=>{ue.current="",window.clearTimeout(pe.current)},[]);return reactExports.useEffect(()=>()=>window.clearTimeout(pe.current),[]),[ue,_e,Ne]}function $cc7e05a45900e73f$var$findNextItem(fe,ee,ue){const _e=ee.length>1&&Array.from(ee).every(Ke=>Ke===ee[0])?ee[0]:ee,Ne=ue?fe.indexOf(ue):-1;let Ue=$cc7e05a45900e73f$var$wrapArray(fe,Math.max(Ne,0));_e.length===1&&(Ue=Ue.filter(Ke=>Ke!==ue));const qe=Ue.find(Ke=>Ke.textValue.toLowerCase().startsWith(_e.toLowerCase()));return qe!==ue?qe:void 0}function $cc7e05a45900e73f$var$wrapArray(fe,ee){return fe.map((ue,pe)=>fe[(ee+pe)%fe.length])}const $cc7e05a45900e73f$export$be92b6f5f03c0fe9=$cc7e05a45900e73f$export$ef9b1a59e592288f,$cc7e05a45900e73f$export$41fb9f06171c75f4=$cc7e05a45900e73f$export$3ac1e88a1c0b9f1,$cc7e05a45900e73f$export$7c6e2c02157bb7d2=$cc7e05a45900e73f$export$c973a4b3cb86a03d,$cc7e05a45900e73f$export$b04be29aa201d4f5=$cc7e05a45900e73f$export$f67338d29bd972f8,$cc7e05a45900e73f$export$6d08773d2e66f8f2=$cc7e05a45900e73f$export$13ef48a934230896;var openseadragon={exports:{}};(function(module){//! openseadragon 2.4.2
//! Built on 2020-03-05
//! Git commit: v2.4.2-0-c450749
//! http://openseadragon.github.io
//! License: http://openseadragon.github.io/license/
function OpenSeadragon(fe){return new OpenSeadragon.Viewer(fe)}(function(fe){fe.version={versionStr:"2.4.2",major:parseInt("2",10),minor:parseInt("4",10),revision:parseInt("2",10)};var ee={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},ue=Object.prototype.toString,pe=Object.prototype.hasOwnProperty;fe.isFunction=function(_e){return fe.type(_e)==="function"},fe.isArray=Array.isArray||function(_e){return fe.type(_e)==="array"},fe.isWindow=function(_e){return _e&&typeof _e=="object"&&"setInterval"in _e},fe.type=function(_e){return _e==null?String(_e):ee[ue.call(_e)]||"object"},fe.isPlainObject=function(_e){if(!_e||OpenSeadragon.type(_e)!=="object"||_e.nodeType||fe.isWindow(_e)||_e.constructor&&!pe.call(_e,"constructor")&&!pe.call(_e.constructor.prototype,"isPrototypeOf"))return!1;var Ne;for(var Ue in _e)Ne=Ue;return Ne===void 0||pe.call(_e,Ne)},fe.isEmptyObject=function(_e){for(var Ne in _e)return!1;return!0},fe.freezeObject=function(_e){return Object.freeze?fe.freezeObject=Object.freeze:fe.freezeObject=function(Ne){return Ne},fe.freezeObject(_e)},fe.supportsCanvas=function(){var _e=document.createElement("canvas");return!!(fe.isFunction(_e.getContext)&&_e.getContext("2d"))}(),fe.isCanvasTainted=function(_e){var Ne=!1;try{_e.getContext("2d").getImageData(0,0,1,1)}catch{Ne=!0}return Ne},fe.pixelDensityRatio=function(){if(fe.supportsCanvas){var _e=document.createElement("canvas").getContext("2d"),Ne=window.devicePixelRatio||1,Ue=_e.webkitBackingStorePixelRatio||_e.mozBackingStorePixelRatio||_e.msBackingStorePixelRatio||_e.oBackingStorePixelRatio||_e.backingStorePixelRatio||1;return Math.max(Ne,1)/Ue}else return 1}()})(OpenSeadragon),function($){$.extend=function(){var fe,ee,ue,pe,_e,Ne,Ue=arguments[0]||{},Ge=arguments.length,qe=!1,Ke=1;for(typeof Ue=="boolean"&&(qe=Ue,Ue=arguments[1]||{},Ke=2),typeof Ue!="object"&&!OpenSeadragon.isFunction(Ue)&&(Ue={}),Ge===Ke&&(Ue=this,--Ke);Ke<Ge;Ke++)if(fe=arguments[Ke],fe!==null||fe!==void 0)for(ee in fe)ue=Ue[ee],pe=fe[ee],Ue!==pe&&(qe&&pe&&(OpenSeadragon.isPlainObject(pe)||(_e=OpenSeadragon.isArray(pe)))?(_e?(_e=!1,Ne=ue&&OpenSeadragon.isArray(ue)?ue:[]):Ne=ue&&OpenSeadragon.isPlainObject(ue)?ue:{},Ue[ee]=OpenSeadragon.extend(qe,Ne,pe)):pe!==void 0&&(Ue[ee]=pe));return Ue};var isIOSDevice=function(){if(typeof navigator!="object")return!1;var fe=navigator.userAgent;return typeof fe!="string"?!1:fe.indexOf("iPhone")!==-1||fe.indexOf("iPad")!==-1||fe.indexOf("iPod")!==-1};$.extend($,{DEFAULT_SETTINGS:{xmlPath:null,tileSources:null,tileHost:null,initialPage:0,crossOriginPolicy:!1,ajaxWithCredentials:!1,loadTilesWithAjax:!1,ajaxHeaders:{},panHorizontal:!0,panVertical:!0,constrainDuringPan:!1,wrapHorizontal:!1,wrapVertical:!1,visibilityRatio:.5,minPixelRatio:.5,defaultZoomLevel:0,minZoomLevel:null,maxZoomLevel:null,homeFillsViewer:!1,clickTimeThreshold:300,clickDistThreshold:5,dblClickTimeThreshold:300,dblClickDistThreshold:20,springStiffness:6.5,animationTime:1.2,gestureSettingsMouse:{scrollToZoom:!0,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsTouch:{scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsPen:{scrollToZoom:!1,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsUnknown:{scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},zoomPerClick:2,zoomPerScroll:1.2,zoomPerSecond:1,blendTime:0,alwaysBlend:!1,autoHideControls:!0,immediateRender:!1,minZoomImageRatio:.9,maxZoomPixelRatio:1.1,smoothTileEdgesMinZoom:1.1,iOSDevice:isIOSDevice(),pixelsPerWheelLine:40,pixelsPerArrowPress:40,autoResize:!0,preserveImageSizeOnResize:!1,minScrollDeltaTime:50,rotationIncrement:90,showSequenceControl:!0,sequenceControlAnchor:null,preserveViewport:!1,preserveOverlays:!1,navPrevNextWrap:!1,showNavigationControl:!0,navigationControlAnchor:null,showZoomControl:!0,showHomeControl:!0,showFullPageControl:!0,showRotationControl:!1,showFlipControl:!1,controlsFadeDelay:2e3,controlsFadeLength:1500,mouseNavEnabled:!0,showNavigator:!1,navigatorId:null,navigatorPosition:null,navigatorSizeRatio:.2,navigatorMaintainSizeRatio:!1,navigatorTop:null,navigatorLeft:null,navigatorHeight:null,navigatorWidth:null,navigatorAutoResize:!0,navigatorAutoFade:!0,navigatorRotate:!0,navigatorBackground:"#000",navigatorOpacity:.8,navigatorBorderColor:"#555",navigatorDisplayRegionColor:"#900",degrees:0,flipped:!1,opacity:1,preload:!1,compositeOperation:null,imageSmoothingEnabled:!0,placeholderFillStyle:null,showReferenceStrip:!1,referenceStripScroll:"horizontal",referenceStripElement:null,referenceStripHeight:null,referenceStripWidth:null,referenceStripPosition:"BOTTOM_LEFT",referenceStripSizeRatio:.2,collectionRows:3,collectionColumns:0,collectionLayout:"horizontal",collectionMode:!1,collectionTileSize:800,collectionTileMargin:80,imageLoaderLimit:0,maxImageCacheCount:200,timeout:3e4,useCanvas:!0,prefixUrl:"/images/",navImages:{zoomIn:{REST:"zoomin_rest.png",GROUP:"zoomin_grouphover.png",HOVER:"zoomin_hover.png",DOWN:"zoomin_pressed.png"},zoomOut:{REST:"zoomout_rest.png",GROUP:"zoomout_grouphover.png",HOVER:"zoomout_hover.png",DOWN:"zoomout_pressed.png"},home:{REST:"home_rest.png",GROUP:"home_grouphover.png",HOVER:"home_hover.png",DOWN:"home_pressed.png"},fullpage:{REST:"fullpage_rest.png",GROUP:"fullpage_grouphover.png",HOVER:"fullpage_hover.png",DOWN:"fullpage_pressed.png"},rotateleft:{REST:"rotateleft_rest.png",GROUP:"rotateleft_grouphover.png",HOVER:"rotateleft_hover.png",DOWN:"rotateleft_pressed.png"},rotateright:{REST:"rotateright_rest.png",GROUP:"rotateright_grouphover.png",HOVER:"rotateright_hover.png",DOWN:"rotateright_pressed.png"},flip:{REST:"flip_rest.png",GROUP:"flip_grouphover.png",HOVER:"flip_hover.png",DOWN:"flip_pressed.png"},previous:{REST:"previous_rest.png",GROUP:"previous_grouphover.png",HOVER:"previous_hover.png",DOWN:"previous_pressed.png"},next:{REST:"next_rest.png",GROUP:"next_grouphover.png",HOVER:"next_hover.png",DOWN:"next_pressed.png"}},debugMode:!1,debugGridColor:["#437AB2","#1B9E77","#D95F02","#7570B3","#E7298A","#66A61E","#E6AB02","#A6761D","#666666"]},SIGNAL:"----seadragon----",delegate:function(fe,ee){return function(){var ue=arguments;return ue===void 0&&(ue=[]),ee.apply(fe,ue)}},BROWSERS:{UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5},getElement:function(fe){return typeof fe=="string"&&(fe=document.getElementById(fe)),fe},getElementPosition:function(fe){var ee=new $.Point,ue,pe;for(fe=$.getElement(fe),ue=$.getElementStyle(fe).position=="fixed",pe=getOffsetParent(fe,ue);pe;)ee.x+=fe.offsetLeft,ee.y+=fe.offsetTop,ue&&(ee=ee.plus($.getPageScroll())),fe=pe,ue=$.getElementStyle(fe).position=="fixed",pe=getOffsetParent(fe,ue);return ee},getElementOffset:function(fe){fe=$.getElement(fe);var ee=fe&&fe.ownerDocument,ue,pe,_e={top:0,left:0};return ee?(ue=ee.documentElement,typeof fe.getBoundingClientRect<"u"&&(_e=fe.getBoundingClientRect()),pe=ee==ee.window?ee:ee.nodeType===9?ee.defaultView||ee.parentWindow:!1,new $.Point(_e.left+(pe.pageXOffset||ue.scrollLeft)-(ue.clientLeft||0),_e.top+(pe.pageYOffset||ue.scrollTop)-(ue.clientTop||0))):new $.Point},getElementSize:function(fe){return fe=$.getElement(fe),new $.Point(fe.clientWidth,fe.clientHeight)},getElementStyle:document.documentElement.currentStyle?function(fe){return fe=$.getElement(fe),fe.currentStyle}:function(fe){return fe=$.getElement(fe),window.getComputedStyle(fe,"")},getCssPropertyWithVendorPrefix:function(fe){var ee={};return $.getCssPropertyWithVendorPrefix=function(ue){if(ee[ue]!==void 0)return ee[ue];var pe=document.createElement("div").style,_e=null;if(pe[ue]!==void 0)_e=ue;else for(var Ne=["Webkit","Moz","MS","O","webkit","moz","ms","o"],Ue=$.capitalizeFirstLetter(ue),Ge=0;Ge<Ne.length;Ge++){var qe=Ne[Ge]+Ue;if(pe[qe]!==void 0){_e=qe;break}}return ee[ue]=_e,_e},$.getCssPropertyWithVendorPrefix(fe)},capitalizeFirstLetter:function(fe){return fe.charAt(0).toUpperCase()+fe.slice(1)},positiveModulo:function(fe,ee){var ue=fe%ee;return ue<0&&(ue+=ee),ue},pointInElement:function(fe,ee){fe=$.getElement(fe);var ue=$.getElementOffset(fe),pe=$.getElementSize(fe);return ee.x>=ue.x&&ee.x<ue.x+pe.x&&ee.y<ue.y+pe.y&&ee.y>=ue.y},getEvent:function(fe){return fe?$.getEvent=function(ee){return ee}:$.getEvent=function(){return window.event},$.getEvent(fe)},getMousePosition:function(fe){if(typeof fe.pageX=="number")$.getMousePosition=function(ee){var ue=new $.Point;return ee=$.getEvent(ee),ue.x=ee.pageX,ue.y=ee.pageY,ue};else if(typeof fe.clientX=="number")$.getMousePosition=function(ee){var ue=new $.Point;return ee=$.getEvent(ee),ue.x=ee.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,ue.y=ee.clientY+document.body.scrollTop+document.documentElement.scrollTop,ue};else throw new Error("Unknown event mouse position, no known technique.");return $.getMousePosition(fe)},getPageScroll:function(){var fe=document.documentElement||{},ee=document.body||{};if(typeof window.pageXOffset=="number")$.getPageScroll=function(){return new $.Point(window.pageXOffset,window.pageYOffset)};else if(ee.scrollLeft||ee.scrollTop)$.getPageScroll=function(){return new $.Point(document.body.scrollLeft,document.body.scrollTop)};else if(fe.scrollLeft||fe.scrollTop)$.getPageScroll=function(){return new $.Point(document.documentElement.scrollLeft,document.documentElement.scrollTop)};else return new $.Point(0,0);return $.getPageScroll()},setPageScroll:function(fe){if(typeof window.scrollTo<"u")$.setPageScroll=function(pe){window.scrollTo(pe.x,pe.y)};else{var ee=$.getPageScroll();if(ee.x===fe.x&&ee.y===fe.y)return;document.body.scrollLeft=fe.x,document.body.scrollTop=fe.y;var ue=$.getPageScroll();if(ue.x!==ee.x&&ue.y!==ee.y){$.setPageScroll=function(pe){document.body.scrollLeft=pe.x,document.body.scrollTop=pe.y};return}if(document.documentElement.scrollLeft=fe.x,document.documentElement.scrollTop=fe.y,ue=$.getPageScroll(),ue.x!==ee.x&&ue.y!==ee.y){$.setPageScroll=function(pe){document.documentElement.scrollLeft=pe.x,document.documentElement.scrollTop=pe.y};return}$.setPageScroll=function(pe){}}return $.setPageScroll(fe)},getWindowSize:function(){var fe=document.documentElement||{},ee=document.body||{};if(typeof window.innerWidth=="number")$.getWindowSize=function(){return new $.Point(window.innerWidth,window.innerHeight)};else if(fe.clientWidth||fe.clientHeight)$.getWindowSize=function(){return new $.Point(document.documentElement.clientWidth,document.documentElement.clientHeight)};else if(ee.clientWidth||ee.clientHeight)$.getWindowSize=function(){return new $.Point(document.body.clientWidth,document.body.clientHeight)};else throw new Error("Unknown window size, no known technique.");return $.getWindowSize()},makeCenteredNode:function(fe){fe=$.getElement(fe);var ee=[$.makeNeutralElement("div"),$.makeNeutralElement("div"),$.makeNeutralElement("div")];return $.extend(ee[0].style,{display:"table",height:"100%",width:"100%"}),$.extend(ee[1].style,{display:"table-row"}),$.extend(ee[2].style,{display:"table-cell",verticalAlign:"middle",textAlign:"center"}),ee[0].appendChild(ee[1]),ee[1].appendChild(ee[2]),ee[2].appendChild(fe),ee[0]},makeNeutralElement:function(fe){var ee=document.createElement(fe),ue=ee.style;return ue.background="transparent none",ue.border="none",ue.margin="0px",ue.padding="0px",ue.position="static",ee},now:function(){return Date.now?$.now=Date.now:$.now=function(){return new Date().getTime()},$.now()},makeTransparentImage:function(fe){return $.makeTransparentImage=function(ee){var ue=$.makeNeutralElement("img");return ue.src=ee,ue},$.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<7&&($.makeTransparentImage=function(ee){var ue=$.makeNeutralElement("img"),pe=null;return pe=$.makeNeutralElement("span"),pe.style.display="inline-block",ue.onload=function(){pe.style.width=pe.style.width||ue.width+"px",pe.style.height=pe.style.height||ue.height+"px",ue.onload=null,ue=null},ue.src=ee,pe.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+ee+"', sizingMethod='scale')",pe}),$.makeTransparentImage(fe)},setElementOpacity:function(fe,ee,ue){var pe,_e;fe=$.getElement(fe),ue&&!$.Browser.alpha&&(ee=Math.round(ee)),$.Browser.opacity?fe.style.opacity=ee<1?ee:"":ee<1?(pe=Math.round(100*ee),_e="alpha(opacity="+pe+")",fe.style.filter=_e):fe.style.filter=""},setElementTouchActionNone:function(fe){fe=$.getElement(fe),typeof fe.style.touchAction<"u"?fe.style.touchAction="none":typeof fe.style.msTouchAction<"u"&&(fe.style.msTouchAction="none")},addClass:function(fe,ee){fe=$.getElement(fe),fe.className?(" "+fe.className+" ").indexOf(" "+ee+" ")===-1&&(fe.className+=" "+ee):fe.className=ee},indexOf:function(fe,ee,ue){return Array.prototype.indexOf?this.indexOf=function(pe,_e,Ne){return pe.indexOf(_e,Ne)}:this.indexOf=function(pe,_e,Ne){var Ue,Ge=Ne||0,qe;if(!pe)throw new TypeError;if(qe=pe.length,qe===0||Ge>=qe)return-1;for(Ge<0&&(Ge=qe-Math.abs(Ge)),Ue=Ge;Ue<qe;Ue++)if(pe[Ue]===_e)return Ue;return-1},this.indexOf(fe,ee,ue)},removeClass:function(fe,ee){var ue,pe=[],_e;for(fe=$.getElement(fe),ue=fe.className.split(/\s+/),_e=0;_e<ue.length;_e++)ue[_e]&&ue[_e]!==ee&&pe.push(ue[_e]);fe.className=pe.join(" ")},addEvent:function(){if(window.addEventListener)return function(fe,ee,ue,pe){fe=$.getElement(fe),fe.addEventListener(ee,ue,pe)};if(window.attachEvent)return function(fe,ee,ue,pe){fe=$.getElement(fe),fe.attachEvent("on"+ee,ue)};throw new Error("No known event model.")}(),removeEvent:function(){if(window.removeEventListener)return function(fe,ee,ue,pe){fe=$.getElement(fe),fe.removeEventListener(ee,ue,pe)};if(window.detachEvent)return function(fe,ee,ue,pe){fe=$.getElement(fe),fe.detachEvent("on"+ee,ue)};throw new Error("No known event model.")}(),cancelEvent:function(fe){fe=$.getEvent(fe),fe.preventDefault?$.cancelEvent=function(ee){ee.preventDefault()}:$.cancelEvent=function(ee){ee=$.getEvent(ee),ee.cancel=!0,ee.returnValue=!1},$.cancelEvent(fe)},stopEvent:function(fe){fe=$.getEvent(fe),fe.stopPropagation?$.stopEvent=function(ee){ee.stopPropagation()}:$.stopEvent=function(ee){ee=$.getEvent(ee),ee.cancelBubble=!0},$.stopEvent(fe)},createCallback:function(fe,ee){var ue=[],pe;for(pe=2;pe<arguments.length;pe++)ue.push(arguments[pe]);return function(){var _e=ue.concat([]),Ne;for(Ne=0;Ne<arguments.length;Ne++)_e.push(arguments[Ne]);return ee.apply(fe,_e)}},getUrlParameter:function(fe){var ee=URLPARAMS[fe];return ee||null},getUrlProtocol:function(fe){var ee=fe.match(/^([a-z]+:)\/\//i);return ee===null?window.location.protocol:ee[1].toLowerCase()},createAjaxRequest:function(fe){var ee;try{ee=!!new ActiveXObject("Microsoft.XMLHTTP")}catch{ee=!1}if(ee)window.XMLHttpRequest?$.createAjaxRequest=function(ue){return ue?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest}:$.createAjaxRequest=function(){return new ActiveXObject("Microsoft.XMLHTTP")};else if(window.XMLHttpRequest)$.createAjaxRequest=function(){return new XMLHttpRequest};else throw new Error("Browser doesn't support XMLHttpRequest.");return $.createAjaxRequest(fe)},makeAjaxRequest:function(fe,ee,ue){var pe,_e,Ne;$.isPlainObject(fe)&&(ee=fe.success,ue=fe.error,pe=fe.withCredentials,_e=fe.headers,Ne=fe.responseType||null,fe=fe.url);var Ue=$.getUrlProtocol(fe),Ge=$.createAjaxRequest(Ue==="file:");if(!$.isFunction(ee))throw new Error("makeAjaxRequest requires a success callback");Ge.onreadystatechange=function(){Ge.readyState==4&&(Ge.onreadystatechange=function(){},Ge.status>=200&&Ge.status<300||Ge.status===0&&Ue!=="http:"&&Ue!=="https:"?ee(Ge):($.console.log("AJAX request returned %d: %s",Ge.status,fe),$.isFunction(ue)&&ue(Ge)))};try{if(Ge.open("GET",fe,!0),Ne&&(Ge.responseType=Ne),_e)for(var qe in _e)Object.prototype.hasOwnProperty.call(_e,qe)&&_e[qe]&&Ge.setRequestHeader(qe,_e[qe]);pe&&(Ge.withCredentials=!0),Ge.send(null)}catch(Xe){var Ke=Xe.message,Ye=$.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<10;if(Ye&&typeof Xe.number<"u"&&Xe.number==-2147024891&&(Ke+=`
See http://msdn.microsoft.com/en-us/library/ms537505(v=vs.85).aspx#xdomain`),$.console.log("%s while making AJAX request: %s",Xe.name,Ke),Ge.onreadystatechange=function(){},window.XDomainRequest){var Ze=new window.XDomainRequest;if(Ze){Ze.onload=function(Je){$.isFunction(ee)&&ee({responseText:Ze.responseText,status:200,statusText:"OK"})},Ze.onerror=function(Je){$.isFunction(ue)&&ue({responseText:Ze.responseText,status:444,statusText:"An error happened. Due to an XDomainRequest deficiency we can not extract any information about this error. Upgrade your browser."})};try{Ze.open("GET",fe),Ze.send()}catch{$.isFunction(ue)&&ue(Ge,Xe)}}}else $.isFunction(ue)&&ue(Ge,Xe)}return Ge},jsonp:function(fe){var ee,ue=fe.url,pe=document.head||document.getElementsByTagName("head")[0]||document.documentElement,_e=fe.callbackName||"openseadragon"+$.now(),Ne=window[_e],Ue="$1"+_e+"$2",Ge=fe.param||"callback",qe=fe.callback;ue=ue.replace(/(\=)\?(&|$)|\?\?/i,Ue),ue+=(/\?/.test(ue)?"&":"?")+Ge+"="+_e,window[_e]=function(Ke){if(Ne)window[_e]=Ne;else try{delete window[_e]}catch{}qe&&$.isFunction(qe)&&qe(Ke)},ee=document.createElement("script"),(fe.async!==void 0||fe.async!==!1)&&(ee.async="async"),fe.scriptCharset&&(ee.charset=fe.scriptCharset),ee.src=ue,ee.onload=ee.onreadystatechange=function(Ke,Ye){(Ye||!ee.readyState||/loaded|complete/.test(ee.readyState))&&(ee.onload=ee.onreadystatechange=null,pe&&ee.parentNode&&pe.removeChild(ee),ee=void 0)},pe.insertBefore(ee,pe.firstChild)},createFromDZI:function(){throw"OpenSeadragon.createFromDZI is deprecated, use Viewer.open."},parseXml:function(fe){if(window.DOMParser)$.parseXml=function(ee){var ue=null,pe;return pe=new DOMParser,ue=pe.parseFromString(ee,"text/xml"),ue};else if(window.ActiveXObject)$.parseXml=function(ee){var ue=null;return ue=new ActiveXObject("Microsoft.XMLDOM"),ue.async=!1,ue.loadXML(ee),ue};else throw new Error("Browser doesn't support XML DOM.");return $.parseXml(fe)},parseJSON:function(string){return window.JSON&&window.JSON.parse?$.parseJSON=window.JSON.parse:$.parseJSON=function(string){return eval("("+string+")")},$.parseJSON(string)},imageFormatSupported:function(fe){return fe=fe||"",!!FILEFORMATS[fe.toLowerCase()]}});var nullfunction=function(fe){};$.console=window.console||{log:nullfunction,debug:nullfunction,info:nullfunction,warn:nullfunction,error:nullfunction,assert:nullfunction},$.Browser={vendor:$.BROWSERS.UNKNOWN,version:0,alpha:!0};var FILEFORMATS={bmp:!1,jpeg:!0,jpg:!0,png:!0,tif:!1,wdp:!1},URLPARAMS={};(function(){var fe=navigator.appVersion,ee=navigator.userAgent,ue;switch(navigator.appName){case"Microsoft Internet Explorer":window.attachEvent&&window.ActiveXObject&&($.Browser.vendor=$.BROWSERS.IE,$.Browser.version=parseFloat(ee.substring(ee.indexOf("MSIE")+5,ee.indexOf(";",ee.indexOf("MSIE")))));break;case"Netscape":window.addEventListener&&(ee.indexOf("Firefox")>=0?($.Browser.vendor=$.BROWSERS.FIREFOX,$.Browser.version=parseFloat(ee.substring(ee.indexOf("Firefox")+8))):ee.indexOf("Safari")>=0?($.Browser.vendor=ee.indexOf("Chrome")>=0?$.BROWSERS.CHROME:$.BROWSERS.SAFARI,$.Browser.version=parseFloat(ee.substring(ee.substring(0,ee.indexOf("Safari")).lastIndexOf("/")+1,ee.indexOf("Safari")))):(ue=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})"),ue.exec(ee)!==null&&($.Browser.vendor=$.BROWSERS.IE,$.Browser.version=parseFloat(RegExp.$1))));break;case"Opera":$.Browser.vendor=$.BROWSERS.OPERA,$.Browser.version=parseFloat(fe);break}var pe=window.location.search.substring(1),_e=pe.split("&"),Ne,Ue,Ge;for(Ge=0;Ge<_e.length;Ge++)if(Ne=_e[Ge],Ue=Ne.indexOf("="),Ue>0){var qe=Ne.substring(0,Ue),Ke=Ne.substring(Ue+1);try{URLPARAMS[qe]=decodeURIComponent(Ke)}catch{$.console.error("Ignoring malformed URL parameter: %s=%s",qe,Ke)}}$.Browser.alpha=!($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<9||$.Browser.vendor==$.BROWSERS.CHROME&&$.Browser.version<2),$.Browser.opacity=!($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<9)})(),function(fe){var ee=fe.requestAnimationFrame||fe.mozRequestAnimationFrame||fe.webkitRequestAnimationFrame||fe.msRequestAnimationFrame,ue=fe.cancelAnimationFrame||fe.mozCancelAnimationFrame||fe.webkitCancelAnimationFrame||fe.msCancelAnimationFrame;if(ee&&ue)$.requestAnimationFrame=function(){return ee.apply(fe,arguments)},$.cancelAnimationFrame=function(){return ue.apply(fe,arguments)};else{var pe=[],_e=[],Ne=0,Ue;$.requestAnimationFrame=function(Ge){return pe.push([++Ne,Ge]),Ue||(Ue=setInterval(function(){if(pe.length){var qe=$.now(),Ke=_e;for(_e=pe,pe=Ke;_e.length;)_e.shift()[1](qe)}else clearInterval(Ue),Ue=void 0},1e3/50)),Ne},$.cancelAnimationFrame=function(Ge){var qe,Ke;for(qe=0,Ke=pe.length;qe<Ke;qe+=1)if(pe[qe][0]===Ge){pe.splice(qe,1);return}for(qe=0,Ke=_e.length;qe<Ke;qe+=1)if(_e[qe][0]===Ge){_e.splice(qe,1);return}}}}(window);function getOffsetParent(fe,ee){return ee&&fe!=document.body?document.body:fe.offsetParent}}(OpenSeadragon),function(fe,ee){module.exports?module.exports=ee():fe.OpenSeadragon=ee()}(commonjsGlobal,function(){return OpenSeadragon}),function(fe){var ee={supportsFullScreen:!1,isFullScreen:function(){return!1},getFullScreenElement:function(){return null},requestFullScreen:function(){},exitFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",fullScreenErrorEventName:""};document.exitFullscreen?(ee.supportsFullScreen=!0,ee.getFullScreenElement=function(){return document.fullscreenElement},ee.requestFullScreen=function(ue){return ue.requestFullscreen()},ee.exitFullScreen=function(){document.exitFullscreen()},ee.fullScreenEventName="fullscreenchange",ee.fullScreenErrorEventName="fullscreenerror"):document.msExitFullscreen?(ee.supportsFullScreen=!0,ee.getFullScreenElement=function(){return document.msFullscreenElement},ee.requestFullScreen=function(ue){return ue.msRequestFullscreen()},ee.exitFullScreen=function(){document.msExitFullscreen()},ee.fullScreenEventName="MSFullscreenChange",ee.fullScreenErrorEventName="MSFullscreenError"):document.webkitExitFullscreen?(ee.supportsFullScreen=!0,ee.getFullScreenElement=function(){return document.webkitFullscreenElement},ee.requestFullScreen=function(ue){return ue.webkitRequestFullscreen()},ee.exitFullScreen=function(){document.webkitExitFullscreen()},ee.fullScreenEventName="webkitfullscreenchange",ee.fullScreenErrorEventName="webkitfullscreenerror"):document.webkitCancelFullScreen?(ee.supportsFullScreen=!0,ee.getFullScreenElement=function(){return document.webkitCurrentFullScreenElement},ee.requestFullScreen=function(ue){return ue.webkitRequestFullScreen()},ee.exitFullScreen=function(){document.webkitCancelFullScreen()},ee.fullScreenEventName="webkitfullscreenchange",ee.fullScreenErrorEventName="webkitfullscreenerror"):document.mozCancelFullScreen&&(ee.supportsFullScreen=!0,ee.getFullScreenElement=function(){return document.mozFullScreenElement},ee.requestFullScreen=function(ue){return ue.mozRequestFullScreen()},ee.exitFullScreen=function(){document.mozCancelFullScreen()},ee.fullScreenEventName="mozfullscreenchange",ee.fullScreenErrorEventName="mozfullscreenerror"),ee.isFullScreen=function(){return ee.getFullScreenElement()!==null},ee.cancelFullScreen=function(){fe.console.error("cancelFullScreen is deprecated. Use exitFullScreen instead."),ee.exitFullScreen()},fe.extend(fe,ee)}(OpenSeadragon),function(fe){fe.EventSource=function(){this.events={}},fe.EventSource.prototype={addOnceHandler:function(ee,ue,pe,_e){var Ne=this;_e=_e||1;var Ue=0,Ge=function(qe){Ue++,Ue===_e&&Ne.removeHandler(ee,Ge),ue(qe)};this.addHandler(ee,Ge,pe)},addHandler:function(ee,ue,pe){var _e=this.events[ee];_e||(this.events[ee]=_e=[]),ue&&fe.isFunction(ue)&&(_e[_e.length]={handler:ue,userData:pe||null})},removeHandler:function(ee,ue){var pe=this.events[ee],_e=[],Ne;if(pe&&fe.isArray(pe)){for(Ne=0;Ne<pe.length;Ne++)pe[Ne].handler!==ue&&_e.push(pe[Ne]);this.events[ee]=_e}},removeAllHandlers:function(ee){if(ee)this.events[ee]=[];else for(var ue in this.events)this.events[ue]=[]},getHandler:function(ee){var ue=this.events[ee];return!ue||!ue.length?null:(ue=ue.length===1?[ue[0]]:Array.apply(null,ue),function(pe,_e){var Ne,Ue=ue.length;for(Ne=0;Ne<Ue;Ne++)ue[Ne]&&(_e.eventSource=pe,_e.userData=ue[Ne].userData,ue[Ne].handler(_e))})},raiseEvent:function(ee,ue){var pe=this.getHandler(ee);pe&&(ue||(ue={}),pe(this,ue))}}}(OpenSeadragon),function(fe){var ee=[],ue={};fe.MouseTracker=function(ct){ee.push(this);var at=arguments;fe.isPlainObject(ct)||(ct={element:at[0],clickTimeThreshold:at[1],clickDistThreshold:at[2]}),this.hash=Math.random(),this.element=fe.getElement(ct.element),this.clickTimeThreshold=ct.clickTimeThreshold||fe.DEFAULT_SETTINGS.clickTimeThreshold,this.clickDistThreshold=ct.clickDistThreshold||fe.DEFAULT_SETTINGS.clickDistThreshold,this.dblClickTimeThreshold=ct.dblClickTimeThreshold||fe.DEFAULT_SETTINGS.dblClickTimeThreshold,this.dblClickDistThreshold=ct.dblClickDistThreshold||fe.DEFAULT_SETTINGS.dblClickDistThreshold,this.userData=ct.userData||null,this.stopDelay=ct.stopDelay||50,this.enterHandler=ct.enterHandler||null,this.exitHandler=ct.exitHandler||null,this.pressHandler=ct.pressHandler||null,this.nonPrimaryPressHandler=ct.nonPrimaryPressHandler||null,this.releaseHandler=ct.releaseHandler||null,this.nonPrimaryReleaseHandler=ct.nonPrimaryReleaseHandler||null,this.moveHandler=ct.moveHandler||null,this.scrollHandler=ct.scrollHandler||null,this.clickHandler=ct.clickHandler||null,this.dblClickHandler=ct.dblClickHandler||null,this.dragHandler=ct.dragHandler||null,this.dragEndHandler=ct.dragEndHandler||null,this.pinchHandler=ct.pinchHandler||null,this.stopHandler=ct.stopHandler||null,this.keyDownHandler=ct.keyDownHandler||null,this.keyUpHandler=ct.keyUpHandler||null,this.keyHandler=ct.keyHandler||null,this.focusHandler=ct.focusHandler||null,this.blurHandler=ct.blurHandler||null;var Zr=this;ue[this.hash]={click:function(ei){tt(Zr,ei)},dblclick:function(ei){rt(Zr,ei)},keydown:function(ei){et(Zr,ei)},keyup:function(ei){it(Zr,ei)},keypress:function(ei){nt(Zr,ei)},focus:function(ei){st(Zr,ei)},blur:function(ei){lt(Zr,ei)},wheel:function(ei){_r(Zr,ei)},mousewheel:function(ei){jr(Zr,ei)},DOMMouseScroll:function(ei){jr(Zr,ei)},MozMousePixelScroll:function(ei){jr(Zr,ei)},mouseenter:function(ei){ri(Zr,ei)},mouseleave:function(ei){qr(Zr,ei)},mouseover:function(ei){Xr(Zr,ei)},mouseout:function(ei){si(Zr,ei)},mousedown:function(ei){ii(Zr,ei)},mouseup:function(ei){ti(Zr,ei)},mouseupcaptured:function(ei){ni(Zr,ei)},mousemove:function(ei){yi(Zr,ei)},mousemovecaptured:function(ei){hi(Zr,ei)},touchstart:function(ei){Ei(Zr,ei)},touchend:function(ei){bi(Zr,ei)},touchendcaptured:function(ei){_i(Zr,ei)},touchmove:function(ei){Ti(Zr,ei)},touchmovecaptured:function(ei){Fi(Zr,ei)},touchcancel:function(ei){Di(Zr,ei)},gesturestart:function(ei){Oi(Zr,ei)},gesturechange:function(ei){ot(Zr,ei)},pointerover:function(ei){Ur(Zr,ei)},MSPointerOver:function(ei){Ur(Zr,ei)},pointerout:function(ei){ai(Zr,ei)},MSPointerOut:function(ei){ai(Zr,ei)},pointerdown:function(ei){li(Zr,ei)},MSPointerDown:function(ei){li(Zr,ei)},pointerup:function(ei){ci(Zr,ei)},MSPointerUp:function(ei){ci(Zr,ei)},pointermove:function(ei){Ii(Zr,ei)},MSPointerMove:function(ei){Ii(Zr,ei)},pointercancel:function(ei){wi(Zr,ei)},MSPointerCancel:function(ei){wi(Zr,ei)},pointerupcaptured:function(ei){Ci(Zr,ei)},pointermovecaptured:function(ei){Ni(Zr,ei)},tracking:!1,activePointersLists:[],lastClickPos:null,dblClickTimeOut:null,pinchGPoints:[],lastPinchDist:0,currentPinchDist:0,lastPinchCenter:null,currentPinchCenter:null},ct.startDisabled||this.setTracking(!0)},fe.MouseTracker.prototype={destroy:function(){var ct;for(Ne(this),this.element=null,ct=0;ct<ee.length;ct++)if(ee[ct]===this){ee.splice(ct,1);break}ue[this.hash]=null,delete ue[this.hash]},isTracking:function(){return ue[this.hash].tracking},setTracking:function(ct){return ct?_e(this):Ne(this),this},getActivePointersListsExceptType:function(ct){for(var at=ue[this.hash],Zr=[],ei=0;ei<at.activePointersLists.length;++ei)at.activePointersLists[ei].type!==ct&&Zr.push(at.activePointersLists[ei]);return Zr},getActivePointersListByType:function(ct){var at=ue[this.hash],Zr,ei=at.activePointersLists.length,di;for(Zr=0;Zr<ei;Zr++)if(at.activePointersLists[Zr].type===ct)return at.activePointersLists[Zr];return di=new fe.MouseTracker.GesturePointList(ct),at.activePointersLists.push(di),di},getActivePointerCount:function(){var ct=ue[this.hash],at,Zr=ct.activePointersLists.length,ei=0;for(at=0;at<Zr;at++)ei+=ct.activePointersLists[at].getLength();return ei},enterHandler:function(){},exitHandler:function(){},pressHandler:function(){},nonPrimaryPressHandler:function(){},releaseHandler:function(){},nonPrimaryReleaseHandler:function(){},moveHandler:function(){},scrollHandler:function(){},clickHandler:function(){},dblClickHandler:function(){},dragHandler:function(){},dragEndHandler:function(){},pinchHandler:function(){},stopHandler:function(){},keyDownHandler:function(){},keyUpHandler:function(){},keyHandler:function(){},focusHandler:function(){},blurHandler:function(){}},fe.MouseTracker.resetAllMouseTrackers=function(){for(var ct=0;ct<ee.length;ct++)ee[ct].isTracking()&&(ee[ct].setTracking(!1),ee[ct].setTracking(!0))},fe.MouseTracker.gesturePointVelocityTracker=function(){var ct=[],at=0,Zr=0,ei=function(fi,Si){return fi.hash.toString()+Si.type+Si.id.toString()},di=function(){var fi,Si=ct.length,Pi,$i,Bi=fe.now(),Ai,Wi,ji;for(Ai=Bi-Zr,Zr=Bi,fi=0;fi<Si;fi++)Pi=ct[fi],$i=Pi.gPoint,$i.direction=Math.atan2($i.currentPos.y-Pi.lastPos.y,$i.currentPos.x-Pi.lastPos.x),Wi=Pi.lastPos.distanceTo($i.currentPos),Pi.lastPos=$i.currentPos,ji=1e3*Wi/(Ai+1),$i.speed=.75*ji+.25*$i.speed},xi=function(fi,Si){var Pi=ei(fi,Si);ct.push({guid:Pi,gPoint:Si,lastPos:Si.currentPos}),ct.length===1&&(Zr=fe.now(),at=window.setInterval(di,50))},gi=function(fi,Si){var Pi=ei(fi,Si),$i,Bi=ct.length;for($i=0;$i<Bi;$i++)if(ct[$i].guid===Pi){ct.splice($i,1),Bi--,Bi===0&&window.clearInterval(at);break}};return{addPoint:xi,removePoint:gi}}(),fe.MouseTracker.captureElement=document,fe.MouseTracker.wheelEventName=fe.Browser.vendor==fe.BROWSERS.IE&&fe.Browser.version>8||"onwheel"in document.createElement("div")?"wheel":document.onmousewheel!==void 0?"mousewheel":"DOMMouseScroll",fe.MouseTracker.supportsMouseCapture=function(){var ct=document.createElement("div");return fe.isFunction(ct.setCapture)&&fe.isFunction(ct.releaseCapture)}(),fe.MouseTracker.subscribeEvents=["click","dblclick","keydown","keyup","keypress","focus","blur",fe.MouseTracker.wheelEventName],fe.MouseTracker.wheelEventName=="DOMMouseScroll"&&fe.MouseTracker.subscribeEvents.push("MozMousePixelScroll"),window.PointerEvent&&(window.navigator.pointerEnabled||fe.Browser.vendor!==fe.BROWSERS.IE)?(fe.MouseTracker.havePointerEvents=!0,fe.MouseTracker.subscribeEvents.push("pointerover","pointerout","pointerdown","pointerup","pointermove","pointercancel"),fe.MouseTracker.unprefixedPointerEvents=!0,navigator.maxTouchPoints?fe.MouseTracker.maxTouchPoints=navigator.maxTouchPoints:fe.MouseTracker.maxTouchPoints=0,fe.MouseTracker.haveMouseEnter=!1):window.MSPointerEvent&&window.navigator.msPointerEnabled?(fe.MouseTracker.havePointerEvents=!0,fe.MouseTracker.subscribeEvents.push("MSPointerOver","MSPointerOut","MSPointerDown","MSPointerUp","MSPointerMove","MSPointerCancel"),fe.MouseTracker.unprefixedPointerEvents=!1,navigator.msMaxTouchPoints?fe.MouseTracker.maxTouchPoints=navigator.msMaxTouchPoints:fe.MouseTracker.maxTouchPoints=0,fe.MouseTracker.haveMouseEnter=!1):(fe.MouseTracker.havePointerEvents=!1,fe.Browser.vendor===fe.BROWSERS.IE&&fe.Browser.version<9?(fe.MouseTracker.subscribeEvents.push("mouseenter","mouseleave"),fe.MouseTracker.haveMouseEnter=!0):(fe.MouseTracker.subscribeEvents.push("mouseover","mouseout"),fe.MouseTracker.haveMouseEnter=!1),fe.MouseTracker.subscribeEvents.push("mousedown","mouseup","mousemove"),"ontouchstart"in window&&fe.MouseTracker.subscribeEvents.push("touchstart","touchend","touchmove","touchcancel"),"ongesturestart"in window&&fe.MouseTracker.subscribeEvents.push("gesturestart","gesturechange"),fe.MouseTracker.mousePointerId="legacy-mouse",fe.MouseTracker.maxTouchPoints=10),fe.MouseTracker.GesturePointList=function(ct){this._gPoints=[],this.type=ct,this.buttons=0,this.contacts=0,this.clicks=0,this.captureCount=0},fe.MouseTracker.GesturePointList.prototype={getLength:function(){return this._gPoints.length},asArray:function(){return this._gPoints},add:function(ct){return this._gPoints.push(ct)},removeById:function(ct){var at,Zr=this._gPoints.length;for(at=0;at<Zr;at++)if(this._gPoints[at].id===ct){this._gPoints.splice(at,1);break}return this._gPoints.length},getByIndex:function(ct){return ct<this._gPoints.length?this._gPoints[ct]:null},getById:function(ct){var at,Zr=this._gPoints.length;for(at=0;at<Zr;at++)if(this._gPoints[at].id===ct)return this._gPoints[at];return null},getPrimary:function(ct){var at,Zr=this._gPoints.length;for(at=0;at<Zr;at++)if(this._gPoints[at].isPrimary)return this._gPoints[at];return null},addContact:function(){++this.contacts,this.contacts>1&&(this.type==="mouse"||this.type==="pen")&&(this.contacts=1)},removeContact:function(){--this.contacts,this.contacts<0&&(this.contacts=0)}};function pe(ct){var at=ue[ct.hash],Zr,ei=at.activePointersLists.length;for(Zr=0;Zr<ei;Zr++)at.activePointersLists[Zr].captureCount>0&&(fe.removeEvent(fe.MouseTracker.captureElement,"mousemove",at.mousemovecaptured,!0),fe.removeEvent(fe.MouseTracker.captureElement,"mouseup",at.mouseupcaptured,!0),fe.removeEvent(fe.MouseTracker.captureElement,fe.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",at.pointermovecaptured,!0),fe.removeEvent(fe.MouseTracker.captureElement,fe.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",at.pointerupcaptured,!0),fe.removeEvent(fe.MouseTracker.captureElement,"touchmove",at.touchmovecaptured,!0),fe.removeEvent(fe.MouseTracker.captureElement,"touchend",at.touchendcaptured,!0),at.activePointersLists[Zr].captureCount=0);for(Zr=0;Zr<ei;Zr++)at.activePointersLists.pop()}function _e(ct){var at=ue[ct.hash],Zr,ei;if(!at.tracking){for(ei=0;ei<fe.MouseTracker.subscribeEvents.length;ei++)Zr=fe.MouseTracker.subscribeEvents[ei],fe.addEvent(ct.element,Zr,at[Zr],!1);pe(ct),at.tracking=!0}}function Ne(ct){var at=ue[ct.hash],Zr,ei;if(at.tracking){for(ei=0;ei<fe.MouseTracker.subscribeEvents.length;ei++)Zr=fe.MouseTracker.subscribeEvents[ei],fe.removeEvent(ct.element,Zr,at[Zr],!1);pe(ct),at.tracking=!1}}function Ue(ct,at){var Zr=ue[ct.hash];if(at==="pointerevent")return{upName:fe.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",upHandler:Zr.pointerupcaptured,moveName:fe.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",moveHandler:Zr.pointermovecaptured};if(at==="mouse")return{upName:"mouseup",upHandler:Zr.mouseupcaptured,moveName:"mousemove",moveHandler:Zr.mousemovecaptured};if(at==="touch")return{upName:"touchend",upHandler:Zr.touchendcaptured,moveName:"touchmove",moveHandler:Zr.touchmovecaptured};throw new Error("MouseTracker.getCaptureEventParams: Unknown pointer type.")}function Ge(ct,at,Zr){var ei=ct.getActivePointersListByType(at),di;ei.captureCount+=Zr||1,ei.captureCount===1&&(fe.Browser.vendor===fe.BROWSERS.IE&&fe.Browser.version<9?ct.element.setCapture(!0):(di=Ue(ct,fe.MouseTracker.havePointerEvents?"pointerevent":at),Xi&&Zi(window.top)&&fe.addEvent(window.top,di.upName,di.upHandler,!0),fe.addEvent(fe.MouseTracker.captureElement,di.upName,di.upHandler,!0),fe.addEvent(fe.MouseTracker.captureElement,di.moveName,di.moveHandler,!0)))}function qe(ct,at,Zr){var ei=ct.getActivePointersListByType(at),di;ei.captureCount-=Zr||1,ei.captureCount===0&&(fe.Browser.vendor===fe.BROWSERS.IE&&fe.Browser.version<9?ct.element.releaseCapture():(di=Ue(ct,fe.MouseTracker.havePointerEvents?"pointerevent":at),Xi&&Zi(window.top)&&fe.removeEvent(window.top,di.upName,di.upHandler,!0),fe.removeEvent(fe.MouseTracker.captureElement,di.moveName,di.moveHandler,!0),fe.removeEvent(fe.MouseTracker.captureElement,di.upName,di.upHandler,!0)))}function Ke(ct){var at;if(fe.MouseTracker.unprefixedPointerEvents)at=ct.pointerType;else switch(ct.pointerType){case 2:at="touch";break;case 3:at="pen";break;case 4:at="mouse";break;default:at=""}return at}function Ye(ct){return fe.getMousePosition(ct)}function Ze(ct,at){return Xe(Ye(ct),at)}function Xe(ct,at){var Zr=fe.getElementOffset(at);return ct.minus(Zr)}function Je(ct,at){return new fe.Point((ct.x+at.x)/2,(ct.y+at.y)/2)}function tt(ct,at){ct.clickHandler&&fe.cancelEvent(at)}function rt(ct,at){ct.dblClickHandler&&fe.cancelEvent(at)}function et(ct,at){var Zr;ct.keyDownHandler&&(at=fe.getEvent(at),Zr=ct.keyDownHandler({eventSource:ct,keyCode:at.keyCode?at.keyCode:at.charCode,ctrl:at.ctrlKey,shift:at.shiftKey,alt:at.altKey,meta:at.metaKey,originalEvent:at,preventDefaultAction:!1,userData:ct.userData}),Zr||fe.cancelEvent(at))}function it(ct,at){var Zr;ct.keyUpHandler&&(at=fe.getEvent(at),Zr=ct.keyUpHandler({eventSource:ct,keyCode:at.keyCode?at.keyCode:at.charCode,ctrl:at.ctrlKey,shift:at.shiftKey,alt:at.altKey,meta:at.metaKey,originalEvent:at,preventDefaultAction:!1,userData:ct.userData}),Zr||fe.cancelEvent(at))}function nt(ct,at){var Zr;ct.keyHandler&&(at=fe.getEvent(at),Zr=ct.keyHandler({eventSource:ct,keyCode:at.keyCode?at.keyCode:at.charCode,ctrl:at.ctrlKey,shift:at.shiftKey,alt:at.altKey,meta:at.metaKey,originalEvent:at,preventDefaultAction:!1,userData:ct.userData}),Zr||fe.cancelEvent(at))}function st(ct,at){var Zr;ct.focusHandler&&(at=fe.getEvent(at),Zr=ct.focusHandler({eventSource:ct,originalEvent:at,preventDefaultAction:!1,userData:ct.userData}),Zr===!1&&fe.cancelEvent(at))}function lt(ct,at){var Zr;ct.blurHandler&&(at=fe.getEvent(at),Zr=ct.blurHandler({eventSource:ct,originalEvent:at,preventDefaultAction:!1,userData:ct.userData}),Zr===!1&&fe.cancelEvent(at))}function _r(ct,at){Nr(ct,at,at)}function jr(ct,at){at=fe.getEvent(at);var Zr={target:at.target||at.srcElement,type:"wheel",shiftKey:at.shiftKey||!1,clientX:at.clientX,clientY:at.clientY,pageX:at.pageX?at.pageX:at.clientX,pageY:at.pageY?at.pageY:at.clientY,deltaMode:at.type=="MozMousePixelScroll"?0:1,deltaX:0,deltaZ:0};fe.MouseTracker.wheelEventName=="mousewheel"?Zr.deltaY=-at.wheelDelta/fe.DEFAULT_SETTINGS.pixelsPerWheelLine:Zr.deltaY=at.detail,Nr(ct,Zr,at)}function Nr(ct,at,Zr){var ei=0,di;ei=at.deltaY<0?1:-1,ct.scrollHandler&&(di=ct.scrollHandler({eventSource:ct,pointerType:"mouse",position:Ze(at,ct.element),scroll:ei,shift:at.shiftKey,isTouchEvent:!1,originalEvent:Zr,preventDefaultAction:!1,userData:ct.userData}),di===!1&&fe.cancelEvent(Zr))}function Wr(ct,at){if(ct===at)return!1;for(;at&&at!==ct;)at=at.parentNode;return at===ct}function ri(ct,at){at=fe.getEvent(at),Gr(ct,at)}function Xr(ct,at){at=fe.getEvent(at),!(at.currentTarget===at.relatedTarget||Wr(at.currentTarget,at.relatedTarget))&&Gr(ct,at)}function Gr(ct,at){var Zr={id:fe.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:Ye(at),currentTime:fe.now()};Hi(ct,at,[Zr])}function qr(ct,at){at=fe.getEvent(at),oi(ct,at)}function si(ct,at){at=fe.getEvent(at),!(at.currentTarget===at.relatedTarget||Wr(at.currentTarget,at.relatedTarget))&&oi(ct,at)}function oi(ct,at){var Zr={id:fe.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:Ye(at),currentTime:fe.now()};Gi(ct,at,[Zr])}function Yr(ct){return fe.Browser.vendor===fe.BROWSERS.IE&&fe.Browser.version<9?ct===1?0:ct===2?2:ct===4?1:-1:ct}function ii(ct,at){var Zr;at=fe.getEvent(at),Zr={id:fe.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:Ye(at),currentTime:fe.now()},qi(ct,at,[Zr],Yr(at.button))&&(fe.stopEvent(at),Ge(ct,"mouse")),(ct.clickHandler||ct.dblClickHandler||ct.pressHandler||ct.dragHandler||ct.dragEndHandler)&&fe.cancelEvent(at)}function ti(ct,at){ui(ct,at)}function ni(ct,at){ui(ct,at),fe.stopEvent(at)}function ui(ct,at){var Zr;at=fe.getEvent(at),Zr={id:fe.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:Ye(at),currentTime:fe.now()},zi(ct,at,[Zr],Yr(at.button))&&qe(ct,"mouse")}function yi(ct,at){pi(ct,at)}function hi(ct,at){pi(ct,at),fe.stopEvent(at)}function pi(ct,at){var Zr;at=fe.getEvent(at),Zr={id:fe.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:Ye(at),currentTime:fe.now()},Ki(ct,at,[Zr])}function Ri(ct,at,Zr){var ei,di=Zr.getLength(),xi=[];if(Zr.type==="touch"||Zr.contacts>0){for(ei=0;ei<di;ei++)xi.push(Zr.getByIndex(ei));xi.length>0&&(zi(ct,at,xi,0),Zr.captureCount=1,qe(ct,Zr.type),Gi(ct,at,xi))}}function Ei(ct,at){var Zr,ei,di,xi=at.changedTouches.length,gi=[],fi,Si=ct.getActivePointersListByType("touch");for(Zr=fe.now(),Si.getLength()>at.touches.length-xi&&(fe.console.warn("Tracked touch contact count doesn't match event.touches.length. Removing all tracked touch pointers."),Ri(ct,at,Si)),ei=0;ei<xi;ei++)gi.push({id:at.changedTouches[ei].identifier,type:"touch",currentPos:Ye(at.changedTouches[ei]),currentTime:Zr});for(Hi(ct,at,gi),ei=0;ei<ee.length;ei++)if(ee[ei]!==ct&&ee[ei].isTracking()&&Wr(ee[ei].element,ct.element)){for(fi=[],di=0;di<xi;di++)fi.push({id:at.changedTouches[di].identifier,type:"touch",currentPos:Ye(at.changedTouches[di]),currentTime:Zr});Hi(ee[ei],at,fi)}qi(ct,at,gi,0)&&(fe.stopEvent(at),Ge(ct,"touch",xi)),fe.cancelEvent(at)}function bi(ct,at){vi(ct,at)}function _i(ct,at){vi(ct,at),fe.stopEvent(at)}function vi(ct,at){var Zr,ei,di,xi=at.changedTouches.length,gi=[],fi;for(Zr=fe.now(),ei=0;ei<xi;ei++)gi.push({id:at.changedTouches[ei].identifier,type:"touch",currentPos:Ye(at.changedTouches[ei]),currentTime:Zr});for(zi(ct,at,gi,0)&&qe(ct,"touch",xi),Gi(ct,at,gi),ei=0;ei<ee.length;ei++)if(ee[ei]!==ct&&ee[ei].isTracking()&&Wr(ee[ei].element,ct.element)){for(fi=[],di=0;di<xi;di++)fi.push({id:at.changedTouches[di].identifier,type:"touch",currentPos:Ye(at.changedTouches[di]),currentTime:Zr});Gi(ee[ei],at,fi)}fe.cancelEvent(at)}function Ti(ct,at){Li(ct,at)}function Fi(ct,at){Li(ct,at),fe.stopEvent(at)}function Li(ct,at){var Zr,ei=at.changedTouches.length,di=[];for(Zr=0;Zr<ei;Zr++)di.push({id:at.changedTouches[Zr].identifier,type:"touch",currentPos:Ye(at.changedTouches[Zr]),currentTime:fe.now()});Ki(ct,at,di),fe.cancelEvent(at)}function Di(ct,at){var Zr=ct.getActivePointersListByType("touch");Ri(ct,at,Zr)}function Oi(ct,at){return at.stopPropagation(),at.preventDefault(),!1}function ot(ct,at){return at.stopPropagation(),at.preventDefault(),!1}function Ur(ct,at){var Zr;at.currentTarget===at.relatedTarget||Wr(at.currentTarget,at.relatedTarget)||(Zr={id:at.pointerId,type:Ke(at),isPrimary:at.isPrimary,currentPos:Ye(at),currentTime:fe.now()},Hi(ct,at,[Zr]))}function ai(ct,at){var Zr;at.currentTarget===at.relatedTarget||Wr(at.currentTarget,at.relatedTarget)||(Zr={id:at.pointerId,type:Ke(at),isPrimary:at.isPrimary,currentPos:Ye(at),currentTime:fe.now()},Gi(ct,at,[Zr]))}function li(ct,at){var Zr;Zr={id:at.pointerId,type:Ke(at),isPrimary:at.isPrimary,currentPos:Ye(at),currentTime:fe.now()},qi(ct,at,[Zr],at.button)&&(fe.stopEvent(at),Ge(ct,Zr.type)),(ct.clickHandler||ct.dblClickHandler||ct.pressHandler||ct.dragHandler||ct.dragEndHandler||ct.pinchHandler)&&fe.cancelEvent(at)}function ci(ct,at){mi(ct,at)}function Ci(ct,at){var Zr=ct.getActivePointersListByType(Ke(at));Zr.getById(at.pointerId)&&mi(ct,at),fe.stopEvent(at)}function mi(ct,at){var Zr;Zr={id:at.pointerId,type:Ke(at),isPrimary:at.isPrimary,currentPos:Ye(at),currentTime:fe.now()},zi(ct,at,[Zr],at.button)&&qe(ct,Zr.type)}function Ii(ct,at){ki(ct,at)}function Ni(ct,at){var Zr=ct.getActivePointersListByType(Ke(at));Zr.getById(at.pointerId)&&ki(ct,at),fe.stopEvent(at)}function ki(ct,at){var Zr;Zr={id:at.pointerId,type:Ke(at),isPrimary:at.isPrimary,currentPos:Ye(at),currentTime:fe.now()},Ki(ct,at,[Zr])}function wi(ct,at){var Zr;Zr={id:at.pointerId,type:Ke(at)},ts(ct,at,[Zr])}function Ui(ct,at){return Object.prototype.hasOwnProperty.call(at,"isPrimary")||(ct.getLength()===0?at.isPrimary=!0:at.isPrimary=!1),at.speed=0,at.direction=0,at.contactPos=at.currentPos,at.contactTime=at.currentTime,at.lastPos=at.currentPos,at.lastTime=at.currentTime,ct.add(at)}function Mi(ct,at){var Zr,ei;return ct.getById(at.id)?(Zr=ct.removeById(at.id),Object.prototype.hasOwnProperty.call(at,"isPrimary")||(ei=ct.getPrimary(),ei||(ei=ct.getByIndex(0),ei&&(ei.isPrimary=!0)))):Zr=ct.getLength(),Zr}function Hi(ct,at,Zr){var ei=ct.getActivePointersListByType(Zr[0].type),di,xi=Zr.length,gi,fi,Si;for(di=0;di<xi;di++)gi=Zr[di],fi=ei.getById(gi.id),fi?(fi.insideElement=!0,fi.lastPos=fi.currentPos,fi.lastTime=fi.currentTime,fi.currentPos=gi.currentPos,fi.currentTime=gi.currentTime,gi=fi):(gi.captured=!1,gi.insideElementPressed=!1,gi.insideElement=!0,Ui(ei,gi)),ct.enterHandler&&(Si=ct.enterHandler({eventSource:ct,pointerType:gi.type,position:Xe(gi.currentPos,ct.element),buttons:ei.buttons,pointers:ct.getActivePointerCount(),insideElementPressed:gi.insideElementPressed,buttonDownAny:ei.buttons!==0,isTouchEvent:gi.type==="touch",originalEvent:at,preventDefaultAction:!1,userData:ct.userData}),Si===!1&&fe.cancelEvent(at))}function Gi(ct,at,Zr){var ei=ct.getActivePointersListByType(Zr[0].type),di,xi=Zr.length,gi,fi,Si;for(di=0;di<xi;di++)gi=Zr[di],fi=ei.getById(gi.id),fi&&(fi.captured?(fi.insideElement=!1,fi.lastPos=fi.currentPos,fi.lastTime=fi.currentTime,fi.currentPos=gi.currentPos,fi.currentTime=gi.currentTime):Mi(ei,fi),gi=fi),ct.exitHandler&&(Si=ct.exitHandler({eventSource:ct,pointerType:gi.type,position:gi.currentPos&&Xe(gi.currentPos,ct.element),buttons:ei.buttons,pointers:ct.getActivePointerCount(),insideElementPressed:fi?fi.insideElementPressed:!1,buttonDownAny:ei.buttons!==0,isTouchEvent:gi.type==="touch",originalEvent:at,preventDefaultAction:!1,userData:ct.userData}),Si===!1&&fe.cancelEvent(at))}function qi(ct,at,Zr,ei){var di=ue[ct.hash],xi,gi=ct.getActivePointersListByType(Zr[0].type),fi,Si=Zr.length,Pi,$i;typeof at.buttons<"u"?gi.buttons=at.buttons:fe.Browser.vendor===fe.BROWSERS.IE&&fe.Browser.version<9?ei===0?gi.buttons+=1:ei===1?gi.buttons+=4:ei===2?gi.buttons+=2:ei===3?gi.buttons+=8:ei===4?gi.buttons+=16:ei===5&&(gi.buttons+=32):ei===0?gi.buttons|=1:ei===1?gi.buttons|=4:ei===2?gi.buttons|=2:ei===3?gi.buttons|=8:ei===4?gi.buttons|=16:ei===5&&(gi.buttons|=32);var Bi=ct.getActivePointersListsExceptType(Zr[0].type);for(fi=0;fi<Bi.length;fi++)Ri(ct,at,Bi[fi]);if(ei!==0)return ct.nonPrimaryPressHandler&&(xi=ct.nonPrimaryPressHandler({eventSource:ct,pointerType:Zr[0].type,position:Xe(Zr[0].currentPos,ct.element),button:ei,buttons:gi.buttons,isTouchEvent:Zr[0].type==="touch",originalEvent:at,preventDefaultAction:!1,userData:ct.userData}),xi===!1&&fe.cancelEvent(at)),!1;for(fi=0;fi<Si;fi++)Pi=Zr[fi],$i=gi.getById(Pi.id),$i?($i.captured=!0,$i.insideElementPressed=!0,$i.insideElement=!0,$i.contactPos=Pi.currentPos,$i.contactTime=Pi.currentTime,$i.lastPos=$i.currentPos,$i.lastTime=$i.currentTime,$i.currentPos=Pi.currentPos,$i.currentTime=Pi.currentTime,Pi=$i):(Pi.captured=!0,Pi.insideElementPressed=!0,Pi.insideElement=!0,Ui(gi,Pi)),gi.addContact(),(ct.dragHandler||ct.dragEndHandler||ct.pinchHandler)&&fe.MouseTracker.gesturePointVelocityTracker.addPoint(ct,Pi),gi.contacts===1?ct.pressHandler&&(xi=ct.pressHandler({eventSource:ct,pointerType:Pi.type,position:Xe(Pi.contactPos,ct.element),buttons:gi.buttons,isTouchEvent:Pi.type==="touch",originalEvent:at,preventDefaultAction:!1,userData:ct.userData}),xi===!1&&fe.cancelEvent(at)):gi.contacts===2&&ct.pinchHandler&&Pi.type==="touch"&&(di.pinchGPoints=gi.asArray(),di.lastPinchDist=di.currentPinchDist=di.pinchGPoints[0].currentPos.distanceTo(di.pinchGPoints[1].currentPos),di.lastPinchCenter=di.currentPinchCenter=Je(di.pinchGPoints[0].currentPos,di.pinchGPoints[1].currentPos));return!0}function zi(ct,at,Zr,ei){var di=ue[ct.hash],xi=ct.getActivePointersListByType(Zr[0].type),gi,fi,Si,Pi,$i=Zr.length,Bi,Ai,Wi=!1,ji=!1,Yi;if(typeof at.buttons<"u"?xi.buttons=at.buttons:fe.Browser.vendor===fe.BROWSERS.IE&&fe.Browser.version<9?ei===0?xi.buttons-=1:ei===1?xi.buttons-=4:ei===2?xi.buttons-=2:ei===3?xi.buttons-=8:ei===4?xi.buttons-=16:ei===5&&(xi.buttons-=32):ei===0?xi.buttons^=-2:ei===1?xi.buttons^=-5:ei===2?xi.buttons^=-3:ei===3?xi.buttons^=-9:ei===4?xi.buttons^=-17:ei===5&&(xi.buttons^=-33),ei!==0){ct.nonPrimaryReleaseHandler&&(gi=ct.nonPrimaryReleaseHandler({eventSource:ct,pointerType:Zr[0].type,position:Xe(Zr[0].currentPos,ct.element),button:ei,buttons:xi.buttons,isTouchEvent:Zr[0].type==="touch",originalEvent:at,preventDefaultAction:!1,userData:ct.userData}),gi===!1&&fe.cancelEvent(at));var is=ct.getActivePointersListByType("mouse");return Ri(ct,at,is),!1}if(typeof Zr[0].currentPos>"u")return Ri(ct,at,xi),!1;for(Pi=0;Pi<$i;Pi++)Bi=Zr[Pi],Ai=xi.getById(Bi.id),Ai&&(Ai.captured&&(Ai.captured=!1,Wi=!0,ji=!0),Ai.lastPos=Ai.currentPos,Ai.lastTime=Ai.currentTime,Ai.currentPos=Bi.currentPos,Ai.currentTime=Bi.currentTime,Ai.insideElement||Mi(xi,Ai),fi=Ai.currentPos,Si=Ai.currentTime,ji?(xi.removeContact(),(ct.dragHandler||ct.dragEndHandler||ct.pinchHandler)&&fe.MouseTracker.gesturePointVelocityTracker.removePoint(ct,Ai),xi.contacts===0?(ct.releaseHandler&&(gi=ct.releaseHandler({eventSource:ct,pointerType:Ai.type,position:Xe(fi,ct.element),buttons:xi.buttons,insideElementPressed:Ai.insideElementPressed,insideElementReleased:Ai.insideElement,isTouchEvent:Ai.type==="touch",originalEvent:at,preventDefaultAction:!1,userData:ct.userData}),gi===!1&&fe.cancelEvent(at)),ct.dragEndHandler&&!Ai.currentPos.equals(Ai.contactPos)&&(gi=ct.dragEndHandler({eventSource:ct,pointerType:Ai.type,position:Xe(Ai.currentPos,ct.element),speed:Ai.speed,direction:Ai.direction,shift:at.shiftKey,isTouchEvent:Ai.type==="touch",originalEvent:at,preventDefaultAction:!1,userData:ct.userData}),gi===!1&&fe.cancelEvent(at)),(ct.clickHandler||ct.dblClickHandler)&&Ai.insideElement&&(Yi=Si-Ai.contactTime<=ct.clickTimeThreshold&&Ai.contactPos.distanceTo(fi)<=ct.clickDistThreshold,ct.clickHandler&&(gi=ct.clickHandler({eventSource:ct,pointerType:Ai.type,position:Xe(Ai.currentPos,ct.element),quick:Yi,shift:at.shiftKey,isTouchEvent:Ai.type==="touch",originalEvent:at,preventDefaultAction:!1,userData:ct.userData}),gi===!1&&fe.cancelEvent(at)),ct.dblClickHandler&&Yi&&(xi.clicks++,xi.clicks===1?(di.lastClickPos=fi,di.dblClickTimeOut=setTimeout(function(){xi.clicks=0},ct.dblClickTimeThreshold)):xi.clicks===2&&(clearTimeout(di.dblClickTimeOut),xi.clicks=0,di.lastClickPos.distanceTo(fi)<=ct.dblClickDistThreshold&&(gi=ct.dblClickHandler({eventSource:ct,pointerType:Ai.type,position:Xe(Ai.currentPos,ct.element),shift:at.shiftKey,isTouchEvent:Ai.type==="touch",originalEvent:at,preventDefaultAction:!1,userData:ct.userData}),gi===!1&&fe.cancelEvent(at)),di.lastClickPos=null)))):xi.contacts===2&&ct.pinchHandler&&Ai.type==="touch"&&(di.pinchGPoints=xi.asArray(),di.lastPinchDist=di.currentPinchDist=di.pinchGPoints[0].currentPos.distanceTo(di.pinchGPoints[1].currentPos),di.lastPinchCenter=di.currentPinchCenter=Je(di.pinchGPoints[0].currentPos,di.pinchGPoints[1].currentPos))):ct.releaseHandler&&(gi=ct.releaseHandler({eventSource:ct,pointerType:Ai.type,position:Xe(fi,ct.element),buttons:xi.buttons,insideElementPressed:Ai.insideElementPressed,insideElementReleased:Ai.insideElement,isTouchEvent:Ai.type==="touch",originalEvent:at,preventDefaultAction:!1,userData:ct.userData}),gi===!1&&fe.cancelEvent(at)));return Wi}function Ki(ct,at,Zr){var ei=ue[ct.hash],di=ct.getActivePointersListByType(Zr[0].type),xi,gi=Zr.length,fi,Si,Pi,$i,Bi;for(typeof at.buttons<"u"&&(di.buttons=at.buttons),xi=0;xi<gi;xi++)fi=Zr[xi],Si=di.getById(fi.id),Si?(Object.prototype.hasOwnProperty.call(fi,"isPrimary")&&(Si.isPrimary=fi.isPrimary),Si.lastPos=Si.currentPos,Si.lastTime=Si.currentTime,Si.currentPos=fi.currentPos,Si.currentTime=fi.currentTime):(fi.captured=!1,fi.insideElementPressed=!1,fi.insideElement=!0,Ui(di,fi));ct.stopHandler&&Zr[0].type==="mouse"&&(clearTimeout(ct.stopTimeOut),ct.stopTimeOut=setTimeout(function(){rs(ct,at,Zr[0].type)},ct.stopDelay)),di.contacts===0?ct.moveHandler&&(Bi=ct.moveHandler({eventSource:ct,pointerType:Zr[0].type,position:Xe(Zr[0].currentPos,ct.element),buttons:di.buttons,isTouchEvent:Zr[0].type==="touch",originalEvent:at,preventDefaultAction:!1,userData:ct.userData}),Bi===!1&&fe.cancelEvent(at)):di.contacts===1?(ct.moveHandler&&(Si=di.asArray()[0],Bi=ct.moveHandler({eventSource:ct,pointerType:Si.type,position:Xe(Si.currentPos,ct.element),buttons:di.buttons,isTouchEvent:Si.type==="touch",originalEvent:at,preventDefaultAction:!1,userData:ct.userData}),Bi===!1&&fe.cancelEvent(at)),ct.dragHandler&&(Si=di.asArray()[0],$i=Si.currentPos.minus(Si.lastPos),Bi=ct.dragHandler({eventSource:ct,pointerType:Si.type,position:Xe(Si.currentPos,ct.element),buttons:di.buttons,delta:$i,speed:Si.speed,direction:Si.direction,shift:at.shiftKey,isTouchEvent:Si.type==="touch",originalEvent:at,preventDefaultAction:!1,userData:ct.userData}),Bi===!1&&fe.cancelEvent(at))):di.contacts===2&&(ct.moveHandler&&(Pi=di.asArray(),Bi=ct.moveHandler({eventSource:ct,pointerType:Pi[0].type,position:Xe(Je(Pi[0].currentPos,Pi[1].currentPos),ct.element),buttons:di.buttons,isTouchEvent:Pi[0].type==="touch",originalEvent:at,preventDefaultAction:!1,userData:ct.userData}),Bi===!1&&fe.cancelEvent(at)),ct.pinchHandler&&Zr[0].type==="touch"&&($i=ei.pinchGPoints[0].currentPos.distanceTo(ei.pinchGPoints[1].currentPos),$i!=ei.currentPinchDist&&(ei.lastPinchDist=ei.currentPinchDist,ei.currentPinchDist=$i,ei.lastPinchCenter=ei.currentPinchCenter,ei.currentPinchCenter=Je(ei.pinchGPoints[0].currentPos,ei.pinchGPoints[1].currentPos),Bi=ct.pinchHandler({eventSource:ct,pointerType:"touch",gesturePoints:ei.pinchGPoints,lastCenter:Xe(ei.lastPinchCenter,ct.element),center:Xe(ei.currentPinchCenter,ct.element),lastDistance:ei.lastPinchDist,distance:ei.currentPinchDist,shift:at.shiftKey,originalEvent:at,preventDefaultAction:!1,userData:ct.userData}),Bi===!1&&fe.cancelEvent(at))))}function ts(ct,at,Zr){zi(ct,at,Zr,0),Gi(ct,at,Zr)}function rs(ct,at,Zr){ct.stopHandler&&ct.stopHandler({eventSource:ct,pointerType:Zr,position:Ze(at,ct.element),buttons:ct.getActivePointersListByType(Zr).buttons,isTouchEvent:Zr==="touch",originalEvent:at,preventDefaultAction:!1,userData:ct.userData})}var Xi=function(){try{return window.self!==window.top}catch{return!0}}();function Zi(ct){try{return ct.addEventListener&&ct.removeEventListener}catch{return!1}}}(OpenSeadragon),function(fe){fe.ControlAnchor={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4,ABSOLUTE:5},fe.Control=function(ee,ue,pe){var _e=ee.parentNode;typeof ue=="number"&&(fe.console.error("Passing an anchor directly into the OpenSeadragon.Control constructor is deprecated; please use an options object instead.  Support for this deprecated variant is scheduled for removal in December 2013"),ue={anchor:ue}),ue.attachToViewer=typeof ue.attachToViewer>"u"?!0:ue.attachToViewer,this.autoFade=typeof ue.autoFade>"u"?!0:ue.autoFade,this.element=ee,this.anchor=ue.anchor,this.container=pe,this.anchor==fe.ControlAnchor.ABSOLUTE?(this.wrapper=fe.makeNeutralElement("div"),this.wrapper.style.position="absolute",this.wrapper.style.top=typeof ue.top=="number"?ue.top+"px":ue.top,this.wrapper.style.left=typeof ue.left=="number"?ue.left+"px":ue.left,this.wrapper.style.height=typeof ue.height=="number"?ue.height+"px":ue.height,this.wrapper.style.width=typeof ue.width=="number"?ue.width+"px":ue.width,this.wrapper.style.margin="0px",this.wrapper.style.padding="0px",this.element.style.position="relative",this.element.style.top="0px",this.element.style.left="0px",this.element.style.height="100%",this.element.style.width="100%"):(this.wrapper=fe.makeNeutralElement("div"),this.wrapper.style.display="inline-block",this.anchor==fe.ControlAnchor.NONE&&(this.wrapper.style.width=this.wrapper.style.height="100%")),this.wrapper.appendChild(this.element),ue.attachToViewer?this.anchor==fe.ControlAnchor.TOP_RIGHT||this.anchor==fe.ControlAnchor.BOTTOM_RIGHT?this.container.insertBefore(this.wrapper,this.container.firstChild):this.container.appendChild(this.wrapper):_e.appendChild(this.wrapper)},fe.Control.prototype={destroy:function(){this.wrapper.removeChild(this.element),this.container.removeChild(this.wrapper)},isVisible:function(){return this.wrapper.style.display!="none"},setVisible:function(ee){this.wrapper.style.display=ee?this.anchor==fe.ControlAnchor.ABSOLUTE?"block":"inline-block":"none"},setOpacity:function(ee){this.element[fe.SIGNAL]&&fe.Browser.vendor==fe.BROWSERS.IE?fe.setElementOpacity(this.element,ee,!0):fe.setElementOpacity(this.wrapper,ee,!0)}}}(OpenSeadragon),function(fe){fe.ControlDock=function(ue){var pe=["topleft","topright","bottomright","bottomleft"],_e,Ne;for(fe.extend(!0,this,{id:"controldock-"+fe.now()+"-"+Math.floor(Math.random()*1e6),container:fe.makeNeutralElement("div"),controls:[]},ue),this.container.onsubmit=function(){return!1},this.element&&(this.element=fe.getElement(this.element),this.element.appendChild(this.container),this.element.style.position="relative",this.container.style.width="100%",this.container.style.height="100%"),Ne=0;Ne<pe.length;Ne++)_e=pe[Ne],this.controls[_e]=fe.makeNeutralElement("div"),this.controls[_e].style.position="absolute",_e.match("left")&&(this.controls[_e].style.left="0px"),_e.match("right")&&(this.controls[_e].style.right="0px"),_e.match("top")&&(this.controls[_e].style.top="0px"),_e.match("bottom")&&(this.controls[_e].style.bottom="0px");this.container.appendChild(this.controls.topleft),this.container.appendChild(this.controls.topright),this.container.appendChild(this.controls.bottomright),this.container.appendChild(this.controls.bottomleft)},fe.ControlDock.prototype={addControl:function(ue,pe){ue=fe.getElement(ue);var _e=null;if(!(ee(this,ue)>=0)){switch(pe.anchor){case fe.ControlAnchor.TOP_RIGHT:_e=this.controls.topright,ue.style.position="relative",ue.style.paddingRight="0px",ue.style.paddingTop="0px";break;case fe.ControlAnchor.BOTTOM_RIGHT:_e=this.controls.bottomright,ue.style.position="relative",ue.style.paddingRight="0px",ue.style.paddingBottom="0px";break;case fe.ControlAnchor.BOTTOM_LEFT:_e=this.controls.bottomleft,ue.style.position="relative",ue.style.paddingLeft="0px",ue.style.paddingBottom="0px";break;case fe.ControlAnchor.TOP_LEFT:_e=this.controls.topleft,ue.style.position="relative",ue.style.paddingLeft="0px",ue.style.paddingTop="0px";break;case fe.ControlAnchor.ABSOLUTE:_e=this.container,ue.style.margin="0px",ue.style.padding="0px";break;default:case fe.ControlAnchor.NONE:_e=this.container,ue.style.margin="0px",ue.style.padding="0px";break}this.controls.push(new fe.Control(ue,pe,_e)),ue.style.display="inline-block"}},removeControl:function(ue){ue=fe.getElement(ue);var pe=ee(this,ue);return pe>=0&&(this.controls[pe].destroy(),this.controls.splice(pe,1)),this},clearControls:function(){for(;this.controls.length>0;)this.controls.pop().destroy();return this},areControlsEnabled:function(){var ue;for(ue=this.controls.length-1;ue>=0;ue--)if(this.controls[ue].isVisible())return!0;return!1},setControlsEnabled:function(ue){var pe;for(pe=this.controls.length-1;pe>=0;pe--)this.controls[pe].setVisible(ue);return this}};function ee(ue,pe){var _e=ue.controls,Ne;for(Ne=_e.length-1;Ne>=0;Ne--)if(_e[Ne].element==pe)return Ne;return-1}}(OpenSeadragon),function(fe){fe.Placement=fe.freezeObject({CENTER:0,TOP_LEFT:1,TOP:2,TOP_RIGHT:3,RIGHT:4,BOTTOM_RIGHT:5,BOTTOM:6,BOTTOM_LEFT:7,LEFT:8,properties:{0:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1},1:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},2:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},3:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!0,isVerticallyCentered:!1,isBottom:!1},4:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!0,isBottom:!1},5:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!1,isBottom:!0},6:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},7:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},8:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1}}})}(OpenSeadragon),function(fe){var ee={},ue=1;fe.Viewer=function(ot){var Ur=arguments,ai=this,li;if(fe.isPlainObject(ot)||(ot={id:Ur[0],xmlPath:Ur.length>1?Ur[1]:void 0,prefixUrl:Ur.length>2?Ur[2]:void 0,controls:Ur.length>3?Ur[3]:void 0,overlays:Ur.length>4?Ur[4]:void 0}),ot.config&&(fe.extend(!0,ot,ot.config),delete ot.config),fe.extend(!0,this,{id:ot.id,hash:ot.hash||ue++,initialPage:0,element:null,container:null,canvas:null,overlays:[],overlaysContainer:null,previousBody:[],customControls:[],source:null,drawer:null,world:null,viewport:null,navigator:null,collectionViewport:null,collectionDrawer:null,navImages:null,buttons:null,profiler:null},fe.DEFAULT_SETTINGS,ot),typeof this.hash>"u")throw new Error("A hash must be defined, either by specifying options.id or options.hash.");for(typeof ee[this.hash]<"u"&&fe.console.warn("Hash "+this.hash+" has already been used."),ee[this.hash]={fsBoundsDelta:new fe.Point(1,1),prevContainerSize:null,animating:!1,forceRedraw:!1,mouseInside:!1,group:null,zooming:!1,zoomFactor:null,lastZoomTime:null,fullPage:!1,onfullscreenchange:null},this._sequenceIndex=0,this._firstOpen=!0,this._updateRequestId=null,this._loadQueue=[],this.currentOverlays=[],this._lastScrollTime=fe.now(),fe.EventSource.call(this),this.addHandler("open-failed",function(ci){var Ci=fe.getString("Errors.OpenFailed",ci.eventSource,ci.message);ai._showMessage(Ci)}),fe.ControlDock.call(this,ot),this.xmlPath&&(this.tileSources=[this.xmlPath]),this.element=this.element||document.getElementById(this.id),this.canvas=fe.makeNeutralElement("div"),this.canvas.className="openseadragon-canvas",function(ci){ci.width="100%",ci.height="100%",ci.overflow="hidden",ci.position="absolute",ci.top="0px",ci.left="0px"}(this.canvas.style),fe.setElementTouchActionNone(this.canvas),ot.tabIndex!==""&&(this.canvas.tabIndex=ot.tabIndex===void 0?0:ot.tabIndex),this.container.className="openseadragon-container",function(ci){ci.width="100%",ci.height="100%",ci.position="relative",ci.overflow="hidden",ci.left="0px",ci.top="0px",ci.textAlign="left"}(this.container.style),this.container.insertBefore(this.canvas,this.container.firstChild),this.element.appendChild(this.container),this.bodyWidth=document.body.style.width,this.bodyHeight=document.body.style.height,this.bodyOverflow=document.body.style.overflow,this.docOverflow=document.documentElement.style.overflow,this.innerTracker=new fe.MouseTracker({element:this.canvas,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,keyDownHandler:fe.delegate(this,tt),keyHandler:fe.delegate(this,rt),clickHandler:fe.delegate(this,et),dblClickHandler:fe.delegate(this,it),dragHandler:fe.delegate(this,nt),dragEndHandler:fe.delegate(this,st),enterHandler:fe.delegate(this,lt),exitHandler:fe.delegate(this,_r),pressHandler:fe.delegate(this,jr),releaseHandler:fe.delegate(this,Nr),nonPrimaryPressHandler:fe.delegate(this,Wr),nonPrimaryReleaseHandler:fe.delegate(this,ri),scrollHandler:fe.delegate(this,Gr),pinchHandler:fe.delegate(this,Xr)}),this.outerTracker=new fe.MouseTracker({element:this.container,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,enterHandler:fe.delegate(this,qr),exitHandler:fe.delegate(this,si)}),this.toolbar&&(this.toolbar=new fe.ControlDock({element:this.toolbar})),this.bindStandardControls(),ee[this.hash].prevContainerSize=pe(this.container),this.world=new fe.World({viewer:this}),this.world.addHandler("add-item",function(ci){ai.source=ai.world.getItemAt(0).source,ee[ai.hash].forceRedraw=!0,ai._updateRequestId||(ai._updateRequestId=Ge(ai,oi))}),this.world.addHandler("remove-item",function(ci){ai.world.getItemCount()?ai.source=ai.world.getItemAt(0).source:ai.source=null,ee[ai.hash].forceRedraw=!0}),this.world.addHandler("metrics-change",function(ci){ai.viewport&&ai.viewport._setContentBounds(ai.world.getHomeBounds(),ai.world.getContentFactor())}),this.world.addHandler("item-index-change",function(ci){ai.source=ai.world.getItemAt(0).source}),this.viewport=new fe.Viewport({containerSize:ee[this.hash].prevContainerSize,springStiffness:this.springStiffness,animationTime:this.animationTime,minZoomImageRatio:this.minZoomImageRatio,maxZoomPixelRatio:this.maxZoomPixelRatio,visibilityRatio:this.visibilityRatio,wrapHorizontal:this.wrapHorizontal,wrapVertical:this.wrapVertical,defaultZoomLevel:this.defaultZoomLevel,minZoomLevel:this.minZoomLevel,maxZoomLevel:this.maxZoomLevel,viewer:this,degrees:this.degrees,flipped:this.flipped,navigatorRotate:this.navigatorRotate,homeFillsViewer:this.homeFillsViewer,margins:this.viewportMargins}),this.viewport._setContentBounds(this.world.getHomeBounds(),this.world.getContentFactor()),this.imageLoader=new fe.ImageLoader({jobLimit:this.imageLoaderLimit,timeout:ot.timeout}),this.tileCache=new fe.TileCache({maxImageCacheCount:this.maxImageCacheCount}),this.drawer=new fe.Drawer({viewer:this,viewport:this.viewport,element:this.canvas,debugGridColor:this.debugGridColor}),this.overlaysContainer=fe.makeNeutralElement("div"),this.canvas.appendChild(this.overlaysContainer),this.drawer.canRotate()||(this.rotateLeft&&(li=this.buttons.buttons.indexOf(this.rotateLeft),this.buttons.buttons.splice(li,1),this.buttons.element.removeChild(this.rotateLeft.element)),this.rotateRight&&(li=this.buttons.buttons.indexOf(this.rotateRight),this.buttons.buttons.splice(li,1),this.buttons.element.removeChild(this.rotateRight.element))),this.showNavigator&&(this.navigator=new fe.Navigator({id:this.navigatorId,position:this.navigatorPosition,sizeRatio:this.navigatorSizeRatio,maintainSizeRatio:this.navigatorMaintainSizeRatio,top:this.navigatorTop,left:this.navigatorLeft,width:this.navigatorWidth,height:this.navigatorHeight,autoResize:this.navigatorAutoResize,autoFade:this.navigatorAutoFade,prefixUrl:this.prefixUrl,viewer:this,navigatorRotate:this.navigatorRotate,background:this.navigatorBackground,opacity:this.navigatorOpacity,borderColor:this.navigatorBorderColor,displayRegionColor:this.navigatorDisplayRegionColor,crossOriginPolicy:this.crossOriginPolicy})),this.sequenceMode&&this.bindSequenceControls(),this.tileSources&&this.open(this.tileSources),li=0;li<this.customControls.length;li++)this.addControl(this.customControls[li].id,{anchor:this.customControls[li].anchor});fe.requestAnimationFrame(function(){Ke(ai)}),this.imageSmoothingEnabled!==void 0&&!this.imageSmoothingEnabled&&this.drawer.setImageSmoothingEnabled(this.imageSmoothingEnabled)},fe.extend(fe.Viewer.prototype,fe.EventSource.prototype,fe.ControlDock.prototype,{isOpen:function(){return!!this.world.getItemCount()},openDzi:function(ot){return fe.console.error("[Viewer.openDzi] this function is deprecated; use Viewer.open() instead."),this.open(ot)},openTileSource:function(ot){return fe.console.error("[Viewer.openTileSource] this function is deprecated; use Viewer.open() instead."),this.open(ot)},open:function(ot,Ur){var ai=this;if(this.close(),!!ot){if(this.sequenceMode&&fe.isArray(ot)){this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),typeof Ur<"u"&&!isNaN(Ur)&&(this.initialPage=Ur),this.tileSources=ot,this._sequenceIndex=Math.max(0,Math.min(this.tileSources.length-1,this.initialPage)),this.tileSources.length&&(this.open(this.tileSources[this._sequenceIndex]),this.showReferenceStrip&&this.addReferenceStrip()),this._updateSequenceButtons(this._sequenceIndex);return}if(fe.isArray(ot)||(ot=[ot]),!!ot.length){this._opening=!0;for(var li=ot.length,ci=0,Ci=0,mi,Ii=function(){if(ci+Ci===li)if(ci){(ai._firstOpen||!ai.preserveViewport)&&(ai.viewport.goHome(!0),ai.viewport.update()),ai._firstOpen=!1;var wi=ot[0];if(wi.tileSource&&(wi=wi.tileSource),ai.overlays&&!ai.preserveOverlays)for(var Ui=0;Ui<ai.overlays.length;Ui++)ai.currentOverlays[Ui]=Ne(ai,ai.overlays[Ui]);ai._drawOverlays(),ai._opening=!1,ai.raiseEvent("open",{source:wi})}else ai._opening=!1,ai.raiseEvent("open-failed",mi)},Ni=function(wi){(!fe.isPlainObject(wi)||!wi.tileSource)&&(wi={tileSource:wi}),wi.index!==void 0&&(fe.console.error("[Viewer.open] setting indexes here is not supported; use addTiledImage instead"),delete wi.index),wi.collectionImmediately===void 0&&(wi.collectionImmediately=!0);var Ui=wi.success;wi.success=function(Hi){if(ci++,wi.tileSource.overlays)for(var Gi=0;Gi<wi.tileSource.overlays.length;Gi++)ai.addOverlay(wi.tileSource.overlays[Gi]);Ui&&Ui(Hi),Ii()};var Mi=wi.error;wi.error=function(Hi){Ci++,mi||(mi=Hi),Mi&&Mi(Hi),Ii()},ai.addTiledImage(wi)},ki=0;ki<ot.length;ki++)Ni(ot[ki]);return this}}},close:function(){return ee[this.hash]?(this._opening=!1,this.navigator&&this.navigator.close(),this.preserveOverlays||(this.clearOverlays(),this.overlaysContainer.innerHTML=""),ee[this.hash].animating=!1,this.world.removeAll(),this.imageLoader.clear(),this.raiseEvent("close"),this):this},destroy:function(){if(ee[this.hash]){if(this.close(),this.clearOverlays(),this.overlaysContainer.innerHTML="",this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),this._updateRequestId!==null&&(fe.cancelAnimationFrame(this._updateRequestId),this._updateRequestId=null),this.drawer&&this.drawer.destroy(),this.removeAllHandlers(),this.element)for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.innerTracker&&this.innerTracker.destroy(),this.outerTracker&&this.outerTracker.destroy(),ee[this.hash]=null,delete ee[this.hash],this.canvas=null,this.container=null,this.element=null}},isMouseNavEnabled:function(){return this.innerTracker.isTracking()},setMouseNavEnabled:function(ot){return this.innerTracker.setTracking(ot),this.outerTracker.setTracking(ot),this.raiseEvent("mouse-enabled",{enabled:ot}),this},areControlsEnabled:function(){var ot=this.controls.length,Ur;for(Ur=0;Ur<this.controls.length;Ur++)ot=ot&&this.controls[Ur].isVisible();return ot},setControlsEnabled:function(ot){return ot?Ze(this):Ke(this),this.raiseEvent("controls-enabled",{enabled:ot}),this},setDebugMode:function(ot){for(var Ur=0;Ur<this.world.getItemCount();Ur++)this.world.getItemAt(Ur).debugMode=ot;this.debugMode=ot,this.forceRedraw()},isFullPage:function(){return ee[this.hash].fullPage},setFullPage:function(ot){var Ur=document.body,ai=Ur.style,li=document.documentElement.style,ci=this,Ci,mi;if(ot==this.isFullPage())return this;var Ii={fullPage:ot,preventDefaultAction:!1};if(this.raiseEvent("pre-full-page",Ii),Ii.preventDefaultAction)return this;if(ot){for(this.elementSize=fe.getElementSize(this.element),this.pageScroll=fe.getPageScroll(),this.elementMargin=this.element.style.margin,this.element.style.margin="0",this.elementPadding=this.element.style.padding,this.element.style.padding="0",this.bodyMargin=ai.margin,this.docMargin=li.margin,ai.margin="0",li.margin="0",this.bodyPadding=ai.padding,this.docPadding=li.padding,ai.padding="0",li.padding="0",this.bodyWidth=ai.width,this.docWidth=li.width,ai.width="100%",li.width="100%",this.bodyHeight=ai.height,this.docHeight=li.height,ai.height="100%",li.height="100%",this.previousBody=[],ee[this.hash].prevElementParent=this.element.parentNode,ee[this.hash].prevNextSibling=this.element.nextSibling,ee[this.hash].prevElementWidth=this.element.style.width,ee[this.hash].prevElementHeight=this.element.style.height,Ci=Ur.childNodes.length,mi=0;mi<Ci;mi++)this.previousBody.push(Ur.childNodes[0]),Ur.removeChild(Ur.childNodes[0]);this.toolbar&&this.toolbar.element&&(this.toolbar.parentNode=this.toolbar.element.parentNode,this.toolbar.nextSibling=this.toolbar.element.nextSibling,Ur.appendChild(this.toolbar.element),fe.addClass(this.toolbar.element,"fullpage")),fe.addClass(this.element,"fullpage"),Ur.appendChild(this.element),this.element.style.height=fe.getWindowSize().y+"px",this.element.style.width=fe.getWindowSize().x+"px",this.toolbar&&this.toolbar.element&&(this.element.style.height=fe.getElementSize(this.element).y-fe.getElementSize(this.toolbar.element).y+"px"),ee[this.hash].fullPage=!0,fe.delegate(this,qr)({})}else{for(this.element.style.margin=this.elementMargin,this.element.style.padding=this.elementPadding,ai.margin=this.bodyMargin,li.margin=this.docMargin,ai.padding=this.bodyPadding,li.padding=this.docPadding,ai.width=this.bodyWidth,li.width=this.docWidth,ai.height=this.bodyHeight,li.height=this.docHeight,Ur.removeChild(this.element),Ci=this.previousBody.length,mi=0;mi<Ci;mi++)Ur.appendChild(this.previousBody.shift());fe.removeClass(this.element,"fullpage"),ee[this.hash].prevElementParent.insertBefore(this.element,ee[this.hash].prevNextSibling),this.toolbar&&this.toolbar.element&&(Ur.removeChild(this.toolbar.element),fe.removeClass(this.toolbar.element,"fullpage"),this.toolbar.parentNode.insertBefore(this.toolbar.element,this.toolbar.nextSibling),delete this.toolbar.parentNode,delete this.toolbar.nextSibling),this.element.style.width=ee[this.hash].prevElementWidth,this.element.style.height=ee[this.hash].prevElementHeight;var Ni=0,ki=function(){fe.setPageScroll(ci.pageScroll);var wi=fe.getPageScroll();Ni++,Ni<10&&(wi.x!==ci.pageScroll.x||wi.y!==ci.pageScroll.y)&&fe.requestAnimationFrame(ki)};fe.requestAnimationFrame(ki),ee[this.hash].fullPage=!1,fe.delegate(this,si)({})}return this.navigator&&this.viewport&&this.navigator.update(this.viewport),this.raiseEvent("full-page",{fullPage:ot}),this},setFullScreen:function(ot){var Ur=this;if(!fe.supportsFullScreen)return this.setFullPage(ot);if(fe.isFullScreen()===ot)return this;var ai={fullScreen:ot,preventDefaultAction:!1};if(this.raiseEvent("pre-full-screen",ai),ai.preventDefaultAction)return this;if(ot){if(this.setFullPage(!0),!this.isFullPage())return this;this.fullPageStyleWidth=this.element.style.width,this.fullPageStyleHeight=this.element.style.height,this.element.style.width="100%",this.element.style.height="100%";var li=function(){var ci=fe.isFullScreen();ci||(fe.removeEvent(document,fe.fullScreenEventName,li),fe.removeEvent(document,fe.fullScreenErrorEventName,li),Ur.setFullPage(!1),Ur.isFullPage()&&(Ur.element.style.width=Ur.fullPageStyleWidth,Ur.element.style.height=Ur.fullPageStyleHeight)),Ur.navigator&&Ur.viewport&&setTimeout(function(){Ur.navigator.update(Ur.viewport)}),Ur.raiseEvent("full-screen",{fullScreen:ci})};fe.addEvent(document,fe.fullScreenEventName,li),fe.addEvent(document,fe.fullScreenErrorEventName,li),fe.requestFullScreen(document.body)}else fe.exitFullScreen();return this},isVisible:function(){return this.container.style.visibility!="hidden"},setVisible:function(ot){return this.container.style.visibility=ot?"":"hidden",this.raiseEvent("visible",{visible:ot}),this},addTiledImage:function(ot){fe.console.assert(ot,"[Viewer.addTiledImage] options is required"),fe.console.assert(ot.tileSource,"[Viewer.addTiledImage] options.tileSource is required"),fe.console.assert(!ot.replace||ot.index>-1&&ot.index<this.world.getItemCount(),"[Viewer.addTiledImage] if options.replace is used, options.index must be a valid index in Viewer.world");var Ur=this;ot.replace&&(ot.replaceItem=Ur.world.getItemAt(ot.index)),this._hideMessage(),ot.placeholderFillStyle===void 0&&(ot.placeholderFillStyle=this.placeholderFillStyle),ot.opacity===void 0&&(ot.opacity=this.opacity),ot.preload===void 0&&(ot.preload=this.preload),ot.compositeOperation===void 0&&(ot.compositeOperation=this.compositeOperation),ot.crossOriginPolicy===void 0&&(ot.crossOriginPolicy=ot.tileSource.crossOriginPolicy!==void 0?ot.tileSource.crossOriginPolicy:this.crossOriginPolicy),ot.ajaxWithCredentials===void 0&&(ot.ajaxWithCredentials=this.ajaxWithCredentials),ot.loadTilesWithAjax===void 0&&(ot.loadTilesWithAjax=this.loadTilesWithAjax),ot.ajaxHeaders===void 0||ot.ajaxHeaders===null?ot.ajaxHeaders=this.ajaxHeaders:fe.isPlainObject(ot.ajaxHeaders)&&fe.isPlainObject(this.ajaxHeaders)&&(ot.ajaxHeaders=fe.extend({},this.ajaxHeaders,ot.ajaxHeaders));var ai={options:ot};function li(mi){for(var Ii=0;Ii<Ur._loadQueue.length;Ii++)if(Ur._loadQueue[Ii]===ai){Ur._loadQueue.splice(Ii,1);break}Ur._loadQueue.length===0&&ci(ai),Ur.raiseEvent("add-item-failed",mi),ot.error&&ot.error(mi)}function ci(mi){Ur.collectionMode&&(Ur.world.arrange({immediately:mi.options.collectionImmediately,rows:Ur.collectionRows,columns:Ur.collectionColumns,layout:Ur.collectionLayout,tileSize:Ur.collectionTileSize,tileMargin:Ur.collectionTileMargin}),Ur.world.setAutoRefigureSizes(!0))}if(fe.isArray(ot.tileSource)){setTimeout(function(){li({message:"[Viewer.addTiledImage] Sequences can not be added; add them one at a time instead.",source:ot.tileSource,options:ot})});return}this._loadQueue.push(ai);function Ci(){for(var mi,Ii,Ni;Ur._loadQueue.length&&(mi=Ur._loadQueue[0],!!mi.tileSource);){if(Ur._loadQueue.splice(0,1),mi.options.replace){var ki=Ur.world.getIndexOfItem(mi.options.replaceItem);ki!=-1&&(mi.options.index=ki),Ur.world.removeItem(mi.options.replaceItem)}Ii=new fe.TiledImage({viewer:Ur,source:mi.tileSource,viewport:Ur.viewport,drawer:Ur.drawer,tileCache:Ur.tileCache,imageLoader:Ur.imageLoader,x:mi.options.x,y:mi.options.y,width:mi.options.width,height:mi.options.height,fitBounds:mi.options.fitBounds,fitBoundsPlacement:mi.options.fitBoundsPlacement,clip:mi.options.clip,placeholderFillStyle:mi.options.placeholderFillStyle,opacity:mi.options.opacity,preload:mi.options.preload,degrees:mi.options.degrees,compositeOperation:mi.options.compositeOperation,springStiffness:Ur.springStiffness,animationTime:Ur.animationTime,minZoomImageRatio:Ur.minZoomImageRatio,wrapHorizontal:Ur.wrapHorizontal,wrapVertical:Ur.wrapVertical,immediateRender:Ur.immediateRender,blendTime:Ur.blendTime,alwaysBlend:Ur.alwaysBlend,minPixelRatio:Ur.minPixelRatio,smoothTileEdgesMinZoom:Ur.smoothTileEdgesMinZoom,iOSDevice:Ur.iOSDevice,crossOriginPolicy:mi.options.crossOriginPolicy,ajaxWithCredentials:mi.options.ajaxWithCredentials,loadTilesWithAjax:mi.options.loadTilesWithAjax,ajaxHeaders:mi.options.ajaxHeaders,debugMode:Ur.debugMode}),Ur.collectionMode&&Ur.world.setAutoRefigureSizes(!1),Ur.world.addItem(Ii,{index:mi.options.index}),Ur._loadQueue.length===0&&ci(mi),Ur.world.getItemCount()===1&&!Ur.preserveViewport&&Ur.viewport.goHome(!0),Ur.navigator&&(Ni=fe.extend({},mi.options,{replace:!1,originalTiledImage:Ii,tileSource:mi.tileSource}),Ur.navigator.addTiledImage(Ni)),mi.options.success&&mi.options.success({item:Ii})}}_e(this,ot.tileSource,ot,function(mi){ai.tileSource=mi,Ci()},function(mi){mi.options=ot,li(mi),Ci()})},addSimpleImage:function(ot){fe.console.assert(ot,"[Viewer.addSimpleImage] options is required"),fe.console.assert(ot.url,"[Viewer.addSimpleImage] options.url is required");var Ur=fe.extend({},ot,{tileSource:{type:"image",url:ot.url}});delete Ur.url,this.addTiledImage(Ur)},addLayer:function(ot){var Ur=this;fe.console.error("[Viewer.addLayer] this function is deprecated; use Viewer.addTiledImage() instead.");var ai=fe.extend({},ot,{success:function(li){Ur.raiseEvent("add-layer",{options:ot,drawer:li.item})},error:function(li){Ur.raiseEvent("add-layer-failed",li)}});return this.addTiledImage(ai),this},getLayerAtLevel:function(ot){return fe.console.error("[Viewer.getLayerAtLevel] this function is deprecated; use World.getItemAt() instead."),this.world.getItemAt(ot)},getLevelOfLayer:function(ot){return fe.console.error("[Viewer.getLevelOfLayer] this function is deprecated; use World.getIndexOfItem() instead."),this.world.getIndexOfItem(ot)},getLayersCount:function(){return fe.console.error("[Viewer.getLayersCount] this function is deprecated; use World.getItemCount() instead."),this.world.getItemCount()},setLayerLevel:function(ot,Ur){return fe.console.error("[Viewer.setLayerLevel] this function is deprecated; use World.setItemIndex() instead."),this.world.setItemIndex(ot,Ur)},removeLayer:function(ot){return fe.console.error("[Viewer.removeLayer] this function is deprecated; use World.removeItem() instead."),this.world.removeItem(ot)},forceRedraw:function(){return ee[this.hash].forceRedraw=!0,this},bindSequenceControls:function(){var ot=fe.delegate(this,Xe),Ur=fe.delegate(this,Je),ai=fe.delegate(this,Oi),li=fe.delegate(this,Di),ci=this.navImages,Ci=!0;return this.showSequenceControl&&((this.previousButton||this.nextButton)&&(Ci=!1),this.previousButton=new fe.Button({element:this.previousButton?fe.getElement(this.previousButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:fe.getString("Tooltips.PreviousPage"),srcRest:ti(this.prefixUrl,ci.previous.REST),srcGroup:ti(this.prefixUrl,ci.previous.GROUP),srcHover:ti(this.prefixUrl,ci.previous.HOVER),srcDown:ti(this.prefixUrl,ci.previous.DOWN),onRelease:li,onFocus:ot,onBlur:Ur}),this.nextButton=new fe.Button({element:this.nextButton?fe.getElement(this.nextButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:fe.getString("Tooltips.NextPage"),srcRest:ti(this.prefixUrl,ci.next.REST),srcGroup:ti(this.prefixUrl,ci.next.GROUP),srcHover:ti(this.prefixUrl,ci.next.HOVER),srcDown:ti(this.prefixUrl,ci.next.DOWN),onRelease:ai,onFocus:ot,onBlur:Ur}),this.navPrevNextWrap||this.previousButton.disable(),(!this.tileSources||!this.tileSources.length)&&this.nextButton.disable(),Ci&&(this.paging=new fe.ButtonGroup({buttons:[this.previousButton,this.nextButton],clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.pagingControl=this.paging.element,this.toolbar?this.toolbar.addControl(this.pagingControl,{anchor:fe.ControlAnchor.BOTTOM_RIGHT}):this.addControl(this.pagingControl,{anchor:this.sequenceControlAnchor||fe.ControlAnchor.TOP_LEFT}))),this},bindStandardControls:function(){var ot=fe.delegate(this,ni),Ur=fe.delegate(this,yi),ai=fe.delegate(this,Ri),li=fe.delegate(this,ui),ci=fe.delegate(this,Ei),Ci=fe.delegate(this,_i),mi=fe.delegate(this,vi),Ii=fe.delegate(this,Ti),Ni=fe.delegate(this,Fi),ki=fe.delegate(this,Li),wi=fe.delegate(this,Xe),Ui=fe.delegate(this,Je),Mi=this.navImages,Hi=[],Gi=!0;return this.showNavigationControl&&((this.zoomInButton||this.zoomOutButton||this.homeButton||this.fullPageButton||this.rotateLeftButton||this.rotateRightButton||this.flipButton)&&(Gi=!1),this.showZoomControl&&(Hi.push(this.zoomInButton=new fe.Button({element:this.zoomInButton?fe.getElement(this.zoomInButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:fe.getString("Tooltips.ZoomIn"),srcRest:ti(this.prefixUrl,Mi.zoomIn.REST),srcGroup:ti(this.prefixUrl,Mi.zoomIn.GROUP),srcHover:ti(this.prefixUrl,Mi.zoomIn.HOVER),srcDown:ti(this.prefixUrl,Mi.zoomIn.DOWN),onPress:ot,onRelease:Ur,onClick:ai,onEnter:ot,onExit:Ur,onFocus:wi,onBlur:Ui})),Hi.push(this.zoomOutButton=new fe.Button({element:this.zoomOutButton?fe.getElement(this.zoomOutButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:fe.getString("Tooltips.ZoomOut"),srcRest:ti(this.prefixUrl,Mi.zoomOut.REST),srcGroup:ti(this.prefixUrl,Mi.zoomOut.GROUP),srcHover:ti(this.prefixUrl,Mi.zoomOut.HOVER),srcDown:ti(this.prefixUrl,Mi.zoomOut.DOWN),onPress:li,onRelease:Ur,onClick:ci,onEnter:li,onExit:Ur,onFocus:wi,onBlur:Ui}))),this.showHomeControl&&Hi.push(this.homeButton=new fe.Button({element:this.homeButton?fe.getElement(this.homeButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:fe.getString("Tooltips.Home"),srcRest:ti(this.prefixUrl,Mi.home.REST),srcGroup:ti(this.prefixUrl,Mi.home.GROUP),srcHover:ti(this.prefixUrl,Mi.home.HOVER),srcDown:ti(this.prefixUrl,Mi.home.DOWN),onRelease:Ci,onFocus:wi,onBlur:Ui})),this.showFullPageControl&&Hi.push(this.fullPageButton=new fe.Button({element:this.fullPageButton?fe.getElement(this.fullPageButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:fe.getString("Tooltips.FullPage"),srcRest:ti(this.prefixUrl,Mi.fullpage.REST),srcGroup:ti(this.prefixUrl,Mi.fullpage.GROUP),srcHover:ti(this.prefixUrl,Mi.fullpage.HOVER),srcDown:ti(this.prefixUrl,Mi.fullpage.DOWN),onRelease:mi,onFocus:wi,onBlur:Ui})),this.showRotationControl&&(Hi.push(this.rotateLeftButton=new fe.Button({element:this.rotateLeftButton?fe.getElement(this.rotateLeftButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:fe.getString("Tooltips.RotateLeft"),srcRest:ti(this.prefixUrl,Mi.rotateleft.REST),srcGroup:ti(this.prefixUrl,Mi.rotateleft.GROUP),srcHover:ti(this.prefixUrl,Mi.rotateleft.HOVER),srcDown:ti(this.prefixUrl,Mi.rotateleft.DOWN),onRelease:Ii,onFocus:wi,onBlur:Ui})),Hi.push(this.rotateRightButton=new fe.Button({element:this.rotateRightButton?fe.getElement(this.rotateRightButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:fe.getString("Tooltips.RotateRight"),srcRest:ti(this.prefixUrl,Mi.rotateright.REST),srcGroup:ti(this.prefixUrl,Mi.rotateright.GROUP),srcHover:ti(this.prefixUrl,Mi.rotateright.HOVER),srcDown:ti(this.prefixUrl,Mi.rotateright.DOWN),onRelease:Ni,onFocus:wi,onBlur:Ui}))),this.showFlipControl&&Hi.push(this.flipButton=new fe.Button({element:this.flipButton?fe.getElement(this.flipButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:fe.getString("Tooltips.Flip"),srcRest:ti(this.prefixUrl,Mi.flip.REST),srcGroup:ti(this.prefixUrl,Mi.flip.GROUP),srcHover:ti(this.prefixUrl,Mi.flip.HOVER),srcDown:ti(this.prefixUrl,Mi.flip.DOWN),onRelease:ki,onFocus:wi,onBlur:Ui})),Gi&&(this.buttons=new fe.ButtonGroup({buttons:Hi,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.navControl=this.buttons.element,this.addHandler("open",fe.delegate(this,bi)),this.toolbar?this.toolbar.addControl(this.navControl,{anchor:this.navigationControlAnchor||fe.ControlAnchor.TOP_LEFT}):this.addControl(this.navControl,{anchor:this.navigationControlAnchor||fe.ControlAnchor.TOP_LEFT}))),this},currentPage:function(){return this._sequenceIndex},goToPage:function(ot){return this.tileSources&&ot>=0&&ot<this.tileSources.length&&(this._sequenceIndex=ot,this._updateSequenceButtons(ot),this.open(this.tileSources[ot]),this.referenceStrip&&this.referenceStrip.setFocus(ot),this.raiseEvent("page",{page:ot})),this},addOverlay:function(ot,Ur,ai,li){var ci;if(fe.isPlainObject(ot)?ci=ot:ci={element:ot,location:Ur,placement:ai,onDraw:li},ot=fe.getElement(ci.element),Ue(this.currentOverlays,ot)>=0)return this;var Ci=Ne(this,ci);return this.currentOverlays.push(Ci),Ci.drawHTML(this.overlaysContainer,this.viewport),this.raiseEvent("add-overlay",{element:ot,location:ci.location,placement:ci.placement}),this},updateOverlay:function(ot,Ur,ai){var li;return ot=fe.getElement(ot),li=Ue(this.currentOverlays,ot),li>=0&&(this.currentOverlays[li].update(Ur,ai),ee[this.hash].forceRedraw=!0,this.raiseEvent("update-overlay",{element:ot,location:Ur,placement:ai})),this},removeOverlay:function(ot){var Ur;return ot=fe.getElement(ot),Ur=Ue(this.currentOverlays,ot),Ur>=0&&(this.currentOverlays[Ur].destroy(),this.currentOverlays.splice(Ur,1),ee[this.hash].forceRedraw=!0,this.raiseEvent("remove-overlay",{element:ot})),this},clearOverlays:function(){for(;this.currentOverlays.length>0;)this.currentOverlays.pop().destroy();return ee[this.hash].forceRedraw=!0,this.raiseEvent("clear-overlay",{}),this},getOverlayById:function(ot){var Ur;return ot=fe.getElement(ot),Ur=Ue(this.currentOverlays,ot),Ur>=0?this.currentOverlays[Ur]:null},_updateSequenceButtons:function(ot){this.nextButton&&(!this.tileSources||this.tileSources.length-1===ot?this.navPrevNextWrap||this.nextButton.disable():this.nextButton.enable()),this.previousButton&&(ot>0?this.previousButton.enable():this.navPrevNextWrap||this.previousButton.disable())},_showMessage:function(ot){this._hideMessage();var Ur=fe.makeNeutralElement("div");Ur.appendChild(document.createTextNode(ot)),this.messageDiv=fe.makeCenteredNode(Ur),fe.addClass(this.messageDiv,"openseadragon-message"),this.container.appendChild(this.messageDiv)},_hideMessage:function(){var ot=this.messageDiv;ot&&(ot.parentNode.removeChild(ot),delete this.messageDiv)},gestureSettingsByDeviceType:function(ot){switch(ot){case"mouse":return this.gestureSettingsMouse;case"touch":return this.gestureSettingsTouch;case"pen":return this.gestureSettingsPen;default:return this.gestureSettingsUnknown}},_drawOverlays:function(){var ot,Ur=this.currentOverlays.length;for(ot=0;ot<Ur;ot++)this.currentOverlays[ot].drawHTML(this.overlaysContainer,this.viewport)},_cancelPendingImages:function(){this._loadQueue=[]},removeReferenceStrip:function(){this.showReferenceStrip=!1,this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null)},addReferenceStrip:function(){if(this.showReferenceStrip=!0,this.sequenceMode){if(this.referenceStrip)return;this.tileSources.length&&this.tileSources.length>1&&(this.referenceStrip=new fe.ReferenceStrip({id:this.referenceStripElement,position:this.referenceStripPosition,sizeRatio:this.referenceStripSizeRatio,scroll:this.referenceStripScroll,height:this.referenceStripHeight,width:this.referenceStripWidth,tileSources:this.tileSources,prefixUrl:this.prefixUrl,useCanvas:this.useCanvas,viewer:this}),this.referenceStrip.setFocus(this._sequenceIndex))}else fe.console.warn('Attempting to display a reference strip while "sequenceMode" is off.')}});function pe(ot){return ot=fe.getElement(ot),new fe.Point(ot.clientWidth===0?1:ot.clientWidth,ot.clientHeight===0?1:ot.clientHeight)}function _e(ot,Ur,ai,li,ci){var Ci=ot;if(fe.type(Ur)=="string"){if(Ur.match(/^\s*<.*>\s*$/))Ur=fe.parseXml(Ur);else if(Ur.match(/^\s*[\{\[].*[\}\]]\s*$/))try{var mi=fe.parseJSON(Ur);Ur=mi}catch{}}function Ii(Ni,ki){Ni.ready?li(Ni):(Ni.addHandler("ready",function(){li(Ni)}),Ni.addHandler("open-failed",function(wi){ci({message:wi.message,source:ki})}))}setTimeout(function(){if(fe.type(Ur)=="string")Ur=new fe.TileSource({url:Ur,crossOriginPolicy:ai.crossOriginPolicy!==void 0?ai.crossOriginPolicy:ot.crossOriginPolicy,ajaxWithCredentials:ot.ajaxWithCredentials,ajaxHeaders:ot.ajaxHeaders,useCanvas:ot.useCanvas,success:function(Ui){li(Ui.tileSource)}}),Ur.addHandler("open-failed",function(Ui){ci(Ui)});else if(fe.isPlainObject(Ur)||Ur.nodeType)if(Ur.crossOriginPolicy===void 0&&(ai.crossOriginPolicy!==void 0||ot.crossOriginPolicy!==void 0)&&(Ur.crossOriginPolicy=ai.crossOriginPolicy!==void 0?ai.crossOriginPolicy:ot.crossOriginPolicy),Ur.ajaxWithCredentials===void 0&&(Ur.ajaxWithCredentials=ot.ajaxWithCredentials),Ur.useCanvas===void 0&&(Ur.useCanvas=ot.useCanvas),fe.isFunction(Ur.getTileUrl)){var Ni=new fe.TileSource(Ur);Ni.getTileUrl=Ur.getTileUrl,li(Ni)}else{var ki=fe.TileSource.determineType(Ci,Ur);if(!ki){ci({message:"Unable to load TileSource",source:Ur});return}var wi=ki.prototype.configure.apply(Ci,[Ur]);Ii(new ki(wi),Ur)}else Ii(Ur,Ur)})}function Ne(ot,Ur){if(Ur instanceof fe.Overlay)return Ur;var ai=null;if(Ur.element)ai=fe.getElement(Ur.element);else{var li=Ur.id?Ur.id:"openseadragon-overlay-"+Math.floor(Math.random()*1e7);ai=fe.getElement(Ur.id),ai||(ai=document.createElement("a"),ai.href="#/overlay/"+li),ai.id=li,fe.addClass(ai,Ur.className?Ur.className:"openseadragon-overlay")}var ci=Ur.location,Ci=Ur.width,mi=Ur.height;if(!ci){var Ii=Ur.x,Ni=Ur.y;if(Ur.px!==void 0){var ki=ot.viewport.imageToViewportRectangle(new fe.Rect(Ur.px,Ur.py,Ci||0,mi||0));Ii=ki.x,Ni=ki.y,Ci=Ci!==void 0?ki.width:void 0,mi=mi!==void 0?ki.height:void 0}ci=new fe.Point(Ii,Ni)}var wi=Ur.placement;return wi&&fe.type(wi)==="string"&&(wi=fe.Placement[Ur.placement.toUpperCase()]),new fe.Overlay({element:ai,location:ci,placement:wi,onDraw:Ur.onDraw,checkResize:Ur.checkResize,width:Ci,height:mi,rotationMode:Ur.rotationMode})}function Ue(ot,Ur){var ai;for(ai=ot.length-1;ai>=0;ai--)if(ot[ai].element===Ur)return ai;return-1}function Ge(ot,Ur){return fe.requestAnimationFrame(function(){Ur(ot)})}function qe(ot){fe.requestAnimationFrame(function(){Ye(ot)})}function Ke(ot){ot.autoHideControls&&(ot.controlsShouldFade=!0,ot.controlsFadeBeginTime=fe.now()+ot.controlsFadeDelay,window.setTimeout(function(){qe(ot)},ot.controlsFadeDelay))}function Ye(ot){var Ur,ai,li,ci;if(ot.controlsShouldFade){for(Ur=fe.now(),ai=Ur-ot.controlsFadeBeginTime,li=1-ai/ot.controlsFadeLength,li=Math.min(1,li),li=Math.max(0,li),ci=ot.controls.length-1;ci>=0;ci--)ot.controls[ci].autoFade&&ot.controls[ci].setOpacity(li);li>0&&qe(ot)}}function Ze(ot){var Ur;for(ot.controlsShouldFade=!1,Ur=ot.controls.length-1;Ur>=0;Ur--)ot.controls[Ur].setOpacity(1)}function Xe(){Ze(this)}function Je(){Ke(this)}function tt(ot){var Ur={originalEvent:ot.originalEvent,preventDefaultAction:ot.preventDefaultAction,preventVerticalPan:ot.preventVerticalPan,preventHorizontalPan:ot.preventHorizontalPan};if(this.raiseEvent("canvas-key",Ur),!Ur.preventDefaultAction&&!ot.ctrl&&!ot.alt&&!ot.meta)switch(ot.keyCode){case 38:return Ur.preventVerticalPan||(ot.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new fe.Point(0,-this.pixelsPerArrowPress))),this.viewport.applyConstraints()),!1;case 40:return Ur.preventVerticalPan||(ot.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new fe.Point(0,this.pixelsPerArrowPress))),this.viewport.applyConstraints()),!1;case 37:return Ur.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new fe.Point(-this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),!1;case 39:return Ur.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new fe.Point(this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),!1;default:return!0}else return!0}function rt(ot){var Ur={originalEvent:ot.originalEvent,preventDefaultAction:ot.preventDefaultAction,preventVerticalPan:ot.preventVerticalPan,preventHorizontalPan:ot.preventHorizontalPan};if(this.raiseEvent("canvas-key",Ur),!Ur.preventDefaultAction&&!ot.ctrl&&!ot.alt&&!ot.meta)switch(ot.keyCode){case 43:case 61:return this.viewport.zoomBy(1.1),this.viewport.applyConstraints(),!1;case 45:return this.viewport.zoomBy(.9),this.viewport.applyConstraints(),!1;case 48:return this.viewport.goHome(),this.viewport.applyConstraints(),!1;case 119:case 87:return Ur.preventVerticalPan||(ot.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new fe.Point(0,-40))),this.viewport.applyConstraints()),!1;case 115:case 83:return Ur.preventVerticalPan||(ot.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new fe.Point(0,40))),this.viewport.applyConstraints()),!1;case 97:return Ur.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new fe.Point(-40,0))),this.viewport.applyConstraints()),!1;case 100:return Ur.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new fe.Point(40,0))),this.viewport.applyConstraints()),!1;case 114:return this.viewport.flipped?this.viewport.setRotation(fe.positiveModulo(this.viewport.degrees-this.rotationIncrement,360)):this.viewport.setRotation(fe.positiveModulo(this.viewport.degrees+this.rotationIncrement,360)),this.viewport.applyConstraints(),!1;case 82:return this.viewport.flipped?this.viewport.setRotation(fe.positiveModulo(this.viewport.degrees+this.rotationIncrement,360)):this.viewport.setRotation(fe.positiveModulo(this.viewport.degrees-this.rotationIncrement,360)),this.viewport.applyConstraints(),!1;case 102:return this.viewport.toggleFlip(),!1;default:return!0}else return!0}function et(ot){var Ur,ai=document.activeElement==this.canvas;ai||this.canvas.focus(),this.viewport.flipped&&(ot.position.x=this.viewport.getContainerSize().x-ot.position.x);var li={tracker:ot.eventSource,position:ot.position,quick:ot.quick,shift:ot.shift,originalEvent:ot.originalEvent,preventDefaultAction:ot.preventDefaultAction};this.raiseEvent("canvas-click",li),!li.preventDefaultAction&&this.viewport&&ot.quick&&(Ur=this.gestureSettingsByDeviceType(ot.pointerType),Ur.clickToZoom&&(this.viewport.zoomBy(ot.shift?1/this.zoomPerClick:this.zoomPerClick,Ur.zoomToRefPoint?this.viewport.pointFromPixel(ot.position,!0):null),this.viewport.applyConstraints()))}function it(ot){var Ur,ai={tracker:ot.eventSource,position:ot.position,shift:ot.shift,originalEvent:ot.originalEvent,preventDefaultAction:ot.preventDefaultAction};this.raiseEvent("canvas-double-click",ai),!ai.preventDefaultAction&&this.viewport&&(Ur=this.gestureSettingsByDeviceType(ot.pointerType),Ur.dblClickToZoom&&(this.viewport.zoomBy(ot.shift?1/this.zoomPerClick:this.zoomPerClick,Ur.zoomToRefPoint?this.viewport.pointFromPixel(ot.position,!0):null),this.viewport.applyConstraints()))}function nt(ot){var Ur,ai={tracker:ot.eventSource,position:ot.position,delta:ot.delta,speed:ot.speed,direction:ot.direction,shift:ot.shift,originalEvent:ot.originalEvent,preventDefaultAction:ot.preventDefaultAction};if(this.raiseEvent("canvas-drag",ai),!ai.preventDefaultAction&&this.viewport){if(Ur=this.gestureSettingsByDeviceType(ot.pointerType),this.panHorizontal||(ot.delta.x=0),this.panVertical||(ot.delta.y=0),this.viewport.flipped&&(ot.delta.x=-ot.delta.x),this.constrainDuringPan){var li=this.viewport.deltaPointsFromPixels(ot.delta.negate());this.viewport.centerSpringX.target.value+=li.x,this.viewport.centerSpringY.target.value+=li.y;var ci=this.viewport.getBounds(),Ci=this.viewport.getConstrainedBounds();this.viewport.centerSpringX.target.value-=li.x,this.viewport.centerSpringY.target.value-=li.y,ci.x!=Ci.x&&(ot.delta.x=0),ci.y!=Ci.y&&(ot.delta.y=0)}this.viewport.panBy(this.viewport.deltaPointsFromPixels(ot.delta.negate()),Ur.flickEnabled&&!this.constrainDuringPan)}}function st(ot){if(!ot.preventDefaultAction&&this.viewport){var Ur=this.gestureSettingsByDeviceType(ot.pointerType);if(Ur.flickEnabled&&ot.speed>=Ur.flickMinSpeed){var ai=0;this.panHorizontal&&(ai=Ur.flickMomentum*ot.speed*Math.cos(ot.direction));var li=0;this.panVertical&&(li=Ur.flickMomentum*ot.speed*Math.sin(ot.direction));var ci=this.viewport.pixelFromPoint(this.viewport.getCenter(!0)),Ci=this.viewport.pointFromPixel(new fe.Point(ci.x-ai,ci.y-li));this.viewport.panTo(Ci,!1)}this.viewport.applyConstraints()}this.raiseEvent("canvas-drag-end",{tracker:ot.eventSource,position:ot.position,speed:ot.speed,direction:ot.direction,shift:ot.shift,originalEvent:ot.originalEvent})}function lt(ot){this.raiseEvent("canvas-enter",{tracker:ot.eventSource,pointerType:ot.pointerType,position:ot.position,buttons:ot.buttons,pointers:ot.pointers,insideElementPressed:ot.insideElementPressed,buttonDownAny:ot.buttonDownAny,originalEvent:ot.originalEvent})}function _r(ot){window.location!=window.parent.location&&fe.MouseTracker.resetAllMouseTrackers(),this.raiseEvent("canvas-exit",{tracker:ot.eventSource,pointerType:ot.pointerType,position:ot.position,buttons:ot.buttons,pointers:ot.pointers,insideElementPressed:ot.insideElementPressed,buttonDownAny:ot.buttonDownAny,originalEvent:ot.originalEvent})}function jr(ot){this.raiseEvent("canvas-press",{tracker:ot.eventSource,pointerType:ot.pointerType,position:ot.position,insideElementPressed:ot.insideElementPressed,insideElementReleased:ot.insideElementReleased,originalEvent:ot.originalEvent})}function Nr(ot){this.raiseEvent("canvas-release",{tracker:ot.eventSource,pointerType:ot.pointerType,position:ot.position,insideElementPressed:ot.insideElementPressed,insideElementReleased:ot.insideElementReleased,originalEvent:ot.originalEvent})}function Wr(ot){this.raiseEvent("canvas-nonprimary-press",{tracker:ot.eventSource,position:ot.position,pointerType:ot.pointerType,button:ot.button,buttons:ot.buttons,originalEvent:ot.originalEvent})}function ri(ot){this.raiseEvent("canvas-nonprimary-release",{tracker:ot.eventSource,position:ot.position,pointerType:ot.pointerType,button:ot.button,buttons:ot.buttons,originalEvent:ot.originalEvent})}function Xr(ot){var Ur,ai,li,ci;if(!ot.preventDefaultAction&&this.viewport&&(Ur=this.gestureSettingsByDeviceType(ot.pointerType),Ur.pinchToZoom&&(ai=this.viewport.pointFromPixel(ot.center,!0),li=this.viewport.pointFromPixel(ot.lastCenter,!0),ci=li.minus(ai),this.panHorizontal||(ci.x=0),this.panVertical||(ci.y=0),this.viewport.zoomBy(ot.distance/ot.lastDistance,ai,!0),Ur.zoomToRefPoint&&this.viewport.panBy(ci,!0),this.viewport.applyConstraints()),Ur.pinchRotate)){var Ci=Math.atan2(ot.gesturePoints[0].currentPos.y-ot.gesturePoints[1].currentPos.y,ot.gesturePoints[0].currentPos.x-ot.gesturePoints[1].currentPos.x),mi=Math.atan2(ot.gesturePoints[0].lastPos.y-ot.gesturePoints[1].lastPos.y,ot.gesturePoints[0].lastPos.x-ot.gesturePoints[1].lastPos.x);this.viewport.setRotation(this.viewport.getRotation()+(Ci-mi)*(180/Math.PI))}return this.raiseEvent("canvas-pinch",{tracker:ot.eventSource,gesturePoints:ot.gesturePoints,lastCenter:ot.lastCenter,center:ot.center,lastDistance:ot.lastDistance,distance:ot.distance,shift:ot.shift,originalEvent:ot.originalEvent}),!1}function Gr(ot){var Ur,ai,li,ci;if(li=fe.now(),ci=li-this._lastScrollTime,ci>this.minScrollDeltaTime){if(this._lastScrollTime=li,this.viewport.flipped&&(ot.position.x=this.viewport.getContainerSize().x-ot.position.x),!ot.preventDefaultAction&&this.viewport&&(Ur=this.gestureSettingsByDeviceType(ot.pointerType),Ur.scrollToZoom&&(ai=Math.pow(this.zoomPerScroll,ot.scroll),this.viewport.zoomBy(ai,Ur.zoomToRefPoint?this.viewport.pointFromPixel(ot.position,!0):null),this.viewport.applyConstraints())),this.raiseEvent("canvas-scroll",{tracker:ot.eventSource,position:ot.position,scroll:ot.scroll,shift:ot.shift,originalEvent:ot.originalEvent}),Ur&&Ur.scrollToZoom)return!1}else if(Ur=this.gestureSettingsByDeviceType(ot.pointerType),Ur&&Ur.scrollToZoom)return!1}function qr(ot){ee[this.hash].mouseInside=!0,Ze(this),this.raiseEvent("container-enter",{tracker:ot.eventSource,position:ot.position,buttons:ot.buttons,pointers:ot.pointers,insideElementPressed:ot.insideElementPressed,buttonDownAny:ot.buttonDownAny,originalEvent:ot.originalEvent})}function si(ot){ot.pointers<1&&(ee[this.hash].mouseInside=!1,ee[this.hash].animating||Ke(this)),this.raiseEvent("container-exit",{tracker:ot.eventSource,position:ot.position,buttons:ot.buttons,pointers:ot.pointers,insideElementPressed:ot.insideElementPressed,buttonDownAny:ot.buttonDownAny,originalEvent:ot.originalEvent})}function oi(ot){Yr(ot),ot.isOpen()?ot._updateRequestId=Ge(ot,oi):ot._updateRequestId=!1}function Yr(ot){if(!ot._opening){if(ot.autoResize){var Ur=pe(ot.container),ai=ee[ot.hash].prevContainerSize;if(!Ur.equals(ai)){var li=ot.viewport;if(ot.preserveImageSizeOnResize){var ci=ai.x/Ur.x,Ci=li.getZoom()*ci,mi=li.getCenter();li.resize(Ur,!1),li.zoomTo(Ci,null,!0),li.panTo(mi,!0)}else{var Ii=li.getBounds();li.resize(Ur,!0),li.fitBoundsWithConstraints(Ii,!0)}ee[ot.hash].prevContainerSize=Ur,ee[ot.hash].forceRedraw=!0}}var Ni=ot.viewport.update(),ki=ot.world.update()||Ni;Ni&&ot.raiseEvent("viewport-change"),ot.referenceStrip&&(ki=ot.referenceStrip.update(ot.viewport)||ki),!ee[ot.hash].animating&&ki&&(ot.raiseEvent("animation-start"),Ze(ot)),(ki||ee[ot.hash].forceRedraw||ot.world.needsDraw())&&(ii(ot),ot._drawOverlays(),ot.navigator&&ot.navigator.update(ot.viewport),ee[ot.hash].forceRedraw=!1,ki&&ot.raiseEvent("animation")),ee[ot.hash].animating&&!ki&&(ot.raiseEvent("animation-finish"),ee[ot.hash].mouseInside||Ke(ot)),ee[ot.hash].animating=ki}}function ii(ot){ot.imageLoader.clear(),ot.drawer.clear(),ot.world.draw(),ot.raiseEvent("update-viewport",{})}function ti(ot,Ur){return ot?ot+Ur:Ur}function ni(){ee[this.hash].lastZoomTime=fe.now(),ee[this.hash].zoomFactor=this.zoomPerSecond,ee[this.hash].zooming=!0,hi(this)}function ui(){ee[this.hash].lastZoomTime=fe.now(),ee[this.hash].zoomFactor=1/this.zoomPerSecond,ee[this.hash].zooming=!0,hi(this)}function yi(){ee[this.hash].zooming=!1}function hi(ot){fe.requestAnimationFrame(fe.delegate(ot,pi))}function pi(){var ot,Ur,ai;ee[this.hash].zooming&&this.viewport&&(ot=fe.now(),Ur=ot-ee[this.hash].lastZoomTime,ai=Math.pow(ee[this.hash].zoomFactor,Ur/1e3),this.viewport.zoomBy(ai),this.viewport.applyConstraints(),ee[this.hash].lastZoomTime=ot,hi(this))}function Ri(){this.viewport&&(ee[this.hash].zooming=!1,this.viewport.zoomBy(this.zoomPerClick/1),this.viewport.applyConstraints())}function Ei(){this.viewport&&(ee[this.hash].zooming=!1,this.viewport.zoomBy(1/this.zoomPerClick),this.viewport.applyConstraints())}function bi(){this.buttons.emulateEnter(),this.buttons.emulateExit()}function _i(){this.viewport&&this.viewport.goHome()}function vi(){this.isFullPage()&&!fe.isFullScreen()?this.setFullPage(!1):this.setFullScreen(!this.isFullPage()),this.buttons&&this.buttons.emulateExit(),this.fullPageButton.element.focus(),this.viewport&&this.viewport.applyConstraints()}function Ti(){if(this.viewport){var ot=this.viewport.getRotation();this.viewport.flipped?ot=fe.positiveModulo(ot+this.rotationIncrement,360):ot=fe.positiveModulo(ot-this.rotationIncrement,360),this.viewport.setRotation(ot)}}function Fi(){if(this.viewport){var ot=this.viewport.getRotation();this.viewport.flipped?ot=fe.positiveModulo(ot-this.rotationIncrement,360):ot=fe.positiveModulo(ot+this.rotationIncrement,360),this.viewport.setRotation(ot)}}function Li(){this.viewport.toggleFlip()}function Di(){var ot=this._sequenceIndex-1;this.navPrevNextWrap&&ot<0&&(ot+=this.tileSources.length),this.goToPage(ot)}function Oi(){var ot=this._sequenceIndex+1;this.navPrevNextWrap&&ot>=this.tileSources.length&&(ot=0),this.goToPage(ot)}}(OpenSeadragon),function(fe){fe.Navigator=function(Ge){var qe=Ge.viewer,Ke=this,Ye,Ze;Ge.id?(this.element=document.getElementById(Ge.id),Ge.controlOptions={anchor:fe.ControlAnchor.NONE,attachToViewer:!1,autoFade:!1}):(Ge.id="navigator-"+fe.now(),this.element=fe.makeNeutralElement("div"),Ge.controlOptions={anchor:fe.ControlAnchor.TOP_RIGHT,attachToViewer:!0,autoFade:Ge.autoFade},Ge.position&&(Ge.position=="BOTTOM_RIGHT"?Ge.controlOptions.anchor=fe.ControlAnchor.BOTTOM_RIGHT:Ge.position=="BOTTOM_LEFT"?Ge.controlOptions.anchor=fe.ControlAnchor.BOTTOM_LEFT:Ge.position=="TOP_RIGHT"?Ge.controlOptions.anchor=fe.ControlAnchor.TOP_RIGHT:Ge.position=="TOP_LEFT"?Ge.controlOptions.anchor=fe.ControlAnchor.TOP_LEFT:Ge.position=="ABSOLUTE"&&(Ge.controlOptions.anchor=fe.ControlAnchor.ABSOLUTE,Ge.controlOptions.top=Ge.top,Ge.controlOptions.left=Ge.left,Ge.controlOptions.height=Ge.height,Ge.controlOptions.width=Ge.width))),this.element.id=Ge.id,this.element.className+=" navigator",Ge=fe.extend(!0,{sizeRatio:fe.DEFAULT_SETTINGS.navigatorSizeRatio},Ge,{element:this.element,tabIndex:-1,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,autoResize:Ge.autoResize,minZoomImageRatio:1,background:Ge.background,opacity:Ge.opacity,borderColor:Ge.borderColor,displayRegionColor:Ge.displayRegionColor}),Ge.minPixelRatio=this.minPixelRatio=qe.minPixelRatio,fe.setElementTouchActionNone(this.element),this.borderWidth=2,this.fudge=new fe.Point(1,1),this.totalBorderWidths=new fe.Point(this.borderWidth*2,this.borderWidth*2).minus(this.fudge),Ge.controlOptions.anchor!=fe.ControlAnchor.NONE&&function(tt,rt){tt.margin="0px",tt.border=rt+"px solid "+Ge.borderColor,tt.padding="0px",tt.background=Ge.background,tt.opacity=Ge.opacity,tt.overflow="hidden"}(this.element.style,this.borderWidth),this.displayRegion=fe.makeNeutralElement("div"),this.displayRegion.id=this.element.id+"-displayregion",this.displayRegion.className="displayregion",function(tt,rt){tt.position="relative",tt.top="0px",tt.left="0px",tt.fontSize="0px",tt.overflow="hidden",tt.border=rt+"px solid "+Ge.displayRegionColor,tt.margin="0px",tt.padding="0px",tt.background="transparent",tt.float="left",tt.cssFloat="left",tt.styleFloat="left",tt.zIndex=999999999,tt.cursor="default"}(this.displayRegion.style,this.borderWidth),this.displayRegionContainer=fe.makeNeutralElement("div"),this.displayRegionContainer.id=this.element.id+"-displayregioncontainer",this.displayRegionContainer.className="displayregioncontainer",this.displayRegionContainer.style.width="100%",this.displayRegionContainer.style.height="100%",qe.addControl(this.element,Ge.controlOptions),this._resizeWithViewer=Ge.controlOptions.anchor!=fe.ControlAnchor.ABSOLUTE&&Ge.controlOptions.anchor!=fe.ControlAnchor.NONE,Ge.width&&Ge.height?(this.setWidth(Ge.width),this.setHeight(Ge.height)):this._resizeWithViewer&&(Ye=fe.getElementSize(qe.element),this.element.style.height=Math.round(Ye.y*Ge.sizeRatio)+"px",this.element.style.width=Math.round(Ye.x*Ge.sizeRatio)+"px",this.oldViewerSize=Ye,Ze=fe.getElementSize(this.element),this.elementArea=Ze.x*Ze.y),this.oldContainerSize=new fe.Point(0,0),fe.Viewer.apply(this,[Ge]),this.displayRegionContainer.appendChild(this.displayRegion),this.element.getElementsByTagName("div")[0].appendChild(this.displayRegionContainer);function Xe(tt){Ne(Ke.displayRegionContainer,tt),Ne(Ke.displayRegion,-tt),Ke.viewport.setRotation(tt)}if(Ge.navigatorRotate){var Je=Ge.viewer.viewport?Ge.viewer.viewport.getRotation():Ge.viewer.degrees||0;Xe(Je),Ge.viewer.addHandler("rotate",function(tt){Xe(tt.degrees)})}this.innerTracker.destroy(),this.innerTracker=new fe.MouseTracker({element:this.element,dragHandler:fe.delegate(this,ue),clickHandler:fe.delegate(this,ee),releaseHandler:fe.delegate(this,pe),scrollHandler:fe.delegate(this,_e)}),this.addHandler("reset-size",function(){Ke.viewport&&Ke.viewport.goHome(!0)}),qe.world.addHandler("item-index-change",function(tt){window.setTimeout(function(){var rt=Ke.world.getItemAt(tt.previousIndex);Ke.world.setItemIndex(rt,tt.newIndex)},1)}),qe.world.addHandler("remove-item",function(tt){var rt=tt.item,et=Ke._getMatchingItem(rt);et&&Ke.world.removeItem(et)}),this.update(qe.viewport)},fe.extend(fe.Navigator.prototype,fe.EventSource.prototype,fe.Viewer.prototype,{updateSize:function(){if(this.viewport){var Ge=new fe.Point(this.container.clientWidth===0?1:this.container.clientWidth,this.container.clientHeight===0?1:this.container.clientHeight);Ge.equals(this.oldContainerSize)||(this.viewport.resize(Ge,!0),this.viewport.goHome(!0),this.oldContainerSize=Ge,this.drawer.clear(),this.world.draw())}},setWidth:function(Ge){this.width=Ge,this.element.style.width=typeof Ge=="number"?Ge+"px":Ge,this._resizeWithViewer=!1},setHeight:function(Ge){this.height=Ge,this.element.style.height=typeof Ge=="number"?Ge+"px":Ge,this._resizeWithViewer=!1},setFlip:function(Ge){return this.viewport.setFlip(Ge),this.setDisplayTransform(this.viewer.viewport.getFlip()?"scale(-1,1)":"scale(1,1)"),this},setDisplayTransform:function(Ge){Ue(this.displayRegion,Ge),Ue(this.canvas,Ge),Ue(this.element,Ge)},update:function(Ge){var qe,Ke,Ye,Ze,Xe,Je;if(qe=fe.getElementSize(this.viewer.element),this._resizeWithViewer&&qe.x&&qe.y&&!qe.equals(this.oldViewerSize)&&(this.oldViewerSize=qe,this.maintainSizeRatio||!this.elementArea?(Ke=qe.x*this.sizeRatio,Ye=qe.y*this.sizeRatio):(Ke=Math.sqrt(this.elementArea*(qe.x/qe.y)),Ye=this.elementArea/Ke),this.element.style.width=Math.round(Ke)+"px",this.element.style.height=Math.round(Ye)+"px",this.elementArea||(this.elementArea=Ke*Ye),this.updateSize()),Ge&&this.viewport){Ze=Ge.getBoundsNoRotate(!0),Xe=this.viewport.pixelFromPointNoRotate(Ze.getTopLeft(),!1),Je=this.viewport.pixelFromPointNoRotate(Ze.getBottomRight(),!1).minus(this.totalBorderWidths);var tt=this.displayRegion.style;tt.display=this.world.getItemCount()?"block":"none",tt.top=Math.round(Xe.y)+"px",tt.left=Math.round(Xe.x)+"px";var rt=Math.abs(Xe.x-Je.x),et=Math.abs(Xe.y-Je.y);tt.width=Math.round(Math.max(rt,0))+"px",tt.height=Math.round(Math.max(et,0))+"px"}},addTiledImage:function(Ge){var qe=this,Ke=Ge.originalTiledImage;delete Ge.original;var Ye=fe.extend({},Ge,{success:function(Ze){var Xe=Ze.item;Xe._originalForNavigator=Ke,qe._matchBounds(Xe,Ke,!0);function Je(){qe._matchBounds(Xe,Ke)}function tt(){qe._matchOpacity(Xe,Ke)}function rt(){qe._matchCompositeOperation(Xe,Ke)}Ke.addHandler("bounds-change",Je),Ke.addHandler("clip-change",Je),Ke.addHandler("opacity-change",tt),Ke.addHandler("composite-operation-change",rt)}});return fe.Viewer.prototype.addTiledImage.apply(this,[Ye])},_getMatchingItem:function(Ge){for(var qe=this.world.getItemCount(),Ke,Ye=0;Ye<qe;Ye++)if(Ke=this.world.getItemAt(Ye),Ke._originalForNavigator===Ge)return Ke;return null},_matchBounds:function(Ge,qe,Ke){var Ye=qe.getBoundsNoRotate();Ge.setPosition(Ye.getTopLeft(),Ke),Ge.setWidth(Ye.width,Ke),Ge.setRotation(qe.getRotation(),Ke),Ge.setClip(qe.getClip())},_matchOpacity:function(Ge,qe){Ge.setOpacity(qe.opacity)},_matchCompositeOperation:function(Ge,qe){Ge.setCompositeOperation(qe.compositeOperation)}});function ee(Ge){var qe={tracker:Ge.eventSource,position:Ge.position,quick:Ge.quick,shift:Ge.shift,originalEvent:Ge.originalEvent,preventDefaultAction:Ge.preventDefaultAction};if(this.viewer.raiseEvent("navigator-click",qe),!qe.preventDefaultAction&&Ge.quick&&this.viewer.viewport&&(this.panVertical||this.panHorizontal)){this.viewer.viewport.flipped&&(Ge.position.x=this.viewport.getContainerSize().x-Ge.position.x);var Ke=this.viewport.pointFromPixel(Ge.position);this.panVertical?this.panHorizontal||(Ke.x=this.viewer.viewport.getCenter(!0).x):Ke.y=this.viewer.viewport.getCenter(!0).y,this.viewer.viewport.panTo(Ke),this.viewer.viewport.applyConstraints()}}function ue(Ge){var qe={tracker:Ge.eventSource,position:Ge.position,delta:Ge.delta,speed:Ge.speed,direction:Ge.direction,shift:Ge.shift,originalEvent:Ge.originalEvent,preventDefaultAction:Ge.preventDefaultAction};this.viewer.raiseEvent("navigator-drag",qe),!qe.preventDefaultAction&&this.viewer.viewport&&(this.panHorizontal||(Ge.delta.x=0),this.panVertical||(Ge.delta.y=0),this.viewer.viewport.flipped&&(Ge.delta.x=-Ge.delta.x),this.viewer.viewport.panBy(this.viewport.deltaPointsFromPixels(Ge.delta)),this.viewer.constrainDuringPan&&this.viewer.viewport.applyConstraints())}function pe(Ge){Ge.insideElementPressed&&this.viewer.viewport&&this.viewer.viewport.applyConstraints()}function _e(Ge){return this.viewer.raiseEvent("navigator-scroll",{tracker:Ge.eventSource,position:Ge.position,scroll:Ge.scroll,shift:Ge.shift,originalEvent:Ge.originalEvent}),!1}function Ne(Ge,qe){Ue(Ge,"rotate("+qe+"deg)")}function Ue(Ge,qe){Ge.style.webkitTransform=qe,Ge.style.mozTransform=qe,Ge.style.msTransform=qe,Ge.style.oTransform=qe,Ge.style.transform=qe}}(OpenSeadragon),function(fe){var ee={Errors:{Dzc:"Sorry, we don't support Deep Zoom Collections!",Dzi:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Xml:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",ImageFormat:"Sorry, we don't support {0}-based Deep Zoom Images.",Security:"It looks like a security restriction stopped us from loading this Deep Zoom Image.",Status:"This space unintentionally left blank ({0} {1}).",OpenFailed:"Unable to open {0}: {1}"},Tooltips:{FullPage:"Toggle full page",Home:"Go home",ZoomIn:"Zoom in",ZoomOut:"Zoom out",NextPage:"Next page",PreviousPage:"Previous page",RotateLeft:"Rotate left",RotateRight:"Rotate right",Flip:"Flip Horizontally"}};fe.extend(fe,{getString:function(ue){var pe=ue.split("."),_e=null,Ne=arguments,Ue=ee,Ge;for(Ge=0;Ge<pe.length-1;Ge++)Ue=Ue[pe[Ge]]||{};return _e=Ue[pe[Ge]],typeof _e!="string"&&(fe.console.log("Untranslated source string:",ue),_e=""),_e.replace(/\{\d+\}/g,function(qe){var Ke=parseInt(qe.match(/\d+/),10)+1;return Ke<Ne.length?Ne[Ke]:""})},setString:function(ue,pe){var _e=ue.split("."),Ne=ee,Ue;for(Ue=0;Ue<_e.length-1;Ue++)Ne[_e[Ue]]||(Ne[_e[Ue]]={}),Ne=Ne[_e[Ue]];Ne[_e[Ue]]=pe}})}(OpenSeadragon),function(fe){fe.Point=function(ee,ue){this.x=typeof ee=="number"?ee:0,this.y=typeof ue=="number"?ue:0},fe.Point.prototype={clone:function(){return new fe.Point(this.x,this.y)},plus:function(ee){return new fe.Point(this.x+ee.x,this.y+ee.y)},minus:function(ee){return new fe.Point(this.x-ee.x,this.y-ee.y)},times:function(ee){return new fe.Point(this.x*ee,this.y*ee)},divide:function(ee){return new fe.Point(this.x/ee,this.y/ee)},negate:function(){return new fe.Point(-this.x,-this.y)},distanceTo:function(ee){return Math.sqrt(Math.pow(this.x-ee.x,2)+Math.pow(this.y-ee.y,2))},squaredDistanceTo:function(ee){return Math.pow(this.x-ee.x,2)+Math.pow(this.y-ee.y,2)},apply:function(ee){return new fe.Point(ee(this.x),ee(this.y))},equals:function(ee){return ee instanceof fe.Point&&this.x===ee.x&&this.y===ee.y},rotate:function(ee,ue){ue=ue||new fe.Point(0,0);var pe,_e;if(ee%90===0){var Ne=fe.positiveModulo(ee,360);switch(Ne){case 0:pe=1,_e=0;break;case 90:pe=0,_e=1;break;case 180:pe=-1,_e=0;break;case 270:pe=0,_e=-1;break}}else{var Ue=ee*Math.PI/180;pe=Math.cos(Ue),_e=Math.sin(Ue)}var Ge=pe*(this.x-ue.x)-_e*(this.y-ue.y)+ue.x,qe=_e*(this.x-ue.x)+pe*(this.y-ue.y)+ue.y;return new fe.Point(Ge,qe)},toString:function(){return"("+Math.round(this.x*100)/100+","+Math.round(this.y*100)/100+")"}}}(OpenSeadragon),function(fe){fe.TileSource=function(ue,pe,_e,Ne,Ue,Ge){var qe=this,Ke=arguments,Ye,Ze;if(fe.isPlainObject(ue)?Ye=ue:Ye={width:Ke[0],height:Ke[1],tileSize:Ke[2],tileOverlap:Ke[3],minLevel:Ke[4],maxLevel:Ke[5]},fe.EventSource.call(this),fe.extend(!0,this,Ye),!this.success){for(Ze=0;Ze<arguments.length;Ze++)if(fe.isFunction(arguments[Ze])){this.success=arguments[Ze];break}}this.success&&this.addHandler("ready",function(Xe){qe.success(Xe)}),fe.type(arguments[0])=="string"&&(this.url=arguments[0]),this.url?(this.aspectRatio=1,this.dimensions=new fe.Point(10,10),this._tileWidth=0,this._tileHeight=0,this.tileOverlap=0,this.minLevel=0,this.maxLevel=0,this.ready=!1,this.getImageInfo(this.url)):(this.ready=!0,this.aspectRatio=Ye.width&&Ye.height?Ye.width/Ye.height:1,this.dimensions=new fe.Point(Ye.width,Ye.height),this.tileSize?(this._tileWidth=this._tileHeight=this.tileSize,delete this.tileSize):(this.tileWidth?(this._tileWidth=this.tileWidth,delete this.tileWidth):this._tileWidth=0,this.tileHeight?(this._tileHeight=this.tileHeight,delete this.tileHeight):this._tileHeight=0),this.tileOverlap=Ye.tileOverlap?Ye.tileOverlap:0,this.minLevel=Ye.minLevel?Ye.minLevel:0,this.maxLevel=Ye.maxLevel!==void 0&&Ye.maxLevel!==null?Ye.maxLevel:Ye.width&&Ye.height?Math.ceil(Math.log(Math.max(Ye.width,Ye.height))/Math.log(2)):0,this.success&&fe.isFunction(this.success)&&this.success(this))},fe.TileSource.prototype={getTileSize:function(ue){return fe.console.error("[TileSource.getTileSize] is deprecated. Use TileSource.getTileWidth() and TileSource.getTileHeight() instead"),this._tileWidth},getTileWidth:function(ue){return this._tileWidth?this._tileWidth:this.getTileSize(ue)},getTileHeight:function(ue){return this._tileHeight?this._tileHeight:this.getTileSize(ue)},getLevelScale:function(ue){var pe={},_e;for(_e=0;_e<=this.maxLevel;_e++)pe[_e]=1/Math.pow(2,this.maxLevel-_e);return this.getLevelScale=function(Ne){return pe[Ne]},this.getLevelScale(ue)},getNumTiles:function(ue){var pe=this.getLevelScale(ue),_e=Math.ceil(pe*this.dimensions.x/this.getTileWidth(ue)),Ne=Math.ceil(pe*this.dimensions.y/this.getTileHeight(ue));return new fe.Point(_e,Ne)},getPixelRatio:function(ue){var pe=this.dimensions.times(this.getLevelScale(ue)),_e=1/pe.x,Ne=1/pe.y;return new fe.Point(_e,Ne)},getClosestLevel:function(){var ue,pe;for(ue=this.minLevel+1;ue<=this.maxLevel&&(pe=this.getNumTiles(ue),!(pe.x>1||pe.y>1));ue++);return ue-1},getTileAtPoint:function(ue,pe){var _e=pe.x>=0&&pe.x<=1&&pe.y>=0&&pe.y<=1/this.aspectRatio;fe.console.assert(_e,"[TileSource.getTileAtPoint] must be called with a valid point.");var Ne=this.dimensions.x*this.getLevelScale(ue),Ue=pe.x*Ne,Ge=pe.y*Ne,qe=Math.floor(Ue/this.getTileWidth(ue)),Ke=Math.floor(Ge/this.getTileHeight(ue));pe.x>=1&&(qe=this.getNumTiles(ue).x-1);var Ye=1e-15;return pe.y>=1/this.aspectRatio-Ye&&(Ke=this.getNumTiles(ue).y-1),new fe.Point(qe,Ke)},getTileBounds:function(ue,pe,_e,Ne){var Ue=this.dimensions.times(this.getLevelScale(ue)),Ge=this.getTileWidth(ue),qe=this.getTileHeight(ue),Ke=pe===0?0:Ge*pe-this.tileOverlap,Ye=_e===0?0:qe*_e-this.tileOverlap,Ze=Ge+(pe===0?1:2)*this.tileOverlap,Xe=qe+(_e===0?1:2)*this.tileOverlap,Je=1/Ue.x;return Ze=Math.min(Ze,Ue.x-Ke),Xe=Math.min(Xe,Ue.y-Ye),Ne?new fe.Rect(0,0,Ze,Xe):new fe.Rect(Ke*Je,Ye*Je,Ze*Je,Xe*Je)},getImageInfo:function(ue){var pe=this,_e,Ne,Ue,Ge,qe,Ke,Ye;ue&&(qe=ue.split("/"),Ke=qe[qe.length-1],Ye=Ke.lastIndexOf("."),Ye>-1&&(qe[qe.length-1]=Ke.slice(0,Ye))),Ne=function(Ze){typeof Ze=="string"&&(Ze=fe.parseXml(Ze));var Xe=fe.TileSource.determineType(pe,Ze,ue);if(!Xe){pe.raiseEvent("open-failed",{message:"Unable to load TileSource",source:ue});return}Ge=Xe.prototype.configure.apply(pe,[Ze,ue]),Ge.ajaxWithCredentials===void 0&&(Ge.ajaxWithCredentials=pe.ajaxWithCredentials),Ue=new Xe(Ge),pe.ready=!0,pe.raiseEvent("ready",{tileSource:Ue})},ue.match(/\.js$/)?(_e=ue.split("/").pop().replace(".js",""),fe.jsonp({url:ue,async:!1,callbackName:_e,callback:Ne})):fe.makeAjaxRequest({url:ue,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,success:function(Ze){var Xe=ee(Ze);Ne(Xe)},error:function(Ze,Xe){var Je;try{Je="HTTP "+Ze.status+" attempting to load TileSource"}catch{var tt;typeof Xe>"u"||!Xe.toString?tt="Unknown error":tt=Xe.toString(),Je=tt+" attempting to load TileSource"}pe.raiseEvent("open-failed",{message:Je,source:ue})}})},supports:function(ue,pe){return!1},configure:function(ue,pe){throw new Error("Method not implemented.")},getTileUrl:function(ue,pe,_e){throw new Error("Method not implemented.")},getTileAjaxHeaders:function(ue,pe,_e){return{}},tileExists:function(ue,pe,_e){var Ne=this.getNumTiles(ue);return ue>=this.minLevel&&ue<=this.maxLevel&&pe>=0&&_e>=0&&pe<Ne.x&&_e<Ne.y}},fe.extend(!0,fe.TileSource.prototype,fe.EventSource.prototype);function ee(ue){var pe=ue.responseText,_e=ue.status,Ne,Ue;if(ue){if(ue.status!==200&&ue.status!==0)throw _e=ue.status,Ne=_e==404?"Not Found":ue.statusText,new Error(fe.getString("Errors.Status",_e,Ne))}else throw new Error(fe.getString("Errors.Security"));if(pe.match(/\s*<.*/))try{Ue=ue.responseXML&&ue.responseXML.documentElement?ue.responseXML:fe.parseXml(pe)}catch{Ue=ue.responseText}else if(pe.match(/\s*[\{\[].*/))try{Ue=fe.parseJSON(pe)}catch{Ue=pe}else Ue=pe;return Ue}fe.TileSource.determineType=function(ue,pe,_e){var Ne;for(Ne in OpenSeadragon)if(Ne.match(/.+TileSource$/)&&fe.isFunction(OpenSeadragon[Ne])&&fe.isFunction(OpenSeadragon[Ne].prototype.supports)&&OpenSeadragon[Ne].prototype.supports.call(ue,pe,_e))return OpenSeadragon[Ne];fe.console.error("No TileSource was able to open %s %s",_e,pe)}}(OpenSeadragon),function(fe){fe.DziTileSource=function(pe,_e,Ne,Ue,Ge,qe,Ke,Ye,Ze){var Xe,Je,tt,rt;if(fe.isPlainObject(pe)?rt=pe:rt={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4],fileFormat:arguments[5],displayRects:arguments[6],minLevel:arguments[7],maxLevel:arguments[8]},this._levelRects={},this.tilesUrl=rt.tilesUrl,this.fileFormat=rt.fileFormat,this.displayRects=rt.displayRects,this.displayRects)for(Xe=this.displayRects.length-1;Xe>=0;Xe--)for(Je=this.displayRects[Xe],tt=Je.minLevel;tt<=Je.maxLevel;tt++)this._levelRects[tt]||(this._levelRects[tt]=[]),this._levelRects[tt].push(Je);fe.TileSource.apply(this,[rt])},fe.extend(fe.DziTileSource.prototype,fe.TileSource.prototype,{supports:function(pe,_e){var Ne;return pe.Image?Ne=pe.Image.xmlns:pe.documentElement&&(pe.documentElement.localName=="Image"||pe.documentElement.tagName=="Image")&&(Ne=pe.documentElement.namespaceURI),Ne=(Ne||"").toLowerCase(),Ne.indexOf("schemas.microsoft.com/deepzoom/2008")!==-1||Ne.indexOf("schemas.microsoft.com/deepzoom/2009")!==-1},configure:function(pe,_e){var Ne;return fe.isPlainObject(pe)?Ne=ue(this,pe):Ne=ee(this,pe),_e&&!Ne.tilesUrl&&(Ne.tilesUrl=_e.replace(/([^\/]+?)(\.(dzi|xml|js)?(\?[^\/]*)?)?\/?$/,"$1_files/"),_e.search(/\.(dzi|xml|js)\?/)!=-1?Ne.queryParams=_e.match(/\?.*/):Ne.queryParams=""),Ne},getTileUrl:function(pe,_e,Ne){return[this.tilesUrl,pe,"/",_e,"_",Ne,".",this.fileFormat,this.queryParams].join("")},tileExists:function(pe,_e,Ne){var Ue=this._levelRects[pe],Ge,qe,Ke,Ye,Ze,Xe,Je;if(this.minLevel&&pe<this.minLevel||this.maxLevel&&pe>this.maxLevel)return!1;if(!Ue||!Ue.length)return!0;for(Je=Ue.length-1;Je>=0;Je--)if(Ge=Ue[Je],!(pe<Ge.minLevel||pe>Ge.maxLevel)&&(qe=this.getLevelScale(pe),Ke=Ge.x*qe,Ye=Ge.y*qe,Ze=Ke+Ge.width*qe,Xe=Ye+Ge.height*qe,Ke=Math.floor(Ke/this._tileWidth),Ye=Math.floor(Ye/this._tileWidth),Ze=Math.ceil(Ze/this._tileWidth),Xe=Math.ceil(Xe/this._tileWidth),Ke<=_e&&_e<Ze&&Ye<=Ne&&Ne<Xe))return!0;return!1}});function ee(pe,_e){if(!_e||!_e.documentElement)throw new Error(fe.getString("Errors.Xml"));var Ne=_e.documentElement,Ue=Ne.localName||Ne.tagName,Ge=_e.documentElement.namespaceURI,qe=null,Ke=[],Ye,Ze,Xe,Je,tt;if(Ue=="Image")try{if(Je=Ne.getElementsByTagName("Size")[0],Je===void 0&&(Je=Ne.getElementsByTagNameNS(Ge,"Size")[0]),qe={Image:{xmlns:"http://schemas.microsoft.com/deepzoom/2008",Url:Ne.getAttribute("Url"),Format:Ne.getAttribute("Format"),DisplayRect:null,Overlap:parseInt(Ne.getAttribute("Overlap"),10),TileSize:parseInt(Ne.getAttribute("TileSize"),10),Size:{Height:parseInt(Je.getAttribute("Height"),10),Width:parseInt(Je.getAttribute("Width"),10)}}},!fe.imageFormatSupported(qe.Image.Format))throw new Error(fe.getString("Errors.ImageFormat",qe.Image.Format.toUpperCase()));for(Ye=Ne.getElementsByTagName("DisplayRect"),Ye===void 0&&(Ye=Ne.getElementsByTagNameNS(Ge,"DisplayRect")[0]),tt=0;tt<Ye.length;tt++)Ze=Ye[tt],Xe=Ze.getElementsByTagName("Rect")[0],Xe===void 0&&(Xe=Ze.getElementsByTagNameNS(Ge,"Rect")[0]),Ke.push({Rect:{X:parseInt(Xe.getAttribute("X"),10),Y:parseInt(Xe.getAttribute("Y"),10),Width:parseInt(Xe.getAttribute("Width"),10),Height:parseInt(Xe.getAttribute("Height"),10),MinLevel:parseInt(Ze.getAttribute("MinLevel"),10),MaxLevel:parseInt(Ze.getAttribute("MaxLevel"),10)}});return Ke.length&&(qe.Image.DisplayRect=Ke),ue(pe,qe)}catch(it){throw it instanceof Error?it:new Error(fe.getString("Errors.Dzi"))}else{if(Ue=="Collection")throw new Error(fe.getString("Errors.Dzc"));if(Ue=="Error"){var rt=Ne.getElementsByTagName("Message")[0],et=rt.firstChild.nodeValue;throw new Error(et)}}throw new Error(fe.getString("Errors.Dzi"))}function ue(pe,_e){var Ne=_e.Image,Ue=Ne.Url,Ge=Ne.Format,qe=Ne.Size,Ke=Ne.DisplayRect||[],Ye=parseInt(qe.Width,10),Ze=parseInt(qe.Height,10),Xe=parseInt(Ne.TileSize,10),Je=parseInt(Ne.Overlap,10),tt=[],rt,et;for(et=0;et<Ke.length;et++)rt=Ke[et].Rect,tt.push(new fe.DisplayRect(parseInt(rt.X,10),parseInt(rt.Y,10),parseInt(rt.Width,10),parseInt(rt.Height,10),parseInt(rt.MinLevel,10),parseInt(rt.MaxLevel,10)));return fe.extend(!0,{width:Ye,height:Ze,tileSize:Xe,tileOverlap:Je,minLevel:null,maxLevel:null,tilesUrl:Ue,fileFormat:Ge,displayRects:tt},_e)}}(OpenSeadragon),function(fe){fe.IIIFTileSource=function(Ne){if(fe.extend(!0,this,Ne),!(this.height&&this.width&&this["@id"]))throw new Error("IIIF required parameters not provided.");if(Ne.tileSizePerScaleFactor={},this.tileFormat=this.tileFormat||"jpg",this.version=Ne.version,this.tile_width&&this.tile_height)Ne.tileWidth=this.tile_width,Ne.tileHeight=this.tile_height;else if(this.tile_width)Ne.tileSize=this.tile_width;else if(this.tile_height)Ne.tileSize=this.tile_height;else if(this.tiles)if(this.tiles.length==1)Ne.tileWidth=this.tiles[0].width,Ne.tileHeight=this.tiles[0].height||this.tiles[0].width,this.scale_factors=this.tiles[0].scaleFactors;else{this.scale_factors=[];for(var Ue=0;Ue<this.tiles.length;Ue++)for(var Ge=0;Ge<this.tiles[Ue].scaleFactors.length;Ge++){var qe=this.tiles[Ue].scaleFactors[Ge];this.scale_factors.push(qe),Ne.tileSizePerScaleFactor[qe]={width:this.tiles[Ue].width,height:this.tiles[Ue].height||this.tiles[Ue].width}}}else if(ee(Ne)){for(var Ke=Math.min(this.height,this.width),Ye=[256,512,1024],Ze=[],Xe=0;Xe<Ye.length;Xe++)Ye[Xe]<=Ke&&Ze.push(Ye[Xe]);Ze.length>0?Ne.tileSize=Math.max.apply(null,Ze):Ne.tileSize=Ke}else this.sizes&&this.sizes.length>0?(this.emulateLegacyImagePyramid=!0,Ne.levels=ue(this),fe.extend(!0,Ne,{width:Ne.levels[Ne.levels.length-1].width,height:Ne.levels[Ne.levels.length-1].height,tileSize:Math.max(Ne.height,Ne.width),tileOverlap:0,minLevel:0,maxLevel:Ne.levels.length-1}),this.levels=Ne.levels):fe.console.error("Nothing in the info.json to construct image pyramids from");if(!Ne.maxLevel&&!this.emulateLegacyImagePyramid)if(!this.scale_factors)Ne.maxLevel=Number(Math.ceil(Math.log(Math.max(this.width,this.height),2)));else{var Je=Math.max.apply(null,this.scale_factors);Ne.maxLevel=Math.round(Math.log(Je)*Math.LOG2E)}fe.TileSource.apply(this,[Ne])},fe.extend(fe.IIIFTileSource.prototype,fe.TileSource.prototype,{supports:function(Ne,Ue){return Ne.protocol&&Ne.protocol=="http://iiif.io/api/image"||Ne["@context"]&&(Ne["@context"]=="http://library.stanford.edu/iiif/image-api/1.1/context.json"||Ne["@context"]=="http://iiif.io/api/image/1/context.json")||Ne.profile&&Ne.profile.indexOf("http://library.stanford.edu/iiif/image-api/compliance.html")===0||Ne.identifier&&Ne.width&&Ne.height?!0:!!(Ne.documentElement&&Ne.documentElement.tagName=="info"&&Ne.documentElement.namespaceURI=="http://library.stanford.edu/iiif/image-api/ns/")},configure:function(Ne,Ue){if(fe.isPlainObject(Ne)){if(!Ne["@context"])Ne["@context"]="http://iiif.io/api/image/1.0/context.json",Ne["@id"]=Ue.replace("/info.json",""),Ne.version=1;else{var qe=Ne["@context"];if(Array.isArray(qe)){for(var Ke=0;Ke<qe.length;Ke++)if(typeof qe[Ke]=="string"&&(/^http:\/\/iiif\.io\/api\/image\/[1-3]\/context\.json$/.test(qe[Ke])||qe[Ke]==="http://library.stanford.edu/iiif/image-api/1.1/context.json")){qe=qe[Ke];break}}switch(qe){case"http://iiif.io/api/image/1/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/context.json":Ne.version=1;break;case"http://iiif.io/api/image/2/context.json":Ne.version=2;break;case"http://iiif.io/api/image/3/context.json":Ne.version=3;break;default:fe.console.error("Data has a @context property which contains no known IIIF context URI.")}}if(!Ne["@id"]&&Ne.id&&(Ne["@id"]=Ne.id),Ne.preferredFormats){for(var Ye=0;Ye<Ne.preferredFormats.length;Ye++)if(OpenSeadragon.imageFormatSupported(Ne.preferredFormats[Ye])){Ne.tileFormat=Ne.preferredFormats[Ye];break}}return Ne}else{var Ge=pe(Ne);return Ge["@context"]="http://iiif.io/api/image/1.0/context.json",Ge["@id"]=Ue.replace("/info.xml",""),Ge.version=1,Ge}},getTileWidth:function(Ne){if(this.emulateLegacyImagePyramid)return fe.TileSource.prototype.getTileWidth.call(this,Ne);var Ue=Math.pow(2,this.maxLevel-Ne);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[Ue]?this.tileSizePerScaleFactor[Ue].width:this._tileWidth},getTileHeight:function(Ne){if(this.emulateLegacyImagePyramid)return fe.TileSource.prototype.getTileHeight.call(this,Ne);var Ue=Math.pow(2,this.maxLevel-Ne);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[Ue]?this.tileSizePerScaleFactor[Ue].height:this._tileHeight},getLevelScale:function(Ne){if(this.emulateLegacyImagePyramid){var Ue=NaN;return this.levels.length>0&&Ne>=this.minLevel&&Ne<=this.maxLevel&&(Ue=this.levels[Ne].width/this.levels[this.maxLevel].width),Ue}return fe.TileSource.prototype.getLevelScale.call(this,Ne)},getNumTiles:function(Ne){if(this.emulateLegacyImagePyramid){var Ue=this.getLevelScale(Ne);return Ue?new fe.Point(1,1):new fe.Point(0,0)}return fe.TileSource.prototype.getNumTiles.call(this,Ne)},getTileAtPoint:function(Ne,Ue){return this.emulateLegacyImagePyramid?new fe.Point(0,0):fe.TileSource.prototype.getTileAtPoint.call(this,Ne,Ue)},getTileUrl:function(Ne,Ue,Ge){if(this.emulateLegacyImagePyramid){var qe=null;return this.levels.length>0&&Ne>=this.minLevel&&Ne<=this.maxLevel&&(qe=this.levels[Ne].url),qe}var Ke="0",Ye=Math.pow(.5,this.maxLevel-Ne),Ze=Math.ceil(this.width*Ye),Xe=Math.ceil(this.height*Ye),Je,tt,rt,et,it,nt,st,lt,_r,jr,Nr,Wr,ri,Xr;return Je=this.getTileWidth(Ne),tt=this.getTileHeight(Ne),rt=Math.ceil(Je/Ye),et=Math.ceil(tt/Ye),this.version===1?ri="native."+this.tileFormat:ri="default."+this.tileFormat,Ze<Je&&Xe<tt?(this.version===2&&Ze===this.width||this.version===3&&Ze===this.width&&Xe===this.height?jr="max":this.version===3?jr=Ze+","+Xe:jr=Ze+",",it="full"):(nt=Ue*rt,st=Ge*et,lt=Math.min(rt,this.width-nt),_r=Math.min(et,this.height-st),Ue===0&&Ge===0&&lt===this.width&&_r===this.height?it="full":it=[nt,st,lt,_r].join(","),Nr=Math.ceil(lt*Ye),Wr=Math.ceil(_r*Ye),this.version===2&&Nr===this.width||this.version===3&&Nr===this.width&&Wr===this.height?jr="max":this.version===3?jr=Nr+","+Wr:jr=Nr+","),Xr=[this["@id"],it,jr,Ke,ri].join("/"),Xr},__testonly__:{canBeTiled:ee,constructLevels:ue}});function ee(Ne){var Ue=["http://library.stanford.edu/iiif/image-api/compliance.html#level0","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0","http://iiif.io/api/image/2/level0.json","level0","https://iiif.io/api/image/3/level0.json"],Ge=Array.isArray(Ne.profile)?Ne.profile[0]:Ne.profile,qe=Ue.indexOf(Ge)!==-1,Ke=!1;return Ne.version===2&&Ne.profile.length>1&&Ne.profile[1].supports&&(Ke=Ne.profile[1].supports.indexOf("sizeByW")!==-1),Ne.version===3&&Ne.extraFeatures&&(Ke=Ne.extraFeatures.indexOf("sizeByWh")!==-1),!qe||Ke}function ue(Ne){for(var Ue=[],Ge=0;Ge<Ne.sizes.length;Ge++)Ue.push({url:Ne["@id"]+"/full/"+Ne.sizes[Ge].width+","+(Ne.version===3?Ne.sizes[Ge].height:"")+"/0/default."+Ne.tileFormat,width:Ne.sizes[Ge].width,height:Ne.sizes[Ge].height});return Ue.sort(function(qe,Ke){return qe.width-Ke.width})}function pe(Ne){if(!Ne||!Ne.documentElement)throw new Error(fe.getString("Errors.Xml"));var Ue=Ne.documentElement,Ge=Ue.tagName,qe=null;if(Ge=="info")try{return qe={},_e(Ue,qe),qe}catch(Ke){throw Ke instanceof Error?Ke:new Error(fe.getString("Errors.IIIF"))}throw new Error(fe.getString("Errors.IIIF"))}function _e(Ne,Ue,Ge){var qe,Ke;if(Ne.nodeType==3&&Ge)Ke=Ne.nodeValue.trim(),Ke.match(/^\d*$/)&&(Ke=Number(Ke)),Ue[Ge]?(fe.isArray(Ue[Ge])||(Ue[Ge]=[Ue[Ge]]),Ue[Ge].push(Ke)):Ue[Ge]=Ke;else if(Ne.nodeType==1)for(qe=0;qe<Ne.childNodes.length;qe++)_e(Ne.childNodes[qe],Ue,Ne.nodeName)}}(OpenSeadragon),function(fe){fe.OsmTileSource=function(ee,ue,pe,_e,Ne){var Ue;fe.isPlainObject(ee)?Ue=ee:Ue={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]},(!Ue.width||!Ue.height)&&(Ue.width=65572864,Ue.height=65572864),Ue.tileSize||(Ue.tileSize=256,Ue.tileOverlap=0),Ue.tilesUrl||(Ue.tilesUrl="http://tile.openstreetmap.org/"),Ue.minLevel=8,fe.TileSource.apply(this,[Ue])},fe.extend(fe.OsmTileSource.prototype,fe.TileSource.prototype,{supports:function(ee,ue){return ee.type&&ee.type=="openstreetmaps"},configure:function(ee,ue){return ee},getTileUrl:function(ee,ue,pe){return this.tilesUrl+(ee-8)+"/"+ue+"/"+pe+".png"}})}(OpenSeadragon),function(fe){fe.TmsTileSource=function(ee,ue,pe,_e,Ne){var Ue;fe.isPlainObject(ee)?Ue=ee:Ue={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]};var Ge=Math.ceil(Ue.width/256)*256,qe=Math.ceil(Ue.height/256)*256,Ke;Ge>qe?Ke=Ge/256:Ke=qe/256,Ue.maxLevel=Math.ceil(Math.log(Ke)/Math.log(2))-1,Ue.tileSize=256,Ue.width=Ge,Ue.height=qe,fe.TileSource.apply(this,[Ue])},fe.extend(fe.TmsTileSource.prototype,fe.TileSource.prototype,{supports:function(ee,ue){return ee.type&&ee.type=="tiledmapservice"},configure:function(ee,ue){return ee},getTileUrl:function(ee,ue,pe){var _e=this.getNumTiles(ee).y-1;return this.tilesUrl+ee+"/"+ue+"/"+(_e-pe)+".png"}})}(OpenSeadragon),function(fe){fe.ZoomifyTileSource=function(ee){ee.tileSize=256;var ue={x:ee.width,y:ee.height};for(ee.imageSizes=[{x:ee.width,y:ee.height}],ee.gridSize=[this._getGridSize(ee.width,ee.height,ee.tileSize)];parseInt(ue.x,10)>ee.tileSize||parseInt(ue.y,10)>ee.tileSize;)ue.x=Math.floor(ue.x/2),ue.y=Math.floor(ue.y/2),ee.imageSizes.push({x:ue.x,y:ue.y}),ee.gridSize.push(this._getGridSize(ue.x,ue.y,ee.tileSize));ee.imageSizes.reverse(),ee.gridSize.reverse(),ee.minLevel=0,ee.maxLevel=ee.gridSize.length-1,OpenSeadragon.TileSource.apply(this,[ee])},fe.extend(fe.ZoomifyTileSource.prototype,fe.TileSource.prototype,{_getGridSize:function(ee,ue,pe){return{x:Math.ceil(ee/pe),y:Math.ceil(ue/pe)}},_calculateAbsoluteTileNumber:function(ee,ue,pe){for(var _e=0,Ne={},Ue=0;Ue<ee;Ue++)Ne=this.gridSize[Ue],_e+=Ne.x*Ne.y;return Ne=this.gridSize[ee],_e+=Ne.x*pe+ue,_e},supports:function(ee,ue){return ee.type&&ee.type=="zoomifytileservice"},configure:function(ee,ue){return ee},getTileUrl:function(ee,ue,pe){var _e=0,Ne=this._calculateAbsoluteTileNumber(ee,ue,pe);return _e=Math.floor(Ne/256),this.tilesUrl+"TileGroup"+_e+"/"+ee+"-"+ue+"-"+pe+".jpg"}})}(OpenSeadragon),function(fe){fe.LegacyTileSource=function(_e){var Ne,Ue,Ge;fe.isArray(_e)&&(Ne={type:"legacy-image-pyramid",levels:_e}),Ne.levels=ee(Ne.levels),Ne.levels.length>0?(Ue=Ne.levels[Ne.levels.length-1].width,Ge=Ne.levels[Ne.levels.length-1].height):(Ue=0,Ge=0,fe.console.error("No supported image formats found")),fe.extend(!0,Ne,{width:Ue,height:Ge,tileSize:Math.max(Ge,Ue),tileOverlap:0,minLevel:0,maxLevel:Ne.levels.length>0?Ne.levels.length-1:0}),fe.TileSource.apply(this,[Ne]),this.levels=Ne.levels},fe.extend(fe.LegacyTileSource.prototype,fe.TileSource.prototype,{supports:function(_e,Ne){return _e.type&&_e.type=="legacy-image-pyramid"||_e.documentElement&&_e.documentElement.getAttribute("type")=="legacy-image-pyramid"},configure:function(_e,Ne){var Ue;return fe.isPlainObject(_e)?Ue=pe(this,_e):Ue=ue(this,_e),Ue},getLevelScale:function(_e){var Ne=NaN;return this.levels.length>0&&_e>=this.minLevel&&_e<=this.maxLevel&&(Ne=this.levels[_e].width/this.levels[this.maxLevel].width),Ne},getNumTiles:function(_e){var Ne=this.getLevelScale(_e);return Ne?new fe.Point(1,1):new fe.Point(0,0)},getTileUrl:function(_e,Ne,Ue){var Ge=null;return this.levels.length>0&&_e>=this.minLevel&&_e<=this.maxLevel&&(Ge=this.levels[_e].url),Ge}});function ee(_e){var Ne=[],Ue,Ge;for(Ge=0;Ge<_e.length;Ge++)Ue=_e[Ge],Ue.height&&Ue.width&&Ue.url?Ne.push({url:Ue.url,width:Number(Ue.width),height:Number(Ue.height)}):fe.console.error("Unsupported image format: %s",Ue.url?Ue.url:"<no URL>");return Ne.sort(function(qe,Ke){return qe.height-Ke.height})}function ue(_e,Ne){if(!Ne||!Ne.documentElement)throw new Error(fe.getString("Errors.Xml"));var Ue=Ne.documentElement,Ge=Ue.tagName,qe=null,Ke=[],Ye,Ze;if(Ge=="image")try{for(qe={type:Ue.getAttribute("type"),levels:[]},Ke=Ue.getElementsByTagName("level"),Ze=0;Ze<Ke.length;Ze++)Ye=Ke[Ze],qe.levels.push({url:Ye.getAttribute("url"),width:parseInt(Ye.getAttribute("width"),10),height:parseInt(Ye.getAttribute("height"),10)});return pe(_e,qe)}catch(Xe){throw Xe instanceof Error?Xe:new Error("Unknown error parsing Legacy Image Pyramid XML.")}else{if(Ge=="collection")throw new Error("Legacy Image Pyramid Collections not yet supported.");if(Ge=="error")throw new Error("Error: "+Ne)}throw new Error("Unknown element "+Ge)}function pe(_e,Ne){return Ne.levels}}(OpenSeadragon),function(fe){fe.ImageTileSource=function(ee){ee=fe.extend({buildPyramid:!0,crossOriginPolicy:!1,ajaxWithCredentials:!1,useCanvas:!0},ee),fe.TileSource.apply(this,[ee])},fe.extend(fe.ImageTileSource.prototype,fe.TileSource.prototype,{supports:function(ee,ue){return ee.type&&ee.type==="image"},configure:function(ee,ue){return ee},getImageInfo:function(ee){var ue=this._image=new Image,pe=this;this.crossOriginPolicy&&(ue.crossOrigin=this.crossOriginPolicy),this.ajaxWithCredentials&&(ue.useCredentials=this.ajaxWithCredentials),fe.addEvent(ue,"load",function(){pe.width=Object.prototype.hasOwnProperty.call(ue,"naturalWidth")?ue.naturalWidth:ue.width,pe.height=Object.prototype.hasOwnProperty.call(ue,"naturalHeight")?ue.naturalHeight:ue.height,pe.aspectRatio=pe.width/pe.height,pe.dimensions=new fe.Point(pe.width,pe.height),pe._tileWidth=pe.width,pe._tileHeight=pe.height,pe.tileOverlap=0,pe.minLevel=0,pe.levels=pe._buildLevels(),pe.maxLevel=pe.levels.length-1,pe.ready=!0,pe.raiseEvent("ready",{tileSource:pe})}),fe.addEvent(ue,"error",function(){pe.raiseEvent("open-failed",{message:"Error loading image at "+ee,source:ee})}),ue.src=ee},getLevelScale:function(ee){var ue=NaN;return ee>=this.minLevel&&ee<=this.maxLevel&&(ue=this.levels[ee].width/this.levels[this.maxLevel].width),ue},getNumTiles:function(ee){var ue=this.getLevelScale(ee);return ue?new fe.Point(1,1):new fe.Point(0,0)},getTileUrl:function(ee,ue,pe){var _e=null;return ee>=this.minLevel&&ee<=this.maxLevel&&(_e=this.levels[ee].url),_e},getContext2D:function(ee,ue,pe){var _e=null;return ee>=this.minLevel&&ee<=this.maxLevel&&(_e=this.levels[ee].context2D),_e},_buildLevels:function(){var ee=[{url:this._image.src,width:Object.prototype.hasOwnProperty.call(this._image,"naturalWidth")?this._image.naturalWidth:this._image.width,height:Object.prototype.hasOwnProperty.call(this._image,"naturalHeight")?this._image.naturalHeight:this._image.height}];if(!this.buildPyramid||!fe.supportsCanvas||!this.useCanvas)return delete this._image,ee;var ue=Object.prototype.hasOwnProperty.call(this._image,"naturalWidth")?this._image.naturalWidth:this._image.width,pe=Object.prototype.hasOwnProperty.call(this._image,"naturalHeight")?this._image.naturalHeight:this._image.height,_e=document.createElement("canvas"),Ne=_e.getContext("2d");if(_e.width=ue,_e.height=pe,Ne.drawImage(this._image,0,0,ue,pe),ee[0].context2D=Ne,delete this._image,fe.isCanvasTainted(_e))return ee;for(;ue>=2&&pe>=2;){ue=Math.floor(ue/2),pe=Math.floor(pe/2);var Ue=document.createElement("canvas"),Ge=Ue.getContext("2d");Ue.width=ue,Ue.height=pe,Ge.drawImage(_e,0,0,ue,pe),ee.splice(0,0,{context2D:Ge,width:ue,height:pe}),_e=Ue,Ne=Ge}return ee}})}(OpenSeadragon),function(fe){fe.TileSourceCollection=function(ee,ue,pe,_e){fe.console.error("TileSourceCollection is deprecated; use World instead")}}(OpenSeadragon),function(fe){fe.ButtonState={REST:0,GROUP:1,HOVER:2,DOWN:3},fe.Button=function(Ge){var qe=this;fe.EventSource.call(this),fe.extend(!0,this,{tooltip:null,srcRest:null,srcGroup:null,srcHover:null,srcDown:null,clickTimeThreshold:fe.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:fe.DEFAULT_SETTINGS.clickDistThreshold,fadeDelay:0,fadeLength:2e3,onPress:null,onRelease:null,onClick:null,onEnter:null,onExit:null,onFocus:null,onBlur:null},Ge),this.element=Ge.element||fe.makeNeutralElement("div"),Ge.element||(this.imgRest=fe.makeTransparentImage(this.srcRest),this.imgGroup=fe.makeTransparentImage(this.srcGroup),this.imgHover=fe.makeTransparentImage(this.srcHover),this.imgDown=fe.makeTransparentImage(this.srcDown),this.imgRest.alt=this.imgGroup.alt=this.imgHover.alt=this.imgDown.alt=this.tooltip,this.element.style.position="relative",fe.setElementTouchActionNone(this.element),this.imgGroup.style.position=this.imgHover.style.position=this.imgDown.style.position="absolute",this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="0px",this.imgGroup.style.left=this.imgHover.style.left=this.imgDown.style.left="0px",this.imgHover.style.visibility=this.imgDown.style.visibility="hidden",fe.Browser.vendor==fe.BROWSERS.FIREFOX&&fe.Browser.version<3&&(this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top=""),this.element.appendChild(this.imgRest),this.element.appendChild(this.imgGroup),this.element.appendChild(this.imgHover),this.element.appendChild(this.imgDown)),this.addHandler("press",this.onPress),this.addHandler("release",this.onRelease),this.addHandler("click",this.onClick),this.addHandler("enter",this.onEnter),this.addHandler("exit",this.onExit),this.addHandler("focus",this.onFocus),this.addHandler("blur",this.onBlur),this.currentState=fe.ButtonState.GROUP,this.fadeBeginTime=null,this.shouldFade=!1,this.element.style.display="inline-block",this.element.style.position="relative",this.element.title=this.tooltip,this.tracker=new fe.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(Ke){Ke.insideElementPressed?(Ne(qe,fe.ButtonState.DOWN),qe.raiseEvent("enter",{originalEvent:Ke.originalEvent})):Ke.buttonDownAny||Ne(qe,fe.ButtonState.HOVER)},focusHandler:function(Ke){this.enterHandler(Ke),qe.raiseEvent("focus",{originalEvent:Ke.originalEvent})},exitHandler:function(Ke){Ue(qe,fe.ButtonState.GROUP),Ke.insideElementPressed&&qe.raiseEvent("exit",{originalEvent:Ke.originalEvent})},blurHandler:function(Ke){this.exitHandler(Ke),qe.raiseEvent("blur",{originalEvent:Ke.originalEvent})},pressHandler:function(Ke){Ne(qe,fe.ButtonState.DOWN),qe.raiseEvent("press",{originalEvent:Ke.originalEvent})},releaseHandler:function(Ke){Ke.insideElementPressed&&Ke.insideElementReleased?(Ue(qe,fe.ButtonState.HOVER),qe.raiseEvent("release",{originalEvent:Ke.originalEvent})):Ke.insideElementPressed?Ue(qe,fe.ButtonState.GROUP):Ne(qe,fe.ButtonState.HOVER)},clickHandler:function(Ke){Ke.quick&&qe.raiseEvent("click",{originalEvent:Ke.originalEvent})},keyHandler:function(Ke){return Ke.keyCode===13?(qe.raiseEvent("click",{originalEvent:Ke.originalEvent}),qe.raiseEvent("release",{originalEvent:Ke.originalEvent}),!1):!0}}),Ue(this,fe.ButtonState.REST)},fe.extend(fe.Button.prototype,fe.EventSource.prototype,{notifyGroupEnter:function(){Ne(this,fe.ButtonState.GROUP)},notifyGroupExit:function(){Ue(this,fe.ButtonState.REST)},disable:function(){this.notifyGroupExit(),this.element.disabled=!0,fe.setElementOpacity(this.element,.2,!0)},enable:function(){this.element.disabled=!1,fe.setElementOpacity(this.element,1,!0),this.notifyGroupEnter()}});function ee(Ge){fe.requestAnimationFrame(function(){ue(Ge)})}function ue(Ge){var qe,Ke,Ye;Ge.shouldFade&&(qe=fe.now(),Ke=qe-Ge.fadeBeginTime,Ye=1-Ke/Ge.fadeLength,Ye=Math.min(1,Ye),Ye=Math.max(0,Ye),Ge.imgGroup&&fe.setElementOpacity(Ge.imgGroup,Ye,!0),Ye>0&&ee(Ge))}function pe(Ge){Ge.shouldFade=!0,Ge.fadeBeginTime=fe.now()+Ge.fadeDelay,window.setTimeout(function(){ee(Ge)},Ge.fadeDelay)}function _e(Ge){Ge.shouldFade=!1,Ge.imgGroup&&fe.setElementOpacity(Ge.imgGroup,1,!0)}function Ne(Ge,qe){Ge.element.disabled||(qe>=fe.ButtonState.GROUP&&Ge.currentState==fe.ButtonState.REST&&(_e(Ge),Ge.currentState=fe.ButtonState.GROUP),qe>=fe.ButtonState.HOVER&&Ge.currentState==fe.ButtonState.GROUP&&(Ge.imgHover&&(Ge.imgHover.style.visibility=""),Ge.currentState=fe.ButtonState.HOVER),qe>=fe.ButtonState.DOWN&&Ge.currentState==fe.ButtonState.HOVER&&(Ge.imgDown&&(Ge.imgDown.style.visibility=""),Ge.currentState=fe.ButtonState.DOWN))}function Ue(Ge,qe){Ge.element.disabled||(qe<=fe.ButtonState.HOVER&&Ge.currentState==fe.ButtonState.DOWN&&(Ge.imgDown&&(Ge.imgDown.style.visibility="hidden"),Ge.currentState=fe.ButtonState.HOVER),qe<=fe.ButtonState.GROUP&&Ge.currentState==fe.ButtonState.HOVER&&(Ge.imgHover&&(Ge.imgHover.style.visibility="hidden"),Ge.currentState=fe.ButtonState.GROUP),qe<=fe.ButtonState.REST&&Ge.currentState==fe.ButtonState.GROUP&&(pe(Ge),Ge.currentState=fe.ButtonState.REST))}}(OpenSeadragon),function(fe){fe.ButtonGroup=function(ee){fe.extend(!0,this,{buttons:[],clickTimeThreshold:fe.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:fe.DEFAULT_SETTINGS.clickDistThreshold,labelText:""},ee);var ue=this.buttons.concat([]),pe=this,_e;if(this.element=ee.element||fe.makeNeutralElement("div"),!ee.group)for(this.element.style.display="inline-block",_e=0;_e<ue.length;_e++)this.element.appendChild(ue[_e].element);fe.setElementTouchActionNone(this.element),this.tracker=new fe.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(Ne){var Ue;for(Ue=0;Ue<pe.buttons.length;Ue++)pe.buttons[Ue].notifyGroupEnter()},exitHandler:function(Ne){var Ue;if(!Ne.insideElementPressed)for(Ue=0;Ue<pe.buttons.length;Ue++)pe.buttons[Ue].notifyGroupExit()}})},fe.ButtonGroup.prototype={emulateEnter:function(){this.tracker.enterHandler({eventSource:this.tracker})},emulateExit:function(){this.tracker.exitHandler({eventSource:this.tracker})}}}(OpenSeadragon),function(fe){fe.Rect=function(ee,ue,pe,_e,Ne){this.x=typeof ee=="number"?ee:0,this.y=typeof ue=="number"?ue:0,this.width=typeof pe=="number"?pe:0,this.height=typeof _e=="number"?_e:0,this.degrees=typeof Ne=="number"?Ne:0,this.degrees=fe.positiveModulo(this.degrees,360);var Ue,Ge;this.degrees>=270?(Ue=this.getTopRight(),this.x=Ue.x,this.y=Ue.y,Ge=this.height,this.height=this.width,this.width=Ge,this.degrees-=270):this.degrees>=180?(Ue=this.getBottomRight(),this.x=Ue.x,this.y=Ue.y,this.degrees-=180):this.degrees>=90&&(Ue=this.getBottomLeft(),this.x=Ue.x,this.y=Ue.y,Ge=this.height,this.height=this.width,this.width=Ge,this.degrees-=90)},fe.Rect.fromSummits=function(ee,ue,pe){var _e=ee.distanceTo(ue),Ne=ee.distanceTo(pe),Ue=ue.minus(ee),Ge=Math.atan(Ue.y/Ue.x);return Ue.x<0?Ge+=Math.PI:Ue.y<0&&(Ge+=2*Math.PI),new fe.Rect(ee.x,ee.y,_e,Ne,Ge/Math.PI*180)},fe.Rect.prototype={clone:function(){return new fe.Rect(this.x,this.y,this.width,this.height,this.degrees)},getAspectRatio:function(){return this.width/this.height},getTopLeft:function(){return new fe.Point(this.x,this.y)},getBottomRight:function(){return new fe.Point(this.x+this.width,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getTopRight:function(){return new fe.Point(this.x+this.width,this.y).rotate(this.degrees,this.getTopLeft())},getBottomLeft:function(){return new fe.Point(this.x,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getCenter:function(){return new fe.Point(this.x+this.width/2,this.y+this.height/2).rotate(this.degrees,this.getTopLeft())},getSize:function(){return new fe.Point(this.width,this.height)},equals:function(ee){return ee instanceof fe.Rect&&this.x===ee.x&&this.y===ee.y&&this.width===ee.width&&this.height===ee.height&&this.degrees===ee.degrees},times:function(ee){return new fe.Rect(this.x*ee,this.y*ee,this.width*ee,this.height*ee,this.degrees)},translate:function(ee){return new fe.Rect(this.x+ee.x,this.y+ee.y,this.width,this.height,this.degrees)},union:function(ee){var ue=this.getBoundingBox(),pe=ee.getBoundingBox(),_e=Math.min(ue.x,pe.x),Ne=Math.min(ue.y,pe.y),Ue=Math.max(ue.x+ue.width,pe.x+pe.width),Ge=Math.max(ue.y+ue.height,pe.y+pe.height);return new fe.Rect(_e,Ne,Ue-_e,Ge-Ne)},intersection:function(ee){var ue=1e-10,pe=[],_e=this.getTopLeft();ee.containsPoint(_e,ue)&&pe.push(_e);var Ne=this.getTopRight();ee.containsPoint(Ne,ue)&&pe.push(Ne);var Ue=this.getBottomLeft();ee.containsPoint(Ue,ue)&&pe.push(Ue);var Ge=this.getBottomRight();ee.containsPoint(Ge,ue)&&pe.push(Ge);var qe=ee.getTopLeft();this.containsPoint(qe,ue)&&pe.push(qe);var Ke=ee.getTopRight();this.containsPoint(Ke,ue)&&pe.push(Ke);var Ye=ee.getBottomLeft();this.containsPoint(Ye,ue)&&pe.push(Ye);var Ze=ee.getBottomRight();this.containsPoint(Ze,ue)&&pe.push(Ze);for(var Xe=this._getSegments(),Je=ee._getSegments(),tt=0;tt<Xe.length;tt++)for(var rt=Xe[tt],et=0;et<Je.length;et++){var it=Je[et],nt=st(rt[0],rt[1],it[0],it[1]);nt&&pe.push(nt)}function st(Xr,Gr,qr,si){var oi=Gr.minus(Xr),Yr=si.minus(qr),ii=-Yr.x*oi.y+oi.x*Yr.y;if(ii===0)return null;var ti=(oi.x*(Xr.y-qr.y)-oi.y*(Xr.x-qr.x))/ii,ni=(Yr.x*(Xr.y-qr.y)-Yr.y*(Xr.x-qr.x))/ii;return-ue<=ti&&ti<=1-ue&&-ue<=ni&&ni<=1-ue?new fe.Point(Xr.x+ni*oi.x,Xr.y+ni*oi.y):null}if(pe.length===0)return null;for(var lt=pe[0].x,_r=pe[0].x,jr=pe[0].y,Nr=pe[0].y,Wr=1;Wr<pe.length;Wr++){var ri=pe[Wr];ri.x<lt&&(lt=ri.x),ri.x>_r&&(_r=ri.x),ri.y<jr&&(jr=ri.y),ri.y>Nr&&(Nr=ri.y)}return new fe.Rect(lt,jr,_r-lt,Nr-jr)},_getSegments:function(){var ee=this.getTopLeft(),ue=this.getTopRight(),pe=this.getBottomLeft(),_e=this.getBottomRight();return[[ee,ue],[ue,_e],[_e,pe],[pe,ee]]},rotate:function(ee,ue){if(ee=fe.positiveModulo(ee,360),ee===0)return this.clone();ue=ue||this.getCenter();var pe=this.getTopLeft().rotate(ee,ue),_e=this.getTopRight().rotate(ee,ue),Ne=_e.minus(pe);Ne=Ne.apply(function(Ge){var qe=1e-15;return Math.abs(Ge)<qe?0:Ge});var Ue=Math.atan(Ne.y/Ne.x);return Ne.x<0?Ue+=Math.PI:Ne.y<0&&(Ue+=2*Math.PI),new fe.Rect(pe.x,pe.y,this.width,this.height,Ue/Math.PI*180)},getBoundingBox:function(){if(this.degrees===0)return this.clone();var ee=this.getTopLeft(),ue=this.getTopRight(),pe=this.getBottomLeft(),_e=this.getBottomRight(),Ne=Math.min(ee.x,ue.x,pe.x,_e.x),Ue=Math.max(ee.x,ue.x,pe.x,_e.x),Ge=Math.min(ee.y,ue.y,pe.y,_e.y),qe=Math.max(ee.y,ue.y,pe.y,_e.y);return new fe.Rect(Ne,Ge,Ue-Ne,qe-Ge)},getIntegerBoundingBox:function(){var ee=this.getBoundingBox(),ue=Math.floor(ee.x),pe=Math.floor(ee.y),_e=Math.ceil(ee.width+ee.x-ue),Ne=Math.ceil(ee.height+ee.y-pe);return new fe.Rect(ue,pe,_e,Ne)},containsPoint:function(ee,ue){ue=ue||0;var pe=this.getTopLeft(),_e=this.getTopRight(),Ne=this.getBottomLeft(),Ue=_e.minus(pe),Ge=Ne.minus(pe);return(ee.x-pe.x)*Ue.x+(ee.y-pe.y)*Ue.y>=-ue&&(ee.x-_e.x)*Ue.x+(ee.y-_e.y)*Ue.y<=ue&&(ee.x-pe.x)*Ge.x+(ee.y-pe.y)*Ge.y>=-ue&&(ee.x-Ne.x)*Ge.x+(ee.y-Ne.y)*Ge.y<=ue},toString:function(){return"["+Math.round(this.x*100)/100+", "+Math.round(this.y*100)/100+", "+Math.round(this.width*100)/100+"x"+Math.round(this.height*100)/100+", "+Math.round(this.degrees*100)/100+"deg]"}}}(OpenSeadragon),function(fe){var ee={};fe.ReferenceStrip=function(Ke){var Ye=this,Ze=Ke.viewer,Xe=fe.getElementSize(Ze.element),Je,tt,rt;for(Ke.id||(Ke.id="referencestrip-"+fe.now(),this.element=fe.makeNeutralElement("div"),this.element.id=Ke.id,this.element.className="referencestrip"),Ke=fe.extend(!0,{sizeRatio:fe.DEFAULT_SETTINGS.referenceStripSizeRatio,position:fe.DEFAULT_SETTINGS.referenceStripPosition,scroll:fe.DEFAULT_SETTINGS.referenceStripScroll,clickTimeThreshold:fe.DEFAULT_SETTINGS.clickTimeThreshold},Ke,{element:this.element,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1}),fe.extend(this,Ke),ee[this.id]={animating:!1},this.minPixelRatio=this.viewer.minPixelRatio,tt=this.element.style,tt.marginTop="0px",tt.marginRight="0px",tt.marginBottom="0px",tt.marginLeft="0px",tt.left="0px",tt.bottom="0px",tt.border="0px",tt.background="#000",tt.position="relative",fe.setElementTouchActionNone(this.element),fe.setElementOpacity(this.element,.8),this.viewer=Ze,this.innerTracker=new fe.MouseTracker({element:this.element,dragHandler:fe.delegate(this,ue),scrollHandler:fe.delegate(this,pe),enterHandler:fe.delegate(this,Ne),exitHandler:fe.delegate(this,Ue),keyDownHandler:fe.delegate(this,Ge),keyHandler:fe.delegate(this,qe)}),Ke.width&&Ke.height?(this.element.style.width=Ke.width+"px",this.element.style.height=Ke.height+"px",Ze.addControl(this.element,{anchor:fe.ControlAnchor.BOTTOM_LEFT})):Ke.scroll=="horizontal"?(this.element.style.width=Xe.x*Ke.sizeRatio*Ze.tileSources.length+12*Ze.tileSources.length+"px",this.element.style.height=Xe.y*Ke.sizeRatio+"px",Ze.addControl(this.element,{anchor:fe.ControlAnchor.BOTTOM_LEFT})):(this.element.style.height=Xe.y*Ke.sizeRatio*Ze.tileSources.length+12*Ze.tileSources.length+"px",this.element.style.width=Xe.x*Ke.sizeRatio+"px",Ze.addControl(this.element,{anchor:fe.ControlAnchor.TOP_LEFT})),this.panelWidth=Xe.x*this.sizeRatio+8,this.panelHeight=Xe.y*this.sizeRatio+8,this.panels=[],this.miniViewers={},rt=0;rt<Ze.tileSources.length;rt++)Je=fe.makeNeutralElement("div"),Je.id=this.element.id+"-"+rt,Je.style.width=Ye.panelWidth+"px",Je.style.height=Ye.panelHeight+"px",Je.style.display="inline",Je.style.float="left",Je.style.cssFloat="left",Je.style.styleFloat="left",Je.style.padding="2px",fe.setElementTouchActionNone(Je),Je.innerTracker=new fe.MouseTracker({element:Je,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,pressHandler:function(et){et.eventSource.dragging=fe.now()},releaseHandler:function(et){var it=et.eventSource,nt=it.element.id,st=Number(nt.split("-")[2]),lt=fe.now();et.insideElementPressed&&et.insideElementReleased&&it.dragging&&lt-it.dragging<it.clickTimeThreshold&&(it.dragging=null,Ze.goToPage(st))}}),this.element.appendChild(Je),Je.activePanel=!1,this.panels.push(Je);_e(this,this.scroll=="vertical"?Xe.y:Xe.x,0),this.setFocus(0)},fe.extend(fe.ReferenceStrip.prototype,fe.EventSource.prototype,fe.Viewer.prototype,{setFocus:function(Ke){var Ye=this.element.querySelector("#"+this.element.id+"-"+Ke),Ze=fe.getElementSize(this.viewer.canvas),Xe=Number(this.element.style.width.replace("px","")),Je=Number(this.element.style.height.replace("px","")),tt=-Number(this.element.style.marginLeft.replace("px","")),rt=-Number(this.element.style.marginTop.replace("px","")),et;this.currentSelected!==Ye&&(this.currentSelected&&(this.currentSelected.style.background="#000"),this.currentSelected=Ye,this.currentSelected.style.background="#999",this.scroll=="horizontal"?(et=Number(Ke)*(this.panelWidth+3),et>tt+Ze.x-this.panelWidth?(et=Math.min(et,Xe-Ze.x),this.element.style.marginLeft=-et+"px",_e(this,Ze.x,-et)):et<tt&&(et=Math.max(0,et-Ze.x/2),this.element.style.marginLeft=-et+"px",_e(this,Ze.x,-et))):(et=Number(Ke)*(this.panelHeight+3),et>rt+Ze.y-this.panelHeight?(et=Math.min(et,Je-Ze.y),this.element.style.marginTop=-et+"px",_e(this,Ze.y,-et)):et<rt&&(et=Math.max(0,et-Ze.y/2),this.element.style.marginTop=-et+"px",_e(this,Ze.y,-et))),this.currentPage=Ke,Ne.call(this,{eventSource:this.innerTracker}))},update:function(){return ee[this.id].animating?(fe.console.log("image reference strip update"),!0):!1},destroy:function(){if(this.miniViewers)for(var Ke in this.miniViewers)this.miniViewers[Ke].destroy();this.element&&this.element.parentNode.removeChild(this.element)}});function ue(Ke){var Ye=Number(this.element.style.marginLeft.replace("px","")),Ze=Number(this.element.style.marginTop.replace("px","")),Xe=Number(this.element.style.width.replace("px","")),Je=Number(this.element.style.height.replace("px","")),tt=fe.getElementSize(this.viewer.canvas);return this.dragging=!0,this.element&&(this.scroll=="horizontal"?-Ke.delta.x>0?Ye>-(Xe-tt.x)&&(this.element.style.marginLeft=Ye+Ke.delta.x*2+"px",_e(this,tt.x,Ye+Ke.delta.x*2)):-Ke.delta.x<0&&Ye<0&&(this.element.style.marginLeft=Ye+Ke.delta.x*2+"px",_e(this,tt.x,Ye+Ke.delta.x*2)):-Ke.delta.y>0?Ze>-(Je-tt.y)&&(this.element.style.marginTop=Ze+Ke.delta.y*2+"px",_e(this,tt.y,Ze+Ke.delta.y*2)):-Ke.delta.y<0&&Ze<0&&(this.element.style.marginTop=Ze+Ke.delta.y*2+"px",_e(this,tt.y,Ze+Ke.delta.y*2))),!1}function pe(Ke){var Ye=Number(this.element.style.marginLeft.replace("px","")),Ze=Number(this.element.style.marginTop.replace("px","")),Xe=Number(this.element.style.width.replace("px","")),Je=Number(this.element.style.height.replace("px","")),tt=fe.getElementSize(this.viewer.canvas);return this.element&&(this.scroll=="horizontal"?Ke.scroll>0?Ye>-(Xe-tt.x)&&(this.element.style.marginLeft=Ye-Ke.scroll*60+"px",_e(this,tt.x,Ye-Ke.scroll*60)):Ke.scroll<0&&Ye<0&&(this.element.style.marginLeft=Ye-Ke.scroll*60+"px",_e(this,tt.x,Ye-Ke.scroll*60)):Ke.scroll<0?Ze>tt.y-Je&&(this.element.style.marginTop=Ze+Ke.scroll*60+"px",_e(this,tt.y,Ze+Ke.scroll*60)):Ke.scroll>0&&Ze<0&&(this.element.style.marginTop=Ze+Ke.scroll*60+"px",_e(this,tt.y,Ze+Ke.scroll*60))),!1}function _e(Ke,Ye,Ze){var Xe,Je,tt,rt,et,it,nt;for(Ke.scroll=="horizontal"?Xe=Ke.panelWidth:Xe=Ke.panelHeight,Je=Math.ceil(Ye/Xe)+5,tt=Math.ceil((Math.abs(Ze)+Ye)/Xe)+1,Je=tt-Je,Je=Je<0?0:Je,it=Je;it<tt&&it<Ke.panels.length;it++)if(nt=Ke.panels[it],!nt.activePanel){var st,lt=Ke.viewer.tileSources[it];lt.referenceStripThumbnailUrl?st={type:"image",url:lt.referenceStripThumbnailUrl}:st=lt,rt=new fe.Viewer({id:nt.id,tileSources:[st],element:nt,navigatorSizeRatio:Ke.sizeRatio,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,loadTilesWithAjax:Ke.viewer.loadTilesWithAjax,ajaxHeaders:Ke.viewer.ajaxHeaders,useCanvas:Ke.useCanvas}),rt.displayRegion=fe.makeNeutralElement("div"),rt.displayRegion.id=nt.id+"-displayregion",rt.displayRegion.className="displayregion",et=rt.displayRegion.style,et.position="relative",et.top="0px",et.left="0px",et.fontSize="0px",et.overflow="hidden",et.float="left",et.cssFloat="left",et.styleFloat="left",et.zIndex=999999999,et.cursor="default",et.width=Ke.panelWidth-4+"px",et.height=Ke.panelHeight-4+"px",rt.displayRegion.innerTracker=new fe.MouseTracker({element:rt.displayRegion,startDisabled:!0}),nt.getElementsByTagName("div")[0].appendChild(rt.displayRegion),Ke.miniViewers[nt.id]=rt,nt.activePanel=!0}}function Ne(Ke){var Ye=Ke.eventSource.element;return this.scroll=="horizontal"?Ye.style.marginBottom="0px":Ye.style.marginLeft="0px",!1}function Ue(Ke){var Ye=Ke.eventSource.element;return this.scroll=="horizontal"?Ye.style.marginBottom="-"+fe.getElementSize(Ye).y/2+"px":Ye.style.marginLeft="-"+fe.getElementSize(Ye).x/2+"px",!1}function Ge(Ke){if(!Ke.preventDefaultAction&&!Ke.ctrl&&!Ke.alt&&!Ke.meta)switch(Ke.keyCode){case 38:return pe.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 40:return pe.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 37:return pe.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 39:return pe.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;default:return!0}else return!0}function qe(Ke){if(!Ke.preventDefaultAction&&!Ke.ctrl&&!Ke.alt&&!Ke.meta)switch(Ke.keyCode){case 61:return pe.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 45:return pe.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 48:case 119:case 87:return pe.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 115:case 83:return pe.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 97:return pe.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 100:return pe.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;default:return!0}else return!0}}(OpenSeadragon),function(fe){fe.DisplayRect=function(ee,ue,pe,_e,Ne,Ue){fe.Rect.apply(this,[ee,ue,pe,_e]),this.minLevel=Ne,this.maxLevel=Ue},fe.extend(fe.DisplayRect.prototype,fe.Rect.prototype)}(OpenSeadragon),function(fe){fe.Spring=function(ue){var pe=arguments;typeof ue!="object"&&(ue={initial:pe.length&&typeof pe[0]=="number"?pe[0]:void 0,springStiffness:pe.length>1?pe[1].springStiffness:5,animationTime:pe.length>1?pe[1].animationTime:1.5}),fe.console.assert(typeof ue.springStiffness=="number"&&ue.springStiffness!==0,"[OpenSeadragon.Spring] options.springStiffness must be a non-zero number"),fe.console.assert(typeof ue.animationTime=="number"&&ue.animationTime>=0,"[OpenSeadragon.Spring] options.animationTime must be a number greater than or equal to 0"),ue.exponential&&(this._exponential=!0,delete ue.exponential),fe.extend(!0,this,ue),this.current={value:typeof this.initial=="number"?this.initial:this._exponential?0:1,time:fe.now()},fe.console.assert(!this._exponential||this.current.value!==0,"[OpenSeadragon.Spring] value must be non-zero for exponential springs"),this.start={value:this.current.value,time:this.current.time},this.target={value:this.current.value,time:this.current.time},this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},fe.Spring.prototype={resetTo:function(ue){fe.console.assert(!this._exponential||ue!==0,"[OpenSeadragon.Spring.resetTo] target must be non-zero for exponential springs"),this.start.value=this.target.value=this.current.value=ue,this.start.time=this.target.time=this.current.time=fe.now(),this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},springTo:function(ue){fe.console.assert(!this._exponential||ue!==0,"[OpenSeadragon.Spring.springTo] target must be non-zero for exponential springs"),this.start.value=this.current.value,this.start.time=this.current.time,this.target.value=ue,this.target.time=this.start.time+1e3*this.animationTime,this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},shiftBy:function(ue){this.start.value+=ue,this.target.value+=ue,this._exponential&&(fe.console.assert(this.target.value!==0&&this.start.value!==0,"[OpenSeadragon.Spring.shiftBy] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},setExponential:function(ue){this._exponential=ue,this._exponential&&(fe.console.assert(this.current.value!==0&&this.target.value!==0&&this.start.value!==0,"[OpenSeadragon.Spring.setExponential] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},update:function(){this.current.time=fe.now();var ue,pe;this._exponential?(ue=this.start._logValue,pe=this.target._logValue):(ue=this.start.value,pe=this.target.value);var _e=this.current.time>=this.target.time?pe:ue+(pe-ue)*ee(this.springStiffness,(this.current.time-this.start.time)/(this.target.time-this.start.time)),Ne=this.current.value;return this._exponential?this.current.value=Math.exp(_e):this.current.value=_e,Ne!=this.current.value},isAtTargetValue:function(){return this.current.value===this.target.value}};function ee(ue,pe){return(1-Math.exp(ue*-pe))/(1-Math.exp(-ue))}}(OpenSeadragon),function(fe){function ee(pe){fe.extend(!0,this,{timeout:fe.DEFAULT_SETTINGS.timeout,jobId:null},pe),this.image=null}ee.prototype={errorMsg:null,start:function(){var pe=this,_e=this.abort;this.image=new Image,this.image.onload=function(){pe.finish(!0)},this.image.onabort=this.image.onerror=function(){pe.errorMsg="Image load aborted",pe.finish(!1)},this.jobId=window.setTimeout(function(){pe.errorMsg="Image load exceeded timeout ("+pe.timeout+" ms)",pe.finish(!1)},this.timeout),this.loadWithAjax?(this.request=fe.makeAjaxRequest({url:this.src,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,responseType:"arraybuffer",success:function(Ne){var Ue;try{Ue=new window.Blob([Ne.response])}catch(Ye){var Ge=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if(Ye.name==="TypeError"&&Ge){var qe=new Ge;qe.append(Ne.response),Ue=qe.getBlob()}}Ue.size===0&&(pe.errorMsg="Empty image response.",pe.finish(!1));var Ke=(window.URL||window.webkitURL).createObjectURL(Ue);pe.image.src=Ke},error:function(Ne){pe.errorMsg="Image load aborted - XHR error",pe.finish(!1)}}),this.abort=function(){pe.request.abort(),typeof _e=="function"&&_e()}):(this.crossOriginPolicy!==!1&&(this.image.crossOrigin=this.crossOriginPolicy),this.image.src=this.src)},finish:function(pe){this.image.onload=this.image.onerror=this.image.onabort=null,pe||(this.image=null),this.jobId&&window.clearTimeout(this.jobId),this.callback(this)}},fe.ImageLoader=function(pe){fe.extend(!0,this,{jobLimit:fe.DEFAULT_SETTINGS.imageLoaderLimit,timeout:fe.DEFAULT_SETTINGS.timeout,jobQueue:[],jobsInProgress:0},pe)},fe.ImageLoader.prototype={addJob:function(pe){var _e=this,Ne=function(qe){ue(_e,qe,pe.callback)},Ue={src:pe.src,loadWithAjax:pe.loadWithAjax,ajaxHeaders:pe.loadWithAjax?pe.ajaxHeaders:null,crossOriginPolicy:pe.crossOriginPolicy,ajaxWithCredentials:pe.ajaxWithCredentials,callback:Ne,abort:pe.abort,timeout:this.timeout},Ge=new ee(Ue);!this.jobLimit||this.jobsInProgress<this.jobLimit?(Ge.start(),this.jobsInProgress++):this.jobQueue.push(Ge)},clear:function(){for(var pe=0;pe<this.jobQueue.length;pe++){var _e=this.jobQueue[pe];typeof _e.abort=="function"&&_e.abort()}this.jobQueue=[]}};function ue(pe,_e,Ne){var Ue;pe.jobsInProgress--,(!pe.jobLimit||pe.jobsInProgress<pe.jobLimit)&&pe.jobQueue.length>0&&(Ue=pe.jobQueue.shift(),Ue.start(),pe.jobsInProgress++),Ne(_e.image,_e.errorMsg,_e.request)}}(OpenSeadragon),function(fe){fe.Tile=function(ee,ue,pe,_e,Ne,Ue,Ge,qe,Ke,Ye){this.level=ee,this.x=ue,this.y=pe,this.bounds=_e,this.sourceBounds=Ye,this.exists=Ne,this.url=Ue,this.context2D=Ge,this.loadWithAjax=qe,this.ajaxHeaders=Ke,this.ajaxHeaders?this.cacheKey=this.url+"+"+JSON.stringify(this.ajaxHeaders):this.cacheKey=this.url,this.loaded=!1,this.loading=!1,this.element=null,this.imgElement=null,this.image=null,this.style=null,this.position=null,this.size=null,this.blendStart=null,this.opacity=null,this.squaredDistance=null,this.visibility=null,this.beingDrawn=!1,this.lastTouchTime=0,this.isRightMost=!1,this.isBottomMost=!1},fe.Tile.prototype={toString:function(){return this.level+"/"+this.x+"_"+this.y},_hasTransparencyChannel:function(){return!!this.context2D||this.url.match(".png")},drawHTML:function(ee){if(!this.cacheImageRecord){fe.console.warn("[Tile.drawHTML] attempting to draw tile %s when it's not cached",this.toString());return}if(!this.loaded){fe.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString());return}this.element||(this.element=fe.makeNeutralElement("div"),this.imgElement=this.cacheImageRecord.getImage().cloneNode(),this.imgElement.style.msInterpolationMode="nearest-neighbor",this.imgElement.style.width="100%",this.imgElement.style.height="100%",this.style=this.element.style,this.style.position="absolute"),this.element.parentNode!=ee&&ee.appendChild(this.element),this.imgElement.parentNode!=this.element&&this.element.appendChild(this.imgElement),this.style.top=this.position.y+"px",this.style.left=this.position.x+"px",this.style.height=this.size.y+"px",this.style.width=this.size.x+"px",fe.setElementOpacity(this.element,this.opacity)},drawCanvas:function(ee,ue,pe,_e){var Ne=this.position.times(fe.pixelDensityRatio),Ue=this.size.times(fe.pixelDensityRatio),Ge;if(!this.context2D&&!this.cacheImageRecord){fe.console.warn("[Tile.drawCanvas] attempting to draw tile %s when it's not cached",this.toString());return}if(Ge=this.context2D||this.cacheImageRecord.getRenderedContext(),!this.loaded||!Ge){fe.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString());return}ee.save(),ee.globalAlpha=this.opacity,typeof pe=="number"&&pe!==1&&(Ne=Ne.times(pe),Ue=Ue.times(pe)),_e instanceof fe.Point&&(Ne=Ne.plus(_e)),ee.globalAlpha===1&&this._hasTransparencyChannel()&&ee.clearRect(Ne.x,Ne.y,Ue.x,Ue.y),ue({context:ee,tile:this,rendered:Ge});var qe,Ke;this.sourceBounds?(qe=Math.min(this.sourceBounds.width,Ge.canvas.width),Ke=Math.min(this.sourceBounds.height,Ge.canvas.height)):(qe=Ge.canvas.width,Ke=Ge.canvas.height),ee.drawImage(Ge.canvas,0,0,qe,Ke,Ne.x,Ne.y,Ue.x,Ue.y),ee.restore()},getScaleForEdgeSmoothing:function(){var ee;if(this.cacheImageRecord)ee=this.cacheImageRecord.getRenderedContext();else if(this.context2D)ee=this.context2D;else return fe.console.warn("[Tile.drawCanvas] attempting to get tile scale %s when tile's not cached",this.toString()),1;return ee.canvas.width/(this.size.x*fe.pixelDensityRatio)},getTranslationForEdgeSmoothing:function(ee,ue,pe){var _e=Math.max(1,Math.ceil((pe.x-ue.x)/2)),Ne=Math.max(1,Math.ceil((pe.y-ue.y)/2));return new fe.Point(_e,Ne).minus(this.position.times(fe.pixelDensityRatio).times(ee||1).apply(function(Ue){return Ue%1}))},unload:function(){this.imgElement&&this.imgElement.parentNode&&this.imgElement.parentNode.removeChild(this.imgElement),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null,this.imgElement=null,this.loaded=!1,this.loading=!1}}}(OpenSeadragon),function(fe){fe.OverlayPlacement=fe.Placement,fe.OverlayRotationMode=fe.freezeObject({NO_ROTATION:1,EXACT:2,BOUNDING_BOX:3}),fe.Overlay=function(ee,ue,pe){var _e;fe.isPlainObject(ee)?_e=ee:_e={element:ee,location:ue,placement:pe},this.element=_e.element,this.style=_e.element.style,this._init(_e)},fe.Overlay.prototype={_init:function(ee){this.location=ee.location,this.placement=ee.placement===void 0?fe.Placement.TOP_LEFT:ee.placement,this.onDraw=ee.onDraw,this.checkResize=ee.checkResize===void 0?!0:ee.checkResize,this.width=ee.width===void 0?null:ee.width,this.height=ee.height===void 0?null:ee.height,this.rotationMode=ee.rotationMode||fe.OverlayRotationMode.EXACT,this.location instanceof fe.Rect&&(this.width=this.location.width,this.height=this.location.height,this.location=this.location.getTopLeft(),this.placement=fe.Placement.TOP_LEFT),this.scales=this.width!==null&&this.height!==null,this.bounds=new fe.Rect(this.location.x,this.location.y,this.width,this.height),this.position=this.location},adjust:function(ee,ue){var pe=fe.Placement.properties[this.placement];pe&&(pe.isHorizontallyCentered?ee.x-=ue.x/2:pe.isRight&&(ee.x-=ue.x),pe.isVerticallyCentered?ee.y-=ue.y/2:pe.isBottom&&(ee.y-=ue.y))},destroy:function(){var ee=this.element,ue=this.style;ee.parentNode&&(ee.parentNode.removeChild(ee),ee.prevElementParent&&(ue.display="none",document.body.appendChild(ee))),this.onDraw=null,ue.top="",ue.left="",ue.position="",this.width!==null&&(ue.width=""),this.height!==null&&(ue.height="");var pe=fe.getCssPropertyWithVendorPrefix("transformOrigin"),_e=fe.getCssPropertyWithVendorPrefix("transform");pe&&_e&&(ue[pe]="",ue[_e]="")},drawHTML:function(ee,ue){var pe=this.element;pe.parentNode!==ee&&(pe.prevElementParent=pe.parentNode,pe.prevNextSibling=pe.nextSibling,ee.appendChild(pe),this.style.position="absolute",this.size=fe.getElementSize(pe));var _e=this._getOverlayPositionAndSize(ue),Ne=_e.position,Ue=this.size=_e.size,Ge=_e.rotate;if(this.onDraw)this.onDraw(Ne,Ue,this.element);else{var qe=this.style;qe.left=Ne.x+"px",qe.top=Ne.y+"px",this.width!==null&&(qe.width=Ue.x+"px"),this.height!==null&&(qe.height=Ue.y+"px");var Ke=fe.getCssPropertyWithVendorPrefix("transformOrigin"),Ye=fe.getCssPropertyWithVendorPrefix("transform");Ke&&Ye&&(Ge?(qe[Ke]=this._getTransformOrigin(),qe[Ye]="rotate("+Ge+"deg)"):(qe[Ke]="",qe[Ye]="")),qe.display!=="none"&&(qe.display="block")}},_getOverlayPositionAndSize:function(ee){var ue=ee.pixelFromPoint(this.location,!0),pe=this._getSizeInPixels(ee);this.adjust(ue,pe);var _e=0;if(ee.degrees&&this.rotationMode!==fe.OverlayRotationMode.NO_ROTATION)if(this.rotationMode===fe.OverlayRotationMode.BOUNDING_BOX&&this.width!==null&&this.height!==null){var Ne=new fe.Rect(ue.x,ue.y,pe.x,pe.y),Ue=this._getBoundingBox(Ne,ee.degrees);ue=Ue.getTopLeft(),pe=Ue.getSize()}else _e=ee.degrees;return{position:ue,size:pe,rotate:_e}},_getSizeInPixels:function(ee){var ue=this.size.x,pe=this.size.y;if(this.width!==null||this.height!==null){var _e=ee.deltaPixelsFromPointsNoRotate(new fe.Point(this.width||0,this.height||0),!0);this.width!==null&&(ue=_e.x),this.height!==null&&(pe=_e.y)}if(this.checkResize&&(this.width===null||this.height===null)){var Ne=this.size=fe.getElementSize(this.element);this.width===null&&(ue=Ne.x),this.height===null&&(pe=Ne.y)}return new fe.Point(ue,pe)},_getBoundingBox:function(ee,ue){var pe=this._getPlacementPoint(ee);return ee.rotate(ue,pe).getBoundingBox()},_getPlacementPoint:function(ee){var ue=new fe.Point(ee.x,ee.y),pe=fe.Placement.properties[this.placement];return pe&&(pe.isHorizontallyCentered?ue.x+=ee.width/2:pe.isRight&&(ue.x+=ee.width),pe.isVerticallyCentered?ue.y+=ee.height/2:pe.isBottom&&(ue.y+=ee.height)),ue},_getTransformOrigin:function(){var ee="",ue=fe.Placement.properties[this.placement];return ue&&(ue.isLeft?ee="left":ue.isRight&&(ee="right"),ue.isTop?ee+=" top":ue.isBottom&&(ee+=" bottom")),ee},update:function(ee,ue){var pe=fe.isPlainObject(ee)?ee:{location:ee,placement:ue};this._init({location:pe.location||this.location,placement:pe.placement!==void 0?pe.placement:this.placement,onDraw:pe.onDraw||this.onDraw,checkResize:pe.checkResize||this.checkResize,width:pe.width!==void 0?pe.width:this.width,height:pe.height!==void 0?pe.height:this.height,rotationMode:pe.rotationMode||this.rotationMode})},getBounds:function(ee){fe.console.assert(ee,"A viewport must now be passed to Overlay.getBounds.");var ue=this.width,pe=this.height;if(ue===null||pe===null){var _e=ee.deltaPointsFromPixelsNoRotate(this.size,!0);ue===null&&(ue=_e.x),pe===null&&(pe=_e.y)}var Ne=this.location.clone();return this.adjust(Ne,new fe.Point(ue,pe)),this._adjustBoundsForRotation(ee,new fe.Rect(Ne.x,Ne.y,ue,pe))},_adjustBoundsForRotation:function(ee,ue){if(!ee||ee.degrees===0||this.rotationMode===fe.OverlayRotationMode.EXACT)return ue;if(this.rotationMode===fe.OverlayRotationMode.BOUNDING_BOX){if(this.width===null||this.height===null)return ue;var pe=this._getOverlayPositionAndSize(ee);return ee.viewerElementToViewportRectangle(new fe.Rect(pe.position.x,pe.position.y,pe.size.x,pe.size.y))}return ue.rotate(-ee.degrees,this._getPlacementPoint(ue))}}}(OpenSeadragon),function(fe){fe.Drawer=function(ee){fe.console.assert(ee.viewer,"[Drawer] options.viewer is required");var ue=arguments;if(fe.isPlainObject(ee)||(ee={source:ue[0],viewport:ue[1],element:ue[2]}),fe.console.assert(ee.viewport,"[Drawer] options.viewport is required"),fe.console.assert(ee.element,"[Drawer] options.element is required"),ee.source&&fe.console.error("[Drawer] options.source is no longer accepted; use TiledImage instead"),this.viewer=ee.viewer,this.viewport=ee.viewport,this.debugGridColor=typeof ee.debugGridColor=="string"?[ee.debugGridColor]:ee.debugGridColor||fe.DEFAULT_SETTINGS.debugGridColor,ee.opacity&&fe.console.error("[Drawer] options.opacity is no longer accepted; set the opacity on the TiledImage instead"),this.useCanvas=fe.supportsCanvas&&(this.viewer?this.viewer.useCanvas:!0),this.container=fe.getElement(ee.element),this.canvas=fe.makeNeutralElement(this.useCanvas?"canvas":"div"),this.context=this.useCanvas?this.canvas.getContext("2d"):null,this.sketchCanvas=null,this.sketchContext=null,this.element=this.container,this.container.dir="ltr",this.useCanvas){var pe=this._calculateCanvasSize();this.canvas.width=pe.x,this.canvas.height=pe.y}this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="absolute",fe.setElementOpacity(this.canvas,this.opacity,!0),this.container.style.textAlign="left",this.container.appendChild(this.canvas),this._imageSmoothingEnabled=!0},fe.Drawer.prototype={addOverlay:function(ee,ue,pe,_e){return fe.console.error("drawer.addOverlay is deprecated. Use viewer.addOverlay instead."),this.viewer.addOverlay(ee,ue,pe,_e),this},updateOverlay:function(ee,ue,pe){return fe.console.error("drawer.updateOverlay is deprecated. Use viewer.updateOverlay instead."),this.viewer.updateOverlay(ee,ue,pe),this},removeOverlay:function(ee){return fe.console.error("drawer.removeOverlay is deprecated. Use viewer.removeOverlay instead."),this.viewer.removeOverlay(ee),this},clearOverlays:function(){return fe.console.error("drawer.clearOverlays is deprecated. Use viewer.clearOverlays instead."),this.viewer.clearOverlays(),this},viewportCoordToDrawerCoord:function(ee){var ue=this.viewport.pixelFromPointNoRotate(ee,!0);return new fe.Point(ue.x*fe.pixelDensityRatio,ue.y*fe.pixelDensityRatio)},clipWithPolygons:function(ee,ue){if(this.useCanvas){var pe=this._getContext(ue);pe.beginPath(),ee.forEach(function(_e){_e.forEach(function(Ne,Ue){pe[Ue===0?"moveTo":"lineTo"](Ne.x,Ne.y)})}),pe.clip()}},setOpacity:function(ee){fe.console.error("drawer.setOpacity is deprecated. Use tiledImage.setOpacity instead.");for(var ue=this.viewer.world,pe=0;pe<ue.getItemCount();pe++)ue.getItemAt(pe).setOpacity(ee);return this},getOpacity:function(){fe.console.error("drawer.getOpacity is deprecated. Use tiledImage.getOpacity instead.");for(var ee=this.viewer.world,ue=0,pe=0;pe<ee.getItemCount();pe++){var _e=ee.getItemAt(pe).getOpacity();_e>ue&&(ue=_e)}return ue},needsUpdate:function(){return fe.console.error("[Drawer.needsUpdate] this function is deprecated. Use World.needsDraw instead."),this.viewer.world.needsDraw()},numTilesLoaded:function(){return fe.console.error("[Drawer.numTilesLoaded] this function is deprecated. Use TileCache.numTilesLoaded instead."),this.viewer.tileCache.numTilesLoaded()},reset:function(){return fe.console.error("[Drawer.reset] this function is deprecated. Use World.resetItems instead."),this.viewer.world.resetItems(),this},update:function(){return fe.console.error("[Drawer.update] this function is deprecated. Use Drawer.clear and World.draw instead."),this.clear(),this.viewer.world.draw(),this},canRotate:function(){return this.useCanvas},destroy:function(){this.canvas.width=1,this.canvas.height=1,this.sketchCanvas=null,this.sketchContext=null},clear:function(){if(this.canvas.innerHTML="",this.useCanvas){var ee=this._calculateCanvasSize();if((this.canvas.width!=ee.x||this.canvas.height!=ee.y)&&(this.canvas.width=ee.x,this.canvas.height=ee.y,this._updateImageSmoothingEnabled(this.context),this.sketchCanvas!==null)){var ue=this._calculateSketchCanvasSize();this.sketchCanvas.width=ue.x,this.sketchCanvas.height=ue.y,this._updateImageSmoothingEnabled(this.sketchContext)}this._clear()}},_clear:function(ee,ue){if(this.useCanvas){var pe=this._getContext(ee);if(ue)pe.clearRect(ue.x,ue.y,ue.width,ue.height);else{var _e=pe.canvas;pe.clearRect(0,0,_e.width,_e.height)}}},viewportToDrawerRectangle:function(ee){var ue=this.viewport.pixelFromPointNoRotate(ee.getTopLeft(),!0),pe=this.viewport.deltaPixelsFromPointsNoRotate(ee.getSize(),!0);return new fe.Rect(ue.x*fe.pixelDensityRatio,ue.y*fe.pixelDensityRatio,pe.x*fe.pixelDensityRatio,pe.y*fe.pixelDensityRatio)},drawTile:function(ee,ue,pe,_e,Ne){if(fe.console.assert(ee,"[Drawer.drawTile] tile is required"),fe.console.assert(ue,"[Drawer.drawTile] drawingHandler is required"),this.useCanvas){var Ue=this._getContext(pe);_e=_e||1,ee.drawCanvas(Ue,ue,_e,Ne)}else ee.drawHTML(this.canvas)},_getContext:function(ee){var ue=this.context;if(ee){if(this.sketchCanvas===null){this.sketchCanvas=document.createElement("canvas");var pe=this._calculateSketchCanvasSize();if(this.sketchCanvas.width=pe.x,this.sketchCanvas.height=pe.y,this.sketchContext=this.sketchCanvas.getContext("2d"),this.viewport.getRotation()===0){var _e=this;this.viewer.addHandler("rotate",function Ne(){if(_e.viewport.getRotation()!==0){_e.viewer.removeHandler("rotate",Ne);var Ue=_e._calculateSketchCanvasSize();_e.sketchCanvas.width=Ue.x,_e.sketchCanvas.height=Ue.y}})}this._updateImageSmoothingEnabled(this.sketchContext)}ue=this.sketchContext}return ue},saveContext:function(ee){this.useCanvas&&this._getContext(ee).save()},restoreContext:function(ee){this.useCanvas&&this._getContext(ee).restore()},setClip:function(ee,ue){if(this.useCanvas){var pe=this._getContext(ue);pe.beginPath(),pe.rect(ee.x,ee.y,ee.width,ee.height),pe.clip()}},drawRectangle:function(ee,ue,pe){if(this.useCanvas){var _e=this._getContext(pe);_e.save(),_e.fillStyle=ue,_e.fillRect(ee.x,ee.y,ee.width,ee.height),_e.restore()}},blendSketch:function(ee,ue,pe,_e){var Ne=ee;if(fe.isPlainObject(Ne)||(Ne={opacity:ee,scale:ue,translate:pe,compositeOperation:_e}),!(!this.useCanvas||!this.sketchCanvas)){ee=Ne.opacity,_e=Ne.compositeOperation;var Ue=Ne.bounds;if(this.context.save(),this.context.globalAlpha=ee,_e&&(this.context.globalCompositeOperation=_e),Ue)Ue.x<0&&(Ue.width+=Ue.x,Ue.x=0),Ue.x+Ue.width>this.canvas.width&&(Ue.width=this.canvas.width-Ue.x),Ue.y<0&&(Ue.height+=Ue.y,Ue.y=0),Ue.y+Ue.height>this.canvas.height&&(Ue.height=this.canvas.height-Ue.y),this.context.drawImage(this.sketchCanvas,Ue.x,Ue.y,Ue.width,Ue.height,Ue.x,Ue.y,Ue.width,Ue.height);else{ue=Ne.scale||1,pe=Ne.translate;var Ge=pe instanceof fe.Point?pe:new fe.Point(0,0),qe=0,Ke=0;if(pe){var Ye=this.sketchCanvas.width-this.canvas.width,Ze=this.sketchCanvas.height-this.canvas.height;qe=Math.round(Ye/2),Ke=Math.round(Ze/2)}this.context.drawImage(this.sketchCanvas,Ge.x-qe*ue,Ge.y-Ke*ue,(this.canvas.width+2*qe)*ue,(this.canvas.height+2*Ke)*ue,-qe,-Ke,this.canvas.width+2*qe,this.canvas.height+2*Ke)}this.context.restore()}},drawDebugInfo:function(ee,ue,pe,_e){if(this.useCanvas){var Ne=this.viewer.world.getIndexOfItem(_e)%this.debugGridColor.length,Ue=this.context;Ue.save(),Ue.lineWidth=2*fe.pixelDensityRatio,Ue.font="small-caps bold "+13*fe.pixelDensityRatio+"px arial",Ue.strokeStyle=this.debugGridColor[Ne],Ue.fillStyle=this.debugGridColor[Ne],this.viewport.degrees!==0&&this._offsetForRotation({degrees:this.viewport.degrees}),_e.getRotation(!0)%360!==0&&this._offsetForRotation({degrees:_e.getRotation(!0),point:_e.viewport.pixelFromPointNoRotate(_e._getRotationPoint(!0),!0)}),_e.viewport.degrees===0&&_e.getRotation(!0)%360===0&&_e._drawer.viewer.viewport.getFlip()&&_e._drawer._flip(),Ue.strokeRect(ee.position.x*fe.pixelDensityRatio,ee.position.y*fe.pixelDensityRatio,ee.size.x*fe.pixelDensityRatio,ee.size.y*fe.pixelDensityRatio);var Ge=(ee.position.x+ee.size.x/2)*fe.pixelDensityRatio,qe=(ee.position.y+ee.size.y/2)*fe.pixelDensityRatio;Ue.translate(Ge,qe),Ue.rotate(Math.PI/180*-this.viewport.degrees),Ue.translate(-Ge,-qe),ee.x===0&&ee.y===0&&(Ue.fillText("Zoom: "+this.viewport.getZoom(),ee.position.x*fe.pixelDensityRatio,(ee.position.y-30)*fe.pixelDensityRatio),Ue.fillText("Pan: "+this.viewport.getBounds().toString(),ee.position.x*fe.pixelDensityRatio,(ee.position.y-20)*fe.pixelDensityRatio)),Ue.fillText("Level: "+ee.level,(ee.position.x+10)*fe.pixelDensityRatio,(ee.position.y+20)*fe.pixelDensityRatio),Ue.fillText("Column: "+ee.x,(ee.position.x+10)*fe.pixelDensityRatio,(ee.position.y+30)*fe.pixelDensityRatio),Ue.fillText("Row: "+ee.y,(ee.position.x+10)*fe.pixelDensityRatio,(ee.position.y+40)*fe.pixelDensityRatio),Ue.fillText("Order: "+pe+" of "+ue,(ee.position.x+10)*fe.pixelDensityRatio,(ee.position.y+50)*fe.pixelDensityRatio),Ue.fillText("Size: "+ee.size.toString(),(ee.position.x+10)*fe.pixelDensityRatio,(ee.position.y+60)*fe.pixelDensityRatio),Ue.fillText("Position: "+ee.position.toString(),(ee.position.x+10)*fe.pixelDensityRatio,(ee.position.y+70)*fe.pixelDensityRatio),this.viewport.degrees!==0&&this._restoreRotationChanges(),_e.getRotation(!0)%360!==0&&this._restoreRotationChanges(),_e.viewport.degrees===0&&_e.getRotation(!0)%360===0&&_e._drawer.viewer.viewport.getFlip()&&_e._drawer._flip(),Ue.restore()}},debugRect:function(ee){if(this.useCanvas){var ue=this.context;ue.save(),ue.lineWidth=2*fe.pixelDensityRatio,ue.strokeStyle=this.debugGridColor[0],ue.fillStyle=this.debugGridColor[0],ue.strokeRect(ee.x*fe.pixelDensityRatio,ee.y*fe.pixelDensityRatio,ee.width*fe.pixelDensityRatio,ee.height*fe.pixelDensityRatio),ue.restore()}},setImageSmoothingEnabled:function(ee){this.useCanvas&&(this._imageSmoothingEnabled=ee,this._updateImageSmoothingEnabled(this.context),this.viewer.forceRedraw())},_updateImageSmoothingEnabled:function(ee){ee.msImageSmoothingEnabled=this._imageSmoothingEnabled,ee.imageSmoothingEnabled=this._imageSmoothingEnabled},getCanvasSize:function(ee){var ue=this._getContext(ee).canvas;return new fe.Point(ue.width,ue.height)},getCanvasCenter:function(){return new fe.Point(this.canvas.width/2,this.canvas.height/2)},_offsetForRotation:function(ee){var ue=ee.point?ee.point.times(fe.pixelDensityRatio):this.getCanvasCenter(),pe=this._getContext(ee.useSketch);pe.save(),pe.translate(ue.x,ue.y),this.viewer.viewport.flipped?(pe.rotate(Math.PI/180*-ee.degrees),pe.scale(-1,1)):pe.rotate(Math.PI/180*ee.degrees),pe.translate(-ue.x,-ue.y)},_flip:function(ee){ee=ee||{};var ue=ee.point?ee.point.times(fe.pixelDensityRatio):this.getCanvasCenter(),pe=this._getContext(ee.useSketch);pe.translate(ue.x,0),pe.scale(-1,1),pe.translate(-ue.x,0)},_restoreRotationChanges:function(ee){var ue=this._getContext(ee);ue.restore()},_calculateCanvasSize:function(){var ee=fe.pixelDensityRatio,ue=this.viewport.getContainerSize();return{x:Math.round(ue.x*ee),y:Math.round(ue.y*ee)}},_calculateSketchCanvasSize:function(){var ee=this._calculateCanvasSize();if(this.viewport.getRotation()===0)return ee;var ue=Math.ceil(Math.sqrt(ee.x*ee.x+ee.y*ee.y));return{x:ue,y:ue}}}}(OpenSeadragon),function(fe){fe.Viewport=function(ee){var ue=arguments;ue.length&&ue[0]instanceof fe.Point&&(ee={containerSize:ue[0],contentSize:ue[1],config:ue[2]}),ee.config&&(fe.extend(!0,ee,ee.config),delete ee.config),this._margins=fe.extend({left:0,top:0,right:0,bottom:0},ee.margins||{}),delete ee.margins,fe.extend(!0,this,{containerSize:null,contentSize:null,zoomPoint:null,viewer:null,springStiffness:fe.DEFAULT_SETTINGS.springStiffness,animationTime:fe.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:fe.DEFAULT_SETTINGS.minZoomImageRatio,maxZoomPixelRatio:fe.DEFAULT_SETTINGS.maxZoomPixelRatio,visibilityRatio:fe.DEFAULT_SETTINGS.visibilityRatio,wrapHorizontal:fe.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:fe.DEFAULT_SETTINGS.wrapVertical,defaultZoomLevel:fe.DEFAULT_SETTINGS.defaultZoomLevel,minZoomLevel:fe.DEFAULT_SETTINGS.minZoomLevel,maxZoomLevel:fe.DEFAULT_SETTINGS.maxZoomLevel,degrees:fe.DEFAULT_SETTINGS.degrees,flipped:fe.DEFAULT_SETTINGS.flipped,homeFillsViewer:fe.DEFAULT_SETTINGS.homeFillsViewer},ee),this._updateContainerInnerSize(),this.centerSpringX=new fe.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.centerSpringY=new fe.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.zoomSpring=new fe.Spring({exponential:!0,initial:1,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,this._setContentBounds(new fe.Rect(0,0,1,1),1),this.goHome(!0),this.update()},fe.Viewport.prototype={resetContentSize:function(ee){return fe.console.assert(ee,"[Viewport.resetContentSize] contentSize is required"),fe.console.assert(ee instanceof fe.Point,"[Viewport.resetContentSize] contentSize must be an OpenSeadragon.Point"),fe.console.assert(ee.x>0,"[Viewport.resetContentSize] contentSize.x must be greater than 0"),fe.console.assert(ee.y>0,"[Viewport.resetContentSize] contentSize.y must be greater than 0"),this._setContentBounds(new fe.Rect(0,0,1,ee.y/ee.x),ee.x),this},setHomeBounds:function(ee,ue){fe.console.error("[Viewport.setHomeBounds] this function is deprecated; The content bounds should not be set manually."),this._setContentBounds(ee,ue)},_setContentBounds:function(ee,ue){fe.console.assert(ee,"[Viewport._setContentBounds] bounds is required"),fe.console.assert(ee instanceof fe.Rect,"[Viewport._setContentBounds] bounds must be an OpenSeadragon.Rect"),fe.console.assert(ee.width>0,"[Viewport._setContentBounds] bounds.width must be greater than 0"),fe.console.assert(ee.height>0,"[Viewport._setContentBounds] bounds.height must be greater than 0"),this._contentBoundsNoRotate=ee.clone(),this._contentSizeNoRotate=this._contentBoundsNoRotate.getSize().times(ue),this._contentBounds=ee.rotate(this.degrees).getBoundingBox(),this._contentSize=this._contentBounds.getSize().times(ue),this._contentAspectRatio=this._contentSize.x/this._contentSize.y,this.viewer&&this.viewer.raiseEvent("reset-size",{contentSize:this._contentSizeNoRotate.clone(),contentFactor:ue,homeBounds:this._contentBoundsNoRotate.clone(),contentBounds:this._contentBounds.clone()})},getHomeZoom:function(){if(this.defaultZoomLevel)return this.defaultZoomLevel;var ee=this._contentAspectRatio/this.getAspectRatio(),ue;return this.homeFillsViewer?ue=ee>=1?ee:1:ue=ee>=1?1:ee,ue/this._contentBounds.width},getHomeBounds:function(){return this.getHomeBoundsNoRotate().rotate(-this.getRotation())},getHomeBoundsNoRotate:function(){var ee=this._contentBounds.getCenter(),ue=1/this.getHomeZoom(),pe=ue/this.getAspectRatio();return new fe.Rect(ee.x-ue/2,ee.y-pe/2,ue,pe)},goHome:function(ee){return this.viewer&&this.viewer.raiseEvent("home",{immediately:ee}),this.fitBounds(this.getHomeBounds(),ee)},getMinZoom:function(){var ee=this.getHomeZoom(),ue=this.minZoomLevel?this.minZoomLevel:this.minZoomImageRatio*ee;return ue},getMaxZoom:function(){var ee=this.maxZoomLevel;return ee||(ee=this._contentSize.x*this.maxZoomPixelRatio/this._containerInnerSize.x,ee/=this._contentBounds.width),Math.max(ee,this.getHomeZoom())},getAspectRatio:function(){return this._containerInnerSize.x/this._containerInnerSize.y},getContainerSize:function(){return new fe.Point(this.containerSize.x,this.containerSize.y)},getMargins:function(){return fe.extend({},this._margins)},setMargins:function(ee){fe.console.assert(fe.type(ee)==="object","[Viewport.setMargins] margins must be an object"),this._margins=fe.extend({left:0,top:0,right:0,bottom:0},ee),this._updateContainerInnerSize(),this.viewer&&this.viewer.forceRedraw()},getBounds:function(ee){return this.getBoundsNoRotate(ee).rotate(-this.getRotation())},getBoundsNoRotate:function(ee){var ue=this.getCenter(ee),pe=1/this.getZoom(ee),_e=pe/this.getAspectRatio();return new fe.Rect(ue.x-pe/2,ue.y-_e/2,pe,_e)},getBoundsWithMargins:function(ee){return this.getBoundsNoRotateWithMargins(ee).rotate(-this.getRotation(),this.getCenter(ee))},getBoundsNoRotateWithMargins:function(ee){var ue=this.getBoundsNoRotate(ee),pe=this._containerInnerSize.x*this.getZoom(ee);return ue.x-=this._margins.left/pe,ue.y-=this._margins.top/pe,ue.width+=(this._margins.left+this._margins.right)/pe,ue.height+=(this._margins.top+this._margins.bottom)/pe,ue},getCenter:function(ee){var ue=new fe.Point(this.centerSpringX.current.value,this.centerSpringY.current.value),pe=new fe.Point(this.centerSpringX.target.value,this.centerSpringY.target.value),_e,Ne,Ue,Ge,qe,Ke,Ye,Ze;return ee?ue:this.zoomPoint?(_e=this.pixelFromPoint(this.zoomPoint,!0),Ne=this.getZoom(),Ue=1/Ne,Ge=Ue/this.getAspectRatio(),qe=new fe.Rect(ue.x-Ue/2,ue.y-Ge/2,Ue,Ge),Ke=this._pixelFromPoint(this.zoomPoint,qe),Ye=Ke.minus(_e),Ze=Ye.divide(this._containerInnerSize.x*Ne),pe.plus(Ze)):pe},getZoom:function(ee){return ee?this.zoomSpring.current.value:this.zoomSpring.target.value},_applyZoomConstraints:function(ee){return Math.max(Math.min(ee,this.getMaxZoom()),this.getMinZoom())},_applyBoundaryConstraints:function(ee){var ue=new fe.Rect(ee.x,ee.y,ee.width,ee.height);if(!this.wrapHorizontal){var pe=this.visibilityRatio*ue.width,_e=ue.x+ue.width,Ne=this._contentBoundsNoRotate.x+this._contentBoundsNoRotate.width,Ue=this._contentBoundsNoRotate.x-_e+pe,Ge=Ne-ue.x-pe;pe>this._contentBoundsNoRotate.width?ue.x+=(Ue+Ge)/2:Ge<0?ue.x+=Ge:Ue>0&&(ue.x+=Ue)}if(!this.wrapVertical){var qe=this.visibilityRatio*ue.height,Ke=ue.y+ue.height,Ye=this._contentBoundsNoRotate.y+this._contentBoundsNoRotate.height,Ze=this._contentBoundsNoRotate.y-Ke+qe,Xe=Ye-ue.y-qe;qe>this._contentBoundsNoRotate.height?ue.y+=(Ze+Xe)/2:Xe<0?ue.y+=Xe:Ze>0&&(ue.y+=Ze)}return ue},_raiseConstraintsEvent:function(ee){this.viewer&&this.viewer.raiseEvent("constrain",{immediately:ee})},applyConstraints:function(ee){var ue=this.getZoom(),pe=this._applyZoomConstraints(ue);ue!==pe&&this.zoomTo(pe,this.zoomPoint,ee);var _e=this.getBoundsNoRotate(),Ne=this._applyBoundaryConstraints(_e);return this._raiseConstraintsEvent(ee),(_e.x!==Ne.x||_e.y!==Ne.y||ee)&&this.fitBounds(Ne.rotate(-this.getRotation()),ee),this},ensureVisible:function(ee){return this.applyConstraints(ee)},_fitBounds:function(ee,ue){ue=ue||{};var pe=ue.immediately||!1,_e=ue.constraints||!1,Ne=this.getAspectRatio(),Ue=ee.getCenter(),Ge=new fe.Rect(ee.x,ee.y,ee.width,ee.height,ee.degrees+this.getRotation()).getBoundingBox();Ge.getAspectRatio()>=Ne?Ge.height=Ge.width/Ne:Ge.width=Ge.height*Ne,Ge.x=Ue.x-Ge.width/2,Ge.y=Ue.y-Ge.height/2;var qe=1/Ge.width;if(_e){var Ke=Ge.getAspectRatio(),Ye=this._applyZoomConstraints(qe);qe!==Ye&&(qe=Ye,Ge.width=1/qe,Ge.x=Ue.x-Ge.width/2,Ge.height=Ge.width/Ke,Ge.y=Ue.y-Ge.height/2),Ge=this._applyBoundaryConstraints(Ge),Ue=Ge.getCenter(),this._raiseConstraintsEvent(pe)}if(pe)return this.panTo(Ue,!0),this.zoomTo(qe,null,!0);this.panTo(this.getCenter(!0),!0),this.zoomTo(this.getZoom(!0),null,!0);var Ze=this.getBounds(),Xe=this.getZoom();if(Xe===0||Math.abs(qe/Xe-1)<1e-8)return this.zoomTo(qe,!0),this.panTo(Ue,pe);Ge=Ge.rotate(-this.getRotation());var Je=Ge.getTopLeft().times(qe).minus(Ze.getTopLeft().times(Xe)).divide(qe-Xe);return this.zoomTo(qe,Je,pe)},fitBounds:function(ee,ue){return this._fitBounds(ee,{immediately:ue,constraints:!1})},fitBoundsWithConstraints:function(ee,ue){return this._fitBounds(ee,{immediately:ue,constraints:!0})},fitVertically:function(ee){var ue=new fe.Rect(this._contentBounds.x+this._contentBounds.width/2,this._contentBounds.y,0,this._contentBounds.height);return this.fitBounds(ue,ee)},fitHorizontally:function(ee){var ue=new fe.Rect(this._contentBounds.x,this._contentBounds.y+this._contentBounds.height/2,this._contentBounds.width,0);return this.fitBounds(ue,ee)},getConstrainedBounds:function(ee){var ue,pe;return ue=this.getBounds(ee),pe=this._applyBoundaryConstraints(ue),pe},panBy:function(ee,ue){var pe=new fe.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return this.panTo(pe.plus(ee),ue)},panTo:function(ee,ue){return ue?(this.centerSpringX.resetTo(ee.x),this.centerSpringY.resetTo(ee.y)):(this.centerSpringX.springTo(ee.x),this.centerSpringY.springTo(ee.y)),this.viewer&&this.viewer.raiseEvent("pan",{center:ee,immediately:ue}),this},zoomBy:function(ee,ue,pe){return this.zoomTo(this.zoomSpring.target.value*ee,ue,pe)},zoomTo:function(ee,ue,pe){var _e=this;return this.zoomPoint=ue instanceof fe.Point&&!isNaN(ue.x)&&!isNaN(ue.y)?ue:null,pe?this._adjustCenterSpringsForZoomPoint(function(){_e.zoomSpring.resetTo(ee)}):this.zoomSpring.springTo(ee),this.viewer&&this.viewer.raiseEvent("zoom",{zoom:ee,refPoint:ue,immediately:pe}),this},setRotation:function(ee){return!this.viewer||!this.viewer.drawer.canRotate()?this:(this.degrees=fe.positiveModulo(ee,360),this._setContentBounds(this.viewer.world.getHomeBounds(),this.viewer.world.getContentFactor()),this.viewer.forceRedraw(),this.viewer.raiseEvent("rotate",{degrees:ee}),this)},getRotation:function(){return this.degrees},resize:function(ee,ue){var pe=this.getBoundsNoRotate(),_e=pe,Ne;return this.containerSize.x=ee.x,this.containerSize.y=ee.y,this._updateContainerInnerSize(),ue&&(Ne=ee.x/this.containerSize.x,_e.width=pe.width*Ne,_e.height=_e.width/this.getAspectRatio()),this.viewer&&this.viewer.raiseEvent("resize",{newContainerSize:ee,maintain:ue}),this.fitBounds(_e,!0)},_updateContainerInnerSize:function(){this._containerInnerSize=new fe.Point(Math.max(1,this.containerSize.x-(this._margins.left+this._margins.right)),Math.max(1,this.containerSize.y-(this._margins.top+this._margins.bottom)))},update:function(){var ee=this;this._adjustCenterSpringsForZoomPoint(function(){ee.zoomSpring.update()}),this.centerSpringX.update(),this.centerSpringY.update();var ue=this.centerSpringX.current.value!==this._oldCenterX||this.centerSpringY.current.value!==this._oldCenterY||this.zoomSpring.current.value!==this._oldZoom;return this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,ue},_adjustCenterSpringsForZoomPoint:function(ee){if(this.zoomPoint){var ue=this.pixelFromPoint(this.zoomPoint,!0);ee();var pe=this.pixelFromPoint(this.zoomPoint,!0),_e=pe.minus(ue),Ne=this.deltaPointsFromPixels(_e,!0);this.centerSpringX.shiftBy(Ne.x),this.centerSpringY.shiftBy(Ne.y),this.zoomSpring.isAtTargetValue()&&(this.zoomPoint=null)}else ee()},deltaPixelsFromPointsNoRotate:function(ee,ue){return ee.times(this._containerInnerSize.x*this.getZoom(ue))},deltaPixelsFromPoints:function(ee,ue){return this.deltaPixelsFromPointsNoRotate(ee.rotate(this.getRotation()),ue)},deltaPointsFromPixelsNoRotate:function(ee,ue){return ee.divide(this._containerInnerSize.x*this.getZoom(ue))},deltaPointsFromPixels:function(ee,ue){return this.deltaPointsFromPixelsNoRotate(ee,ue).rotate(-this.getRotation())},pixelFromPointNoRotate:function(ee,ue){return this._pixelFromPointNoRotate(ee,this.getBoundsNoRotate(ue))},pixelFromPoint:function(ee,ue){return this._pixelFromPoint(ee,this.getBoundsNoRotate(ue))},_pixelFromPointNoRotate:function(ee,ue){return ee.minus(ue.getTopLeft()).times(this._containerInnerSize.x/ue.width).plus(new fe.Point(this._margins.left,this._margins.top))},_pixelFromPoint:function(ee,ue){return this._pixelFromPointNoRotate(ee.rotate(this.getRotation(),this.getCenter(!0)),ue)},pointFromPixelNoRotate:function(ee,ue){var pe=this.getBoundsNoRotate(ue);return ee.minus(new fe.Point(this._margins.left,this._margins.top)).divide(this._containerInnerSize.x/pe.width).plus(pe.getTopLeft())},pointFromPixel:function(ee,ue){return this.pointFromPixelNoRotate(ee,ue).rotate(-this.getRotation(),this.getCenter(!0))},_viewportToImageDelta:function(ee,ue){var pe=this._contentBoundsNoRotate.width;return new fe.Point(ee*this._contentSizeNoRotate.x/pe,ue*this._contentSizeNoRotate.x/pe)},viewportToImageCoordinates:function(ee,ue){if(ee instanceof fe.Point)return this.viewportToImageCoordinates(ee.x,ee.y);if(this.viewer){var pe=this.viewer.world.getItemCount();if(pe>1)fe.console.error("[Viewport.viewportToImageCoordinates] is not accurate with multi-image; use TiledImage.viewportToImageCoordinates instead.");else if(pe===1){var _e=this.viewer.world.getItemAt(0);return _e.viewportToImageCoordinates(ee,ue,!0)}}return this._viewportToImageDelta(ee-this._contentBoundsNoRotate.x,ue-this._contentBoundsNoRotate.y)},_imageToViewportDelta:function(ee,ue){var pe=this._contentBoundsNoRotate.width;return new fe.Point(ee/this._contentSizeNoRotate.x*pe,ue/this._contentSizeNoRotate.x*pe)},imageToViewportCoordinates:function(ee,ue){if(ee instanceof fe.Point)return this.imageToViewportCoordinates(ee.x,ee.y);if(this.viewer){var pe=this.viewer.world.getItemCount();if(pe>1)fe.console.error("[Viewport.imageToViewportCoordinates] is not accurate with multi-image; use TiledImage.imageToViewportCoordinates instead.");else if(pe===1){var _e=this.viewer.world.getItemAt(0);return _e.imageToViewportCoordinates(ee,ue,!0)}}var Ne=this._imageToViewportDelta(ee,ue);return Ne.x+=this._contentBoundsNoRotate.x,Ne.y+=this._contentBoundsNoRotate.y,Ne},imageToViewportRectangle:function(ee,ue,pe,_e){var Ne=ee;if(Ne instanceof fe.Rect||(Ne=new fe.Rect(ee,ue,pe,_e)),this.viewer){var Ue=this.viewer.world.getItemCount();if(Ue>1)fe.console.error("[Viewport.imageToViewportRectangle] is not accurate with multi-image; use TiledImage.imageToViewportRectangle instead.");else if(Ue===1){var Ge=this.viewer.world.getItemAt(0);return Ge.imageToViewportRectangle(ee,ue,pe,_e,!0)}}var qe=this.imageToViewportCoordinates(Ne.x,Ne.y),Ke=this._imageToViewportDelta(Ne.width,Ne.height);return new fe.Rect(qe.x,qe.y,Ke.x,Ke.y,Ne.degrees)},viewportToImageRectangle:function(ee,ue,pe,_e){var Ne=ee;if(Ne instanceof fe.Rect||(Ne=new fe.Rect(ee,ue,pe,_e)),this.viewer){var Ue=this.viewer.world.getItemCount();if(Ue>1)fe.console.error("[Viewport.viewportToImageRectangle] is not accurate with multi-image; use TiledImage.viewportToImageRectangle instead.");else if(Ue===1){var Ge=this.viewer.world.getItemAt(0);return Ge.viewportToImageRectangle(ee,ue,pe,_e,!0)}}var qe=this.viewportToImageCoordinates(Ne.x,Ne.y),Ke=this._viewportToImageDelta(Ne.width,Ne.height);return new fe.Rect(qe.x,qe.y,Ke.x,Ke.y,Ne.degrees)},viewerElementToImageCoordinates:function(ee){var ue=this.pointFromPixel(ee,!0);return this.viewportToImageCoordinates(ue)},imageToViewerElementCoordinates:function(ee){var ue=this.imageToViewportCoordinates(ee);return this.pixelFromPoint(ue,!0)},windowToImageCoordinates:function(ee){fe.console.assert(this.viewer,"[Viewport.windowToImageCoordinates] the viewport must have a viewer.");var ue=ee.minus(fe.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(ue)},imageToWindowCoordinates:function(ee){fe.console.assert(this.viewer,"[Viewport.imageToWindowCoordinates] the viewport must have a viewer.");var ue=this.imageToViewerElementCoordinates(ee);return ue.plus(fe.getElementPosition(this.viewer.element))},viewerElementToViewportCoordinates:function(ee){return this.pointFromPixel(ee,!0)},viewportToViewerElementCoordinates:function(ee){return this.pixelFromPoint(ee,!0)},viewerElementToViewportRectangle:function(ee){return fe.Rect.fromSummits(this.pointFromPixel(ee.getTopLeft(),!0),this.pointFromPixel(ee.getTopRight(),!0),this.pointFromPixel(ee.getBottomLeft(),!0))},viewportToViewerElementRectangle:function(ee){return fe.Rect.fromSummits(this.pixelFromPoint(ee.getTopLeft(),!0),this.pixelFromPoint(ee.getTopRight(),!0),this.pixelFromPoint(ee.getBottomLeft(),!0))},windowToViewportCoordinates:function(ee){fe.console.assert(this.viewer,"[Viewport.windowToViewportCoordinates] the viewport must have a viewer.");var ue=ee.minus(fe.getElementPosition(this.viewer.element));return this.viewerElementToViewportCoordinates(ue)},viewportToWindowCoordinates:function(ee){fe.console.assert(this.viewer,"[Viewport.viewportToWindowCoordinates] the viewport must have a viewer.");var ue=this.viewportToViewerElementCoordinates(ee);return ue.plus(fe.getElementPosition(this.viewer.element))},viewportToImageZoom:function(ee){if(this.viewer){var ue=this.viewer.world.getItemCount();if(ue>1)fe.console.error("[Viewport.viewportToImageZoom] is not accurate with multi-image.");else if(ue===1){var pe=this.viewer.world.getItemAt(0);return pe.viewportToImageZoom(ee)}}var _e=this._contentSizeNoRotate.x,Ne=this._containerInnerSize.x,Ue=this._contentBoundsNoRotate.width,Ge=Ne/_e*Ue;return ee*Ge},imageToViewportZoom:function(ee){if(this.viewer){var ue=this.viewer.world.getItemCount();if(ue>1)fe.console.error("[Viewport.imageToViewportZoom] is not accurate with multi-image.");else if(ue===1){var pe=this.viewer.world.getItemAt(0);return pe.imageToViewportZoom(ee)}}var _e=this._contentSizeNoRotate.x,Ne=this._containerInnerSize.x,Ue=this._contentBoundsNoRotate.width,Ge=_e/Ne/Ue;return ee*Ge},toggleFlip:function(){return this.setFlip(!this.getFlip()),this},getFlip:function(){return this.flipped},setFlip:function(ee){return this.flipped===ee?this:(this.flipped=ee,this.viewer.navigator&&this.viewer.navigator.setFlip(this.getFlip()),this.viewer.forceRedraw(),this.viewer.raiseEvent("flip",{flipped:ee}),this)}}}(OpenSeadragon),function(fe){fe.TiledImage=function(et){var it=this;fe.console.assert(et.tileCache,"[TiledImage] options.tileCache is required"),fe.console.assert(et.drawer,"[TiledImage] options.drawer is required"),fe.console.assert(et.viewer,"[TiledImage] options.viewer is required"),fe.console.assert(et.imageLoader,"[TiledImage] options.imageLoader is required"),fe.console.assert(et.source,"[TiledImage] options.source is required"),fe.console.assert(!et.clip||et.clip instanceof fe.Rect,"[TiledImage] options.clip must be an OpenSeadragon.Rect if present"),fe.EventSource.call(this),this._tileCache=et.tileCache,delete et.tileCache,this._drawer=et.drawer,delete et.drawer,this._imageLoader=et.imageLoader,delete et.imageLoader,et.clip instanceof fe.Rect&&(this._clip=et.clip.clone()),delete et.clip;var nt=et.x||0;delete et.x;var st=et.y||0;delete et.y,this.normHeight=et.source.dimensions.y/et.source.dimensions.x,this.contentAspectX=et.source.dimensions.x/et.source.dimensions.y;var lt=1;et.width?(lt=et.width,delete et.width,et.height&&(fe.console.error("specifying both width and height to a tiledImage is not supported"),delete et.height)):et.height&&(lt=et.height/this.normHeight,delete et.height);var _r=et.fitBounds;delete et.fitBounds;var jr=et.fitBoundsPlacement||OpenSeadragon.Placement.CENTER;delete et.fitBoundsPlacement;var Nr=et.degrees||0;delete et.degrees,fe.extend(!0,this,{viewer:null,tilesMatrix:{},coverage:{},loadingCoverage:{},lastDrawn:[],lastResetTime:0,_midDraw:!1,_needsDraw:!0,_hasOpaqueTile:!1,_tilesLoading:0,springStiffness:fe.DEFAULT_SETTINGS.springStiffness,animationTime:fe.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:fe.DEFAULT_SETTINGS.minZoomImageRatio,wrapHorizontal:fe.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:fe.DEFAULT_SETTINGS.wrapVertical,immediateRender:fe.DEFAULT_SETTINGS.immediateRender,blendTime:fe.DEFAULT_SETTINGS.blendTime,alwaysBlend:fe.DEFAULT_SETTINGS.alwaysBlend,minPixelRatio:fe.DEFAULT_SETTINGS.minPixelRatio,smoothTileEdgesMinZoom:fe.DEFAULT_SETTINGS.smoothTileEdgesMinZoom,iOSDevice:fe.DEFAULT_SETTINGS.iOSDevice,debugMode:fe.DEFAULT_SETTINGS.debugMode,crossOriginPolicy:fe.DEFAULT_SETTINGS.crossOriginPolicy,ajaxWithCredentials:fe.DEFAULT_SETTINGS.ajaxWithCredentials,placeholderFillStyle:fe.DEFAULT_SETTINGS.placeholderFillStyle,opacity:fe.DEFAULT_SETTINGS.opacity,preload:fe.DEFAULT_SETTINGS.preload,compositeOperation:fe.DEFAULT_SETTINGS.compositeOperation},et),this._preload=this.preload,delete this.preload,this._fullyLoaded=!1,this._xSpring=new fe.Spring({initial:nt,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._ySpring=new fe.Spring({initial:st,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._scaleSpring=new fe.Spring({initial:lt,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._degreesSpring=new fe.Spring({initial:Nr,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._updateForScale(),_r&&this.fitBounds(_r,jr,!0),this._drawingHandler=function(Wr){it.viewer.raiseEvent("tile-drawing",fe.extend({tiledImage:it},Wr))}},fe.extend(fe.TiledImage.prototype,fe.EventSource.prototype,{needsDraw:function(){return this._needsDraw},getFullyLoaded:function(){return this._fullyLoaded},_setFullyLoaded:function(et){et!==this._fullyLoaded&&(this._fullyLoaded=et,this.raiseEvent("fully-loaded-change",{fullyLoaded:this._fullyLoaded}))},reset:function(){this._tileCache.clearTilesFor(this),this.lastResetTime=fe.now(),this._needsDraw=!0},update:function(){var et=this._xSpring.update(),it=this._ySpring.update(),nt=this._scaleSpring.update(),st=this._degreesSpring.update();return et||it||nt||st?(this._updateForScale(),this._needsDraw=!0,!0):!1},draw:function(){this.opacity!==0||this._preload?(this._midDraw=!0,this._updateViewport(),this._midDraw=!1):this._needsDraw=!1},destroy:function(){this.reset()},getBounds:function(et){return this.getBoundsNoRotate(et).rotate(this.getRotation(et),this._getRotationPoint(et))},getBoundsNoRotate:function(et){return et?new fe.Rect(this._xSpring.current.value,this._ySpring.current.value,this._worldWidthCurrent,this._worldHeightCurrent):new fe.Rect(this._xSpring.target.value,this._ySpring.target.value,this._worldWidthTarget,this._worldHeightTarget)},getWorldBounds:function(){return fe.console.error("[TiledImage.getWorldBounds] is deprecated; use TiledImage.getBounds instead"),this.getBounds()},getClippedBounds:function(et){var it=this.getBoundsNoRotate(et);if(this._clip){var nt=et?this._worldWidthCurrent:this._worldWidthTarget,st=nt/this.source.dimensions.x,lt=this._clip.times(st);it=new fe.Rect(it.x+lt.x,it.y+lt.y,lt.width,lt.height)}return it.rotate(this.getRotation(et),this._getRotationPoint(et))},getContentSize:function(){return new fe.Point(this.source.dimensions.x,this.source.dimensions.y)},_viewportToImageDelta:function(et,it,nt){var st=nt?this._scaleSpring.current.value:this._scaleSpring.target.value;return new fe.Point(et*(this.source.dimensions.x/st),it*(this.source.dimensions.y*this.contentAspectX/st))},viewportToImageCoordinates:function(et,it,nt){var st;return et instanceof fe.Point?(nt=it,st=et):st=new fe.Point(et,it),st=st.rotate(-this.getRotation(nt),this._getRotationPoint(nt)),nt?this._viewportToImageDelta(st.x-this._xSpring.current.value,st.y-this._ySpring.current.value):this._viewportToImageDelta(st.x-this._xSpring.target.value,st.y-this._ySpring.target.value)},_imageToViewportDelta:function(et,it,nt){var st=nt?this._scaleSpring.current.value:this._scaleSpring.target.value;return new fe.Point(et/this.source.dimensions.x*st,it/this.source.dimensions.y/this.contentAspectX*st)},imageToViewportCoordinates:function(et,it,nt){et instanceof fe.Point&&(nt=it,it=et.y,et=et.x);var st=this._imageToViewportDelta(et,it);return nt?(st.x+=this._xSpring.current.value,st.y+=this._ySpring.current.value):(st.x+=this._xSpring.target.value,st.y+=this._ySpring.target.value),st.rotate(this.getRotation(nt),this._getRotationPoint(nt))},imageToViewportRectangle:function(et,it,nt,st,lt){var _r=et;_r instanceof fe.Rect?lt=it:_r=new fe.Rect(et,it,nt,st);var jr=this.imageToViewportCoordinates(_r.getTopLeft(),lt),Nr=this._imageToViewportDelta(_r.width,_r.height,lt);return new fe.Rect(jr.x,jr.y,Nr.x,Nr.y,_r.degrees+this.getRotation(lt))},viewportToImageRectangle:function(et,it,nt,st,lt){var _r=et;et instanceof fe.Rect?lt=it:_r=new fe.Rect(et,it,nt,st);var jr=this.viewportToImageCoordinates(_r.getTopLeft(),lt),Nr=this._viewportToImageDelta(_r.width,_r.height,lt);return new fe.Rect(jr.x,jr.y,Nr.x,Nr.y,_r.degrees-this.getRotation(lt))},viewerElementToImageCoordinates:function(et){var it=this.viewport.pointFromPixel(et,!0);return this.viewportToImageCoordinates(it)},imageToViewerElementCoordinates:function(et){var it=this.imageToViewportCoordinates(et);return this.viewport.pixelFromPoint(it,!0)},windowToImageCoordinates:function(et){var it=et.minus(OpenSeadragon.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(it)},imageToWindowCoordinates:function(et){var it=this.imageToViewerElementCoordinates(et);return it.plus(OpenSeadragon.getElementPosition(this.viewer.element))},_viewportToTiledImageRectangle:function(et){var it=this._scaleSpring.current.value;return et=et.rotate(-this.getRotation(!0),this._getRotationPoint(!0)),new fe.Rect((et.x-this._xSpring.current.value)/it,(et.y-this._ySpring.current.value)/it,et.width/it,et.height/it,et.degrees)},viewportToImageZoom:function(et){var it=this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x;return it*et},imageToViewportZoom:function(et){var it=this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x;return et/it},setPosition:function(et,it){var nt=this._xSpring.target.value===et.x&&this._ySpring.target.value===et.y;if(it){if(nt&&this._xSpring.current.value===et.x&&this._ySpring.current.value===et.y)return;this._xSpring.resetTo(et.x),this._ySpring.resetTo(et.y),this._needsDraw=!0}else{if(nt)return;this._xSpring.springTo(et.x),this._ySpring.springTo(et.y),this._needsDraw=!0}nt||this._raiseBoundsChange()},setWidth:function(et,it){this._setScale(et,it)},setHeight:function(et,it){this._setScale(et/this.normHeight,it)},setCroppingPolygons:function(et){var it=function(st){return st instanceof fe.Point||typeof st.x=="number"&&typeof st.y=="number"},nt=function(st){return st.map(function(lt){try{if(it(lt))return{x:lt.x,y:lt.y};throw new Error}catch{throw new Error("A Provided cropping polygon point is not supported")}})};try{if(!fe.isArray(et))throw new Error("Provided cropping polygon is not an array");this._croppingPolygons=et.map(function(st){return nt(st)})}catch(st){fe.console.error("[TiledImage.setCroppingPolygons] Cropping polygon format not supported"),fe.console.error(st),this._croppingPolygons=null}},resetCroppingPolygons:function(){this._croppingPolygons=null},fitBounds:function(et,it,nt){it=it||fe.Placement.CENTER;var st=fe.Placement.properties[it],lt=this.contentAspectX,_r=0,jr=0,Nr=1,Wr=1;if(this._clip&&(lt=this._clip.getAspectRatio(),Nr=this._clip.width/this.source.dimensions.x,Wr=this._clip.height/this.source.dimensions.y,et.getAspectRatio()>lt?(_r=this._clip.x/this._clip.height*et.height,jr=this._clip.y/this._clip.height*et.height):(_r=this._clip.x/this._clip.width*et.width,jr=this._clip.y/this._clip.width*et.width)),et.getAspectRatio()>lt){var ri=et.height/Wr,Xr=0;st.isHorizontallyCentered?Xr=(et.width-et.height*lt)/2:st.isRight&&(Xr=et.width-et.height*lt),this.setPosition(new fe.Point(et.x-_r+Xr,et.y-jr),nt),this.setHeight(ri,nt)}else{var Gr=et.width/Nr,qr=0;st.isVerticallyCentered?qr=(et.height-et.width/lt)/2:st.isBottom&&(qr=et.height-et.width/lt),this.setPosition(new fe.Point(et.x-_r,et.y-jr+qr),nt),this.setWidth(Gr,nt)}},getClip:function(){return this._clip?this._clip.clone():null},setClip:function(et){fe.console.assert(!et||et instanceof fe.Rect,"[TiledImage.setClip] newClip must be an OpenSeadragon.Rect or null"),et instanceof fe.Rect?this._clip=et.clone():this._clip=null,this._needsDraw=!0,this.raiseEvent("clip-change")},getOpacity:function(){return this.opacity},setOpacity:function(et){et!==this.opacity&&(this.opacity=et,this._needsDraw=!0,this.raiseEvent("opacity-change",{opacity:this.opacity}))},getPreload:function(){return this._preload},setPreload:function(et){this._preload=!!et,this._needsDraw=!0},getRotation:function(et){return et?this._degreesSpring.current.value:this._degreesSpring.target.value},setRotation:function(et,it){this._degreesSpring.target.value===et&&this._degreesSpring.isAtTargetValue()||(it?this._degreesSpring.resetTo(et):this._degreesSpring.springTo(et),this._needsDraw=!0,this._raiseBoundsChange())},_getRotationPoint:function(et){return this.getBoundsNoRotate(et).getCenter()},getCompositeOperation:function(){return this.compositeOperation},setCompositeOperation:function(et){et!==this.compositeOperation&&(this.compositeOperation=et,this._needsDraw=!0,this.raiseEvent("composite-operation-change",{compositeOperation:this.compositeOperation}))},_setScale:function(et,it){var nt=this._scaleSpring.target.value===et;if(it){if(nt&&this._scaleSpring.current.value===et)return;this._scaleSpring.resetTo(et),this._updateForScale(),this._needsDraw=!0}else{if(nt)return;this._scaleSpring.springTo(et),this._updateForScale(),this._needsDraw=!0}nt||this._raiseBoundsChange()},_updateForScale:function(){this._worldWidthTarget=this._scaleSpring.target.value,this._worldHeightTarget=this.normHeight*this._scaleSpring.target.value,this._worldWidthCurrent=this._scaleSpring.current.value,this._worldHeightCurrent=this.normHeight*this._scaleSpring.current.value},_raiseBoundsChange:function(){this.raiseEvent("bounds-change")},_isBottomItem:function(){return this.viewer.world.getItemAt(0)===this},_getLevelsInterval:function(){var et=Math.max(this.source.minLevel,Math.floor(Math.log(this.minZoomImageRatio)/Math.log(2))),it=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(0),!0).x*this._scaleSpring.current.value,nt=Math.min(Math.abs(this.source.maxLevel),Math.abs(Math.floor(Math.log(it/this.minPixelRatio)/Math.log(2))));return nt=Math.max(nt,this.source.minLevel||0),et=Math.min(et,nt),{lowestLevel:et,highestLevel:nt}},_updateViewport:function(){for(this._needsDraw=!1,this._tilesLoading=0,this.loadingCoverage={};this.lastDrawn.length>0;){var et=this.lastDrawn.pop();et.beingDrawn=!1}var it=this.viewport,nt=this._viewportToTiledImageRectangle(it.getBoundsWithMargins(!0));if(!this.wrapHorizontal&&!this.wrapVertical){var st=this._viewportToTiledImageRectangle(this.getClippedBounds(!0));if(nt=nt.intersection(st),nt===null)return}for(var lt=this._getLevelsInterval(),_r=lt.lowestLevel,jr=lt.highestLevel,Nr=null,Wr=!1,ri=fe.now(),Xr=jr;Xr>=_r;Xr--){var Gr=!1,qr=it.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(Xr),!0).x*this._scaleSpring.current.value;if(Xr===_r||!Wr&&qr>=this.minPixelRatio)Gr=!0,Wr=!0;else if(!Wr)continue;var si=it.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(Xr),!1).x*this._scaleSpring.current.value,oi=it.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(Math.max(this.source.getClosestLevel(),0)),!1).x*this._scaleSpring.current.value,Yr=this.immediateRender?1:oi,ii=Math.min(1,(qr-.5)/.5),ti=Yr/Math.abs(Yr-si);if(Nr=ee(this,Wr,Gr,Xr,ii,ti,nt,ri,Nr),Ke(this.coverage,Xr))break}tt(this,this.lastDrawn),Nr&&!Nr.context2D?(_e(this,Nr,ri),this._needsDraw=!0,this._setFullyLoaded(!1)):this._setFullyLoaded(this._tilesLoading===0)},_getCornerTiles:function(et,it,nt){var st,lt;this.wrapHorizontal?(st=fe.positiveModulo(it.x,1),lt=fe.positiveModulo(nt.x,1)):(st=Math.max(0,it.x),lt=Math.min(1,nt.x));var _r,jr,Nr=1/this.source.aspectRatio;this.wrapVertical?(_r=fe.positiveModulo(it.y,Nr),jr=fe.positiveModulo(nt.y,Nr)):(_r=Math.max(0,it.y),jr=Math.min(Nr,nt.y));var Wr=this.source.getTileAtPoint(et,new fe.Point(st,_r)),ri=this.source.getTileAtPoint(et,new fe.Point(lt,jr)),Xr=this.source.getNumTiles(et);return this.wrapHorizontal&&(Wr.x+=Xr.x*Math.floor(it.x),ri.x+=Xr.x*Math.floor(nt.x)),this.wrapVertical&&(Wr.y+=Xr.y*Math.floor(it.y/Nr),ri.y+=Xr.y*Math.floor(nt.y/Nr)),{topLeft:Wr,bottomRight:ri}}});function ee(et,it,nt,st,lt,_r,jr,Nr,Wr){var ri=jr.getBoundingBox().getTopLeft(),Xr=jr.getBoundingBox().getBottomRight();et.viewer&&et.viewer.raiseEvent("update-level",{tiledImage:et,havedrawn:it,level:st,opacity:lt,visibility:_r,drawArea:jr,topleft:ri,bottomright:Xr,currenttime:Nr,best:Wr}),Xe(et.coverage,st),Xe(et.loadingCoverage,st);for(var Gr=et._getCornerTiles(st,ri,Xr),qr=Gr.topLeft,si=Gr.bottomRight,oi=et.source.getNumTiles(st),Yr=et.viewport.pixelFromPoint(et.viewport.getCenter()),ii=qr.x;ii<=si.x;ii++)for(var ti=qr.y;ti<=si.y;ti++){if(!et.wrapHorizontal&&!et.wrapVertical){var ni=et.source.getTileBounds(st,ii,ti);if(jr.intersection(ni)===null)continue}Wr=ue(et,nt,it,ii,ti,st,lt,_r,Yr,oi,Nr,Wr)}return Wr}function ue(et,it,nt,st,lt,_r,jr,Nr,Wr,ri,Xr,Gr){var qr=pe(st,lt,_r,et,et.source,et.tilesMatrix,Xr,ri,et._worldWidthCurrent,et._worldHeightCurrent),si=nt;et.viewer&&et.viewer.raiseEvent("update-tile",{tiledImage:et,tile:qr}),Ze(et.coverage,_r,st,lt,!1);var oi=qr.loaded||qr.loading||Ye(et.loadingCoverage,_r,st,lt);if(Ze(et.loadingCoverage,_r,st,lt,oi),!qr.exists||(it&&!si&&(Ye(et.coverage,_r,st,lt)?Ze(et.coverage,_r,st,lt,!0):si=!0),!si))return Gr;if(Ge(qr,et.source.tileOverlap,et.viewport,Wr,Nr,et),!qr.loaded)if(qr.context2D)Ue(et,qr);else{var Yr=et._tileCache.getImageRecord(qr.cacheKey);if(Yr){var ii=Yr.getImage();Ue(et,qr,ii)}}if(qr.loaded){var ti=qe(et,qr,st,lt,_r,jr,Xr);ti&&(et._needsDraw=!0)}else qr.loading?et._tilesLoading++:oi||(Gr=Je(Gr,qr));return Gr}function pe(et,it,nt,st,lt,_r,jr,Nr,Wr,ri){var Xr,Gr,qr,si,oi,Yr,ii,ti,ni;return _r[nt]||(_r[nt]={}),_r[nt][et]||(_r[nt][et]={}),_r[nt][et][it]||(Xr=(Nr.x+et%Nr.x)%Nr.x,Gr=(Nr.y+it%Nr.y)%Nr.y,qr=lt.getTileBounds(nt,Xr,Gr),si=lt.getTileBounds(nt,Xr,Gr,!0),oi=lt.tileExists(nt,Xr,Gr),Yr=lt.getTileUrl(nt,Xr,Gr),st.loadTilesWithAjax?(ii=lt.getTileAjaxHeaders(nt,Xr,Gr),fe.isPlainObject(st.ajaxHeaders)&&(ii=fe.extend({},st.ajaxHeaders,ii))):ii=null,ti=lt.getContext2D?lt.getContext2D(nt,Xr,Gr):void 0,qr.x+=(et-Xr)/Nr.x,qr.y+=ri/Wr*((it-Gr)/Nr.y),ni=new fe.Tile(nt,et,it,qr,oi,Yr,ti,st.loadTilesWithAjax,ii,si),Xr===Nr.x-1&&(ni.isRightMost=!0),Gr===Nr.y-1&&(ni.isBottomMost=!0),_r[nt][et][it]=ni),ni=_r[nt][et][it],ni.lastTouchTime=jr,ni}function _e(et,it,nt){it.loading=!0,et._imageLoader.addJob({src:it.url,loadWithAjax:it.loadWithAjax,ajaxHeaders:it.ajaxHeaders,crossOriginPolicy:et.crossOriginPolicy,ajaxWithCredentials:et.ajaxWithCredentials,callback:function(st,lt,_r){Ne(et,it,nt,st,lt,_r)},abort:function(){it.loading=!1}})}function Ne(et,it,nt,st,lt,_r){if(!st){fe.console.log("Tile %s failed to load: %s - error: %s",it,it.url,lt),et.viewer.raiseEvent("tile-load-failed",{tile:it,tiledImage:et,time:nt,message:lt,tileRequest:_r}),it.loading=!1,it.exists=!1;return}if(nt<et.lastResetTime){fe.console.log("Ignoring tile %s loaded before reset: %s",it,it.url),it.loading=!1;return}var jr=function(){var Nr=et.source.getClosestLevel();Ue(et,it,st,Nr,_r)};et._midDraw?window.setTimeout(jr,1):jr()}function Ue(et,it,nt,st,lt){var _r=0;function jr(){return _r++,Nr}function Nr(){_r--,_r===0&&(it.loading=!1,it.loaded=!0,it.context2D||et._tileCache.cacheTile({image:nt,tile:it,cutoff:st,tiledImage:et}),et._needsDraw=!0)}et.viewer.raiseEvent("tile-loaded",{tile:it,tiledImage:et,tileRequest:lt,image:nt,getCompletionCallback:jr}),jr()()}function Ge(et,it,nt,st,lt,_r){var jr=et.bounds.getTopLeft();jr.x*=_r._scaleSpring.current.value,jr.y*=_r._scaleSpring.current.value,jr.x+=_r._xSpring.current.value,jr.y+=_r._ySpring.current.value;var Nr=et.bounds.getSize();Nr.x*=_r._scaleSpring.current.value,Nr.y*=_r._scaleSpring.current.value;var Wr=nt.pixelFromPointNoRotate(jr,!0),ri=nt.pixelFromPointNoRotate(jr,!1),Xr=nt.deltaPixelsFromPointsNoRotate(Nr,!0),Gr=nt.deltaPixelsFromPointsNoRotate(Nr,!1),qr=ri.plus(Gr.divide(2)),si=st.squaredDistanceTo(qr);it||(Xr=Xr.plus(new fe.Point(1,1))),et.isRightMost&&_r.wrapHorizontal&&(Xr.x+=.75),et.isBottomMost&&_r.wrapVertical&&(Xr.y+=.75),et.position=Wr,et.size=Xr,et.squaredDistance=si,et.visibility=lt}function qe(et,it,nt,st,lt,_r,jr){var Nr=1e3*et.blendTime,Wr,ri;if(it.blendStart||(it.blendStart=jr),Wr=jr-it.blendStart,ri=Nr?Math.min(1,Wr/Nr):1,et.alwaysBlend&&(ri*=_r),it.opacity=ri,et.lastDrawn.push(it),ri===1)Ze(et.coverage,lt,nt,st,!0),et._hasOpaqueTile=!0;else if(Wr<Nr)return!0;return!1}function Ke(et,it,nt,st){var lt,_r,jr,Nr;if(!et[it])return!1;if(nt===void 0||st===void 0){lt=et[it];for(jr in lt)if(Object.prototype.hasOwnProperty.call(lt,jr)){_r=lt[jr];for(Nr in _r)if(Object.prototype.hasOwnProperty.call(_r,Nr)&&!_r[Nr])return!1}return!0}return et[it][nt]===void 0||et[it][nt][st]===void 0||et[it][nt][st]===!0}function Ye(et,it,nt,st){return nt===void 0||st===void 0?Ke(et,it+1):Ke(et,it+1,2*nt,2*st)&&Ke(et,it+1,2*nt,2*st+1)&&Ke(et,it+1,2*nt+1,2*st)&&Ke(et,it+1,2*nt+1,2*st+1)}function Ze(et,it,nt,st,lt){if(!et[it]){fe.console.warn("Setting coverage for a tile before its level's coverage has been reset: %s",it);return}et[it][nt]||(et[it][nt]={}),et[it][nt][st]=lt}function Xe(et,it){et[it]={}}function Je(et,it){return!et||it.visibility>et.visibility||it.visibility==et.visibility&&it.squaredDistance<et.squaredDistance?it:et}function tt(et,it){if(!(et.opacity===0||it.length===0&&!et.placeholderFillStyle)){var nt=it[0],st;nt&&(st=et.opacity<1||et.compositeOperation&&et.compositeOperation!=="source-over"||!et._isBottomItem()&&nt._hasTransparencyChannel());var lt,_r,jr=et.viewport.getZoom(!0),Nr=et.viewportToImageZoom(jr);it.length>1&&Nr>et.smoothTileEdgesMinZoom&&!et.iOSDevice&&et.getRotation(!0)%360===0&&fe.supportsCanvas&&(st=!0,lt=nt.getScaleForEdgeSmoothing(),_r=nt.getTranslationForEdgeSmoothing(lt,et._drawer.getCanvasSize(!1),et._drawer.getCanvasSize(!0)));var Wr;st&&(lt||(Wr=et.viewport.viewportToViewerElementRectangle(et.getClippedBounds(!0)).getIntegerBoundingBox(),et._drawer.viewer.viewport.getFlip()&&(et.viewport.degrees!==0||et.getRotation(!0)%360!==0)&&(Wr.x=et._drawer.viewer.container.clientWidth-(Wr.x+Wr.width)),Wr=Wr.times(fe.pixelDensityRatio)),et._drawer._clear(!0,Wr)),lt||(et.viewport.degrees!==0&&et._drawer._offsetForRotation({degrees:et.viewport.degrees,useSketch:st}),et.getRotation(!0)%360!==0&&et._drawer._offsetForRotation({degrees:et.getRotation(!0),point:et.viewport.pixelFromPointNoRotate(et._getRotationPoint(!0),!0),useSketch:st}),et.viewport.degrees===0&&et.getRotation(!0)%360===0&&et._drawer.viewer.viewport.getFlip()&&et._drawer._flip());var ri=!1;if(et._clip){et._drawer.saveContext(st);var Xr=et.imageToViewportRectangle(et._clip,!0);Xr=Xr.rotate(-et.getRotation(!0),et._getRotationPoint(!0));var Gr=et._drawer.viewportToDrawerRectangle(Xr);lt&&(Gr=Gr.times(lt)),_r&&(Gr=Gr.translate(_r)),et._drawer.setClip(Gr,st),ri=!0}if(et._croppingPolygons){et._drawer.saveContext(st);try{var qr=et._croppingPolygons.map(function(ii){return ii.map(function(ti){var ni=et.imageToViewportCoordinates(ti.x,ti.y,!0).rotate(-et.getRotation(!0),et._getRotationPoint(!0)),ui=et._drawer.viewportCoordToDrawerCoord(ni);return lt&&(ui=ui.times(lt)),ui})});et._drawer.clipWithPolygons(qr,st)}catch(ii){fe.console.error(ii)}ri=!0}if(et.placeholderFillStyle&&et._hasOpaqueTile===!1){var si=et._drawer.viewportToDrawerRectangle(et.getBounds(!0));lt&&(si=si.times(lt)),_r&&(si=si.translate(_r));var oi=null;typeof et.placeholderFillStyle=="function"?oi=et.placeholderFillStyle(et,et._drawer.context):oi=et.placeholderFillStyle,et._drawer.drawRectangle(si,oi,st)}for(var Yr=it.length-1;Yr>=0;Yr--)nt=it[Yr],et._drawer.drawTile(nt,et._drawingHandler,st,lt,_r),nt.beingDrawn=!0,et.viewer&&et.viewer.raiseEvent("tile-drawn",{tiledImage:et,tile:nt});ri&&et._drawer.restoreContext(st),lt||(et.getRotation(!0)%360!==0&&et._drawer._restoreRotationChanges(st),et.viewport.degrees!==0&&et._drawer._restoreRotationChanges(st)),st&&(lt&&(et.viewport.degrees!==0&&et._drawer._offsetForRotation({degrees:et.viewport.degrees,useSketch:!1}),et.getRotation(!0)%360!==0&&et._drawer._offsetForRotation({degrees:et.getRotation(!0),point:et.viewport.pixelFromPointNoRotate(et._getRotationPoint(!0),!0),useSketch:!1})),et._drawer.blendSketch({opacity:et.opacity,scale:lt,translate:_r,compositeOperation:et.compositeOperation,bounds:Wr}),lt&&(et.getRotation(!0)%360!==0&&et._drawer._restoreRotationChanges(!1),et.viewport.degrees!==0&&et._drawer._restoreRotationChanges(!1))),lt||et.viewport.degrees===0&&et.getRotation(!0)%360===0&&et._drawer.viewer.viewport.getFlip()&&et._drawer._flip(),rt(et,it)}}function rt(et,it){if(et.debugMode)for(var nt=it.length-1;nt>=0;nt--){var st=it[nt];try{et._drawer.drawDebugInfo(st,it.length,nt,et)}catch(lt){fe.console.error(lt)}}}}(OpenSeadragon),function(fe){var ee=function(pe){fe.console.assert(pe,"[TileCache.cacheTile] options is required"),fe.console.assert(pe.tile,"[TileCache.cacheTile] options.tile is required"),fe.console.assert(pe.tiledImage,"[TileCache.cacheTile] options.tiledImage is required"),this.tile=pe.tile,this.tiledImage=pe.tiledImage},ue=function(pe){fe.console.assert(pe,"[ImageRecord] options is required"),fe.console.assert(pe.image,"[ImageRecord] options.image is required"),this._image=pe.image,this._tiles=[]};ue.prototype={destroy:function(){this._image=null,this._renderedContext=null,this._tiles=null},getImage:function(){return this._image},getRenderedContext:function(){if(!this._renderedContext){var pe=document.createElement("canvas");pe.width=this._image.width,pe.height=this._image.height,this._renderedContext=pe.getContext("2d"),this._renderedContext.drawImage(this._image,0,0),this._image=null}return this._renderedContext},setRenderedContext:function(pe){fe.console.error("ImageRecord.setRenderedContext is deprecated. The rendered context should be created by the ImageRecord itself when calling ImageRecord.getRenderedContext."),this._renderedContext=pe},addTile:function(pe){fe.console.assert(pe,"[ImageRecord.addTile] tile is required"),this._tiles.push(pe)},removeTile:function(pe){for(var _e=0;_e<this._tiles.length;_e++)if(this._tiles[_e]===pe){this._tiles.splice(_e,1);return}fe.console.warn("[ImageRecord.removeTile] trying to remove unknown tile",pe)},getTileCount:function(){return this._tiles.length}},fe.TileCache=function(pe){pe=pe||{},this._maxImageCacheCount=pe.maxImageCacheCount||fe.DEFAULT_SETTINGS.maxImageCacheCount,this._tilesLoaded=[],this._imagesLoaded=[],this._imagesLoadedCount=0},fe.TileCache.prototype={numTilesLoaded:function(){return this._tilesLoaded.length},cacheTile:function(pe){fe.console.assert(pe,"[TileCache.cacheTile] options is required"),fe.console.assert(pe.tile,"[TileCache.cacheTile] options.tile is required"),fe.console.assert(pe.tile.cacheKey,"[TileCache.cacheTile] options.tile.cacheKey is required"),fe.console.assert(pe.tiledImage,"[TileCache.cacheTile] options.tiledImage is required");var _e=pe.cutoff||0,Ne=this._tilesLoaded.length,Ue=this._imagesLoaded[pe.tile.cacheKey];if(Ue||(fe.console.assert(pe.image,"[TileCache.cacheTile] options.image is required to create an ImageRecord"),Ue=this._imagesLoaded[pe.tile.cacheKey]=new ue({image:pe.image}),this._imagesLoadedCount++),Ue.addTile(pe.tile),pe.tile.cacheImageRecord=Ue,this._imagesLoadedCount>this._maxImageCacheCount){for(var Ge=null,qe=-1,Ke=null,Ye,Ze,Xe,Je,tt,rt,et=this._tilesLoaded.length-1;et>=0;et--)if(rt=this._tilesLoaded[et],Ye=rt.tile,!(Ye.level<=_e||Ye.beingDrawn)){if(!Ge){Ge=Ye,qe=et,Ke=rt;continue}Je=Ye.lastTouchTime,Ze=Ge.lastTouchTime,tt=Ye.level,Xe=Ge.level,(Je<Ze||Je==Ze&&tt>Xe)&&(Ge=Ye,qe=et,Ke=rt)}Ge&&qe>=0&&(this._unloadTile(Ke),Ne=qe)}this._tilesLoaded[Ne]=new ee({tile:pe.tile,tiledImage:pe.tiledImage})},clearTilesFor:function(pe){fe.console.assert(pe,"[TileCache.clearTilesFor] tiledImage is required");for(var _e,Ne=0;Ne<this._tilesLoaded.length;++Ne)_e=this._tilesLoaded[Ne],_e.tiledImage===pe&&(this._unloadTile(_e),this._tilesLoaded.splice(Ne,1),Ne--)},getImageRecord:function(pe){return fe.console.assert(pe,"[TileCache.getImageRecord] cacheKey is required"),this._imagesLoaded[pe]},_unloadTile:function(pe){fe.console.assert(pe,"[TileCache._unloadTile] tileRecord is required");var _e=pe.tile,Ne=pe.tiledImage;_e.unload(),_e.cacheImageRecord=null;var Ue=this._imagesLoaded[_e.cacheKey];Ue.removeTile(_e),Ue.getTileCount()||(Ue.destroy(),delete this._imagesLoaded[_e.cacheKey],this._imagesLoadedCount--),Ne.viewer.raiseEvent("tile-unloaded",{tile:_e,tiledImage:Ne})}}}(OpenSeadragon),function(fe){fe.World=function(ee){var ue=this;fe.console.assert(ee.viewer,"[World] options.viewer is required"),fe.EventSource.call(this),this.viewer=ee.viewer,this._items=[],this._needsDraw=!1,this._autoRefigureSizes=!0,this._needsSizesFigured=!1,this._delegatedFigureSizes=function(pe){ue._autoRefigureSizes?ue._figureSizes():ue._needsSizesFigured=!0},this._figureSizes()},fe.extend(fe.World.prototype,fe.EventSource.prototype,{addItem:function(ee,ue){if(fe.console.assert(ee,"[World.addItem] item is required"),fe.console.assert(ee instanceof fe.TiledImage,"[World.addItem] only TiledImages supported at this time"),ue=ue||{},ue.index!==void 0){var pe=Math.max(0,Math.min(this._items.length,ue.index));this._items.splice(pe,0,ee)}else this._items.push(ee);this._autoRefigureSizes?this._figureSizes():this._needsSizesFigured=!0,this._needsDraw=!0,ee.addHandler("bounds-change",this._delegatedFigureSizes),ee.addHandler("clip-change",this._delegatedFigureSizes),this.raiseEvent("add-item",{item:ee})},getItemAt:function(ee){return fe.console.assert(ee!==void 0,"[World.getItemAt] index is required"),this._items[ee]},getIndexOfItem:function(ee){return fe.console.assert(ee,"[World.getIndexOfItem] item is required"),fe.indexOf(this._items,ee)},getItemCount:function(){return this._items.length},setItemIndex:function(ee,ue){fe.console.assert(ee,"[World.setItemIndex] item is required"),fe.console.assert(ue!==void 0,"[World.setItemIndex] index is required");var pe=this.getIndexOfItem(ee);if(ue>=this._items.length)throw new Error("Index bigger than number of layers.");ue===pe||pe===-1||(this._items.splice(pe,1),this._items.splice(ue,0,ee),this._needsDraw=!0,this.raiseEvent("item-index-change",{item:ee,previousIndex:pe,newIndex:ue}))},removeItem:function(ee){fe.console.assert(ee,"[World.removeItem] item is required");var ue=fe.indexOf(this._items,ee);ue!==-1&&(ee.removeHandler("bounds-change",this._delegatedFigureSizes),ee.removeHandler("clip-change",this._delegatedFigureSizes),ee.destroy(),this._items.splice(ue,1),this._figureSizes(),this._needsDraw=!0,this._raiseRemoveItem(ee))},removeAll:function(){this.viewer._cancelPendingImages();var ee,ue;for(ue=0;ue<this._items.length;ue++)ee=this._items[ue],ee.removeHandler("bounds-change",this._delegatedFigureSizes),ee.removeHandler("clip-change",this._delegatedFigureSizes),ee.destroy();var pe=this._items;for(this._items=[],this._figureSizes(),this._needsDraw=!0,ue=0;ue<pe.length;ue++)ee=pe[ue],this._raiseRemoveItem(ee)},resetItems:function(){for(var ee=0;ee<this._items.length;ee++)this._items[ee].reset()},update:function(){for(var ee=!1,ue=0;ue<this._items.length;ue++)ee=this._items[ue].update()||ee;return ee},draw:function(){for(var ee=0;ee<this._items.length;ee++)this._items[ee].draw();this._needsDraw=!1},needsDraw:function(){for(var ee=0;ee<this._items.length;ee++)if(this._items[ee].needsDraw())return!0;return this._needsDraw},getHomeBounds:function(){return this._homeBounds.clone()},getContentFactor:function(){return this._contentFactor},setAutoRefigureSizes:function(ee){this._autoRefigureSizes=ee,ee&this._needsSizesFigured&&(this._figureSizes(),this._needsSizesFigured=!1)},arrange:function(ee){ee=ee||{};var ue=ee.immediately||!1,pe=ee.layout||fe.DEFAULT_SETTINGS.collectionLayout,_e=ee.rows||fe.DEFAULT_SETTINGS.collectionRows,Ne=ee.columns||fe.DEFAULT_SETTINGS.collectionColumns,Ue=ee.tileSize||fe.DEFAULT_SETTINGS.collectionTileSize,Ge=ee.tileMargin||fe.DEFAULT_SETTINGS.collectionTileMargin,qe=Ue+Ge,Ke;!ee.rows&&Ne?Ke=Ne:Ke=Math.ceil(this._items.length/_e);var Ye=0,Ze=0,Xe,Je,tt,rt,et;this.setAutoRefigureSizes(!1);for(var it=0;it<this._items.length;it++)it&&it%Ke===0&&(pe==="horizontal"?(Ze+=qe,Ye=0):(Ye+=qe,Ze=0)),Xe=this._items[it],Je=Xe.getBounds(),Je.width>Je.height?tt=Ue:tt=Ue*(Je.width/Je.height),rt=tt*(Je.height/Je.width),et=new fe.Point(Ye+(Ue-tt)/2,Ze+(Ue-rt)/2),Xe.setPosition(et,ue),Xe.setWidth(tt,ue),pe==="horizontal"?Ye+=qe:Ze+=qe;this.setAutoRefigureSizes(!0)},_figureSizes:function(){var ee=this._homeBounds?this._homeBounds.clone():null,ue=this._contentSize?this._contentSize.clone():null,pe=this._contentFactor||0;if(!this._items.length)this._homeBounds=new fe.Rect(0,0,1,1),this._contentSize=new fe.Point(1,1),this._contentFactor=1;else{var _e=this._items[0],Ne=_e.getBounds();this._contentFactor=_e.getContentSize().x/Ne.width;for(var Ue=_e.getClippedBounds().getBoundingBox(),Ge=Ue.x,qe=Ue.y,Ke=Ue.x+Ue.width,Ye=Ue.y+Ue.height,Ze=1;Ze<this._items.length;Ze++)_e=this._items[Ze],Ne=_e.getBounds(),this._contentFactor=Math.max(this._contentFactor,_e.getContentSize().x/Ne.width),Ue=_e.getClippedBounds().getBoundingBox(),Ge=Math.min(Ge,Ue.x),qe=Math.min(qe,Ue.y),Ke=Math.max(Ke,Ue.x+Ue.width),Ye=Math.max(Ye,Ue.y+Ue.height);this._homeBounds=new fe.Rect(Ge,qe,Ke-Ge,Ye-qe),this._contentSize=new fe.Point(this._homeBounds.width*this._contentFactor,this._homeBounds.height*this._contentFactor)}(this._contentFactor!==pe||!this._homeBounds.equals(ee)||!this._contentSize.equals(ue))&&this.raiseEvent("metrics-change",{})},_raiseRemoveItem:function(ee){this.raiseEvent("remove-item",{item:ee})}})}(OpenSeadragon)})(openseadragon);var openseadragonExports=openseadragon.exports;const te=getDefaultExportFromCjs$1(openseadragonExports),$6be4966fd9bbc698$var$SWITCH_NAME="Switch",[$6be4966fd9bbc698$var$createSwitchContext,$6be4966fd9bbc698$export$cf7f5f17f69cbd43]=$c512c27ab02ef895$export$50c7b4e9d9f19c1($6be4966fd9bbc698$var$SWITCH_NAME),[$6be4966fd9bbc698$var$SwitchProvider,$6be4966fd9bbc698$var$useSwitchContext]=$6be4966fd9bbc698$var$createSwitchContext($6be4966fd9bbc698$var$SWITCH_NAME),$6be4966fd9bbc698$export$b5d5cf8927ab7262=reactExports.forwardRef((fe,ee)=>{const{__scopeSwitch:ue,name:pe,checked:_e,defaultChecked:Ne,required:Ue,disabled:Ge,value:qe="on",onCheckedChange:Ke,...Ye}=fe,[Ze,Xe]=reactExports.useState(null),Je=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(ee,nt=>Xe(nt)),tt=reactExports.useRef(!1),rt=Ze?!!Ze.closest("form"):!0,[et=!1,it]=$71cd76cc60e0454e$export$6f32135080cb4c3({prop:_e,defaultProp:Ne,onChange:Ke});return reactExports.createElement($6be4966fd9bbc698$var$SwitchProvider,{scope:ue,checked:et,disabled:Ge},reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.button,_extends$1({type:"button",role:"switch","aria-checked":et,"aria-required":Ue,"data-state":$6be4966fd9bbc698$var$getState(et),"data-disabled":Ge?"":void 0,disabled:Ge,value:qe},Ye,{ref:Je,onClick:$e42e1063c40fb3ef$export$b9ecd428b558ff10(fe.onClick,nt=>{it(st=>!st),rt&&(tt.current=nt.isPropagationStopped(),tt.current||nt.stopPropagation())})})),rt&&reactExports.createElement($6be4966fd9bbc698$var$BubbleInput,{control:Ze,bubbles:!tt.current,name:pe,value:qe,checked:et,required:Ue,disabled:Ge,style:{transform:"translateX(-100%)"}}))}),$6be4966fd9bbc698$var$THUMB_NAME="SwitchThumb",$6be4966fd9bbc698$export$4d07bf653ea69106=reactExports.forwardRef((fe,ee)=>{const{__scopeSwitch:ue,...pe}=fe,_e=$6be4966fd9bbc698$var$useSwitchContext($6be4966fd9bbc698$var$THUMB_NAME,ue);return reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.span,_extends$1({"data-state":$6be4966fd9bbc698$var$getState(_e.checked),"data-disabled":_e.disabled?"":void 0},pe,{ref:ee}))}),$6be4966fd9bbc698$var$BubbleInput=fe=>{const{control:ee,checked:ue,bubbles:pe=!0,..._e}=fe,Ne=reactExports.useRef(null),Ue=$010c2913dbd2fe3d$export$5cae361ad82dce8b(ue),Ge=$db6c3485150b8e66$export$1ab7ae714698c4b8(ee);return reactExports.useEffect(()=>{const qe=Ne.current,Ke=window.HTMLInputElement.prototype,Ze=Object.getOwnPropertyDescriptor(Ke,"checked").set;if(Ue!==ue&&Ze){const Xe=new Event("click",{bubbles:pe});Ze.call(qe,ue),qe.dispatchEvent(Xe)}},[Ue,ue,pe]),reactExports.createElement("input",_extends$1({type:"checkbox","aria-hidden":!0,defaultChecked:ue},_e,{tabIndex:-1,ref:Ne,style:{...fe.style,...Ge,position:"absolute",pointerEvents:"none",opacity:0,margin:0}}))};function $6be4966fd9bbc698$var$getState(fe){return fe?"checked":"unchecked"}const $6be4966fd9bbc698$export$be92b6f5f03c0fe9=$6be4966fd9bbc698$export$b5d5cf8927ab7262,$6be4966fd9bbc698$export$6521433ed15a34db=$6be4966fd9bbc698$export$4d07bf653ea69106,dt=fe=>{const ee=fe.toString().split(":"),ue=Math.ceil(parseInt(ee[0])),pe=Math.ceil(parseInt(ee[1])),_e=mt(Math.ceil(parseInt(ee[2])),2);let Ne=`${ue!==0&&pe<10?(pe+"").padStart(2,"0"):pe}:${_e}`;return ue!==0&&(Ne=`${ue}:${Ne}`),Ne},ge=fe=>{const ee=new Date(fe*1e3).toISOString().substr(11,8);return dt(ee)},he=(fe,ee)=>{if(typeof fe!="object"||fe===null)return ee;for(const ue in ee)typeof ee[ue]=="object"&&ee[ue]!==null&&!Array.isArray(ee[ue])?(fe[ue]||(fe[ue]={}),fe[ue]=he(fe[ue],ee[ue])):fe[ue]=ee[ue];return fe},xe=(fe,ee)=>Object.hasOwn(fe,ee)?fe[ee].toString():void 0,mt=(fe,ee)=>String(fe).padStart(ee,"0"),B={background:"transparent",canvasBackgroundColor:"#6662",canvasHeight:"61.8vh",ignoreCaptionLabels:[],informationPanel:{open:!0,renderAbout:!0,renderSupplementing:!0,renderToggle:!0},openSeadragon:{},requestHeaders:{"Content-Type":"application/json"},showIIIFBadge:!0,showTitle:!0,withCredentials:!1};var me;const N={activeCanvas:"",activeManifest:"",collection:{},configOptions:B,informationOpen:(me=B==null?void 0:B.informationPanel)==null?void 0:me.open,isLoaded:!1,vault:new Vault},ve=e$1.createContext(N),be=e$1.createContext(N);function ut(fe,ee){switch(ee.type){case"updateActiveCanvas":return ee.canvasId||(ee.canvasId=""),{...fe,activeCanvas:ee.canvasId};case"updateActiveManifest":return{...fe,activeManifest:ee.manifestId};case"updateCollection":return{...fe,collection:ee.collection};case"updateConfigOptions":return{...fe,configOptions:he(fe.configOptions,ee.configOptions)};case"updateInformationOpen":return{...fe,informationOpen:ee.informationOpen};case"updateIsLoaded":return{...fe,isLoaded:ee.isLoaded};default:throw new Error(`Unhandled action type: ${ee.type}`)}}const pt=({initialState:fe=N,children:ee})=>{const[ue,pe]=reactExports.useReducer(ut,fe);return e$1.createElement(ve.Provider,{value:ue},e$1.createElement(be.Provider,{value:pe},ee))};function k(){const fe=e$1.useContext(ve);if(fe===void 0)throw new Error("useViewerState must be used within a ViewerProvider");return fe}function P(){const fe=e$1.useContext(be);if(fe===void 0)throw new Error("useViewerDispatch must be used within a ViewerProvider");return fe}const ye=(fe,ee,ue,pe)=>{var _e,Ne;const Ue={canvas:void 0,accompanyingCanvas:void 0,annotationPage:void 0,annotations:[]},Ge=qe=>{if(qe){if(!qe.body||!qe.motivation){console.error("Invalid annotation after Hyperion parsing: missing either 'body' or 'motivation'",qe);return}let Ke=qe.body;Array.isArray(Ke)&&(Ke=Ke[0]);const Ye=fe.get(Ke.id);if(!Ye)return;switch(ue){case"painting":return qe.target===ee.id&&qe.motivation&&qe.motivation[0]==="painting"&&pe.includes(Ye.type)&&(qe.body=Ye),!!qe;case"supplementing":return;default:throw new Error("Invalid annotation motivation.")}}};if(Ue.canvas=fe.get(ee),Ue.canvas&&(Ue.annotationPage=fe.get(Ue.canvas.items[0]),Ue.accompanyingCanvas=(_e=Ue.canvas)!=null&&_e.accompanyingCanvas?fe.get((Ne=Ue.canvas)==null?void 0:Ne.accompanyingCanvas):void 0),Ue.annotationPage){const qe=fe.get(Ue.annotationPage.items).map(Ye=>({body:fe.get(Ye.body[0].id),motivation:Ye.motivation,type:"Annotation"})),Ke=[];qe.forEach(Ye=>{Ye.body.type==="Choice"?Ye.body.items.forEach(Ze=>Ke.push({...Ye,id:Ze.id,body:fe.get(Ze.id)})):Ke.push(Ye)}),Ue.annotations=Ke.filter(Ge)}return Ue},V=(fe,ee="en")=>{if(!fe)return"";if(!fe[ee]){const ue=Object.getOwnPropertyNames(fe);if(ue.length>0)return fe[ue[0]]}return fe[ee]},O=(fe,ee)=>{const ue=ye(fe,{id:ee,type:"Canvas"},"painting",["Image","Sound","Video"]);if(ue.annotations.length!==0&&ue.annotations&&ue.annotations)return ue.annotations.map(pe=>pe==null?void 0:pe.body)},ft=(fe,ee,ue)=>{const pe=fe.get({id:ee,type:"Canvas"});if(!(pe!=null&&pe.annotations)||!pe.annotations[0])return[];const _e=fe.get(pe.annotations[0]),Ne=fe.get(_e.items);return Array.isArray(Ne)?Ne.filter(Ue=>{var Ge;if(Ue.body&&(Ge=Ue.motivation)!=null&&Ge.includes("supplementing")){let qe=Ue.body;Array.isArray(qe)&&(qe=qe[0]);const Ke=fe.get(qe.id);if(Ke.format===ue)return Ue.body=Ke,Ue}}).map(Ue=>Ue.body):[]},gt=(fe,ee,ue,pe)=>{const _e=[];if(ee.canvas&&ee.canvas.thumbnail.length>0){const Ne=fe.get(ee.canvas.thumbnail[0]);_e.push(Ne)}if(ee.annotations[0]){if(ee.annotations[0].thumbnail&&ee.annotations[0].thumbnail.length>0){const Ue=fe.get(ee.annotations[0].thumbnail[0]);_e.push(Ue)}if(!ee.annotations[0].body)return;const Ne=ee.annotations[0].body;Ne.type==="Image"&&_e.push(Ne)}return _e.length===0?void 0:{id:_e[0].id,format:_e[0].format,type:_e[0].type,width:ue,height:pe}},G=209,ht={colors:{primary:"#1a1d1e",primaryMuted:"#26292b",primaryAlt:"#151718",accent:`hsl(${G} 100% 38.2%)`,accentMuted:`hsl(${G} 80% 61.8%)`,accentAlt:`hsl(${G} 80% 30%)`,secondary:"#FFFFFF",secondaryMuted:"#e6e8eb",secondaryAlt:"#c1c8cd"},fontSizes:{1:"12px",2:"13px",3:"15px",4:"17px",5:"19px",6:"21px",7:"27px",8:"35px",9:"59px"},lineHeights:{1:"12px",2:"13px",3:"15px",4:"17px",5:"19px",6:"21px",7:"27px",8:"35px",9:"59px"},sizes:{1:"5px",2:"10px",3:"15px",4:"20px",5:"25px",6:"35px",7:"45px",8:"65px",9:"80px"},space:{1:"5px",2:"10px",3:"15px",4:"20px",5:"25px",6:"35px",7:"45px",8:"65px",9:"80px"},radii:{1:"4px",2:"6px",3:"8px",4:"12px",round:"50%",pill:"9999px"},transitions:{all:"all 300ms cubic-bezier(0.16, 1, 0.3, 1)"},zIndices:{1:"100",2:"200",3:"300",4:"400",max:"999"}},Y={xxs:"(max-width: 349px)",xs:"(max-width: 575px)",sm:"(max-width: 767px)",md:"(max-width: 991px)",lg:"(max-width: 90rem)",xl:"(min-width: calc(90rem + 1px))"},{styled:m,css:Kr,keyframes:K,createTheme:Jr}=q$1({theme:ht,media:Y}),xt=m("div",{display:"flex",flexDirection:"column",alignItems:"center"}),vt=m("p",{fontWeight:"bold",fontSize:"x-large"}),bt=m("span",{fontSize:"medium"}),yt=({error:fe})=>{const{message:ee}=fe;return e$1.createElement(xt,{role:"alert"},e$1.createElement(vt,{"data-testid":"headline"},"Something went wrong"),ee&&e$1.createElement(bt,null,`Error message: ${ee}`," "))},Ee=m("div",{position:"relative",zIndex:"0"}),we=m("div",{display:"flex",flexDirection:"row",overflow:"hidden","@sm":{flexDirection:"column"}}),Ce=m("div",{display:"flex",flexDirection:"column",flexGrow:"1",flexShrink:"1",width:"61.8%","@sm":{width:"100%"}}),Se=m($409067139f391064$export$41fb9f06171c75f4,{display:"none",border:"none",padding:"0",transition:"$all",opacity:"1",background:"#6663",margin:"1rem 0",borderRadius:"6px","&[data-information-panel='false']":{opacity:"0",marginTop:"-59px"},"@sm":{display:"flex","> span":{display:"flex",flexGrow:"1",fontSize:"0.8333em",justifyContent:"center",padding:"0.5rem",fontFamily:"inherit"}}}),ke=m($409067139f391064$export$7c6e2c02157bb7d2,{width:"100%",display:"flex"}),Et=m("aside",{display:"flex",flexGrow:"1",flexShrink:"0",width:"38.2%",maxHeight:"100%","@sm":{width:"100%"}}),wt=m("div",{display:"flex",flexDirection:"column",fontSmooth:"auto",webkitFontSmoothing:"antialiased","> div":{display:"flex",flexDirection:"column",flexGrow:"1",justifyContent:"flex-start","@sm":{[`& ${we}`]:{flexGrow:"1"},[`& ${Ce}`]:{flexGrow:"0"}}},"@sm":{padding:"0"},"&[data-information-panel-open='true']":{"@sm":{position:"fixed",height:"100%",width:"100%",top:"0",left:"0",zIndex:"2500000000",[`& ${Ee}`]:{display:"none"},[`& ${Se}`]:{margin:"1rem"},[`& ${ke}`]:{height:"100%"}}}}),Ct=m($69cb30bb0017df05$export$be92b6f5f03c0fe9,{display:"flex",flexDirection:"column",width:"100%",height:"100%",flexGrow:"1",flexShrink:"0",position:"relative",zIndex:"1",maskImage:"linear-gradient(180deg, rgba(0, 0, 0, 1) calc(100% - 2rem), transparent 100%)","@sm":{marginTop:"0.5rem",boxShadow:"none"}}),St=m($69cb30bb0017df05$export$54c2e3dc7acea9f5,{display:"flex",flexGrow:"0",margin:"0 1.618rem",borderBottom:"4px solid #6663","@sm":{margin:"0 1rem"}}),ne=m($69cb30bb0017df05$export$41fb9f06171c75f4,{display:"flex",position:"relative",padding:"0.5rem 1rem",background:"none",backgroundColor:"transparent",fontFamily:"inherit",border:"none",opacity:"0.7",fontSize:"1rem",marginRight:"1rem",lineHeight:"1rem",whiteSpace:"nowrap",cursor:"pointer",fontWeight:400,transition:"$all","&::after":{width:"0",height:"4px",content:"",position:"absolute",bottom:"-4px",left:"0",transition:"$all"},"&[data-state='active']":{opacity:"1",fontWeight:700,"&::after":{width:"100%",backgroundColor:"$accent"}}}),re=m($69cb30bb0017df05$export$7c6e2c02157bb7d2,{display:"flex",flexGrow:"1",flexShrink:"0",position:"absolute",top:"0",left:"0","&[data-state='active']":{width:"100%",height:"calc(100% - 2rem)",padding:"1.618rem 0"}}),kt=m("div",{position:"relative",height:"100%",width:"100%",overflowY:"scroll"}),It=m("div",{padding:" 0 1.618rem 2rem",display:"flex",flexDirection:"column",overflow:"scroll",position:"absolute",fontWeight:"400",fontSize:"1rem",zIndex:"0",img:{maxWidth:"100px",maxHeight:"100px",objectFit:"contain",color:"transparent",margin:"0 0 1rem",borderRadius:"3px",backgroundColor:"$secondaryMuted"},video:{display:"none"},"a, a:visited":{color:"$accent"},p:{fontSize:"1rem",lineHeight:"1.45em",margin:"0"},dl:{margin:"0",dt:{fontWeight:"700",margin:"1rem 0 0.25rem"},dd:{margin:"0"}},".manifest-property-title":{fontWeight:"700",margin:"1rem 0 0.25rem"},"ul, ol":{padding:"0",margin:"0",li:{fontSize:"1rem",lineHeight:"1.45em",listStyle:"none",margin:"0.25rem 0 0.25rem"}}}),$t=m("div",{position:"relative",width:"100%",height:"100%",zIndex:"0"}),Ie=(fe,ee="none")=>{if(!fe)return null;if(typeof fe=="string")return[fe];if(!fe[ee]){const ue=Object.getOwnPropertyNames(fe);if(ue.length>0)return fe[ue[0]]}return!fe[ee]||!Array.isArray(fe[ee])?null:fe[ee]},T=(fe,ee="none",ue=", ")=>{const pe=Ie(fe,ee);return Array.isArray(pe)?pe.join(`${ue}`):pe};function At(fe){return{__html:Tt(fe)}}function A(fe,ee){const ue=Object.keys(fe).filter(_e=>ee.includes(_e)?null:_e),pe=new Object;return ue.forEach(_e=>{pe[_e]=fe[_e]}),pe}function Tt(fe){return Qe(fe,{allowedAttributes:{a:["href"],img:["alt","src","height","width"]},allowedSchemes:["http","https","mailto"],allowedTags:["a","b","br","i","img","p","small","span","sub","sup"]})}const Mt=m("span",{}),z=fe=>{const{as:ee,label:ue}=fe,pe=A(fe,["as","label"]);return e$1.createElement(Mt,{as:ee,...pe},T(ue,pe.lang))},Rt=(fe,ee="200,",ue="full")=>{Array.isArray(fe)&&(fe=fe[0]);const{id:pe,service:_e}=fe;let Ne;if(!_e)return pe;if(Array.isArray(fe.service)&&fe.service.length>0&&(Ne=_e[0]),Ne){if(Ne["@id"])return`${Ne["@id"]}/${ue}/${ee}/0/default.jpg`;if(Ne.id)return`${Ne.id}/${ue}/${ee}/0/default.jpg`}},oe=m("img",{objectFit:"cover"}),zt=fe=>{const ee=reactExports.useRef(null),{contentResource:ue,altAsLabel:pe,region:_e="full"}=fe;let Ne;pe&&(Ne=T(pe));const Ue=A(fe,["contentResource","altAsLabel"]),{type:Ge,id:qe,width:Ke=200,height:Ye=200,duration:Ze}=ue;reactExports.useEffect(()=>{if(!qe&&!ee.current||["Image"].includes(Ge)||!qe.includes("m3u8"))return;const tt=new Hls;return ee.current&&(tt.attachMedia(ee.current),tt.on(Hls.Events.MEDIA_ATTACHED,function(){tt.loadSource(qe)})),tt.on(Hls.Events.ERROR,function(rt,et){if(et.fatal)switch(et.type){case Hls.ErrorTypes.NETWORK_ERROR:console.error(`fatal ${rt} network error encountered, try to recover`),tt.startLoad();break;case Hls.ErrorTypes.MEDIA_ERROR:console.error(`fatal ${rt} media error encountered, try to recover`),tt.recoverMediaError();break;default:tt.destroy();break}}),()=>{tt&&(tt.detachMedia(),tt.destroy())}},[qe,Ge]);const Xe=reactExports.useCallback(()=>{if(!ee.current)return;let tt=0,rt=30;if(Ze&&(rt=Ze),!qe.split("#t=")&&Ze&&(tt=Ze*.1),qe.split("#t=").pop()){const it=qe.split("#t=").pop();it&&(tt=parseInt(it.split(",")[0]))}const et=ee.current;et.autoplay=!0,et.currentTime=tt,setTimeout(()=>Xe(),rt*1e3)},[Ze,qe]);reactExports.useEffect(()=>Xe(),[Xe]);const Je=Rt(ue,`${Ke},${Ye}`,_e);switch(Ge){case"Image":return e$1.createElement(oe,{as:"img",alt:Ne,css:{width:Ke,height:Ye},key:qe,src:Je,...Ue});case"Video":return e$1.createElement(oe,{as:"video",css:{width:Ke,height:Ye},disablePictureInPicture:!0,key:qe,loop:!0,muted:!0,onPause:Xe,ref:ee,src:qe});default:return console.warn(`Resource type: ${Ge} is not valid or not yet supported in Primitives.`),e$1.createElement(e$1.Fragment,null)}},Lt=m("a",{}),Ft=fe=>{const{children:ee,homepage:ue}=fe,pe=A(fe,["children","homepage"]);return e$1.createElement(e$1.Fragment,null,ue&&ue.map(_e=>{const Ne=T(_e.label,pe.lang);return e$1.createElement(Lt,{"aria-label":ee?Ne:void 0,href:_e.id,key:_e.id,...pe},ee||Ne)}))},Pt={delimiter:", "},J=reactExports.createContext(void 0),$e=()=>{const fe=reactExports.useContext(J);if(fe===void 0)throw new Error("usePrimitivesContext must be used with a PrimitivesProvider");return fe},Q=({children:fe,initialState:ee=Pt})=>{const ue=Vt(ee,"delimiter");return e$1.createElement(J.Provider,{value:{delimiter:ue}},fe)},Vt=(fe,ee)=>Object.hasOwn(fe,ee)?fe[ee].toString():void 0,Ht=m("span",{}),ae=fe=>{const{as:ee,markup:ue}=fe,{delimiter:pe}=$e();if(!ue)return e$1.createElement(e$1.Fragment,null);const _e=A(fe,["as","markup"]),Ne=At(T(ue,_e.lang,pe));return e$1.createElement(Ht,{as:ee,..._e,dangerouslySetInnerHTML:Ne})},Ae=fe=>e$1.useContext(J)?e$1.createElement(ae,{...fe}):e$1.createElement(Q,null,e$1.createElement(ae,{...fe})),Bt=({as:fe="dd",lang:ee,value:ue})=>e$1.createElement(Ae,{markup:ue,as:fe,lang:ee}),Ot=m("span",{}),Dt=({as:fe="dd",customValueContent:ee,lang:ue,value:pe})=>{var _e;const{delimiter:Ne}=$e(),Ue=(_e=Ie(pe,ue))==null?void 0:_e.map(Ge=>reactExports.cloneElement(ee,{value:Ge}));return e$1.createElement(Ot,{as:fe,lang:ue},Ue==null?void 0:Ue.map((Ge,qe)=>[qe>0&&`${Ne}`,e$1.createElement(reactExports.Fragment,{key:qe},Ge)]))},Te=fe=>{var ee;const{item:ue,lang:pe,customValueContent:_e}=fe,{label:Ne,value:Ue}=ue,Ge=(ee=T(Ne))==null?void 0:ee.replace(" ","-").toLowerCase();return e$1.createElement("div",{role:"group","data-label":Ge},e$1.createElement(z,{as:"dt",label:Ne,lang:pe}),_e?e$1.createElement(Dt,{as:"dd",customValueContent:_e,value:Ue,lang:pe}):e$1.createElement(Bt,{as:"dd",value:Ue,lang:pe}))};function Wt(fe,ee){const ue=ee.filter(pe=>{const{matchingLabel:_e}=pe,Ne=Object.keys(pe.matchingLabel)[0],Ue=T(_e,Ne);if(T(fe,Ne)===Ue)return!0}).map(pe=>pe.Content);if(Array.isArray(ue))return ue[0]}const jt=m("dl",{}),Nt=fe=>{const{as:ee,customValueContent:ue,metadata:pe}=fe;if(!Array.isArray(pe))return e$1.createElement(e$1.Fragment,null);const _e=xe(fe,"customValueDelimiter"),Ne=A(fe,["as","customValueContent","customValueDelimiter","metadata"]);return e$1.createElement(Q,{...typeof _e=="string"?{initialState:{delimiter:_e}}:void 0},pe.length>0&&e$1.createElement(jt,{as:ee,...Ne},pe.map((Ue,Ge)=>{const qe=ue?Wt(Ue.label,ue):void 0;return e$1.createElement(Te,{customValueContent:qe,item:Ue,key:Ge,lang:Ne==null?void 0:Ne.lang})})))};m("li",{});m("ul",{});const Gt=m("dl",{}),qt=fe=>{const{as:ee,requiredStatement:ue}=fe;if(!ue)return e$1.createElement(e$1.Fragment,null);const pe=xe(fe,"customValueDelimiter"),_e=A(fe,["as","customValueDelimiter","requiredStatement"]);return e$1.createElement(Q,{...typeof pe=="string"?{initialState:{delimiter:pe}}:void 0},e$1.createElement(Gt,{as:ee,..._e},e$1.createElement(Te,{item:ue,lang:_e.lang})))},Ut=m("li",{}),_t=m("ul",{}),Zt=fe=>{const{as:ee,seeAlso:ue}=fe,pe=A(fe,["as","seeAlso"]);return e$1.createElement(_t,{as:ee},ue&&ue.map(_e=>{const Ne=T(_e.label,pe.lang);return e$1.createElement(Ut,{key:_e.id},e$1.createElement("a",{href:_e.id,...pe},Ne||_e.id))}))},Xt=fe=>{const{as:ee,summary:ue}=fe,pe=A(fe,["as","customValueDelimiter","summary"]);return e$1.createElement(Ae,{as:ee,markup:ue,...pe})},Me=fe=>{const{thumbnail:ee,region:ue}=fe,pe=A(fe,["thumbnail"]);return e$1.createElement(e$1.Fragment,null,ee&&ee.map(_e=>e$1.createElement(zt,{contentResource:_e,key:_e.id,region:ue,...pe})))},Yt=({homepage:fe})=>(fe==null?void 0:fe.length)===0?e$1.createElement(e$1.Fragment,null):e$1.createElement(e$1.Fragment,null,e$1.createElement("span",{className:"manifest-property-title"},"Homepage"),e$1.createElement(Ft,{homepage:fe})),Kt=({id:fe,htmlLabel:ee,parent:ue="manifest"})=>e$1.createElement(e$1.Fragment,null,e$1.createElement("span",{className:"manifest-property-title"},ee),e$1.createElement("a",{href:fe,target:"_blank",id:`iiif-${ue}-id`},fe)),Jt=({metadata:fe,parent:ee="manifest"})=>fe?e$1.createElement(e$1.Fragment,null,e$1.createElement(Nt,{metadata:fe,id:`iiif-${ee}-metadata`})):e$1.createElement(e$1.Fragment,null),Qt=({requiredStatement:fe,parent:ee="manifest"})=>fe?e$1.createElement(e$1.Fragment,null,e$1.createElement(qt,{requiredStatement:fe,id:`iiif-${ee}-required-statement`})):e$1.createElement(e$1.Fragment,null),en=({rights:fe})=>fe?e$1.createElement(e$1.Fragment,null,e$1.createElement("span",{className:"manifest-property-title"},"Rights"),e$1.createElement("a",{href:fe,target:"_blank"},fe)):e$1.createElement(e$1.Fragment,null),tn=({seeAlso:fe})=>(fe==null?void 0:fe.length)===0?e$1.createElement(e$1.Fragment,null):e$1.createElement(e$1.Fragment,null,e$1.createElement("span",{className:"manifest-property-title"},"See Also"),e$1.createElement(Zt,{seeAlso:fe})),nn=({summary:fe,parent:ee="manifest"})=>fe?e$1.createElement(e$1.Fragment,null,e$1.createElement(Xt,{summary:fe,as:"p",id:`iiif-${ee}-summary`})):e$1.createElement(e$1.Fragment,null),rn=({label:fe,thumbnail:ee})=>(ee==null?void 0:ee.length)===0?e$1.createElement(e$1.Fragment,null):e$1.createElement(e$1.Fragment,null,e$1.createElement(Me,{altAsLabel:fe||{none:["resource"]},thumbnail:ee,style:{backgroundColor:"#6663",objectFit:"cover"}})),on=()=>{const fe=k(),{activeManifest:ee,vault:ue}=fe,[pe,_e]=reactExports.useState(),[Ne,Ue]=reactExports.useState([]),[Ge,qe]=reactExports.useState([]),[Ke,Ye]=reactExports.useState([]);return reactExports.useEffect(()=>{var Ze,Xe,Je;const tt=ue.get(ee);_e(tt),((Ze=tt.homepage)==null?void 0:Ze.length)>0&&Ue(ue.get(tt.homepage)),((Xe=tt.seeAlso)==null?void 0:Xe.length)>0&&qe(ue.get(tt.seeAlso)),((Je=tt.thumbnail)==null?void 0:Je.length)>0&&Ye(ue.get(tt.thumbnail))},[ee,ue]),pe?e$1.createElement($t,null,e$1.createElement(It,null,e$1.createElement(rn,{thumbnail:Ke,label:pe.label}),e$1.createElement(nn,{summary:pe.summary}),e$1.createElement(Jt,{metadata:pe.metadata}),e$1.createElement(Qt,{requiredStatement:pe.requiredStatement}),e$1.createElement(en,{rights:pe.rights}),e$1.createElement(Yt,{homepage:Ne}),e$1.createElement(tn,{seeAlso:Ge}),e$1.createElement(Kt,{id:pe.id,htmlLabel:"IIIF Manifest"}))):e$1.createElement(e$1.Fragment,null)},an=()=>{function fe(_e){return _e.map(Ne=>{const Ue=Ne.identifier||v4();return{...Ne,identifier:Ue}})}function ee(_e){var Ne;const Ue=[],Ge=[],qe=fe(_e);for(const Ke of qe){for(;Ge.length>0&&Ge[Ge.length-1].end<=Ke.start;)Ge.pop();Ge.length>0?(Ge[Ge.length-1].children||(Ge[Ge.length-1].children=[]),(Ne=Ge[Ge.length-1].children)==null||Ne.push(Ke),Ge.push(Ke)):(Ue.push(Ke),Ge.push(Ke))}return Ue}function ue(_e,Ne=[]){return Ne.some(Ue=>_e.start>=Ue.start&&_e.end<=Ue.end)}function pe(_e=[]){return _e.sort((Ne,Ue)=>Ne.start-Ue.start)}return{addIdentifiersToParsedCues:fe,createNestedCues:ee,isChild:ue,orderCuesByTime:pe}},ie=K({from:{transform:"rotate(360deg)"},to:{transform:"rotate(0deg)"}}),ln=m($f99a8c78507165f7$export$be92b6f5f03c0fe9,{display:"flex",flexDirection:"column",width:"100%"}),Re=m($f99a8c78507165f7$export$6d08773d2e66f8f2,{position:"relative",cursor:"pointer",display:"flex",width:"100%",justifyContent:"space-between",textAlign:"left",margin:"0",padding:"0.5rem 1.618rem",fontFamily:"inherit",lineHeight:"1.25em",fontSize:"1rem",color:"inherit",border:"none",background:"none","@sm":{padding:"0.5rem 1rem",fontSize:"0.8333rem"},"&::before":{content:"",width:"12px",height:"12px",borderRadius:"12px",position:"absolute",backgroundColor:"$primaryMuted",opacity:"0",left:"8px",marginTop:"3px",boxSizing:"content-box","@sm":{content:"unset"}},"&::after":{content:"",width:"4px",height:"6px",position:"absolute",backgroundColor:"$secondary",opacity:"0",clipPath:"polygon(100% 50%, 0 100%, 0 0)",left:"13px",marginTop:"6px",boxSizing:"content-box","@sm":{content:"unset"}},strong:{marginLeft:"1rem"},"&:hover":{color:"$accent","&::before":{backgroundColor:"$accent",opacity:"1"},"&::after":{content:"",width:"4px",height:"6px",position:"absolute",backgroundColor:"$secondary",clipPath:"polygon(100% 50%, 0 100%, 0 0)",opacity:"1"}},"&[aria-checked='true']":{backgroundColor:"#6663","&::before":{content:"",width:"6px",height:"6px",position:"absolute",backgroundColor:"transparent",border:"3px solid $accentMuted",borderRadius:"12px",left:"8px",marginTop:"4px",opacity:"1",animation:"1s linear infinite",animationName:ie,boxSizing:"content-box","@sm":{content:"unset"}},"&::after":{content:"",width:"6px",height:"6px",position:"absolute",backgroundColor:"transparent",border:"3px solid $accent",clipPath:"polygon(100% 0, 100% 100%, 0 0)",borderRadius:"12px",left:"8px",marginTop:"4px",opacity:"1",animation:"1.5s linear infinite",animationName:ie,boxSizing:"content-box","@sm":{content:"unset"}}}}),sn=({label:fe,start:ee,end:ue})=>{const[pe,_e]=reactExports.useState(!1),Ne=document.getElementById("clover-iiif-video");reactExports.useEffect(()=>(Ne==null||Ne.addEventListener("timeupdate",()=>{const{currentTime:Ge}=Ne;_e(ee<=Ge&&Ge<ue)}),()=>document.removeEventListener("timeupdate",()=>{})),[ue,ee,Ne]);const Ue=()=>{Ne&&(Ne.pause(),Ne.currentTime=ee,Ne.play())};return e$1.createElement(Re,{"aria-checked":pe,"data-testid":"information-panel-cue",onClick:Ue,value:fe},fe,e$1.createElement("strong",null,ge(ee)))},cn=m("ul",{listStyle:"none",paddingLeft:"1rem",position:"relative","&&:first-child":{paddingLeft:"0"},"& li ul":{[`& ${Re}`]:{backgroundColor:"unset","&::before":{content:"none"},"&::after":{content:"none"}}},"&:first-child":{margin:"0 0 1.618rem"}}),ze=({items:fe})=>e$1.createElement(cn,null,fe.map(ee=>{const{text:ue,start:pe,end:_e,children:Ne,identifier:Ue}=ee;return e$1.createElement("li",{key:Ue},e$1.createElement(sn,{label:ue,start:pe,end:_e}),Ne&&e$1.createElement(ze,{items:Ne}))})),dn=({resource:fe})=>{const[ee,ue]=e$1.useState([]),{id:pe,label:_e}=fe,{createNestedCues:Ne,orderCuesByTime:Ue}=an();return reactExports.useEffect(()=>{pe&&fetch(pe,{headers:{"Content-Type":"text/plain",Accept:"application/json"}}).then(Ge=>Ge.text()).then(Ge=>{const qe=nodeWebvtt.parse(Ge).cues,Ke=Ue(qe),Ye=Ne(Ke);ue(Ye)}).catch(Ge=>console.error(pe,Ge.toString()))},[Ne,pe,Ue]),e$1.createElement(ln,{"aria-label":`navigate ${V(_e,"en")}`},e$1.createElement(ze,{items:ee}))},mn=({activeCanvas:fe,resources:ee})=>{var ue;const pe=k(),{configOptions:_e}=pe,{informationPanel:Ne}=_e,[Ue,Ge]=reactExports.useState(),qe=(Ne==null?void 0:Ne.renderAbout)||((ue=_e==null?void 0:_e.informationPanel)==null?void 0:ue.renderAbout),Ke=Ne==null?void 0:Ne.renderSupplementing;reactExports.useEffect(()=>{qe?Ge("manifest-about"):ee&&(ee==null?void 0:ee.length)>0&&!qe&&Ge(ee[0].id)},[fe,qe,ee]);const Ye=Ze=>{Ge(Ze)};return ee?e$1.createElement(Ct,{"data-testid":"information-panel",defaultValue:Ue,onValueChange:Ye,orientation:"horizontal",value:Ue},e$1.createElement(St,{"aria-label":"select chapter","data-testid":"information-panel-list"},qe&&e$1.createElement(ne,{value:"manifest-about"},"About"),Ke&&ee&&ee.map(({id:Ze,label:Xe})=>e$1.createElement(ne,{key:Ze,value:Ze},e$1.createElement(z,{label:Xe})))),e$1.createElement(kt,null,qe&&e$1.createElement(re,{value:"manifest-about"},e$1.createElement(on,null)),Ke&&ee&&ee.map(Ze=>e$1.createElement(re,{key:Ze.id,value:Ze.id},e$1.createElement(dn,{resource:Ze}))))):e$1.createElement(e$1.Fragment,null)},Le=m("div",{position:"absolute",right:"1rem",top:"1rem",display:"flex",justifyContent:"flex-end",zIndex:"1"}),un=m("input",{flexGrow:"1",border:"none",backgroundColor:"$secondaryMuted",color:"$primary",marginRight:"1rem",height:"2rem",padding:"0 1rem",borderRadius:"2rem",fontFamily:"inherit",fontSize:"1rem",lineHeight:"1rem",boxShadow:"inset 1px 1px 2px #0003","&::placeholder":{color:"$primaryMuted"}}),q=m("button",{display:"flex",background:"none",border:"none",width:"2rem !important",height:"2rem !important",padding:"0",margin:"0",fontWeight:"700",borderRadius:"2rem",backgroundColor:"$accent",color:"$secondary",cursor:"pointer",boxSizing:"content-box !important",transition:"$all",svg:{height:"60%",width:"60%",padding:"20%",fill:"$secondary",stroke:"$secondary",opacity:"1",filter:"drop-shadow(5px 5px 5px #000D)",boxSizing:"inherit",transition:"$all"},"&:disabled":{backgroundColor:"transparent",boxShadow:"none",svg:{opacity:"0.25"}}}),pn=m("div",{display:"flex",marginRight:"0.618rem",backgroundColor:"$accentAlt",borderRadius:"2rem",boxShadow:"5px 5px 5px #0003",color:"$secondary",alignItems:"center","> span":{display:"flex",margin:"0 0.5rem",fontSize:"0.7222rem"}}),fn=m("div",{display:"flex",position:"relative",zIndex:"1",width:"100%",padding:"0",transition:"$all",variants:{isToggle:{true:{paddingTop:"2.618rem",[`& ${Le}`]:{width:"calc(100% - 2rem)","@sm":{width:"calc(100% - 2rem)"}}}}}}),gn=(fe,ee)=>{reactExports.useEffect(()=>{function ue(pe){pe.key===fe&&ee()}return window.addEventListener("keyup",ue),()=>window.removeEventListener("keyup",ue)},[])},hn=()=>e$1.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},e$1.createElement("title",null,"Arrow Back"),e$1.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M244 400L100 256l144-144M120 256h292"})),xn=()=>e$1.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},e$1.createElement("title",null,"Arrow Forward"),e$1.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M268 112l144 144-144 144M392 256H100"})),vn=()=>e$1.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},e$1.createElement("title",null,"Close"),e$1.createElement("path",{d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"})),bn=()=>e$1.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},e$1.createElement("title",null,"Search"),e$1.createElement("path",{d:"M456.69 421.39L362.6 327.3a173.81 173.81 0 0034.84-104.58C397.44 126.38 319.06 48 222.72 48S48 126.38 48 222.72s78.38 174.72 174.72 174.72A173.81 173.81 0 00327.3 362.6l94.09 94.09a25 25 0 0035.3-35.3zM97.92 222.72a124.8 124.8 0 11124.8 124.8 124.95 124.95 0 01-124.8-124.8z"})),yn=({handleCanvasToggle:fe,handleFilter:ee,activeIndex:ue,canvasLength:pe})=>{const[_e,Ne]=reactExports.useState(!1),[Ue,Ge]=reactExports.useState(!1),[qe,Ke]=reactExports.useState(!1);reactExports.useEffect(()=>{Ke(ue===0),ue===pe-1?Ge(!0):Ge(!1)},[ue,pe]),gn("Escape",()=>{Ne(!1),ee("")});const Ye=()=>{Ne(Xe=>!Xe),ee("")},Ze=Xe=>ee(Xe.target.value);return e$1.createElement(fn,{isToggle:_e},e$1.createElement(Le,null,_e&&e$1.createElement(un,{autoFocus:!0,onChange:Ze,placeholder:"Search"}),!_e&&e$1.createElement(pn,null,e$1.createElement(q,{onClick:()=>fe(-1),disabled:qe,type:"button"},e$1.createElement(hn,null)),e$1.createElement("span",null,ue+1," of ",pe),e$1.createElement(q,{onClick:()=>fe(1),disabled:Ue,type:"button"},e$1.createElement(xn,null))),e$1.createElement(q,{onClick:Ye,type:"button"},_e?e$1.createElement(vn,null):e$1.createElement(bn,null))))},En=m($f99a8c78507165f7$export$be92b6f5f03c0fe9,{display:"flex",flexDirection:"row",flexGrow:"1",padding:"1.618rem",overflowX:"scroll",position:"relative",zIndex:"0"}),wn=()=>e$1.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M256 112v288M400 256H112"}),Cn=()=>e$1.createElement(e$1.Fragment,null,e$1.createElement("path",{d:"M232 416a23.88 23.88 0 01-14.2-4.68 8.27 8.27 0 01-.66-.51L125.76 336H56a24 24 0 01-24-24V200a24 24 0 0124-24h69.75l91.37-74.81a8.27 8.27 0 01.66-.51A24 24 0 01256 120v272a24 24 0 01-24 24zm-106.18-80zm-.27-159.86zM320 336a16 16 0 01-14.29-23.19c9.49-18.87 14.3-38 14.3-56.81 0-19.38-4.66-37.94-14.25-56.73a16 16 0 0128.5-14.54C346.19 208.12 352 231.44 352 256c0 23.86-6 47.81-17.7 71.19A16 16 0 01320 336z"}),e$1.createElement("path",{d:"M368 384a16 16 0 01-13.86-24C373.05 327.09 384 299.51 384 256c0-44.17-10.93-71.56-29.82-103.94a16 16 0 0127.64-16.12C402.92 172.11 416 204.81 416 256c0 50.43-13.06 83.29-34.13 120a16 16 0 01-13.87 8z"}),e$1.createElement("path",{d:"M416 432a16 16 0 01-13.39-24.74C429.85 365.47 448 323.76 448 256c0-66.5-18.18-108.62-45.49-151.39a16 16 0 1127-17.22C459.81 134.89 480 181.74 480 256c0 64.75-14.66 113.63-50.6 168.74A16 16 0 01416 432z"})),Sn=()=>e$1.createElement("path",{d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"}),kn=()=>e$1.createElement("path",{d:"M416 64H96a64.07 64.07 0 00-64 64v256a64.07 64.07 0 0064 64h320a64.07 64.07 0 0064-64V128a64.07 64.07 0 00-64-64zm-80 64a48 48 0 11-48 48 48.05 48.05 0 0148-48zM96 416a32 32 0 01-32-32v-67.63l94.84-84.3a48.06 48.06 0 0165.8 1.9l64.95 64.81L172.37 416zm352-32a32 32 0 01-32 32H217.63l121.42-121.42a47.72 47.72 0 0161.64-.16L448 333.84z"}),In=()=>e$1.createElement("path",{d:"M464 384.39a32 32 0 01-13-2.77 15.77 15.77 0 01-2.71-1.54l-82.71-58.22A32 32 0 01352 295.7v-79.4a32 32 0 0113.58-26.16l82.71-58.22a15.77 15.77 0 012.71-1.54 32 32 0 0145 29.24v192.76a32 32 0 01-32 32zM268 400H84a68.07 68.07 0 01-68-68V180a68.07 68.07 0 0168-68h184.48A67.6 67.6 0 01336 179.52V332a68.07 68.07 0 01-68 68z"}),Fe=m("svg",{display:"inline-flex",variants:{isLarge:{true:{height:"4rem",width:"4rem"}},isMedium:{true:{height:"2rem",width:"2rem"}},isSmall:{true:{height:"1rem",width:"1rem"}}}}),$n=({children:fe})=>e$1.createElement("title",null,fe),S=fe=>e$1.createElement(Fe,{...fe,"data-testid":"icon-svg",role:"img",viewBox:"0 0 512 512",xmlns:"http://www.w3.org/2000/svg"},fe.children);S.Title=$n;S.Add=wn;S.Audio=Cn;S.Close=Sn;S.Image=kn;S.Video=In;const An=K({"0%":{opacity:0,transform:"translateY(1rem)"},"100%":{opacity:1,transform:"translateY(0)"}}),Tn=K({"0%":{opacity:0,transform:"translateY(1rem)"},"100%":{opacity:1,transform:"translateY(0)"}}),Pe=m($cb5cc270b50c6fcd$export$21b07c8f274aebd5,{fill:"$secondaryAlt"}),Mn=m($cb5cc270b50c6fcd$export$f39c2d165cd861fe,{position:"absolute",right:"0",top:"0",padding:"0.5rem",margin:"0",cursor:"pointer",border:"none",background:"none",fill:"inherit","&:hover":{opacity:"0.75"}}),Rn=m($cb5cc270b50c6fcd$export$7c6e2c02157bb7d2,{border:"none",backgroundColor:"white",fill:"inhrerit",padding:"1rem 2rem 1rem 1rem",width:"auto",minWidth:"200px",maxWidth:"350px",borderRadius:"3px",boxShadow:"5px 5px 13px #0002",animationDuration:"0.3s",animationTimingFunction:"cubic-bezier(0.16, 1, 0.3, 1)",'&[data-side="top"]':{animationName:Tn},'&[data-side="bottom"]':{animationName:An},'&[data-align="end"]':{[`& ${Pe}`]:{margin:"0 0.7rem"}}}),zn=m($cb5cc270b50c6fcd$export$41fb9f06171c75f4,{display:"inline-flex",padding:"0.5rem 0",margin:"0 0.5rem 0 0",cursor:"pointer",border:"none",background:"none","> button, > span":{margin:"0"}}),Ln=m($cb5cc270b50c6fcd$export$be92b6f5f03c0fe9,{boxSizing:"content-box"}),Fn=fe=>e$1.createElement(zn,{...fe},fe.children),Pn=fe=>e$1.createElement(Rn,{...fe},e$1.createElement(Pe,null),e$1.createElement(Mn,null,e$1.createElement(S,{isSmall:!0},e$1.createElement(S.Close,null))),fe.children),H=({children:fe})=>e$1.createElement(Ln,null,fe);H.Trigger=Fn;H.Content=Pn;const _=m("div",{boxSizing:"border-box",display:"inline-flex",alignItems:"center",borderRadius:"5px",padding:"$1",marginBottom:"$2",marginRight:"$2",backgroundColor:"$lightGrey",color:"$richBlack50",textTransform:"uppercase",fontSize:"$2",objectFit:"contain",lineHeight:"1em !important","&:last-child":{marginRight:"0"},[`${Fe}`]:{position:"absolute",left:"$1",height:"$3",width:"$3"},variants:{isIcon:{true:{position:"relative",paddingLeft:"$5"}}}}),Z=m("span",{display:"flex"}),Vn=m("span",{display:"flex",width:"1.2111rem",height:"0.7222rem"}),Hn=m("span",{display:"inline-flex",marginLeft:"5px",marginBottom:"-1px"}),Bn=m($f99a8c78507165f7$export$6d08773d2e66f8f2,{display:"flex",flexShrink:"0",margin:"0 1.618rem 0 0",padding:"0",cursor:"pointer",background:"none",border:"none",fontFamily:"inherit",lineHeight:"1.25em",fontSize:"1rem",textAlign:"left","&:last-child":{marginRight:"1rem"},figure:{margin:"0",width:"161.8px","> div":{position:"relative",display:"flex",backgroundColor:"$secondaryAlt",width:"inherit",height:"100px",overflow:"hidden",borderRadius:"3px",transition:"$all",img:{width:"100%",height:"100%",objectFit:"cover",filter:"blur(0)",transform:"scale3d(1, 1, 1)",transition:"$all",color:"transparent"},[`& ${Z}`]:{position:"absolute",right:"0",bottom:"0",[`& ${_}`]:{margin:"0",paddingLeft:"0",fontSize:"0.7222rem",backgroundColor:"#000d",color:"$secondary",fill:"$secondary",borderBottomLeftRadius:"0",borderTopRightRadius:"0"}}},figcaption:{marginTop:"0.5rem",fontWeight:"400",fontSize:"0.8333rem",display:"-webkit-box",overflow:"hidden",MozBoxOrient:"vertical",WebkitBoxOrient:"vertical",WebkitLineClamp:"5","@sm":{fontSize:"0.8333rem"}}},"&[aria-checked='true']":{figure:{"> div":{backgroundColor:"$primaryAlt","&::before":{position:"absolute",zIndex:"1",color:"$secondaryMuted",content:"Active Item",textTransform:"uppercase",fontWeight:"700",fontSize:"0.6111rem",letterSpacing:"0.03rem",display:"flex",width:"100%",height:"100%",flexDirection:"column",justifyContent:"center",textAlign:"center",textShadow:"5px 5px 5px #0003"},img:{opacity:"0.3",transform:"scale3d(1.1, 1.1, 1.1)",filter:"blur(2px)"},[`& ${Z}`]:{[`& ${_}`]:{backgroundColor:"$accent"}}}},figcaption:{fontWeight:"700"}}}),On=({type:fe})=>{switch(fe){case"Sound":return e$1.createElement(S.Audio,null);case"Image":return e$1.createElement(S.Image,null);case"Video":return e$1.createElement(S.Video,null);default:return e$1.createElement(S.Image,null)}},Dn=({canvas:fe,canvasIndex:ee,isActive:ue,thumbnail:pe,type:_e,handleChange:Ne})=>e$1.createElement(Bn,{"aria-checked":ue,"data-testid":"media-thumbnail","data-canvas":ee,onClick:()=>Ne(fe.id),value:fe.id},e$1.createElement("figure",null,e$1.createElement("div",null,(pe==null?void 0:pe.id)&&e$1.createElement("img",{src:pe.id,alt:fe!=null&&fe.label?V(fe.label):""}),e$1.createElement(Z,null,e$1.createElement(_,{isIcon:!0,"data-testid":"thumbnail-tag"},e$1.createElement(Vn,null),e$1.createElement(S,{"aria-label":_e},e$1.createElement(On,{type:_e})),["Video","Sound"].includes(_e)&&e$1.createElement(Hn,null,ge(fe.duration))))),(fe==null?void 0:fe.label)&&e$1.createElement("figcaption",{"data-testid":"fig-caption"},e$1.createElement(z,{label:fe.label})))),Wn=fe=>fe.body?fe.body.type:"Image",jn=({items:fe})=>{const ee=P(),ue=k(),{activeCanvas:pe,vault:_e}=ue,[Ne,Ue]=reactExports.useState(""),[Ge,qe]=reactExports.useState([]),[Ke,Ye]=reactExports.useState(0),Ze=e$1.useRef(null),Xe="painting",Je=et=>{pe!==et&&ee({type:"updateActiveCanvas",canvasId:et})};reactExports.useEffect(()=>{if(!Ge.length){const et=["Image","Sound","Video"],it=fe.map(nt=>ye(_e,nt,Xe,et)).filter(nt=>nt.annotations.length>0);qe(it)}},[fe,Ge.length,_e]),reactExports.useEffect(()=>{Ge.forEach((et,it)=>{et!=null&&et.canvas&&et.canvas.id===pe&&Ye(it)})},[pe,Ge]),reactExports.useEffect(()=>{const et=document.querySelector(`[data-canvas="${Ke}"]`);if(et instanceof HTMLElement&&Ze.current){const it=et.offsetLeft-Ze.current.offsetWidth/2+et.offsetWidth/2;Ze.current.scrollTo({left:it,behavior:"smooth"})}},[Ke]);const tt=et=>Ue(et),rt=et=>{const it=Ge[Ke+et];it!=null&&it.canvas&&Je(it.canvas.id)};return e$1.createElement(e$1.Fragment,null,e$1.createElement(yn,{handleFilter:tt,handleCanvasToggle:rt,activeIndex:Ke,canvasLength:Ge.length}),e$1.createElement(En,{"aria-label":"select item","data-testid":"media",ref:Ze},Ge.filter(et=>{var it;if((it=et.canvas)!=null&&it.label){const nt=V(et.canvas.label);if(Array.isArray(nt))return nt[0].toLowerCase().includes(Ne.toLowerCase())}}).map((et,it)=>{var nt,st;return e$1.createElement(Dn,{canvas:et.canvas,canvasIndex:it,handleChange:Je,isActive:pe===((nt=et==null?void 0:et.canvas)==null?void 0:nt.id),key:(st=et==null?void 0:et.canvas)==null?void 0:st.id,thumbnail:gt(_e,et,200,200),type:Wn(et.annotations[0])})})))},Ve=m("button",{background:"none",border:"none",cursor:"zoom-in",width:"100%",height:"100%",margin:"0",padding:"0",transition:"$all","& img":{width:"100%",height:"100%",objectFit:"contain",color:"transparent",transition:"$all"},variants:{isMedia:{true:{cursor:"pointer"}}}}),He=m("button",{display:"flex",height:"2rem",width:"2rem",borderRadius:"2rem",padding:"0",margin:"0",fontFamily:"inherit",background:"none",border:"none",color:"white",cursor:"pointer",marginLeft:"0.618rem",backgroundColor:"$primary",filter:"drop-shadow(2px 2px 5px #0003)",transition:"$all",boxSizing:"content-box !important","&:first-child":{marginLeft:"0"},"@xs":{marginBottom:"0.618rem",marginLeft:"0","&:last-child":{marginBottom:"0"}},svg:{height:"60%",width:"60%",padding:"20%",fill:"$secondary",stroke:"$secondary",filter:"drop-shadow(2px 2px 5px #0003)",transition:"$all",boxSizing:"inherit"},"&:hover, &:focus":{backgroundColor:"$accent"},"&#rotateRight":{"&:hover, &:focus":{svg:{rotate:"45deg"}}},"&#rotateLeft":{transform:"scaleX(-1)","&:hover, &:focus":{svg:{rotate:"45deg"}}},"&#reset":{"&:hover, &:focus":{svg:{rotate:"-15deg"}}}}),Be=m(He,{position:"absolute",width:"2rem",top:"1rem",right:"1rem",zIndex:100,display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",transition:"$all",borderRadius:"50%",backgroundColor:"$accent",cursor:"pointer","&:hover, &:focus":{backgroundColor:"$accent !important"},variants:{isInteractive:{true:{"&:hover":{opacity:"1"}},false:{}},isMedia:{true:{cursor:"pointer !important"}}},compoundVariants:[{isInteractive:!1,isMedia:!0,css:{top:"50%",right:"50%",width:"4rem",height:"4rem",transform:"translate(50%,-50%)"}}]}),Nn=m("div",{position:"relative",zIndex:"0",display:"flex",flexDirection:"column",gap:"1rem","&:hover":{[`${Be}`]:{backgroundColor:"$accent"},[`${Ve}`]:{backgroundColor:"#6662",img:{filter:"brightness(0.85)"}}}}),Gn=m("div",{}),qn=m("svg",{height:"19px",color:"$accent",fill:"$accent",stroke:"$accent",display:"flex",margin:"0.25rem 0.85rem"}),Un=m($cc7e05a45900e73f$export$41fb9f06171c75f4,{fontSize:"1.25rem",fontWeight:"400",fontFamily:"inherit",alignSelf:"flex-start",flexGrow:"1",cursor:"pointer",transition:"$all",border:"1px solid #6663",boxShadow:"2px 2px 5px #0001",borderRadius:"3px",display:"flex",alignItems:"center",paddingLeft:"0.5rem",width:"100%","@sm":{fontSize:"1rem"}}),_n=m($cc7e05a45900e73f$export$7c6e2c02157bb7d2,{borderRadius:"3px",boxShadow:"3px 3px 8px #0003",backgroundColor:"$secondary",marginTop:"2.25rem",marginLeft:"6px",paddingBottom:"0.25rem",maxHeight:"calc(61.8vh - 2.5rem) !important",borderTopLeftRadius:"0",border:"1px solid $secondaryMuted",maxWidth:"90vw"}),Zn=m($cc7e05a45900e73f$export$6d08773d2e66f8f2,{display:"flex",alignItems:"center",fontFamily:"inherit",padding:"0.25rem 0.5rem",color:"$primary",fontWeight:"400",fontSize:"0.8333rem",cursor:"pointer",backgroundColor:"$secondary",width:"calc(100% - 1rem)","> span":{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"},'&[data-state="checked"]':{fontWeight:"700",color:"$primary !important"},"&:hover":{color:"$accent"},img:{width:"31px",height:"31px",marginRight:"0.5rem",borderRadius:"3px"}}),Xn=m($cc7e05a45900e73f$export$b04be29aa201d4f5,{color:"$primaryMuted",fontFamily:"inherit",fontSize:"0.85rem",padding:"0.5rem 1rem 0.5rem 0.5rem",display:"flex",alignItems:"center",marginBottom:"0.25rem",borderRadius:"3px",borderTopLeftRadius:"0",borderBottomLeftRadius:"0",borderBottomRightRadius:"0",backgroundColor:"$secondaryMuted"}),Oe=m($cc7e05a45900e73f$export$be92b6f5f03c0fe9,{position:"relative",zIndex:"5",width:"100%"}),U=({direction:fe,title:ee})=>{const ue=()=>e$1.createElement("path",{d:"M414 321.94L274.22 158.82a24 24 0 00-36.44 0L98 321.94c-13.34 15.57-2.28 39.62 18.22 39.62h279.6c20.5 0 31.56-24.05 18.18-39.62z"}),pe=()=>e$1.createElement("path",{d:"M98 190.06l139.78 163.12a24 24 0 0036.44 0L414 190.06c13.34-15.57 2.28-39.62-18.22-39.62h-279.6c-20.5 0-31.56 24.05-18.18 39.62z"});return e$1.createElement(qn,{xmlns:"http://www.w3.org/2000/svg",focusable:"false",viewBox:"0 0 512 512",role:"img"},e$1.createElement("title",null,ee),fe==="up"&&e$1.createElement(ue,null),fe==="down"&&e$1.createElement(pe,null))},De=({children:fe,label:ee,maxHeight:ue,onValueChange:pe,value:_e})=>e$1.createElement(Oe,{onValueChange:pe,value:_e},e$1.createElement(Un,{"data-testid":"select-button"},e$1.createElement($cc7e05a45900e73f$export$e288731fd71264f0,{"data-testid":"select-button-value"}),e$1.createElement($cc7e05a45900e73f$export$99b400cabb58c515,null,e$1.createElement(U,{direction:"down",title:"select"}))),e$1.createElement($cc7e05a45900e73f$export$b2af6c9944296213,null,e$1.createElement(_n,{css:{maxHeight:`${ue} !important`},"data-testid":"select-content"},e$1.createElement($cc7e05a45900e73f$export$d8117927658af6d7,null,e$1.createElement(U,{direction:"up",title:"scroll up for more"})),e$1.createElement($cc7e05a45900e73f$export$9ed6e7b40248d36d,null,e$1.createElement($cc7e05a45900e73f$export$ee25a334c55de1f4,null,ee&&e$1.createElement(Xn,null,e$1.createElement(z,{"data-testid":"select-label",label:ee})),fe)),e$1.createElement($cc7e05a45900e73f$export$ff951e476c12189,null,e$1.createElement(U,{direction:"down",title:"scroll down for more"}))))),We=fe=>e$1.createElement(Zn,{...fe},fe.thumbnail&&e$1.createElement(Me,{thumbnail:fe.thumbnail}),e$1.createElement($cc7e05a45900e73f$export$3572fb0fb821ff49,null,e$1.createElement(z,{label:fe.label})),e$1.createElement($cc7e05a45900e73f$export$6b9198de19accfe6,null)),Yn=m("div",{position:"absolute !important",zIndex:"1",top:"1rem",left:"1rem",width:"161.8px",height:"100px",backgroundColor:"#000D",boxShadow:"5px 5px 5px #0002",borderRadius:"3px",".displayregion":{border:" 3px solid $accent !important",boxShadow:"0 0 3px #0006"},"@sm":{width:"123px",height:"76px"},"@xs":{width:"100px",height:"61.8px"}}),Kn=m("div",{position:"relative",width:"100%",height:"100%",zIndex:"0"}),Jn=m("div",{width:"100%",height:"61.8vh",maxHeight:"100vh",background:"black",backgroundSize:"contain",color:"white",position:"relative",zIndex:"1",overflow:"hidden"}),R=({id:fe,label:ee,children:ue})=>e$1.createElement(He,{id:fe,"data-testid":"openseadragon-button"},e$1.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","aria-labelledby":`${fe}-svg-title`,"data-testid":"openseadragon-button-svg",focusable:"false",viewBox:"0 0 512 512",role:"img"},e$1.createElement("title",{id:`${fe}-svg-title`},ee),ue)),Qn=m("div",{position:"absolute",zIndex:"1",top:"1rem",display:"flex","@xs":{flexDirection:"column",zIndex:"2"},variants:{hasPlaceholder:{true:{right:"3.618rem","@xs":{top:"3.618rem",right:"1rem"}},false:{right:"1rem","@xs":{top:"1rem",right:"1rem"}}}}}),er=()=>e$1.createElement("path",{strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M256 112v288M400 256H112"}),tr=()=>e$1.createElement("path",{strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M400 256H112"}),nr=()=>e$1.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M432 320v112H320M421.8 421.77L304 304M80 192V80h112M90.2 90.23L208 208M320 80h112v112M421.77 90.2L304 208M192 432H80V320M90.23 421.8L208 304"}),rr=()=>e$1.createElement("path",{d:"M448 440a16 16 0 01-12.61-6.15c-22.86-29.27-44.07-51.86-73.32-67C335 352.88 301 345.59 256 344.23V424a16 16 0 01-27 11.57l-176-168a16 16 0 010-23.14l176-168A16 16 0 01256 88v80.36c74.14 3.41 129.38 30.91 164.35 81.87C449.32 292.44 464 350.9 464 424a16 16 0 01-16 16z"}),le=()=>e$1.createElement(e$1.Fragment,null,e$1.createElement("path",{fill:"none",strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M400 148l-21.12-24.57A191.43 191.43 0 00240 64C134 64 48 150 48 256s86 192 192 192a192.09 192.09 0 00181.07-128"}),e$1.createElement("path",{d:"M464 97.42V208a16 16 0 01-16 16H337.42c-14.26 0-21.4-17.23-11.32-27.31L436.69 86.1C446.77 76 464 83.16 464 97.42z"})),or=({hasPlaceholder:fe,options:ee})=>e$1.createElement(Qn,{"data-testid":"openseadragon-controls",hasPlaceholder:fe,id:"openseadragon-controls"},ee.showZoomControl&&e$1.createElement(e$1.Fragment,null,e$1.createElement(R,{id:"zoomIn",label:"zoom in"},e$1.createElement(er,null)),e$1.createElement(R,{id:"zoomOut",label:"zoom out"},e$1.createElement(tr,null))),ee.showFullPageControl&&e$1.createElement(R,{id:"fullPage",label:"full page"},e$1.createElement(nr,null)),ee.showRotationControl&&e$1.createElement(e$1.Fragment,null,e$1.createElement(R,{id:"rotateRight",label:"rotate right"},e$1.createElement(le,null)),e$1.createElement(R,{id:"rotateLeft",label:"rotate left"},e$1.createElement(le,null))),ee.showHomeControl&&e$1.createElement(R,{id:"reset",label:"reset"},e$1.createElement(rr,null))),ar=fe=>fetch(`${fe.replace(/\/$/,"")}/info.json`).then(ee=>ee.json()).then(ee=>ee).catch(ee=>{console.error(`The IIIF tilesource ${fe.replace(/\/$/,"")}/info.json failed to load: ${ee}`)}),ir=fe=>{let ee,ue;if(Array.isArray(fe)&&(ee=fe[0],ee)){let pe;"@id"in ee?pe=ee["@id"]:pe=ee.id,ue=pe}return ue},lr=({uri:fe,hasPlaceholder:ee,imageType:ue})=>{const[pe,_e]=reactExports.useState(),[Ne,Ue]=reactExports.useState(),Ge=k(),{configOptions:qe}=Ge,Ke={id:`openseadragon-viewport-${Ne}`,loadTilesWithAjax:!0,fullPageButton:"fullPage",homeButton:"reset",rotateLeftButton:"rotateLeft",rotateRightButton:"rotateRight",zoomInButton:"zoomIn",zoomOutButton:"zoomOut",showNavigator:!0,showFullPageControl:!0,showHomeControl:!0,showRotationControl:!0,showZoomControl:!0,navigatorBorderColor:"transparent",navigatorId:`openseadragon-navigator-${Ne}`,gestureSettingsMouse:{clickToZoom:!0,dblClickToZoom:!0,pinchToZoom:!0,scrollToZoom:!0},...qe.openSeadragon,ajaxWithCredentials:qe.withCredentials};return reactExports.useEffect(()=>{fe!==pe&&(_e(fe),Ue(v4()))},[pe,fe]),reactExports.useEffect(()=>{if(pe)switch(ue){case"simpleImage":te(Ke).addSimpleImage({url:pe});break;case"tiledImage":ar(pe).then(Ye=>te(Ke).addTiledImage({tileSource:Ye}));break;default:console.warn(`Unable to render ${pe} in OpenSeadragon as type: "${ue}"`);break}},[pe]),Ne?e$1.createElement(Jn,{css:{backgroundColor:qe.canvasBackgroundColor,height:qe.canvasHeight}},e$1.createElement(or,{hasPlaceholder:ee,options:Ke}),e$1.createElement(Yn,{id:`openseadragon-navigator-${Ne}`}),e$1.createElement(Kn,{id:`openseadragon-viewport-${Ne}`})):null},sr=({painting:fe,hasPlaceholder:ee})=>{const[ue,pe]=reactExports.useState(),[_e,Ne]=reactExports.useState();return reactExports.useEffect(()=>{Array.isArray(fe==null?void 0:fe.service)&&(fe==null?void 0:fe.service.length)>0?(pe("tiledImage"),Ne(ir(fe==null?void 0:fe.service))):(pe("simpleImage"),Ne(fe==null?void 0:fe.id))},[fe]),e$1.createElement(lr,{uri:_e,key:_e,hasPlaceholder:ee,imageType:ue})},cr=({isMedia:fe,label:ee,placeholderCanvas:ue,setIsInteractive:pe})=>{const{vault:_e}=k(),Ne=O(_e,ue),Ue=Ne?Ne[0]:void 0,Ge=ee?V(ee):["placeholder image"];return e$1.createElement(Ve,{onClick:()=>pe(!0),isMedia:fe},e$1.createElement("img",{src:(Ue==null?void 0:Ue.id)||"",alt:Ge.join(),height:Ue==null?void 0:Ue.height,width:Ue==null?void 0:Ue.width}))},dr=m("canvas",{position:"absolute",width:"100%",height:"100%",zIndex:"0"}),mr=e$1.forwardRef((fe,ee)=>{const ue=e$1.useRef(null),pe=reactExports.useCallback(()=>{var Ne,Ue;if((Ne=ee.current)!=null&&Ne.currentTime&&((Ue=ee.current)==null?void 0:Ue.currentTime)>0)return;const Ge=ee.current;if(!Ge)return;const qe=new AudioContext,Ke=qe.createMediaElementSource(Ge),Ye=qe.createAnalyser(),Ze=ue.current;if(!Ze)return;Ze.width=Ge.offsetWidth,Ze.height=Ge.offsetHeight;const Xe=Ze.getContext("2d");Ke.connect(Ye),Ye.connect(qe.destination),Ye.fftSize=256;const Je=Ye.frequencyBinCount,tt=new Uint8Array(Je);setInterval(function(){_e(Ye,Xe,Je,tt,Ze.width,Ze.height)},20)},[ee]);e$1.useEffect(()=>{!ee||!ee.current||(ee.current.onplay=pe)},[pe,ee]);function _e(Ne,Ue,Ge,qe,Ke,Ye){const Ze=Ke/Ge*2.6;let Xe,Je=0;Ne.getByteFrequencyData(qe),Ue.fillStyle="#000000",Ue.fillRect(0,0,Ke,Ye);for(let tt=0;tt<Ge;tt++)Xe=qe[tt]*2,Ue.fillStyle="rgba(78, 42, 132, 1)",Ue.fillRect(Je,Ye-Xe,Ze,Xe),Je+=Ze+6}return e$1.createElement(dr,{ref:ue,role:"presentation"})}),ur=m("div",{position:"relative",backgroundColor:"$primaryAlt",display:"flex",flexGrow:"0",flexShrink:"1",maxHeight:"500px",zIndex:"1",video:{backgroundColor:"transparent",objectFit:"contain",width:"100%",height:"100%",position:"relative",zIndex:"1"}}),pr=({resource:fe,ignoreCaptionLabels:ee})=>{const ue=V(fe.label,"en");return Array.isArray(ue)&&ue.some(pe=>ee.includes(pe))?null:e$1.createElement("track",{key:fe.id,src:fe.id,label:Array.isArray(ue)?ue[0]:ue,srcLang:"en","data-testid":"player-track"})},fr=({allSources:fe,resources:ee,painting:ue})=>{const[pe,_e]=e$1.useState(0),[Ne,Ue]=e$1.useState(),Ge=e$1.useRef(null),qe=(ue==null?void 0:ue.type)==="Sound",Ke=k(),{activeCanvas:Ye,configOptions:Ze,vault:Xe}=Ke;return reactExports.useEffect(()=>{if(!ue.id||!Ge.current)return;if(Ge!=null&&Ge.current){const rt=Ge.current;rt.src=ue.id,rt.load()}if(ue.id.split(".").pop()!=="m3u8")return;const Je={xhrSetup:function(rt,et){rt.withCredentials=!!Ze.withCredentials}},tt=new Hls(Je);return tt.attachMedia(Ge.current),tt.on(Hls.Events.MEDIA_ATTACHED,function(){tt.loadSource(ue.id)}),tt.on(Hls.Events.ERROR,function(rt,et){if(et.fatal)switch(et.type){case Hls.ErrorTypes.NETWORK_ERROR:console.error(`fatal ${rt} network error encountered, try to recover`),tt.startLoad();break;case Hls.ErrorTypes.MEDIA_ERROR:console.error(`fatal ${rt} media error encountered, try to recover`),tt.recoverMediaError();break;default:tt.destroy();break}}),()=>{if(tt&&Ge.current){const rt=Ge.current;tt.detachMedia(),tt.destroy(),rt.currentTime=0}}},[Ze.withCredentials,ue.id]),reactExports.useEffect(()=>{var Je,tt,rt,et;const it=Xe.get(Ye),nt=(Je=it.accompanyingCanvas)!=null&&Je.id?O(Xe,(tt=it.accompanyingCanvas)==null?void 0:tt.id):null,st=(rt=it.placeholderCanvas)!=null&&rt.id?O(Xe,(et=it.placeholderCanvas)==null?void 0:et.id):null;nt&&st?Ue(pe===0?st[0].id:nt[0].id):(nt&&Ue(nt[0].id),st&&Ue(st[0].id))},[Ye,pe,Xe]),reactExports.useEffect(()=>{if(Ge!=null&&Ge.current){const Je=Ge.current;return Je==null||Je.addEventListener("timeupdate",()=>_e(Je.currentTime)),()=>document.removeEventListener("timeupdate",()=>{})}},[]),e$1.createElement(ur,{css:{backgroundColor:Ze.canvasBackgroundColor,maxHeight:Ze.canvasHeight,position:"relative"},"data-testid":"player-wrapper"},e$1.createElement("video",{id:"clover-iiif-video",key:ue.id,ref:Ge,controls:!0,height:ue.height,width:ue.width,crossOrigin:"anonymous",poster:Ne,style:{maxHeight:Ze.canvasHeight,position:"relative",zIndex:"1"}},fe.map(Je=>e$1.createElement("source",{src:Je.id,type:Je.format,key:Je.id})),ee.length>0&&ee.map(Je=>e$1.createElement(pr,{resource:Je,ignoreCaptionLabels:Ze.ignoreCaptionLabels||[],key:Je.id})),"Sorry, your browser doesn't support embedded videos."),qe&&e$1.createElement(mr,{ref:Ge}))},gr=()=>e$1.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","aria-labelledby":"close-svg-title",focusable:"false",viewBox:"0 0 512 512",role:"img"},e$1.createElement("title",{id:"close-svg-title"},"close"),e$1.createElement("path",{d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"})),hr=({isMedia:fe})=>e$1.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","aria-labelledby":"open-svg-title",focusable:"false",viewBox:"0 0 512 512",role:"img"},e$1.createElement("title",{id:"open-svg-title"},"open"),fe?e$1.createElement("path",{d:"M133 440a35.37 35.37 0 01-17.5-4.67c-12-6.8-19.46-20-19.46-34.33V111c0-14.37 7.46-27.53 19.46-34.33a35.13 35.13 0 0135.77.45l247.85 148.36a36 36 0 010 61l-247.89 148.4A35.5 35.5 0 01133 440z"}):e$1.createElement(e$1.Fragment,null,e$1.createElement("path",{d:"m456.69,421.39l-94.09-94.09c22.65-30.16,34.88-66.86,34.84-104.58,0-96.34-78.38-174.72-174.72-174.72S48,126.38,48,222.72s78.38,174.72,174.72,174.72c37.72.04,74.42-12.19,104.58-34.84l94.09,94.09c10.29,9.2,26.1,8.32,35.3-1.98,8.48-9.49,8.48-23.83,0-33.32Zm-233.97-73.87c-68.89-.08-124.72-55.91-124.8-124.8h0c0-68.93,55.87-124.8,124.8-124.8s124.8,55.87,124.8,124.8-55.87,124.8-124.8,124.8Z"}),e$1.createElement("path",{d:"m279.5,197.76h-3.35s-28.47,0-28.47,0v-31.82c-.77-13.79-12.57-24.33-26.36-23.56-12.71.71-22.85,10.86-23.56,23.56v3.35h0v28.47h-31.82c-13.79.77-24.33,12.57-23.56,26.36.71,12.71,10.86,22.85,23.56,23.56h3.35s28.47,0,28.47,0v31.82c.77,13.79,12.57,24.33,26.36,23.56,12.71-.71,22.85-10.86,23.56-23.56v-3.35h0v-28.47h31.82c13.79-.77,24.33-12.57,23.56-26.36-.71-12.71-10.86-22.85-23.56-23.56Z"}))),xr=({handleToggle:fe,isInteractive:ee,isMedia:ue})=>e$1.createElement(Be,{onClick:fe,isInteractive:ee,isMedia:ue},ee?e$1.createElement(gr,null):e$1.createElement(hr,{isMedia:ue})),vr=({activeCanvas:fe,isMedia:ee,painting:ue,resources:pe})=>{var _e,Ne;const[Ue,Ge]=e$1.useState(0),[qe,Ke]=e$1.useState(!1),{configOptions:Ye,vault:Ze}=k(),Xe=Ze.get(fe),Je=(_e=Xe==null?void 0:Xe.placeholderCanvas)==null?void 0:_e.id,tt=!!Je,rt=(ue==null?void 0:ue.length)>1,et=Je&&!qe&&!ee,it=()=>Ke(!qe),nt=st=>{const lt=ue.findIndex(_r=>_r.id===st);Ge(lt)};return e$1.createElement(Nn,null,e$1.createElement(Gn,{style:{backgroundColor:Ye.canvasBackgroundColor,maxHeight:Ye.canvasHeight}},Je&&!ee&&e$1.createElement(xr,{handleToggle:it,isInteractive:qe,isMedia:ee}),et&&!ee&&e$1.createElement(cr,{isMedia:ee,label:Xe==null?void 0:Xe.label,placeholderCanvas:Je,setIsInteractive:Ke}),!et&&e$1.createElement("div",null,ee?e$1.createElement(fr,{allSources:ue,painting:ue[Ue],resources:pe}):ue&&e$1.createElement(sr,{painting:ue[Ue],hasPlaceholder:tt,key:fe}))),rt&&e$1.createElement(De,{value:(Ne=ue[Ue])==null?void 0:Ne.id,onValueChange:nt,maxHeight:"200px"},ue==null?void 0:ue.map(st=>e$1.createElement(We,{value:st==null?void 0:st.id,key:st==null?void 0:st.id,label:st==null?void 0:st.label}))))},br=({activeCanvas:fe,painting:ee,resources:ue,items:pe,isAudioVideo:_e})=>{const{informationOpen:Ne,configOptions:Ue}=k(),{informationPanel:Ge}=Ue,qe=(Ge==null?void 0:Ge.renderAbout)||(Ge==null?void 0:Ge.renderSupplementing)&&ue.length>0;return e$1.createElement(we,{className:"clover-content"},e$1.createElement(Ce,null,e$1.createElement(vr,{activeCanvas:fe,isMedia:_e,painting:ee,resources:ue}),qe&&e$1.createElement(Se,null,e$1.createElement("span",null,Ne?"View Items":"More Information")),pe.length>1&&e$1.createElement(Ee,{className:"clover-canvases"},e$1.createElement(jn,{items:pe,activeItem:0}))),Ne&&qe&&e$1.createElement(Et,null,e$1.createElement(ke,null,e$1.createElement(mn,{activeCanvas:fe,resources:ue}))))},yr=m(H.Trigger,{width:"30px",padding:"5px"}),Er=m(H.Content,{display:"flex",flexDirection:"column",fontSize:"0.8333rem",border:"none",boxShadow:"2px 2px 5px #0003",zIndex:"2",button:{display:"flex",textDecoration:"none",marginBottom:"0.5em",color:"$accentAlt",cursor:"pointer",background:"$secondary",border:"none","&:last-child":{marginBottom:"0"}}}),wr=m("span",{fontSize:"1.33rem",alignSelf:"flex-start",flexGrow:"0",flexShrink:"1",padding:"1rem","@sm":{fontSize:"1rem"},"&.visually-hidden":{position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",border:"0"}}),Cr=m("header",{display:"flex",backgroundColor:"transparent !important",justifyContent:"space-between",alignItems:"flex-start",width:"100%",[`> ${Oe}`]:{flexGrow:"1",flexShrink:"0"},form:{flexGrow:"0",flexShrink:"1"}}),Sr=m("div",{display:"flex",alignItems:"flex-end",justifyContent:"flex-end",padding:"1rem",flexShrink:"0",flexGrow:"1"}),kr=()=>{var fe;const ee=P(),ue=k(),{activeManifest:pe,collection:_e,configOptions:Ne,vault:Ue}=ue,Ge=Ne==null?void 0:Ne.canvasHeight,qe=Ke=>{ee({type:"updateActiveManifest",manifestId:Ke})};return e$1.createElement("div",{style:{margin:"0.75rem"}},e$1.createElement(De,{label:_e.label,maxHeight:Ge,value:pe,onValueChange:qe},(fe=_e==null?void 0:_e.items)==null?void 0:fe.map(Ke=>e$1.createElement(We,{value:Ke.id,key:Ke.id,thumbnail:Ke!=null&&Ke.thumbnail?Ue.get(Ke==null?void 0:Ke.thumbnail):void 0,label:Ke.label}))))},Ir=(fe,ee=2500)=>{const[ue,pe]=reactExports.useState(),_e=reactExports.useCallback(()=>{navigator.clipboard.writeText(fe).then(()=>pe("copied"),()=>pe("failed"))},[fe]);return reactExports.useEffect(()=>{if(!ue)return;const Ne=setTimeout(()=>pe(void 0),ee);return()=>clearTimeout(Ne)},[ue]),[ue,_e]},$r=m("span",{display:"flex",alignContent:"center",alignItems:"center",padding:"0.125rem 0.25rem 0",marginTop:"-0.125rem",marginLeft:"0.5rem",backgroundColor:"$accent",color:"$secondary",borderRadius:"3px",fontSize:"0.6111rem",textTransform:"uppercase",lineHeight:"1em"}),Ar=({status:fe})=>fe?e$1.createElement($r,{"data-copy-status":fe},fe):null,se=({textPrompt:fe,textToCopy:ee})=>{const[ue,pe]=Ir(ee);return e$1.createElement("button",{onClick:pe},fe," ",e$1.createElement(Ar,{status:ue}))},Tr=()=>{const fe="#ed1d33",ee="#2873ab";return e$1.createElement("svg",{viewBox:"0 0 493.35999 441.33334",id:"iiif-logo",version:"1.1"},e$1.createElement("title",null,"IIIF Manifest Options"),e$1.createElement("g",{transform:"matrix(1.3333333,0,0,-1.3333333,0,441.33333)"},e$1.createElement("g",{transform:"scale(0.1)"},e$1.createElement("path",{style:{fill:ee},d:"M 65.2422,2178.75 775.242,1915 773.992,15 65.2422,276.25 v 1902.5"}),e$1.createElement("path",{style:{fill:ee},d:"m 804.145,2640.09 c 81.441,-240.91 -26.473,-436.2 -241.04,-436.2 -214.558,0 -454.511,195.29 -535.9527,436.2 -81.4335,240.89 26.4805,436.18 241.0387,436.18 214.567,0 454.512,-195.29 535.954,-436.18"}),e$1.createElement("path",{style:{fill:fe},d:"M 1678.58,2178.75 968.578,1915 969.828,15 1678.58,276.25 v 1902.5"}),e$1.createElement("path",{style:{fill:fe},d:"m 935.082,2640.09 c -81.437,-240.91 26.477,-436.2 241.038,-436.2 214.56,0 454.51,195.29 535.96,436.2 81.43,240.89 -26.48,436.18 -241.04,436.18 -214.57,0 -454.52,-195.29 -535.958,-436.18"}),e$1.createElement("path",{style:{fill:ee},d:"m 1860.24,2178.75 710,-263.75 -1.25,-1900 -708.75,261.25 v 1902.5"}),e$1.createElement("path",{style:{fill:ee},d:"m 2603.74,2640.09 c 81.45,-240.91 -26.47,-436.2 -241.03,-436.2 -214.58,0 -454.52,195.29 -535.96,436.2 -81.44,240.89 26.48,436.18 241.03,436.18 214.57,0 454.51,-195.29 535.96,-436.18"}),e$1.createElement("path",{style:{fill:fe},d:"m 3700.24,3310 v -652.5 c 0,0 -230,90 -257.5,-142.5 -2.5,-247.5 0,-336.25 0,-336.25 l 257.5,83.75 V 1690 l -258.61,-92.5 V 262.5 L 2735.24,0 v 2360 c 0,0 -15,850 965,950"}))))},Mr=m($6be4966fd9bbc698$export$be92b6f5f03c0fe9,{all:"unset",height:"2rem",width:"3.236rem",backgroundColor:"#6663",borderRadius:"9999px",position:"relative",WebkitTapHighlightColor:"transparent",cursor:"pointer","&:focus":{boxShadow:"0 0 0 2px $secondaryAlt"},'&[data-state="checked"]':{backgroundColor:"$accent",boxShadow:"inset 2px 2px 5px #0003"}}),Rr=m($6be4966fd9bbc698$export$6521433ed15a34db,{display:"block",height:"calc(2rem - 12px)",width:"calc(2rem - 12px)",backgroundColor:"$secondary",borderRadius:"100%",boxShadow:"2px 2px 5px #0001",transition:"$all",transform:"translateX(6px)",willChange:"transform",'&[data-state="checked"]':{transform:"translateX(calc(1.236rem + 6px))"}}),zr=m("label",{fontSize:"0.8333rem",fontWeight:"400",lineHeight:"1em",userSelect:"none",cursor:"pointer",paddingRight:"0.618rem"}),Lr=m("form",{display:"flex",flexShrink:"0",flexGrow:"1",alignItems:"center",marginLeft:"1.618rem"}),Fr=()=>{var fe;const{configOptions:ee}=k(),ue=P(),[pe,_e]=reactExports.useState((fe=ee==null?void 0:ee.informationPanel)==null?void 0:fe.open);return reactExports.useEffect(()=>{ue({type:"updateInformationOpen",informationOpen:pe})},[pe]),e$1.createElement(Lr,null,e$1.createElement(zr,{htmlFor:"information-toggle",css:pe?{opacity:"1"}:{}},"More Information"),e$1.createElement(Mr,{checked:pe,onCheckedChange:()=>_e(!pe),id:"information-toggle","aria-label":"information panel toggle",name:"toggled?"},e$1.createElement(Rr,null)))},je=fe=>{const ee=()=>window.matchMedia?window.matchMedia(fe).matches:!1,[ue,pe]=reactExports.useState(ee);return reactExports.useEffect(()=>{const _e=()=>pe(ee);return window.addEventListener("resize",_e),()=>window.removeEventListener("resize",_e)}),ue},Pr=({manifestId:fe,manifestLabel:ee})=>{const ue=k(),{collection:pe,configOptions:_e}=ue,{showTitle:Ne,showIIIFBadge:Ue,informationPanel:Ge}=_e,qe=Ue||(Ge==null?void 0:Ge.renderToggle),Ke=je(Y.sm);return e$1.createElement(Cr,{className:"clover-header"},pe!=null&&pe.items?e$1.createElement(kr,null):e$1.createElement(wr,{className:Ne?"":"visually-hidden"},Ne&&e$1.createElement(z,{label:ee})),qe&&e$1.createElement(Sr,null,Ue&&e$1.createElement(H,null,e$1.createElement(yr,null,e$1.createElement(Tr,null)),e$1.createElement(Er,null,(pe==null?void 0:pe.items)&&e$1.createElement("button",{onClick:Ye=>{Ye.preventDefault(),window.open(pe.id,"_blank")}},"View Collection"),e$1.createElement("button",{onClick:Ye=>{Ye.preventDefault(),window.open(fe,"_blank")}},"View Manifest")," ",(pe==null?void 0:pe.items)&&e$1.createElement(se,{textPrompt:"Copy Collection URL",textToCopy:pe.id}),e$1.createElement(se,{textPrompt:"Copy Manifest URL",textToCopy:fe}))),(Ge==null?void 0:Ge.renderToggle)&&!Ke&&e$1.createElement(Fr,null)))},Vr=(fe=!1)=>{const[ee,ue]=reactExports.useState(fe);return reactExports.useLayoutEffect(()=>{if(!ee)return;const pe=document.documentElement.style.overflow;return document.documentElement.style.overflow="hidden",()=>{document.documentElement.style.overflow=pe}},[ee]),reactExports.useEffect(()=>{ee!==fe&&ue(fe)},[fe]),[ee,ue]},Hr=({manifest:fe,theme:ee})=>{var ue;const pe=k(),_e=P(),{activeCanvas:Ne,informationOpen:Ue,vault:Ge,configOptions:qe}=pe,[Ke,Ye]=reactExports.useState(!1),[Ze,Xe]=reactExports.useState(!1),[Je,tt]=reactExports.useState([]),[rt,et]=reactExports.useState([]),[it,nt]=Vr(!1),st=je(Y.sm),lt=reactExports.useCallback(_r=>{_e({type:"updateInformationOpen",informationOpen:_r})},[_e]);return reactExports.useEffect(()=>{var _r;(_r=qe==null?void 0:qe.informationPanel)!=null&&_r.open&&lt(!st)},[st,(ue=qe==null?void 0:qe.informationPanel)==null?void 0:ue.open,lt]),reactExports.useEffect(()=>{if(!st){nt(!1);return}nt(Ue)},[Ue,st,nt]),reactExports.useEffect(()=>{const _r=O(Ge,Ne),jr=ft(Ge,Ne,"text/vtt");_r&&(Xe(["Sound","Video"].indexOf(_r[0].type)>-1),tt(_r)),et(jr),Ye(jr.length!==0)},[Ne,Ge]),e$1.createElement(ErrorBoundary,{FallbackComponent:yt},e$1.createElement(wt,{className:`${ee} clover-iiif`,css:{background:qe==null?void 0:qe.background},"data-body-locked":it,"data-information-panel":Ke,"data-information-panel-open":Ue},e$1.createElement($409067139f391064$export$be92b6f5f03c0fe9,{open:Ue,onOpenChange:lt},e$1.createElement(Pr,{manifestLabel:fe.label,manifestId:fe.id}),e$1.createElement(br,{activeCanvas:Ne,painting:Je,resources:rt,items:fe.items,isAudioVideo:Ze}))))},ce={ignoreCache:!1,headers:{Accept:"application/json, text/javascript, text/plain"},timeout:5e3,withCredentials:!1};function Br(fe){return{ok:fe.status>=200&&fe.status<300,status:fe.status,statusText:fe.statusText,headers:fe.getAllResponseHeaders(),data:fe.responseText,json:()=>JSON.parse(fe.responseText)}}function de(fe,ee=null){return{ok:!1,status:fe.status,statusText:fe.statusText,headers:fe.getAllResponseHeaders(),data:ee||fe.statusText,json:()=>JSON.parse(ee||fe.statusText)}}function Or(fe,ee=ce){const ue=ee.headers||ce.headers;return new Promise((pe,_e)=>{const Ne=new XMLHttpRequest;Ne.open("get",fe),Ne.withCredentials=ee.withCredentials,ue&&Object.keys(ue).forEach(Ue=>Ne.setRequestHeader(Ue,ue[Ue])),Ne.onload=()=>{pe(Br(Ne))},Ne.onerror=()=>{_e(de(Ne,"Failed to make request."))},Ne.ontimeout=()=>{_e(de(Ne,"Request took longer than expected."))},Ne.send()})}const Qr=({canvasIdCallback:fe=()=>{},customTheme:ee,iiifContent:ue,id:pe,manifestId:_e,options:Ne})=>{var Ue;let Ge=ue;return pe&&(Ge=pe),_e&&(Ge=_e),e$1.createElement(pt,{initialState:{...N,informationOpen:!!((Ue=Ne==null?void 0:Ne.informationPanel)!=null&&Ue.open),vault:new Vault({customFetcher:qe=>Or(qe,{withCredentials:Ne==null?void 0:Ne.withCredentials,headers:Ne==null?void 0:Ne.requestHeaders}).then(Ke=>JSON.parse(Ke.data))})}},e$1.createElement(Dr,{iiifContent:Ge,canvasIdCallback:fe,customTheme:ee,options:Ne}))},Dr=({canvasIdCallback:fe,customTheme:ee,iiifContent:ue,options:pe})=>{const _e=P(),Ne=k(),{activeCanvas:Ue,activeManifest:Ge,isLoaded:qe,vault:Ke}=Ne,[Ye,Ze]=reactExports.useState(),[Xe,Je]=reactExports.useState();let tt={};return ee&&(tt=Q$1("custom",ee)),reactExports.useEffect(()=>{fe&&fe(Ue)},[Ue,fe]),reactExports.useEffect(()=>{Ge&&Ke.loadManifest(Ge).then(rt=>{Je(rt),_e({type:"updateActiveCanvas",canvasId:rt.items[0]&&rt.items[0].id})}).catch(rt=>{console.error(`Manifest failed to load: ${rt}`)}).finally(()=>{_e({type:"updateIsLoaded",isLoaded:!0})})},[Ge,_e,Ke]),reactExports.useEffect(()=>{_e({type:"updateConfigOptions",configOptions:pe}),Ke.load(ue).then(rt=>{Ze(rt)}).catch(rt=>{console.error(`The IIIF resource ${ue} failed to load: ${rt}`)})},[_e,ue,pe,Ke]),reactExports.useEffect(()=>{let rt=[];(Ye==null?void 0:Ye.type)==="Collection"?(_e({type:"updateCollection",collection:Ye}),rt=Ye.items.filter(et=>et.type==="Manifest").map(et=>et.id),rt.length>0&&_e({type:"updateActiveManifest",manifestId:rt[0]})):(Ye==null?void 0:Ye.type)==="Manifest"&&_e({type:"updateActiveManifest",manifestId:Ye.id})},[_e,Ye]),qe?!Xe||!Xe.items?(console.log(`The IIIF manifest ${ue} failed to load.`),e$1.createElement(e$1.Fragment,null)):Xe.items.length===0?(console.log(`The IIIF manifest ${ue} does not contain canvases.`),e$1.createElement(e$1.Fragment,null)):e$1.createElement(Hr,{manifest:Xe,theme:tt,key:Xe.id}):e$1.createElement(e$1.Fragment,null,"Loading")};export{Qr as default};
