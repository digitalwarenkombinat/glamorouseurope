var ns=Object.defineProperty;var ss=(ie,Z,ee)=>Z in ie?ns(ie,Z,{enumerable:!0,configurable:!0,writable:!0,value:ee}):ie[Z]=ee;var Vi=(ie,Z,ee)=>(ss(ie,typeof Z!="symbol"?Z+"":Z,ee),ee);import{c as combineReducers,a as createStore$1,b as applyMiddleware,d as compose,r as reactExports,e as reactDomExports,$ as $2AODx$react,f as e$1,g as commonjsGlobal,h as require$$2,i as getDefaultExportFromCjs$1,j as $7SXl2$reactdom}from"./index-_ELvrt85.js";var __defProp=Object.defineProperty,__defNormalProp=(ie,Z,ee)=>Z in ie?__defProp(ie,Z,{enumerable:!0,configurable:!0,writable:!0,value:ee}):ie[Z]=ee,__publicField=(ie,Z,ee)=>(__defNormalProp(ie,typeof Z!="symbol"?Z+"":Z,ee),ee);const EMPTY=[];Object.freeze(EMPTY);const emptyAnnotationPage={id:"https://iiif-parser/annotation-page",type:"AnnotationPage",behavior:EMPTY,motivation:null,label:null,thumbnail:EMPTY,summary:null,requiredStatement:null,metadata:EMPTY,rights:null,provider:EMPTY,items:EMPTY,seeAlso:EMPTY,homepage:EMPTY,logo:EMPTY,rendering:EMPTY,service:EMPTY},emptyCanvas={id:"https://iiif-parser/empty-canvas",type:"Canvas",label:null,behavior:EMPTY,motivation:null,thumbnail:EMPTY,posterCanvas:null,accompanyingCanvas:null,placeholderCanvas:null,summary:null,requiredStatement:null,metadata:EMPTY,rights:null,navDate:null,provider:EMPTY,items:EMPTY,annotations:EMPTY,seeAlso:EMPTY,homepage:EMPTY,logo:EMPTY,partOf:EMPTY,rendering:EMPTY,service:EMPTY,duration:0,height:0,width:0},emptyCollection={id:"https://iiif-parser/empty-collection",type:"Collection",label:null,viewingDirection:"left-to-right",behavior:EMPTY,motivation:null,thumbnail:EMPTY,posterCanvas:null,accompanyingCanvas:null,placeholderCanvas:null,summary:null,requiredStatement:null,metadata:EMPTY,rights:null,navDate:null,provider:EMPTY,items:EMPTY,annotations:EMPTY,seeAlso:EMPTY,homepage:EMPTY,logo:EMPTY,partOf:EMPTY,rendering:EMPTY,service:EMPTY,services:EMPTY},emptyManifest={id:"https://iiif-parser/empty-manifest",type:"Manifest",annotations:EMPTY,behavior:EMPTY,homepage:EMPTY,items:EMPTY,label:null,logo:EMPTY,metadata:EMPTY,motivation:null,navDate:null,provider:EMPTY,partOf:EMPTY,posterCanvas:null,accompanyingCanvas:null,placeholderCanvas:null,rendering:EMPTY,requiredStatement:null,rights:null,seeAlso:EMPTY,service:EMPTY,services:EMPTY,start:null,structures:EMPTY,summary:null,thumbnail:EMPTY,viewingDirection:"left-to-right"},emptyRange={id:"https://iiif-parser/empty-canvas",type:"Range",label:null,behavior:EMPTY,motivation:null,thumbnail:EMPTY,posterCanvas:null,accompanyingCanvas:null,placeholderCanvas:null,summary:null,requiredStatement:null,metadata:EMPTY,rights:null,navDate:null,provider:EMPTY,items:EMPTY,annotations:EMPTY,seeAlso:EMPTY,homepage:EMPTY,logo:EMPTY,partOf:EMPTY,rendering:EMPTY,service:EMPTY,start:null,supplementary:null,viewingDirection:"left-to-right"},emptyAgent={id:"https://iiif-parser/empty-agent",type:"Agent",label:{},logo:EMPTY,seeAlso:EMPTY,homepage:EMPTY};function ensureArray$1(ie){return Array.isArray(ie)?ie:[ie]}const types$1=["Collection","Manifest","Canvas","AnnotationPage","AnnotationCollection","Annotation","ContentResource","Range","Service","Selector","Agent"];function identifyResource$1(ie){if(typeof ie>"u"||ie===null)throw new Error("Null or undefined is not a valid entity.");if(Array.isArray(ie))throw new Error("Array is not a valid entity");if(typeof ie!="object")throw new Error(`${typeof ie} is not a valid entity`);if(typeof ie.type=="string"){const Z=types$1.indexOf(ie.type);if(Z!==-1)return types$1[Z]}if(ie.profile)return"Service";throw new Error("Resource type is not known")}class Traverse$1{constructor(Z,ee={}){__publicField(this,"traversals"),__publicField(this,"options"),this.traversals={collection:[],manifest:[],canvas:[],annotationCollection:[],annotationPage:[],annotation:[],contentResource:[],choice:[],range:[],service:[],agent:[],...Z},this.options={allowUndefinedReturn:!1,...ee}}static all(Z){return new Traverse$1({collection:[Z],manifest:[Z],canvas:[Z],annotationCollection:[Z],annotationPage:[Z],annotation:[Z],contentResource:[Z],choice:[Z],range:[Z],service:[Z]})}traverseDescriptive(Z){return Z.thumbnail&&(Z.thumbnail=Z.thumbnail.map(ee=>this.traverseType(ee,this.traversals.contentResource))),Z.provider&&(Z.provider=Z.provider.map(ee=>this.traverseAgent(ee))),Z}traverseLinking(Z){return Z.seeAlso&&(Z.seeAlso=Z.seeAlso.map(ee=>this.traverseType(ee,this.traversals.contentResource))),Z.service&&(Z.service=ensureArray$1(Z.service).map(ee=>this.traverseType(ee,this.traversals.service))),Z.services&&(Z.services=Z.services.map(ee=>this.traverseType(ee,this.traversals.service))),Z.logo&&(Z.logo=Z.logo.map(ee=>this.traverseType(ee,this.traversals.contentResource))),Z.homepage&&(Z.homepage=Z.homepage.map(ee=>this.traverseType(ee,this.traversals.contentResource))),Z.partOf&&(Z.partOf=Z.partOf.map(ee=>typeof ee=="string"||!ee.type?this.traverseType(ee,this.traversals.contentResource):ee.type==="Canvas"?this.traverseType(ee,this.traversals.canvas):ee.type==="AnnotationCollection"?this.traverseType(ee,this.traversals.annotationCollection):ee.type==="Collection"?this.traverseType(ee,this.traversals.collection):this.traverseType(ee,this.traversals.contentResource))),Z.start&&(Z.start=Z.start?this.traverseType(Z.start,this.traversals.canvas):null),Z.rendering&&(Z.rendering=Z.rendering.map(ee=>this.traverseType(ee,this.traversals.contentResource))),Z.supplementary&&(Z.supplementary=Z.supplementary.map(ee=>this.traverseType(ee,this.traversals.contentResource))),Z}traverseCollectionItems(Z){return Z.items&&Z.items.map(ee=>ee.type==="Collection"?this.traverseCollection(ee):this.traverseManifest(ee)),Z}traverseCollection(Z){return this.traverseType(this.traverseDescriptive(this.traverseInlineAnnotationPages(this.traverseLinking(this.traversePosterCanvas(this.traverseCollectionItems(Z))))),this.traversals.collection)}traverseManifestItems(Z){return Z.items&&(Z.items=Z.items.map(ee=>this.traverseCanvas(ee))),Z}traverseManifestStructures(Z){return Z.structures&&(Z.structures=Z.structures.map(ee=>this.traverseRange(ee))),Z}traverseManifest(Z){return this.traverseType(this.traverseInlineAnnotationPages(this.traverseManifestStructures(this.traversePosterCanvas(this.traverseDescriptive(this.traverseLinking(this.traverseManifestItems(Z)))))),this.traversals.manifest)}traverseCanvasItems(Z){return Z.items=(Z.items||[]).map(ee=>this.traverseAnnotationPage(ee)),Z}traverseInlineAnnotationPages(Z){return typeof Z=="string"||!Z||Z.annotations&&(Z.annotations=Z.annotations.map(ee=>this.traverseAnnotationPage(ee))),Z}traverseCanvas(Z){return this.traverseType(this.traverseInlineAnnotationPages(this.traversePosterCanvas(this.traverseDescriptive(this.traverseLinking(this.traverseCanvasItems(Z))))),this.traversals.canvas)}traverseAnnotationPageItems(Z){return Z.items&&(Z.items=Z.items.map(ee=>this.traverseAnnotation(ee))),Z}traverseAnnotationPage(Z){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseAnnotationPageItems(Z))),this.traversals.annotationPage)}traverseAnnotationBody(Z){return Array.isArray(Z.body)?Z.body=Z.body.map(ee=>this.traverseContentResource(ee)):Z.body&&(Z.body=this.traverseContentResource(Z.body)),Z}traversePosterCanvas(Z){return Z.posterCanvas&&(Z.posterCanvas=this.traverseCanvas(Z.posterCanvas)),Z.placeholderCanvas&&(Z.placeholderCanvas=this.traverseCanvas(Z.placeholderCanvas)),Z.accompanyingCanvas&&(Z.accompanyingCanvas=this.traverseCanvas(Z.accompanyingCanvas)),Z}traverseAnnotation(Z){return this.traverseType(this.traverseLinking(this.traverseAnnotationBody(Z)),this.traversals.annotation)}traverseContentResourceLinking(Z){return typeof Z=="string"||!Z||Z&&Z.service&&(Z.service=ensureArray$1(Z.service||[]).map(ee=>this.traverseType(ee,this.traversals.service))),Z}traverseContentResource(Z){return Z.type==="Choice"&&(Z.items=Z.items.map(ee=>this.traverseContentResource(ee))),this.traverseType(this.traverseInlineAnnotationPages(this.traverseContentResourceLinking(Z)),this.traversals.contentResource)}traverseRangeRanges(Z){return Z.items&&(Z.items=Z.items.map(ee=>typeof ee=="string"?this.traverseCanvas({id:ee,type:"Canvas"}):ee.type==="Manifest"?this.traverseManifest(ee):this.traverseRange(ee))),Z}traverseRange(Z){return this.traverseType(this.traversePosterCanvas(this.traverseDescriptive(this.traverseLinking(this.traverseRangeRanges(Z)))),this.traversals.range)}traverseAgent(Z){return this.traverseType(this.traverseDescriptive(this.traverseLinking(Z)),this.traversals.agent)}traverseType(Z,ee){return ee.reduce((ae,ve)=>{const ye=ve(ae);return typeof ye>"u"&&!this.options.allowUndefinedReturn?ae:ye},Z)}traverseService(Z){return this.traverseType(Z,this.traversals.service)}traverseUnknown(Z){const ee=identifyResource$1(Z);switch(ee){case"Collection":return this.traverseCollection(Z);case"Manifest":return this.traverseManifest(Z);case"Canvas":return this.traverseCanvas(Z);case"AnnotationPage":return this.traverseAnnotationPage(Z);case"Annotation":return this.traverseAnnotation(Z);case"ContentResource":return this.traverseContentResource(Z);case"Range":return this.traverseRange(Z);case"Service":return this.traverseService(Z);case"Agent":return this.traverseAgent(Z);default:throw new Error(`Unknown or unsupported resource type of ${ee}`)}}}const types=["sc:Collection","sc:Manifest","sc:Canvas","sc:AnnotationList","oa:Annotation","sc:Range","sc:Layer","sc:Sequence","oa:Choice","Service","ContentResource"];function identifyResource(ie){if(typeof ie>"u"||ie===null)throw new Error("Null or undefined is not a valid entity.");if(Array.isArray(ie))throw new Error("Array is not a valid entity");if(typeof ie!="object")throw new Error(`${typeof ie} is not a valid entity`);if(typeof ie["@type"]=="string"){const Z=types.indexOf(ie["@type"]);if(Z!==-1)return types[Z]}if(ie.profile)return"Service";if(ie.format||ie["@type"])return"ContentResource";throw new Error("Resource type is not known")}class Traverse{constructor(Z,ee={}){__publicField(this,"traversals"),__publicField(this,"options"),this.traversals={collection:[],manifest:[],canvas:[],annotationList:[],sequence:[],annotation:[],contentResource:[],choice:[],range:[],service:[],layer:[],...Z},this.options={convertPropsToArray:!0,mergeMemberProperties:!0,allowUndefinedReturn:!1,...ee}}static all(Z){return new Traverse({collection:[Z],manifest:[Z],canvas:[Z],annotationList:[Z],sequence:[Z],annotation:[Z],contentResource:[Z],choice:[Z],range:[Z],service:[Z],layer:[Z]})}traverseCollection(Z){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseCollectionItems(Z))),this.traversals.collection)}traverseCollectionItems(Z){if(this.options.mergeMemberProperties){const ee=[...(Z.manifests||[]).map(ae=>typeof ae=="string"?{"@id":ae,"@type":"sc:Manifest"}:ae),...(Z.collections||[]).map(ae=>typeof ae=="string"?{"@id":ae,"@type":"sc:Collection"}:ae),...Z.members||[]];delete Z.collections,delete Z.manifests,Z.members=ee}return Z.manifests&&(Z.manifests=Z.manifests.map(ee=>this.traverseManifest(typeof ee=="string"?{"@id":ee,"@type":"sc:Manifest"}:ee))),Z.collections&&(Z.collections=Z.collections.map(ee=>this.traverseCollection(typeof ee=="string"?{"@id":ee,"@type":"sc:Collection"}:ee))),Z.members&&(Z.members=Z.members.map(ee=>typeof ee=="string"?ee:this.traverseUnknown(ee))),Z}traverseManifest(Z){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseManifestItems(Z))),this.traversals.manifest)}traverseManifestItems(Z){return Z.sequences&&(Z.sequences=Z.sequences.map(ee=>this.traverseSequence(ee))),Z.structures&&(Z.structures=Z.structures.map(ee=>this.traverseRange(ee))),Z}traverseSequence(Z){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseSequenceItems(Z))),this.traversals.sequence)}traverseSequenceItems(Z){return Z.canvases&&(Z.canvases=Z.canvases.map(ee=>this.traverseCanvas(ee))),Z}traverseCanvas(Z){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseCanvasItems(Z))),this.traversals.canvas)}traverseCanvasItems(Z){return Z.images&&(Z.images=Z.images.map(ee=>this.traverseAnnotation(ee))),Z.otherContent&&(Z.otherContent=Z.otherContent.map(ee=>this.traverseAnnotationList(ee))),Z}traverseRange(Z){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseRangeItems(Z))),this.traversals.range)}traverseRangeItems(Z){if(this.options.mergeMemberProperties){const ee=[...(Z.ranges||[]).map(ae=>typeof ae=="string"?{"@id":ae,"@type":"sc:Range"}:ae),...(Z.canvases||[]).map(ae=>typeof ae=="string"?{"@id":ae,"@type":"sc:Canvas"}:ae),...Z.members||[]];delete Z.ranges,delete Z.canvases,Z.members=ee.length?ee.map(ae=>this.traverseUnknown(ae)):void 0}return Z}traverseAnnotationList(Z){const ee=typeof Z=="string"?{"@id":Z,"@type":"sc:AnnotationList"}:Z;return this.traverseType(this.traverseDescriptive(this.traverseAnnotationListItems(ee)),this.traversals.annotationList)}traverseAnnotationListItems(Z){return Z.resources&&(Z.resources=Z.resources.map(ee=>this.traverseAnnotation(ee))),Z}traverseAnnotation(Z){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseAnnotationItems(Z))),this.traversals.annotation)}traverseAnnotationItems(Z){return Z.resource&&(Array.isArray(Z.resource)?Z.resource=Z.resource.map(ee=>this.traverseContentResource(ee)):Z.resource=this.traverseContentResource(Z.resource)),Z.on,Z}traverseLayer(Z){return this.traverseType(this.traverseLinking(this.traverseLayerItems(Z)),this.traversals.layer)}traverseLayerItems(Z){return Z.otherContent&&(Z.otherContent=Z.otherContent.map(ee=>this.traverseAnnotationList(ee))),Z}traverseChoice(Z){return this.traverseType(this.traverseChoiceItems(Z),this.traversals.choice)}traverseChoiceItems(Z){return Z.default&&Z.default!=="rdf:nil"&&(Z.default=this.traverseContentResource(Z.default)),Z.item&&Z.item!=="rdf:nil"&&(Z.item=Z.item.map(ee=>this.traverseContentResource(ee))),Z}traverseService(Z){return this.traverseType(this.traverseLinking(Z),this.traversals.service)}traverseContentResource(Z){return Z["@type"]==="oa:Choice"?this.traverseChoice(Z):this.traverseType(this.traverseDescriptive(this.traverseLinking(Z)),this.traversals.contentResource)}traverseUnknown(Z){if(!Z["@type"]||typeof Z=="string")return Z;switch(identifyResource(Z)){case"sc:Collection":return this.traverseCollection(Z);case"sc:Manifest":return this.traverseManifest(Z);case"sc:Canvas":return this.traverseCanvas(Z);case"sc:Sequence":return this.traverseSequence(Z);case"sc:Range":return this.traverseRange(Z);case"oa:Annotation":return this.traverseAnnotation(Z);case"sc:AnnotationList":return this.traverseAnnotationList(Z);case"sc:Layer":return this.traverseLayer(Z);case"Service":return this.traverseService(Z);case"oa:Choice":return this.traverseChoice(Z);case"ContentResource":return this.traverseContentResource(Z)}return Z.profile?this.traverseService(Z):Z}traverseImageResource(Z){const ee=Array.isArray(Z),ae=Array.isArray(Z)?Z:[Z],ve=[];for(const ye of ae)typeof ye=="string"?ve.push(this.traverseContentResource({"@id":ye,"@type":"dctypes:Image"})):ve.push(this.traverseContentResource(ye));return!ee&&!this.options.convertPropsToArray?ve[0]:ve}traverseDescriptive(Z){return Z.thumbnail&&(Z.thumbnail=this.traverseImageResource(Z.thumbnail)),Z.logo&&(Z.logo=this.traverseImageResource(Z.logo)),Z}traverseOneOrMoreServices(Z){const ee=Array.isArray(Z),ae=Array.isArray(Z)?Z:[Z],ve=[];for(const ye of ae)ve.push(this.traverseService(ye));return!ee&&!this.options.convertPropsToArray?ve[0]:ve}traverseLinking(Z){return Z.related&&(Z.related=this.traverseOneOrManyType(Z.related,this.traversals.contentResource)),Z.rendering&&(Z.rendering=this.traverseOneOrManyType(Z.rendering,this.traversals.contentResource)),Z.service&&(Z.service=this.traverseOneOrMoreServices(Z.service)),Z.seeAlso&&(Z.seeAlso=this.traverseOneOrManyType(Z.seeAlso,this.traversals.contentResource)),Z.within&&(typeof Z.within=="string"||(Z.within=this.traverseOneOrManyType(Z.within,this.traversals.contentResource))),Z.startCanvas&&(typeof Z.startCanvas=="string"?Z.startCanvas=this.traverseType({"@id":Z.startCanvas,"@type":"sc:Canvas"},this.traversals.canvas):Z.startCanvas&&this.traverseType(Z.startCanvas,this.traversals.canvas)),Z.contentLayer&&(typeof Z.contentLayer=="string"?Z.contentLayer=this.traverseLayer({"@id":Z.contentLayer,"@type":"sc:Layer"}):Z.contentLayer=this.traverseLayer(Z.contentLayer)),Z}traverseOneOrManyType(Z,ee){if(!Array.isArray(Z))if(this.options.convertPropsToArray)Z=[Z];else return this.traverseType(Z,ee);return Z.map(ae=>this.traverseType(ae,ee))}traverseType(Z,ee){return ee.reduce((ae,ve)=>{const ye=ve(ae);return typeof ye>"u"&&!this.options.allowUndefinedReturn?ae:ye},Z)}}const STANFORD_IIIF_IMAGE_COMPLIANCE_0="http://library.stanford.edu/iiif/image-api/compliance.html#level0",STANFORD_IIIF_IMAGE_COMPLIANCE_1="http://library.stanford.edu/iiif/image-api/compliance.html#level1",STANFORD_IIIF_IMAGE_COMPLIANCE_2="http://library.stanford.edu/iiif/image-api/compliance.html#level2",STANFORD_IIIF_IMAGE_CONFORMANCE_0="http://library.stanford.edu/iiif/image-api/conformance.html#level0",STANFORD_IIIF_IMAGE_CONFORMANCE_1="http://library.stanford.edu/iiif/image-api/conformance.html#level1",STANFORD_IIIF_IMAGE_CONFORMANCE_2="http://library.stanford.edu/iiif/image-api/conformance.html#level2",STANFORD_IIIF_1_IMAGE_COMPLIANCE_0="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0",STANFORD_IIIF_1_IMAGE_COMPLIANCE_1="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1",STANFORD_IIIF_1_IMAGE_COMPLIANCE_2="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2",STANFORD_IIIF_1_IMAGE_CONFORMANCE_0="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0",STANFORD_IIIF_1_IMAGE_CONFORMANCE_1="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1",STANFORD_IIIF_1_IMAGE_CONFORMANCE_2="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2",IIIF_1_IMAGE_LEVEL_0="http://iiif.io/api/image/1/level0.json",IIIF_1_IMAGE_LEVEL_0_PROFILE="http://iiif.io/api/image/1/profiles/level0.json",IIIF_1_IMAGE_LEVEL_1="http://iiif.io/api/image/1/level1.json",IIIF_1_IMAGE_LEVEL_1_PROFILE="http://iiif.io/api/image/1/profiles/level1.json",IIIF_1_IMAGE_LEVEL_2="http://iiif.io/api/image/1/level2.json",IIIF_1_IMAGE_LEVEL_2_PROFILE="http://iiif.io/api/image/1/profiles/level2.json",IIIF_2_IMAGE_LEVEL_0="http://iiif.io/api/image/2/level0.json",IIIF_2_IMAGE_LEVEL_0_PROFILE="http://iiif.io/api/image/2/profiles/level0.json",IIIF_2_IMAGE_LEVEL_1="http://iiif.io/api/image/2/level1.json",IIIF_2_IMAGE_LEVEL_1_PROFILE="http://iiif.io/api/image/2/profiles/level1.json",IIIF_2_IMAGE_LEVEL_2="http://iiif.io/api/image/2/level2.json",IIIF_2_IMAGE_LEVEL_2_PROFILE="http://iiif.io/api/image/2/profiles/level2.json",IIIF_3_IMAGE_LEVEL_0="level0",IIIF_3_IMAGE_LEVEL_1="level1",IIIF_3_IMAGE_LEVEL_2="level2",IIIF_2_IMAGE_LEVEL_0_NO_JSON="http://iiif.io/api/image/2/level0",IIIF_2_IMAGE_LEVEL_1_NO_JSON="http://iiif.io/api/image/2/level1",IIIF_2_IMAGE_LEVEL_2_NO_JSON="http://iiif.io/api/image/2/level2",level1Support=[IIIF_2_IMAGE_LEVEL_1_NO_JSON,IIIF_2_IMAGE_LEVEL_2_NO_JSON,STANFORD_IIIF_IMAGE_COMPLIANCE_1,STANFORD_IIIF_IMAGE_COMPLIANCE_2,STANFORD_IIIF_IMAGE_CONFORMANCE_1,STANFORD_IIIF_IMAGE_CONFORMANCE_2,STANFORD_IIIF_1_IMAGE_COMPLIANCE_1,STANFORD_IIIF_1_IMAGE_COMPLIANCE_2,STANFORD_IIIF_1_IMAGE_CONFORMANCE_1,STANFORD_IIIF_1_IMAGE_CONFORMANCE_2,IIIF_1_IMAGE_LEVEL_1,IIIF_1_IMAGE_LEVEL_1_PROFILE,IIIF_1_IMAGE_LEVEL_2,IIIF_1_IMAGE_LEVEL_2_PROFILE,IIIF_2_IMAGE_LEVEL_1,IIIF_2_IMAGE_LEVEL_1_PROFILE,IIIF_2_IMAGE_LEVEL_2,IIIF_2_IMAGE_LEVEL_2_PROFILE,IIIF_3_IMAGE_LEVEL_1,IIIF_3_IMAGE_LEVEL_2],imageServiceProfiles=[IIIF_2_IMAGE_LEVEL_0_NO_JSON,IIIF_2_IMAGE_LEVEL_1_NO_JSON,IIIF_2_IMAGE_LEVEL_2_NO_JSON,STANFORD_IIIF_IMAGE_COMPLIANCE_0,STANFORD_IIIF_IMAGE_COMPLIANCE_1,STANFORD_IIIF_IMAGE_COMPLIANCE_2,STANFORD_IIIF_IMAGE_CONFORMANCE_0,STANFORD_IIIF_IMAGE_CONFORMANCE_1,STANFORD_IIIF_IMAGE_CONFORMANCE_2,STANFORD_IIIF_1_IMAGE_COMPLIANCE_0,STANFORD_IIIF_1_IMAGE_COMPLIANCE_1,STANFORD_IIIF_1_IMAGE_COMPLIANCE_2,STANFORD_IIIF_1_IMAGE_CONFORMANCE_0,STANFORD_IIIF_1_IMAGE_CONFORMANCE_1,STANFORD_IIIF_1_IMAGE_CONFORMANCE_2,IIIF_1_IMAGE_LEVEL_0,IIIF_1_IMAGE_LEVEL_0_PROFILE,IIIF_1_IMAGE_LEVEL_1,IIIF_1_IMAGE_LEVEL_1_PROFILE,IIIF_1_IMAGE_LEVEL_2,IIIF_1_IMAGE_LEVEL_2_PROFILE,IIIF_2_IMAGE_LEVEL_0,IIIF_2_IMAGE_LEVEL_0_PROFILE,IIIF_2_IMAGE_LEVEL_1,IIIF_2_IMAGE_LEVEL_1_PROFILE,IIIF_2_IMAGE_LEVEL_2,IIIF_2_IMAGE_LEVEL_2_PROFILE,IIIF_3_IMAGE_LEVEL_0,IIIF_3_IMAGE_LEVEL_1,IIIF_3_IMAGE_LEVEL_2],configuration={attributionLabel:"Attribution",lang:"none",providerId:"http://example.org/provider",providerName:"Unknown"};function convertLanguageMapping(ie,Z="none"){if(!ie)return{};const ee=Array.isArray(ie)?ie:[ie],ae={};for(const ve of ee){if(typeof ve=="string"){ae[Z]=ae[Z]?ae[Z]:[],ae[Z].push(ve||"");continue}if(!ve["@language"]){ae[Z]=ae[Z]?ae[Z]:[],ae[Z].push(ve["@value"]||"");continue}const ye=ve["@language"];ae[ye]=ae[ye]?ae[ye]:[],ae[ye].push(ve["@value"]||"")}return ae}function getProfile(ie){if(Array.isArray(ie))return getProfile(ie.find(Z=>typeof Z=="string"));if(imageServiceProfiles.indexOf(ie)!==-1)return"level2";if(level1Support.indexOf(ie)!==-1)return"level1";if(typeof ie=="string")return ie}function getTypeFromContext(ie){const Z=Array.isArray(ie)?ie:[ie];for(const ee of Z)switch(ee){case"http://iiif.io/api/image/2/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2":return"ImageService2";case"http://iiif.io/api/image/1/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/context.json":return"ImageService1";case"http://iiif.io/api/annex/openannotation/context.json":return"ImageApiSelector"}}function getTypeFromProfile(ie){switch(ie){case"http://iiif.io/api/image/2/level0.json":case"http://iiif.io/api/image/2/level1.json":case"http://iiif.io/api/image/2/level2.json":return"ImageService2";case"http://iiif.io/api/auth/1/kiosk":case"http://iiif.io/api/auth/1/login":case"http://iiif.io/api/auth/1/clickthrough":case"http://iiif.io/api/auth/1/external":case"http://iiif.io/api/auth/0/kiosk":case"http://iiif.io/api/auth/0/login":case"http://iiif.io/api/auth/0/clickthrough":case"http://iiif.io/api/auth/0/external":return"AuthCookieService1";case"http://iiif.io/api/auth/1/token":case"http://iiif.io/api/auth/0/token":return"AuthTokenService1";case"http://iiif.io/api/auth/1/logout":case"http://iiif.io/api/auth/0/logout":return"AuthLogoutService1";case"http://iiif.io/api/search/1/search":case"http://iiif.io/api/search/0/search":return"SearchService1";case"http://iiif.io/api/search/1/autocomplete":case"http://iiif.io/api/search/0/autocomplete":return"AutoCompleteService1"}}function removePrefix(ie){for(const Z of["sc","oa","dcterms","dctypes","iiif"])if(ie.startsWith(`${Z}:`))return ie.slice(Z.length+1);return ie}const knownTypes=["Collection","Manifest","Annotation","AnnotationPage","Range","Service"];function getNewType(ie){const Z=ie["@id"]||ie.id;let ee=ie["@type"]||ie.type;const ae=ie.profile||void 0,ve=ie["@context"]||void 0;if(ae){const ye=getTypeFromProfile(ae);if(ye)return ye}if(ve){const ye=getTypeFromContext(ve);if(ye)return ye}if(ee){if(Array.isArray(ee)){if(ee.indexOf("oa:CssStylesheet")!==-1)return"CssStylesheet";if(ee.indexOf("cnt:ContentAsText")!==-1)return"TextualBody";ee=ee[0]}for(const ye of["sc","oa","dcterms","dctypes","iiif"])if(ee.startsWith(`${ye}:`)){ee=ee.slice(ye.length+1);break}switch(ee){case"Layer":return"AnnotationCollection";case"AnnotationList":return"AnnotationPage";case"cnt:ContentAsText":return"TextualBody"}}if(ee&&knownTypes.indexOf(ee)!==-1)return ee;if(ie.format){if(ie.format.startsWith("image/"))return"Image";if(ie.format.startsWith("text/")||ie.format==="application/pdf")return"Text";if(ie.format.startsWith("application/"))return"Dataset"}return Z&&(Z.endsWith(".jpg")||Z.endsWith(".png")||Z.endsWith(".jpeg"))?"Image":ee||"unknown"}const licenseRegex=/http(s)?:\/\/(creativecommons.org|rightsstatements.org)[^"'\\<\n]+/gm;function extractLicense(ie){const Z=ie.match(licenseRegex);return Z?Z[0]:ie}function fixLicense(ie,Z="Rights/License",ee="none"){let ae=null;const ve=[],ye=Array.isArray(ie)?ie:[ie];for(const be of ye){const Ke=be?extractLicense(be):void 0;if(Ke&&(Ke.indexOf("creativecommons.org")!==-1||Ke.indexOf("rightsstatements.org")!==-1)){Ke.startsWith("https://")?ae=`http://${Ke.slice(8)}`:ae=Ke;continue}Ke&&ve.push({label:{[ee]:[Z]},value:{[ee]:[Ke]}})}return[ae,ve]}const removeContexts=["http://iiif.io/api/presentation/2/context.json","http://iiif.io/api/image/2/context.json","http://iiif.io/api/image/1/context.json","http://library.stanford.edu/iiif/image-api/1.1/context.json","http://iiif.io/api/search/1/context.json","http://iiif.io/api/search/0/context.json","http://iiif.io/api/auth/1/context.json","http://iiif.io/api/auth/0/context.json","http://iiif.io/api/annex/openannotation/context.json"];function fixContext(ie){if(ie){const Z=Array.isArray(ie)?ie:[ie],ee=[];for(const ae of Z)ae==="http://iiif.io/api/presentation/2/context.json"&&ee.push("http://iiif.io/api/presentation/3/context.json"),removeContexts.indexOf(ae)===-1&&ee.push(ae);if(Z.length)return ee.length===1?ee[0]:ee}}function convertMetadata(ie){return ie?ie.map(Z=>({label:convertLanguageMapping(Z.label),value:convertLanguageMapping(Z.value)})):[]}function removeUndefinedProperties(ie){for(const Z in ie)(typeof ie[Z]>"u"||ie[Z]===null)&&delete ie[Z];return ie}let mintedIdCounter=0;function mintNewIdFromResource(ie,Z){const ee=encodeURI(ie.id||ie["@id"]||"").trim();return ee&&Z?`${ee}/${Z}`:ee||(mintedIdCounter++,`http://example.org/${ie["@type"]}${Z?`/${Z}`:""}/${mintedIdCounter}`)}function technicalProperties$2(ie){const Z=[...ie.behavior||[]];ie.viewingHint&&Z.push(ie.viewingHint);let ee;return Array.isArray(ie.motivation)?ee=ie.motivation.map(removePrefix):ie.motivation&&(ee=removePrefix(ie.motivation)),{"@context":ie["@context"]?fixContext(ie["@context"]):void 0,id:(ie["@id"]||mintNewIdFromResource(ie)).trim(),type:getNewType(ie),behavior:Z.length?Z:void 0,height:ie.height?ie.height:void 0,width:ie.width?ie.width:void 0,motivation:ee,viewingDirection:ie.viewingDirection,profile:ie.profile,format:ie.format?ie.format:void 0,duration:void 0,timeMode:void 0}}function descriptiveProperties$2(ie){const[Z,ee]=fixLicense(ie.license),ae=[...ie.metadata?convertMetadata(ie.metadata):[],...ee];return{rights:Z,metadata:ae.length?ae:void 0,label:ie.label?convertLanguageMapping(ie.label):void 0,requiredStatement:ie.attribution?{label:convertLanguageMapping(configuration.attributionLabel),value:convertLanguageMapping(ie.attribution)}:void 0,navDate:ie.navDate,summary:ie.description?convertLanguageMapping(ie.description):void 0,thumbnail:ie.thumbnail}}function parseWithin(ie){if(!ie.within)return;const Z=Array.isArray(ie.within)?ie.within:[ie.within],ee=[];for(const ae of Z)if(typeof ae=="string"){if(ae)switch(ie["@type"]){case"sc:Manifest":ee.push({id:ae,type:"Collection"});break}}else ae["@id"]&&ee.push({id:ae["@id"],type:getNewType(ae)});return ee.length?ee:void 0}function linkingProperties$2(ie){const Z=ie.related?Array.isArray(ie.related)?ie.related:[ie.related]:[],ee=ie.contentLayer;return{provider:ie.logo||Z.length?[{id:configuration.providerId,type:"Agent",homepage:Z.length?[Z[0]]:void 0,logo:ie.logo?Array.isArray(ie.logo)?ie.logo:[ie.logo]:void 0,label:convertLanguageMapping(configuration.providerName)}]:void 0,partOf:parseWithin(ie),rendering:ie.rendering,seeAlso:ie.seeAlso,start:ie.startCanvas,service:ie.service?ensureArray$1(ie.service):void 0,supplementary:ee?[ee]:void 0}}function embeddedContentProperties(ie){return{chars:ie.chars,format:ie.format?ie.format:void 0,language:ie.language}}function upgradeCollection(ie){return removeUndefinedProperties({...technicalProperties$2(ie),...descriptiveProperties$2(ie),...linkingProperties$2(ie),items:ie.members})}function upgradeManifest(ie){const Z=[],ee=[];for(const ve of ie.sequences||[])ve.canvases.length&&Z.push(...ve.canvases),ve.behavior&&ee.push(...ve.behavior);const ae=technicalProperties$2(ie);return ee.length&&(ae.behavior?ae.behavior.push(...ee):ae.behavior=ee),removeUndefinedProperties({...ae,...descriptiveProperties$2(ie),...linkingProperties$2(ie),items:Z,structures:ie.structures})}function upgradeCanvas(ie){return removeUndefinedProperties({...technicalProperties$2(ie),...descriptiveProperties$2(ie),...linkingProperties$2(ie),annotations:ie.otherContent&&ie.otherContent.length?ie.otherContent:void 0,items:ie.images&&ie.images.length?[{id:mintNewIdFromResource(ie,"annotation-page"),type:"AnnotationPage",items:ie.images}]:void 0})}function upgradeAnnotationList(ie){return removeUndefinedProperties({...technicalProperties$2(ie),...descriptiveProperties$2(ie),...linkingProperties$2(ie),items:ie.resources&&ie.resources.length?ie.resources:void 0})}function upgradeSequence(ie){return!ie.canvases||ie.canvases.length===0?{canvases:[],behavior:[]}:{canvases:ie.canvases,behavior:ie.viewingHint?[ie.viewingHint]:[]}}function upgradeAnnotation(ie){function Z(ee){if(Array.isArray(ee)){if(ee.length>1)return{type:"List",items:ee.map(Z)};ee=ee[0]}if(typeof ee=="string")return encodeURI(ee).trim();if("@type"in ee){let ae;if(typeof ee.full=="string")ae=ee.full;else if(ee.full["@type"]==="dctypes:Image")ae={id:ee.full["@id"],type:"Image"};else if(ee.full["@type"]==="sc:Canvas")ae={id:ee.full["@id"],type:"Canvas"};else throw new Error(`Unsupported source type on annotation: ${ee.full["@type"]}`);return{type:"SpecificResource",source:ae,selector:upgradeSelector(ee.selector)}}else return encodeURI(ee["@id"]).trim()}return removeUndefinedProperties({...technicalProperties$2(ie),...descriptiveProperties$2(ie),...linkingProperties$2(ie),target:Z(ie.on),body:Array.isArray(ie.resource)?ie.resource.map(upgradeContentResource):upgradeContentResource(ie.resource)})}function upgradeContentResource(ie){const Z=ie;return removeUndefinedProperties({...technicalProperties$2(Z),...descriptiveProperties$2(Z),...linkingProperties$2(Z),...embeddedContentProperties(Z)})}function upgradeChoice(ie){const Z=[];return ie.default&&ie.default!=="rdf:nil"&&Z.push(ie.default),ie.item&&ie.item!=="rdf:nil"&&Z.push(...ie.item),{...technicalProperties$2(ie),...descriptiveProperties$2(ie),items:Z}}function upgradeRange(ie){return removeUndefinedProperties({...technicalProperties$2(ie),...descriptiveProperties$2(ie),...linkingProperties$2(ie),items:ie.members})}function upgradeService(ie){const{"@id":Z,"@type":ee,"@context":ae,profile:ve,...ye}=ie,be={};return Z&&(be["@id"]=Z),be["@type"]=getNewType(ie),be["@type"]==="unknown"&&(ae&&ae.length&&(be["@context"]=ae),be["@type"]="Service"),ve&&(be.profile=getProfile(ve)),removeUndefinedProperties({...be,...ye})}function upgradeLayer(ie){return removeUndefinedProperties({...technicalProperties$2(ie),...descriptiveProperties$2(ie),...linkingProperties$2(ie)})}const presentation2to3=new Traverse({collection:[upgradeCollection],manifest:[upgradeManifest],canvas:[upgradeCanvas],annotationList:[upgradeAnnotationList],sequence:[upgradeSequence],annotation:[upgradeAnnotation],contentResource:[upgradeContentResource],choice:[upgradeChoice],range:[upgradeRange],service:[upgradeService],layer:[upgradeLayer]});function convertPresentation2(ie){return ie&&ie["@context"]&&(ie["@context"]==="http://iiif.io/api/presentation/2/context.json"||ie["@context"].indexOf("http://iiif.io/api/presentation/2/context.json")!==-1||ie["@context"]==="http://www.shared-canvas.org/ns/context.json")||ie["@context"]==="http://iiif.io/api/image/2/context.json"?presentation2to3.traverseUnknown(ie):ie}function upgradeSelector(ie){if((Array.isArray(ie["@type"])&&ie["@type"].includes("oa:SvgSelector")||ie["@type"]=="oa:SvgSelector")&&("chars"in ie||"value"in ie))return{type:"SvgSelector",value:"chars"in ie?ie.chars:ie.value};if(ie["@type"]==="oa:FragmentSelector")return{type:"FragmentSelector",value:ie.value};if(ie["@type"]==="oa:Choice")return[upgradeSelector(ie.default),...(Array.isArray(ie.item)?ie.item:[ie.item]).map(upgradeSelector)];if(ie["@type"]=="iiif:ImageApiSelector")return{type:"ImageApiSelector",region:"region"in ie?ie.region:void 0,rotation:"rotation"in ie?ie.rotation:void 0};throw new Error(`Unsupported selector type: ${ie["@type"]}`)}function getDefaultEntities$1(){return{Collection:{},Manifest:{},Canvas:{},AnnotationPage:{},AnnotationCollection:{},Annotation:{},ContentResource:{},Range:{},Service:{},Selector:{},Agent:{}}}function getResource(ie,Z){if(typeof ie=="string")return{id:ie,type:Z};if(!ie.id)throw new Error(`Invalid resource does not have an ID (${Z})`);return ie}function mapToEntities(ie){return(Z,ee)=>{const ae=ie[Z]?ie[Z]:{};return ve=>{const ye=getResource(ve,ee||Z);return ye&&ye.id&&Z?(ae[ye.id]=ae[ye.id]?mergeEntities(ae[ye.id],ye):Object.assign({},ye),{id:ye.id,type:Z==="ContentResource"?Z:ye.type}):ye}}}function merge(ie,Z){if(!Z)return ie;if(Array.isArray(ie)){if(!Array.isArray(Z))throw new Error("Cannot merge array with non-array");const ee=[...ie];for(const ae of Z)if(ae!=null)if(Array.isArray(ae))ee.push(ae);else if(typeof ae=="object"&&ae.id&&ae.type){const ve=ee.findIndex(ye=>ye.id===ae.id&&ye.type===ae.type);ve>=0&&(ee[ve]=merge(ee[ve],ae))}else ie.indexOf(ae)===-1&&ee.push(ae);return ee}else if(typeof ie=="object"){if(Array.isArray(Z)||typeof Z!="object")throw new Error("Cannot merge object with non-object");const ee={...ie};for(const[ae,ve]of Object.entries(Z)){const ye=ee[ae];ye===EMPTY||!ye?ee[ae]=ve:ee[ae]=merge(ye,ve)}return ee}else if(ie)return ie;return Z}function mergeEntities(ie,Z){if(typeof ie=="string")return ie;if(Z.id!==ie.id||Z.type!==ie.type)throw new Error("Can only merge entities with identical identifiers and type!");return merge({...ie},Z)}function recordTypeInMapping(ie){return(Z,ee)=>ae=>{const{id:ve,type:ye}=getResource(ae,ee||Z);if(typeof ve>"u")throw new Error("Found invalid entity without an ID.");return Z==="ContentResource"?ie[ve]=Z:ie[ve]=ye,ae}}function hash$1(ie){const Z=JSON.stringify(ie);let ee=5381,ae=Z.length;for(;ae;)ee=ee*33^Z.charCodeAt(--ae);const ye=(ee>>>0).toString(16);return ye.length%2?"0"+ye:ye}function addMissingIdToContentResource(ie){return Z=>typeof Z=="string"?{id:Z,type:ie}:Z.id?Z.type?Z:{type:ie,...Z}:{id:`vault://${hash$1(Z)}`,type:ie,...Z}}function ensureDefaultFields(ie){return Z=>({...ie,...Z})}function ensureArray(ie){return Array.isArray(ie)?ie:[ie]}function ensureArrayOnAnnotation(ie){return ie.body&&(ie.body=ensureArray(ie.body)),ie.seeAlso&&(ie.seeAlso=ensureArray(ie.seeAlso)),ie.body&&(ie.body=ensureArray(ie.body)),ie.audience&&(ie.audience=ensureArray(ie.audience)),ie.accessibility&&(ie.accessibility=ensureArray(ie.accessibility)),ie.motivation&&(ie.motivation=ensureArray(ie.motivation)),ie}function normalize(ie){const Z=convertPresentation2(ie),ee=getDefaultEntities$1(),ae={},ve=mapToEntities(ee),ye=recordTypeInMapping(ae),Ke=new Traverse$1({collection:[ensureDefaultFields(emptyCollection),ye("Collection"),ve("Collection")],manifest:[ensureDefaultFields(emptyManifest),ye("Manifest"),ve("Manifest")],canvas:[ensureDefaultFields(emptyCanvas),ye("Canvas"),ve("Canvas")],annotationPage:[addMissingIdToContentResource("AnnotationPage"),ensureDefaultFields(emptyAnnotationPage),ye("AnnotationPage"),ve("AnnotationPage")],annotation:[addMissingIdToContentResource("Annotation"),ensureArrayOnAnnotation,ye("Annotation"),ve("Annotation")],contentResource:[addMissingIdToContentResource("ContentResource"),ye("ContentResource"),ve("ContentResource")],range:[ensureDefaultFields(emptyRange),ye("Range","Canvas"),ve("Range","Canvas")],agent:[ensureDefaultFields(emptyAgent),ye("Agent"),ve("Agent")]}).traverseUnknown(Z);return{entities:ee,resource:Ke,mapping:ae}}const UNSET="__$UNSET$__",UNWRAP="__$UNWRAP$__";function resolveIfExists$1(ie,Z){const ee=ie.requests[Z],ae=ie.mapping[Z];if(!(!ae||ee&&ee.resourceUri&&!ie.entities[ae][ee.resourceUri]))return ie.entities[ae][ee?ee.resourceUri:Z]}function serializedFieldsToObject(ie){const Z={};for(const[ee,ae]of ie){if(ee===UNWRAP&&ae!==UNSET)return ae;ae!==UNSET&&typeof ae<"u"&&ae!==null&&(Z[ee]=ae)}return Z}function serialize(ie,Z,ee){if(!Z.type||!Z.id)throw new Error("Unknown entity");if(!ee[Z.type])throw new Error(`Serializer not found for ${Z.type}`);function ae(ve){const ye=ee[ve.type];if(!ye)return UNSET;const be=resolveIfExists$1(ie,ve.id)||(ve.id&&ve.type?ve:null);if(!be)return UNSET;const Ke=ye(be,ie,{isTopLevel:Z.id===ve.id});let Ye=Ke.next();for(;!Ye.done;){const Xe=Ye.value;let Qe=UNSET;if(Xe)if(Array.isArray(Xe)){const et=[];for(const Je of Xe)et.push(ae(Je));Qe=et}else Qe=ae(Xe);Ye=Ke.next(Qe)}return Ye.value===UNSET?UNSET:serializedFieldsToObject(Ye.value)}return ae(Z)}function languageString2to3(ie){if(!ie)return;const Z=Object.keys(ie);if(Z.length!==0){if(Z.length===1){const ee=Z[0];if(!ee)return"";const ae=(ie[ee]||[]).join("");return ee==="@none"||ee==="none"||ee==="en"?ae:{"@language":ee,"@value":ae}}return Z.map(ee=>({"@language":ee,"@value":(ie[ee]||[]).join("")}))}}function parseCanvasTarget(ie){return Array.isArray(ie)?ie.map(Z=>parseCanvasTarget(Z)):typeof ie=="string"?ie:ie.type&&ie.type==="Canvas"?ie.id:ie}function unNestArray(ie,Z=!1){if(ie)return ie.length>1&&!Z?ie:ie[0]||void 0}function convertService(ie){if(ie){if(typeof ie=="string")return{"@id":ie};if("@id"in ie){const Z={...ie};return delete Z["@type"],Z}return{"@context":"http://iiif.io/api/image/2/context.json","@id":ie.id,profile:`http://iiif.io/api/image/2/profiles/${ie.profile}.json`}}}function technicalProperties$1(ie,Z){return[["@id",ie.id],["@type",Z],["format",ie.format],["height",ie.height],["width",ie.width],["viewingDirection",ie.viewingDirection!=="left-to-right"?ie.viewingDirection:void 0]]}function*descriptiveProperties$1(ie){const Z=ie.provider?yield ie.provider[0]:void 0;return[["label",languageString2to3(ie.label)],["metadata",ie.metadata&&ie.metadata.length?ie.metadata.map(ee=>({label:languageString2to3(ee.label)||"",value:languageString2to3(ee.value)||""})):void 0],["description",languageString2to3(ie.summary)],["thumbnail",unNestArray(yield ie.thumbnail)],["navDate",ie.navDate],["logo",Z?unNestArray(Z.logo):void 0],["homepage",Z?Z.homepage:void 0],["attribution",ie.requiredStatement?languageString2to3(ie.requiredStatement.value):void 0]]}function*linkingProperties$1(ie){return[["seeAlso",unNestArray(yield ie.seeAlso)],["service",unNestArray((ie.service||[]).map(convertService))],["rendering",unNestArray(yield ie.rendering)],["startCanvas",ie.start?ie.start.id:void 0]]}const serializeConfigPresentation2={Manifest:function*(ie){return[...technicalProperties$1(ie,"sc:Manifest"),...yield*descriptiveProperties$1(ie),...yield*linkingProperties$1(ie),["sequences",[{"@id":`${ie.id}/sequence0`,"@type":"sc:Sequence",canvases:yield ie.items}]],["structures",yield ie.structures]]},Canvas:function*(ie){const ee=(yield ie.items)[0];return[...technicalProperties$1(ie,"sc:Canvas"),...yield*descriptiveProperties$1(ie),...yield*linkingProperties$1(ie),["images",ee?[ee.resources]:void 0],["annotations",ie.annotations&&ie.annotations.length?unNestArray(yield ie.annotations):void 0]]},AnnotationPage:function*(ie){return[...technicalProperties$1(ie,"sc:AnnotationList"),...yield*descriptiveProperties$1(ie),["resources",ie.items&&ie.items.length?unNestArray(yield ie.items):void 0]]},Annotation:function*(ie){return[["@id",ie.id],["@type","oa:Annotation"],["motivation","sc:painting"],["on",parseCanvasTarget(ie.target)],["resource",unNestArray(yield ie.body,!0)]]},ContentResource:function*(ie){switch(ie.type){case"Image":return[...technicalProperties$1(ie,"dctypes:Image"),...yield*descriptiveProperties$1(ie),...yield*linkingProperties$1(ie)];case"Text":case"Dataset":default:return[...technicalProperties$1(ie,void 0),...yield*descriptiveProperties$1(ie)]}},AnnotationCollection:function*(ie){return[["@id",ie.id],["@type","sc:Layer"],["label",languageString2to3(ie.label)]]},Collection:function*(ie){return[...technicalProperties$1(ie,"sc:Collection"),...yield*descriptiveProperties$1(ie),...yield*linkingProperties$1(ie),["members",yield*ie.items]]},Range:function*(ie){const Z=[],ee=[];if(ie.items)for(const ae of ie.items){const ve=yield ae;Z.push({"@id":ae.id,"@type":ae.type,label:ve?ve.label:void 0,within:ie.id}),ae.type==="Canvas"&&ee.push(ae.id)}return[...technicalProperties$1(ie,"sc:Range"),...yield*descriptiveProperties$1(ie),...yield*linkingProperties$1(ie),["canvases",ee.length===Z.length?ee:void 0],["members",ee.length!==Z.length?Z:void 0]]}};function technicalProperties(ie){var Z;return[["id",(Z=ie.id)!=null&&Z.startsWith("vault://")?void 0:ie.id],["type",ie.type],["format",ie.format],["profile",ie.profile],["height",ie.height],["width",ie.width],["duration",ie.duration||void 0],["viewingDirection",ie.viewingDirection!=="left-to-right"?ie.viewingDirection:void 0],["behavior",ie.behavior&&ie.behavior.length?ie.behavior:void 0],["timeMode",ie.timeMode],["motivation",Array.isArray(ie.motivation)?ie.motivation[0]:ie.motivation]]}function filterEmpty(ie){if(!(!ie||ie.length===0))return ie}function service2compat(ie){if(ie&&ie.type&&ie.type==="ImageService2"){const{id:Z,type:ee,profile:ae,...ve}=ie,ye=typeof ae=="string"?ae:Array.isArray(ae)?ae.find(be=>typeof be=="string"):"";return{"@id":Z,"@type":ee,profile:ye?ye.startsWith("http")?ye:`http://iiif.io/api/image/2/${ye}.json`:"http://iiif.io/api/image/2/level0.json",...ve}}return ie}function filterService2Compat(ie){if(!(!ie||ie.length===0))return ie.map(service2compat)}function*descriptiveProperties(ie){return[["label",ie.label],["metadata",filterEmpty(ie.metadata)],["summary",ie.summary],["requiredStatement",ie.requiredStatement],["rights",ie.rights],["navDate",ie.navDate],["language",ie.language],["thumbnail",filterEmpty(yield ie.thumbnail)],["placeholderCanvas",yield ie.placeholderCanvas],["accompanyingCanvas",yield ie.accompanyingCanvas],["provider",filterEmpty(yield ie.provider)]]}function*linkingProperties(ie){return[["seeAlso",filterEmpty(yield ie.seeAlso)],["service",filterService2Compat(ie.service)],["services",filterService2Compat(ie.services)],["rendering",filterEmpty(yield ie.rendering)],["supplementary",filterEmpty(yield ie.supplementary)],["homepage",filterEmpty(yield ie.homepage)],["logo",filterEmpty(yield ie.logo)],["partOf",filterEmpty(yield ie.partOf)],["start",ie.start]]}const serializeConfigPresentation3={Manifest:function*(ie,Z,{isTopLevel:ee}){return ee?[["@context","http://iiif.io/api/presentation/3/context.json"],...technicalProperties(ie),...yield*descriptiveProperties(ie),...yield*linkingProperties(ie),["items",yield ie.items],["structures",filterEmpty(yield ie.structures)],["annotations",filterEmpty(yield ie.annotations)]]:[...technicalProperties(ie),...yield*descriptiveProperties(ie)]},Canvas:function*(ie){return[...technicalProperties(ie),...yield*descriptiveProperties(ie),...yield*linkingProperties(ie),["items",yield ie.items],["annotations",filterEmpty(yield ie.annotations)]]},Agent:function*(ie){return[["id",ie.id],["type","Agent"],["label",ie.label],...yield*linkingProperties(ie)]},AnnotationPage:function*(ie){return[...Object.entries(ie).map(([ee,ae])=>[ee,Array.isArray(ae)?filterEmpty(ae):ae]).filter(([ee,ae])=>ee!=="items"),...yield*linkingProperties(ie),["items",yield ie.items]]},Service:function*(ie){return[[UNWRAP,service2compat(ie)]]},Annotation:function*(ie){const Z=Object.entries(ie).map(([ae,ve])=>ae==="motivation"?[ae,Array.isArray(ve)?ve[0]:ve]:[ae,Array.isArray(ve)?filterEmpty(ve):ve]).filter(([ae])=>ae!=="body"),ee=yield ie.body;return[...Z,["body",ee.length===1?ee[0]:ee]]},ContentResource:function*(ie){return[...technicalProperties(ie),...yield*descriptiveProperties(ie),...yield*linkingProperties(ie),["annotations",filterEmpty(yield ie.annotations)],["items",filterEmpty(yield ie.items)]]},AnnotationCollection:function*(ie){return[["id",ie.id],["type","AnnotationCollection"],["label",ie.label]]},Collection:function*(ie,Z,{isTopLevel:ee}){return ee?[["@context","http://iiif.io/api/presentation/3/context.json"],...technicalProperties(ie),...yield*descriptiveProperties(ie),...yield*linkingProperties(ie),["items",filterEmpty(yield ie.items)]]:[...technicalProperties(ie),...yield*descriptiveProperties(ie)]},Range:function*(ie){const Z=[];for(const ee of ie.items)ee.type==="Range"?Z.push(yield ee):Z.push(ee);return[...technicalProperties(ie),...yield*descriptiveProperties(ie),...yield*linkingProperties(ie),["items",Z],["annotations",filterEmpty(yield ie.annotations)]]}};function n$1(ie){return ie==null}function t$1(ie){throw new Error("Argument "+ie+" is empty.")}function o$1(ie){return typeof ie=="string"||typeof ie=="symbol"}function u$1(ie){return!o$1(ie)}function a$1(ie){throw new Error("Argument "+ie+" is invalid, it should be an action type of type: string | symbol")}function s$1(ie,Z){return n$1(ie)&&t$1(1),u$1(ie)&&a$1(1),Object.assign(function(){var ee=Z!=null?Z.apply(void 0,arguments):void 0;return Object.assign({type:ie},ee)},{getType:function(){return ie},toString:function(){return ie}})}function y$1(ie,Z,ee){return n$1(ie)&&t$1(1),u$1(ie)&&a$1(1),function(){return s$1(ie,function(){var ae=arguments.length<=0?void 0:arguments[0],ve=arguments.length<=1?void 0:arguments[1];return Z==null&&ee==null||(ae=Z!=null?Z.apply(void 0,arguments):void 0,ve=ee!=null?ee.apply(void 0,arguments):void 0),Object.assign({},ae!==void 0&&{payload:ae},{},ve!==void 0&&{meta:ve})})}}const IMPORT_ENTITIES="@iiif/IMPORT_ENTITIES",MODIFY_ENTITY_FIELD="@iiif/MODIFY_ENTITY_FIELD",REORDER_ENTITY_FIELD="@iiif/REORDER_ENTITY_FIELD",ADD_REFERENCE="@iiif/ADD_REFERENCE",REMOVE_REFERENCE="@iiif/REMOVE_REFERENCE",importEntities=y$1(IMPORT_ENTITIES)(),modifyEntityField=y$1(MODIFY_ENTITY_FIELD)(),reorderEntityField=y$1(REORDER_ENTITY_FIELD)(),addReference=y$1(ADD_REFERENCE)(),removeReference=y$1(REMOVE_REFERENCE)(),entityActions={importEntities,modifyEntityField,reorderEntityField,addReference,removeReference},ADD_MAPPING="@iiif/ADD_MAPPING",ADD_MAPPINGS="@iiif/ADD_MAPPINGS",addMapping=y$1(ADD_MAPPING)(),addMappings=y$1(ADD_MAPPINGS)(),SET_META_VALUE="@iiif/SET_META_VALUE",SET_META_VALUE_DYNAMIC="@iiif/SET_META_VALUE_DYNAMIC",UNSET_META_VALUE="@iiif/UNSET_META_VALUE",setMetaValue=y$1(SET_META_VALUE)(),setMetaValueDynamic=y$1(SET_META_VALUE_DYNAMIC)(),unsetMetaValue=y$1(UNSET_META_VALUE)(),metaActions={setMetaValue,setMetaValueDynamic,unsetMetaValue},RESOURCE_ERROR="RESOURCE_ERROR",RESOURCE_LOADING="RESOURCE_LOADING",RESOURCE_READY="RESOURCE_READY",REQUEST_RESOURCE="@iiif/REQUEST_RESOURCE",REQUEST_ERROR="@iiif/REQUEST_ERROR",REQUEST_MISMATCH="@iiif/REQUEST_MISMATCH",REQUEST_COMPLETE="@iiif/REQUEST_COMPLETE",REQUEST_OFFLINE_RESOURCE="@iiif/REQUEST_OFFLINE_RESOURCE",requestResource=y$1(REQUEST_RESOURCE)(),requestError=y$1(REQUEST_ERROR)(),requestMismatch=y$1(REQUEST_MISMATCH)(),requestComplete=y$1(REQUEST_COMPLETE)();y$1(REQUEST_OFFLINE_RESOURCE)();const BATCH_ACTIONS="@iiif/BATCH",BATCH_IMPORT="@iiif/BATCH_IMPORT",batchActions=y$1(BATCH_ACTIONS)();y$1(BATCH_IMPORT)();const actionListFromResource=(ie,Z)=>{const{entities:ee,resource:ae,mapping:ve}=normalize(Z);if(ae.id===void 0)return[requestError({id:ie,message:"ID is not defined in resource."})];const ye=[importEntities({entities:ee}),addMappings({mapping:ve})];return ae.id!==ie&&(ye.push(addMapping({id:ie,type:ae.type})),ye.push(requestMismatch({requestId:ie,actualId:ae.id}))),ye.push(requestComplete({id:ie})),ye},safeIsNaN=Number.isNaN||function(Z){return typeof Z=="number"&&Z!==Z};function isEqual(ie,Z){return!!(ie===Z||safeIsNaN(ie)&&safeIsNaN(Z))}function areInputsEqual(ie,Z){if(!Array.isArray(ie)||!Array.isArray(Z))return ie===Z;if(ie.length!==Z.length)return!1;for(let ee=0;ee<ie.length;ee++)if(!isEqual(ie[ee],Z[ee]))return!1;return!0}function resolveIfExists(ie,Z){const ee=ie.iiif.requests[Z],ae=ie.iiif.mapping[Z];if(!(!ae||!ie.iiif.entities[ae][ee.resourceUri]))return ie.iiif.entities[ae][ee.resourceUri]}function createFetchHelper(ie,Z,{waitTimeout:ee=30}={}){return async(ae,ve)=>{const ye=ie.getState(),be=ye.iiif.requests[ae];if(be)switch(be.loadingState){case RESOURCE_ERROR:break;case RESOURCE_LOADING:{let Ke,Ye=!1;try{const Xe=await Promise.race([new Promise((Qe,et)=>{Ye||(Ke=ie.subscribe(()=>{const Je=ie.getState();if(Je.iiif.requests[ae].loadingState===RESOURCE_ERROR){et();return}if(Je.iiif.requests[ae].loadingState===RESOURCE_READY){const rt=resolveIfExists(Je,ae);rt?Qe(rt):et()}}))}),new Promise((Qe,et)=>setTimeout(()=>{Ye=!0,et()},ee*60))]);if(Ke&&Ke(),Xe)return Xe}catch{Ke&&Ke();break}break}case RESOURCE_READY:{const Ke=resolveIfExists(ye,ae);if(Ke)return Ke;break}}ie.dispatch(requestResource({id:ae}));try{const Ke=await Z(ae,ve);!Ke.id&&!Ke["@id"]&&(Ke["@type"]&&(Ke["@id"]=ae),Ke.id=ae);const Ye=actionListFromResource(ae,Ke);return ie.dispatch(batchActions({actions:Ye})),resolveIfExists(ie.getState(),ae)}catch(Ke){throw ie.dispatch(requestError({id:ae,message:Ke.toString()})),Ke}}}function getDefaultEntities(){return{Collection:{},Manifest:{},Canvas:{},AnnotationPage:{},AnnotationCollection:{},Annotation:{},ContentResource:{},Range:{},Service:{},Selector:{},Agent:{}}}const mappingReducer=(ie={},Z)=>{switch(Z.type){case ADD_MAPPING:return{...ie,[Z.payload.id]:Z.payload.type};case ADD_MAPPINGS:return{...ie,...Z.payload.mapping};default:return ie}};function isReferenceList(ie,Z,ee,ae){return!(!ie[ee]||!ie[ee][Z]||!ie[ee][Z][ae]||!Array.isArray(ie[ee][Z][ae]))}function quickMerge(ie,Z){const ee={},ae=[];for(const[ve,ye]of Object.entries(ie||{})){ae.push(ve);const be=(Z||{})[ve];if(!be||be.length===0){ee[ve]=ye;continue}ee[ve]=be}for(const[ve,ye]of Object.entries(Z||{}))ae.indexOf(ve)===-1&&(ee[ve]=ye);return ee}const entitiesReducer=(ie=getDefaultEntities(),Z)=>{var ee;switch(Z.type){case MODIFY_ENTITY_FIELD:{if(!ie[Z.payload.type]||!ie[Z.payload.type][Z.payload.id])return ie;const ae=ie[Z.payload.type][Z.payload.id];return typeof ae=="string"?ie:{...ie,[Z.payload.type]:{...ie[Z.payload.type],[Z.payload.id]:{...ae,[Z.payload.key]:Z.payload.value}}}}case REORDER_ENTITY_FIELD:{if(!isReferenceList(ie,Z.payload.id,Z.payload.type,Z.payload.key))return ie;const ae=ie[Z.payload.type][Z.payload.id];if(typeof ae=="string")return ie;const ve=Array.from(ae[Z.payload.key]),[ye]=ve.splice(Z.payload.startIndex,1);return ve.splice(Z.payload.endIndex,0,ye),{...ie,[Z.payload.type]:{...ie[Z.payload.type],[Z.payload.id]:{...ae,[Z.payload.key]:ve}}}}case IMPORT_ENTITIES:{const ae=Object.keys(Z.payload.entities),ve={...ie};for(const ye of ae){const be=Z.payload.entities[ye],Ke={...ie[ye]||{}};let Ye=!1;const Xe=Object.keys(be||{})||[];if(be&&Xe){for(const Qe of Xe)Ye=!0,Ke[Qe]=ie[ye][Qe]?quickMerge(ie[ye][Qe],be[Qe]):be[Qe];Ye&&(ve[ye]=Ke)}}return ve}case ADD_REFERENCE:{if(!isReferenceList(ie,Z.payload.id,Z.payload.type,Z.payload.key))return ie;const ae=ie[Z.payload.type][Z.payload.id],ve=Array.from(ae[Z.payload.key]);return ve.splice(Z.payload.index||ve.length+1,0,Z.payload.reference),{...ie,[Z.payload.type]:{...ie[Z.payload.type],[Z.payload.id]:{...ae,[Z.payload.key]:ve}}}}case REMOVE_REFERENCE:{if(!isReferenceList(ie,Z.payload.id,Z.payload.type,Z.payload.key))return ie;const ae=ie[Z.payload.type][Z.payload.id],ve=Array.from(ae[Z.payload.key]),ye=Z.payload.index||ve.findIndex(be=>be&&be.id===Z.payload.reference.id);return ye===-1||((ee=ve[ye])==null?void 0:ee.id)!==Z.payload.reference.id?ie:(ve.splice(ye,1),{...ie,[Z.payload.type]:{...ie[Z.payload.type],[Z.payload.id]:{...ae,[Z.payload.key]:ve}}})}default:return ie}},requestReducer=(ie={},Z)=>{switch(Z.type){case REQUEST_RESOURCE:case REQUEST_OFFLINE_RESOURCE:return{...ie,[Z.payload.id]:{requestUri:Z.payload.id,loadingState:RESOURCE_LOADING,uriMismatch:!1,resourceUri:Z.payload.id}};case REQUEST_MISMATCH:return{...ie,[Z.payload.requestId]:{...ie[Z.payload.requestId]||{},uriMismatch:!0,resourceUri:Z.payload.actualId},[Z.payload.actualId]:{requestUri:Z.payload.requestId,loadingState:ie[Z.payload.requestId].loadingState,uriMismatch:!0,resourceUri:Z.payload.actualId}};case REQUEST_ERROR:return{...ie,[Z.payload.id]:{...ie[Z.payload.id]||{},loadingState:RESOURCE_ERROR,error:Z.payload.message}};case REQUEST_COMPLETE:return{...ie,[Z.payload.id]:{...ie[Z.payload.id]||{},loadingState:RESOURCE_READY,error:void 0}}}return ie},metaReducer=(ie={},Z)=>{const{id:ee,updateValue:ae,value:ve,meta:ye,key:be}=Z&&Z.payload||{};switch(Z.type){case SET_META_VALUE:return{...ie,[ee]:{...ie[ee]||{},[ye]:{...ie[ee]?ie[ee][ye]||{}:{},[be]:ve}}};case SET_META_VALUE_DYNAMIC:return{...ie,[ee]:{...ie[ee]||{},[ye]:{...ie[ee]?ie[ee][ye]||{}:{},[be]:ie[ee]&&ie[ee][ye]?ae(ie[ee][ye][be]):ae(void 0)}}};case UNSET_META_VALUE:return ie[ee]&&ie[ee][ye]&&ie[ee][ye][be]?{...ie,[ee]:{...ie[ee]||{},[ye]:{...ie[ee]?ie[ee][ye]||{}:{},[be]:void 0}}}:ie;default:return ie}};function createBatchReducer(ie){return(Z,ee)=>ee&&ee.type===BATCH_ACTIONS?ee.payload.actions.reduce(ie,Z):ee&&ee.type===BATCH_IMPORT?ee.payload.state:ie(Z,ee)}const reducers=combineReducers({mapping:mappingReducer,entities:entitiesReducer,requests:requestReducer,meta:metaReducer}),composeEnhancers=typeof window<"u"?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||compose:compose;function createStore(ie={}){const{enableDevtools:Z=!0,iiifStoreName:ee="iiif",defaultState:ae={},extraMiddleware:ve=[],customReducers:ye={}}=ie,be=combineReducers({[ee]:reducers,...ye});return createStore$1(createBatchReducer(be),ae,Z?composeEnhancers(applyMiddleware(...ve)):compose(applyMiddleware(...ve)))}function mitt(ie){return{all:ie=ie||new Map,on:function(Z,ee){var ae=ie.get(Z);ae?ae.push(ee):ie.set(Z,[ee])},off:function(Z,ee){var ae=ie.get(Z);ae&&(ee?ae.splice(ae.indexOf(ee)>>>0,1):ie.set(Z,[]))},emit:function(Z,ee){var ae=ie.get(Z);ae&&ae.slice().map(function(ve){ve(ee)}),(ae=ie.get("*"))&&ae.slice().map(function(ve){ve(Z,ee)})}}}class Vault{constructor(Z,ee){Vi(this,"options");Vi(this,"store");Vi(this,"emitter");Vi(this,"isBatching",!1);Vi(this,"batchQueue",[]);Vi(this,"remoteFetcher");Vi(this,"staticFetcher");Vi(this,"defaultFetcher",Z=>fetch(Z).then(ee=>ee.json()));Vi(this,"middleware",Z=>ee=>ae=>{if(ae.type===BATCH_ACTIONS){for(const be of ae.payload.actions)this.emitter.emit(be.type,{realAction:be,state:Z.getState()});const ye=ee(ae);for(const be of ae.payload.actions)this.emitter.emit(`after:${ae.type}`,{action:ae,state:ye});return ye}this.emitter.emit(ae.type,{action:ae,state:Z.getState()});const ve=ee(ae);return this.emitter.emit(`after:${ae.type}`,{action:ae,state:ve}),ve});this.options=Object.assign({reducers:{},middleware:[],defaultState:{},customFetcher:this.defaultFetcher,enableDevtools:!0},Z||{}),this.store=ee||createStore({customReducers:this.options.reducers,extraMiddleware:[...this.options.middleware,this.middleware],defaultState:this.options.defaultState,enableDevtools:this.options.enableDevtools}),this.emitter=mitt(),this.remoteFetcher=createFetchHelper(this.store,this.options.customFetcher),this.staticFetcher=createFetchHelper(this.store,(ae,ve)=>ve)}batch(Z){this.isBatching=!0;try{Z(this),this.store.dispatch(batchActions({actions:this.batchQueue}))}catch(ee){throw this.batchQueue=[],this.isBatching=!1,ee}this.batchQueue=[],this.isBatching=!1}async asyncBatch(Z){this.isBatching=!0;try{await Z(this),this.store.dispatch(batchActions({actions:this.batchQueue}))}catch(ee){throw this.batchQueue=[],this.isBatching=!1,ee}this.batchQueue=[],this.isBatching=!1}modifyEntityField(Z,ee,ae){this.dispatch(entityActions.modifyEntityField({id:Z.id,type:Z.type,key:ee,value:ae}))}dispatch(Z){this.isBatching?this.batchQueue.push(Z):this.store.dispatch(Z)}serialize(Z,ee){return serialize(this.getState().iiif,Z,ee)}toPresentation2(Z){return this.serialize(Z,serializeConfigPresentation2)}toPresentation3(Z){return this.serialize(Z,serializeConfigPresentation3)}hydrate(Z,ee){return this.get(Z,ee,{skipSelfReturn:!1})}get(Z,ee,ae={}){typeof ee!="string"&&(ae=ee||{},ee=void 0);const{skipSelfReturn:ve=!0}=ae||{};if(Array.isArray(Z))return Z.map(Xe=>this.get(Xe,ae));const ye=this.getState();if(typeof Z=="string"){const Xe=ee||ye.iiif.mapping[Z];if(!Xe)return ve?null:{id:Z,type:"unknown"};Z={id:Z,type:Xe}}const be=ee||Z.type,Ke=Z.id,Ye=ye.iiif.entities[be];if(!Ye){const Xe=ye.iiif.requests[Ke];return Xe&&Xe.resourceUri!==Ke?this.get(Xe.resourceUri,ae):ve?null:Z}return Ye[Z.id]||(ve?null:Z)}select(Z){return Z(this.getState())}getStore(){return this.store}getState(){return this.store.getState()}loadManifest(Z,ee){const ae=typeof Z=="string"?Z:Z.id;return this.load(ae,ee)}loadCollection(Z,ee){const ae=typeof Z=="string"?Z:Z.id;return this.load(ae,ee)}load(Z,ee){const ae=typeof Z=="string"?Z:Z.id;return ee?this.staticFetcher(ae,ee):this.remoteFetcher(ae)}areInputsEqual(Z,ee){return areInputsEqual(Z,ee)}subscribe(Z,ee,ae){typeof ae>"u"&&(typeof ee>"u"||ee===!1||ee===!0)&&(ae=ee,ee=Z,Z=ye=>ye);let ve=ae?null:Z(this.store.getState());return ae||ee(ve,this),this.store.subscribe(()=>{const ye=this.store.getState(),be=Z(ye);ve!==be&&!areInputsEqual(ve,be)&&ee(be,this),ve=be})}async ensureLoaded(Z){const ee=typeof Z=="string"?Z:Z.id;this.requestStatus(ee)||await this.load(ee)}requestStatus(Z){return this.select(ee=>ee.iiif.requests[Z])}getResourceMeta(Z,ee){const ae=this.getState().iiif.meta[Z];if(ae)return ee?ae[ee]:ae}setMetaValue([Z,ee,ae],ve){this.dispatch(typeof ve=="function"?metaActions.setMetaValueDynamic({id:Z,meta:ee,key:ae,updateValue:ve}):metaActions.setMetaValue({id:Z,meta:ee,key:ae,value:ve}))}}function _extends$1(){return _extends$1=Object.assign?Object.assign.bind():function(ie){for(var Z=1;Z<arguments.length;Z++){var ee=arguments[Z];for(var ae in ee)Object.prototype.hasOwnProperty.call(ee,ae)&&(ie[ae]=ee[ae])}return ie},_extends$1.apply(this,arguments)}function $e42e1063c40fb3ef$export$b9ecd428b558ff10(ie,Z,{checkForDefaultPrevented:ee=!0}={}){return function(ve){if(ie==null||ie(ve),ee===!1||!ve.defaultPrevented)return Z==null?void 0:Z(ve)}}function $c512c27ab02ef895$export$50c7b4e9d9f19c1(ie,Z=[]){let ee=[];function ae(ye,be){const Ke=reactExports.createContext(be),Ye=ee.length;ee=[...ee,be];function Xe(et){const{scope:Je,children:rt,...it}=et,nt=(Je==null?void 0:Je[ie][Ye])||Ke,tt=reactExports.useMemo(()=>it,Object.values(it));return reactExports.createElement(nt.Provider,{value:tt},rt)}function Qe(et,Je){const rt=(Je==null?void 0:Je[ie][Ye])||Ke,it=reactExports.useContext(rt);if(it)return it;if(be!==void 0)return be;throw new Error(`\`${et}\` must be used within \`${ye}\``)}return Xe.displayName=ye+"Provider",[Xe,Qe]}const ve=()=>{const ye=ee.map(be=>reactExports.createContext(be));return function(Ke){const Ye=(Ke==null?void 0:Ke[ie])||ye;return reactExports.useMemo(()=>({[`__scope${ie}`]:{...Ke,[ie]:Ye}}),[Ke,Ye])}};return ve.scopeName=ie,[ae,$c512c27ab02ef895$var$composeContextScopes(ve,...Z)]}function $c512c27ab02ef895$var$composeContextScopes(...ie){const Z=ie[0];if(ie.length===1)return Z;const ee=()=>{const ae=ie.map(ve=>({useScope:ve(),scopeName:ve.scopeName}));return function(ye){const be=ae.reduce((Ke,{useScope:Ye,scopeName:Xe})=>{const et=Ye(ye)[`__scope${Xe}`];return{...Ke,...et}},{});return reactExports.useMemo(()=>({[`__scope${Z.scopeName}`]:be}),[be])}};return ee.scopeName=Z.scopeName,ee}function $b1b2314f5f9a1d84$export$25bec8c6f54ee79a(ie){const Z=reactExports.useRef(ie);return reactExports.useEffect(()=>{Z.current=ie}),reactExports.useMemo(()=>(...ee)=>{var ae;return(ae=Z.current)===null||ae===void 0?void 0:ae.call(Z,...ee)},[])}function $71cd76cc60e0454e$export$6f32135080cb4c3({prop:ie,defaultProp:Z,onChange:ee=()=>{}}){const[ae,ve]=$71cd76cc60e0454e$var$useUncontrolledState({defaultProp:Z,onChange:ee}),ye=ie!==void 0,be=ye?ie:ae,Ke=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(ee),Ye=reactExports.useCallback(Xe=>{if(ye){const et=typeof Xe=="function"?Xe(ie):Xe;et!==ie&&Ke(et)}else ve(Xe)},[ye,ie,ve,Ke]);return[be,Ye]}function $71cd76cc60e0454e$var$useUncontrolledState({defaultProp:ie,onChange:Z}){const ee=reactExports.useState(ie),[ae]=ee,ve=reactExports.useRef(ae),ye=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(Z);return reactExports.useEffect(()=>{ve.current!==ae&&(ye(ae),ve.current=ae)},[ae,ve,ye]),ee}const $9f79659886946c16$export$e5c5a5f917a5871c=globalThis!=null&&globalThis.document?reactExports.useLayoutEffect:()=>{};function $6ed0406888f73fc4$var$setRef(ie,Z){typeof ie=="function"?ie(Z):ie!=null&&(ie.current=Z)}function $6ed0406888f73fc4$export$43e446d32b3d21af(...ie){return Z=>ie.forEach(ee=>$6ed0406888f73fc4$var$setRef(ee,Z))}function $6ed0406888f73fc4$export$c7b2cbe3552a0d05(...ie){return reactExports.useCallback($6ed0406888f73fc4$export$43e446d32b3d21af(...ie),ie)}const $5e63c961fc1ce211$export$8c6ed5c666ac1360=reactExports.forwardRef((ie,Z)=>{const{children:ee,...ae}=ie,ve=reactExports.Children.toArray(ee),ye=ve.find($5e63c961fc1ce211$var$isSlottable);if(ye){const be=ye.props.children,Ke=ve.map(Ye=>Ye===ye?reactExports.Children.count(be)>1?reactExports.Children.only(null):reactExports.isValidElement(be)?be.props.children:null:Ye);return reactExports.createElement($5e63c961fc1ce211$var$SlotClone,_extends$1({},ae,{ref:Z}),reactExports.isValidElement(be)?reactExports.cloneElement(be,void 0,Ke):null)}return reactExports.createElement($5e63c961fc1ce211$var$SlotClone,_extends$1({},ae,{ref:Z}),ee)});$5e63c961fc1ce211$export$8c6ed5c666ac1360.displayName="Slot";const $5e63c961fc1ce211$var$SlotClone=reactExports.forwardRef((ie,Z)=>{const{children:ee,...ae}=ie;return reactExports.isValidElement(ee)?reactExports.cloneElement(ee,{...$5e63c961fc1ce211$var$mergeProps(ae,ee.props),ref:Z?$6ed0406888f73fc4$export$43e446d32b3d21af(Z,ee.ref):ee.ref}):reactExports.Children.count(ee)>1?reactExports.Children.only(null):null});$5e63c961fc1ce211$var$SlotClone.displayName="SlotClone";const $5e63c961fc1ce211$export$d9f1ccf0bdb05d45=({children:ie})=>reactExports.createElement(reactExports.Fragment,null,ie);function $5e63c961fc1ce211$var$isSlottable(ie){return reactExports.isValidElement(ie)&&ie.type===$5e63c961fc1ce211$export$d9f1ccf0bdb05d45}function $5e63c961fc1ce211$var$mergeProps(ie,Z){const ee={...Z};for(const ae in Z){const ve=ie[ae],ye=Z[ae];/^on[A-Z]/.test(ae)?ve&&ye?ee[ae]=(...Ke)=>{ye(...Ke),ve(...Ke)}:ve&&(ee[ae]=ve):ae==="style"?ee[ae]={...ve,...ye}:ae==="className"&&(ee[ae]=[ve,ye].filter(Boolean).join(" "))}return{...ie,...ee}}const $8927f6f2acc4f386$var$NODES=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],$8927f6f2acc4f386$export$250ffa63cdc0d034=$8927f6f2acc4f386$var$NODES.reduce((ie,Z)=>{const ee=reactExports.forwardRef((ae,ve)=>{const{asChild:ye,...be}=ae,Ke=ye?$5e63c961fc1ce211$export$8c6ed5c666ac1360:Z;return reactExports.useEffect(()=>{window[Symbol.for("radix-ui")]=!0},[]),reactExports.createElement(Ke,_extends$1({},be,{ref:ve}))});return ee.displayName=`Primitive.${Z}`,{...ie,[Z]:ee}},{});function $8927f6f2acc4f386$export$6d1a0317bde7de7f(ie,Z){ie&&reactDomExports.flushSync(()=>ie.dispatchEvent(Z))}function $fe963b355347cc68$export$3e6543de14f8614f(ie,Z){return reactExports.useReducer((ee,ae)=>{const ve=Z[ee][ae];return ve??ee},ie)}const $921a889cee6df7e8$export$99c2b779aa4e8b8b=ie=>{const{present:Z,children:ee}=ie,ae=$921a889cee6df7e8$var$usePresence(Z),ve=typeof ee=="function"?ee({present:ae.isPresent}):reactExports.Children.only(ee),ye=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(ae.ref,ve.ref);return typeof ee=="function"||ae.isPresent?reactExports.cloneElement(ve,{ref:ye}):null};$921a889cee6df7e8$export$99c2b779aa4e8b8b.displayName="Presence";function $921a889cee6df7e8$var$usePresence(ie){const[Z,ee]=reactExports.useState(),ae=reactExports.useRef({}),ve=reactExports.useRef(ie),ye=reactExports.useRef("none"),be=ie?"mounted":"unmounted",[Ke,Ye]=$fe963b355347cc68$export$3e6543de14f8614f(be,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return reactExports.useEffect(()=>{const Xe=$921a889cee6df7e8$var$getAnimationName(ae.current);ye.current=Ke==="mounted"?Xe:"none"},[Ke]),$9f79659886946c16$export$e5c5a5f917a5871c(()=>{const Xe=ae.current,Qe=ve.current;if(Qe!==ie){const Je=ye.current,rt=$921a889cee6df7e8$var$getAnimationName(Xe);ie?Ye("MOUNT"):rt==="none"||(Xe==null?void 0:Xe.display)==="none"?Ye("UNMOUNT"):Ye(Qe&&Je!==rt?"ANIMATION_OUT":"UNMOUNT"),ve.current=ie}},[ie,Ye]),$9f79659886946c16$export$e5c5a5f917a5871c(()=>{if(Z){const Xe=et=>{const rt=$921a889cee6df7e8$var$getAnimationName(ae.current).includes(et.animationName);et.target===Z&&rt&&reactDomExports.flushSync(()=>Ye("ANIMATION_END"))},Qe=et=>{et.target===Z&&(ye.current=$921a889cee6df7e8$var$getAnimationName(ae.current))};return Z.addEventListener("animationstart",Qe),Z.addEventListener("animationcancel",Xe),Z.addEventListener("animationend",Xe),()=>{Z.removeEventListener("animationstart",Qe),Z.removeEventListener("animationcancel",Xe),Z.removeEventListener("animationend",Xe)}}else Ye("ANIMATION_END")},[Z,Ye]),{isPresent:["mounted","unmountSuspended"].includes(Ke),ref:reactExports.useCallback(Xe=>{Xe&&(ae.current=getComputedStyle(Xe)),ee(Xe)},[])}}function $921a889cee6df7e8$var$getAnimationName(ie){return(ie==null?void 0:ie.animationName)||"none"}const $1746a345f3d73bb7$var$useReactId=$2AODx$react.useId||(()=>{});let $1746a345f3d73bb7$var$count=0;function $1746a345f3d73bb7$export$f680877a34711e37(ie){const[Z,ee]=reactExports.useState($1746a345f3d73bb7$var$useReactId());return $9f79659886946c16$export$e5c5a5f917a5871c(()=>{ie||ee(ae=>ae??String($1746a345f3d73bb7$var$count++))},[ie]),ie||(Z?`radix-${Z}`:"")}const $409067139f391064$var$COLLAPSIBLE_NAME="Collapsible",[$409067139f391064$var$createCollapsibleContext,$409067139f391064$export$952b32dcbe73087a]=$c512c27ab02ef895$export$50c7b4e9d9f19c1($409067139f391064$var$COLLAPSIBLE_NAME),[$409067139f391064$var$CollapsibleProvider,$409067139f391064$var$useCollapsibleContext]=$409067139f391064$var$createCollapsibleContext($409067139f391064$var$COLLAPSIBLE_NAME),$409067139f391064$export$6eb0f7ddcda6131f=reactExports.forwardRef((ie,Z)=>{const{__scopeCollapsible:ee,open:ae,defaultOpen:ve,disabled:ye,onOpenChange:be,...Ke}=ie,[Ye=!1,Xe]=$71cd76cc60e0454e$export$6f32135080cb4c3({prop:ae,defaultProp:ve,onChange:be});return reactExports.createElement($409067139f391064$var$CollapsibleProvider,{scope:ee,disabled:ye,contentId:$1746a345f3d73bb7$export$f680877a34711e37(),open:Ye,onOpenToggle:reactExports.useCallback(()=>Xe(Qe=>!Qe),[Xe])},reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({"data-state":$409067139f391064$var$getState(Ye),"data-disabled":ye?"":void 0},Ke,{ref:Z})))}),$409067139f391064$var$TRIGGER_NAME="CollapsibleTrigger",$409067139f391064$export$c135dce7b15bbbdc=reactExports.forwardRef((ie,Z)=>{const{__scopeCollapsible:ee,...ae}=ie,ve=$409067139f391064$var$useCollapsibleContext($409067139f391064$var$TRIGGER_NAME,ee);return reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.button,_extends$1({type:"button","aria-controls":ve.contentId,"aria-expanded":ve.open||!1,"data-state":$409067139f391064$var$getState(ve.open),"data-disabled":ve.disabled?"":void 0,disabled:ve.disabled},ae,{ref:Z,onClick:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ie.onClick,ve.onOpenToggle)}))}),$409067139f391064$var$CONTENT_NAME="CollapsibleContent",$409067139f391064$export$aadde00976f34151=reactExports.forwardRef((ie,Z)=>{const{forceMount:ee,...ae}=ie,ve=$409067139f391064$var$useCollapsibleContext($409067139f391064$var$CONTENT_NAME,ie.__scopeCollapsible);return reactExports.createElement($921a889cee6df7e8$export$99c2b779aa4e8b8b,{present:ee||ve.open},({present:ye})=>reactExports.createElement($409067139f391064$var$CollapsibleContentImpl,_extends$1({},ae,{ref:Z,present:ye})))}),$409067139f391064$var$CollapsibleContentImpl=reactExports.forwardRef((ie,Z)=>{const{__scopeCollapsible:ee,present:ae,children:ve,...ye}=ie,be=$409067139f391064$var$useCollapsibleContext($409067139f391064$var$CONTENT_NAME,ee),[Ke,Ye]=reactExports.useState(ae),Xe=reactExports.useRef(null),Qe=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(Z,Xe),et=reactExports.useRef(0),Je=et.current,rt=reactExports.useRef(0),it=rt.current,nt=be.open||Ke,tt=reactExports.useRef(nt),st=reactExports.useRef();return reactExports.useEffect(()=>{const ot=requestAnimationFrame(()=>tt.current=!1);return()=>cancelAnimationFrame(ot)},[]),$9f79659886946c16$export$e5c5a5f917a5871c(()=>{const ot=Xe.current;if(ot){st.current=st.current||{transitionDuration:ot.style.transitionDuration,animationName:ot.style.animationName},ot.style.transitionDuration="0s",ot.style.animationName="none";const ut=ot.getBoundingClientRect();et.current=ut.height,rt.current=ut.width,tt.current||(ot.style.transitionDuration=st.current.transitionDuration,ot.style.animationName=st.current.animationName),Ye(ae)}},[be.open,ae]),reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({"data-state":$409067139f391064$var$getState(be.open),"data-disabled":be.disabled?"":void 0,id:be.contentId,hidden:!nt},ye,{ref:Qe,style:{"--radix-collapsible-content-height":Je?`${Je}px`:void 0,"--radix-collapsible-content-width":it?`${it}px`:void 0,...ie.style}}),nt&&ve)});function $409067139f391064$var$getState(ie){return ie?"open":"closed"}const $409067139f391064$export$be92b6f5f03c0fe9=$409067139f391064$export$6eb0f7ddcda6131f,$409067139f391064$export$41fb9f06171c75f4=$409067139f391064$export$c135dce7b15bbbdc,$409067139f391064$export$7c6e2c02157bb7d2=$409067139f391064$export$aadde00976f34151,ErrorBoundaryContext=reactExports.createContext(null),initialState={didCatch:!1,error:null};class ErrorBoundary extends reactExports.Component{constructor(Z){super(Z),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=initialState}static getDerivedStateFromError(Z){return{didCatch:!0,error:Z}}resetErrorBoundary(){const{error:Z}=this.state;if(Z!==null){for(var ee,ae,ve=arguments.length,ye=new Array(ve),be=0;be<ve;be++)ye[be]=arguments[be];(ee=(ae=this.props).onReset)===null||ee===void 0||ee.call(ae,{args:ye,reason:"imperative-api"}),this.setState(initialState)}}componentDidCatch(Z,ee){var ae,ve;(ae=(ve=this.props).onError)===null||ae===void 0||ae.call(ve,Z,ee)}componentDidUpdate(Z,ee){const{didCatch:ae}=this.state,{resetKeys:ve}=this.props;if(ae&&ee.error!==null&&hasArrayChanged(Z.resetKeys,ve)){var ye,be;(ye=(be=this.props).onReset)===null||ye===void 0||ye.call(be,{next:ve,prev:Z.resetKeys,reason:"keys"}),this.setState(initialState)}}render(){const{children:Z,fallbackRender:ee,FallbackComponent:ae,fallback:ve}=this.props,{didCatch:ye,error:be}=this.state;let Ke=Z;if(ye){const Ye={error:be,resetErrorBoundary:this.resetErrorBoundary};if(typeof ee=="function")Ke=ee(Ye);else if(ae)Ke=reactExports.createElement(ae,Ye);else if(ve===null||reactExports.isValidElement(ve))Ke=ve;else throw be}return reactExports.createElement(ErrorBoundaryContext.Provider,{value:{didCatch:ye,error:be,resetErrorBoundary:this.resetErrorBoundary}},Ke)}}function hasArrayChanged(){let ie=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],Z=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return ie.length!==Z.length||ie.some((ee,ae)=>!Object.is(ee,Z[ae]))}var e="colors",t="sizes",r="space",n={gap:r,gridGap:r,columnGap:r,gridColumnGap:r,rowGap:r,gridRowGap:r,inset:r,insetBlock:r,insetBlockEnd:r,insetBlockStart:r,insetInline:r,insetInlineEnd:r,insetInlineStart:r,margin:r,marginTop:r,marginRight:r,marginBottom:r,marginLeft:r,marginBlock:r,marginBlockEnd:r,marginBlockStart:r,marginInline:r,marginInlineEnd:r,marginInlineStart:r,padding:r,paddingTop:r,paddingRight:r,paddingBottom:r,paddingLeft:r,paddingBlock:r,paddingBlockEnd:r,paddingBlockStart:r,paddingInline:r,paddingInlineEnd:r,paddingInlineStart:r,top:r,right:r,bottom:r,left:r,scrollMargin:r,scrollMarginTop:r,scrollMarginRight:r,scrollMarginBottom:r,scrollMarginLeft:r,scrollMarginX:r,scrollMarginY:r,scrollMarginBlock:r,scrollMarginBlockEnd:r,scrollMarginBlockStart:r,scrollMarginInline:r,scrollMarginInlineEnd:r,scrollMarginInlineStart:r,scrollPadding:r,scrollPaddingTop:r,scrollPaddingRight:r,scrollPaddingBottom:r,scrollPaddingLeft:r,scrollPaddingX:r,scrollPaddingY:r,scrollPaddingBlock:r,scrollPaddingBlockEnd:r,scrollPaddingBlockStart:r,scrollPaddingInline:r,scrollPaddingInlineEnd:r,scrollPaddingInlineStart:r,fontSize:"fontSizes",background:e,backgroundColor:e,backgroundImage:e,borderImage:e,border:e,borderBlock:e,borderBlockEnd:e,borderBlockStart:e,borderBottom:e,borderBottomColor:e,borderColor:e,borderInline:e,borderInlineEnd:e,borderInlineStart:e,borderLeft:e,borderLeftColor:e,borderRight:e,borderRightColor:e,borderTop:e,borderTopColor:e,caretColor:e,color:e,columnRuleColor:e,fill:e,outline:e,outlineColor:e,stroke:e,textDecorationColor:e,fontFamily:"fonts",fontWeight:"fontWeights",lineHeight:"lineHeights",letterSpacing:"letterSpacings",blockSize:t,minBlockSize:t,maxBlockSize:t,inlineSize:t,minInlineSize:t,maxInlineSize:t,width:t,minWidth:t,maxWidth:t,height:t,minHeight:t,maxHeight:t,flexBasis:t,gridTemplateColumns:t,gridTemplateRows:t,borderWidth:"borderWidths",borderTopWidth:"borderWidths",borderRightWidth:"borderWidths",borderBottomWidth:"borderWidths",borderLeftWidth:"borderWidths",borderStyle:"borderStyles",borderTopStyle:"borderStyles",borderRightStyle:"borderStyles",borderBottomStyle:"borderStyles",borderLeftStyle:"borderStyles",borderRadius:"radii",borderTopLeftRadius:"radii",borderTopRightRadius:"radii",borderBottomRightRadius:"radii",borderBottomLeftRadius:"radii",boxShadow:"shadows",textShadow:"shadows",transition:"transitions",zIndex:"zIndices"},i=(ie,Z)=>typeof Z=="function"?{"()":Function.prototype.toString.call(Z)}:Z,o=()=>{const ie=Object.create(null);return(Z,ee,...ae)=>{const ve=(ye=>JSON.stringify(ye,i))(Z);return ve in ie?ie[ve]:ie[ve]=ee(Z,...ae)}},l=Symbol.for("sxs.internal"),s=(ie,Z)=>Object.defineProperties(ie,Object.getOwnPropertyDescriptors(Z)),a=ie=>{for(const Z in ie)return!0;return!1},{hasOwnProperty:c}=Object.prototype,d=ie=>ie.includes("-")?ie:ie.replace(/[A-Z]/g,Z=>"-"+Z.toLowerCase()),g=/\s+(?![^()]*\))/,p=ie=>Z=>ie(...typeof Z=="string"?String(Z).split(g):[Z]),u={appearance:ie=>({WebkitAppearance:ie,appearance:ie}),backfaceVisibility:ie=>({WebkitBackfaceVisibility:ie,backfaceVisibility:ie}),backdropFilter:ie=>({WebkitBackdropFilter:ie,backdropFilter:ie}),backgroundClip:ie=>({WebkitBackgroundClip:ie,backgroundClip:ie}),boxDecorationBreak:ie=>({WebkitBoxDecorationBreak:ie,boxDecorationBreak:ie}),clipPath:ie=>({WebkitClipPath:ie,clipPath:ie}),content:ie=>({content:ie.includes('"')||ie.includes("'")||/^([A-Za-z]+\([^]*|[^]*-quote|inherit|initial|none|normal|revert|unset)$/.test(ie)?ie:`"${ie}"`}),hyphens:ie=>({WebkitHyphens:ie,hyphens:ie}),maskImage:ie=>({WebkitMaskImage:ie,maskImage:ie}),maskSize:ie=>({WebkitMaskSize:ie,maskSize:ie}),tabSize:ie=>({MozTabSize:ie,tabSize:ie}),textSizeAdjust:ie=>({WebkitTextSizeAdjust:ie,textSizeAdjust:ie}),userSelect:ie=>({WebkitUserSelect:ie,userSelect:ie}),marginBlock:p((ie,Z)=>({marginBlockStart:ie,marginBlockEnd:Z||ie})),marginInline:p((ie,Z)=>({marginInlineStart:ie,marginInlineEnd:Z||ie})),maxSize:p((ie,Z)=>({maxBlockSize:ie,maxInlineSize:Z||ie})),minSize:p((ie,Z)=>({minBlockSize:ie,minInlineSize:Z||ie})),paddingBlock:p((ie,Z)=>({paddingBlockStart:ie,paddingBlockEnd:Z||ie})),paddingInline:p((ie,Z)=>({paddingInlineStart:ie,paddingInlineEnd:Z||ie}))},h=/([\d.]+)([^]*)/,f=(ie,Z)=>ie.length?ie.reduce((ee,ae)=>(ee.push(...Z.map(ve=>ve.includes("&")?ve.replace(/&/g,/[ +>|~]/.test(ae)&&/&.*&/.test(ve)?`:is(${ae})`:ae):ae+" "+ve)),ee),[]):Z,m$1=(ie,Z)=>ie in b&&typeof Z=="string"?Z.replace(/^((?:[^]*[^\w-])?)(fit-content|stretch)((?:[^\w-][^]*)?)$/,(ee,ae,ve,ye)=>ae+(ve==="stretch"?`-moz-available${ye};${d(ie)}:${ae}-webkit-fill-available`:`-moz-fit-content${ye};${d(ie)}:${ae}fit-content`)+ye):String(Z),b={blockSize:1,height:1,inlineSize:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,width:1},S$1=ie=>ie?ie+"-":"",k$1=(ie,Z,ee)=>ie.replace(/([+-])?((?:\d+(?:\.\d*)?|\.\d+)(?:[Ee][+-]?\d+)?)?(\$|--)([$\w-]+)/g,(ae,ve,ye,be,Ke)=>be=="$"==!!ye?ae:(ve||be=="--"?"calc(":"")+"var(--"+(be==="$"?S$1(Z)+(Ke.includes("$")?"":S$1(ee))+Ke.replace(/\$/g,"-"):Ke)+")"+(ve||be=="--"?"*"+(ve||"")+(ye||"1")+")":"")),y=/\s*,\s*(?![^()]*\))/,B=Object.prototype.toString,$=(ie,Z,ee,ae,ve)=>{let ye,be,Ke;const Ye=(Xe,Qe,et)=>{let Je,rt;const it=nt=>{for(Je in nt){const ot=Je.charCodeAt(0)===64,ut=ot&&Array.isArray(nt[Je])?nt[Je]:[nt[Je]];for(rt of ut){const ft=/[A-Z]/.test(st=Je)?st:st.replace(/-[^]/g,Xr=>Xr[1].toUpperCase()),pt=typeof rt=="object"&&rt&&rt.toString===B&&(!ae.utils[ft]||!Qe.length);if(ft in ae.utils&&!pt){const Xr=ae.utils[ft];if(Xr!==be){be=Xr,it(Xr(rt)),be=null;continue}}else if(ft in u){const Xr=u[ft];if(Xr!==Ke){Ke=Xr,it(Xr(rt)),Ke=null;continue}}if(ot&&(tt=Je.slice(1)in ae.media?"@media "+ae.media[Je.slice(1)]:Je,Je=tt.replace(/\(\s*([\w-]+)\s*(=|<|<=|>|>=)\s*([\w-]+)\s*(?:(<|<=|>|>=)\s*([\w-]+)\s*)?\)/g,(Xr,mt,Yr,ri,Zr,_r)=>{const Kr=h.test(mt),si=.0625*(Kr?-1:1),[oi,Qr]=Kr?[ri,mt]:[mt,ri];return"("+(Yr[0]==="="?"":Yr[0]===">"===Kr?"max-":"min-")+oi+":"+(Yr[0]!=="="&&Yr.length===1?Qr.replace(h,(ii,ti,ni)=>Number(ti)+si*(Yr===">"?1:-1)+ni):Qr)+(Zr?") and ("+(Zr[0]===">"?"min-":"max-")+oi+":"+(Zr.length===1?_r.replace(h,(ii,ti,ni)=>Number(ti)+si*(Zr===">"?-1:1)+ni):_r):"")+")"})),pt){const Xr=ot?et.concat(Je):[...et],mt=ot?[...Qe]:f(Qe,Je.split(y));ye!==void 0&&ve(x$1(...ye)),ye=void 0,Ye(rt,mt,Xr)}else ye===void 0&&(ye=[[],Qe,et]),Je=ot||Je.charCodeAt(0)!==36?Je:`--${S$1(ae.prefix)}${Je.slice(1).replace(/\$/g,"-")}`,rt=pt?rt:typeof rt=="number"?rt&&ft in I?String(rt)+"px":String(rt):k$1(m$1(ft,rt??""),ae.prefix,ae.themeMap[ft]),ye[0].push(`${ot?`${Je} `:`${d(Je)}:`}${rt}`)}}var tt,st};it(Xe),ye!==void 0&&ve(x$1(...ye)),ye=void 0};Ye(ie,Z,ee)},x$1=(ie,Z,ee)=>`${ee.map(ae=>`${ae}{`).join("")}${Z.length?`${Z.join(",")}{`:""}${ie.join(";")}${Z.length?"}":""}${Array(ee.length?ee.length+1:0).join("}")}`,I={animationDelay:1,animationDuration:1,backgroundSize:1,blockSize:1,border:1,borderBlock:1,borderBlockEnd:1,borderBlockEndWidth:1,borderBlockStart:1,borderBlockStartWidth:1,borderBlockWidth:1,borderBottom:1,borderBottomLeftRadius:1,borderBottomRightRadius:1,borderBottomWidth:1,borderEndEndRadius:1,borderEndStartRadius:1,borderInlineEnd:1,borderInlineEndWidth:1,borderInlineStart:1,borderInlineStartWidth:1,borderInlineWidth:1,borderLeft:1,borderLeftWidth:1,borderRadius:1,borderRight:1,borderRightWidth:1,borderSpacing:1,borderStartEndRadius:1,borderStartStartRadius:1,borderTop:1,borderTopLeftRadius:1,borderTopRightRadius:1,borderTopWidth:1,borderWidth:1,bottom:1,columnGap:1,columnRule:1,columnRuleWidth:1,columnWidth:1,containIntrinsicSize:1,flexBasis:1,fontSize:1,gap:1,gridAutoColumns:1,gridAutoRows:1,gridTemplateColumns:1,gridTemplateRows:1,height:1,inlineSize:1,inset:1,insetBlock:1,insetBlockEnd:1,insetBlockStart:1,insetInline:1,insetInlineEnd:1,insetInlineStart:1,left:1,letterSpacing:1,margin:1,marginBlock:1,marginBlockEnd:1,marginBlockStart:1,marginBottom:1,marginInline:1,marginInlineEnd:1,marginInlineStart:1,marginLeft:1,marginRight:1,marginTop:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,offsetDistance:1,offsetRotate:1,outline:1,outlineOffset:1,outlineWidth:1,overflowClipMargin:1,padding:1,paddingBlock:1,paddingBlockEnd:1,paddingBlockStart:1,paddingBottom:1,paddingInline:1,paddingInlineEnd:1,paddingInlineStart:1,paddingLeft:1,paddingRight:1,paddingTop:1,perspective:1,right:1,rowGap:1,scrollMargin:1,scrollMarginBlock:1,scrollMarginBlockEnd:1,scrollMarginBlockStart:1,scrollMarginBottom:1,scrollMarginInline:1,scrollMarginInlineEnd:1,scrollMarginInlineStart:1,scrollMarginLeft:1,scrollMarginRight:1,scrollMarginTop:1,scrollPadding:1,scrollPaddingBlock:1,scrollPaddingBlockEnd:1,scrollPaddingBlockStart:1,scrollPaddingBottom:1,scrollPaddingInline:1,scrollPaddingInlineEnd:1,scrollPaddingInlineStart:1,scrollPaddingLeft:1,scrollPaddingRight:1,scrollPaddingTop:1,shapeMargin:1,textDecoration:1,textDecorationThickness:1,textIndent:1,textUnderlineOffset:1,top:1,transitionDelay:1,transitionDuration:1,verticalAlign:1,width:1,wordSpacing:1},R$1=ie=>String.fromCharCode(ie+(ie>25?39:97)),z$1=ie=>(Z=>{let ee,ae="";for(ee=Math.abs(Z);ee>52;ee=ee/52|0)ae=R$1(ee%52)+ae;return R$1(ee%52)+ae})(((Z,ee)=>{let ae=ee.length;for(;ae;)Z=33*Z^ee.charCodeAt(--ae);return Z})(5381,JSON.stringify(ie))>>>0),W$1=["themed","global","styled","onevar","resonevar","allvar","inline"],j$1=ie=>{if(ie.href&&!ie.href.startsWith(location.origin))return!1;try{return!!ie.cssRules}catch{return!1}},E=ie=>{let Z;const ee=()=>{const{cssRules:ve}=Z.sheet;return[].map.call(ve,(ye,be)=>{const{cssText:Ke}=ye;let Ye="";if(Ke.startsWith("--sxs"))return"";if(ve[be-1]&&(Ye=ve[be-1].cssText).startsWith("--sxs")){if(!ye.cssRules.length)return"";for(const Xe in Z.rules)if(Z.rules[Xe].group===ye)return`--sxs{--sxs:${[...Z.rules[Xe].cache].join(" ")}}${Ke}`;return ye.cssRules.length?`${Ye}${Ke}`:""}return Ke}).join("")},ae=()=>{if(Z){const{rules:Ke,sheet:Ye}=Z;if(!Ye.deleteRule){for(;Object(Object(Ye.cssRules)[0]).type===3;)Ye.cssRules.splice(0,1);Ye.cssRules=[]}for(const Xe in Ke)delete Ke[Xe]}const ve=Object(ie).styleSheets||[];for(const Ke of ve)if(j$1(Ke)){for(let Ye=0,Xe=Ke.cssRules;Xe[Ye];++Ye){const Qe=Object(Xe[Ye]);if(Qe.type!==1)continue;const et=Object(Xe[Ye+1]);if(et.type!==4)continue;++Ye;const{cssText:Je}=Qe;if(!Je.startsWith("--sxs"))continue;const rt=Je.slice(14,-3).trim().split(/\s+/),it=W$1[rt[0]];it&&(Z||(Z={sheet:Ke,reset:ae,rules:{},toString:ee}),Z.rules[it]={group:et,index:Ye,cache:new Set(rt)})}if(Z)break}if(!Z){const Ke=(Ye,Xe)=>({type:Xe,cssRules:[],insertRule(Qe,et){this.cssRules.splice(et,0,Ke(Qe,{import:3,undefined:1}[(Qe.toLowerCase().match(/^@([a-z]+)/)||[])[1]]||4))},get cssText(){return Ye==="@media{}"?`@media{${[].map.call(this.cssRules,Qe=>Qe.cssText).join("")}}`:Ye}});Z={sheet:ie?(ie.head||ie).appendChild(document.createElement("style")).sheet:Ke("","text/css"),rules:{},reset:ae,toString:ee}}const{sheet:ye,rules:be}=Z;for(let Ke=W$1.length-1;Ke>=0;--Ke){const Ye=W$1[Ke];if(!be[Ye]){const Xe=W$1[Ke+1],Qe=be[Xe]?be[Xe].index:ye.cssRules.length;ye.insertRule("@media{}",Qe),ye.insertRule(`--sxs{--sxs:${Ke}}`,Qe),be[Ye]={group:ye.cssRules[Qe+1],index:Qe,cache:new Set([Ke])}}v(be[Ye])}};return ae(),Z},v=ie=>{const Z=ie.group;let ee=Z.cssRules.length;ie.apply=ae=>{try{Z.insertRule(ae,ee),++ee}catch{}}},T$1=Symbol(),w=o(),M=(ie,Z)=>w(ie,()=>(...ee)=>{let ae={type:null,composers:new Set};for(const ve of ee)if(ve!=null)if(ve[l]){ae.type==null&&(ae.type=ve[l].type);for(const ye of ve[l].composers)ae.composers.add(ye)}else ve.constructor!==Object||ve.$$typeof?ae.type==null&&(ae.type=ve):ae.composers.add(C(ve,ie));return ae.type==null&&(ae.type="span"),ae.composers.size||ae.composers.add(["PJLV",{},[],[],{},[]]),P(ie,ae,Z)}),C=({variants:ie,compoundVariants:Z,defaultVariants:ee,...ae},ve)=>{const ye=`${S$1(ve.prefix)}c-${z$1(ae)}`,be=[],Ke=[],Ye=Object.create(null),Xe=[];for(const Je in ee)Ye[Je]=String(ee[Je]);if(typeof ie=="object"&&ie)for(const Je in ie){Qe=Ye,et=Je,c.call(Qe,et)||(Ye[Je]="undefined");const rt=ie[Je];for(const it in rt){const nt={[Je]:String(it)};String(it)==="undefined"&&Xe.push(Je);const tt=rt[it],st=[nt,tt,!a(tt)];be.push(st)}}var Qe,et;if(typeof Z=="object"&&Z)for(const Je of Z){let{css:rt,...it}=Je;rt=typeof rt=="object"&&rt||{};for(const tt in it)it[tt]=String(it[tt]);const nt=[it,rt,!a(rt)];Ke.push(nt)}return[ye,ae,be,Ke,Ye,Xe]},P=(ie,Z,ee)=>{const[ae,ve,ye,be]=L$1(Z.composers),Ke=typeof Z.type=="function"||Z.type.$$typeof?(et=>{function Je(){for(let rt=0;rt<Je[T$1].length;rt++){const[it,nt]=Je[T$1][rt];et.rules[it].apply(nt)}return Je[T$1]=[],null}return Je[T$1]=[],Je.rules={},W$1.forEach(rt=>Je.rules[rt]={apply:it=>Je[T$1].push([rt,it])}),Je})(ee):null,Ye=(Ke||ee).rules,Xe=`.${ae}${ve.length>1?`:where(.${ve.slice(1).join(".")})`:""}`,Qe=et=>{et=typeof et=="object"&&et||A;const{css:Je,...rt}=et,it={};for(const st in ye)if(delete rt[st],st in et){let ot=et[st];typeof ot=="object"&&ot?it[st]={"@initial":ye[st],...ot}:(ot=String(ot),it[st]=ot!=="undefined"||be.has(st)?ot:ye[st])}else it[st]=ye[st];const nt=new Set([...ve]);for(const[st,ot,ut,ft]of Z.composers){ee.rules.styled.cache.has(st)||(ee.rules.styled.cache.add(st),$(ot,[`.${st}`],[],ie,mt=>{Ye.styled.apply(mt)}));const pt=O$1(ut,it,ie.media),Xr=O$1(ft,it,ie.media,!0);for(const mt of pt)if(mt!==void 0)for(const[Yr,ri,Zr]of mt){const _r=`${st}-${z$1(ri)}-${Yr}`;nt.add(_r);const Kr=(Zr?ee.rules.resonevar:ee.rules.onevar).cache,si=Zr?Ye.resonevar:Ye.onevar;Kr.has(_r)||(Kr.add(_r),$(ri,[`.${_r}`],[],ie,oi=>{si.apply(oi)}))}for(const mt of Xr)if(mt!==void 0)for(const[Yr,ri]of mt){const Zr=`${st}-${z$1(ri)}-${Yr}`;nt.add(Zr),ee.rules.allvar.cache.has(Zr)||(ee.rules.allvar.cache.add(Zr),$(ri,[`.${Zr}`],[],ie,_r=>{Ye.allvar.apply(_r)}))}}if(typeof Je=="object"&&Je){const st=`${ae}-i${z$1(Je)}-css`;nt.add(st),ee.rules.inline.cache.has(st)||(ee.rules.inline.cache.add(st),$(Je,[`.${st}`],[],ie,ot=>{Ye.inline.apply(ot)}))}for(const st of String(et.className||"").trim().split(/\s+/))st&&nt.add(st);const tt=rt.className=[...nt].join(" ");return{type:Z.type,className:tt,selector:Xe,props:rt,toString:()=>tt,deferredInjector:Ke}};return s(Qe,{className:ae,selector:Xe,[l]:Z,toString:()=>(ee.rules.styled.cache.has(ae)||Qe(),ae)})},L$1=ie=>{let Z="";const ee=[],ae={},ve=[];for(const[ye,,,,be,Ke]of ie){Z===""&&(Z=ye),ee.push(ye),ve.push(...Ke);for(const Ye in be){const Xe=be[Ye];(ae[Ye]===void 0||Xe!=="undefined"||Ke.includes(Xe))&&(ae[Ye]=Xe)}}return[Z,ee,ae,new Set(ve)]},O$1=(ie,Z,ee,ae)=>{const ve=[];e:for(let[ye,be,Ke]of ie){if(Ke)continue;let Ye,Xe=0,Qe=!1;for(Ye in ye){const et=ye[Ye];let Je=Z[Ye];if(Je!==et){if(typeof Je!="object"||!Je)continue e;{let rt,it,nt=0;for(const tt in Je){if(et===String(Je[tt])){if(tt!=="@initial"){const st=tt.slice(1);(it=it||[]).push(st in ee?ee[st]:tt.replace(/^@media ?/,"")),Qe=!0}Xe+=nt,rt=!0}++nt}if(it&&it.length&&(be={["@media "+it.join(", ")]:be}),!rt)continue e}}}(ve[Xe]=ve[Xe]||[]).push([ae?"cv":`${Ye}-${ye[Ye]}`,be,Qe])}return ve},A={},N$1=o(),D$1=(ie,Z)=>N$1(ie,()=>(...ee)=>{const ae=()=>{for(let ve of ee){ve=typeof ve=="object"&&ve||{};let ye=z$1(ve);if(!Z.rules.global.cache.has(ye)){if(Z.rules.global.cache.add(ye),"@import"in ve){let be=[].indexOf.call(Z.sheet.cssRules,Z.rules.themed.group)-1;for(let Ke of[].concat(ve["@import"]))Ke=Ke.includes('"')||Ke.includes("'")?Ke:`"${Ke}"`,Z.sheet.insertRule(`@import ${Ke};`,be++);delete ve["@import"]}$(ve,[],[],ie,be=>{Z.rules.global.apply(be)})}}return""};return s(ae,{toString:ae})}),H=o(),V=(ie,Z)=>H(ie,()=>ee=>{const ae=`${S$1(ie.prefix)}k-${z$1(ee)}`,ve=()=>{if(!Z.rules.global.cache.has(ae)){Z.rules.global.cache.add(ae);const ye=[];$(ee,[],[],ie,Ke=>ye.push(Ke));const be=`@keyframes ${ae}{${ye.join("")}}`;Z.rules.global.apply(be)}return ae};return s(ve,{get name(){return ve()},toString:ve})}),G=class{constructor(ie,Z,ee,ae){this.token=ie==null?"":String(ie),this.value=Z==null?"":String(Z),this.scale=ee==null?"":String(ee),this.prefix=ae==null?"":String(ae)}get computedValue(){return"var("+this.variable+")"}get variable(){return"--"+S$1(this.prefix)+S$1(this.scale)+this.token}toString(){return this.computedValue}},F=o(),J$1=(ie,Z)=>F(ie,()=>(ee,ae)=>{ae=typeof ee=="object"&&ee||Object(ae);const ve=`.${ee=(ee=typeof ee=="string"?ee:"")||`${S$1(ie.prefix)}t-${z$1(ae)}`}`,ye={},be=[];for(const Ye in ae){ye[Ye]={};for(const Xe in ae[Ye]){const Qe=`--${S$1(ie.prefix)}${Ye}-${Xe}`,et=k$1(String(ae[Ye][Xe]),ie.prefix,Ye);ye[Ye][Xe]=new G(Xe,et,Ye,ie.prefix),be.push(`${Qe}:${et}`)}}const Ke=()=>{if(be.length&&!Z.rules.themed.cache.has(ee)){Z.rules.themed.cache.add(ee);const Ye=`${ae===ie.theme?":root,":""}.${ee}{${be.join(";")}}`;Z.rules.themed.apply(Ye)}return ee};return{...ye,get className(){return Ke()},selector:ve,toString:Ke}}),U=o(),X$1,Y$1=o(),q=ie=>{const Z=(ee=>{let ae=!1;const ve=U(ee,ye=>{ae=!0;const be="prefix"in(ye=typeof ye=="object"&&ye||{})?String(ye.prefix):"",Ke=typeof ye.media=="object"&&ye.media||{},Ye=typeof ye.root=="object"?ye.root||null:globalThis.document||null,Xe=typeof ye.theme=="object"&&ye.theme||{},Qe={prefix:be,media:Ke,theme:Xe,themeMap:typeof ye.themeMap=="object"&&ye.themeMap||{...n},utils:typeof ye.utils=="object"&&ye.utils||{}},et=E(Ye),Je={css:M(Qe,et),globalCss:D$1(Qe,et),keyframes:V(Qe,et),createTheme:J$1(Qe,et),reset(){et.reset(),Je.theme.toString()},theme:{},sheet:et,config:Qe,prefix:be,getCssText:et.toString,toString:et.toString};return String(Je.theme=Je.createTheme(Xe)),Je});return ae||ve.reset(),ve})(ie);return Z.styled=(({config:ee,sheet:ae})=>Y$1(ee,()=>{const ve=M(ee,ae);return(...ye)=>{const be=ve(...ye),Ke=be[l].type,Ye=e$1.forwardRef((Xe,Qe)=>{const et=Xe&&Xe.as||Ke,{props:Je,deferredInjector:rt}=be(Xe);return delete Je.as,Je.ref=Qe,rt?e$1.createElement(e$1.Fragment,null,e$1.createElement(et,Je),e$1.createElement(rt,null)):e$1.createElement(et,Je)});return Ye.className=be.className,Ye.displayName=`Styled.${Ke.displayName||Ke.name||Ke}`,Ye.selector=be.selector,Ye.toString=()=>be.selector,Ye[l]=be[l],Ye}}))(Z),Z},K$1=()=>X$1||(X$1=q()),Q$1=(...ie)=>K$1().createTheme(...ie);function $e02a7d9cb1dc128c$export$c74125a8e3af6bb2(ie){const Z=ie+"CollectionProvider",[ee,ae]=$c512c27ab02ef895$export$50c7b4e9d9f19c1(Z),[ve,ye]=ee(Z,{collectionRef:{current:null},itemMap:new Map}),be=rt=>{const{scope:it,children:nt}=rt,tt=e$1.useRef(null),st=e$1.useRef(new Map).current;return e$1.createElement(ve,{scope:it,itemMap:st,collectionRef:tt},nt)},Ke=ie+"CollectionSlot",Ye=e$1.forwardRef((rt,it)=>{const{scope:nt,children:tt}=rt,st=ye(Ke,nt),ot=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(it,st.collectionRef);return e$1.createElement($5e63c961fc1ce211$export$8c6ed5c666ac1360,{ref:ot},tt)}),Xe=ie+"CollectionItemSlot",Qe="data-radix-collection-item",et=e$1.forwardRef((rt,it)=>{const{scope:nt,children:tt,...st}=rt,ot=e$1.useRef(null),ut=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(it,ot),ft=ye(Xe,nt);return e$1.useEffect(()=>(ft.itemMap.set(ot,{ref:ot,...st}),()=>void ft.itemMap.delete(ot))),e$1.createElement($5e63c961fc1ce211$export$8c6ed5c666ac1360,{[Qe]:"",ref:ut},tt)});function Je(rt){const it=ye(ie+"CollectionConsumer",rt);return e$1.useCallback(()=>{const tt=it.collectionRef.current;if(!tt)return[];const st=Array.from(tt.querySelectorAll(`[${Qe}]`));return Array.from(it.itemMap.values()).sort((ft,pt)=>st.indexOf(ft.ref.current)-st.indexOf(pt.ref.current))},[it.collectionRef,it.itemMap])}return[{Provider:be,Slot:Ye,ItemSlot:et},Je,ae]}const $f631663db3294ace$var$DirectionContext=reactExports.createContext(void 0);function $f631663db3294ace$export$b39126d51d94e6f3(ie){const Z=reactExports.useContext($f631663db3294ace$var$DirectionContext);return ie||Z||"ltr"}const $d7bdfb9eb0fdf311$var$ENTRY_FOCUS="rovingFocusGroup.onEntryFocus",$d7bdfb9eb0fdf311$var$EVENT_OPTIONS={bubbles:!1,cancelable:!0},$d7bdfb9eb0fdf311$var$GROUP_NAME="RovingFocusGroup",[$d7bdfb9eb0fdf311$var$Collection,$d7bdfb9eb0fdf311$var$useCollection,$d7bdfb9eb0fdf311$var$createCollectionScope]=$e02a7d9cb1dc128c$export$c74125a8e3af6bb2($d7bdfb9eb0fdf311$var$GROUP_NAME),[$d7bdfb9eb0fdf311$var$createRovingFocusGroupContext,$d7bdfb9eb0fdf311$export$c7109489551a4f4]=$c512c27ab02ef895$export$50c7b4e9d9f19c1($d7bdfb9eb0fdf311$var$GROUP_NAME,[$d7bdfb9eb0fdf311$var$createCollectionScope]),[$d7bdfb9eb0fdf311$var$RovingFocusProvider,$d7bdfb9eb0fdf311$var$useRovingFocusContext]=$d7bdfb9eb0fdf311$var$createRovingFocusGroupContext($d7bdfb9eb0fdf311$var$GROUP_NAME),$d7bdfb9eb0fdf311$export$8699f7c8af148338=reactExports.forwardRef((ie,Z)=>reactExports.createElement($d7bdfb9eb0fdf311$var$Collection.Provider,{scope:ie.__scopeRovingFocusGroup},reactExports.createElement($d7bdfb9eb0fdf311$var$Collection.Slot,{scope:ie.__scopeRovingFocusGroup},reactExports.createElement($d7bdfb9eb0fdf311$var$RovingFocusGroupImpl,_extends$1({},ie,{ref:Z}))))),$d7bdfb9eb0fdf311$var$RovingFocusGroupImpl=reactExports.forwardRef((ie,Z)=>{const{__scopeRovingFocusGroup:ee,orientation:ae,loop:ve=!1,dir:ye,currentTabStopId:be,defaultCurrentTabStopId:Ke,onCurrentTabStopIdChange:Ye,onEntryFocus:Xe,...Qe}=ie,et=reactExports.useRef(null),Je=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(Z,et),rt=$f631663db3294ace$export$b39126d51d94e6f3(ye),[it=null,nt]=$71cd76cc60e0454e$export$6f32135080cb4c3({prop:be,defaultProp:Ke,onChange:Ye}),[tt,st]=reactExports.useState(!1),ot=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(Xe),ut=$d7bdfb9eb0fdf311$var$useCollection(ee),ft=reactExports.useRef(!1),[pt,Xr]=reactExports.useState(0);return reactExports.useEffect(()=>{const mt=et.current;if(mt)return mt.addEventListener($d7bdfb9eb0fdf311$var$ENTRY_FOCUS,ot),()=>mt.removeEventListener($d7bdfb9eb0fdf311$var$ENTRY_FOCUS,ot)},[ot]),reactExports.createElement($d7bdfb9eb0fdf311$var$RovingFocusProvider,{scope:ee,orientation:ae,dir:rt,loop:ve,currentTabStopId:it,onItemFocus:reactExports.useCallback(mt=>nt(mt),[nt]),onItemShiftTab:reactExports.useCallback(()=>st(!0),[]),onFocusableItemAdd:reactExports.useCallback(()=>Xr(mt=>mt+1),[]),onFocusableItemRemove:reactExports.useCallback(()=>Xr(mt=>mt-1),[])},reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({tabIndex:tt||pt===0?-1:0,"data-orientation":ae},Qe,{ref:Je,style:{outline:"none",...ie.style},onMouseDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ie.onMouseDown,()=>{ft.current=!0}),onFocus:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ie.onFocus,mt=>{const Yr=!ft.current;if(mt.target===mt.currentTarget&&Yr&&!tt){const ri=new CustomEvent($d7bdfb9eb0fdf311$var$ENTRY_FOCUS,$d7bdfb9eb0fdf311$var$EVENT_OPTIONS);if(mt.currentTarget.dispatchEvent(ri),!ri.defaultPrevented){const Zr=ut().filter(Qr=>Qr.focusable),_r=Zr.find(Qr=>Qr.active),Kr=Zr.find(Qr=>Qr.id===it),oi=[_r,Kr,...Zr].filter(Boolean).map(Qr=>Qr.ref.current);$d7bdfb9eb0fdf311$var$focusFirst(oi)}}ft.current=!1}),onBlur:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ie.onBlur,()=>st(!1))})))}),$d7bdfb9eb0fdf311$var$ITEM_NAME="RovingFocusGroupItem",$d7bdfb9eb0fdf311$export$ab9df7c53fe8454=reactExports.forwardRef((ie,Z)=>{const{__scopeRovingFocusGroup:ee,focusable:ae=!0,active:ve=!1,tabStopId:ye,...be}=ie,Ke=$1746a345f3d73bb7$export$f680877a34711e37(),Ye=ye||Ke,Xe=$d7bdfb9eb0fdf311$var$useRovingFocusContext($d7bdfb9eb0fdf311$var$ITEM_NAME,ee),Qe=Xe.currentTabStopId===Ye,et=$d7bdfb9eb0fdf311$var$useCollection(ee),{onFocusableItemAdd:Je,onFocusableItemRemove:rt}=Xe;return reactExports.useEffect(()=>{if(ae)return Je(),()=>rt()},[ae,Je,rt]),reactExports.createElement($d7bdfb9eb0fdf311$var$Collection.ItemSlot,{scope:ee,id:Ye,focusable:ae,active:ve},reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.span,_extends$1({tabIndex:Qe?0:-1,"data-orientation":Xe.orientation},be,{ref:Z,onMouseDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ie.onMouseDown,it=>{ae?Xe.onItemFocus(Ye):it.preventDefault()}),onFocus:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ie.onFocus,()=>Xe.onItemFocus(Ye)),onKeyDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ie.onKeyDown,it=>{if(it.key==="Tab"&&it.shiftKey){Xe.onItemShiftTab();return}if(it.target!==it.currentTarget)return;const nt=$d7bdfb9eb0fdf311$var$getFocusIntent(it,Xe.orientation,Xe.dir);if(nt!==void 0){it.preventDefault();let st=et().filter(ot=>ot.focusable).map(ot=>ot.ref.current);if(nt==="last")st.reverse();else if(nt==="prev"||nt==="next"){nt==="prev"&&st.reverse();const ot=st.indexOf(it.currentTarget);st=Xe.loop?$d7bdfb9eb0fdf311$var$wrapArray(st,ot+1):st.slice(ot+1)}setTimeout(()=>$d7bdfb9eb0fdf311$var$focusFirst(st))}})})))}),$d7bdfb9eb0fdf311$var$MAP_KEY_TO_FOCUS_INTENT={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function $d7bdfb9eb0fdf311$var$getDirectionAwareKey(ie,Z){return Z!=="rtl"?ie:ie==="ArrowLeft"?"ArrowRight":ie==="ArrowRight"?"ArrowLeft":ie}function $d7bdfb9eb0fdf311$var$getFocusIntent(ie,Z,ee){const ae=$d7bdfb9eb0fdf311$var$getDirectionAwareKey(ie.key,ee);if(!(Z==="vertical"&&["ArrowLeft","ArrowRight"].includes(ae))&&!(Z==="horizontal"&&["ArrowUp","ArrowDown"].includes(ae)))return $d7bdfb9eb0fdf311$var$MAP_KEY_TO_FOCUS_INTENT[ae]}function $d7bdfb9eb0fdf311$var$focusFirst(ie){const Z=document.activeElement;for(const ee of ie)if(ee===Z||(ee.focus(),document.activeElement!==Z))return}function $d7bdfb9eb0fdf311$var$wrapArray(ie,Z){return ie.map((ee,ae)=>ie[(Z+ae)%ie.length])}const $d7bdfb9eb0fdf311$export$be92b6f5f03c0fe9=$d7bdfb9eb0fdf311$export$8699f7c8af148338,$d7bdfb9eb0fdf311$export$6d08773d2e66f8f2=$d7bdfb9eb0fdf311$export$ab9df7c53fe8454,$69cb30bb0017df05$var$TABS_NAME="Tabs",[$69cb30bb0017df05$var$createTabsContext,$69cb30bb0017df05$export$355f5bd209d7b13a]=$c512c27ab02ef895$export$50c7b4e9d9f19c1($69cb30bb0017df05$var$TABS_NAME,[$d7bdfb9eb0fdf311$export$c7109489551a4f4]),$69cb30bb0017df05$var$useRovingFocusGroupScope=$d7bdfb9eb0fdf311$export$c7109489551a4f4(),[$69cb30bb0017df05$var$TabsProvider,$69cb30bb0017df05$var$useTabsContext]=$69cb30bb0017df05$var$createTabsContext($69cb30bb0017df05$var$TABS_NAME),$69cb30bb0017df05$export$b2539bed5023c21c=reactExports.forwardRef((ie,Z)=>{const{__scopeTabs:ee,value:ae,onValueChange:ve,defaultValue:ye,orientation:be="horizontal",dir:Ke,activationMode:Ye="automatic",...Xe}=ie,Qe=$f631663db3294ace$export$b39126d51d94e6f3(Ke),[et,Je]=$71cd76cc60e0454e$export$6f32135080cb4c3({prop:ae,onChange:ve,defaultProp:ye});return reactExports.createElement($69cb30bb0017df05$var$TabsProvider,{scope:ee,baseId:$1746a345f3d73bb7$export$f680877a34711e37(),value:et,onValueChange:Je,orientation:be,dir:Qe,activationMode:Ye},reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({dir:Qe,"data-orientation":be},Xe,{ref:Z})))}),$69cb30bb0017df05$var$TAB_LIST_NAME="TabsList",$69cb30bb0017df05$export$9712d22edc0d78c1=reactExports.forwardRef((ie,Z)=>{const{__scopeTabs:ee,loop:ae=!0,...ve}=ie,ye=$69cb30bb0017df05$var$useTabsContext($69cb30bb0017df05$var$TAB_LIST_NAME,ee),be=$69cb30bb0017df05$var$useRovingFocusGroupScope(ee);return reactExports.createElement($d7bdfb9eb0fdf311$export$be92b6f5f03c0fe9,_extends$1({asChild:!0},be,{orientation:ye.orientation,dir:ye.dir,loop:ae}),reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({role:"tablist","aria-orientation":ye.orientation},ve,{ref:Z})))}),$69cb30bb0017df05$var$TRIGGER_NAME="TabsTrigger",$69cb30bb0017df05$export$8114b9fdfdf9f3ba=reactExports.forwardRef((ie,Z)=>{const{__scopeTabs:ee,value:ae,disabled:ve=!1,...ye}=ie,be=$69cb30bb0017df05$var$useTabsContext($69cb30bb0017df05$var$TRIGGER_NAME,ee),Ke=$69cb30bb0017df05$var$useRovingFocusGroupScope(ee),Ye=$69cb30bb0017df05$var$makeTriggerId(be.baseId,ae),Xe=$69cb30bb0017df05$var$makeContentId(be.baseId,ae),Qe=ae===be.value;return reactExports.createElement($d7bdfb9eb0fdf311$export$6d08773d2e66f8f2,_extends$1({asChild:!0},Ke,{focusable:!ve,active:Qe}),reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.button,_extends$1({type:"button",role:"tab","aria-selected":Qe,"aria-controls":Xe,"data-state":Qe?"active":"inactive","data-disabled":ve?"":void 0,disabled:ve,id:Ye},ye,{ref:Z,onMouseDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ie.onMouseDown,et=>{!ve&&et.button===0&&et.ctrlKey===!1?be.onValueChange(ae):et.preventDefault()}),onKeyDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ie.onKeyDown,et=>{[" ","Enter"].includes(et.key)&&be.onValueChange(ae)}),onFocus:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ie.onFocus,()=>{const et=be.activationMode!=="manual";!Qe&&!ve&&et&&be.onValueChange(ae)})})))}),$69cb30bb0017df05$var$CONTENT_NAME="TabsContent",$69cb30bb0017df05$export$bd905d70e8fd2ebb=reactExports.forwardRef((ie,Z)=>{const{__scopeTabs:ee,value:ae,forceMount:ve,children:ye,...be}=ie,Ke=$69cb30bb0017df05$var$useTabsContext($69cb30bb0017df05$var$CONTENT_NAME,ee),Ye=$69cb30bb0017df05$var$makeTriggerId(Ke.baseId,ae),Xe=$69cb30bb0017df05$var$makeContentId(Ke.baseId,ae),Qe=ae===Ke.value,et=reactExports.useRef(Qe);return reactExports.useEffect(()=>{const Je=requestAnimationFrame(()=>et.current=!1);return()=>cancelAnimationFrame(Je)},[]),reactExports.createElement($921a889cee6df7e8$export$99c2b779aa4e8b8b,{present:ve||Qe},({present:Je})=>reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({"data-state":Qe?"active":"inactive","data-orientation":Ke.orientation,role:"tabpanel","aria-labelledby":Ye,hidden:!Je,id:Xe,tabIndex:0},be,{ref:Z,style:{...ie.style,animationDuration:et.current?"0s":void 0}}),Je&&ye))});function $69cb30bb0017df05$var$makeTriggerId(ie,Z){return`${ie}-trigger-${Z}`}function $69cb30bb0017df05$var$makeContentId(ie,Z){return`${ie}-content-${Z}`}const $69cb30bb0017df05$export$be92b6f5f03c0fe9=$69cb30bb0017df05$export$b2539bed5023c21c,$69cb30bb0017df05$export$54c2e3dc7acea9f5=$69cb30bb0017df05$export$9712d22edc0d78c1,$69cb30bb0017df05$export$41fb9f06171c75f4=$69cb30bb0017df05$export$8114b9fdfdf9f3ba,$69cb30bb0017df05$export$7c6e2c02157bb7d2=$69cb30bb0017df05$export$bd905d70e8fd2ebb;var lib$5={},Parser$3={},Tokenizer={},decode={},decodeDataHtml={};Object.defineProperty(decodeDataHtml,"__esModule",{value:!0});decodeDataHtml.default=new Uint16Array('<\0\0\0\0\0\0EMabcfglmnoprstu\\bfmsligP&cutereve;iyx}rc;r;ravepha;acr;d;gpon;f;plyFunction;ingcsr;ign;ildemlaceforsucrkslash;;ed;y;crtause;noullis;a;r;pf;eve;cmpeq;HOacdefhilorsucy;PYcpyute;;italDifferentialD;leys;aeioron;dilrc;nint;ot;dnilla;terDot;i;rcleDMPTot;inus;lus;imes;ocskwiseContourIntegral;eCurlyDQoubleQuote;uote;lnpuon;e;gitruent;nt;ourIntegral;fr;oduct;nterClockwiseContourIntegral;oss;cr;p;Cap;DJSZacefios;otrahd;cy;cy;cy;grsger;r;hv;ayron;;l;ta;r;afcmriticalADGTcute;o;bleAcute;rave;ilde;ond;ferentialD;\0\0\0\0f;;DEot;qual;bleCDLRUVontourIntegrao\0\0nArrow;eoftARTrrow;ightArrow;engLReftARrrow;ightArrow;ightArrow;ightATrrow;ee;p\0\0rrow;ownArrow;erticalBar;nABLRTarrow;BUar;pArrow;reve;eft\0\0ightVector;eeVector;ector;Bar;ight\0eeVector;ector;Bar;ee;Arrow;ctr;rok;NTacdfglmopqstuxG;Hcuteaiyron;rc;ot;r;raveement;apcr;ty\0\0mallSquare;erySmallSquare;gpon;f;silon;uail;Tilde;librium;cir;m;a;mlipsts;onentialE;cfiosy;r;lled\0\0mallSquare;erySmallSquare;\0\0\0f;All;riertrf;cJTabcdfgorstcy;>mma;d;reve;eiydil;rc;;ot;r;;pf;eaterEFGLSTqual;Less;ullEqual;reater;ess;lantEqual;ilde;cr;;AacfiosuRDcy;ctek;;irc;r;lbertSpace;\0f;izontalLine;ctrok;mpownHumqual;EJOacdfgmnostucy;lig;cy;cuteiyrc;ot;r;rave;apcgr;inaryI;lie\0;egrral;section;isibleCTomma;imes;gpton;f;a;cr;ilde;\0cy;lcfosuiyrc;;r;pf;\0r;rcy;kcy;HJacfoscy;cy;ppa;eydil;;r;pf;cr;JTaceflmostcy;<cmnprute;bda;g;lacetrf;r;aeyron;dil;;fstACDFRTUVarnrgleBracket;row;BRar;ightArrow;eiling;o\0bleBracket;n\0eeVector;ector;Bar;loor;ightAVrrow;ector;ere;AVrrow;ector;iangle;BEar;qual;pDTVownVector;eeVector;ector;Bar;ector;Bar;ightsEFGLSTqualGreater;ullEqual;reater;ess;lantEqual;ilde;r;;eftarrow;idot;npwgLRlreftARrrow;ightArrow;ightArrow;eftarightightf;erLReftArrow;ightArrow;cht;rok;;acefiosup;y;dliumSpace;lintrf;r;nusPlus;pf;c;Jacefostucy;cute;aeyron;dil;;gswativeMTVediumSpace;hicneryThitedGLreaterGreateessLesLine;r;Bnptreak;BreakingSpace;f;;CDEGHLNPRSTVoungruent;pCap;oubleVerticalBar;lqxement;ual;Tilde;ists;reater;EFGLSTqual;ullEqual;reater;ess;lantEqual;ilde;umpownHump;qual;efstTriangle;BEar;qual;s;EGLSTqual;reater;ess;lantEqual;ilde;estedGLreaterGreater;essLess;recedes;ESqual;lantEqual;eiverseElement;ghtTriangle;BEar;qual;quuareSubpset;Equal;erset;Equal;bcpset;Equal;ceeds;ESTqual;lantEqual;ilde;erset;Equal;ilde;EFTqual;ullEqual;ilde;erticalBar;cr;ilde;Eacdfgmoprstuvlig;cuteiyrc;blac;r;raveaeicr;ga;cron;pf;enCurlyDQoubleQuote;uote;;clr;ashidees;mlerBParr;acek;et;arenthesis;acfhilorsrtialD;y;r;i;;usMinus;ipncareplanf;;eiocedes;ESTqual;lantEqual;ilde;me;dpuct;ortion;al;cir;;UfosOT"r;pf;cr;BEacefhiorsuarr;Gcnrute;g;r;tl;aeyron;dil;;;verseEUlqement;uilibrium;pEquilibrium;ro;ghtACDFTUVanrgleBracket;row;BLar;eftArrow;eiling;o\0bleBracket;n\0eeVector;ector;Bar;loor;ere;AVrrow;ector;iangle;BEar;qual;pDTVownVector;eeVector;ector;Bar;ector;Bar;puf;ndImplies;ightarrow;chr;;leDelayed;HOacfhimoqstuCcHcy;y;FTcy;cute;;aeiyron;dil;rc;;r;ortDLRUownArroweftArrowightArrowpArrow;gma;allCircle;pf;\0\0t;are;ISUntersection;ubpset;Equal;erset;Equal;nion;cr;ar;bcmp;set;Equal;cheeds;ESTqual;lantEqual;ilde;Th;;esrset;Equal;etHRSacfhiorsORNADE;Hccy;y;bu;;aeyron;dil;;r;ei\0efore;a;cnkSpace;Space;lde;EFTqual;ullEqual;ilde;pf;ipleDot;ctr;rok;\0\0\0\0\0\0\0cruter;ocir;r\0y;ve;iyrc;blac;r;raveacr;dierBParr;acek;et;arenthesis;on;Plus;gpon;f;ADETadpsrrow;BDar;ownArrow;ownArrow;quilibrium;ee;Arrow;ownerLReftArrow;ightArrow;i;lon;ing;cr;ilde;mlDbcdefosvash;ar;y;ash;l;er;btyar;;icalBLSTar;ine;eparator;ilde;ThinSpace;r;pf;cr;dash;cefosirc;dge;r;pf;cr;fiosr;;pf;cr;AIUacfosucy;cy;cy;cuteiyrc;;r;pf;cr;ml;Hacdefoscy;cute;ayron;;ot;\0oWidta;r;pf;cr;\0\0\0\0\0\0\0cutereve;;Ediuy;;rcte;lig;r;raveepfpsym;ha;apcclr;g;\0\0;adsvnd;;lope;;;elmrsz;esd;a;;;;;;;;t;vb;d;pth;arr;gpon;f;;Eaeiop;cir;;d;s;rox;eingctyr;;mp;eildemlcioninnt;Nabcdefiklnoprsuot;crkcepsong;psilon;rime;im;eq;ee;ed;gerk;tbrk;oy;quo;cmprtaus;eptyv;snoahw;;een;r;gcostuvwaiurc;pdptot;lus;imes;\0\0cup;ar;riangleduown;p;plus;earow;akocnklstozenge;riangle;dlrown;eft;ight;k;\0\0;;4;ck;eo;q=uiv;t;ptwxf;;tomtie;DHUVbdhmptuvLRlr;;;;;DUdu;;;;LRlr;;;;;HLRhlr;;;;;;ox;LRlr;;;;;DUdu;;;;inus;lus;imes;LRlr;;;;;HLRhlr;;;;;;evbarceior;mi;m;el;bh;sub;l;etp;Ee;;q\0\0\0\0\0\0\0\0\0\0cprute;;abcdsnd;rcup;aup;p;ot;;eot;aeiu\0s;on;dilrc;ps;sm;ot;dmnilptyv;t;err;ceiy;ck;mark;r;Ecefms;;elq;e\0\0rrowlreft;ight;RSacd;st;irc;ash;nint;id;cir;ubs;uit\0on;e;q\0\0a;t;;flemxente\0;dot;nfry;o;sr;aorr;ss;cur;bp;e;;e;dot;delprvwarrlr;;\0\0r;c;arr;p;;bcdosrcap;aup;p;ot;r;;alrvrr;m;yevwq\0\0reuee;edge;enearrowlreftightecioninnt;lcty;AHabcdefhijlorstuwzrar;glrsger;eth;h;varow;aayron;;;aogrr;tseq;glmta;ptyv;irsht;;arlraegsvm;osnd;suit;amma;in;;iode;ontimes;ncy;c\0\0rn;op;lptuwlar;f;;empsq;dot;inus;lus;quare;blebarwedgnadhownarrowarpoonlrefighkaro\0\0rn;op;cotry;;l;rok;drot;i;fahraangle;ciy;grarr;DacdefglmnopqrstuxDoocsuteter;aioyron;r;clon;;ot;Drot;;;rsave;dot;;ilsnters;;;dot;apscr;ty;svetp1;;;gs;p;gpon;f;alsr;sl;us;i;lvon;csuviorc\0\0antgltressaeils;st;v;DD;parsl;Daot;rr;cdir;oah;mrlo;cipl;seoctationential\0\0\0\0\0\0\0llingdotsey;male;ilrlig;\0\0g;ig;;lig;lig;fjaltt;ig;ns;of;\0f;ak;v;artint;aocs\0\0;;;;\0;;\0\0;;5;\0;;8;l;wn;cr;Eabcdefgijlnorstv;l;cmpute;ma;d;reve;iyrc;;ot;;lqs;qslan;cdlc;ot;o;l;;es;r;;gmel;cy;;Eaj;;;Eaes;p;prox;q;qim;pf;cir;m;el;;>;cdlqrci;r;ot;Par;uest;adels\0pror;qlqlesienrtneqq;Aabcefkosyrilmrrsfildrcy;;cwir;;ar;irc;alrrts;uitlip;con;r;sewarow;arow;amoprrr;tht;klreftarrow;ightarrow;f;bar;cltr;asrok;bpull;hen\0\0\0\0\0\0cute;iyrc;cxy;clfr;rave;inoinnt;t;fin;ta;lig;aopcgtr;elpinarh;f;ed;;cfotare;in;tie;do;celpal;grerarhk;rod;cgpty;on;f;a;uestcir;n;Edsv;ot;;v;;ilde;\0cy;lcfmosuiyrc;;r;ath;pf;\0r;rcy;kcy;acfghjosppa;v;eydil;;r;reen;cy;cy;pf;cr;ABEHabcdefghjlmnoprstuvartrail;arr;;g;ar;\0\0\0\0\0\0\0\0\0ute;mptyv;rabda;g;dl;;uor;bfhlpst;fs;s;p;l;im;l;;aeil;;s;abrrr;rk;akcek;;es;ldu;;aeuyron;diil;;cqrsa;uo;rduhar;shar;h;;fgqstahlrtrrow;taarpoonduownpeftarrows;ightahsrrow;sarpoonquigarrohreetimes;;qslan;cdgsc;ot;o;r;;es;adegspproot;qgqgtiilrsht;;;E;rdu;l;lk;cy;;achtrorneard;ri;iodot;ust;acheEaes;p;prox;q;qim;abnoptwznrg;r;rglmreftarightapsto;ightparrowlrefight;aflr;;us;imes;st;;efngear;lt;achmtrornear;d;;ri;achiqtquo;r;m;eg;;buo;r;rok;<;cdhilqrci;r;remes;arr;uest;Piar;;efrdushar;har;enrtneqq;DacdefhilnopsuDot;clprret;;ese;sto;dluowefker;oymma;;ash;asuredangler;o;cdnro;acdsir;otus;bd;u;p;dpels;f;ctr;pos;lmtimap;GLRVabcdefghijlmoprstuvwgt;;veltftarrrow;ightarrow;;;vightarrow;Ddash;ash;bcnptlaute;g;;Eiop;d;s;rour;al;s\0pmp;eaeouy\0;on;dil;ng;dot;p;;ash;;Aadqsxrr;rhrk;;oot;uieiar;ist;sr;Eest;qs;qslani;rAaprrr;ar;;sv;d;cy;AEadestr;rr;r;;fqstarrroightarro;qslan;si;ri;eiptf;;inn;Edv;ot;;;i;v;;aorr;astllel;;lint;;ceu;c;eAaitrrr;cw;;ghtarrowri;echimpqu;ceru;ort\0\0arm;e;qsubpbcp;Ees;et;eq;qc;e;Ees;et;eq;qgilrldeianglelreft;eight;e;m;esro;p;DHadgilrsash;arr;p;ash;et;;>nfin;Aetrr;;;r<ie;Atrr;rie;im;Aanrr;rhrk;;oear;\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0csuteiyr;c;abioslac;v;old;lig;crir;;\0\0\0n;ave;bmar;acitrirr;oss;n;aeicr;ga;cdnron;;pf;aelr;rp;;adiosvr;efmr;ofgof;r;lope;;cloashl;idees;as;mlbar;\0\0\0\0\0\0\0\0\0r;ast;lle\0\0m;;y;rcimptnt;od;il;enk;r;imo;v;mane;;tvchfork;aunckk;h;s;abcdemstcir;ir;ou;;nim;wo;ipuntint;f;nd;Eaceinosu;p;u;c;acenspprourlyeaespprox;qq;im;ime;sEasdfpalslar;ine;urf;;trel;cir;;ncsp;fiopsur;pf;rime;cr;aeoteirnionnt;st;eABHabcdefhilmnoprstuxartrail;arar;cdenqrteu;te;imptyv;g;del;;uor;abcfhlpstwp;;fs;;s;l;im;l;;aiil;o;nalabrrrk;akcek;;es;ldu;;aeuyron;diil;;clqsa;dhar;uo;rh;acgl;ipsnart;ilrsht;;aordu;l;;v;gnshtahlrstrrow;taarpoonduowpeftahrrowarpoonightarrows;quigarrohreetimes;g;ingdotseahmra;oust;achemid;abptnrg;r;raflr;;us;imes;apr;gt;olint;arachqquo;r;buo;rhirremes;i;efltri;luhar;;\0\0\0\0\0\0\0cute;qu;Eaceinpsy;\0;on;u;dil;rc;Eas;p;im;olint;i;ot;be;Aacmstxrr;rhr;oti;war;minnut;r;oacoyrp;hycy;;rt\0\0iaragmma;fv;;deglnprot;;q;E;;E;e;lus;arr;araeitlslsetmhp;parsl;dle;;e;s;flptcy;;b;ar;f;adres;uitcsuaup;s;p;s;ubp;eset;e;eset;e;afrarcemtr;tmiararr;fanighteppsilohsbcmnp;Edemnprs;ot;;dot;ult;Ee;;lus;arr;eiut;enq;qeq;qm;bp;;c;acenspprourlyeaespproqg;123;Edehlmnps;ost;ub;;dot;soul;b;arr;ult;Ee;;lus;eiut;enq;qeq;qm;bp;;Aanrr;rhr;owar;lig\0\0\0\0\0\0\0\0\0\0\0\0get;;raeyron;dil;;lrec;r;eiko\0e4fa;svym;cnkaspproimsasrnes;bd;ar;;eps;bcfot;ir;;ork;rime;aipdadempstngle;dlqrowneft;e;ight;eot;inus;lus;b;ime;ezium;chtry;;cy;rok;ioxheadlreftarroightarrowAHabcdfghlmoprstuwrar;cruter\0y;ve;iyrc;abhrlac;airsht;;raverlrlk;ct\0\0rn;erop;ri;alcr;gpon;f;adhlsuownarpoonlrefighi;hlonparrows;cit\0\0rn;erop;ng;ri;cr;dirot;lde;i;famrlangle;ABDacdeflnoprszrar;v;asnrgrt;eknprstappothinhirop;hiugmbpsetneq;q;setneq;q;hretianglelreftighty;ashelr;bear;q;lip;btar;trsubppf;rotrcur;bpnEenEeigzag;cefoprsirc;dibgar;e;q;erp;r;pf;;eatcr;\0\0\0\0\0\0\0trr;Aarr;Aarrais;dptfl;imAarrcqr;ptracefiosucuyte;iyrc;;nr;cy;pf;cr;cmy;lacdefhioswcute;ayron;;ot;ettra;r;cy;grarr;pf;cr;jn;j;'.split("").map(function(ie){return ie.charCodeAt(0)}));var decodeDataXml={};Object.defineProperty(decodeDataXml,"__esModule",{value:!0});decodeDataXml.default=new Uint16Array("aglq	\x1B\0\0p;os;t;t;uot;".split("").map(function(ie){return ie.charCodeAt(0)}));var decode_codepoint={};(function(ie){var Z;Object.defineProperty(ie,"__esModule",{value:!0}),ie.replaceCodePoint=ie.fromCodePoint=void 0;var ee=new Map([[0,65533],[128,8364],[130,8218],[131,402],[132,8222],[133,8230],[134,8224],[135,8225],[136,710],[137,8240],[138,352],[139,8249],[140,338],[142,381],[145,8216],[146,8217],[147,8220],[148,8221],[149,8226],[150,8211],[151,8212],[152,732],[153,8482],[154,353],[155,8250],[156,339],[158,382],[159,376]]);ie.fromCodePoint=(Z=String.fromCodePoint)!==null&&Z!==void 0?Z:function(ye){var be="";return ye>65535&&(ye-=65536,be+=String.fromCharCode(ye>>>10&1023|55296),ye=56320|ye&1023),be+=String.fromCharCode(ye),be};function ae(ye){var be;return ye>=55296&&ye<=57343||ye>1114111?65533:(be=ee.get(ye))!==null&&be!==void 0?be:ye}ie.replaceCodePoint=ae;function ve(ye){return(0,ie.fromCodePoint)(ae(ye))}ie.default=ve})(decode_codepoint);(function(ie){var Z=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(_r,Kr,si,oi){oi===void 0&&(oi=si);var Qr=Object.getOwnPropertyDescriptor(Kr,si);(!Qr||("get"in Qr?!Kr.__esModule:Qr.writable||Qr.configurable))&&(Qr={enumerable:!0,get:function(){return Kr[si]}}),Object.defineProperty(_r,oi,Qr)}:function(_r,Kr,si,oi){oi===void 0&&(oi=si),_r[oi]=Kr[si]}),ee=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(_r,Kr){Object.defineProperty(_r,"default",{enumerable:!0,value:Kr})}:function(_r,Kr){_r.default=Kr}),ae=commonjsGlobal&&commonjsGlobal.__importStar||function(_r){if(_r&&_r.__esModule)return _r;var Kr={};if(_r!=null)for(var si in _r)si!=="default"&&Object.prototype.hasOwnProperty.call(_r,si)&&Z(Kr,_r,si);return ee(Kr,_r),Kr},ve=commonjsGlobal&&commonjsGlobal.__importDefault||function(_r){return _r&&_r.__esModule?_r:{default:_r}};Object.defineProperty(ie,"__esModule",{value:!0}),ie.decodeXML=ie.decodeHTMLStrict=ie.decodeHTMLAttribute=ie.decodeHTML=ie.determineBranch=ie.EntityDecoder=ie.DecodingMode=ie.BinTrieFlags=ie.fromCodePoint=ie.replaceCodePoint=ie.decodeCodePoint=ie.xmlDecodeTree=ie.htmlDecodeTree=void 0;var ye=ve(decodeDataHtml);ie.htmlDecodeTree=ye.default;var be=ve(decodeDataXml);ie.xmlDecodeTree=be.default;var Ke=ae(decode_codepoint);ie.decodeCodePoint=Ke.default;var Ye=decode_codepoint;Object.defineProperty(ie,"replaceCodePoint",{enumerable:!0,get:function(){return Ye.replaceCodePoint}}),Object.defineProperty(ie,"fromCodePoint",{enumerable:!0,get:function(){return Ye.fromCodePoint}});var Xe;(function(_r){_r[_r.NUM=35]="NUM",_r[_r.SEMI=59]="SEMI",_r[_r.EQUALS=61]="EQUALS",_r[_r.ZERO=48]="ZERO",_r[_r.NINE=57]="NINE",_r[_r.LOWER_A=97]="LOWER_A",_r[_r.LOWER_F=102]="LOWER_F",_r[_r.LOWER_X=120]="LOWER_X",_r[_r.LOWER_Z=122]="LOWER_Z",_r[_r.UPPER_A=65]="UPPER_A",_r[_r.UPPER_F=70]="UPPER_F",_r[_r.UPPER_Z=90]="UPPER_Z"})(Xe||(Xe={}));var Qe=32,et;(function(_r){_r[_r.VALUE_LENGTH=49152]="VALUE_LENGTH",_r[_r.BRANCH_LENGTH=16256]="BRANCH_LENGTH",_r[_r.JUMP_TABLE=127]="JUMP_TABLE"})(et=ie.BinTrieFlags||(ie.BinTrieFlags={}));function Je(_r){return _r>=Xe.ZERO&&_r<=Xe.NINE}function rt(_r){return _r>=Xe.UPPER_A&&_r<=Xe.UPPER_F||_r>=Xe.LOWER_A&&_r<=Xe.LOWER_F}function it(_r){return _r>=Xe.UPPER_A&&_r<=Xe.UPPER_Z||_r>=Xe.LOWER_A&&_r<=Xe.LOWER_Z||Je(_r)}function nt(_r){return _r===Xe.EQUALS||it(_r)}var tt;(function(_r){_r[_r.EntityStart=0]="EntityStart",_r[_r.NumericStart=1]="NumericStart",_r[_r.NumericDecimal=2]="NumericDecimal",_r[_r.NumericHex=3]="NumericHex",_r[_r.NamedEntity=4]="NamedEntity"})(tt||(tt={}));var st;(function(_r){_r[_r.Legacy=0]="Legacy",_r[_r.Strict=1]="Strict",_r[_r.Attribute=2]="Attribute"})(st=ie.DecodingMode||(ie.DecodingMode={}));var ot=function(){function _r(Kr,si,oi){this.decodeTree=Kr,this.emitCodePoint=si,this.errors=oi,this.state=tt.EntityStart,this.consumed=1,this.result=0,this.treeIndex=0,this.excess=1,this.decodeMode=st.Strict}return _r.prototype.startEntity=function(Kr){this.decodeMode=Kr,this.state=tt.EntityStart,this.result=0,this.treeIndex=0,this.excess=1,this.consumed=1},_r.prototype.write=function(Kr,si){switch(this.state){case tt.EntityStart:return Kr.charCodeAt(si)===Xe.NUM?(this.state=tt.NumericStart,this.consumed+=1,this.stateNumericStart(Kr,si+1)):(this.state=tt.NamedEntity,this.stateNamedEntity(Kr,si));case tt.NumericStart:return this.stateNumericStart(Kr,si);case tt.NumericDecimal:return this.stateNumericDecimal(Kr,si);case tt.NumericHex:return this.stateNumericHex(Kr,si);case tt.NamedEntity:return this.stateNamedEntity(Kr,si)}},_r.prototype.stateNumericStart=function(Kr,si){return si>=Kr.length?-1:(Kr.charCodeAt(si)|Qe)===Xe.LOWER_X?(this.state=tt.NumericHex,this.consumed+=1,this.stateNumericHex(Kr,si+1)):(this.state=tt.NumericDecimal,this.stateNumericDecimal(Kr,si))},_r.prototype.addToNumericResult=function(Kr,si,oi,Qr){if(si!==oi){var ii=oi-si;this.result=this.result*Math.pow(Qr,ii)+parseInt(Kr.substr(si,ii),Qr),this.consumed+=ii}},_r.prototype.stateNumericHex=function(Kr,si){for(var oi=si;si<Kr.length;){var Qr=Kr.charCodeAt(si);if(Je(Qr)||rt(Qr))si+=1;else return this.addToNumericResult(Kr,oi,si,16),this.emitNumericEntity(Qr,3)}return this.addToNumericResult(Kr,oi,si,16),-1},_r.prototype.stateNumericDecimal=function(Kr,si){for(var oi=si;si<Kr.length;){var Qr=Kr.charCodeAt(si);if(Je(Qr))si+=1;else return this.addToNumericResult(Kr,oi,si,10),this.emitNumericEntity(Qr,2)}return this.addToNumericResult(Kr,oi,si,10),-1},_r.prototype.emitNumericEntity=function(Kr,si){var oi;if(this.consumed<=si)return(oi=this.errors)===null||oi===void 0||oi.absenceOfDigitsInNumericCharacterReference(this.consumed),0;if(Kr===Xe.SEMI)this.consumed+=1;else if(this.decodeMode===st.Strict)return 0;return this.emitCodePoint((0,Ke.replaceCodePoint)(this.result),this.consumed),this.errors&&(Kr!==Xe.SEMI&&this.errors.missingSemicolonAfterCharacterReference(),this.errors.validateNumericCharacterReference(this.result)),this.consumed},_r.prototype.stateNamedEntity=function(Kr,si){for(var oi=this.decodeTree,Qr=oi[this.treeIndex],ii=(Qr&et.VALUE_LENGTH)>>14;si<Kr.length;si++,this.excess++){var ti=Kr.charCodeAt(si);if(this.treeIndex=ft(oi,Qr,this.treeIndex+Math.max(1,ii),ti),this.treeIndex<0)return this.result===0||this.decodeMode===st.Attribute&&(ii===0||nt(ti))?0:this.emitNotTerminatedNamedEntity();if(Qr=oi[this.treeIndex],ii=(Qr&et.VALUE_LENGTH)>>14,ii!==0){if(ti===Xe.SEMI)return this.emitNamedEntityData(this.treeIndex,ii,this.consumed+this.excess);this.decodeMode!==st.Strict&&(this.result=this.treeIndex,this.consumed+=this.excess,this.excess=0)}}return-1},_r.prototype.emitNotTerminatedNamedEntity=function(){var Kr,si=this,oi=si.result,Qr=si.decodeTree,ii=(Qr[oi]&et.VALUE_LENGTH)>>14;return this.emitNamedEntityData(oi,ii,this.consumed),(Kr=this.errors)===null||Kr===void 0||Kr.missingSemicolonAfterCharacterReference(),this.consumed},_r.prototype.emitNamedEntityData=function(Kr,si,oi){var Qr=this.decodeTree;return this.emitCodePoint(si===1?Qr[Kr]&~et.VALUE_LENGTH:Qr[Kr+1],oi),si===3&&this.emitCodePoint(Qr[Kr+2],oi),oi},_r.prototype.end=function(){var Kr;switch(this.state){case tt.NamedEntity:return this.result!==0&&(this.decodeMode!==st.Attribute||this.result===this.treeIndex)?this.emitNotTerminatedNamedEntity():0;case tt.NumericDecimal:return this.emitNumericEntity(0,2);case tt.NumericHex:return this.emitNumericEntity(0,3);case tt.NumericStart:return(Kr=this.errors)===null||Kr===void 0||Kr.absenceOfDigitsInNumericCharacterReference(this.consumed),0;case tt.EntityStart:return 0}},_r}();ie.EntityDecoder=ot;function ut(_r){var Kr="",si=new ot(_r,function(oi){return Kr+=(0,Ke.fromCodePoint)(oi)});return function(Qr,ii){for(var ti=0,ni=0;(ni=Qr.indexOf("&",ni))>=0;){Kr+=Qr.slice(ti,ni),si.startEntity(ii);var ui=si.write(Qr,ni+1);if(ui<0){ti=ni+si.end();break}ti=ni+ui,ni=ui===0?ti+1:ti}var yi=Kr+Qr.slice(ti);return Kr="",yi}}function ft(_r,Kr,si,oi){var Qr=(Kr&et.BRANCH_LENGTH)>>7,ii=Kr&et.JUMP_TABLE;if(Qr===0)return ii!==0&&oi===ii?si:-1;if(ii){var ti=oi-ii;return ti<0||ti>=Qr?-1:_r[si+ti]-1}for(var ni=si,ui=ni+Qr-1;ni<=ui;){var yi=ni+ui>>>1,pi=_r[yi];if(pi<oi)ni=yi+1;else if(pi>oi)ui=yi-1;else return _r[yi+Qr]}return-1}ie.determineBranch=ft;var pt=ut(ye.default),Xr=ut(be.default);function mt(_r,Kr){return Kr===void 0&&(Kr=st.Legacy),pt(_r,Kr)}ie.decodeHTML=mt;function Yr(_r){return pt(_r,st.Attribute)}ie.decodeHTMLAttribute=Yr;function ri(_r){return pt(_r,st.Strict)}ie.decodeHTMLStrict=ri;function Zr(_r){return Xr(_r,st.Strict)}ie.decodeXML=Zr})(decode);(function(ie){Object.defineProperty(ie,"__esModule",{value:!0}),ie.QuoteType=void 0;var Z=decode,ee;(function(Je){Je[Je.Tab=9]="Tab",Je[Je.NewLine=10]="NewLine",Je[Je.FormFeed=12]="FormFeed",Je[Je.CarriageReturn=13]="CarriageReturn",Je[Je.Space=32]="Space",Je[Je.ExclamationMark=33]="ExclamationMark",Je[Je.Number=35]="Number",Je[Je.Amp=38]="Amp",Je[Je.SingleQuote=39]="SingleQuote",Je[Je.DoubleQuote=34]="DoubleQuote",Je[Je.Dash=45]="Dash",Je[Je.Slash=47]="Slash",Je[Je.Zero=48]="Zero",Je[Je.Nine=57]="Nine",Je[Je.Semi=59]="Semi",Je[Je.Lt=60]="Lt",Je[Je.Eq=61]="Eq",Je[Je.Gt=62]="Gt",Je[Je.Questionmark=63]="Questionmark",Je[Je.UpperA=65]="UpperA",Je[Je.LowerA=97]="LowerA",Je[Je.UpperF=70]="UpperF",Je[Je.LowerF=102]="LowerF",Je[Je.UpperZ=90]="UpperZ",Je[Je.LowerZ=122]="LowerZ",Je[Je.LowerX=120]="LowerX",Je[Je.OpeningSquareBracket=91]="OpeningSquareBracket"})(ee||(ee={}));var ae;(function(Je){Je[Je.Text=1]="Text",Je[Je.BeforeTagName=2]="BeforeTagName",Je[Je.InTagName=3]="InTagName",Je[Je.InSelfClosingTag=4]="InSelfClosingTag",Je[Je.BeforeClosingTagName=5]="BeforeClosingTagName",Je[Je.InClosingTagName=6]="InClosingTagName",Je[Je.AfterClosingTagName=7]="AfterClosingTagName",Je[Je.BeforeAttributeName=8]="BeforeAttributeName",Je[Je.InAttributeName=9]="InAttributeName",Je[Je.AfterAttributeName=10]="AfterAttributeName",Je[Je.BeforeAttributeValue=11]="BeforeAttributeValue",Je[Je.InAttributeValueDq=12]="InAttributeValueDq",Je[Je.InAttributeValueSq=13]="InAttributeValueSq",Je[Je.InAttributeValueNq=14]="InAttributeValueNq",Je[Je.BeforeDeclaration=15]="BeforeDeclaration",Je[Je.InDeclaration=16]="InDeclaration",Je[Je.InProcessingInstruction=17]="InProcessingInstruction",Je[Je.BeforeComment=18]="BeforeComment",Je[Je.CDATASequence=19]="CDATASequence",Je[Je.InSpecialComment=20]="InSpecialComment",Je[Je.InCommentLike=21]="InCommentLike",Je[Je.BeforeSpecialS=22]="BeforeSpecialS",Je[Je.SpecialStartSequence=23]="SpecialStartSequence",Je[Je.InSpecialTag=24]="InSpecialTag",Je[Je.BeforeEntity=25]="BeforeEntity",Je[Je.BeforeNumericEntity=26]="BeforeNumericEntity",Je[Je.InNamedEntity=27]="InNamedEntity",Je[Je.InNumericEntity=28]="InNumericEntity",Je[Je.InHexEntity=29]="InHexEntity"})(ae||(ae={}));function ve(Je){return Je===ee.Space||Je===ee.NewLine||Je===ee.Tab||Je===ee.FormFeed||Je===ee.CarriageReturn}function ye(Je){return Je===ee.Slash||Je===ee.Gt||ve(Je)}function be(Je){return Je>=ee.Zero&&Je<=ee.Nine}function Ke(Je){return Je>=ee.LowerA&&Je<=ee.LowerZ||Je>=ee.UpperA&&Je<=ee.UpperZ}function Ye(Je){return Je>=ee.UpperA&&Je<=ee.UpperF||Je>=ee.LowerA&&Je<=ee.LowerF}var Xe;(function(Je){Je[Je.NoValue=0]="NoValue",Je[Je.Unquoted=1]="Unquoted",Je[Je.Single=2]="Single",Je[Je.Double=3]="Double"})(Xe=ie.QuoteType||(ie.QuoteType={}));var Qe={Cdata:new Uint8Array([67,68,65,84,65,91]),CdataEnd:new Uint8Array([93,93,62]),CommentEnd:new Uint8Array([45,45,62]),ScriptEnd:new Uint8Array([60,47,115,99,114,105,112,116]),StyleEnd:new Uint8Array([60,47,115,116,121,108,101]),TitleEnd:new Uint8Array([60,47,116,105,116,108,101])},et=function(){function Je(rt,it){var nt=rt.xmlMode,tt=nt===void 0?!1:nt,st=rt.decodeEntities,ot=st===void 0?!0:st;this.cbs=it,this.state=ae.Text,this.buffer="",this.sectionStart=0,this.index=0,this.baseState=ae.Text,this.isSpecial=!1,this.running=!0,this.offset=0,this.currentSequence=void 0,this.sequenceIndex=0,this.trieIndex=0,this.trieCurrent=0,this.entityResult=0,this.entityExcess=0,this.xmlMode=tt,this.decodeEntities=ot,this.entityTrie=tt?Z.xmlDecodeTree:Z.htmlDecodeTree}return Je.prototype.reset=function(){this.state=ae.Text,this.buffer="",this.sectionStart=0,this.index=0,this.baseState=ae.Text,this.currentSequence=void 0,this.running=!0,this.offset=0},Je.prototype.write=function(rt){this.offset+=this.buffer.length,this.buffer=rt,this.parse()},Je.prototype.end=function(){this.running&&this.finish()},Je.prototype.pause=function(){this.running=!1},Je.prototype.resume=function(){this.running=!0,this.index<this.buffer.length+this.offset&&this.parse()},Je.prototype.getIndex=function(){return this.index},Je.prototype.getSectionStart=function(){return this.sectionStart},Je.prototype.stateText=function(rt){rt===ee.Lt||!this.decodeEntities&&this.fastForwardTo(ee.Lt)?(this.index>this.sectionStart&&this.cbs.ontext(this.sectionStart,this.index),this.state=ae.BeforeTagName,this.sectionStart=this.index):this.decodeEntities&&rt===ee.Amp&&(this.state=ae.BeforeEntity)},Je.prototype.stateSpecialStartSequence=function(rt){var it=this.sequenceIndex===this.currentSequence.length,nt=it?ye(rt):(rt|32)===this.currentSequence[this.sequenceIndex];if(!nt)this.isSpecial=!1;else if(!it){this.sequenceIndex++;return}this.sequenceIndex=0,this.state=ae.InTagName,this.stateInTagName(rt)},Je.prototype.stateInSpecialTag=function(rt){if(this.sequenceIndex===this.currentSequence.length){if(rt===ee.Gt||ve(rt)){var it=this.index-this.currentSequence.length;if(this.sectionStart<it){var nt=this.index;this.index=it,this.cbs.ontext(this.sectionStart,it),this.index=nt}this.isSpecial=!1,this.sectionStart=it+2,this.stateInClosingTagName(rt);return}this.sequenceIndex=0}(rt|32)===this.currentSequence[this.sequenceIndex]?this.sequenceIndex+=1:this.sequenceIndex===0?this.currentSequence===Qe.TitleEnd?this.decodeEntities&&rt===ee.Amp&&(this.state=ae.BeforeEntity):this.fastForwardTo(ee.Lt)&&(this.sequenceIndex=1):this.sequenceIndex=+(rt===ee.Lt)},Je.prototype.stateCDATASequence=function(rt){rt===Qe.Cdata[this.sequenceIndex]?++this.sequenceIndex===Qe.Cdata.length&&(this.state=ae.InCommentLike,this.currentSequence=Qe.CdataEnd,this.sequenceIndex=0,this.sectionStart=this.index+1):(this.sequenceIndex=0,this.state=ae.InDeclaration,this.stateInDeclaration(rt))},Je.prototype.fastForwardTo=function(rt){for(;++this.index<this.buffer.length+this.offset;)if(this.buffer.charCodeAt(this.index-this.offset)===rt)return!0;return this.index=this.buffer.length+this.offset-1,!1},Je.prototype.stateInCommentLike=function(rt){rt===this.currentSequence[this.sequenceIndex]?++this.sequenceIndex===this.currentSequence.length&&(this.currentSequence===Qe.CdataEnd?this.cbs.oncdata(this.sectionStart,this.index,2):this.cbs.oncomment(this.sectionStart,this.index,2),this.sequenceIndex=0,this.sectionStart=this.index+1,this.state=ae.Text):this.sequenceIndex===0?this.fastForwardTo(this.currentSequence[0])&&(this.sequenceIndex=1):rt!==this.currentSequence[this.sequenceIndex-1]&&(this.sequenceIndex=0)},Je.prototype.isTagStartChar=function(rt){return this.xmlMode?!ye(rt):Ke(rt)},Je.prototype.startSpecial=function(rt,it){this.isSpecial=!0,this.currentSequence=rt,this.sequenceIndex=it,this.state=ae.SpecialStartSequence},Je.prototype.stateBeforeTagName=function(rt){if(rt===ee.ExclamationMark)this.state=ae.BeforeDeclaration,this.sectionStart=this.index+1;else if(rt===ee.Questionmark)this.state=ae.InProcessingInstruction,this.sectionStart=this.index+1;else if(this.isTagStartChar(rt)){var it=rt|32;this.sectionStart=this.index,!this.xmlMode&&it===Qe.TitleEnd[2]?this.startSpecial(Qe.TitleEnd,3):this.state=!this.xmlMode&&it===Qe.ScriptEnd[2]?ae.BeforeSpecialS:ae.InTagName}else rt===ee.Slash?this.state=ae.BeforeClosingTagName:(this.state=ae.Text,this.stateText(rt))},Je.prototype.stateInTagName=function(rt){ye(rt)&&(this.cbs.onopentagname(this.sectionStart,this.index),this.sectionStart=-1,this.state=ae.BeforeAttributeName,this.stateBeforeAttributeName(rt))},Je.prototype.stateBeforeClosingTagName=function(rt){ve(rt)||(rt===ee.Gt?this.state=ae.Text:(this.state=this.isTagStartChar(rt)?ae.InClosingTagName:ae.InSpecialComment,this.sectionStart=this.index))},Je.prototype.stateInClosingTagName=function(rt){(rt===ee.Gt||ve(rt))&&(this.cbs.onclosetag(this.sectionStart,this.index),this.sectionStart=-1,this.state=ae.AfterClosingTagName,this.stateAfterClosingTagName(rt))},Je.prototype.stateAfterClosingTagName=function(rt){(rt===ee.Gt||this.fastForwardTo(ee.Gt))&&(this.state=ae.Text,this.baseState=ae.Text,this.sectionStart=this.index+1)},Je.prototype.stateBeforeAttributeName=function(rt){rt===ee.Gt?(this.cbs.onopentagend(this.index),this.isSpecial?(this.state=ae.InSpecialTag,this.sequenceIndex=0):this.state=ae.Text,this.baseState=this.state,this.sectionStart=this.index+1):rt===ee.Slash?this.state=ae.InSelfClosingTag:ve(rt)||(this.state=ae.InAttributeName,this.sectionStart=this.index)},Je.prototype.stateInSelfClosingTag=function(rt){rt===ee.Gt?(this.cbs.onselfclosingtag(this.index),this.state=ae.Text,this.baseState=ae.Text,this.sectionStart=this.index+1,this.isSpecial=!1):ve(rt)||(this.state=ae.BeforeAttributeName,this.stateBeforeAttributeName(rt))},Je.prototype.stateInAttributeName=function(rt){(rt===ee.Eq||ye(rt))&&(this.cbs.onattribname(this.sectionStart,this.index),this.sectionStart=-1,this.state=ae.AfterAttributeName,this.stateAfterAttributeName(rt))},Je.prototype.stateAfterAttributeName=function(rt){rt===ee.Eq?this.state=ae.BeforeAttributeValue:rt===ee.Slash||rt===ee.Gt?(this.cbs.onattribend(Xe.NoValue,this.index),this.state=ae.BeforeAttributeName,this.stateBeforeAttributeName(rt)):ve(rt)||(this.cbs.onattribend(Xe.NoValue,this.index),this.state=ae.InAttributeName,this.sectionStart=this.index)},Je.prototype.stateBeforeAttributeValue=function(rt){rt===ee.DoubleQuote?(this.state=ae.InAttributeValueDq,this.sectionStart=this.index+1):rt===ee.SingleQuote?(this.state=ae.InAttributeValueSq,this.sectionStart=this.index+1):ve(rt)||(this.sectionStart=this.index,this.state=ae.InAttributeValueNq,this.stateInAttributeValueNoQuotes(rt))},Je.prototype.handleInAttributeValue=function(rt,it){rt===it||!this.decodeEntities&&this.fastForwardTo(it)?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(it===ee.DoubleQuote?Xe.Double:Xe.Single,this.index),this.state=ae.BeforeAttributeName):this.decodeEntities&&rt===ee.Amp&&(this.baseState=this.state,this.state=ae.BeforeEntity)},Je.prototype.stateInAttributeValueDoubleQuotes=function(rt){this.handleInAttributeValue(rt,ee.DoubleQuote)},Je.prototype.stateInAttributeValueSingleQuotes=function(rt){this.handleInAttributeValue(rt,ee.SingleQuote)},Je.prototype.stateInAttributeValueNoQuotes=function(rt){ve(rt)||rt===ee.Gt?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(Xe.Unquoted,this.index),this.state=ae.BeforeAttributeName,this.stateBeforeAttributeName(rt)):this.decodeEntities&&rt===ee.Amp&&(this.baseState=this.state,this.state=ae.BeforeEntity)},Je.prototype.stateBeforeDeclaration=function(rt){rt===ee.OpeningSquareBracket?(this.state=ae.CDATASequence,this.sequenceIndex=0):this.state=rt===ee.Dash?ae.BeforeComment:ae.InDeclaration},Je.prototype.stateInDeclaration=function(rt){(rt===ee.Gt||this.fastForwardTo(ee.Gt))&&(this.cbs.ondeclaration(this.sectionStart,this.index),this.state=ae.Text,this.sectionStart=this.index+1)},Je.prototype.stateInProcessingInstruction=function(rt){(rt===ee.Gt||this.fastForwardTo(ee.Gt))&&(this.cbs.onprocessinginstruction(this.sectionStart,this.index),this.state=ae.Text,this.sectionStart=this.index+1)},Je.prototype.stateBeforeComment=function(rt){rt===ee.Dash?(this.state=ae.InCommentLike,this.currentSequence=Qe.CommentEnd,this.sequenceIndex=2,this.sectionStart=this.index+1):this.state=ae.InDeclaration},Je.prototype.stateInSpecialComment=function(rt){(rt===ee.Gt||this.fastForwardTo(ee.Gt))&&(this.cbs.oncomment(this.sectionStart,this.index,0),this.state=ae.Text,this.sectionStart=this.index+1)},Je.prototype.stateBeforeSpecialS=function(rt){var it=rt|32;it===Qe.ScriptEnd[3]?this.startSpecial(Qe.ScriptEnd,4):it===Qe.StyleEnd[3]?this.startSpecial(Qe.StyleEnd,4):(this.state=ae.InTagName,this.stateInTagName(rt))},Je.prototype.stateBeforeEntity=function(rt){this.entityExcess=1,this.entityResult=0,rt===ee.Number?this.state=ae.BeforeNumericEntity:rt===ee.Amp||(this.trieIndex=0,this.trieCurrent=this.entityTrie[0],this.state=ae.InNamedEntity,this.stateInNamedEntity(rt))},Je.prototype.stateInNamedEntity=function(rt){if(this.entityExcess+=1,this.trieIndex=(0,Z.determineBranch)(this.entityTrie,this.trieCurrent,this.trieIndex+1,rt),this.trieIndex<0){this.emitNamedEntity(),this.index--;return}this.trieCurrent=this.entityTrie[this.trieIndex];var it=this.trieCurrent&Z.BinTrieFlags.VALUE_LENGTH;if(it){var nt=(it>>14)-1;if(!this.allowLegacyEntity()&&rt!==ee.Semi)this.trieIndex+=nt;else{var tt=this.index-this.entityExcess+1;tt>this.sectionStart&&this.emitPartial(this.sectionStart,tt),this.entityResult=this.trieIndex,this.trieIndex+=nt,this.entityExcess=0,this.sectionStart=this.index+1,nt===0&&this.emitNamedEntity()}}},Je.prototype.emitNamedEntity=function(){if(this.state=this.baseState,this.entityResult!==0){var rt=(this.entityTrie[this.entityResult]&Z.BinTrieFlags.VALUE_LENGTH)>>14;switch(rt){case 1:{this.emitCodePoint(this.entityTrie[this.entityResult]&~Z.BinTrieFlags.VALUE_LENGTH);break}case 2:{this.emitCodePoint(this.entityTrie[this.entityResult+1]);break}case 3:this.emitCodePoint(this.entityTrie[this.entityResult+1]),this.emitCodePoint(this.entityTrie[this.entityResult+2])}}},Je.prototype.stateBeforeNumericEntity=function(rt){(rt|32)===ee.LowerX?(this.entityExcess++,this.state=ae.InHexEntity):(this.state=ae.InNumericEntity,this.stateInNumericEntity(rt))},Je.prototype.emitNumericEntity=function(rt){var it=this.index-this.entityExcess-1,nt=it+2+ +(this.state===ae.InHexEntity);nt!==this.index&&(it>this.sectionStart&&this.emitPartial(this.sectionStart,it),this.sectionStart=this.index+Number(rt),this.emitCodePoint((0,Z.replaceCodePoint)(this.entityResult))),this.state=this.baseState},Je.prototype.stateInNumericEntity=function(rt){rt===ee.Semi?this.emitNumericEntity(!0):be(rt)?(this.entityResult=this.entityResult*10+(rt-ee.Zero),this.entityExcess++):(this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state=this.baseState,this.index--)},Je.prototype.stateInHexEntity=function(rt){rt===ee.Semi?this.emitNumericEntity(!0):be(rt)?(this.entityResult=this.entityResult*16+(rt-ee.Zero),this.entityExcess++):Ye(rt)?(this.entityResult=this.entityResult*16+((rt|32)-ee.LowerA+10),this.entityExcess++):(this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state=this.baseState,this.index--)},Je.prototype.allowLegacyEntity=function(){return!this.xmlMode&&(this.baseState===ae.Text||this.baseState===ae.InSpecialTag)},Je.prototype.cleanup=function(){this.running&&this.sectionStart!==this.index&&(this.state===ae.Text||this.state===ae.InSpecialTag&&this.sequenceIndex===0?(this.cbs.ontext(this.sectionStart,this.index),this.sectionStart=this.index):(this.state===ae.InAttributeValueDq||this.state===ae.InAttributeValueSq||this.state===ae.InAttributeValueNq)&&(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=this.index))},Je.prototype.shouldContinue=function(){return this.index<this.buffer.length+this.offset&&this.running},Je.prototype.parse=function(){for(;this.shouldContinue();){var rt=this.buffer.charCodeAt(this.index-this.offset);switch(this.state){case ae.Text:{this.stateText(rt);break}case ae.SpecialStartSequence:{this.stateSpecialStartSequence(rt);break}case ae.InSpecialTag:{this.stateInSpecialTag(rt);break}case ae.CDATASequence:{this.stateCDATASequence(rt);break}case ae.InAttributeValueDq:{this.stateInAttributeValueDoubleQuotes(rt);break}case ae.InAttributeName:{this.stateInAttributeName(rt);break}case ae.InCommentLike:{this.stateInCommentLike(rt);break}case ae.InSpecialComment:{this.stateInSpecialComment(rt);break}case ae.BeforeAttributeName:{this.stateBeforeAttributeName(rt);break}case ae.InTagName:{this.stateInTagName(rt);break}case ae.InClosingTagName:{this.stateInClosingTagName(rt);break}case ae.BeforeTagName:{this.stateBeforeTagName(rt);break}case ae.AfterAttributeName:{this.stateAfterAttributeName(rt);break}case ae.InAttributeValueSq:{this.stateInAttributeValueSingleQuotes(rt);break}case ae.BeforeAttributeValue:{this.stateBeforeAttributeValue(rt);break}case ae.BeforeClosingTagName:{this.stateBeforeClosingTagName(rt);break}case ae.AfterClosingTagName:{this.stateAfterClosingTagName(rt);break}case ae.BeforeSpecialS:{this.stateBeforeSpecialS(rt);break}case ae.InAttributeValueNq:{this.stateInAttributeValueNoQuotes(rt);break}case ae.InSelfClosingTag:{this.stateInSelfClosingTag(rt);break}case ae.InDeclaration:{this.stateInDeclaration(rt);break}case ae.BeforeDeclaration:{this.stateBeforeDeclaration(rt);break}case ae.BeforeComment:{this.stateBeforeComment(rt);break}case ae.InProcessingInstruction:{this.stateInProcessingInstruction(rt);break}case ae.InNamedEntity:{this.stateInNamedEntity(rt);break}case ae.BeforeEntity:{this.stateBeforeEntity(rt);break}case ae.InHexEntity:{this.stateInHexEntity(rt);break}case ae.InNumericEntity:{this.stateInNumericEntity(rt);break}default:this.stateBeforeNumericEntity(rt)}this.index++}this.cleanup()},Je.prototype.finish=function(){this.state===ae.InNamedEntity&&this.emitNamedEntity(),this.sectionStart<this.index&&this.handleTrailingData(),this.cbs.onend()},Je.prototype.handleTrailingData=function(){var rt=this.buffer.length+this.offset;this.state===ae.InCommentLike?this.currentSequence===Qe.CdataEnd?this.cbs.oncdata(this.sectionStart,rt,0):this.cbs.oncomment(this.sectionStart,rt,0):this.state===ae.InNumericEntity&&this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state===ae.InHexEntity&&this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state===ae.InTagName||this.state===ae.BeforeAttributeName||this.state===ae.BeforeAttributeValue||this.state===ae.AfterAttributeName||this.state===ae.InAttributeName||this.state===ae.InAttributeValueSq||this.state===ae.InAttributeValueDq||this.state===ae.InAttributeValueNq||this.state===ae.InClosingTagName||this.cbs.ontext(this.sectionStart,rt)},Je.prototype.emitPartial=function(rt,it){this.baseState!==ae.Text&&this.baseState!==ae.InSpecialTag?this.cbs.onattribdata(rt,it):this.cbs.ontext(rt,it)},Je.prototype.emitCodePoint=function(rt){this.baseState!==ae.Text&&this.baseState!==ae.InSpecialTag?this.cbs.onattribentity(rt):this.cbs.ontextentity(rt)},Je}();ie.default=et})(Tokenizer);var __createBinding$1=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(ie,Z,ee,ae){ae===void 0&&(ae=ee);var ve=Object.getOwnPropertyDescriptor(Z,ee);(!ve||("get"in ve?!Z.__esModule:ve.writable||ve.configurable))&&(ve={enumerable:!0,get:function(){return Z[ee]}}),Object.defineProperty(ie,ae,ve)}:function(ie,Z,ee,ae){ae===void 0&&(ae=ee),ie[ae]=Z[ee]}),__setModuleDefault$1=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(ie,Z){Object.defineProperty(ie,"default",{enumerable:!0,value:Z})}:function(ie,Z){ie.default=Z}),__importStar$1=commonjsGlobal&&commonjsGlobal.__importStar||function(ie){if(ie&&ie.__esModule)return ie;var Z={};if(ie!=null)for(var ee in ie)ee!=="default"&&Object.prototype.hasOwnProperty.call(ie,ee)&&__createBinding$1(Z,ie,ee);return __setModuleDefault$1(Z,ie),Z};Object.defineProperty(Parser$3,"__esModule",{value:!0});Parser$3.Parser=void 0;var Tokenizer_js_1=__importStar$1(Tokenizer),decode_js_1=decode,formTags=new Set(["input","option","optgroup","select","button","datalist","textarea"]),pTag=new Set(["p"]),tableSectionTags=new Set(["thead","tbody"]),ddtTags=new Set(["dd","dt"]),rtpTags=new Set(["rt","rp"]),openImpliesClose=new Map([["tr",new Set(["tr","th","td"])],["th",new Set(["th"])],["td",new Set(["thead","th","td"])],["body",new Set(["head","link","script"])],["li",new Set(["li"])],["p",pTag],["h1",pTag],["h2",pTag],["h3",pTag],["h4",pTag],["h5",pTag],["h6",pTag],["select",formTags],["input",formTags],["output",formTags],["button",formTags],["datalist",formTags],["textarea",formTags],["option",new Set(["option"])],["optgroup",new Set(["optgroup","option"])],["dd",ddtTags],["dt",ddtTags],["address",pTag],["article",pTag],["aside",pTag],["blockquote",pTag],["details",pTag],["div",pTag],["dl",pTag],["fieldset",pTag],["figcaption",pTag],["figure",pTag],["footer",pTag],["form",pTag],["header",pTag],["hr",pTag],["main",pTag],["nav",pTag],["ol",pTag],["pre",pTag],["section",pTag],["table",pTag],["ul",pTag],["rt",rtpTags],["rp",rtpTags],["tbody",tableSectionTags],["tfoot",tableSectionTags]]),voidElements=new Set(["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"]),foreignContextElements=new Set(["math","svg"]),htmlIntegrationElements=new Set(["mi","mo","mn","ms","mtext","annotation-xml","foreignobject","desc","title"]),reNameEnd=/\s|\//,Parser$2=function(){function ie(Z,ee){ee===void 0&&(ee={});var ae,ve,ye,be,Ke;this.options=ee,this.startIndex=0,this.endIndex=0,this.openTagStart=0,this.tagname="",this.attribname="",this.attribvalue="",this.attribs=null,this.stack=[],this.foreignContext=[],this.buffers=[],this.bufferOffset=0,this.writeIndex=0,this.ended=!1,this.cbs=Z??{},this.lowerCaseTagNames=(ae=ee.lowerCaseTags)!==null&&ae!==void 0?ae:!ee.xmlMode,this.lowerCaseAttributeNames=(ve=ee.lowerCaseAttributeNames)!==null&&ve!==void 0?ve:!ee.xmlMode,this.tokenizer=new((ye=ee.Tokenizer)!==null&&ye!==void 0?ye:Tokenizer_js_1.default)(this.options,this),(Ke=(be=this.cbs).onparserinit)===null||Ke===void 0||Ke.call(be,this)}return ie.prototype.ontext=function(Z,ee){var ae,ve,ye=this.getSlice(Z,ee);this.endIndex=ee-1,(ve=(ae=this.cbs).ontext)===null||ve===void 0||ve.call(ae,ye),this.startIndex=ee},ie.prototype.ontextentity=function(Z){var ee,ae,ve=this.tokenizer.getSectionStart();this.endIndex=ve-1,(ae=(ee=this.cbs).ontext)===null||ae===void 0||ae.call(ee,(0,decode_js_1.fromCodePoint)(Z)),this.startIndex=ve},ie.prototype.isVoidElement=function(Z){return!this.options.xmlMode&&voidElements.has(Z)},ie.prototype.onopentagname=function(Z,ee){this.endIndex=ee;var ae=this.getSlice(Z,ee);this.lowerCaseTagNames&&(ae=ae.toLowerCase()),this.emitOpenTag(ae)},ie.prototype.emitOpenTag=function(Z){var ee,ae,ve,ye;this.openTagStart=this.startIndex,this.tagname=Z;var be=!this.options.xmlMode&&openImpliesClose.get(Z);if(be)for(;this.stack.length>0&&be.has(this.stack[this.stack.length-1]);){var Ke=this.stack.pop();(ae=(ee=this.cbs).onclosetag)===null||ae===void 0||ae.call(ee,Ke,!0)}this.isVoidElement(Z)||(this.stack.push(Z),foreignContextElements.has(Z)?this.foreignContext.push(!0):htmlIntegrationElements.has(Z)&&this.foreignContext.push(!1)),(ye=(ve=this.cbs).onopentagname)===null||ye===void 0||ye.call(ve,Z),this.cbs.onopentag&&(this.attribs={})},ie.prototype.endOpenTag=function(Z){var ee,ae;this.startIndex=this.openTagStart,this.attribs&&((ae=(ee=this.cbs).onopentag)===null||ae===void 0||ae.call(ee,this.tagname,this.attribs,Z),this.attribs=null),this.cbs.onclosetag&&this.isVoidElement(this.tagname)&&this.cbs.onclosetag(this.tagname,!0),this.tagname=""},ie.prototype.onopentagend=function(Z){this.endIndex=Z,this.endOpenTag(!1),this.startIndex=Z+1},ie.prototype.onclosetag=function(Z,ee){var ae,ve,ye,be,Ke,Ye;this.endIndex=ee;var Xe=this.getSlice(Z,ee);if(this.lowerCaseTagNames&&(Xe=Xe.toLowerCase()),(foreignContextElements.has(Xe)||htmlIntegrationElements.has(Xe))&&this.foreignContext.pop(),this.isVoidElement(Xe))!this.options.xmlMode&&Xe==="br"&&((ve=(ae=this.cbs).onopentagname)===null||ve===void 0||ve.call(ae,"br"),(be=(ye=this.cbs).onopentag)===null||be===void 0||be.call(ye,"br",{},!0),(Ye=(Ke=this.cbs).onclosetag)===null||Ye===void 0||Ye.call(Ke,"br",!1));else{var Qe=this.stack.lastIndexOf(Xe);if(Qe!==-1)if(this.cbs.onclosetag)for(var et=this.stack.length-Qe;et--;)this.cbs.onclosetag(this.stack.pop(),et!==0);else this.stack.length=Qe;else!this.options.xmlMode&&Xe==="p"&&(this.emitOpenTag("p"),this.closeCurrentTag(!0))}this.startIndex=ee+1},ie.prototype.onselfclosingtag=function(Z){this.endIndex=Z,this.options.xmlMode||this.options.recognizeSelfClosing||this.foreignContext[this.foreignContext.length-1]?(this.closeCurrentTag(!1),this.startIndex=Z+1):this.onopentagend(Z)},ie.prototype.closeCurrentTag=function(Z){var ee,ae,ve=this.tagname;this.endOpenTag(Z),this.stack[this.stack.length-1]===ve&&((ae=(ee=this.cbs).onclosetag)===null||ae===void 0||ae.call(ee,ve,!Z),this.stack.pop())},ie.prototype.onattribname=function(Z,ee){this.startIndex=Z;var ae=this.getSlice(Z,ee);this.attribname=this.lowerCaseAttributeNames?ae.toLowerCase():ae},ie.prototype.onattribdata=function(Z,ee){this.attribvalue+=this.getSlice(Z,ee)},ie.prototype.onattribentity=function(Z){this.attribvalue+=(0,decode_js_1.fromCodePoint)(Z)},ie.prototype.onattribend=function(Z,ee){var ae,ve;this.endIndex=ee,(ve=(ae=this.cbs).onattribute)===null||ve===void 0||ve.call(ae,this.attribname,this.attribvalue,Z===Tokenizer_js_1.QuoteType.Double?'"':Z===Tokenizer_js_1.QuoteType.Single?"'":Z===Tokenizer_js_1.QuoteType.NoValue?void 0:null),this.attribs&&!Object.prototype.hasOwnProperty.call(this.attribs,this.attribname)&&(this.attribs[this.attribname]=this.attribvalue),this.attribvalue=""},ie.prototype.getInstructionName=function(Z){var ee=Z.search(reNameEnd),ae=ee<0?Z:Z.substr(0,ee);return this.lowerCaseTagNames&&(ae=ae.toLowerCase()),ae},ie.prototype.ondeclaration=function(Z,ee){this.endIndex=ee;var ae=this.getSlice(Z,ee);if(this.cbs.onprocessinginstruction){var ve=this.getInstructionName(ae);this.cbs.onprocessinginstruction("!".concat(ve),"!".concat(ae))}this.startIndex=ee+1},ie.prototype.onprocessinginstruction=function(Z,ee){this.endIndex=ee;var ae=this.getSlice(Z,ee);if(this.cbs.onprocessinginstruction){var ve=this.getInstructionName(ae);this.cbs.onprocessinginstruction("?".concat(ve),"?".concat(ae))}this.startIndex=ee+1},ie.prototype.oncomment=function(Z,ee,ae){var ve,ye,be,Ke;this.endIndex=ee,(ye=(ve=this.cbs).oncomment)===null||ye===void 0||ye.call(ve,this.getSlice(Z,ee-ae)),(Ke=(be=this.cbs).oncommentend)===null||Ke===void 0||Ke.call(be),this.startIndex=ee+1},ie.prototype.oncdata=function(Z,ee,ae){var ve,ye,be,Ke,Ye,Xe,Qe,et,Je,rt;this.endIndex=ee;var it=this.getSlice(Z,ee-ae);this.options.xmlMode||this.options.recognizeCDATA?((ye=(ve=this.cbs).oncdatastart)===null||ye===void 0||ye.call(ve),(Ke=(be=this.cbs).ontext)===null||Ke===void 0||Ke.call(be,it),(Xe=(Ye=this.cbs).oncdataend)===null||Xe===void 0||Xe.call(Ye)):((et=(Qe=this.cbs).oncomment)===null||et===void 0||et.call(Qe,"[CDATA[".concat(it,"]]")),(rt=(Je=this.cbs).oncommentend)===null||rt===void 0||rt.call(Je)),this.startIndex=ee+1},ie.prototype.onend=function(){var Z,ee;if(this.cbs.onclosetag){this.endIndex=this.startIndex;for(var ae=this.stack.length;ae>0;this.cbs.onclosetag(this.stack[--ae],!0));}(ee=(Z=this.cbs).onend)===null||ee===void 0||ee.call(Z)},ie.prototype.reset=function(){var Z,ee,ae,ve;(ee=(Z=this.cbs).onreset)===null||ee===void 0||ee.call(Z),this.tokenizer.reset(),this.tagname="",this.attribname="",this.attribs=null,this.stack.length=0,this.startIndex=0,this.endIndex=0,(ve=(ae=this.cbs).onparserinit)===null||ve===void 0||ve.call(ae,this),this.buffers.length=0,this.bufferOffset=0,this.writeIndex=0,this.ended=!1},ie.prototype.parseComplete=function(Z){this.reset(),this.end(Z)},ie.prototype.getSlice=function(Z,ee){for(;Z-this.bufferOffset>=this.buffers[0].length;)this.shiftBuffer();for(var ae=this.buffers[0].slice(Z-this.bufferOffset,ee-this.bufferOffset);ee-this.bufferOffset>this.buffers[0].length;)this.shiftBuffer(),ae+=this.buffers[0].slice(0,ee-this.bufferOffset);return ae},ie.prototype.shiftBuffer=function(){this.bufferOffset+=this.buffers[0].length,this.writeIndex--,this.buffers.shift()},ie.prototype.write=function(Z){var ee,ae;if(this.ended){(ae=(ee=this.cbs).onerror)===null||ae===void 0||ae.call(ee,new Error(".write() after done!"));return}this.buffers.push(Z),this.tokenizer.running&&(this.tokenizer.write(Z),this.writeIndex++)},ie.prototype.end=function(Z){var ee,ae;if(this.ended){(ae=(ee=this.cbs).onerror)===null||ae===void 0||ae.call(ee,new Error(".end() after done!"));return}Z&&this.write(Z),this.ended=!0,this.tokenizer.end()},ie.prototype.pause=function(){this.tokenizer.pause()},ie.prototype.resume=function(){for(this.tokenizer.resume();this.tokenizer.running&&this.writeIndex<this.buffers.length;)this.tokenizer.write(this.buffers[this.writeIndex++]);this.ended&&this.tokenizer.end()},ie.prototype.parseChunk=function(Z){this.write(Z)},ie.prototype.done=function(Z){this.end(Z)},ie}();Parser$3.Parser=Parser$2;var lib$4={},lib$3={};(function(ie){Object.defineProperty(ie,"__esModule",{value:!0}),ie.Doctype=ie.CDATA=ie.Tag=ie.Style=ie.Script=ie.Comment=ie.Directive=ie.Text=ie.Root=ie.isTag=ie.ElementType=void 0;var Z;(function(ae){ae.Root="root",ae.Text="text",ae.Directive="directive",ae.Comment="comment",ae.Script="script",ae.Style="style",ae.Tag="tag",ae.CDATA="cdata",ae.Doctype="doctype"})(Z=ie.ElementType||(ie.ElementType={}));function ee(ae){return ae.type===Z.Tag||ae.type===Z.Script||ae.type===Z.Style}ie.isTag=ee,ie.Root=Z.Root,ie.Text=Z.Text,ie.Directive=Z.Directive,ie.Comment=Z.Comment,ie.Script=Z.Script,ie.Style=Z.Style,ie.Tag=Z.Tag,ie.CDATA=Z.CDATA,ie.Doctype=Z.Doctype})(lib$3);var node$1={},__extends=commonjsGlobal&&commonjsGlobal.__extends||function(){var ie=function(Z,ee){return ie=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(ae,ve){ae.__proto__=ve}||function(ae,ve){for(var ye in ve)Object.prototype.hasOwnProperty.call(ve,ye)&&(ae[ye]=ve[ye])},ie(Z,ee)};return function(Z,ee){if(typeof ee!="function"&&ee!==null)throw new TypeError("Class extends value "+String(ee)+" is not a constructor or null");ie(Z,ee);function ae(){this.constructor=Z}Z.prototype=ee===null?Object.create(ee):(ae.prototype=ee.prototype,new ae)}}(),__assign$2=commonjsGlobal&&commonjsGlobal.__assign||function(){return __assign$2=Object.assign||function(ie){for(var Z,ee=1,ae=arguments.length;ee<ae;ee++){Z=arguments[ee];for(var ve in Z)Object.prototype.hasOwnProperty.call(Z,ve)&&(ie[ve]=Z[ve])}return ie},__assign$2.apply(this,arguments)};Object.defineProperty(node$1,"__esModule",{value:!0});node$1.cloneNode=node$1.hasChildren=node$1.isDocument=node$1.isDirective=node$1.isComment=node$1.isText=node$1.isCDATA=node$1.isTag=node$1.Element=node$1.Document=node$1.CDATA=node$1.NodeWithChildren=node$1.ProcessingInstruction=node$1.Comment=node$1.Text=node$1.DataNode=node$1.Node=void 0;var domelementtype_1$1=lib$3,Node$6=function(){function ie(){this.parent=null,this.prev=null,this.next=null,this.startIndex=null,this.endIndex=null}return Object.defineProperty(ie.prototype,"parentNode",{get:function(){return this.parent},set:function(Z){this.parent=Z},enumerable:!1,configurable:!0}),Object.defineProperty(ie.prototype,"previousSibling",{get:function(){return this.prev},set:function(Z){this.prev=Z},enumerable:!1,configurable:!0}),Object.defineProperty(ie.prototype,"nextSibling",{get:function(){return this.next},set:function(Z){this.next=Z},enumerable:!1,configurable:!0}),ie.prototype.cloneNode=function(Z){return Z===void 0&&(Z=!1),cloneNode$1(this,Z)},ie}();node$1.Node=Node$6;var DataNode=function(ie){__extends(Z,ie);function Z(ee){var ae=ie.call(this)||this;return ae.data=ee,ae}return Object.defineProperty(Z.prototype,"nodeValue",{get:function(){return this.data},set:function(ee){this.data=ee},enumerable:!1,configurable:!0}),Z}(Node$6);node$1.DataNode=DataNode;var Text=function(ie){__extends(Z,ie);function Z(){var ee=ie!==null&&ie.apply(this,arguments)||this;return ee.type=domelementtype_1$1.ElementType.Text,ee}return Object.defineProperty(Z.prototype,"nodeType",{get:function(){return 3},enumerable:!1,configurable:!0}),Z}(DataNode);node$1.Text=Text;var Comment$5=function(ie){__extends(Z,ie);function Z(){var ee=ie!==null&&ie.apply(this,arguments)||this;return ee.type=domelementtype_1$1.ElementType.Comment,ee}return Object.defineProperty(Z.prototype,"nodeType",{get:function(){return 8},enumerable:!1,configurable:!0}),Z}(DataNode);node$1.Comment=Comment$5;var ProcessingInstruction=function(ie){__extends(Z,ie);function Z(ee,ae){var ve=ie.call(this,ae)||this;return ve.name=ee,ve.type=domelementtype_1$1.ElementType.Directive,ve}return Object.defineProperty(Z.prototype,"nodeType",{get:function(){return 1},enumerable:!1,configurable:!0}),Z}(DataNode);node$1.ProcessingInstruction=ProcessingInstruction;var NodeWithChildren=function(ie){__extends(Z,ie);function Z(ee){var ae=ie.call(this)||this;return ae.children=ee,ae}return Object.defineProperty(Z.prototype,"firstChild",{get:function(){var ee;return(ee=this.children[0])!==null&&ee!==void 0?ee:null},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"lastChild",{get:function(){return this.children.length>0?this.children[this.children.length-1]:null},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"childNodes",{get:function(){return this.children},set:function(ee){this.children=ee},enumerable:!1,configurable:!0}),Z}(Node$6);node$1.NodeWithChildren=NodeWithChildren;var CDATA=function(ie){__extends(Z,ie);function Z(){var ee=ie!==null&&ie.apply(this,arguments)||this;return ee.type=domelementtype_1$1.ElementType.CDATA,ee}return Object.defineProperty(Z.prototype,"nodeType",{get:function(){return 4},enumerable:!1,configurable:!0}),Z}(NodeWithChildren);node$1.CDATA=CDATA;var Document$4=function(ie){__extends(Z,ie);function Z(){var ee=ie!==null&&ie.apply(this,arguments)||this;return ee.type=domelementtype_1$1.ElementType.Root,ee}return Object.defineProperty(Z.prototype,"nodeType",{get:function(){return 9},enumerable:!1,configurable:!0}),Z}(NodeWithChildren);node$1.Document=Document$4;var Element$1=function(ie){__extends(Z,ie);function Z(ee,ae,ve,ye){ve===void 0&&(ve=[]),ye===void 0&&(ye=ee==="script"?domelementtype_1$1.ElementType.Script:ee==="style"?domelementtype_1$1.ElementType.Style:domelementtype_1$1.ElementType.Tag);var be=ie.call(this,ve)||this;return be.name=ee,be.attribs=ae,be.type=ye,be}return Object.defineProperty(Z.prototype,"nodeType",{get:function(){return 1},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"tagName",{get:function(){return this.name},set:function(ee){this.name=ee},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"attributes",{get:function(){var ee=this;return Object.keys(this.attribs).map(function(ae){var ve,ye;return{name:ae,value:ee.attribs[ae],namespace:(ve=ee["x-attribsNamespace"])===null||ve===void 0?void 0:ve[ae],prefix:(ye=ee["x-attribsPrefix"])===null||ye===void 0?void 0:ye[ae]}})},enumerable:!1,configurable:!0}),Z}(NodeWithChildren);node$1.Element=Element$1;function isTag(ie){return(0,domelementtype_1$1.isTag)(ie)}node$1.isTag=isTag;function isCDATA(ie){return ie.type===domelementtype_1$1.ElementType.CDATA}node$1.isCDATA=isCDATA;function isText(ie){return ie.type===domelementtype_1$1.ElementType.Text}node$1.isText=isText;function isComment(ie){return ie.type===domelementtype_1$1.ElementType.Comment}node$1.isComment=isComment;function isDirective(ie){return ie.type===domelementtype_1$1.ElementType.Directive}node$1.isDirective=isDirective;function isDocument(ie){return ie.type===domelementtype_1$1.ElementType.Root}node$1.isDocument=isDocument;function hasChildren(ie){return Object.prototype.hasOwnProperty.call(ie,"children")}node$1.hasChildren=hasChildren;function cloneNode$1(ie,Z){Z===void 0&&(Z=!1);var ee;if(isText(ie))ee=new Text(ie.data);else if(isComment(ie))ee=new Comment$5(ie.data);else if(isTag(ie)){var ae=Z?cloneChildren(ie.children):[],ve=new Element$1(ie.name,__assign$2({},ie.attribs),ae);ae.forEach(function(Ye){return Ye.parent=ve}),ie.namespace!=null&&(ve.namespace=ie.namespace),ie["x-attribsNamespace"]&&(ve["x-attribsNamespace"]=__assign$2({},ie["x-attribsNamespace"])),ie["x-attribsPrefix"]&&(ve["x-attribsPrefix"]=__assign$2({},ie["x-attribsPrefix"])),ee=ve}else if(isCDATA(ie)){var ae=Z?cloneChildren(ie.children):[],ye=new CDATA(ae);ae.forEach(function(Xe){return Xe.parent=ye}),ee=ye}else if(isDocument(ie)){var ae=Z?cloneChildren(ie.children):[],be=new Document$4(ae);ae.forEach(function(Xe){return Xe.parent=be}),ie["x-mode"]&&(be["x-mode"]=ie["x-mode"]),ee=be}else if(isDirective(ie)){var Ke=new ProcessingInstruction(ie.name,ie.data);ie["x-name"]!=null&&(Ke["x-name"]=ie["x-name"],Ke["x-publicId"]=ie["x-publicId"],Ke["x-systemId"]=ie["x-systemId"]),ee=Ke}else throw new Error("Not implemented yet: ".concat(ie.type));return ee.startIndex=ie.startIndex,ee.endIndex=ie.endIndex,ie.sourceCodeLocation!=null&&(ee.sourceCodeLocation=ie.sourceCodeLocation),ee}node$1.cloneNode=cloneNode$1;function cloneChildren(ie){for(var Z=ie.map(function(ae){return cloneNode$1(ae,!0)}),ee=1;ee<Z.length;ee++)Z[ee].prev=Z[ee-1],Z[ee-1].next=Z[ee];return Z}(function(ie){var Z=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(Ke,Ye,Xe,Qe){Qe===void 0&&(Qe=Xe);var et=Object.getOwnPropertyDescriptor(Ye,Xe);(!et||("get"in et?!Ye.__esModule:et.writable||et.configurable))&&(et={enumerable:!0,get:function(){return Ye[Xe]}}),Object.defineProperty(Ke,Qe,et)}:function(Ke,Ye,Xe,Qe){Qe===void 0&&(Qe=Xe),Ke[Qe]=Ye[Xe]}),ee=commonjsGlobal&&commonjsGlobal.__exportStar||function(Ke,Ye){for(var Xe in Ke)Xe!=="default"&&!Object.prototype.hasOwnProperty.call(Ye,Xe)&&Z(Ye,Ke,Xe)};Object.defineProperty(ie,"__esModule",{value:!0}),ie.DomHandler=void 0;var ae=lib$3,ve=node$1;ee(node$1,ie);var ye={withStartIndices:!1,withEndIndices:!1,xmlMode:!1},be=function(){function Ke(Ye,Xe,Qe){this.dom=[],this.root=new ve.Document(this.dom),this.done=!1,this.tagStack=[this.root],this.lastNode=null,this.parser=null,typeof Xe=="function"&&(Qe=Xe,Xe=ye),typeof Ye=="object"&&(Xe=Ye,Ye=void 0),this.callback=Ye??null,this.options=Xe??ye,this.elementCB=Qe??null}return Ke.prototype.onparserinit=function(Ye){this.parser=Ye},Ke.prototype.onreset=function(){this.dom=[],this.root=new ve.Document(this.dom),this.done=!1,this.tagStack=[this.root],this.lastNode=null,this.parser=null},Ke.prototype.onend=function(){this.done||(this.done=!0,this.parser=null,this.handleCallback(null))},Ke.prototype.onerror=function(Ye){this.handleCallback(Ye)},Ke.prototype.onclosetag=function(){this.lastNode=null;var Ye=this.tagStack.pop();this.options.withEndIndices&&(Ye.endIndex=this.parser.endIndex),this.elementCB&&this.elementCB(Ye)},Ke.prototype.onopentag=function(Ye,Xe){var Qe=this.options.xmlMode?ae.ElementType.Tag:void 0,et=new ve.Element(Ye,Xe,void 0,Qe);this.addNode(et),this.tagStack.push(et)},Ke.prototype.ontext=function(Ye){var Xe=this.lastNode;if(Xe&&Xe.type===ae.ElementType.Text)Xe.data+=Ye,this.options.withEndIndices&&(Xe.endIndex=this.parser.endIndex);else{var Qe=new ve.Text(Ye);this.addNode(Qe),this.lastNode=Qe}},Ke.prototype.oncomment=function(Ye){if(this.lastNode&&this.lastNode.type===ae.ElementType.Comment){this.lastNode.data+=Ye;return}var Xe=new ve.Comment(Ye);this.addNode(Xe),this.lastNode=Xe},Ke.prototype.oncommentend=function(){this.lastNode=null},Ke.prototype.oncdatastart=function(){var Ye=new ve.Text(""),Xe=new ve.CDATA([Ye]);this.addNode(Xe),Ye.parent=Xe,this.lastNode=Ye},Ke.prototype.oncdataend=function(){this.lastNode=null},Ke.prototype.onprocessinginstruction=function(Ye,Xe){var Qe=new ve.ProcessingInstruction(Ye,Xe);this.addNode(Qe)},Ke.prototype.handleCallback=function(Ye){if(typeof this.callback=="function")this.callback(Ye,this.dom);else if(Ye)throw Ye},Ke.prototype.addNode=function(Ye){var Xe=this.tagStack[this.tagStack.length-1],Qe=Xe.children[Xe.children.length-1];this.options.withStartIndices&&(Ye.startIndex=this.parser.startIndex),this.options.withEndIndices&&(Ye.endIndex=this.parser.endIndex),Xe.children.push(Ye),Qe&&(Ye.prev=Qe,Qe.next=Ye),Ye.parent=Xe,this.lastNode=null},Ke}();ie.DomHandler=be,ie.default=be})(lib$4);var lib$2={},stringify$5={},lib$1={},lib={},encode={},encodeHtml={};Object.defineProperty(encodeHtml,"__esModule",{value:!0});function restoreDiff(ie){for(var Z=1;Z<ie.length;Z++)ie[Z][0]+=ie[Z-1][0]+1;return ie}encodeHtml.default=new Map(restoreDiff([[9,"&Tab;"],[0,"&NewLine;"],[22,"&excl;"],[0,"&quot;"],[0,"&num;"],[0,"&dollar;"],[0,"&percnt;"],[0,"&amp;"],[0,"&apos;"],[0,"&lpar;"],[0,"&rpar;"],[0,"&ast;"],[0,"&plus;"],[0,"&comma;"],[1,"&period;"],[0,"&sol;"],[10,"&colon;"],[0,"&semi;"],[0,{v:"&lt;",n:8402,o:"&nvlt;"}],[0,{v:"&equals;",n:8421,o:"&bne;"}],[0,{v:"&gt;",n:8402,o:"&nvgt;"}],[0,"&quest;"],[0,"&commat;"],[26,"&lbrack;"],[0,"&bsol;"],[0,"&rbrack;"],[0,"&Hat;"],[0,"&lowbar;"],[0,"&DiacriticalGrave;"],[5,{n:106,o:"&fjlig;"}],[20,"&lbrace;"],[0,"&verbar;"],[0,"&rbrace;"],[34,"&nbsp;"],[0,"&iexcl;"],[0,"&cent;"],[0,"&pound;"],[0,"&curren;"],[0,"&yen;"],[0,"&brvbar;"],[0,"&sect;"],[0,"&die;"],[0,"&copy;"],[0,"&ordf;"],[0,"&laquo;"],[0,"&not;"],[0,"&shy;"],[0,"&circledR;"],[0,"&macr;"],[0,"&deg;"],[0,"&PlusMinus;"],[0,"&sup2;"],[0,"&sup3;"],[0,"&acute;"],[0,"&micro;"],[0,"&para;"],[0,"&centerdot;"],[0,"&cedil;"],[0,"&sup1;"],[0,"&ordm;"],[0,"&raquo;"],[0,"&frac14;"],[0,"&frac12;"],[0,"&frac34;"],[0,"&iquest;"],[0,"&Agrave;"],[0,"&Aacute;"],[0,"&Acirc;"],[0,"&Atilde;"],[0,"&Auml;"],[0,"&angst;"],[0,"&AElig;"],[0,"&Ccedil;"],[0,"&Egrave;"],[0,"&Eacute;"],[0,"&Ecirc;"],[0,"&Euml;"],[0,"&Igrave;"],[0,"&Iacute;"],[0,"&Icirc;"],[0,"&Iuml;"],[0,"&ETH;"],[0,"&Ntilde;"],[0,"&Ograve;"],[0,"&Oacute;"],[0,"&Ocirc;"],[0,"&Otilde;"],[0,"&Ouml;"],[0,"&times;"],[0,"&Oslash;"],[0,"&Ugrave;"],[0,"&Uacute;"],[0,"&Ucirc;"],[0,"&Uuml;"],[0,"&Yacute;"],[0,"&THORN;"],[0,"&szlig;"],[0,"&agrave;"],[0,"&aacute;"],[0,"&acirc;"],[0,"&atilde;"],[0,"&auml;"],[0,"&aring;"],[0,"&aelig;"],[0,"&ccedil;"],[0,"&egrave;"],[0,"&eacute;"],[0,"&ecirc;"],[0,"&euml;"],[0,"&igrave;"],[0,"&iacute;"],[0,"&icirc;"],[0,"&iuml;"],[0,"&eth;"],[0,"&ntilde;"],[0,"&ograve;"],[0,"&oacute;"],[0,"&ocirc;"],[0,"&otilde;"],[0,"&ouml;"],[0,"&div;"],[0,"&oslash;"],[0,"&ugrave;"],[0,"&uacute;"],[0,"&ucirc;"],[0,"&uuml;"],[0,"&yacute;"],[0,"&thorn;"],[0,"&yuml;"],[0,"&Amacr;"],[0,"&amacr;"],[0,"&Abreve;"],[0,"&abreve;"],[0,"&Aogon;"],[0,"&aogon;"],[0,"&Cacute;"],[0,"&cacute;"],[0,"&Ccirc;"],[0,"&ccirc;"],[0,"&Cdot;"],[0,"&cdot;"],[0,"&Ccaron;"],[0,"&ccaron;"],[0,"&Dcaron;"],[0,"&dcaron;"],[0,"&Dstrok;"],[0,"&dstrok;"],[0,"&Emacr;"],[0,"&emacr;"],[2,"&Edot;"],[0,"&edot;"],[0,"&Eogon;"],[0,"&eogon;"],[0,"&Ecaron;"],[0,"&ecaron;"],[0,"&Gcirc;"],[0,"&gcirc;"],[0,"&Gbreve;"],[0,"&gbreve;"],[0,"&Gdot;"],[0,"&gdot;"],[0,"&Gcedil;"],[1,"&Hcirc;"],[0,"&hcirc;"],[0,"&Hstrok;"],[0,"&hstrok;"],[0,"&Itilde;"],[0,"&itilde;"],[0,"&Imacr;"],[0,"&imacr;"],[2,"&Iogon;"],[0,"&iogon;"],[0,"&Idot;"],[0,"&imath;"],[0,"&IJlig;"],[0,"&ijlig;"],[0,"&Jcirc;"],[0,"&jcirc;"],[0,"&Kcedil;"],[0,"&kcedil;"],[0,"&kgreen;"],[0,"&Lacute;"],[0,"&lacute;"],[0,"&Lcedil;"],[0,"&lcedil;"],[0,"&Lcaron;"],[0,"&lcaron;"],[0,"&Lmidot;"],[0,"&lmidot;"],[0,"&Lstrok;"],[0,"&lstrok;"],[0,"&Nacute;"],[0,"&nacute;"],[0,"&Ncedil;"],[0,"&ncedil;"],[0,"&Ncaron;"],[0,"&ncaron;"],[0,"&napos;"],[0,"&ENG;"],[0,"&eng;"],[0,"&Omacr;"],[0,"&omacr;"],[2,"&Odblac;"],[0,"&odblac;"],[0,"&OElig;"],[0,"&oelig;"],[0,"&Racute;"],[0,"&racute;"],[0,"&Rcedil;"],[0,"&rcedil;"],[0,"&Rcaron;"],[0,"&rcaron;"],[0,"&Sacute;"],[0,"&sacute;"],[0,"&Scirc;"],[0,"&scirc;"],[0,"&Scedil;"],[0,"&scedil;"],[0,"&Scaron;"],[0,"&scaron;"],[0,"&Tcedil;"],[0,"&tcedil;"],[0,"&Tcaron;"],[0,"&tcaron;"],[0,"&Tstrok;"],[0,"&tstrok;"],[0,"&Utilde;"],[0,"&utilde;"],[0,"&Umacr;"],[0,"&umacr;"],[0,"&Ubreve;"],[0,"&ubreve;"],[0,"&Uring;"],[0,"&uring;"],[0,"&Udblac;"],[0,"&udblac;"],[0,"&Uogon;"],[0,"&uogon;"],[0,"&Wcirc;"],[0,"&wcirc;"],[0,"&Ycirc;"],[0,"&ycirc;"],[0,"&Yuml;"],[0,"&Zacute;"],[0,"&zacute;"],[0,"&Zdot;"],[0,"&zdot;"],[0,"&Zcaron;"],[0,"&zcaron;"],[19,"&fnof;"],[34,"&imped;"],[63,"&gacute;"],[65,"&jmath;"],[142,"&circ;"],[0,"&caron;"],[16,"&breve;"],[0,"&DiacriticalDot;"],[0,"&ring;"],[0,"&ogon;"],[0,"&DiacriticalTilde;"],[0,"&dblac;"],[51,"&DownBreve;"],[127,"&Alpha;"],[0,"&Beta;"],[0,"&Gamma;"],[0,"&Delta;"],[0,"&Epsilon;"],[0,"&Zeta;"],[0,"&Eta;"],[0,"&Theta;"],[0,"&Iota;"],[0,"&Kappa;"],[0,"&Lambda;"],[0,"&Mu;"],[0,"&Nu;"],[0,"&Xi;"],[0,"&Omicron;"],[0,"&Pi;"],[0,"&Rho;"],[1,"&Sigma;"],[0,"&Tau;"],[0,"&Upsilon;"],[0,"&Phi;"],[0,"&Chi;"],[0,"&Psi;"],[0,"&ohm;"],[7,"&alpha;"],[0,"&beta;"],[0,"&gamma;"],[0,"&delta;"],[0,"&epsi;"],[0,"&zeta;"],[0,"&eta;"],[0,"&theta;"],[0,"&iota;"],[0,"&kappa;"],[0,"&lambda;"],[0,"&mu;"],[0,"&nu;"],[0,"&xi;"],[0,"&omicron;"],[0,"&pi;"],[0,"&rho;"],[0,"&sigmaf;"],[0,"&sigma;"],[0,"&tau;"],[0,"&upsi;"],[0,"&phi;"],[0,"&chi;"],[0,"&psi;"],[0,"&omega;"],[7,"&thetasym;"],[0,"&Upsi;"],[2,"&phiv;"],[0,"&piv;"],[5,"&Gammad;"],[0,"&digamma;"],[18,"&kappav;"],[0,"&rhov;"],[3,"&epsiv;"],[0,"&backepsilon;"],[10,"&IOcy;"],[0,"&DJcy;"],[0,"&GJcy;"],[0,"&Jukcy;"],[0,"&DScy;"],[0,"&Iukcy;"],[0,"&YIcy;"],[0,"&Jsercy;"],[0,"&LJcy;"],[0,"&NJcy;"],[0,"&TSHcy;"],[0,"&KJcy;"],[1,"&Ubrcy;"],[0,"&DZcy;"],[0,"&Acy;"],[0,"&Bcy;"],[0,"&Vcy;"],[0,"&Gcy;"],[0,"&Dcy;"],[0,"&IEcy;"],[0,"&ZHcy;"],[0,"&Zcy;"],[0,"&Icy;"],[0,"&Jcy;"],[0,"&Kcy;"],[0,"&Lcy;"],[0,"&Mcy;"],[0,"&Ncy;"],[0,"&Ocy;"],[0,"&Pcy;"],[0,"&Rcy;"],[0,"&Scy;"],[0,"&Tcy;"],[0,"&Ucy;"],[0,"&Fcy;"],[0,"&KHcy;"],[0,"&TScy;"],[0,"&CHcy;"],[0,"&SHcy;"],[0,"&SHCHcy;"],[0,"&HARDcy;"],[0,"&Ycy;"],[0,"&SOFTcy;"],[0,"&Ecy;"],[0,"&YUcy;"],[0,"&YAcy;"],[0,"&acy;"],[0,"&bcy;"],[0,"&vcy;"],[0,"&gcy;"],[0,"&dcy;"],[0,"&iecy;"],[0,"&zhcy;"],[0,"&zcy;"],[0,"&icy;"],[0,"&jcy;"],[0,"&kcy;"],[0,"&lcy;"],[0,"&mcy;"],[0,"&ncy;"],[0,"&ocy;"],[0,"&pcy;"],[0,"&rcy;"],[0,"&scy;"],[0,"&tcy;"],[0,"&ucy;"],[0,"&fcy;"],[0,"&khcy;"],[0,"&tscy;"],[0,"&chcy;"],[0,"&shcy;"],[0,"&shchcy;"],[0,"&hardcy;"],[0,"&ycy;"],[0,"&softcy;"],[0,"&ecy;"],[0,"&yucy;"],[0,"&yacy;"],[1,"&iocy;"],[0,"&djcy;"],[0,"&gjcy;"],[0,"&jukcy;"],[0,"&dscy;"],[0,"&iukcy;"],[0,"&yicy;"],[0,"&jsercy;"],[0,"&ljcy;"],[0,"&njcy;"],[0,"&tshcy;"],[0,"&kjcy;"],[1,"&ubrcy;"],[0,"&dzcy;"],[7074,"&ensp;"],[0,"&emsp;"],[0,"&emsp13;"],[0,"&emsp14;"],[1,"&numsp;"],[0,"&puncsp;"],[0,"&ThinSpace;"],[0,"&hairsp;"],[0,"&NegativeMediumSpace;"],[0,"&zwnj;"],[0,"&zwj;"],[0,"&lrm;"],[0,"&rlm;"],[0,"&dash;"],[2,"&ndash;"],[0,"&mdash;"],[0,"&horbar;"],[0,"&Verbar;"],[1,"&lsquo;"],[0,"&CloseCurlyQuote;"],[0,"&lsquor;"],[1,"&ldquo;"],[0,"&CloseCurlyDoubleQuote;"],[0,"&bdquo;"],[1,"&dagger;"],[0,"&Dagger;"],[0,"&bull;"],[2,"&nldr;"],[0,"&hellip;"],[9,"&permil;"],[0,"&pertenk;"],[0,"&prime;"],[0,"&Prime;"],[0,"&tprime;"],[0,"&backprime;"],[3,"&lsaquo;"],[0,"&rsaquo;"],[3,"&oline;"],[2,"&caret;"],[1,"&hybull;"],[0,"&frasl;"],[10,"&bsemi;"],[7,"&qprime;"],[7,{v:"&MediumSpace;",n:8202,o:"&ThickSpace;"}],[0,"&NoBreak;"],[0,"&af;"],[0,"&InvisibleTimes;"],[0,"&ic;"],[72,"&euro;"],[46,"&tdot;"],[0,"&DotDot;"],[37,"&complexes;"],[2,"&incare;"],[4,"&gscr;"],[0,"&hamilt;"],[0,"&Hfr;"],[0,"&Hopf;"],[0,"&planckh;"],[0,"&hbar;"],[0,"&imagline;"],[0,"&Ifr;"],[0,"&lagran;"],[0,"&ell;"],[1,"&naturals;"],[0,"&numero;"],[0,"&copysr;"],[0,"&weierp;"],[0,"&Popf;"],[0,"&Qopf;"],[0,"&realine;"],[0,"&real;"],[0,"&reals;"],[0,"&rx;"],[3,"&trade;"],[1,"&integers;"],[2,"&mho;"],[0,"&zeetrf;"],[0,"&iiota;"],[2,"&bernou;"],[0,"&Cayleys;"],[1,"&escr;"],[0,"&Escr;"],[0,"&Fouriertrf;"],[1,"&Mellintrf;"],[0,"&order;"],[0,"&alefsym;"],[0,"&beth;"],[0,"&gimel;"],[0,"&daleth;"],[12,"&CapitalDifferentialD;"],[0,"&dd;"],[0,"&ee;"],[0,"&ii;"],[10,"&frac13;"],[0,"&frac23;"],[0,"&frac15;"],[0,"&frac25;"],[0,"&frac35;"],[0,"&frac45;"],[0,"&frac16;"],[0,"&frac56;"],[0,"&frac18;"],[0,"&frac38;"],[0,"&frac58;"],[0,"&frac78;"],[49,"&larr;"],[0,"&ShortUpArrow;"],[0,"&rarr;"],[0,"&darr;"],[0,"&harr;"],[0,"&updownarrow;"],[0,"&nwarr;"],[0,"&nearr;"],[0,"&LowerRightArrow;"],[0,"&LowerLeftArrow;"],[0,"&nlarr;"],[0,"&nrarr;"],[1,{v:"&rarrw;",n:824,o:"&nrarrw;"}],[0,"&Larr;"],[0,"&Uarr;"],[0,"&Rarr;"],[0,"&Darr;"],[0,"&larrtl;"],[0,"&rarrtl;"],[0,"&LeftTeeArrow;"],[0,"&mapstoup;"],[0,"&map;"],[0,"&DownTeeArrow;"],[1,"&hookleftarrow;"],[0,"&hookrightarrow;"],[0,"&larrlp;"],[0,"&looparrowright;"],[0,"&harrw;"],[0,"&nharr;"],[1,"&lsh;"],[0,"&rsh;"],[0,"&ldsh;"],[0,"&rdsh;"],[1,"&crarr;"],[0,"&cularr;"],[0,"&curarr;"],[2,"&circlearrowleft;"],[0,"&circlearrowright;"],[0,"&leftharpoonup;"],[0,"&DownLeftVector;"],[0,"&RightUpVector;"],[0,"&LeftUpVector;"],[0,"&rharu;"],[0,"&DownRightVector;"],[0,"&dharr;"],[0,"&dharl;"],[0,"&RightArrowLeftArrow;"],[0,"&udarr;"],[0,"&LeftArrowRightArrow;"],[0,"&leftleftarrows;"],[0,"&upuparrows;"],[0,"&rightrightarrows;"],[0,"&ddarr;"],[0,"&leftrightharpoons;"],[0,"&Equilibrium;"],[0,"&nlArr;"],[0,"&nhArr;"],[0,"&nrArr;"],[0,"&DoubleLeftArrow;"],[0,"&DoubleUpArrow;"],[0,"&DoubleRightArrow;"],[0,"&dArr;"],[0,"&DoubleLeftRightArrow;"],[0,"&DoubleUpDownArrow;"],[0,"&nwArr;"],[0,"&neArr;"],[0,"&seArr;"],[0,"&swArr;"],[0,"&lAarr;"],[0,"&rAarr;"],[1,"&zigrarr;"],[6,"&larrb;"],[0,"&rarrb;"],[15,"&DownArrowUpArrow;"],[7,"&loarr;"],[0,"&roarr;"],[0,"&hoarr;"],[0,"&forall;"],[0,"&comp;"],[0,{v:"&part;",n:824,o:"&npart;"}],[0,"&exist;"],[0,"&nexist;"],[0,"&empty;"],[1,"&Del;"],[0,"&Element;"],[0,"&NotElement;"],[1,"&ni;"],[0,"&notni;"],[2,"&prod;"],[0,"&coprod;"],[0,"&sum;"],[0,"&minus;"],[0,"&MinusPlus;"],[0,"&dotplus;"],[1,"&Backslash;"],[0,"&lowast;"],[0,"&compfn;"],[1,"&radic;"],[2,"&prop;"],[0,"&infin;"],[0,"&angrt;"],[0,{v:"&ang;",n:8402,o:"&nang;"}],[0,"&angmsd;"],[0,"&angsph;"],[0,"&mid;"],[0,"&nmid;"],[0,"&DoubleVerticalBar;"],[0,"&NotDoubleVerticalBar;"],[0,"&and;"],[0,"&or;"],[0,{v:"&cap;",n:65024,o:"&caps;"}],[0,{v:"&cup;",n:65024,o:"&cups;"}],[0,"&int;"],[0,"&Int;"],[0,"&iiint;"],[0,"&conint;"],[0,"&Conint;"],[0,"&Cconint;"],[0,"&cwint;"],[0,"&ClockwiseContourIntegral;"],[0,"&awconint;"],[0,"&there4;"],[0,"&becaus;"],[0,"&ratio;"],[0,"&Colon;"],[0,"&dotminus;"],[1,"&mDDot;"],[0,"&homtht;"],[0,{v:"&sim;",n:8402,o:"&nvsim;"}],[0,{v:"&backsim;",n:817,o:"&race;"}],[0,{v:"&ac;",n:819,o:"&acE;"}],[0,"&acd;"],[0,"&VerticalTilde;"],[0,"&NotTilde;"],[0,{v:"&eqsim;",n:824,o:"&nesim;"}],[0,"&sime;"],[0,"&NotTildeEqual;"],[0,"&cong;"],[0,"&simne;"],[0,"&ncong;"],[0,"&ap;"],[0,"&nap;"],[0,"&ape;"],[0,{v:"&apid;",n:824,o:"&napid;"}],[0,"&backcong;"],[0,{v:"&asympeq;",n:8402,o:"&nvap;"}],[0,{v:"&bump;",n:824,o:"&nbump;"}],[0,{v:"&bumpe;",n:824,o:"&nbumpe;"}],[0,{v:"&doteq;",n:824,o:"&nedot;"}],[0,"&doteqdot;"],[0,"&efDot;"],[0,"&erDot;"],[0,"&Assign;"],[0,"&ecolon;"],[0,"&ecir;"],[0,"&circeq;"],[1,"&wedgeq;"],[0,"&veeeq;"],[1,"&triangleq;"],[2,"&equest;"],[0,"&ne;"],[0,{v:"&Congruent;",n:8421,o:"&bnequiv;"}],[0,"&nequiv;"],[1,{v:"&le;",n:8402,o:"&nvle;"}],[0,{v:"&ge;",n:8402,o:"&nvge;"}],[0,{v:"&lE;",n:824,o:"&nlE;"}],[0,{v:"&gE;",n:824,o:"&ngE;"}],[0,{v:"&lnE;",n:65024,o:"&lvertneqq;"}],[0,{v:"&gnE;",n:65024,o:"&gvertneqq;"}],[0,{v:"&ll;",n:new Map(restoreDiff([[824,"&nLtv;"],[7577,"&nLt;"]]))}],[0,{v:"&gg;",n:new Map(restoreDiff([[824,"&nGtv;"],[7577,"&nGt;"]]))}],[0,"&between;"],[0,"&NotCupCap;"],[0,"&nless;"],[0,"&ngt;"],[0,"&nle;"],[0,"&nge;"],[0,"&lesssim;"],[0,"&GreaterTilde;"],[0,"&nlsim;"],[0,"&ngsim;"],[0,"&LessGreater;"],[0,"&gl;"],[0,"&NotLessGreater;"],[0,"&NotGreaterLess;"],[0,"&pr;"],[0,"&sc;"],[0,"&prcue;"],[0,"&sccue;"],[0,"&PrecedesTilde;"],[0,{v:"&scsim;",n:824,o:"&NotSucceedsTilde;"}],[0,"&NotPrecedes;"],[0,"&NotSucceeds;"],[0,{v:"&sub;",n:8402,o:"&NotSubset;"}],[0,{v:"&sup;",n:8402,o:"&NotSuperset;"}],[0,"&nsub;"],[0,"&nsup;"],[0,"&sube;"],[0,"&supe;"],[0,"&NotSubsetEqual;"],[0,"&NotSupersetEqual;"],[0,{v:"&subne;",n:65024,o:"&varsubsetneq;"}],[0,{v:"&supne;",n:65024,o:"&varsupsetneq;"}],[1,"&cupdot;"],[0,"&UnionPlus;"],[0,{v:"&sqsub;",n:824,o:"&NotSquareSubset;"}],[0,{v:"&sqsup;",n:824,o:"&NotSquareSuperset;"}],[0,"&sqsube;"],[0,"&sqsupe;"],[0,{v:"&sqcap;",n:65024,o:"&sqcaps;"}],[0,{v:"&sqcup;",n:65024,o:"&sqcups;"}],[0,"&CirclePlus;"],[0,"&CircleMinus;"],[0,"&CircleTimes;"],[0,"&osol;"],[0,"&CircleDot;"],[0,"&circledcirc;"],[0,"&circledast;"],[1,"&circleddash;"],[0,"&boxplus;"],[0,"&boxminus;"],[0,"&boxtimes;"],[0,"&dotsquare;"],[0,"&RightTee;"],[0,"&dashv;"],[0,"&DownTee;"],[0,"&bot;"],[1,"&models;"],[0,"&DoubleRightTee;"],[0,"&Vdash;"],[0,"&Vvdash;"],[0,"&VDash;"],[0,"&nvdash;"],[0,"&nvDash;"],[0,"&nVdash;"],[0,"&nVDash;"],[0,"&prurel;"],[1,"&LeftTriangle;"],[0,"&RightTriangle;"],[0,{v:"&LeftTriangleEqual;",n:8402,o:"&nvltrie;"}],[0,{v:"&RightTriangleEqual;",n:8402,o:"&nvrtrie;"}],[0,"&origof;"],[0,"&imof;"],[0,"&multimap;"],[0,"&hercon;"],[0,"&intcal;"],[0,"&veebar;"],[1,"&barvee;"],[0,"&angrtvb;"],[0,"&lrtri;"],[0,"&bigwedge;"],[0,"&bigvee;"],[0,"&bigcap;"],[0,"&bigcup;"],[0,"&diam;"],[0,"&sdot;"],[0,"&sstarf;"],[0,"&divideontimes;"],[0,"&bowtie;"],[0,"&ltimes;"],[0,"&rtimes;"],[0,"&leftthreetimes;"],[0,"&rightthreetimes;"],[0,"&backsimeq;"],[0,"&curlyvee;"],[0,"&curlywedge;"],[0,"&Sub;"],[0,"&Sup;"],[0,"&Cap;"],[0,"&Cup;"],[0,"&fork;"],[0,"&epar;"],[0,"&lessdot;"],[0,"&gtdot;"],[0,{v:"&Ll;",n:824,o:"&nLl;"}],[0,{v:"&Gg;",n:824,o:"&nGg;"}],[0,{v:"&leg;",n:65024,o:"&lesg;"}],[0,{v:"&gel;",n:65024,o:"&gesl;"}],[2,"&cuepr;"],[0,"&cuesc;"],[0,"&NotPrecedesSlantEqual;"],[0,"&NotSucceedsSlantEqual;"],[0,"&NotSquareSubsetEqual;"],[0,"&NotSquareSupersetEqual;"],[2,"&lnsim;"],[0,"&gnsim;"],[0,"&precnsim;"],[0,"&scnsim;"],[0,"&nltri;"],[0,"&NotRightTriangle;"],[0,"&nltrie;"],[0,"&NotRightTriangleEqual;"],[0,"&vellip;"],[0,"&ctdot;"],[0,"&utdot;"],[0,"&dtdot;"],[0,"&disin;"],[0,"&isinsv;"],[0,"&isins;"],[0,{v:"&isindot;",n:824,o:"&notindot;"}],[0,"&notinvc;"],[0,"&notinvb;"],[1,{v:"&isinE;",n:824,o:"&notinE;"}],[0,"&nisd;"],[0,"&xnis;"],[0,"&nis;"],[0,"&notnivc;"],[0,"&notnivb;"],[6,"&barwed;"],[0,"&Barwed;"],[1,"&lceil;"],[0,"&rceil;"],[0,"&LeftFloor;"],[0,"&rfloor;"],[0,"&drcrop;"],[0,"&dlcrop;"],[0,"&urcrop;"],[0,"&ulcrop;"],[0,"&bnot;"],[1,"&profline;"],[0,"&profsurf;"],[1,"&telrec;"],[0,"&target;"],[5,"&ulcorn;"],[0,"&urcorn;"],[0,"&dlcorn;"],[0,"&drcorn;"],[2,"&frown;"],[0,"&smile;"],[9,"&cylcty;"],[0,"&profalar;"],[7,"&topbot;"],[6,"&ovbar;"],[1,"&solbar;"],[60,"&angzarr;"],[51,"&lmoustache;"],[0,"&rmoustache;"],[2,"&OverBracket;"],[0,"&bbrk;"],[0,"&bbrktbrk;"],[37,"&OverParenthesis;"],[0,"&UnderParenthesis;"],[0,"&OverBrace;"],[0,"&UnderBrace;"],[2,"&trpezium;"],[4,"&elinters;"],[59,"&blank;"],[164,"&circledS;"],[55,"&boxh;"],[1,"&boxv;"],[9,"&boxdr;"],[3,"&boxdl;"],[3,"&boxur;"],[3,"&boxul;"],[3,"&boxvr;"],[7,"&boxvl;"],[7,"&boxhd;"],[7,"&boxhu;"],[7,"&boxvh;"],[19,"&boxH;"],[0,"&boxV;"],[0,"&boxdR;"],[0,"&boxDr;"],[0,"&boxDR;"],[0,"&boxdL;"],[0,"&boxDl;"],[0,"&boxDL;"],[0,"&boxuR;"],[0,"&boxUr;"],[0,"&boxUR;"],[0,"&boxuL;"],[0,"&boxUl;"],[0,"&boxUL;"],[0,"&boxvR;"],[0,"&boxVr;"],[0,"&boxVR;"],[0,"&boxvL;"],[0,"&boxVl;"],[0,"&boxVL;"],[0,"&boxHd;"],[0,"&boxhD;"],[0,"&boxHD;"],[0,"&boxHu;"],[0,"&boxhU;"],[0,"&boxHU;"],[0,"&boxvH;"],[0,"&boxVh;"],[0,"&boxVH;"],[19,"&uhblk;"],[3,"&lhblk;"],[3,"&block;"],[8,"&blk14;"],[0,"&blk12;"],[0,"&blk34;"],[13,"&square;"],[8,"&blacksquare;"],[0,"&EmptyVerySmallSquare;"],[1,"&rect;"],[0,"&marker;"],[2,"&fltns;"],[1,"&bigtriangleup;"],[0,"&blacktriangle;"],[0,"&triangle;"],[2,"&blacktriangleright;"],[0,"&rtri;"],[3,"&bigtriangledown;"],[0,"&blacktriangledown;"],[0,"&dtri;"],[2,"&blacktriangleleft;"],[0,"&ltri;"],[6,"&loz;"],[0,"&cir;"],[32,"&tridot;"],[2,"&bigcirc;"],[8,"&ultri;"],[0,"&urtri;"],[0,"&lltri;"],[0,"&EmptySmallSquare;"],[0,"&FilledSmallSquare;"],[8,"&bigstar;"],[0,"&star;"],[7,"&phone;"],[49,"&female;"],[1,"&male;"],[29,"&spades;"],[2,"&clubs;"],[1,"&hearts;"],[0,"&diamondsuit;"],[3,"&sung;"],[2,"&flat;"],[0,"&natural;"],[0,"&sharp;"],[163,"&check;"],[3,"&cross;"],[8,"&malt;"],[21,"&sext;"],[33,"&VerticalSeparator;"],[25,"&lbbrk;"],[0,"&rbbrk;"],[84,"&bsolhsub;"],[0,"&suphsol;"],[28,"&LeftDoubleBracket;"],[0,"&RightDoubleBracket;"],[0,"&lang;"],[0,"&rang;"],[0,"&Lang;"],[0,"&Rang;"],[0,"&loang;"],[0,"&roang;"],[7,"&longleftarrow;"],[0,"&longrightarrow;"],[0,"&longleftrightarrow;"],[0,"&DoubleLongLeftArrow;"],[0,"&DoubleLongRightArrow;"],[0,"&DoubleLongLeftRightArrow;"],[1,"&longmapsto;"],[2,"&dzigrarr;"],[258,"&nvlArr;"],[0,"&nvrArr;"],[0,"&nvHarr;"],[0,"&Map;"],[6,"&lbarr;"],[0,"&bkarow;"],[0,"&lBarr;"],[0,"&dbkarow;"],[0,"&drbkarow;"],[0,"&DDotrahd;"],[0,"&UpArrowBar;"],[0,"&DownArrowBar;"],[2,"&Rarrtl;"],[2,"&latail;"],[0,"&ratail;"],[0,"&lAtail;"],[0,"&rAtail;"],[0,"&larrfs;"],[0,"&rarrfs;"],[0,"&larrbfs;"],[0,"&rarrbfs;"],[2,"&nwarhk;"],[0,"&nearhk;"],[0,"&hksearow;"],[0,"&hkswarow;"],[0,"&nwnear;"],[0,"&nesear;"],[0,"&seswar;"],[0,"&swnwar;"],[8,{v:"&rarrc;",n:824,o:"&nrarrc;"}],[1,"&cudarrr;"],[0,"&ldca;"],[0,"&rdca;"],[0,"&cudarrl;"],[0,"&larrpl;"],[2,"&curarrm;"],[0,"&cularrp;"],[7,"&rarrpl;"],[2,"&harrcir;"],[0,"&Uarrocir;"],[0,"&lurdshar;"],[0,"&ldrushar;"],[2,"&LeftRightVector;"],[0,"&RightUpDownVector;"],[0,"&DownLeftRightVector;"],[0,"&LeftUpDownVector;"],[0,"&LeftVectorBar;"],[0,"&RightVectorBar;"],[0,"&RightUpVectorBar;"],[0,"&RightDownVectorBar;"],[0,"&DownLeftVectorBar;"],[0,"&DownRightVectorBar;"],[0,"&LeftUpVectorBar;"],[0,"&LeftDownVectorBar;"],[0,"&LeftTeeVector;"],[0,"&RightTeeVector;"],[0,"&RightUpTeeVector;"],[0,"&RightDownTeeVector;"],[0,"&DownLeftTeeVector;"],[0,"&DownRightTeeVector;"],[0,"&LeftUpTeeVector;"],[0,"&LeftDownTeeVector;"],[0,"&lHar;"],[0,"&uHar;"],[0,"&rHar;"],[0,"&dHar;"],[0,"&luruhar;"],[0,"&ldrdhar;"],[0,"&ruluhar;"],[0,"&rdldhar;"],[0,"&lharul;"],[0,"&llhard;"],[0,"&rharul;"],[0,"&lrhard;"],[0,"&udhar;"],[0,"&duhar;"],[0,"&RoundImplies;"],[0,"&erarr;"],[0,"&simrarr;"],[0,"&larrsim;"],[0,"&rarrsim;"],[0,"&rarrap;"],[0,"&ltlarr;"],[1,"&gtrarr;"],[0,"&subrarr;"],[1,"&suplarr;"],[0,"&lfisht;"],[0,"&rfisht;"],[0,"&ufisht;"],[0,"&dfisht;"],[5,"&lopar;"],[0,"&ropar;"],[4,"&lbrke;"],[0,"&rbrke;"],[0,"&lbrkslu;"],[0,"&rbrksld;"],[0,"&lbrksld;"],[0,"&rbrkslu;"],[0,"&langd;"],[0,"&rangd;"],[0,"&lparlt;"],[0,"&rpargt;"],[0,"&gtlPar;"],[0,"&ltrPar;"],[3,"&vzigzag;"],[1,"&vangrt;"],[0,"&angrtvbd;"],[6,"&ange;"],[0,"&range;"],[0,"&dwangle;"],[0,"&uwangle;"],[0,"&angmsdaa;"],[0,"&angmsdab;"],[0,"&angmsdac;"],[0,"&angmsdad;"],[0,"&angmsdae;"],[0,"&angmsdaf;"],[0,"&angmsdag;"],[0,"&angmsdah;"],[0,"&bemptyv;"],[0,"&demptyv;"],[0,"&cemptyv;"],[0,"&raemptyv;"],[0,"&laemptyv;"],[0,"&ohbar;"],[0,"&omid;"],[0,"&opar;"],[1,"&operp;"],[1,"&olcross;"],[0,"&odsold;"],[1,"&olcir;"],[0,"&ofcir;"],[0,"&olt;"],[0,"&ogt;"],[0,"&cirscir;"],[0,"&cirE;"],[0,"&solb;"],[0,"&bsolb;"],[3,"&boxbox;"],[3,"&trisb;"],[0,"&rtriltri;"],[0,{v:"&LeftTriangleBar;",n:824,o:"&NotLeftTriangleBar;"}],[0,{v:"&RightTriangleBar;",n:824,o:"&NotRightTriangleBar;"}],[11,"&iinfin;"],[0,"&infintie;"],[0,"&nvinfin;"],[4,"&eparsl;"],[0,"&smeparsl;"],[0,"&eqvparsl;"],[5,"&blacklozenge;"],[8,"&RuleDelayed;"],[1,"&dsol;"],[9,"&bigodot;"],[0,"&bigoplus;"],[0,"&bigotimes;"],[1,"&biguplus;"],[1,"&bigsqcup;"],[5,"&iiiint;"],[0,"&fpartint;"],[2,"&cirfnint;"],[0,"&awint;"],[0,"&rppolint;"],[0,"&scpolint;"],[0,"&npolint;"],[0,"&pointint;"],[0,"&quatint;"],[0,"&intlarhk;"],[10,"&pluscir;"],[0,"&plusacir;"],[0,"&simplus;"],[0,"&plusdu;"],[0,"&plussim;"],[0,"&plustwo;"],[1,"&mcomma;"],[0,"&minusdu;"],[2,"&loplus;"],[0,"&roplus;"],[0,"&Cross;"],[0,"&timesd;"],[0,"&timesbar;"],[1,"&smashp;"],[0,"&lotimes;"],[0,"&rotimes;"],[0,"&otimesas;"],[0,"&Otimes;"],[0,"&odiv;"],[0,"&triplus;"],[0,"&triminus;"],[0,"&tritime;"],[0,"&intprod;"],[2,"&amalg;"],[0,"&capdot;"],[1,"&ncup;"],[0,"&ncap;"],[0,"&capand;"],[0,"&cupor;"],[0,"&cupcap;"],[0,"&capcup;"],[0,"&cupbrcap;"],[0,"&capbrcup;"],[0,"&cupcup;"],[0,"&capcap;"],[0,"&ccups;"],[0,"&ccaps;"],[2,"&ccupssm;"],[2,"&And;"],[0,"&Or;"],[0,"&andand;"],[0,"&oror;"],[0,"&orslope;"],[0,"&andslope;"],[1,"&andv;"],[0,"&orv;"],[0,"&andd;"],[0,"&ord;"],[1,"&wedbar;"],[6,"&sdote;"],[3,"&simdot;"],[2,{v:"&congdot;",n:824,o:"&ncongdot;"}],[0,"&easter;"],[0,"&apacir;"],[0,{v:"&apE;",n:824,o:"&napE;"}],[0,"&eplus;"],[0,"&pluse;"],[0,"&Esim;"],[0,"&Colone;"],[0,"&Equal;"],[1,"&ddotseq;"],[0,"&equivDD;"],[0,"&ltcir;"],[0,"&gtcir;"],[0,"&ltquest;"],[0,"&gtquest;"],[0,{v:"&leqslant;",n:824,o:"&nleqslant;"}],[0,{v:"&geqslant;",n:824,o:"&ngeqslant;"}],[0,"&lesdot;"],[0,"&gesdot;"],[0,"&lesdoto;"],[0,"&gesdoto;"],[0,"&lesdotor;"],[0,"&gesdotol;"],[0,"&lap;"],[0,"&gap;"],[0,"&lne;"],[0,"&gne;"],[0,"&lnap;"],[0,"&gnap;"],[0,"&lEg;"],[0,"&gEl;"],[0,"&lsime;"],[0,"&gsime;"],[0,"&lsimg;"],[0,"&gsiml;"],[0,"&lgE;"],[0,"&glE;"],[0,"&lesges;"],[0,"&gesles;"],[0,"&els;"],[0,"&egs;"],[0,"&elsdot;"],[0,"&egsdot;"],[0,"&el;"],[0,"&eg;"],[2,"&siml;"],[0,"&simg;"],[0,"&simlE;"],[0,"&simgE;"],[0,{v:"&LessLess;",n:824,o:"&NotNestedLessLess;"}],[0,{v:"&GreaterGreater;",n:824,o:"&NotNestedGreaterGreater;"}],[1,"&glj;"],[0,"&gla;"],[0,"&ltcc;"],[0,"&gtcc;"],[0,"&lescc;"],[0,"&gescc;"],[0,"&smt;"],[0,"&lat;"],[0,{v:"&smte;",n:65024,o:"&smtes;"}],[0,{v:"&late;",n:65024,o:"&lates;"}],[0,"&bumpE;"],[0,{v:"&PrecedesEqual;",n:824,o:"&NotPrecedesEqual;"}],[0,{v:"&sce;",n:824,o:"&NotSucceedsEqual;"}],[2,"&prE;"],[0,"&scE;"],[0,"&precneqq;"],[0,"&scnE;"],[0,"&prap;"],[0,"&scap;"],[0,"&precnapprox;"],[0,"&scnap;"],[0,"&Pr;"],[0,"&Sc;"],[0,"&subdot;"],[0,"&supdot;"],[0,"&subplus;"],[0,"&supplus;"],[0,"&submult;"],[0,"&supmult;"],[0,"&subedot;"],[0,"&supedot;"],[0,{v:"&subE;",n:824,o:"&nsubE;"}],[0,{v:"&supE;",n:824,o:"&nsupE;"}],[0,"&subsim;"],[0,"&supsim;"],[2,{v:"&subnE;",n:65024,o:"&varsubsetneqq;"}],[0,{v:"&supnE;",n:65024,o:"&varsupsetneqq;"}],[2,"&csub;"],[0,"&csup;"],[0,"&csube;"],[0,"&csupe;"],[0,"&subsup;"],[0,"&supsub;"],[0,"&subsub;"],[0,"&supsup;"],[0,"&suphsub;"],[0,"&supdsub;"],[0,"&forkv;"],[0,"&topfork;"],[0,"&mlcp;"],[8,"&Dashv;"],[1,"&Vdashl;"],[0,"&Barv;"],[0,"&vBar;"],[0,"&vBarv;"],[1,"&Vbar;"],[0,"&Not;"],[0,"&bNot;"],[0,"&rnmid;"],[0,"&cirmid;"],[0,"&midcir;"],[0,"&topcir;"],[0,"&nhpar;"],[0,"&parsim;"],[9,{v:"&parsl;",n:8421,o:"&nparsl;"}],[44343,{n:new Map(restoreDiff([[56476,"&Ascr;"],[1,"&Cscr;"],[0,"&Dscr;"],[2,"&Gscr;"],[2,"&Jscr;"],[0,"&Kscr;"],[2,"&Nscr;"],[0,"&Oscr;"],[0,"&Pscr;"],[0,"&Qscr;"],[1,"&Sscr;"],[0,"&Tscr;"],[0,"&Uscr;"],[0,"&Vscr;"],[0,"&Wscr;"],[0,"&Xscr;"],[0,"&Yscr;"],[0,"&Zscr;"],[0,"&ascr;"],[0,"&bscr;"],[0,"&cscr;"],[0,"&dscr;"],[1,"&fscr;"],[1,"&hscr;"],[0,"&iscr;"],[0,"&jscr;"],[0,"&kscr;"],[0,"&lscr;"],[0,"&mscr;"],[0,"&nscr;"],[1,"&pscr;"],[0,"&qscr;"],[0,"&rscr;"],[0,"&sscr;"],[0,"&tscr;"],[0,"&uscr;"],[0,"&vscr;"],[0,"&wscr;"],[0,"&xscr;"],[0,"&yscr;"],[0,"&zscr;"],[52,"&Afr;"],[0,"&Bfr;"],[1,"&Dfr;"],[0,"&Efr;"],[0,"&Ffr;"],[0,"&Gfr;"],[2,"&Jfr;"],[0,"&Kfr;"],[0,"&Lfr;"],[0,"&Mfr;"],[0,"&Nfr;"],[0,"&Ofr;"],[0,"&Pfr;"],[0,"&Qfr;"],[1,"&Sfr;"],[0,"&Tfr;"],[0,"&Ufr;"],[0,"&Vfr;"],[0,"&Wfr;"],[0,"&Xfr;"],[0,"&Yfr;"],[1,"&afr;"],[0,"&bfr;"],[0,"&cfr;"],[0,"&dfr;"],[0,"&efr;"],[0,"&ffr;"],[0,"&gfr;"],[0,"&hfr;"],[0,"&ifr;"],[0,"&jfr;"],[0,"&kfr;"],[0,"&lfr;"],[0,"&mfr;"],[0,"&nfr;"],[0,"&ofr;"],[0,"&pfr;"],[0,"&qfr;"],[0,"&rfr;"],[0,"&sfr;"],[0,"&tfr;"],[0,"&ufr;"],[0,"&vfr;"],[0,"&wfr;"],[0,"&xfr;"],[0,"&yfr;"],[0,"&zfr;"],[0,"&Aopf;"],[0,"&Bopf;"],[1,"&Dopf;"],[0,"&Eopf;"],[0,"&Fopf;"],[0,"&Gopf;"],[1,"&Iopf;"],[0,"&Jopf;"],[0,"&Kopf;"],[0,"&Lopf;"],[0,"&Mopf;"],[1,"&Oopf;"],[3,"&Sopf;"],[0,"&Topf;"],[0,"&Uopf;"],[0,"&Vopf;"],[0,"&Wopf;"],[0,"&Xopf;"],[0,"&Yopf;"],[1,"&aopf;"],[0,"&bopf;"],[0,"&copf;"],[0,"&dopf;"],[0,"&eopf;"],[0,"&fopf;"],[0,"&gopf;"],[0,"&hopf;"],[0,"&iopf;"],[0,"&jopf;"],[0,"&kopf;"],[0,"&lopf;"],[0,"&mopf;"],[0,"&nopf;"],[0,"&oopf;"],[0,"&popf;"],[0,"&qopf;"],[0,"&ropf;"],[0,"&sopf;"],[0,"&topf;"],[0,"&uopf;"],[0,"&vopf;"],[0,"&wopf;"],[0,"&xopf;"],[0,"&yopf;"],[0,"&zopf;"]]))}],[8906,"&fflig;"],[0,"&filig;"],[0,"&fllig;"],[0,"&ffilig;"],[0,"&ffllig;"]]));var _escape={};(function(ie){Object.defineProperty(ie,"__esModule",{value:!0}),ie.escapeText=ie.escapeAttribute=ie.escapeUTF8=ie.escape=ie.encodeXML=ie.getCodePoint=ie.xmlReplacer=void 0,ie.xmlReplacer=/["&'<>$\x80-\uFFFF]/g;var Z=new Map([[34,"&quot;"],[38,"&amp;"],[39,"&apos;"],[60,"&lt;"],[62,"&gt;"]]);ie.getCodePoint=String.prototype.codePointAt!=null?function(ve,ye){return ve.codePointAt(ye)}:function(ve,ye){return(ve.charCodeAt(ye)&64512)===55296?(ve.charCodeAt(ye)-55296)*1024+ve.charCodeAt(ye+1)-56320+65536:ve.charCodeAt(ye)};function ee(ve){for(var ye="",be=0,Ke;(Ke=ie.xmlReplacer.exec(ve))!==null;){var Ye=Ke.index,Xe=ve.charCodeAt(Ye),Qe=Z.get(Xe);Qe!==void 0?(ye+=ve.substring(be,Ye)+Qe,be=Ye+1):(ye+="".concat(ve.substring(be,Ye),"&#x").concat((0,ie.getCodePoint)(ve,Ye).toString(16),";"),be=ie.xmlReplacer.lastIndex+=+((Xe&64512)===55296))}return ye+ve.substr(be)}ie.encodeXML=ee,ie.escape=ee;function ae(ve,ye){return function(Ke){for(var Ye,Xe=0,Qe="";Ye=ve.exec(Ke);)Xe!==Ye.index&&(Qe+=Ke.substring(Xe,Ye.index)),Qe+=ye.get(Ye[0].charCodeAt(0)),Xe=Ye.index+1;return Qe+Ke.substring(Xe)}}ie.escapeUTF8=ae(/[&<>'"]/g,Z),ie.escapeAttribute=ae(/["&\u00A0]/g,new Map([[34,"&quot;"],[38,"&amp;"],[160,"&nbsp;"]])),ie.escapeText=ae(/[&<>\u00A0]/g,new Map([[38,"&amp;"],[60,"&lt;"],[62,"&gt;"],[160,"&nbsp;"]]))})(_escape);var __importDefault$1=commonjsGlobal&&commonjsGlobal.__importDefault||function(ie){return ie&&ie.__esModule?ie:{default:ie}};Object.defineProperty(encode,"__esModule",{value:!0});encode.encodeNonAsciiHTML=encode.encodeHTML=void 0;var encode_html_js_1=__importDefault$1(encodeHtml),escape_js_1=_escape,htmlReplacer=/[\t\n!-,./:-@[-`\f{-}$\x80-\uFFFF]/g;function encodeHTML(ie){return encodeHTMLTrieRe(htmlReplacer,ie)}encode.encodeHTML=encodeHTML;function encodeNonAsciiHTML(ie){return encodeHTMLTrieRe(escape_js_1.xmlReplacer,ie)}encode.encodeNonAsciiHTML=encodeNonAsciiHTML;function encodeHTMLTrieRe(ie,Z){for(var ee="",ae=0,ve;(ve=ie.exec(Z))!==null;){var ye=ve.index;ee+=Z.substring(ae,ye);var be=Z.charCodeAt(ye),Ke=encode_html_js_1.default.get(be);if(typeof Ke=="object"){if(ye+1<Z.length){var Ye=Z.charCodeAt(ye+1),Xe=typeof Ke.n=="number"?Ke.n===Ye?Ke.o:void 0:Ke.n.get(Ye);if(Xe!==void 0){ee+=Xe,ae=ie.lastIndex+=1;continue}}Ke=Ke.v}if(Ke!==void 0)ee+=Ke,ae=ye+1;else{var Qe=(0,escape_js_1.getCodePoint)(Z,ye);ee+="&#x".concat(Qe.toString(16),";"),ae=ie.lastIndex+=+(Qe!==be)}}return ee+Z.substr(ae)}(function(ie){Object.defineProperty(ie,"__esModule",{value:!0}),ie.decodeXMLStrict=ie.decodeHTML5Strict=ie.decodeHTML4Strict=ie.decodeHTML5=ie.decodeHTML4=ie.decodeHTMLAttribute=ie.decodeHTMLStrict=ie.decodeHTML=ie.decodeXML=ie.DecodingMode=ie.EntityDecoder=ie.encodeHTML5=ie.encodeHTML4=ie.encodeNonAsciiHTML=ie.encodeHTML=ie.escapeText=ie.escapeAttribute=ie.escapeUTF8=ie.escape=ie.encodeXML=ie.encode=ie.decodeStrict=ie.decode=ie.EncodingMode=ie.EntityLevel=void 0;var Z=decode,ee=encode,ae=_escape,ve;(function(Je){Je[Je.XML=0]="XML",Je[Je.HTML=1]="HTML"})(ve=ie.EntityLevel||(ie.EntityLevel={}));var ye;(function(Je){Je[Je.UTF8=0]="UTF8",Je[Je.ASCII=1]="ASCII",Je[Je.Extensive=2]="Extensive",Je[Je.Attribute=3]="Attribute",Je[Je.Text=4]="Text"})(ye=ie.EncodingMode||(ie.EncodingMode={}));function be(Je,rt){rt===void 0&&(rt=ve.XML);var it=typeof rt=="number"?rt:rt.level;if(it===ve.HTML){var nt=typeof rt=="object"?rt.mode:void 0;return(0,Z.decodeHTML)(Je,nt)}return(0,Z.decodeXML)(Je)}ie.decode=be;function Ke(Je,rt){var it;rt===void 0&&(rt=ve.XML);var nt=typeof rt=="number"?{level:rt}:rt;return(it=nt.mode)!==null&&it!==void 0||(nt.mode=Z.DecodingMode.Strict),be(Je,nt)}ie.decodeStrict=Ke;function Ye(Je,rt){rt===void 0&&(rt=ve.XML);var it=typeof rt=="number"?{level:rt}:rt;return it.mode===ye.UTF8?(0,ae.escapeUTF8)(Je):it.mode===ye.Attribute?(0,ae.escapeAttribute)(Je):it.mode===ye.Text?(0,ae.escapeText)(Je):it.level===ve.HTML?it.mode===ye.ASCII?(0,ee.encodeNonAsciiHTML)(Je):(0,ee.encodeHTML)(Je):(0,ae.encodeXML)(Je)}ie.encode=Ye;var Xe=_escape;Object.defineProperty(ie,"encodeXML",{enumerable:!0,get:function(){return Xe.encodeXML}}),Object.defineProperty(ie,"escape",{enumerable:!0,get:function(){return Xe.escape}}),Object.defineProperty(ie,"escapeUTF8",{enumerable:!0,get:function(){return Xe.escapeUTF8}}),Object.defineProperty(ie,"escapeAttribute",{enumerable:!0,get:function(){return Xe.escapeAttribute}}),Object.defineProperty(ie,"escapeText",{enumerable:!0,get:function(){return Xe.escapeText}});var Qe=encode;Object.defineProperty(ie,"encodeHTML",{enumerable:!0,get:function(){return Qe.encodeHTML}}),Object.defineProperty(ie,"encodeNonAsciiHTML",{enumerable:!0,get:function(){return Qe.encodeNonAsciiHTML}}),Object.defineProperty(ie,"encodeHTML4",{enumerable:!0,get:function(){return Qe.encodeHTML}}),Object.defineProperty(ie,"encodeHTML5",{enumerable:!0,get:function(){return Qe.encodeHTML}});var et=decode;Object.defineProperty(ie,"EntityDecoder",{enumerable:!0,get:function(){return et.EntityDecoder}}),Object.defineProperty(ie,"DecodingMode",{enumerable:!0,get:function(){return et.DecodingMode}}),Object.defineProperty(ie,"decodeXML",{enumerable:!0,get:function(){return et.decodeXML}}),Object.defineProperty(ie,"decodeHTML",{enumerable:!0,get:function(){return et.decodeHTML}}),Object.defineProperty(ie,"decodeHTMLStrict",{enumerable:!0,get:function(){return et.decodeHTMLStrict}}),Object.defineProperty(ie,"decodeHTMLAttribute",{enumerable:!0,get:function(){return et.decodeHTMLAttribute}}),Object.defineProperty(ie,"decodeHTML4",{enumerable:!0,get:function(){return et.decodeHTML}}),Object.defineProperty(ie,"decodeHTML5",{enumerable:!0,get:function(){return et.decodeHTML}}),Object.defineProperty(ie,"decodeHTML4Strict",{enumerable:!0,get:function(){return et.decodeHTMLStrict}}),Object.defineProperty(ie,"decodeHTML5Strict",{enumerable:!0,get:function(){return et.decodeHTMLStrict}}),Object.defineProperty(ie,"decodeXMLStrict",{enumerable:!0,get:function(){return et.decodeXML}})})(lib);var foreignNames={};Object.defineProperty(foreignNames,"__esModule",{value:!0});foreignNames.attributeNames=foreignNames.elementNames=void 0;foreignNames.elementNames=new Map(["altGlyph","altGlyphDef","altGlyphItem","animateColor","animateMotion","animateTransform","clipPath","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","foreignObject","glyphRef","linearGradient","radialGradient","textPath"].map(function(ie){return[ie.toLowerCase(),ie]}));foreignNames.attributeNames=new Map(["definitionURL","attributeName","attributeType","baseFrequency","baseProfile","calcMode","clipPathUnits","diffuseConstant","edgeMode","filterUnits","glyphRef","gradientTransform","gradientUnits","kernelMatrix","kernelUnitLength","keyPoints","keySplines","keyTimes","lengthAdjust","limitingConeAngle","markerHeight","markerUnits","markerWidth","maskContentUnits","maskUnits","numOctaves","pathLength","patternContentUnits","patternTransform","patternUnits","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","refX","refY","repeatCount","repeatDur","requiredExtensions","requiredFeatures","specularConstant","specularExponent","spreadMethod","startOffset","stdDeviation","stitchTiles","surfaceScale","systemLanguage","tableValues","targetX","targetY","textLength","viewBox","viewTarget","xChannelSelector","yChannelSelector","zoomAndPan"].map(function(ie){return[ie.toLowerCase(),ie]}));var __assign$1=commonjsGlobal&&commonjsGlobal.__assign||function(){return __assign$1=Object.assign||function(ie){for(var Z,ee=1,ae=arguments.length;ee<ae;ee++){Z=arguments[ee];for(var ve in Z)Object.prototype.hasOwnProperty.call(Z,ve)&&(ie[ve]=Z[ve])}return ie},__assign$1.apply(this,arguments)},__createBinding=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(ie,Z,ee,ae){ae===void 0&&(ae=ee);var ve=Object.getOwnPropertyDescriptor(Z,ee);(!ve||("get"in ve?!Z.__esModule:ve.writable||ve.configurable))&&(ve={enumerable:!0,get:function(){return Z[ee]}}),Object.defineProperty(ie,ae,ve)}:function(ie,Z,ee,ae){ae===void 0&&(ae=ee),ie[ae]=Z[ee]}),__setModuleDefault=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(ie,Z){Object.defineProperty(ie,"default",{enumerable:!0,value:Z})}:function(ie,Z){ie.default=Z}),__importStar=commonjsGlobal&&commonjsGlobal.__importStar||function(ie){if(ie&&ie.__esModule)return ie;var Z={};if(ie!=null)for(var ee in ie)ee!=="default"&&Object.prototype.hasOwnProperty.call(ie,ee)&&__createBinding(Z,ie,ee);return __setModuleDefault(Z,ie),Z};Object.defineProperty(lib$1,"__esModule",{value:!0});lib$1.render=void 0;var ElementType=__importStar(lib$3),entities_1=lib,foreignNames_js_1=foreignNames,unencodedElements=new Set(["style","script","xmp","iframe","noembed","noframes","plaintext","noscript"]);function replaceQuotes(ie){return ie.replace(/"/g,"&quot;")}function formatAttributes(ie,Z){var ee;if(ie){var ae=((ee=Z.encodeEntities)!==null&&ee!==void 0?ee:Z.decodeEntities)===!1?replaceQuotes:Z.xmlMode||Z.encodeEntities!=="utf8"?entities_1.encodeXML:entities_1.escapeAttribute;return Object.keys(ie).map(function(ve){var ye,be,Ke=(ye=ie[ve])!==null&&ye!==void 0?ye:"";return Z.xmlMode==="foreign"&&(ve=(be=foreignNames_js_1.attributeNames.get(ve))!==null&&be!==void 0?be:ve),!Z.emptyAttrs&&!Z.xmlMode&&Ke===""?ve:"".concat(ve,'="').concat(ae(Ke),'"')}).join(" ")}}var singleTag=new Set(["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"]);function render(ie,Z){Z===void 0&&(Z={});for(var ee=("length"in ie)?ie:[ie],ae="",ve=0;ve<ee.length;ve++)ae+=renderNode(ee[ve],Z);return ae}lib$1.render=render;lib$1.default=render;function renderNode(ie,Z){switch(ie.type){case ElementType.Root:return render(ie.children,Z);case ElementType.Doctype:case ElementType.Directive:return renderDirective(ie);case ElementType.Comment:return renderComment(ie);case ElementType.CDATA:return renderCdata(ie);case ElementType.Script:case ElementType.Style:case ElementType.Tag:return renderTag(ie,Z);case ElementType.Text:return renderText(ie,Z)}}var foreignModeIntegrationPoints=new Set(["mi","mo","mn","ms","mtext","annotation-xml","foreignObject","desc","title"]),foreignElements=new Set(["svg","math"]);function renderTag(ie,Z){var ee;Z.xmlMode==="foreign"&&(ie.name=(ee=foreignNames_js_1.elementNames.get(ie.name))!==null&&ee!==void 0?ee:ie.name,ie.parent&&foreignModeIntegrationPoints.has(ie.parent.name)&&(Z=__assign$1(__assign$1({},Z),{xmlMode:!1}))),!Z.xmlMode&&foreignElements.has(ie.name)&&(Z=__assign$1(__assign$1({},Z),{xmlMode:"foreign"}));var ae="<".concat(ie.name),ve=formatAttributes(ie.attribs,Z);return ve&&(ae+=" ".concat(ve)),ie.children.length===0&&(Z.xmlMode?Z.selfClosingTags!==!1:Z.selfClosingTags&&singleTag.has(ie.name))?(Z.xmlMode||(ae+=" "),ae+="/>"):(ae+=">",ie.children.length>0&&(ae+=render(ie.children,Z)),(Z.xmlMode||!singleTag.has(ie.name))&&(ae+="</".concat(ie.name,">"))),ae}function renderDirective(ie){return"<".concat(ie.data,">")}function renderText(ie,Z){var ee,ae=ie.data||"";return((ee=Z.encodeEntities)!==null&&ee!==void 0?ee:Z.decodeEntities)!==!1&&!(!Z.xmlMode&&ie.parent&&unencodedElements.has(ie.parent.name))&&(ae=Z.xmlMode||Z.encodeEntities!=="utf8"?(0,entities_1.encodeXML)(ae):(0,entities_1.escapeText)(ae)),ae}function renderCdata(ie){return"<![CDATA[".concat(ie.children[0].data,"]]>")}function renderComment(ie){return"<!--".concat(ie.data,"-->")}var __importDefault=commonjsGlobal&&commonjsGlobal.__importDefault||function(ie){return ie&&ie.__esModule?ie:{default:ie}};Object.defineProperty(stringify$5,"__esModule",{value:!0});stringify$5.innerText=stringify$5.textContent=stringify$5.getText=stringify$5.getInnerHTML=stringify$5.getOuterHTML=void 0;var domhandler_1$3=lib$4,dom_serializer_1=__importDefault(lib$1),domelementtype_1=lib$3;function getOuterHTML(ie,Z){return(0,dom_serializer_1.default)(ie,Z)}stringify$5.getOuterHTML=getOuterHTML;function getInnerHTML(ie,Z){return(0,domhandler_1$3.hasChildren)(ie)?ie.children.map(function(ee){return getOuterHTML(ee,Z)}).join(""):""}stringify$5.getInnerHTML=getInnerHTML;function getText(ie){return Array.isArray(ie)?ie.map(getText).join(""):(0,domhandler_1$3.isTag)(ie)?ie.name==="br"?`
`:getText(ie.children):(0,domhandler_1$3.isCDATA)(ie)?getText(ie.children):(0,domhandler_1$3.isText)(ie)?ie.data:""}stringify$5.getText=getText;function textContent(ie){return Array.isArray(ie)?ie.map(textContent).join(""):(0,domhandler_1$3.hasChildren)(ie)&&!(0,domhandler_1$3.isComment)(ie)?textContent(ie.children):(0,domhandler_1$3.isText)(ie)?ie.data:""}stringify$5.textContent=textContent;function innerText(ie){return Array.isArray(ie)?ie.map(innerText).join(""):(0,domhandler_1$3.hasChildren)(ie)&&(ie.type===domelementtype_1.ElementType.Tag||(0,domhandler_1$3.isCDATA)(ie))?innerText(ie.children):(0,domhandler_1$3.isText)(ie)?ie.data:""}stringify$5.innerText=innerText;var traversal={};Object.defineProperty(traversal,"__esModule",{value:!0});traversal.prevElementSibling=traversal.nextElementSibling=traversal.getName=traversal.hasAttrib=traversal.getAttributeValue=traversal.getSiblings=traversal.getParent=traversal.getChildren=void 0;var domhandler_1$2=lib$4;function getChildren(ie){return(0,domhandler_1$2.hasChildren)(ie)?ie.children:[]}traversal.getChildren=getChildren;function getParent(ie){return ie.parent||null}traversal.getParent=getParent;function getSiblings(ie){var Z,ee,ae=getParent(ie);if(ae!=null)return getChildren(ae);for(var ve=[ie],ye=ie.prev,be=ie.next;ye!=null;)ve.unshift(ye),Z=ye,ye=Z.prev;for(;be!=null;)ve.push(be),ee=be,be=ee.next;return ve}traversal.getSiblings=getSiblings;function getAttributeValue(ie,Z){var ee;return(ee=ie.attribs)===null||ee===void 0?void 0:ee[Z]}traversal.getAttributeValue=getAttributeValue;function hasAttrib(ie,Z){return ie.attribs!=null&&Object.prototype.hasOwnProperty.call(ie.attribs,Z)&&ie.attribs[Z]!=null}traversal.hasAttrib=hasAttrib;function getName(ie){return ie.name}traversal.getName=getName;function nextElementSibling(ie){for(var Z,ee=ie.next;ee!==null&&!(0,domhandler_1$2.isTag)(ee);)Z=ee,ee=Z.next;return ee}traversal.nextElementSibling=nextElementSibling;function prevElementSibling(ie){for(var Z,ee=ie.prev;ee!==null&&!(0,domhandler_1$2.isTag)(ee);)Z=ee,ee=Z.prev;return ee}traversal.prevElementSibling=prevElementSibling;var manipulation={};Object.defineProperty(manipulation,"__esModule",{value:!0});manipulation.prepend=manipulation.prependChild=manipulation.append=manipulation.appendChild=manipulation.replaceElement=manipulation.removeElement=void 0;function removeElement(ie){if(ie.prev&&(ie.prev.next=ie.next),ie.next&&(ie.next.prev=ie.prev),ie.parent){var Z=ie.parent.children,ee=Z.lastIndexOf(ie);ee>=0&&Z.splice(ee,1)}ie.next=null,ie.prev=null,ie.parent=null}manipulation.removeElement=removeElement;function replaceElement(ie,Z){var ee=Z.prev=ie.prev;ee&&(ee.next=Z);var ae=Z.next=ie.next;ae&&(ae.prev=Z);var ve=Z.parent=ie.parent;if(ve){var ye=ve.children;ye[ye.lastIndexOf(ie)]=Z,ie.parent=null}}manipulation.replaceElement=replaceElement;function appendChild(ie,Z){if(removeElement(Z),Z.next=null,Z.parent=ie,ie.children.push(Z)>1){var ee=ie.children[ie.children.length-2];ee.next=Z,Z.prev=ee}else Z.prev=null}manipulation.appendChild=appendChild;function append(ie,Z){removeElement(Z);var ee=ie.parent,ae=ie.next;if(Z.next=ae,Z.prev=ie,ie.next=Z,Z.parent=ee,ae){if(ae.prev=Z,ee){var ve=ee.children;ve.splice(ve.lastIndexOf(ae),0,Z)}}else ee&&ee.children.push(Z)}manipulation.append=append;function prependChild(ie,Z){if(removeElement(Z),Z.parent=ie,Z.prev=null,ie.children.unshift(Z)!==1){var ee=ie.children[1];ee.prev=Z,Z.next=ee}else Z.next=null}manipulation.prependChild=prependChild;function prepend(ie,Z){removeElement(Z);var ee=ie.parent;if(ee){var ae=ee.children;ae.splice(ae.indexOf(ie),0,Z)}ie.prev&&(ie.prev.next=Z),Z.parent=ee,Z.prev=ie.prev,Z.next=ie,ie.prev=Z}manipulation.prepend=prepend;var querying={};Object.defineProperty(querying,"__esModule",{value:!0});querying.findAll=querying.existsOne=querying.findOne=querying.findOneChild=querying.find=querying.filter=void 0;var domhandler_1$1=lib$4;function filter$1(ie,Z,ee,ae){return ee===void 0&&(ee=!0),ae===void 0&&(ae=1/0),find(ie,Array.isArray(Z)?Z:[Z],ee,ae)}querying.filter=filter$1;function find(ie,Z,ee,ae){for(var ve=[],ye=[Z],be=[0];;){if(be[0]>=ye[0].length){if(be.length===1)return ve;ye.shift(),be.shift();continue}var Ke=ye[0][be[0]++];if(ie(Ke)&&(ve.push(Ke),--ae<=0))return ve;ee&&(0,domhandler_1$1.hasChildren)(Ke)&&Ke.children.length>0&&(be.unshift(0),ye.unshift(Ke.children))}}querying.find=find;function findOneChild(ie,Z){return Z.find(ie)}querying.findOneChild=findOneChild;function findOne(ie,Z,ee){ee===void 0&&(ee=!0);for(var ae=null,ve=0;ve<Z.length&&!ae;ve++){var ye=Z[ve];if((0,domhandler_1$1.isTag)(ye))ie(ye)?ae=ye:ee&&ye.children.length>0&&(ae=findOne(ie,ye.children,!0));else continue}return ae}querying.findOne=findOne;function existsOne(ie,Z){return Z.some(function(ee){return(0,domhandler_1$1.isTag)(ee)&&(ie(ee)||existsOne(ie,ee.children))})}querying.existsOne=existsOne;function findAll(ie,Z){for(var ee=[],ae=[Z],ve=[0];;){if(ve[0]>=ae[0].length){if(ae.length===1)return ee;ae.shift(),ve.shift();continue}var ye=ae[0][ve[0]++];(0,domhandler_1$1.isTag)(ye)&&(ie(ye)&&ee.push(ye),ye.children.length>0&&(ve.unshift(0),ae.unshift(ye.children)))}}querying.findAll=findAll;var legacy={};Object.defineProperty(legacy,"__esModule",{value:!0});legacy.getElementsByTagType=legacy.getElementsByTagName=legacy.getElementById=legacy.getElements=legacy.testElement=void 0;var domhandler_1=lib$4,querying_js_1=querying,Checks={tag_name:function(ie){return typeof ie=="function"?function(Z){return(0,domhandler_1.isTag)(Z)&&ie(Z.name)}:ie==="*"?domhandler_1.isTag:function(Z){return(0,domhandler_1.isTag)(Z)&&Z.name===ie}},tag_type:function(ie){return typeof ie=="function"?function(Z){return ie(Z.type)}:function(Z){return Z.type===ie}},tag_contains:function(ie){return typeof ie=="function"?function(Z){return(0,domhandler_1.isText)(Z)&&ie(Z.data)}:function(Z){return(0,domhandler_1.isText)(Z)&&Z.data===ie}}};function getAttribCheck(ie,Z){return typeof Z=="function"?function(ee){return(0,domhandler_1.isTag)(ee)&&Z(ee.attribs[ie])}:function(ee){return(0,domhandler_1.isTag)(ee)&&ee.attribs[ie]===Z}}function combineFuncs(ie,Z){return function(ee){return ie(ee)||Z(ee)}}function compileTest(ie){var Z=Object.keys(ie).map(function(ee){var ae=ie[ee];return Object.prototype.hasOwnProperty.call(Checks,ee)?Checks[ee](ae):getAttribCheck(ee,ae)});return Z.length===0?null:Z.reduce(combineFuncs)}function testElement(ie,Z){var ee=compileTest(ie);return ee?ee(Z):!0}legacy.testElement=testElement;function getElements(ie,Z,ee,ae){ae===void 0&&(ae=1/0);var ve=compileTest(ie);return ve?(0,querying_js_1.filter)(ve,Z,ee,ae):[]}legacy.getElements=getElements;function getElementById(ie,Z,ee){return ee===void 0&&(ee=!0),Array.isArray(Z)||(Z=[Z]),(0,querying_js_1.findOne)(getAttribCheck("id",ie),Z,ee)}legacy.getElementById=getElementById;function getElementsByTagName(ie,Z,ee,ae){return ee===void 0&&(ee=!0),ae===void 0&&(ae=1/0),(0,querying_js_1.filter)(Checks.tag_name(ie),Z,ee,ae)}legacy.getElementsByTagName=getElementsByTagName;function getElementsByTagType(ie,Z,ee,ae){return ee===void 0&&(ee=!0),ae===void 0&&(ae=1/0),(0,querying_js_1.filter)(Checks.tag_type(ie),Z,ee,ae)}legacy.getElementsByTagType=getElementsByTagType;var helpers={};(function(ie){Object.defineProperty(ie,"__esModule",{value:!0}),ie.uniqueSort=ie.compareDocumentPosition=ie.DocumentPosition=ie.removeSubsets=void 0;var Z=lib$4;function ee(be){for(var Ke=be.length;--Ke>=0;){var Ye=be[Ke];if(Ke>0&&be.lastIndexOf(Ye,Ke-1)>=0){be.splice(Ke,1);continue}for(var Xe=Ye.parent;Xe;Xe=Xe.parent)if(be.includes(Xe)){be.splice(Ke,1);break}}return be}ie.removeSubsets=ee;var ae;(function(be){be[be.DISCONNECTED=1]="DISCONNECTED",be[be.PRECEDING=2]="PRECEDING",be[be.FOLLOWING=4]="FOLLOWING",be[be.CONTAINS=8]="CONTAINS",be[be.CONTAINED_BY=16]="CONTAINED_BY"})(ae=ie.DocumentPosition||(ie.DocumentPosition={}));function ve(be,Ke){var Ye=[],Xe=[];if(be===Ke)return 0;for(var Qe=(0,Z.hasChildren)(be)?be:be.parent;Qe;)Ye.unshift(Qe),Qe=Qe.parent;for(Qe=(0,Z.hasChildren)(Ke)?Ke:Ke.parent;Qe;)Xe.unshift(Qe),Qe=Qe.parent;for(var et=Math.min(Ye.length,Xe.length),Je=0;Je<et&&Ye[Je]===Xe[Je];)Je++;if(Je===0)return ae.DISCONNECTED;var rt=Ye[Je-1],it=rt.children,nt=Ye[Je],tt=Xe[Je];return it.indexOf(nt)>it.indexOf(tt)?rt===Ke?ae.FOLLOWING|ae.CONTAINED_BY:ae.FOLLOWING:rt===be?ae.PRECEDING|ae.CONTAINS:ae.PRECEDING}ie.compareDocumentPosition=ve;function ye(be){return be=be.filter(function(Ke,Ye,Xe){return!Xe.includes(Ke,Ye+1)}),be.sort(function(Ke,Ye){var Xe=ve(Ke,Ye);return Xe&ae.PRECEDING?-1:Xe&ae.FOLLOWING?1:0}),be}ie.uniqueSort=ye})(helpers);var feeds={};Object.defineProperty(feeds,"__esModule",{value:!0});feeds.getFeed=void 0;var stringify_js_1=stringify$5,legacy_js_1=legacy;function getFeed(ie){var Z=getOneElement(isValidFeed,ie);return Z?Z.name==="feed"?getAtomFeed(Z):getRssFeed(Z):null}feeds.getFeed=getFeed;function getAtomFeed(ie){var Z,ee=ie.children,ae={type:"atom",items:(0,legacy_js_1.getElementsByTagName)("entry",ee).map(function(be){var Ke,Ye=be.children,Xe={media:getMediaElements(Ye)};addConditionally(Xe,"id","id",Ye),addConditionally(Xe,"title","title",Ye);var Qe=(Ke=getOneElement("link",Ye))===null||Ke===void 0?void 0:Ke.attribs.href;Qe&&(Xe.link=Qe);var et=fetch$1("summary",Ye)||fetch$1("content",Ye);et&&(Xe.description=et);var Je=fetch$1("updated",Ye);return Je&&(Xe.pubDate=new Date(Je)),Xe})};addConditionally(ae,"id","id",ee),addConditionally(ae,"title","title",ee);var ve=(Z=getOneElement("link",ee))===null||Z===void 0?void 0:Z.attribs.href;ve&&(ae.link=ve),addConditionally(ae,"description","subtitle",ee);var ye=fetch$1("updated",ee);return ye&&(ae.updated=new Date(ye)),addConditionally(ae,"author","email",ee,!0),ae}function getRssFeed(ie){var Z,ee,ae=(ee=(Z=getOneElement("channel",ie.children))===null||Z===void 0?void 0:Z.children)!==null&&ee!==void 0?ee:[],ve={type:ie.name.substr(0,3),id:"",items:(0,legacy_js_1.getElementsByTagName)("item",ie.children).map(function(be){var Ke=be.children,Ye={media:getMediaElements(Ke)};addConditionally(Ye,"id","guid",Ke),addConditionally(Ye,"title","title",Ke),addConditionally(Ye,"link","link",Ke),addConditionally(Ye,"description","description",Ke);var Xe=fetch$1("pubDate",Ke)||fetch$1("dc:date",Ke);return Xe&&(Ye.pubDate=new Date(Xe)),Ye})};addConditionally(ve,"title","title",ae),addConditionally(ve,"link","link",ae),addConditionally(ve,"description","description",ae);var ye=fetch$1("lastBuildDate",ae);return ye&&(ve.updated=new Date(ye)),addConditionally(ve,"author","managingEditor",ae,!0),ve}var MEDIA_KEYS_STRING=["url","type","lang"],MEDIA_KEYS_INT=["fileSize","bitrate","framerate","samplingrate","channels","duration","height","width"];function getMediaElements(ie){return(0,legacy_js_1.getElementsByTagName)("media:content",ie).map(function(Z){for(var ee=Z.attribs,ae={medium:ee.medium,isDefault:!!ee.isDefault},ve=0,ye=MEDIA_KEYS_STRING;ve<ye.length;ve++){var be=ye[ve];ee[be]&&(ae[be]=ee[be])}for(var Ke=0,Ye=MEDIA_KEYS_INT;Ke<Ye.length;Ke++){var be=Ye[Ke];ee[be]&&(ae[be]=parseInt(ee[be],10))}return ee.expression&&(ae.expression=ee.expression),ae})}function getOneElement(ie,Z){return(0,legacy_js_1.getElementsByTagName)(ie,Z,!0,1)[0]}function fetch$1(ie,Z,ee){return ee===void 0&&(ee=!1),(0,stringify_js_1.textContent)((0,legacy_js_1.getElementsByTagName)(ie,Z,ee,1)).trim()}function addConditionally(ie,Z,ee,ae,ve){ve===void 0&&(ve=!1);var ye=fetch$1(ee,ae,ve);ye&&(ie[Z]=ye)}function isValidFeed(ie){return ie==="rss"||ie==="feed"||ie==="rdf:RDF"}(function(ie){var Z=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(ve,ye,be,Ke){Ke===void 0&&(Ke=be);var Ye=Object.getOwnPropertyDescriptor(ye,be);(!Ye||("get"in Ye?!ye.__esModule:Ye.writable||Ye.configurable))&&(Ye={enumerable:!0,get:function(){return ye[be]}}),Object.defineProperty(ve,Ke,Ye)}:function(ve,ye,be,Ke){Ke===void 0&&(Ke=be),ve[Ke]=ye[be]}),ee=commonjsGlobal&&commonjsGlobal.__exportStar||function(ve,ye){for(var be in ve)be!=="default"&&!Object.prototype.hasOwnProperty.call(ye,be)&&Z(ye,ve,be)};Object.defineProperty(ie,"__esModule",{value:!0}),ie.hasChildren=ie.isDocument=ie.isComment=ie.isText=ie.isCDATA=ie.isTag=void 0,ee(stringify$5,ie),ee(traversal,ie),ee(manipulation,ie),ee(querying,ie),ee(legacy,ie),ee(helpers,ie),ee(feeds,ie);var ae=lib$4;Object.defineProperty(ie,"isTag",{enumerable:!0,get:function(){return ae.isTag}}),Object.defineProperty(ie,"isCDATA",{enumerable:!0,get:function(){return ae.isCDATA}}),Object.defineProperty(ie,"isText",{enumerable:!0,get:function(){return ae.isText}}),Object.defineProperty(ie,"isComment",{enumerable:!0,get:function(){return ae.isComment}}),Object.defineProperty(ie,"isDocument",{enumerable:!0,get:function(){return ae.isDocument}}),Object.defineProperty(ie,"hasChildren",{enumerable:!0,get:function(){return ae.hasChildren}})})(lib$2);(function(ie){var Z=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(st,ot,ut,ft){ft===void 0&&(ft=ut);var pt=Object.getOwnPropertyDescriptor(ot,ut);(!pt||("get"in pt?!ot.__esModule:pt.writable||pt.configurable))&&(pt={enumerable:!0,get:function(){return ot[ut]}}),Object.defineProperty(st,ft,pt)}:function(st,ot,ut,ft){ft===void 0&&(ft=ut),st[ft]=ot[ut]}),ee=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(st,ot){Object.defineProperty(st,"default",{enumerable:!0,value:ot})}:function(st,ot){st.default=ot}),ae=commonjsGlobal&&commonjsGlobal.__importStar||function(st){if(st&&st.__esModule)return st;var ot={};if(st!=null)for(var ut in st)ut!=="default"&&Object.prototype.hasOwnProperty.call(st,ut)&&Z(ot,st,ut);return ee(ot,st),ot},ve=commonjsGlobal&&commonjsGlobal.__importDefault||function(st){return st&&st.__esModule?st:{default:st}};Object.defineProperty(ie,"__esModule",{value:!0}),ie.DomUtils=ie.parseFeed=ie.getFeed=ie.ElementType=ie.Tokenizer=ie.createDomStream=ie.parseDOM=ie.parseDocument=ie.DefaultHandler=ie.DomHandler=ie.Parser=void 0;var ye=Parser$3,be=Parser$3;Object.defineProperty(ie,"Parser",{enumerable:!0,get:function(){return be.Parser}});var Ke=lib$4,Ye=lib$4;Object.defineProperty(ie,"DomHandler",{enumerable:!0,get:function(){return Ye.DomHandler}}),Object.defineProperty(ie,"DefaultHandler",{enumerable:!0,get:function(){return Ye.DomHandler}});function Xe(st,ot){var ut=new Ke.DomHandler(void 0,ot);return new ye.Parser(ut,ot).end(st),ut.root}ie.parseDocument=Xe;function Qe(st,ot){return Xe(st,ot).children}ie.parseDOM=Qe;function et(st,ot,ut){var ft=new Ke.DomHandler(st,ot,ut);return new ye.Parser(ft,ot)}ie.createDomStream=et;var Je=Tokenizer;Object.defineProperty(ie,"Tokenizer",{enumerable:!0,get:function(){return ve(Je).default}}),ie.ElementType=ae(lib$3);var rt=lib$2,it=lib$2;Object.defineProperty(ie,"getFeed",{enumerable:!0,get:function(){return it.getFeed}});var nt={xmlMode:!0};function tt(st,ot){return ot===void 0&&(ot=nt),(0,rt.getFeed)(Qe(st,ot))}ie.parseFeed=tt,ie.DomUtils=ae(lib$2)})(lib$5);var escapeStringRegexp$1=ie=>{if(typeof ie!="string")throw new TypeError("Expected a string");return ie.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")},isPlainObject$2={};Object.defineProperty(isPlainObject$2,"__esModule",{value:!0});/*!
 * is-plain-object <https://github.com/jonschlinkert/is-plain-object>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */function isObject(ie){return Object.prototype.toString.call(ie)==="[object Object]"}function isPlainObject$1(ie){var Z,ee;return isObject(ie)===!1?!1:(Z=ie.constructor,Z===void 0?!0:(ee=Z.prototype,!(isObject(ee)===!1||ee.hasOwnProperty("isPrototypeOf")===!1)))}isPlainObject$2.isPlainObject=isPlainObject$1;var isMergeableObject=function(Z){return isNonNullObject(Z)&&!isSpecial(Z)};function isNonNullObject(ie){return!!ie&&typeof ie=="object"}function isSpecial(ie){var Z=Object.prototype.toString.call(ie);return Z==="[object RegExp]"||Z==="[object Date]"||isReactElement(ie)}var canUseSymbol=typeof Symbol=="function"&&Symbol.for,REACT_ELEMENT_TYPE=canUseSymbol?Symbol.for("react.element"):60103;function isReactElement(ie){return ie.$$typeof===REACT_ELEMENT_TYPE}function emptyTarget(ie){return Array.isArray(ie)?[]:{}}function cloneUnlessOtherwiseSpecified(ie,Z){return Z.clone!==!1&&Z.isMergeableObject(ie)?deepmerge$1(emptyTarget(ie),ie,Z):ie}function defaultArrayMerge(ie,Z,ee){return ie.concat(Z).map(function(ae){return cloneUnlessOtherwiseSpecified(ae,ee)})}function getMergeFunction(ie,Z){if(!Z.customMerge)return deepmerge$1;var ee=Z.customMerge(ie);return typeof ee=="function"?ee:deepmerge$1}function getEnumerableOwnPropertySymbols(ie){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(ie).filter(function(Z){return Object.propertyIsEnumerable.call(ie,Z)}):[]}function getKeys(ie){return Object.keys(ie).concat(getEnumerableOwnPropertySymbols(ie))}function propertyIsOnObject(ie,Z){try{return Z in ie}catch{return!1}}function propertyIsUnsafe(ie,Z){return propertyIsOnObject(ie,Z)&&!(Object.hasOwnProperty.call(ie,Z)&&Object.propertyIsEnumerable.call(ie,Z))}function mergeObject(ie,Z,ee){var ae={};return ee.isMergeableObject(ie)&&getKeys(ie).forEach(function(ve){ae[ve]=cloneUnlessOtherwiseSpecified(ie[ve],ee)}),getKeys(Z).forEach(function(ve){propertyIsUnsafe(ie,ve)||(propertyIsOnObject(ie,ve)&&ee.isMergeableObject(Z[ve])?ae[ve]=getMergeFunction(ve,ee)(ie[ve],Z[ve],ee):ae[ve]=cloneUnlessOtherwiseSpecified(Z[ve],ee))}),ae}function deepmerge$1(ie,Z,ee){ee=ee||{},ee.arrayMerge=ee.arrayMerge||defaultArrayMerge,ee.isMergeableObject=ee.isMergeableObject||isMergeableObject,ee.cloneUnlessOtherwiseSpecified=cloneUnlessOtherwiseSpecified;var ae=Array.isArray(Z),ve=Array.isArray(ie),ye=ae===ve;return ye?ae?ee.arrayMerge(ie,Z,ee):mergeObject(ie,Z,ee):cloneUnlessOtherwiseSpecified(Z,ee)}deepmerge$1.all=function(Z,ee){if(!Array.isArray(Z))throw new Error("first argument should be an array");return Z.reduce(function(ae,ve){return deepmerge$1(ae,ve,ee)},{})};var deepmerge_1=deepmerge$1,cjs=deepmerge_1,parseSrcset$1={exports:{}};(function(ie){(function(Z,ee){ie.exports?ie.exports=ee():Z.parseSrcset=ee()})(commonjsGlobal,function(){return function(Z){function ee(ft){return ft===" "||ft==="	"||ft===`
`||ft==="\f"||ft==="\r"}function ae(ft){var pt,Xr=ft.exec(Z.substring(tt));if(Xr)return pt=Xr[0],tt+=pt.length,pt}for(var ve=Z.length,ye=/^[ \t\n\r\u000c]+/,be=/^[, \t\n\r\u000c]+/,Ke=/^[^ \t\n\r\u000c]+/,Ye=/[,]+$/,Xe=/^\d+$/,Qe=/^-?(?:[0-9]+|[0-9]*\.[0-9]+)(?:[eE][+-]?[0-9]+)?$/,et,Je,rt,it,nt,tt=0,st=[];;){if(ae(be),tt>=ve)return st;et=ae(Ke),Je=[],et.slice(-1)===","?(et=et.replace(Ye,""),ut()):ot()}function ot(){for(ae(ye),rt="",it="in descriptor";;){if(nt=Z.charAt(tt),it==="in descriptor")if(ee(nt))rt&&(Je.push(rt),rt="",it="after descriptor");else if(nt===","){tt+=1,rt&&Je.push(rt),ut();return}else if(nt==="(")rt=rt+nt,it="in parens";else if(nt===""){rt&&Je.push(rt),ut();return}else rt=rt+nt;else if(it==="in parens")if(nt===")")rt=rt+nt,it="in descriptor";else if(nt===""){Je.push(rt),ut();return}else rt=rt+nt;else if(it==="after descriptor"&&!ee(nt))if(nt===""){ut();return}else it="in descriptor",tt-=1;tt+=1}}function ut(){var ft=!1,pt,Xr,mt,Yr,ri={},Zr,_r,Kr,si,oi;for(Yr=0;Yr<Je.length;Yr++)Zr=Je[Yr],_r=Zr[Zr.length-1],Kr=Zr.substring(0,Zr.length-1),si=parseInt(Kr,10),oi=parseFloat(Kr),Xe.test(Kr)&&_r==="w"?((pt||Xr)&&(ft=!0),si===0?ft=!0:pt=si):Qe.test(Kr)&&_r==="x"?((pt||Xr||mt)&&(ft=!0),oi<0?ft=!0:Xr=oi):Xe.test(Kr)&&_r==="h"?((mt||Xr)&&(ft=!0),si===0?ft=!0:mt=si):ft=!0;ft?console&&console.log&&console.log("Invalid srcset descriptor found in '"+Z+"' at '"+Zr+"'."):(ri.url=et,pt&&(ri.w=pt),Xr&&(ri.d=Xr),mt&&(ri.h=mt),st.push(ri))}}})})(parseSrcset$1);var parseSrcsetExports=parseSrcset$1.exports,picocolors_browser={exports:{}},x=String,create=function(){return{isColorSupported:!1,reset:x,bold:x,dim:x,italic:x,underline:x,inverse:x,hidden:x,strikethrough:x,black:x,red:x,green:x,yellow:x,blue:x,magenta:x,cyan:x,white:x,gray:x,bgBlack:x,bgRed:x,bgGreen:x,bgYellow:x,bgBlue:x,bgMagenta:x,bgCyan:x,bgWhite:x}};picocolors_browser.exports=create();picocolors_browser.exports.createColors=create;var picocolors_browserExports=picocolors_browser.exports;let pico=picocolors_browserExports,terminalHighlight$1=require$$2,CssSyntaxError$3=class Qi extends Error{constructor(Z,ee,ae,ve,ye,be){super(Z),this.name="CssSyntaxError",this.reason=Z,ye&&(this.file=ye),ve&&(this.source=ve),be&&(this.plugin=be),typeof ee<"u"&&typeof ae<"u"&&(typeof ee=="number"?(this.line=ee,this.column=ae):(this.line=ee.line,this.column=ee.column,this.endLine=ae.line,this.endColumn=ae.column)),this.setMessage(),Error.captureStackTrace&&Error.captureStackTrace(this,Qi)}setMessage(){this.message=this.plugin?this.plugin+": ":"",this.message+=this.file?this.file:"<css input>",typeof this.line<"u"&&(this.message+=":"+this.line+":"+this.column),this.message+=": "+this.reason}showSourceCode(Z){if(!this.source)return"";let ee=this.source;Z==null&&(Z=pico.isColorSupported),terminalHighlight$1&&Z&&(ee=terminalHighlight$1(ee));let ae=ee.split(/\r?\n/),ve=Math.max(this.line-3,0),ye=Math.min(this.line+2,ae.length),be=String(ye).length,Ke,Ye;if(Z){let{bold:Xe,gray:Qe,red:et}=pico.createColors(!0);Ke=Je=>Xe(et(Je)),Ye=Je=>Qe(Je)}else Ke=Ye=Xe=>Xe;return ae.slice(ve,ye).map((Xe,Qe)=>{let et=ve+1+Qe,Je=" "+(" "+et).slice(-be)+" | ";if(et===this.line){let rt=Ye(Je.replace(/\d/g," "))+Xe.slice(0,this.column-1).replace(/[^\t]/g," ");return Ke(">")+Ye(Je)+Xe+`
 `+rt+Ke("^")}return" "+Ye(Je)+Xe}).join(`
`)}toString(){let Z=this.showSourceCode();return Z&&(Z=`

`+Z+`
`),this.name+": "+this.message+Z}};var cssSyntaxError=CssSyntaxError$3;CssSyntaxError$3.default=CssSyntaxError$3;var symbols={};symbols.isClean=Symbol("isClean");symbols.my=Symbol("my");const DEFAULT_RAW={after:`
`,beforeClose:`
`,beforeComment:`
`,beforeDecl:`
`,beforeOpen:" ",beforeRule:`
`,colon:": ",commentLeft:" ",commentRight:" ",emptyBody:"",indent:"    ",semicolon:!1};function capitalize(ie){return ie[0].toUpperCase()+ie.slice(1)}let Stringifier$2=class{constructor(Z){this.builder=Z}atrule(Z,ee){let ae="@"+Z.name,ve=Z.params?this.rawValue(Z,"params"):"";if(typeof Z.raws.afterName<"u"?ae+=Z.raws.afterName:ve&&(ae+=" "),Z.nodes)this.block(Z,ae+ve);else{let ye=(Z.raws.between||"")+(ee?";":"");this.builder(ae+ve+ye,Z)}}beforeAfter(Z,ee){let ae;Z.type==="decl"?ae=this.raw(Z,null,"beforeDecl"):Z.type==="comment"?ae=this.raw(Z,null,"beforeComment"):ee==="before"?ae=this.raw(Z,null,"beforeRule"):ae=this.raw(Z,null,"beforeClose");let ve=Z.parent,ye=0;for(;ve&&ve.type!=="root";)ye+=1,ve=ve.parent;if(ae.includes(`
`)){let be=this.raw(Z,null,"indent");if(be.length)for(let Ke=0;Ke<ye;Ke++)ae+=be}return ae}block(Z,ee){let ae=this.raw(Z,"between","beforeOpen");this.builder(ee+ae+"{",Z,"start");let ve;Z.nodes&&Z.nodes.length?(this.body(Z),ve=this.raw(Z,"after")):ve=this.raw(Z,"after","emptyBody"),ve&&this.builder(ve),this.builder("}",Z,"end")}body(Z){let ee=Z.nodes.length-1;for(;ee>0&&Z.nodes[ee].type==="comment";)ee-=1;let ae=this.raw(Z,"semicolon");for(let ve=0;ve<Z.nodes.length;ve++){let ye=Z.nodes[ve],be=this.raw(ye,"before");be&&this.builder(be),this.stringify(ye,ee!==ve||ae)}}comment(Z){let ee=this.raw(Z,"left","commentLeft"),ae=this.raw(Z,"right","commentRight");this.builder("/*"+ee+Z.text+ae+"*/",Z)}decl(Z,ee){let ae=this.raw(Z,"between","colon"),ve=Z.prop+ae+this.rawValue(Z,"value");Z.important&&(ve+=Z.raws.important||" !important"),ee&&(ve+=";"),this.builder(ve,Z)}document(Z){this.body(Z)}raw(Z,ee,ae){let ve;if(ae||(ae=ee),ee&&(ve=Z.raws[ee],typeof ve<"u"))return ve;let ye=Z.parent;if(ae==="before"&&(!ye||ye.type==="root"&&ye.first===Z||ye&&ye.type==="document"))return"";if(!ye)return DEFAULT_RAW[ae];let be=Z.root();if(be.rawCache||(be.rawCache={}),typeof be.rawCache[ae]<"u")return be.rawCache[ae];if(ae==="before"||ae==="after")return this.beforeAfter(Z,ae);{let Ke="raw"+capitalize(ae);this[Ke]?ve=this[Ke](be,Z):be.walk(Ye=>{if(ve=Ye.raws[ee],typeof ve<"u")return!1})}return typeof ve>"u"&&(ve=DEFAULT_RAW[ae]),be.rawCache[ae]=ve,ve}rawBeforeClose(Z){let ee;return Z.walk(ae=>{if(ae.nodes&&ae.nodes.length>0&&typeof ae.raws.after<"u")return ee=ae.raws.after,ee.includes(`
`)&&(ee=ee.replace(/[^\n]+$/,"")),!1}),ee&&(ee=ee.replace(/\S/g,"")),ee}rawBeforeComment(Z,ee){let ae;return Z.walkComments(ve=>{if(typeof ve.raws.before<"u")return ae=ve.raws.before,ae.includes(`
`)&&(ae=ae.replace(/[^\n]+$/,"")),!1}),typeof ae>"u"?ae=this.raw(ee,null,"beforeDecl"):ae&&(ae=ae.replace(/\S/g,"")),ae}rawBeforeDecl(Z,ee){let ae;return Z.walkDecls(ve=>{if(typeof ve.raws.before<"u")return ae=ve.raws.before,ae.includes(`
`)&&(ae=ae.replace(/[^\n]+$/,"")),!1}),typeof ae>"u"?ae=this.raw(ee,null,"beforeRule"):ae&&(ae=ae.replace(/\S/g,"")),ae}rawBeforeOpen(Z){let ee;return Z.walk(ae=>{if(ae.type!=="decl"&&(ee=ae.raws.between,typeof ee<"u"))return!1}),ee}rawBeforeRule(Z){let ee;return Z.walk(ae=>{if(ae.nodes&&(ae.parent!==Z||Z.first!==ae)&&typeof ae.raws.before<"u")return ee=ae.raws.before,ee.includes(`
`)&&(ee=ee.replace(/[^\n]+$/,"")),!1}),ee&&(ee=ee.replace(/\S/g,"")),ee}rawColon(Z){let ee;return Z.walkDecls(ae=>{if(typeof ae.raws.between<"u")return ee=ae.raws.between.replace(/[^\s:]/g,""),!1}),ee}rawEmptyBody(Z){let ee;return Z.walk(ae=>{if(ae.nodes&&ae.nodes.length===0&&(ee=ae.raws.after,typeof ee<"u"))return!1}),ee}rawIndent(Z){if(Z.raws.indent)return Z.raws.indent;let ee;return Z.walk(ae=>{let ve=ae.parent;if(ve&&ve!==Z&&ve.parent&&ve.parent===Z&&typeof ae.raws.before<"u"){let ye=ae.raws.before.split(`
`);return ee=ye[ye.length-1],ee=ee.replace(/\S/g,""),!1}}),ee}rawSemicolon(Z){let ee;return Z.walk(ae=>{if(ae.nodes&&ae.nodes.length&&ae.last.type==="decl"&&(ee=ae.raws.semicolon,typeof ee<"u"))return!1}),ee}rawValue(Z,ee){let ae=Z[ee],ve=Z.raws[ee];return ve&&ve.value===ae?ve.raw:ae}root(Z){this.body(Z),Z.raws.after&&this.builder(Z.raws.after)}rule(Z){this.block(Z,this.rawValue(Z,"selector")),Z.raws.ownSemicolon&&this.builder(Z.raws.ownSemicolon,Z,"end")}stringify(Z,ee){if(!this[Z.type])throw new Error("Unknown AST node type "+Z.type+". Maybe you need to change PostCSS stringifier.");this[Z.type](Z,ee)}};var stringifier=Stringifier$2;Stringifier$2.default=Stringifier$2;let Stringifier$1=stringifier;function stringify$4(ie,Z){new Stringifier$1(Z).stringify(ie)}var stringify_1=stringify$4;stringify$4.default=stringify$4;let{isClean:isClean$2,my:my$2}=symbols,CssSyntaxError$2=cssSyntaxError,Stringifier=stringifier,stringify$3=stringify_1;function cloneNode(ie,Z){let ee=new ie.constructor;for(let ae in ie){if(!Object.prototype.hasOwnProperty.call(ie,ae)||ae==="proxyCache")continue;let ve=ie[ae],ye=typeof ve;ae==="parent"&&ye==="object"?Z&&(ee[ae]=Z):ae==="source"?ee[ae]=ve:Array.isArray(ve)?ee[ae]=ve.map(be=>cloneNode(be,ee)):(ye==="object"&&ve!==null&&(ve=cloneNode(ve)),ee[ae]=ve)}return ee}let Node$5=class{constructor(Z={}){this.raws={},this[isClean$2]=!1,this[my$2]=!0;for(let ee in Z)if(ee==="nodes"){this.nodes=[];for(let ae of Z[ee])typeof ae.clone=="function"?this.append(ae.clone()):this.append(ae)}else this[ee]=Z[ee]}addToError(Z){if(Z.postcssNode=this,Z.stack&&this.source&&/\n\s{4}at /.test(Z.stack)){let ee=this.source;Z.stack=Z.stack.replace(/\n\s{4}at /,`$&${ee.input.from}:${ee.start.line}:${ee.start.column}$&`)}return Z}after(Z){return this.parent.insertAfter(this,Z),this}assign(Z={}){for(let ee in Z)this[ee]=Z[ee];return this}before(Z){return this.parent.insertBefore(this,Z),this}cleanRaws(Z){delete this.raws.before,delete this.raws.after,Z||delete this.raws.between}clone(Z={}){let ee=cloneNode(this);for(let ae in Z)ee[ae]=Z[ae];return ee}cloneAfter(Z={}){let ee=this.clone(Z);return this.parent.insertAfter(this,ee),ee}cloneBefore(Z={}){let ee=this.clone(Z);return this.parent.insertBefore(this,ee),ee}error(Z,ee={}){if(this.source){let{end:ae,start:ve}=this.rangeBy(ee);return this.source.input.error(Z,{column:ve.column,line:ve.line},{column:ae.column,line:ae.line},ee)}return new CssSyntaxError$2(Z)}getProxyProcessor(){return{get(Z,ee){return ee==="proxyOf"?Z:ee==="root"?()=>Z.root().toProxy():Z[ee]},set(Z,ee,ae){return Z[ee]===ae||(Z[ee]=ae,(ee==="prop"||ee==="value"||ee==="name"||ee==="params"||ee==="important"||ee==="text")&&Z.markDirty()),!0}}}markDirty(){if(this[isClean$2]){this[isClean$2]=!1;let Z=this;for(;Z=Z.parent;)Z[isClean$2]=!1}}next(){if(!this.parent)return;let Z=this.parent.index(this);return this.parent.nodes[Z+1]}positionBy(Z,ee){let ae=this.source.start;if(Z.index)ae=this.positionInside(Z.index,ee);else if(Z.word){ee=this.toString();let ve=ee.indexOf(Z.word);ve!==-1&&(ae=this.positionInside(ve,ee))}return ae}positionInside(Z,ee){let ae=ee||this.toString(),ve=this.source.start.column,ye=this.source.start.line;for(let be=0;be<Z;be++)ae[be]===`
`?(ve=1,ye+=1):ve+=1;return{column:ve,line:ye}}prev(){if(!this.parent)return;let Z=this.parent.index(this);return this.parent.nodes[Z-1]}rangeBy(Z){let ee={column:this.source.start.column,line:this.source.start.line},ae=this.source.end?{column:this.source.end.column+1,line:this.source.end.line}:{column:ee.column+1,line:ee.line};if(Z.word){let ve=this.toString(),ye=ve.indexOf(Z.word);ye!==-1&&(ee=this.positionInside(ye,ve),ae=this.positionInside(ye+Z.word.length,ve))}else Z.start?ee={column:Z.start.column,line:Z.start.line}:Z.index&&(ee=this.positionInside(Z.index)),Z.end?ae={column:Z.end.column,line:Z.end.line}:Z.endIndex?ae=this.positionInside(Z.endIndex):Z.index&&(ae=this.positionInside(Z.index+1));return(ae.line<ee.line||ae.line===ee.line&&ae.column<=ee.column)&&(ae={column:ee.column+1,line:ee.line}),{end:ae,start:ee}}raw(Z,ee){return new Stringifier().raw(this,Z,ee)}remove(){return this.parent&&this.parent.removeChild(this),this.parent=void 0,this}replaceWith(...Z){if(this.parent){let ee=this,ae=!1;for(let ve of Z)ve===this?ae=!0:ae?(this.parent.insertAfter(ee,ve),ee=ve):this.parent.insertBefore(ee,ve);ae||this.remove()}return this}root(){let Z=this;for(;Z.parent&&Z.parent.type!=="document";)Z=Z.parent;return Z}toJSON(Z,ee){let ae={},ve=ee==null;ee=ee||new Map;let ye=0;for(let be in this){if(!Object.prototype.hasOwnProperty.call(this,be)||be==="parent"||be==="proxyCache")continue;let Ke=this[be];if(Array.isArray(Ke))ae[be]=Ke.map(Ye=>typeof Ye=="object"&&Ye.toJSON?Ye.toJSON(null,ee):Ye);else if(typeof Ke=="object"&&Ke.toJSON)ae[be]=Ke.toJSON(null,ee);else if(be==="source"){let Ye=ee.get(Ke.input);Ye==null&&(Ye=ye,ee.set(Ke.input,ye),ye++),ae[be]={end:Ke.end,inputId:Ye,start:Ke.start}}else ae[be]=Ke}return ve&&(ae.inputs=[...ee.keys()].map(be=>be.toJSON())),ae}toProxy(){return this.proxyCache||(this.proxyCache=new Proxy(this,this.getProxyProcessor())),this.proxyCache}toString(Z=stringify$3){Z.stringify&&(Z=Z.stringify);let ee="";return Z(this,ae=>{ee+=ae}),ee}warn(Z,ee,ae){let ve={node:this};for(let ye in ae)ve[ye]=ae[ye];return Z.warn(ee,ve)}get proxyOf(){return this}};var node=Node$5;Node$5.default=Node$5;let Node$4=node,Declaration$4=class extends Node$4{constructor(Z){Z&&typeof Z.value<"u"&&typeof Z.value!="string"&&(Z={...Z,value:String(Z.value)}),super(Z),this.type="decl"}get variable(){return this.prop.startsWith("--")||this.prop[0]==="$"}};var declaration=Declaration$4;Declaration$4.default=Declaration$4;let urlAlphabet="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",customAlphabet=(ie,Z=21)=>(ee=Z)=>{let ae="",ve=ee;for(;ve--;)ae+=ie[Math.random()*ie.length|0];return ae},nanoid$1=(ie=21)=>{let Z="",ee=ie;for(;ee--;)Z+=urlAlphabet[Math.random()*64|0];return Z};var nonSecure={nanoid:nanoid$1,customAlphabet};let{SourceMapConsumer:SourceMapConsumer$2,SourceMapGenerator:SourceMapGenerator$2}=require$$2,{existsSync,readFileSync}=require$$2,{dirname:dirname$1,join}=require$$2;function fromBase64(ie){return Buffer?Buffer.from(ie,"base64").toString():window.atob(ie)}let PreviousMap$2=class{constructor(Z,ee){if(ee.map===!1)return;this.loadAnnotation(Z),this.inline=this.startWith(this.annotation,"data:");let ae=ee.map?ee.map.prev:void 0,ve=this.loadMap(ee.from,ae);!this.mapFile&&ee.from&&(this.mapFile=ee.from),this.mapFile&&(this.root=dirname$1(this.mapFile)),ve&&(this.text=ve)}consumer(){return this.consumerCache||(this.consumerCache=new SourceMapConsumer$2(this.text)),this.consumerCache}decodeInline(Z){let ee=/^data:application\/json;charset=utf-?8;base64,/,ae=/^data:application\/json;base64,/,ve=/^data:application\/json;charset=utf-?8,/,ye=/^data:application\/json,/;if(ve.test(Z)||ye.test(Z))return decodeURIComponent(Z.substr(RegExp.lastMatch.length));if(ee.test(Z)||ae.test(Z))return fromBase64(Z.substr(RegExp.lastMatch.length));let be=Z.match(/data:application\/json;([^,]+),/)[1];throw new Error("Unsupported source map encoding "+be)}getAnnotationURL(Z){return Z.replace(/^\/\*\s*# sourceMappingURL=/,"").trim()}isMap(Z){return typeof Z!="object"?!1:typeof Z.mappings=="string"||typeof Z._mappings=="string"||Array.isArray(Z.sections)}loadAnnotation(Z){let ee=Z.match(/\/\*\s*# sourceMappingURL=/gm);if(!ee)return;let ae=Z.lastIndexOf(ee.pop()),ve=Z.indexOf("*/",ae);ae>-1&&ve>-1&&(this.annotation=this.getAnnotationURL(Z.substring(ae,ve)))}loadFile(Z){if(this.root=dirname$1(Z),existsSync(Z))return this.mapFile=Z,readFileSync(Z,"utf-8").toString().trim()}loadMap(Z,ee){if(ee===!1)return!1;if(ee){if(typeof ee=="string")return ee;if(typeof ee=="function"){let ae=ee(Z);if(ae){let ve=this.loadFile(ae);if(!ve)throw new Error("Unable to load previous source map: "+ae.toString());return ve}}else{if(ee instanceof SourceMapConsumer$2)return SourceMapGenerator$2.fromSourceMap(ee).toString();if(ee instanceof SourceMapGenerator$2)return ee.toString();if(this.isMap(ee))return JSON.stringify(ee);throw new Error("Unsupported previous source map format: "+ee.toString())}}else{if(this.inline)return this.decodeInline(this.annotation);if(this.annotation){let ae=this.annotation;return Z&&(ae=join(dirname$1(Z),ae)),this.loadFile(ae)}}}startWith(Z,ee){return Z?Z.substr(0,ee.length)===ee:!1}withContent(){return!!(this.consumer().sourcesContent&&this.consumer().sourcesContent.length>0)}};var previousMap=PreviousMap$2;PreviousMap$2.default=PreviousMap$2;let{SourceMapConsumer:SourceMapConsumer$1,SourceMapGenerator:SourceMapGenerator$1}=require$$2,{fileURLToPath,pathToFileURL:pathToFileURL$1}=require$$2,{isAbsolute,resolve:resolve$1}=require$$2,{nanoid}=nonSecure,terminalHighlight=require$$2,CssSyntaxError$1=cssSyntaxError,PreviousMap$1=previousMap,fromOffsetCache=Symbol("fromOffsetCache"),sourceMapAvailable$1=!!(SourceMapConsumer$1&&SourceMapGenerator$1),pathAvailable$1=!!(resolve$1&&isAbsolute),Input$4=class{constructor(Z,ee={}){if(Z===null||typeof Z>"u"||typeof Z=="object"&&!Z.toString)throw new Error(`PostCSS received ${Z} instead of CSS string`);if(this.css=Z.toString(),this.css[0]==="\uFEFF"||this.css[0]===""?(this.hasBOM=!0,this.css=this.css.slice(1)):this.hasBOM=!1,ee.from&&(!pathAvailable$1||/^\w+:\/\//.test(ee.from)||isAbsolute(ee.from)?this.file=ee.from:this.file=resolve$1(ee.from)),pathAvailable$1&&sourceMapAvailable$1){let ae=new PreviousMap$1(this.css,ee);if(ae.text){this.map=ae;let ve=ae.consumer().file;!this.file&&ve&&(this.file=this.mapResolve(ve))}}this.file||(this.id="<input css "+nanoid(6)+">"),this.map&&(this.map.file=this.from)}error(Z,ee,ae,ve={}){let ye,be,Ke;if(ee&&typeof ee=="object"){let Xe=ee,Qe=ae;if(typeof Xe.offset=="number"){let et=this.fromOffset(Xe.offset);ee=et.line,ae=et.col}else ee=Xe.line,ae=Xe.column;if(typeof Qe.offset=="number"){let et=this.fromOffset(Qe.offset);be=et.line,Ke=et.col}else be=Qe.line,Ke=Qe.column}else if(!ae){let Xe=this.fromOffset(ee);ee=Xe.line,ae=Xe.col}let Ye=this.origin(ee,ae,be,Ke);return Ye?ye=new CssSyntaxError$1(Z,Ye.endLine===void 0?Ye.line:{column:Ye.column,line:Ye.line},Ye.endLine===void 0?Ye.column:{column:Ye.endColumn,line:Ye.endLine},Ye.source,Ye.file,ve.plugin):ye=new CssSyntaxError$1(Z,be===void 0?ee:{column:ae,line:ee},be===void 0?ae:{column:Ke,line:be},this.css,this.file,ve.plugin),ye.input={column:ae,endColumn:Ke,endLine:be,line:ee,source:this.css},this.file&&(pathToFileURL$1&&(ye.input.url=pathToFileURL$1(this.file).toString()),ye.input.file=this.file),ye}fromOffset(Z){let ee,ae;if(this[fromOffsetCache])ae=this[fromOffsetCache];else{let ye=this.css.split(`
`);ae=new Array(ye.length);let be=0;for(let Ke=0,Ye=ye.length;Ke<Ye;Ke++)ae[Ke]=be,be+=ye[Ke].length+1;this[fromOffsetCache]=ae}ee=ae[ae.length-1];let ve=0;if(Z>=ee)ve=ae.length-1;else{let ye=ae.length-2,be;for(;ve<ye;)if(be=ve+(ye-ve>>1),Z<ae[be])ye=be-1;else if(Z>=ae[be+1])ve=be+1;else{ve=be;break}}return{col:Z-ae[ve]+1,line:ve+1}}mapResolve(Z){return/^\w+:\/\//.test(Z)?Z:resolve$1(this.map.consumer().sourceRoot||this.map.root||".",Z)}origin(Z,ee,ae,ve){if(!this.map)return!1;let ye=this.map.consumer(),be=ye.originalPositionFor({column:ee,line:Z});if(!be.source)return!1;let Ke;typeof ae=="number"&&(Ke=ye.originalPositionFor({column:ve,line:ae}));let Ye;isAbsolute(be.source)?Ye=pathToFileURL$1(be.source):Ye=new URL(be.source,this.map.consumer().sourceRoot||pathToFileURL$1(this.map.mapFile));let Xe={column:be.column,endColumn:Ke&&Ke.column,endLine:Ke&&Ke.line,line:be.line,url:Ye.toString()};if(Ye.protocol==="file:")if(fileURLToPath)Xe.file=fileURLToPath(Ye);else throw new Error("file: protocol is not available in this PostCSS build");let Qe=ye.sourceContentFor(be.source);return Qe&&(Xe.source=Qe),Xe}toJSON(){let Z={};for(let ee of["hasBOM","css","file","id"])this[ee]!=null&&(Z[ee]=this[ee]);return this.map&&(Z.map={...this.map},Z.map.consumerCache&&(Z.map.consumerCache=void 0)),Z}get from(){return this.file||this.id}};var input=Input$4;Input$4.default=Input$4;terminalHighlight&&terminalHighlight.registerInput&&terminalHighlight.registerInput(Input$4);let{SourceMapConsumer,SourceMapGenerator}=require$$2,{dirname,relative,resolve,sep}=require$$2,{pathToFileURL}=require$$2,Input$3=input,sourceMapAvailable=!!(SourceMapConsumer&&SourceMapGenerator),pathAvailable=!!(dirname&&resolve&&relative&&sep),MapGenerator$2=class{constructor(Z,ee,ae,ve){this.stringify=Z,this.mapOpts=ae.map||{},this.root=ee,this.opts=ae,this.css=ve,this.originalCSS=ve,this.usesFileUrls=!this.mapOpts.from&&this.mapOpts.absolute,this.memoizedFileURLs=new Map,this.memoizedPaths=new Map,this.memoizedURLs=new Map}addAnnotation(){let Z;this.isInline()?Z="data:application/json;base64,"+this.toBase64(this.map.toString()):typeof this.mapOpts.annotation=="string"?Z=this.mapOpts.annotation:typeof this.mapOpts.annotation=="function"?Z=this.mapOpts.annotation(this.opts.to,this.root):Z=this.outputFile()+".map";let ee=`
`;this.css.includes(`\r
`)&&(ee=`\r
`),this.css+=ee+"/*# sourceMappingURL="+Z+" */"}applyPrevMaps(){for(let Z of this.previous()){let ee=this.toUrl(this.path(Z.file)),ae=Z.root||dirname(Z.file),ve;this.mapOpts.sourcesContent===!1?(ve=new SourceMapConsumer(Z.text),ve.sourcesContent&&(ve.sourcesContent=null)):ve=Z.consumer(),this.map.applySourceMap(ve,ee,this.toUrl(this.path(ae)))}}clearAnnotation(){if(this.mapOpts.annotation!==!1)if(this.root){let Z;for(let ee=this.root.nodes.length-1;ee>=0;ee--)Z=this.root.nodes[ee],Z.type==="comment"&&Z.text.indexOf("# sourceMappingURL=")===0&&this.root.removeChild(ee)}else this.css&&(this.css=this.css.replace(/\n*?\/\*#[\S\s]*?\*\/$/gm,""))}generate(){if(this.clearAnnotation(),pathAvailable&&sourceMapAvailable&&this.isMap())return this.generateMap();{let Z="";return this.stringify(this.root,ee=>{Z+=ee}),[Z]}}generateMap(){if(this.root)this.generateString();else if(this.previous().length===1){let Z=this.previous()[0].consumer();Z.file=this.outputFile(),this.map=SourceMapGenerator.fromSourceMap(Z)}else this.map=new SourceMapGenerator({file:this.outputFile()}),this.map.addMapping({generated:{column:0,line:1},original:{column:0,line:1},source:this.opts.from?this.toUrl(this.path(this.opts.from)):"<no source>"});return this.isSourcesContent()&&this.setSourcesContent(),this.root&&this.previous().length>0&&this.applyPrevMaps(),this.isAnnotation()&&this.addAnnotation(),this.isInline()?[this.css]:[this.css,this.map]}generateString(){this.css="",this.map=new SourceMapGenerator({file:this.outputFile()});let Z=1,ee=1,ae="<no source>",ve={generated:{column:0,line:0},original:{column:0,line:0},source:""},ye,be;this.stringify(this.root,(Ke,Ye,Xe)=>{if(this.css+=Ke,Ye&&Xe!=="end"&&(ve.generated.line=Z,ve.generated.column=ee-1,Ye.source&&Ye.source.start?(ve.source=this.sourcePath(Ye),ve.original.line=Ye.source.start.line,ve.original.column=Ye.source.start.column-1,this.map.addMapping(ve)):(ve.source=ae,ve.original.line=1,ve.original.column=0,this.map.addMapping(ve))),ye=Ke.match(/\n/g),ye?(Z+=ye.length,be=Ke.lastIndexOf(`
`),ee=Ke.length-be):ee+=Ke.length,Ye&&Xe!=="start"){let Qe=Ye.parent||{raws:{}};(!(Ye.type==="decl"||Ye.type==="atrule"&&!Ye.nodes)||Ye!==Qe.last||Qe.raws.semicolon)&&(Ye.source&&Ye.source.end?(ve.source=this.sourcePath(Ye),ve.original.line=Ye.source.end.line,ve.original.column=Ye.source.end.column-1,ve.generated.line=Z,ve.generated.column=ee-2,this.map.addMapping(ve)):(ve.source=ae,ve.original.line=1,ve.original.column=0,ve.generated.line=Z,ve.generated.column=ee-1,this.map.addMapping(ve)))}})}isAnnotation(){return this.isInline()?!0:typeof this.mapOpts.annotation<"u"?this.mapOpts.annotation:this.previous().length?this.previous().some(Z=>Z.annotation):!0}isInline(){if(typeof this.mapOpts.inline<"u")return this.mapOpts.inline;let Z=this.mapOpts.annotation;return typeof Z<"u"&&Z!==!0?!1:this.previous().length?this.previous().some(ee=>ee.inline):!0}isMap(){return typeof this.opts.map<"u"?!!this.opts.map:this.previous().length>0}isSourcesContent(){return typeof this.mapOpts.sourcesContent<"u"?this.mapOpts.sourcesContent:this.previous().length?this.previous().some(Z=>Z.withContent()):!0}outputFile(){return this.opts.to?this.path(this.opts.to):this.opts.from?this.path(this.opts.from):"to.css"}path(Z){if(this.mapOpts.absolute||Z.charCodeAt(0)===60||/^\w+:\/\//.test(Z))return Z;let ee=this.memoizedPaths.get(Z);if(ee)return ee;let ae=this.opts.to?dirname(this.opts.to):".";typeof this.mapOpts.annotation=="string"&&(ae=dirname(resolve(ae,this.mapOpts.annotation)));let ve=relative(ae,Z);return this.memoizedPaths.set(Z,ve),ve}previous(){if(!this.previousMaps)if(this.previousMaps=[],this.root)this.root.walk(Z=>{if(Z.source&&Z.source.input.map){let ee=Z.source.input.map;this.previousMaps.includes(ee)||this.previousMaps.push(ee)}});else{let Z=new Input$3(this.originalCSS,this.opts);Z.map&&this.previousMaps.push(Z.map)}return this.previousMaps}setSourcesContent(){let Z={};if(this.root)this.root.walk(ee=>{if(ee.source){let ae=ee.source.input.from;if(ae&&!Z[ae]){Z[ae]=!0;let ve=this.usesFileUrls?this.toFileUrl(ae):this.toUrl(this.path(ae));this.map.setSourceContent(ve,ee.source.input.css)}}});else if(this.css){let ee=this.opts.from?this.toUrl(this.path(this.opts.from)):"<no source>";this.map.setSourceContent(ee,this.css)}}sourcePath(Z){return this.mapOpts.from?this.toUrl(this.mapOpts.from):this.usesFileUrls?this.toFileUrl(Z.source.input.from):this.toUrl(this.path(Z.source.input.from))}toBase64(Z){return Buffer?Buffer.from(Z).toString("base64"):window.btoa(unescape(encodeURIComponent(Z)))}toFileUrl(Z){let ee=this.memoizedFileURLs.get(Z);if(ee)return ee;if(pathToFileURL){let ae=pathToFileURL(Z).toString();return this.memoizedFileURLs.set(Z,ae),ae}else throw new Error("`map.absolute` option is not available in this PostCSS build")}toUrl(Z){let ee=this.memoizedURLs.get(Z);if(ee)return ee;sep==="\\"&&(Z=Z.replace(/\\/g,"/"));let ae=encodeURI(Z).replace(/[#?]/g,encodeURIComponent);return this.memoizedURLs.set(Z,ae),ae}};var mapGenerator=MapGenerator$2;let Node$3=node,Comment$4=class extends Node$3{constructor(Z){super(Z),this.type="comment"}};var comment=Comment$4;Comment$4.default=Comment$4;let{isClean:isClean$1,my:my$1}=symbols,Declaration$3=declaration,Comment$3=comment,Node$2=node,parse$8,Rule$4,AtRule$4,Root$6;function cleanSource(ie){return ie.map(Z=>(Z.nodes&&(Z.nodes=cleanSource(Z.nodes)),delete Z.source,Z))}function markDirtyUp(ie){if(ie[isClean$1]=!1,ie.proxyOf.nodes)for(let Z of ie.proxyOf.nodes)markDirtyUp(Z)}let Container$7=class Ji extends Node$2{append(...Z){for(let ee of Z){let ae=this.normalize(ee,this.last);for(let ve of ae)this.proxyOf.nodes.push(ve)}return this.markDirty(),this}cleanRaws(Z){if(super.cleanRaws(Z),this.nodes)for(let ee of this.nodes)ee.cleanRaws(Z)}each(Z){if(!this.proxyOf.nodes)return;let ee=this.getIterator(),ae,ve;for(;this.indexes[ee]<this.proxyOf.nodes.length&&(ae=this.indexes[ee],ve=Z(this.proxyOf.nodes[ae],ae),ve!==!1);)this.indexes[ee]+=1;return delete this.indexes[ee],ve}every(Z){return this.nodes.every(Z)}getIterator(){this.lastEach||(this.lastEach=0),this.indexes||(this.indexes={}),this.lastEach+=1;let Z=this.lastEach;return this.indexes[Z]=0,Z}getProxyProcessor(){return{get(Z,ee){return ee==="proxyOf"?Z:Z[ee]?ee==="each"||typeof ee=="string"&&ee.startsWith("walk")?(...ae)=>Z[ee](...ae.map(ve=>typeof ve=="function"?(ye,be)=>ve(ye.toProxy(),be):ve)):ee==="every"||ee==="some"?ae=>Z[ee]((ve,...ye)=>ae(ve.toProxy(),...ye)):ee==="root"?()=>Z.root().toProxy():ee==="nodes"?Z.nodes.map(ae=>ae.toProxy()):ee==="first"||ee==="last"?Z[ee].toProxy():Z[ee]:Z[ee]},set(Z,ee,ae){return Z[ee]===ae||(Z[ee]=ae,(ee==="name"||ee==="params"||ee==="selector")&&Z.markDirty()),!0}}}index(Z){return typeof Z=="number"?Z:(Z.proxyOf&&(Z=Z.proxyOf),this.proxyOf.nodes.indexOf(Z))}insertAfter(Z,ee){let ae=this.index(Z),ve=this.normalize(ee,this.proxyOf.nodes[ae]).reverse();ae=this.index(Z);for(let be of ve)this.proxyOf.nodes.splice(ae+1,0,be);let ye;for(let be in this.indexes)ye=this.indexes[be],ae<ye&&(this.indexes[be]=ye+ve.length);return this.markDirty(),this}insertBefore(Z,ee){let ae=this.index(Z),ve=ae===0?"prepend":!1,ye=this.normalize(ee,this.proxyOf.nodes[ae],ve).reverse();ae=this.index(Z);for(let Ke of ye)this.proxyOf.nodes.splice(ae,0,Ke);let be;for(let Ke in this.indexes)be=this.indexes[Ke],ae<=be&&(this.indexes[Ke]=be+ye.length);return this.markDirty(),this}normalize(Z,ee){if(typeof Z=="string")Z=cleanSource(parse$8(Z).nodes);else if(typeof Z>"u")Z=[];else if(Array.isArray(Z)){Z=Z.slice(0);for(let ve of Z)ve.parent&&ve.parent.removeChild(ve,"ignore")}else if(Z.type==="root"&&this.type!=="document"){Z=Z.nodes.slice(0);for(let ve of Z)ve.parent&&ve.parent.removeChild(ve,"ignore")}else if(Z.type)Z=[Z];else if(Z.prop){if(typeof Z.value>"u")throw new Error("Value field is missed in node creation");typeof Z.value!="string"&&(Z.value=String(Z.value)),Z=[new Declaration$3(Z)]}else if(Z.selector)Z=[new Rule$4(Z)];else if(Z.name)Z=[new AtRule$4(Z)];else if(Z.text)Z=[new Comment$3(Z)];else throw new Error("Unknown node type in node creation");return Z.map(ve=>(ve[my$1]||Ji.rebuild(ve),ve=ve.proxyOf,ve.parent&&ve.parent.removeChild(ve),ve[isClean$1]&&markDirtyUp(ve),typeof ve.raws.before>"u"&&ee&&typeof ee.raws.before<"u"&&(ve.raws.before=ee.raws.before.replace(/\S/g,"")),ve.parent=this.proxyOf,ve))}prepend(...Z){Z=Z.reverse();for(let ee of Z){let ae=this.normalize(ee,this.first,"prepend").reverse();for(let ve of ae)this.proxyOf.nodes.unshift(ve);for(let ve in this.indexes)this.indexes[ve]=this.indexes[ve]+ae.length}return this.markDirty(),this}push(Z){return Z.parent=this,this.proxyOf.nodes.push(Z),this}removeAll(){for(let Z of this.proxyOf.nodes)Z.parent=void 0;return this.proxyOf.nodes=[],this.markDirty(),this}removeChild(Z){Z=this.index(Z),this.proxyOf.nodes[Z].parent=void 0,this.proxyOf.nodes.splice(Z,1);let ee;for(let ae in this.indexes)ee=this.indexes[ae],ee>=Z&&(this.indexes[ae]=ee-1);return this.markDirty(),this}replaceValues(Z,ee,ae){return ae||(ae=ee,ee={}),this.walkDecls(ve=>{ee.props&&!ee.props.includes(ve.prop)||ee.fast&&!ve.value.includes(ee.fast)||(ve.value=ve.value.replace(Z,ae))}),this.markDirty(),this}some(Z){return this.nodes.some(Z)}walk(Z){return this.each((ee,ae)=>{let ve;try{ve=Z(ee,ae)}catch(ye){throw ee.addToError(ye)}return ve!==!1&&ee.walk&&(ve=ee.walk(Z)),ve})}walkAtRules(Z,ee){return ee?Z instanceof RegExp?this.walk((ae,ve)=>{if(ae.type==="atrule"&&Z.test(ae.name))return ee(ae,ve)}):this.walk((ae,ve)=>{if(ae.type==="atrule"&&ae.name===Z)return ee(ae,ve)}):(ee=Z,this.walk((ae,ve)=>{if(ae.type==="atrule")return ee(ae,ve)}))}walkComments(Z){return this.walk((ee,ae)=>{if(ee.type==="comment")return Z(ee,ae)})}walkDecls(Z,ee){return ee?Z instanceof RegExp?this.walk((ae,ve)=>{if(ae.type==="decl"&&Z.test(ae.prop))return ee(ae,ve)}):this.walk((ae,ve)=>{if(ae.type==="decl"&&ae.prop===Z)return ee(ae,ve)}):(ee=Z,this.walk((ae,ve)=>{if(ae.type==="decl")return ee(ae,ve)}))}walkRules(Z,ee){return ee?Z instanceof RegExp?this.walk((ae,ve)=>{if(ae.type==="rule"&&Z.test(ae.selector))return ee(ae,ve)}):this.walk((ae,ve)=>{if(ae.type==="rule"&&ae.selector===Z)return ee(ae,ve)}):(ee=Z,this.walk((ae,ve)=>{if(ae.type==="rule")return ee(ae,ve)}))}get first(){if(this.proxyOf.nodes)return this.proxyOf.nodes[0]}get last(){if(this.proxyOf.nodes)return this.proxyOf.nodes[this.proxyOf.nodes.length-1]}};Container$7.registerParse=ie=>{parse$8=ie};Container$7.registerRule=ie=>{Rule$4=ie};Container$7.registerAtRule=ie=>{AtRule$4=ie};Container$7.registerRoot=ie=>{Root$6=ie};var container=Container$7;Container$7.default=Container$7;Container$7.rebuild=ie=>{ie.type==="atrule"?Object.setPrototypeOf(ie,AtRule$4.prototype):ie.type==="rule"?Object.setPrototypeOf(ie,Rule$4.prototype):ie.type==="decl"?Object.setPrototypeOf(ie,Declaration$3.prototype):ie.type==="comment"?Object.setPrototypeOf(ie,Comment$3.prototype):ie.type==="root"&&Object.setPrototypeOf(ie,Root$6.prototype),ie[my$1]=!0,ie.nodes&&ie.nodes.forEach(Z=>{Container$7.rebuild(Z)})};let Container$6=container,LazyResult$4,Processor$3,Document$3=class extends Container$6{constructor(Z){super({type:"document",...Z}),this.nodes||(this.nodes=[])}toResult(Z={}){return new LazyResult$4(new Processor$3,this,Z).stringify()}};Document$3.registerLazyResult=ie=>{LazyResult$4=ie};Document$3.registerProcessor=ie=>{Processor$3=ie};var document$1=Document$3;Document$3.default=Document$3;let Warning$2=class{constructor(Z,ee={}){if(this.type="warning",this.text=Z,ee.node&&ee.node.source){let ae=ee.node.rangeBy(ee);this.line=ae.start.line,this.column=ae.start.column,this.endLine=ae.end.line,this.endColumn=ae.end.column}for(let ae in ee)this[ae]=ee[ae]}toString(){return this.node?this.node.error(this.text,{index:this.index,plugin:this.plugin,word:this.word}).message:this.plugin?this.plugin+": "+this.text:this.text}};var warning=Warning$2;Warning$2.default=Warning$2;let Warning$1=warning,Result$3=class{constructor(Z,ee,ae){this.processor=Z,this.messages=[],this.root=ee,this.opts=ae,this.css=void 0,this.map=void 0}toString(){return this.css}warn(Z,ee={}){ee.plugin||this.lastPlugin&&this.lastPlugin.postcssPlugin&&(ee.plugin=this.lastPlugin.postcssPlugin);let ae=new Warning$1(Z,ee);return this.messages.push(ae),ae}warnings(){return this.messages.filter(Z=>Z.type==="warning")}get content(){return this.css}};var result=Result$3;Result$3.default=Result$3;const SINGLE_QUOTE=39,DOUBLE_QUOTE=34,BACKSLASH=92,SLASH=47,NEWLINE=10,SPACE=32,FEED=12,TAB=9,CR=13,OPEN_SQUARE=91,CLOSE_SQUARE=93,OPEN_PARENTHESES=40,CLOSE_PARENTHESES=41,OPEN_CURLY=123,CLOSE_CURLY=125,SEMICOLON=59,ASTERISK=42,COLON=58,AT=64,RE_AT_END=/[\t\n\f\r "#'()/;[\\\]{}]/g,RE_WORD_END=/[\t\n\f\r !"#'():;@[\\\]{}]|\/(?=\*)/g,RE_BAD_BRACKET=/.[\r\n"'(/\\]/,RE_HEX_ESCAPE=/[\da-f]/i;var tokenize=function(Z,ee={}){let ae=Z.css.valueOf(),ve=ee.ignoreErrors,ye,be,Ke,Ye,Xe,Qe,et,Je,rt,it,nt=ae.length,tt=0,st=[],ot=[];function ut(){return tt}function ft(Yr){throw Z.error("Unclosed "+Yr,tt)}function pt(){return ot.length===0&&tt>=nt}function Xr(Yr){if(ot.length)return ot.pop();if(tt>=nt)return;let ri=Yr?Yr.ignoreUnclosed:!1;switch(ye=ae.charCodeAt(tt),ye){case NEWLINE:case SPACE:case TAB:case CR:case FEED:{be=tt;do be+=1,ye=ae.charCodeAt(be);while(ye===SPACE||ye===NEWLINE||ye===TAB||ye===CR||ye===FEED);it=["space",ae.slice(tt,be)],tt=be-1;break}case OPEN_SQUARE:case CLOSE_SQUARE:case OPEN_CURLY:case CLOSE_CURLY:case COLON:case SEMICOLON:case CLOSE_PARENTHESES:{let Zr=String.fromCharCode(ye);it=[Zr,Zr,tt];break}case OPEN_PARENTHESES:{if(Je=st.length?st.pop()[1]:"",rt=ae.charCodeAt(tt+1),Je==="url"&&rt!==SINGLE_QUOTE&&rt!==DOUBLE_QUOTE&&rt!==SPACE&&rt!==NEWLINE&&rt!==TAB&&rt!==FEED&&rt!==CR){be=tt;do{if(Qe=!1,be=ae.indexOf(")",be+1),be===-1)if(ve||ri){be=tt;break}else ft("bracket");for(et=be;ae.charCodeAt(et-1)===BACKSLASH;)et-=1,Qe=!Qe}while(Qe);it=["brackets",ae.slice(tt,be+1),tt,be],tt=be}else be=ae.indexOf(")",tt+1),Ye=ae.slice(tt,be+1),be===-1||RE_BAD_BRACKET.test(Ye)?it=["(","(",tt]:(it=["brackets",Ye,tt,be],tt=be);break}case SINGLE_QUOTE:case DOUBLE_QUOTE:{Ke=ye===SINGLE_QUOTE?"'":'"',be=tt;do{if(Qe=!1,be=ae.indexOf(Ke,be+1),be===-1)if(ve||ri){be=tt+1;break}else ft("string");for(et=be;ae.charCodeAt(et-1)===BACKSLASH;)et-=1,Qe=!Qe}while(Qe);it=["string",ae.slice(tt,be+1),tt,be],tt=be;break}case AT:{RE_AT_END.lastIndex=tt+1,RE_AT_END.test(ae),RE_AT_END.lastIndex===0?be=ae.length-1:be=RE_AT_END.lastIndex-2,it=["at-word",ae.slice(tt,be+1),tt,be],tt=be;break}case BACKSLASH:{for(be=tt,Xe=!0;ae.charCodeAt(be+1)===BACKSLASH;)be+=1,Xe=!Xe;if(ye=ae.charCodeAt(be+1),Xe&&ye!==SLASH&&ye!==SPACE&&ye!==NEWLINE&&ye!==TAB&&ye!==CR&&ye!==FEED&&(be+=1,RE_HEX_ESCAPE.test(ae.charAt(be)))){for(;RE_HEX_ESCAPE.test(ae.charAt(be+1));)be+=1;ae.charCodeAt(be+1)===SPACE&&(be+=1)}it=["word",ae.slice(tt,be+1),tt,be],tt=be;break}default:{ye===SLASH&&ae.charCodeAt(tt+1)===ASTERISK?(be=ae.indexOf("*/",tt+2)+1,be===0&&(ve||ri?be=ae.length:ft("comment")),it=["comment",ae.slice(tt,be+1),tt,be],tt=be):(RE_WORD_END.lastIndex=tt+1,RE_WORD_END.test(ae),RE_WORD_END.lastIndex===0?be=ae.length-1:be=RE_WORD_END.lastIndex-2,it=["word",ae.slice(tt,be+1),tt,be],st.push(it),tt=be);break}}return tt++,it}function mt(Yr){ot.push(Yr)}return{back:mt,endOfFile:pt,nextToken:Xr,position:ut}};let Container$5=container,AtRule$3=class extends Container$5{constructor(Z){super(Z),this.type="atrule"}append(...Z){return this.proxyOf.nodes||(this.nodes=[]),super.append(...Z)}prepend(...Z){return this.proxyOf.nodes||(this.nodes=[]),super.prepend(...Z)}};var atRule=AtRule$3;AtRule$3.default=AtRule$3;Container$5.registerAtRule(AtRule$3);let Container$4=container,LazyResult$3,Processor$2,Root$5=class extends Container$4{constructor(Z){super(Z),this.type="root",this.nodes||(this.nodes=[])}normalize(Z,ee,ae){let ve=super.normalize(Z);if(ee){if(ae==="prepend")this.nodes.length>1?ee.raws.before=this.nodes[1].raws.before:delete ee.raws.before;else if(this.first!==ee)for(let ye of ve)ye.raws.before=ee.raws.before}return ve}removeChild(Z,ee){let ae=this.index(Z);return!ee&&ae===0&&this.nodes.length>1&&(this.nodes[1].raws.before=this.nodes[ae].raws.before),super.removeChild(Z)}toResult(Z={}){return new LazyResult$3(new Processor$2,this,Z).stringify()}};Root$5.registerLazyResult=ie=>{LazyResult$3=ie};Root$5.registerProcessor=ie=>{Processor$2=ie};var root=Root$5;Root$5.default=Root$5;Container$4.registerRoot(Root$5);let list$2={comma(ie){return list$2.split(ie,[","],!0)},space(ie){let Z=[" ",`
`,"	"];return list$2.split(ie,Z)},split(ie,Z,ee){let ae=[],ve="",ye=!1,be=0,Ke=!1,Ye="",Xe=!1;for(let Qe of ie)Xe?Xe=!1:Qe==="\\"?Xe=!0:Ke?Qe===Ye&&(Ke=!1):Qe==='"'||Qe==="'"?(Ke=!0,Ye=Qe):Qe==="("?be+=1:Qe===")"?be>0&&(be-=1):be===0&&Z.includes(Qe)&&(ye=!0),ye?(ve!==""&&ae.push(ve.trim()),ve="",ye=!1):ve+=Qe;return(ee||ve!=="")&&ae.push(ve.trim()),ae}};var list_1=list$2;list$2.default=list$2;let Container$3=container,list$1=list_1,Rule$3=class extends Container$3{constructor(Z){super(Z),this.type="rule",this.nodes||(this.nodes=[])}get selectors(){return list$1.comma(this.selector)}set selectors(Z){let ee=this.selector?this.selector.match(/,\s*/):null,ae=ee?ee[0]:","+this.raw("between","beforeOpen");this.selector=Z.join(ae)}};var rule=Rule$3;Rule$3.default=Rule$3;Container$3.registerRule(Rule$3);let Declaration$2=declaration,tokenizer=tokenize,Comment$2=comment,AtRule$2=atRule,Root$4=root,Rule$2=rule;const SAFE_COMMENT_NEIGHBOR={empty:!0,space:!0};function findLastWithPosition(ie){for(let Z=ie.length-1;Z>=0;Z--){let ee=ie[Z],ae=ee[3]||ee[2];if(ae)return ae}}let Parser$1=class{constructor(Z){this.input=Z,this.root=new Root$4,this.current=this.root,this.spaces="",this.semicolon=!1,this.createTokenizer(),this.root.source={input:Z,start:{column:1,line:1,offset:0}}}atrule(Z){let ee=new AtRule$2;ee.name=Z[1].slice(1),ee.name===""&&this.unnamedAtrule(ee,Z),this.init(ee,Z[2]);let ae,ve,ye,be=!1,Ke=!1,Ye=[],Xe=[];for(;!this.tokenizer.endOfFile();){if(Z=this.tokenizer.nextToken(),ae=Z[0],ae==="("||ae==="["?Xe.push(ae==="("?")":"]"):ae==="{"&&Xe.length>0?Xe.push("}"):ae===Xe[Xe.length-1]&&Xe.pop(),Xe.length===0)if(ae===";"){ee.source.end=this.getPosition(Z[2]),ee.source.end.offset++,this.semicolon=!0;break}else if(ae==="{"){Ke=!0;break}else if(ae==="}"){if(Ye.length>0){for(ye=Ye.length-1,ve=Ye[ye];ve&&ve[0]==="space";)ve=Ye[--ye];ve&&(ee.source.end=this.getPosition(ve[3]||ve[2]),ee.source.end.offset++)}this.end(Z);break}else Ye.push(Z);else Ye.push(Z);if(this.tokenizer.endOfFile()){be=!0;break}}ee.raws.between=this.spacesAndCommentsFromEnd(Ye),Ye.length?(ee.raws.afterName=this.spacesAndCommentsFromStart(Ye),this.raw(ee,"params",Ye),be&&(Z=Ye[Ye.length-1],ee.source.end=this.getPosition(Z[3]||Z[2]),ee.source.end.offset++,this.spaces=ee.raws.between,ee.raws.between="")):(ee.raws.afterName="",ee.params=""),Ke&&(ee.nodes=[],this.current=ee)}checkMissedSemicolon(Z){let ee=this.colon(Z);if(ee===!1)return;let ae=0,ve;for(let ye=ee-1;ye>=0&&(ve=Z[ye],!(ve[0]!=="space"&&(ae+=1,ae===2)));ye--);throw this.input.error("Missed semicolon",ve[0]==="word"?ve[3]+1:ve[2])}colon(Z){let ee=0,ae,ve,ye;for(let[be,Ke]of Z.entries()){if(ae=Ke,ve=ae[0],ve==="("&&(ee+=1),ve===")"&&(ee-=1),ee===0&&ve===":")if(!ye)this.doubleColon(ae);else{if(ye[0]==="word"&&ye[1]==="progid")continue;return be}ye=ae}return!1}comment(Z){let ee=new Comment$2;this.init(ee,Z[2]),ee.source.end=this.getPosition(Z[3]||Z[2]),ee.source.end.offset++;let ae=Z[1].slice(2,-2);if(/^\s*$/.test(ae))ee.text="",ee.raws.left=ae,ee.raws.right="";else{let ve=ae.match(/^(\s*)([^]*\S)(\s*)$/);ee.text=ve[2],ee.raws.left=ve[1],ee.raws.right=ve[3]}}createTokenizer(){this.tokenizer=tokenizer(this.input)}decl(Z,ee){let ae=new Declaration$2;this.init(ae,Z[0][2]);let ve=Z[Z.length-1];for(ve[0]===";"&&(this.semicolon=!0,Z.pop()),ae.source.end=this.getPosition(ve[3]||ve[2]||findLastWithPosition(Z)),ae.source.end.offset++;Z[0][0]!=="word";)Z.length===1&&this.unknownWord(Z),ae.raws.before+=Z.shift()[1];for(ae.source.start=this.getPosition(Z[0][2]),ae.prop="";Z.length;){let Xe=Z[0][0];if(Xe===":"||Xe==="space"||Xe==="comment")break;ae.prop+=Z.shift()[1]}ae.raws.between="";let ye;for(;Z.length;)if(ye=Z.shift(),ye[0]===":"){ae.raws.between+=ye[1];break}else ye[0]==="word"&&/\w/.test(ye[1])&&this.unknownWord([ye]),ae.raws.between+=ye[1];(ae.prop[0]==="_"||ae.prop[0]==="*")&&(ae.raws.before+=ae.prop[0],ae.prop=ae.prop.slice(1));let be=[],Ke;for(;Z.length&&(Ke=Z[0][0],!(Ke!=="space"&&Ke!=="comment"));)be.push(Z.shift());this.precheckMissedSemicolon(Z);for(let Xe=Z.length-1;Xe>=0;Xe--){if(ye=Z[Xe],ye[1].toLowerCase()==="!important"){ae.important=!0;let Qe=this.stringFrom(Z,Xe);Qe=this.spacesFromEnd(Z)+Qe,Qe!==" !important"&&(ae.raws.important=Qe);break}else if(ye[1].toLowerCase()==="important"){let Qe=Z.slice(0),et="";for(let Je=Xe;Je>0;Je--){let rt=Qe[Je][0];if(et.trim().indexOf("!")===0&&rt!=="space")break;et=Qe.pop()[1]+et}et.trim().indexOf("!")===0&&(ae.important=!0,ae.raws.important=et,Z=Qe)}if(ye[0]!=="space"&&ye[0]!=="comment")break}Z.some(Xe=>Xe[0]!=="space"&&Xe[0]!=="comment")&&(ae.raws.between+=be.map(Xe=>Xe[1]).join(""),be=[]),this.raw(ae,"value",be.concat(Z),ee),ae.value.includes(":")&&!ee&&this.checkMissedSemicolon(Z)}doubleColon(Z){throw this.input.error("Double colon",{offset:Z[2]},{offset:Z[2]+Z[1].length})}emptyRule(Z){let ee=new Rule$2;this.init(ee,Z[2]),ee.selector="",ee.raws.between="",this.current=ee}end(Z){this.current.nodes&&this.current.nodes.length&&(this.current.raws.semicolon=this.semicolon),this.semicolon=!1,this.current.raws.after=(this.current.raws.after||"")+this.spaces,this.spaces="",this.current.parent?(this.current.source.end=this.getPosition(Z[2]),this.current.source.end.offset++,this.current=this.current.parent):this.unexpectedClose(Z)}endFile(){this.current.parent&&this.unclosedBlock(),this.current.nodes&&this.current.nodes.length&&(this.current.raws.semicolon=this.semicolon),this.current.raws.after=(this.current.raws.after||"")+this.spaces,this.root.source.end=this.getPosition(this.tokenizer.position())}freeSemicolon(Z){if(this.spaces+=Z[1],this.current.nodes){let ee=this.current.nodes[this.current.nodes.length-1];ee&&ee.type==="rule"&&!ee.raws.ownSemicolon&&(ee.raws.ownSemicolon=this.spaces,this.spaces="")}}getPosition(Z){let ee=this.input.fromOffset(Z);return{column:ee.col,line:ee.line,offset:Z}}init(Z,ee){this.current.push(Z),Z.source={input:this.input,start:this.getPosition(ee)},Z.raws.before=this.spaces,this.spaces="",Z.type!=="comment"&&(this.semicolon=!1)}other(Z){let ee=!1,ae=null,ve=!1,ye=null,be=[],Ke=Z[1].startsWith("--"),Ye=[],Xe=Z;for(;Xe;){if(ae=Xe[0],Ye.push(Xe),ae==="("||ae==="[")ye||(ye=Xe),be.push(ae==="("?")":"]");else if(Ke&&ve&&ae==="{")ye||(ye=Xe),be.push("}");else if(be.length===0)if(ae===";")if(ve){this.decl(Ye,Ke);return}else break;else if(ae==="{"){this.rule(Ye);return}else if(ae==="}"){this.tokenizer.back(Ye.pop()),ee=!0;break}else ae===":"&&(ve=!0);else ae===be[be.length-1]&&(be.pop(),be.length===0&&(ye=null));Xe=this.tokenizer.nextToken()}if(this.tokenizer.endOfFile()&&(ee=!0),be.length>0&&this.unclosedBracket(ye),ee&&ve){if(!Ke)for(;Ye.length&&(Xe=Ye[Ye.length-1][0],!(Xe!=="space"&&Xe!=="comment"));)this.tokenizer.back(Ye.pop());this.decl(Ye,Ke)}else this.unknownWord(Ye)}parse(){let Z;for(;!this.tokenizer.endOfFile();)switch(Z=this.tokenizer.nextToken(),Z[0]){case"space":this.spaces+=Z[1];break;case";":this.freeSemicolon(Z);break;case"}":this.end(Z);break;case"comment":this.comment(Z);break;case"at-word":this.atrule(Z);break;case"{":this.emptyRule(Z);break;default:this.other(Z);break}this.endFile()}precheckMissedSemicolon(){}raw(Z,ee,ae,ve){let ye,be,Ke=ae.length,Ye="",Xe=!0,Qe,et;for(let Je=0;Je<Ke;Je+=1)ye=ae[Je],be=ye[0],be==="space"&&Je===Ke-1&&!ve?Xe=!1:be==="comment"?(et=ae[Je-1]?ae[Je-1][0]:"empty",Qe=ae[Je+1]?ae[Je+1][0]:"empty",!SAFE_COMMENT_NEIGHBOR[et]&&!SAFE_COMMENT_NEIGHBOR[Qe]?Ye.slice(-1)===","?Xe=!1:Ye+=ye[1]:Xe=!1):Ye+=ye[1];if(!Xe){let Je=ae.reduce((rt,it)=>rt+it[1],"");Z.raws[ee]={raw:Je,value:Ye}}Z[ee]=Ye}rule(Z){Z.pop();let ee=new Rule$2;this.init(ee,Z[0][2]),ee.raws.between=this.spacesAndCommentsFromEnd(Z),this.raw(ee,"selector",Z),this.current=ee}spacesAndCommentsFromEnd(Z){let ee,ae="";for(;Z.length&&(ee=Z[Z.length-1][0],!(ee!=="space"&&ee!=="comment"));)ae=Z.pop()[1]+ae;return ae}spacesAndCommentsFromStart(Z){let ee,ae="";for(;Z.length&&(ee=Z[0][0],!(ee!=="space"&&ee!=="comment"));)ae+=Z.shift()[1];return ae}spacesFromEnd(Z){let ee,ae="";for(;Z.length&&(ee=Z[Z.length-1][0],ee==="space");)ae=Z.pop()[1]+ae;return ae}stringFrom(Z,ee){let ae="";for(let ve=ee;ve<Z.length;ve++)ae+=Z[ve][1];return Z.splice(ee,Z.length-ee),ae}unclosedBlock(){let Z=this.current.source.start;throw this.input.error("Unclosed block",Z.line,Z.column)}unclosedBracket(Z){throw this.input.error("Unclosed bracket",{offset:Z[2]},{offset:Z[2]+1})}unexpectedClose(Z){throw this.input.error("Unexpected }",{offset:Z[2]},{offset:Z[2]+1})}unknownWord(Z){throw this.input.error("Unknown word",{offset:Z[0][2]},{offset:Z[0][2]+Z[0][1].length})}unnamedAtrule(Z,ee){throw this.input.error("At-rule without name",{offset:ee[2]},{offset:ee[2]+ee[1].length})}};var parser$1=Parser$1;let Container$2=container,Parser=parser$1,Input$2=input;function parse$7(ie,Z){let ee=new Input$2(ie,Z),ae=new Parser(ee);try{ae.parse()}catch(ve){throw ve}return ae.root}var parse_1=parse$7;parse$7.default=parse$7;Container$2.registerParse(parse$7);let{isClean,my}=symbols,MapGenerator$1=mapGenerator,stringify$2=stringify_1,Container$1=container,Document$2=document$1,Result$2=result,parse$6=parse_1,Root$3=root;const TYPE_TO_CLASS_NAME={atrule:"AtRule",comment:"Comment",decl:"Declaration",document:"Document",root:"Root",rule:"Rule"},PLUGIN_PROPS={AtRule:!0,AtRuleExit:!0,Comment:!0,CommentExit:!0,Declaration:!0,DeclarationExit:!0,Document:!0,DocumentExit:!0,Once:!0,OnceExit:!0,postcssPlugin:!0,prepare:!0,Root:!0,RootExit:!0,Rule:!0,RuleExit:!0},NOT_VISITORS={Once:!0,postcssPlugin:!0,prepare:!0},CHILDREN=0;function isPromise$1(ie){return typeof ie=="object"&&typeof ie.then=="function"}function getEvents(ie){let Z=!1,ee=TYPE_TO_CLASS_NAME[ie.type];return ie.type==="decl"?Z=ie.prop.toLowerCase():ie.type==="atrule"&&(Z=ie.name.toLowerCase()),Z&&ie.append?[ee,ee+"-"+Z,CHILDREN,ee+"Exit",ee+"Exit-"+Z]:Z?[ee,ee+"-"+Z,ee+"Exit",ee+"Exit-"+Z]:ie.append?[ee,CHILDREN,ee+"Exit"]:[ee,ee+"Exit"]}function toStack(ie){let Z;return ie.type==="document"?Z=["Document",CHILDREN,"DocumentExit"]:ie.type==="root"?Z=["Root",CHILDREN,"RootExit"]:Z=getEvents(ie),{eventIndex:0,events:Z,iterator:0,node:ie,visitorIndex:0,visitors:[]}}function cleanMarks(ie){return ie[isClean]=!1,ie.nodes&&ie.nodes.forEach(Z=>cleanMarks(Z)),ie}let postcss$1={},LazyResult$2=class es{constructor(Z,ee,ae){this.stringified=!1,this.processed=!1;let ve;if(typeof ee=="object"&&ee!==null&&(ee.type==="root"||ee.type==="document"))ve=cleanMarks(ee);else if(ee instanceof es||ee instanceof Result$2)ve=cleanMarks(ee.root),ee.map&&(typeof ae.map>"u"&&(ae.map={}),ae.map.inline||(ae.map.inline=!1),ae.map.prev=ee.map);else{let ye=parse$6;ae.syntax&&(ye=ae.syntax.parse),ae.parser&&(ye=ae.parser),ye.parse&&(ye=ye.parse);try{ve=ye(ee,ae)}catch(be){this.processed=!0,this.error=be}ve&&!ve[my]&&Container$1.rebuild(ve)}this.result=new Result$2(Z,ve,ae),this.helpers={...postcss$1,postcss:postcss$1,result:this.result},this.plugins=this.processor.plugins.map(ye=>typeof ye=="object"&&ye.prepare?{...ye,...ye.prepare(this.result)}:ye)}async(){return this.error?Promise.reject(this.error):this.processed?Promise.resolve(this.result):(this.processing||(this.processing=this.runAsync()),this.processing)}catch(Z){return this.async().catch(Z)}finally(Z){return this.async().then(Z,Z)}getAsyncError(){throw new Error("Use process(css).then(cb) to work with async plugins")}handleError(Z,ee){let ae=this.result.lastPlugin;try{ee&&ee.addToError(Z),this.error=Z,Z.name==="CssSyntaxError"&&!Z.plugin?(Z.plugin=ae.postcssPlugin,Z.setMessage()):ae.postcssVersion}catch(ve){console&&console.error&&console.error(ve)}return Z}prepareVisitors(){this.listeners={};let Z=(ee,ae,ve)=>{this.listeners[ae]||(this.listeners[ae]=[]),this.listeners[ae].push([ee,ve])};for(let ee of this.plugins)if(typeof ee=="object")for(let ae in ee){if(!PLUGIN_PROPS[ae]&&/^[A-Z]/.test(ae))throw new Error(`Unknown event ${ae} in ${ee.postcssPlugin}. Try to update PostCSS (${this.processor.version} now).`);if(!NOT_VISITORS[ae])if(typeof ee[ae]=="object")for(let ve in ee[ae])ve==="*"?Z(ee,ae,ee[ae][ve]):Z(ee,ae+"-"+ve.toLowerCase(),ee[ae][ve]);else typeof ee[ae]=="function"&&Z(ee,ae,ee[ae])}this.hasListener=Object.keys(this.listeners).length>0}async runAsync(){this.plugin=0;for(let Z=0;Z<this.plugins.length;Z++){let ee=this.plugins[Z],ae=this.runOnRoot(ee);if(isPromise$1(ae))try{await ae}catch(ve){throw this.handleError(ve)}}if(this.prepareVisitors(),this.hasListener){let Z=this.result.root;for(;!Z[isClean];){Z[isClean]=!0;let ee=[toStack(Z)];for(;ee.length>0;){let ae=this.visitTick(ee);if(isPromise$1(ae))try{await ae}catch(ve){let ye=ee[ee.length-1].node;throw this.handleError(ve,ye)}}}if(this.listeners.OnceExit)for(let[ee,ae]of this.listeners.OnceExit){this.result.lastPlugin=ee;try{if(Z.type==="document"){let ve=Z.nodes.map(ye=>ae(ye,this.helpers));await Promise.all(ve)}else await ae(Z,this.helpers)}catch(ve){throw this.handleError(ve)}}}return this.processed=!0,this.stringify()}runOnRoot(Z){this.result.lastPlugin=Z;try{if(typeof Z=="object"&&Z.Once){if(this.result.root.type==="document"){let ee=this.result.root.nodes.map(ae=>Z.Once(ae,this.helpers));return isPromise$1(ee[0])?Promise.all(ee):ee}return Z.Once(this.result.root,this.helpers)}else if(typeof Z=="function")return Z(this.result.root,this.result)}catch(ee){throw this.handleError(ee)}}stringify(){if(this.error)throw this.error;if(this.stringified)return this.result;this.stringified=!0,this.sync();let Z=this.result.opts,ee=stringify$2;Z.syntax&&(ee=Z.syntax.stringify),Z.stringifier&&(ee=Z.stringifier),ee.stringify&&(ee=ee.stringify);let ve=new MapGenerator$1(ee,this.result.root,this.result.opts).generate();return this.result.css=ve[0],this.result.map=ve[1],this.result}sync(){if(this.error)throw this.error;if(this.processed)return this.result;if(this.processed=!0,this.processing)throw this.getAsyncError();for(let Z of this.plugins){let ee=this.runOnRoot(Z);if(isPromise$1(ee))throw this.getAsyncError()}if(this.prepareVisitors(),this.hasListener){let Z=this.result.root;for(;!Z[isClean];)Z[isClean]=!0,this.walkSync(Z);if(this.listeners.OnceExit)if(Z.type==="document")for(let ee of Z.nodes)this.visitSync(this.listeners.OnceExit,ee);else this.visitSync(this.listeners.OnceExit,Z)}return this.result}then(Z,ee){return this.async().then(Z,ee)}toString(){return this.css}visitSync(Z,ee){for(let[ae,ve]of Z){this.result.lastPlugin=ae;let ye;try{ye=ve(ee,this.helpers)}catch(be){throw this.handleError(be,ee.proxyOf)}if(ee.type!=="root"&&ee.type!=="document"&&!ee.parent)return!0;if(isPromise$1(ye))throw this.getAsyncError()}}visitTick(Z){let ee=Z[Z.length-1],{node:ae,visitors:ve}=ee;if(ae.type!=="root"&&ae.type!=="document"&&!ae.parent){Z.pop();return}if(ve.length>0&&ee.visitorIndex<ve.length){let[be,Ke]=ve[ee.visitorIndex];ee.visitorIndex+=1,ee.visitorIndex===ve.length&&(ee.visitors=[],ee.visitorIndex=0),this.result.lastPlugin=be;try{return Ke(ae.toProxy(),this.helpers)}catch(Ye){throw this.handleError(Ye,ae)}}if(ee.iterator!==0){let be=ee.iterator,Ke;for(;Ke=ae.nodes[ae.indexes[be]];)if(ae.indexes[be]+=1,!Ke[isClean]){Ke[isClean]=!0,Z.push(toStack(Ke));return}ee.iterator=0,delete ae.indexes[be]}let ye=ee.events;for(;ee.eventIndex<ye.length;){let be=ye[ee.eventIndex];if(ee.eventIndex+=1,be===CHILDREN){ae.nodes&&ae.nodes.length&&(ae[isClean]=!0,ee.iterator=ae.getIterator());return}else if(this.listeners[be]){ee.visitors=this.listeners[be];return}}Z.pop()}walkSync(Z){Z[isClean]=!0;let ee=getEvents(Z);for(let ae of ee)if(ae===CHILDREN)Z.nodes&&Z.each(ve=>{ve[isClean]||this.walkSync(ve)});else{let ve=this.listeners[ae];if(ve&&this.visitSync(ve,Z.toProxy()))return}}warnings(){return this.sync().warnings()}get content(){return this.stringify().content}get css(){return this.stringify().css}get map(){return this.stringify().map}get messages(){return this.sync().messages}get opts(){return this.result.opts}get processor(){return this.result.processor}get root(){return this.sync().root}get[Symbol.toStringTag](){return"LazyResult"}};LazyResult$2.registerPostcss=ie=>{postcss$1=ie};var lazyResult=LazyResult$2;LazyResult$2.default=LazyResult$2;Root$3.registerLazyResult(LazyResult$2);Document$2.registerLazyResult(LazyResult$2);let MapGenerator=mapGenerator,stringify$1=stringify_1,parse$5=parse_1;const Result$1=result;let NoWorkResult$1=class{constructor(Z,ee,ae){ee=ee.toString(),this.stringified=!1,this._processor=Z,this._css=ee,this._opts=ae,this._map=void 0;let ve,ye=stringify$1;this.result=new Result$1(this._processor,ve,this._opts),this.result.css=ee;let be=this;Object.defineProperty(this.result,"root",{get(){return be.root}});let Ke=new MapGenerator(ye,ve,this._opts,ee);if(Ke.isMap()){let[Ye,Xe]=Ke.generate();Ye&&(this.result.css=Ye),Xe&&(this.result.map=Xe)}else Ke.clearAnnotation(),this.result.css=Ke.css}async(){return this.error?Promise.reject(this.error):Promise.resolve(this.result)}catch(Z){return this.async().catch(Z)}finally(Z){return this.async().then(Z,Z)}sync(){if(this.error)throw this.error;return this.result}then(Z,ee){return this.async().then(Z,ee)}toString(){return this._css}warnings(){return[]}get content(){return this.result.css}get css(){return this.result.css}get map(){return this.result.map}get messages(){return[]}get opts(){return this.result.opts}get processor(){return this.result.processor}get root(){if(this._root)return this._root;let Z,ee=parse$5;try{Z=ee(this._css,this._opts)}catch(ae){this.error=ae}if(this.error)throw this.error;return this._root=Z,Z}get[Symbol.toStringTag](){return"NoWorkResult"}};var noWorkResult=NoWorkResult$1;NoWorkResult$1.default=NoWorkResult$1;let NoWorkResult=noWorkResult,LazyResult$1=lazyResult,Document$1=document$1,Root$2=root,Processor$1=class{constructor(Z=[]){this.version="8.4.35",this.plugins=this.normalize(Z)}normalize(Z){let ee=[];for(let ae of Z)if(ae.postcss===!0?ae=ae():ae.postcss&&(ae=ae.postcss),typeof ae=="object"&&Array.isArray(ae.plugins))ee=ee.concat(ae.plugins);else if(typeof ae=="object"&&ae.postcssPlugin)ee.push(ae);else if(typeof ae=="function")ee.push(ae);else if(!(typeof ae=="object"&&(ae.parse||ae.stringify)))throw new Error(ae+" is not a PostCSS plugin");return ee}process(Z,ee={}){return!this.plugins.length&&!ee.parser&&!ee.stringifier&&!ee.syntax?new NoWorkResult(this,Z,ee):new LazyResult$1(this,Z,ee)}use(Z){return this.plugins=this.plugins.concat(this.normalize([Z])),this}};var processor=Processor$1;Processor$1.default=Processor$1;Root$2.registerProcessor(Processor$1);Document$1.registerProcessor(Processor$1);let Declaration$1=declaration,PreviousMap=previousMap,Comment$1=comment,AtRule$1=atRule,Input$1=input,Root$1=root,Rule$1=rule;function fromJSON$1(ie,Z){if(Array.isArray(ie))return ie.map(ve=>fromJSON$1(ve));let{inputs:ee,...ae}=ie;if(ee){Z=[];for(let ve of ee){let ye={...ve,__proto__:Input$1.prototype};ye.map&&(ye.map={...ye.map,__proto__:PreviousMap.prototype}),Z.push(ye)}}if(ae.nodes&&(ae.nodes=ie.nodes.map(ve=>fromJSON$1(ve,Z))),ae.source){let{inputId:ve,...ye}=ae.source;ae.source=ye,ve!=null&&(ae.source.input=Z[ve])}if(ae.type==="root")return new Root$1(ae);if(ae.type==="decl")return new Declaration$1(ae);if(ae.type==="rule")return new Rule$1(ae);if(ae.type==="comment")return new Comment$1(ae);if(ae.type==="atrule")return new AtRule$1(ae);throw new Error("Unknown node type: "+ie.type)}var fromJSON_1=fromJSON$1;fromJSON$1.default=fromJSON$1;var define_process_env_default={};let CssSyntaxError=cssSyntaxError,Declaration=declaration,LazyResult=lazyResult,Container=container,Processor=processor,stringify=stringify_1,fromJSON=fromJSON_1,Document=document$1,Warning=warning,Comment=comment,AtRule=atRule,Result=result,Input=input,parse$4=parse_1,list=list_1,Rule=rule,Root=root,Node$1=node;function postcss(...ie){return ie.length===1&&Array.isArray(ie[0])&&(ie=ie[0]),new Processor(ie)}postcss.plugin=function(Z,ee){let ae=!1;function ve(...be){console&&console.warn&&!ae&&(ae=!0,console.warn(Z+`: postcss.plugin was deprecated. Migration guide:
https://evilmartians.com/chronicles/postcss-8-plugin-migration`),define_process_env_default.LANG&&define_process_env_default.LANG.startsWith("cn")&&console.warn(Z+`:  postcss.plugin . :
https://www.w3ctech.com/topic/2226`));let Ke=ee(...be);return Ke.postcssPlugin=Z,Ke.postcssVersion=new Processor().version,Ke}let ye;return Object.defineProperty(ve,"postcss",{get(){return ye||(ye=ve()),ye}}),ve.process=function(be,Ke,Ye){return postcss([ve(Ye)]).process(be,Ke)},ve};postcss.stringify=stringify;postcss.parse=parse$4;postcss.fromJSON=fromJSON;postcss.list=list;postcss.comment=ie=>new Comment(ie);postcss.atRule=ie=>new AtRule(ie);postcss.decl=ie=>new Declaration(ie);postcss.rule=ie=>new Rule(ie);postcss.root=ie=>new Root(ie);postcss.document=ie=>new Document(ie);postcss.CssSyntaxError=CssSyntaxError;postcss.Declaration=Declaration;postcss.Container=Container;postcss.Processor=Processor;postcss.Document=Document;postcss.Comment=Comment;postcss.Warning=Warning;postcss.AtRule=AtRule;postcss.Result=Result;postcss.Input=Input;postcss.Rule=Rule;postcss.Root=Root;postcss.Node=Node$1;LazyResult.registerPostcss(postcss);var postcss_1=postcss;postcss.default=postcss;const htmlparser=lib$5,escapeStringRegexp=escapeStringRegexp$1,{isPlainObject}=isPlainObject$2,deepmerge=cjs,parseSrcset=parseSrcsetExports,{parse:postcssParse}=postcss_1,mediaTags=["img","audio","video","picture","svg","object","map","iframe","embed"],vulnerableTags=["script","style"];function each(ie,Z){ie&&Object.keys(ie).forEach(function(ee){Z(ie[ee],ee)})}function has(ie,Z){return{}.hasOwnProperty.call(ie,Z)}function filter(ie,Z){const ee=[];return each(ie,function(ae){Z(ae)&&ee.push(ae)}),ee}function isEmptyObject(ie){for(const Z in ie)if(has(ie,Z))return!1;return!0}function stringifySrcset(ie){return ie.map(function(Z){if(!Z.url)throw new Error("URL missing");return Z.url+(Z.w?` ${Z.w}w`:"")+(Z.h?` ${Z.h}h`:"")+(Z.d?` ${Z.d}x`:"")}).join(", ")}var sanitizeHtml_1=sanitizeHtml;const VALID_HTML_ATTRIBUTE_NAME=/^[^\0\t\n\f\r /<=>]+$/;function sanitizeHtml(ie,Z,ee){if(ie==null)return"";typeof ie=="number"&&(ie=ie.toString());let ae="",ve="";function ye(Qr,ii){const ti=this;this.tag=Qr,this.attribs=ii||{},this.tagPosition=ae.length,this.text="",this.mediaChildren=[],this.updateParentNodeText=function(){if(tt.length){const ni=tt[tt.length-1];ni.text+=ti.text}},this.updateParentNodeMediaChildren=function(){tt.length&&mediaTags.includes(this.tag)&&tt[tt.length-1].mediaChildren.push(this.tag)}}Z=Object.assign({},sanitizeHtml.defaults,Z),Z.parser=Object.assign({},htmlParserDefaults,Z.parser);const be=function(Qr){return Z.allowedTags===!1||(Z.allowedTags||[]).indexOf(Qr)>-1};vulnerableTags.forEach(function(Qr){be(Qr)&&!Z.allowVulnerableTags&&console.warn(`

 Your \`allowedTags\` option includes, \`${Qr}\`, which is inherently
vulnerable to XSS attacks. Please remove it from \`allowedTags\`.
Or, to disable this warning, add the \`allowVulnerableTags\` option
and ensure you are accounting for this risk.

`)});const Ke=Z.nonTextTags||["script","style","textarea","option"];let Ye,Xe;Z.allowedAttributes&&(Ye={},Xe={},each(Z.allowedAttributes,function(Qr,ii){Ye[ii]=[];const ti=[];Qr.forEach(function(ni){typeof ni=="string"&&ni.indexOf("*")>=0?ti.push(escapeStringRegexp(ni).replace(/\\\*/g,".*")):Ye[ii].push(ni)}),ti.length&&(Xe[ii]=new RegExp("^("+ti.join("|")+")$"))}));const Qe={},et={},Je={};each(Z.allowedClasses,function(Qr,ii){if(Ye&&(has(Ye,ii)||(Ye[ii]=[]),Ye[ii].push("class")),Qe[ii]=Qr,Array.isArray(Qr)){const ti=[];Qe[ii]=[],Je[ii]=[],Qr.forEach(function(ni){typeof ni=="string"&&ni.indexOf("*")>=0?ti.push(escapeStringRegexp(ni).replace(/\\\*/g,".*")):ni instanceof RegExp?Je[ii].push(ni):Qe[ii].push(ni)}),ti.length&&(et[ii]=new RegExp("^("+ti.join("|")+")$"))}});const rt={};let it;each(Z.transformTags,function(Qr,ii){let ti;typeof Qr=="function"?ti=Qr:typeof Qr=="string"&&(ti=sanitizeHtml.simpleTransform(Qr)),ii==="*"?it=ti:rt[ii]=ti});let nt,tt,st,ot,ut,ft,pt=!1;mt();const Xr=new htmlparser.Parser({onopentag:function(Qr,ii){if(Z.enforceHtmlBoundary&&Qr==="html"&&mt(),ut){ft++;return}const ti=new ye(Qr,ii);tt.push(ti);let ni=!1;const ui=!!ti.text;let yi;if(has(rt,Qr)&&(yi=rt[Qr](Qr,ii),ti.attribs=ii=yi.attribs,yi.text!==void 0&&(ti.innerText=yi.text),Qr!==yi.tagName&&(ti.name=Qr=yi.tagName,ot[nt]=yi.tagName)),it&&(yi=it(Qr,ii),ti.attribs=ii=yi.attribs,Qr!==yi.tagName&&(ti.name=Qr=yi.tagName,ot[nt]=yi.tagName)),(!be(Qr)||Z.disallowedTagsMode==="recursiveEscape"&&!isEmptyObject(st)||Z.nestingLimit!=null&&nt>=Z.nestingLimit)&&(ni=!0,st[nt]=!0,Z.disallowedTagsMode==="discard"&&Ke.indexOf(Qr)!==-1&&(ut=!0,ft=1),st[nt]=!0),nt++,ni){if(Z.disallowedTagsMode==="discard")return;ve=ae,ae=""}ae+="<"+Qr,Qr==="script"&&(Z.allowedScriptHostnames||Z.allowedScriptDomains)&&(ti.innerText=""),(!Ye||has(Ye,Qr)||Ye["*"])&&each(ii,function(pi,gi){if(!VALID_HTML_ATTRIBUTE_NAME.test(gi)){delete ti.attribs[gi];return}if(pi===""&&(Z.nonBooleanAttributes.includes(gi)||Z.nonBooleanAttributes.includes("*"))){delete ti.attribs[gi];return}let Ri=!1;if(!Ye||has(Ye,Qr)&&Ye[Qr].indexOf(gi)!==-1||Ye["*"]&&Ye["*"].indexOf(gi)!==-1||has(Xe,Qr)&&Xe[Qr].test(gi)||Xe["*"]&&Xe["*"].test(gi))Ri=!0;else if(Ye&&Ye[Qr]){for(const Ei of Ye[Qr])if(isPlainObject(Ei)&&Ei.name&&Ei.name===gi){Ri=!0;let xi="";if(Ei.multiple===!0){const Ii=pi.split(" ");for(const vi of Ii)Ei.values.indexOf(vi)!==-1&&(xi===""?xi=vi:xi+=" "+vi)}else Ei.values.indexOf(pi)>=0&&(xi=pi);pi=xi}}if(Ri){if(Z.allowedSchemesAppliedToAttributes.indexOf(gi)!==-1&&ri(Qr,pi)){delete ti.attribs[gi];return}if(Qr==="script"&&gi==="src"){let Ei=!0;try{const xi=Zr(pi);if(Z.allowedScriptHostnames||Z.allowedScriptDomains){const Ii=(Z.allowedScriptHostnames||[]).find(function(Si){return Si===xi.url.hostname}),vi=(Z.allowedScriptDomains||[]).find(function(Si){return xi.url.hostname===Si||xi.url.hostname.endsWith(`.${Si}`)});Ei=Ii||vi}}catch{Ei=!1}if(!Ei){delete ti.attribs[gi];return}}if(Qr==="iframe"&&gi==="src"){let Ei=!0;try{const xi=Zr(pi);if(xi.isRelativeUrl)Ei=has(Z,"allowIframeRelativeUrls")?Z.allowIframeRelativeUrls:!Z.allowedIframeHostnames&&!Z.allowedIframeDomains;else if(Z.allowedIframeHostnames||Z.allowedIframeDomains){const Ii=(Z.allowedIframeHostnames||[]).find(function(Si){return Si===xi.url.hostname}),vi=(Z.allowedIframeDomains||[]).find(function(Si){return xi.url.hostname===Si||xi.url.hostname.endsWith(`.${Si}`)});Ei=Ii||vi}}catch{Ei=!1}if(!Ei){delete ti.attribs[gi];return}}if(gi==="srcset")try{let Ei=parseSrcset(pi);if(Ei.forEach(function(xi){ri("srcset",xi.url)&&(xi.evil=!0)}),Ei=filter(Ei,function(xi){return!xi.evil}),Ei.length)pi=stringifySrcset(filter(Ei,function(xi){return!xi.evil})),ti.attribs[gi]=pi;else{delete ti.attribs[gi];return}}catch{delete ti.attribs[gi];return}if(gi==="class"){const Ei=Qe[Qr],xi=Qe["*"],Ii=et[Qr],vi=Je[Qr],Si=et["*"],Fi=[Ii,Si].concat(vi).filter(function(Di){return Di});if(Ei&&xi?pi=oi(pi,deepmerge(Ei,xi),Fi):pi=oi(pi,Ei||xi,Fi),!pi.length){delete ti.attribs[gi];return}}if(gi==="style"){if(Z.parseStyleAttributes)try{const Ei=postcssParse(Qr+" {"+pi+"}"),xi=_r(Ei,Z.allowedStyles);if(pi=Kr(xi),pi.length===0){delete ti.attribs[gi];return}}catch{typeof window<"u"&&console.warn('Failed to parse "'+Qr+" {"+pi+`}", If you're running this in a browser, we recommend to disable style parsing: options.parseStyleAttributes: false, since this only works in a node environment due to a postcss dependency, More info: https://github.com/apostrophecms/sanitize-html/issues/547`),delete ti.attribs[gi];return}else if(Z.allowedStyles)throw new Error("allowedStyles option cannot be used together with parseStyleAttributes: false.")}ae+=" "+gi,pi&&pi.length&&(ae+='="'+Yr(pi,!0)+'"')}else delete ti.attribs[gi]}),Z.selfClosing.indexOf(Qr)!==-1?ae+=" />":(ae+=">",ti.innerText&&!ui&&!Z.textFilter&&(ae+=Yr(ti.innerText),pt=!0)),ni&&(ae=ve+Yr(ae),ve="")},ontext:function(Qr){if(ut)return;const ii=tt[tt.length-1];let ti;if(ii&&(ti=ii.tag,Qr=ii.innerText!==void 0?ii.innerText:Qr),Z.disallowedTagsMode==="discard"&&(ti==="script"||ti==="style"))ae+=Qr;else{const ni=Yr(Qr,!1);Z.textFilter&&!pt?ae+=Z.textFilter(ni,ti):pt||(ae+=ni)}if(tt.length){const ni=tt[tt.length-1];ni.text+=Qr}},onclosetag:function(Qr,ii){if(ut)if(ft--,!ft)ut=!1;else return;const ti=tt.pop();if(!ti)return;if(ti.tag!==Qr){tt.push(ti);return}ut=Z.enforceHtmlBoundary?Qr==="html":!1,nt--;const ni=st[nt];if(ni){if(delete st[nt],Z.disallowedTagsMode==="discard"){ti.updateParentNodeText();return}ve=ae,ae=""}if(ot[nt]&&(Qr=ot[nt],delete ot[nt]),Z.exclusiveFilter&&Z.exclusiveFilter(ti)){ae=ae.substr(0,ti.tagPosition);return}if(ti.updateParentNodeMediaChildren(),ti.updateParentNodeText(),Z.selfClosing.indexOf(Qr)!==-1||ii&&!be(Qr)&&["escape","recursiveEscape"].indexOf(Z.disallowedTagsMode)>=0){ni&&(ae=ve,ve="");return}ae+="</"+Qr+">",ni&&(ae=ve+Yr(ae),ve=""),pt=!1}},Z.parser);return Xr.write(ie),Xr.end(),ae;function mt(){ae="",nt=0,tt=[],st={},ot={},ut=!1,ft=0}function Yr(Qr,ii){return typeof Qr!="string"&&(Qr=Qr+""),Z.parser.decodeEntities&&(Qr=Qr.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),ii&&(Qr=Qr.replace(/"/g,"&quot;"))),Qr=Qr.replace(/&(?![a-zA-Z0-9#]{1,20};)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),ii&&(Qr=Qr.replace(/"/g,"&quot;")),Qr}function ri(Qr,ii){for(ii=ii.replace(/[\x00-\x20]+/g,"");;){const ui=ii.indexOf("<!--");if(ui===-1)break;const yi=ii.indexOf("-->",ui+4);if(yi===-1)break;ii=ii.substring(0,ui)+ii.substring(yi+3)}const ti=ii.match(/^([a-zA-Z][a-zA-Z0-9.\-+]*):/);if(!ti)return ii.match(/^[/\\]{2}/)?!Z.allowProtocolRelative:!1;const ni=ti[1].toLowerCase();return has(Z.allowedSchemesByTag,Qr)?Z.allowedSchemesByTag[Qr].indexOf(ni)===-1:!Z.allowedSchemes||Z.allowedSchemes.indexOf(ni)===-1}function Zr(Qr){if(Qr=Qr.replace(/^(\w+:)?\s*[\\/]\s*[\\/]/,"$1//"),Qr.startsWith("relative:"))throw new Error("relative: exploit attempt");let ii="relative://relative-site";for(let ui=0;ui<100;ui++)ii+=`/${ui}`;const ti=new URL(Qr,ii);return{isRelativeUrl:ti&&ti.hostname==="relative-site"&&ti.protocol==="relative:",url:ti}}function _r(Qr,ii){if(!ii)return Qr;const ti=Qr.nodes[0];let ni;return ii[ti.selector]&&ii["*"]?ni=deepmerge(ii[ti.selector],ii["*"]):ni=ii[ti.selector]||ii["*"],ni&&(Qr.nodes[0].nodes=ti.nodes.reduce(si(ni),[])),Qr}function Kr(Qr){return Qr.nodes[0].nodes.reduce(function(ii,ti){return ii.push(`${ti.prop}:${ti.value}${ti.important?" !important":""}`),ii},[]).join(";")}function si(Qr){return function(ii,ti){return has(Qr,ti.prop)&&Qr[ti.prop].some(function(ui){return ui.test(ti.value)})&&ii.push(ti),ii}}function oi(Qr,ii,ti){return ii?(Qr=Qr.split(/\s+/),Qr.filter(function(ni){return ii.indexOf(ni)!==-1||ti.some(function(ui){return ui.test(ni)})}).join(" ")):Qr}}const htmlParserDefaults={decodeEntities:!0};sanitizeHtml.defaults={allowedTags:["address","article","aside","footer","header","h1","h2","h3","h4","h5","h6","hgroup","main","nav","section","blockquote","dd","div","dl","dt","figcaption","figure","hr","li","main","ol","p","pre","ul","a","abbr","b","bdi","bdo","br","cite","code","data","dfn","em","i","kbd","mark","q","rb","rp","rt","rtc","ruby","s","samp","small","span","strong","sub","sup","time","u","var","wbr","caption","col","colgroup","table","tbody","td","tfoot","th","thead","tr"],nonBooleanAttributes:["abbr","accept","accept-charset","accesskey","action","allow","alt","as","autocapitalize","autocomplete","blocking","charset","cite","class","color","cols","colspan","content","contenteditable","coords","crossorigin","data","datetime","decoding","dir","dirname","download","draggable","enctype","enterkeyhint","fetchpriority","for","form","formaction","formenctype","formmethod","formtarget","headers","height","hidden","high","href","hreflang","http-equiv","id","imagesizes","imagesrcset","inputmode","integrity","is","itemid","itemprop","itemref","itemtype","kind","label","lang","list","loading","low","max","maxlength","media","method","min","minlength","name","nonce","optimum","pattern","ping","placeholder","popover","popovertarget","popovertargetaction","poster","preload","referrerpolicy","rel","rows","rowspan","sandbox","scope","shape","size","sizes","slot","span","spellcheck","src","srcdoc","srclang","srcset","start","step","style","tabindex","target","title","translate","type","usemap","value","width","wrap","onauxclick","onafterprint","onbeforematch","onbeforeprint","onbeforeunload","onbeforetoggle","onblur","oncancel","oncanplay","oncanplaythrough","onchange","onclick","onclose","oncontextlost","oncontextmenu","oncontextrestored","oncopy","oncuechange","oncut","ondblclick","ondrag","ondragend","ondragenter","ondragleave","ondragover","ondragstart","ondrop","ondurationchange","onemptied","onended","onerror","onfocus","onformdata","onhashchange","oninput","oninvalid","onkeydown","onkeypress","onkeyup","onlanguagechange","onload","onloadeddata","onloadedmetadata","onloadstart","onmessage","onmessageerror","onmousedown","onmouseenter","onmouseleave","onmousemove","onmouseout","onmouseover","onmouseup","onoffline","ononline","onpagehide","onpageshow","onpaste","onpause","onplay","onplaying","onpopstate","onprogress","onratechange","onreset","onresize","onrejectionhandled","onscroll","onscrollend","onsecuritypolicyviolation","onseeked","onseeking","onselect","onslotchange","onstalled","onstorage","onsubmit","onsuspend","ontimeupdate","ontoggle","onunhandledrejection","onunload","onvolumechange","onwaiting","onwheel"],disallowedTagsMode:"discard",allowedAttributes:{a:["href","name","target"],img:["src","srcset","alt","title","width","height","loading"]},selfClosing:["img","br","hr","area","base","basefont","input","link","meta"],allowedSchemes:["http","https","ftp","mailto","tel"],allowedSchemesByTag:{},allowedSchemesAppliedToAttributes:["href","src","cite"],allowProtocolRelative:!0,enforceHtmlBoundary:!1,parseStyleAttributes:!0};sanitizeHtml.simpleTransform=function(ie,Z,ee){return ee=ee===void 0?!0:ee,Z=Z||{},function(ae,ve){let ye;if(ee)for(ye in Z)ve[ye]=Z[ye];else ve=Z;return{tagName:ie,attribs:ve}}};const at=getDefaultExportFromCjs$1(sanitizeHtml_1);function getDefaultExportFromCjs(ie){return ie&&ie.__esModule&&Object.prototype.hasOwnProperty.call(ie,"default")?ie.default:ie}var urlToolkit={exports:{}};(function(ie,Z){(function(ee){var ae=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,ve=/^(?=([^\/?#]*))\1([^]*)$/,ye=/(?:\/|^)\.(?=\/)/g,be=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,Ke={buildAbsoluteURL:function(Ye,Xe,Qe){if(Qe=Qe||{},Ye=Ye.trim(),Xe=Xe.trim(),!Xe){if(!Qe.alwaysNormalize)return Ye;var et=Ke.parseURL(Ye);if(!et)throw new Error("Error trying to parse base URL.");return et.path=Ke.normalizePath(et.path),Ke.buildURLFromParts(et)}var Je=Ke.parseURL(Xe);if(!Je)throw new Error("Error trying to parse relative URL.");if(Je.scheme)return Qe.alwaysNormalize?(Je.path=Ke.normalizePath(Je.path),Ke.buildURLFromParts(Je)):Xe;var rt=Ke.parseURL(Ye);if(!rt)throw new Error("Error trying to parse base URL.");if(!rt.netLoc&&rt.path&&rt.path[0]!=="/"){var it=ve.exec(rt.path);rt.netLoc=it[1],rt.path=it[2]}rt.netLoc&&!rt.path&&(rt.path="/");var nt={scheme:rt.scheme,netLoc:Je.netLoc,path:null,params:Je.params,query:Je.query,fragment:Je.fragment};if(!Je.netLoc&&(nt.netLoc=rt.netLoc,Je.path[0]!=="/"))if(!Je.path)nt.path=rt.path,Je.params||(nt.params=rt.params,Je.query||(nt.query=rt.query));else{var tt=rt.path,st=tt.substring(0,tt.lastIndexOf("/")+1)+Je.path;nt.path=Ke.normalizePath(st)}return nt.path===null&&(nt.path=Qe.alwaysNormalize?Ke.normalizePath(Je.path):Je.path),Ke.buildURLFromParts(nt)},parseURL:function(Ye){var Xe=ae.exec(Ye);return Xe?{scheme:Xe[1]||"",netLoc:Xe[2]||"",path:Xe[3]||"",params:Xe[4]||"",query:Xe[5]||"",fragment:Xe[6]||""}:null},normalizePath:function(Ye){for(Ye=Ye.split("").reverse().join("").replace(ye,"");Ye.length!==(Ye=Ye.replace(be,"")).length;);return Ye.split("").reverse().join("")},buildURLFromParts:function(Ye){return Ye.scheme+Ye.netLoc+Ye.path+Ye.params+Ye.query+Ye.fragment}};ie.exports=Ke})()})(urlToolkit);var urlToolkitExports=urlToolkit.exports;function ownKeys(ie,Z){var ee=Object.keys(ie);if(Object.getOwnPropertySymbols){var ae=Object.getOwnPropertySymbols(ie);Z&&(ae=ae.filter(function(ve){return Object.getOwnPropertyDescriptor(ie,ve).enumerable})),ee.push.apply(ee,ae)}return ee}function _objectSpread2(ie){for(var Z=1;Z<arguments.length;Z++){var ee=arguments[Z]!=null?arguments[Z]:{};Z%2?ownKeys(Object(ee),!0).forEach(function(ae){_defineProperty(ie,ae,ee[ae])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ie,Object.getOwnPropertyDescriptors(ee)):ownKeys(Object(ee)).forEach(function(ae){Object.defineProperty(ie,ae,Object.getOwnPropertyDescriptor(ee,ae))})}return ie}function _defineProperty(ie,Z,ee){return Z=_toPropertyKey(Z),Z in ie?Object.defineProperty(ie,Z,{value:ee,enumerable:!0,configurable:!0,writable:!0}):ie[Z]=ee,ie}function _extends(){return _extends=Object.assign?Object.assign.bind():function(ie){for(var Z=1;Z<arguments.length;Z++){var ee=arguments[Z];for(var ae in ee)Object.prototype.hasOwnProperty.call(ee,ae)&&(ie[ae]=ee[ae])}return ie},_extends.apply(this,arguments)}function _toPrimitive(ie,Z){if(typeof ie!="object"||ie===null)return ie;var ee=ie[Symbol.toPrimitive];if(ee!==void 0){var ae=ee.call(ie,Z||"default");if(typeof ae!="object")return ae;throw new TypeError("@@toPrimitive must return a primitive value.")}return(Z==="string"?String:Number)(ie)}function _toPropertyKey(ie){var Z=_toPrimitive(ie,"string");return typeof Z=="symbol"?Z:String(Z)}const isFiniteNumber=Number.isFinite||function(ie){return typeof ie=="number"&&isFinite(ie)},isSafeInteger=Number.isSafeInteger||function(ie){return typeof ie=="number"&&Math.abs(ie)<=MAX_SAFE_INTEGER},MAX_SAFE_INTEGER=Number.MAX_SAFE_INTEGER||9007199254740991;let Events=function(ie){return ie.MEDIA_ATTACHING="hlsMediaAttaching",ie.MEDIA_ATTACHED="hlsMediaAttached",ie.MEDIA_DETACHING="hlsMediaDetaching",ie.MEDIA_DETACHED="hlsMediaDetached",ie.BUFFER_RESET="hlsBufferReset",ie.BUFFER_CODECS="hlsBufferCodecs",ie.BUFFER_CREATED="hlsBufferCreated",ie.BUFFER_APPENDING="hlsBufferAppending",ie.BUFFER_APPENDED="hlsBufferAppended",ie.BUFFER_EOS="hlsBufferEos",ie.BUFFER_FLUSHING="hlsBufferFlushing",ie.BUFFER_FLUSHED="hlsBufferFlushed",ie.MANIFEST_LOADING="hlsManifestLoading",ie.MANIFEST_LOADED="hlsManifestLoaded",ie.MANIFEST_PARSED="hlsManifestParsed",ie.LEVEL_SWITCHING="hlsLevelSwitching",ie.LEVEL_SWITCHED="hlsLevelSwitched",ie.LEVEL_LOADING="hlsLevelLoading",ie.LEVEL_LOADED="hlsLevelLoaded",ie.LEVEL_UPDATED="hlsLevelUpdated",ie.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",ie.LEVELS_UPDATED="hlsLevelsUpdated",ie.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",ie.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",ie.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",ie.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",ie.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",ie.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",ie.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",ie.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",ie.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",ie.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",ie.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",ie.CUES_PARSED="hlsCuesParsed",ie.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",ie.INIT_PTS_FOUND="hlsInitPtsFound",ie.FRAG_LOADING="hlsFragLoading",ie.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",ie.FRAG_LOADED="hlsFragLoaded",ie.FRAG_DECRYPTED="hlsFragDecrypted",ie.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",ie.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",ie.FRAG_PARSING_METADATA="hlsFragParsingMetadata",ie.FRAG_PARSED="hlsFragParsed",ie.FRAG_BUFFERED="hlsFragBuffered",ie.FRAG_CHANGED="hlsFragChanged",ie.FPS_DROP="hlsFpsDrop",ie.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",ie.ERROR="hlsError",ie.DESTROYING="hlsDestroying",ie.KEY_LOADING="hlsKeyLoading",ie.KEY_LOADED="hlsKeyLoaded",ie.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",ie.BACK_BUFFER_REACHED="hlsBackBufferReached",ie}({}),ErrorTypes=function(ie){return ie.NETWORK_ERROR="networkError",ie.MEDIA_ERROR="mediaError",ie.KEY_SYSTEM_ERROR="keySystemError",ie.MUX_ERROR="muxError",ie.OTHER_ERROR="otherError",ie}({}),ErrorDetails=function(ie){return ie.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",ie.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",ie.KEY_SYSTEM_NO_SESSION="keySystemNoSession",ie.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",ie.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",ie.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",ie.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",ie.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",ie.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",ie.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",ie.MANIFEST_LOAD_ERROR="manifestLoadError",ie.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",ie.MANIFEST_PARSING_ERROR="manifestParsingError",ie.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",ie.LEVEL_EMPTY_ERROR="levelEmptyError",ie.LEVEL_LOAD_ERROR="levelLoadError",ie.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",ie.LEVEL_PARSING_ERROR="levelParsingError",ie.LEVEL_SWITCH_ERROR="levelSwitchError",ie.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",ie.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",ie.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",ie.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",ie.FRAG_LOAD_ERROR="fragLoadError",ie.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",ie.FRAG_DECRYPT_ERROR="fragDecryptError",ie.FRAG_PARSING_ERROR="fragParsingError",ie.FRAG_GAP="fragGap",ie.REMUX_ALLOC_ERROR="remuxAllocError",ie.KEY_LOAD_ERROR="keyLoadError",ie.KEY_LOAD_TIMEOUT="keyLoadTimeOut",ie.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",ie.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",ie.BUFFER_APPEND_ERROR="bufferAppendError",ie.BUFFER_APPENDING_ERROR="bufferAppendingError",ie.BUFFER_STALLED_ERROR="bufferStalledError",ie.BUFFER_FULL_ERROR="bufferFullError",ie.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",ie.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",ie.INTERNAL_EXCEPTION="internalException",ie.INTERNAL_ABORTED="aborted",ie.UNKNOWN="unknown",ie}({});const noop=function(){},fakeLogger={trace:noop,debug:noop,log:noop,warn:noop,info:noop,error:noop};let exportedLogger=fakeLogger;function consolePrintFn(ie){const Z=self.console[ie];return Z?Z.bind(self.console,`[${ie}] >`):noop}function exportLoggerFunctions(ie,...Z){Z.forEach(function(ee){exportedLogger[ee]=ie[ee]?ie[ee].bind(ie):consolePrintFn(ee)})}function enableLogs(ie,Z){if(self.console&&ie===!0||typeof ie=="object"){exportLoggerFunctions(ie,"debug","log","info","warn","error");try{exportedLogger.log(`Debug logs enabled for "${Z}" in hls.js version 1.4.14`)}catch{exportedLogger=fakeLogger}}else exportedLogger=fakeLogger}const logger=exportedLogger,DECIMAL_RESOLUTION_REGEX=/^(\d+)x(\d+)$/,ATTR_LIST_REGEX=/(.+?)=(".*?"|.*?)(?:,|$)/g;class AttrList{constructor(Z){typeof Z=="string"&&(Z=AttrList.parseAttrList(Z));for(const ee in Z)Z.hasOwnProperty(ee)&&(ee.substring(0,2)==="X-"&&(this.clientAttrs=this.clientAttrs||[],this.clientAttrs.push(ee)),this[ee]=Z[ee])}decimalInteger(Z){const ee=parseInt(this[Z],10);return ee>Number.MAX_SAFE_INTEGER?1/0:ee}hexadecimalInteger(Z){if(this[Z]){let ee=(this[Z]||"0x").slice(2);ee=(ee.length&1?"0":"")+ee;const ae=new Uint8Array(ee.length/2);for(let ve=0;ve<ee.length/2;ve++)ae[ve]=parseInt(ee.slice(ve*2,ve*2+2),16);return ae}else return null}hexadecimalIntegerAsNumber(Z){const ee=parseInt(this[Z],16);return ee>Number.MAX_SAFE_INTEGER?1/0:ee}decimalFloatingPoint(Z){return parseFloat(this[Z])}optionalFloat(Z,ee){const ae=this[Z];return ae?parseFloat(ae):ee}enumeratedString(Z){return this[Z]}bool(Z){return this[Z]==="YES"}decimalResolution(Z){const ee=DECIMAL_RESOLUTION_REGEX.exec(this[Z]);if(ee!==null)return{width:parseInt(ee[1],10),height:parseInt(ee[2],10)}}static parseAttrList(Z){let ee;const ae={},ve='"';for(ATTR_LIST_REGEX.lastIndex=0;(ee=ATTR_LIST_REGEX.exec(Z))!==null;){let ye=ee[2];ye.indexOf(ve)===0&&ye.lastIndexOf(ve)===ye.length-1&&(ye=ye.slice(1,-1));const be=ee[1].trim();ae[be]=ye}return ae}}function isDateRangeCueAttribute(ie){return ie!=="ID"&&ie!=="CLASS"&&ie!=="START-DATE"&&ie!=="DURATION"&&ie!=="END-DATE"&&ie!=="END-ON-NEXT"}function isSCTE35Attribute(ie){return ie==="SCTE35-OUT"||ie==="SCTE35-IN"}class DateRange{constructor(Z,ee){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,ee){const ae=ee.attr;for(const ve in ae)if(Object.prototype.hasOwnProperty.call(Z,ve)&&Z[ve]!==ae[ve]){logger.warn(`DATERANGE tag attribute: "${ve}" does not match for tags with ID: "${Z.ID}"`),this._badValueForSameId=ve;break}Z=_extends(new AttrList({}),ae,Z)}if(this.attr=Z,this._startDate=new Date(Z["START-DATE"]),"END-DATE"in this.attr){const ae=new Date(this.attr["END-DATE"]);isFiniteNumber(ae.getTime())&&(this._endDate=ae)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get startDate(){return this._startDate}get endDate(){if(this._endDate)return this._endDate;const Z=this.duration;return Z!==null?new Date(this._startDate.getTime()+Z*1e3):null}get duration(){if("DURATION"in this.attr){const Z=this.attr.decimalFloatingPoint("DURATION");if(isFiniteNumber(Z))return Z}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isValid(){return!!this.id&&!this._badValueForSameId&&isFiniteNumber(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}class LoadStats{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var ElementaryStreamTypes={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class BaseSegment{constructor(Z){this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams={[ElementaryStreamTypes.AUDIO]:null,[ElementaryStreamTypes.VIDEO]:null,[ElementaryStreamTypes.AUDIOVIDEO]:null},this.baseurl=Z}setByteRange(Z,ee){const ae=Z.split("@",2),ve=[];ae.length===1?ve[0]=ee?ee.byteRangeEndOffset:0:ve[0]=parseInt(ae[1]),ve[1]=parseInt(ae[0])+ve[0],this._byteRange=ve}get byteRange(){return this._byteRange?this._byteRange:[]}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=urlToolkitExports.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(Z){this._url=Z}}class Fragment extends BaseSegment{constructor(Z,ee){super(ee),this._decryptdata=null,this.rawProgramDateTime=null,this.programDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.stats=new LoadStats,this.urlId=0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.type=Z}get decryptdata(){const{levelkeys:Z}=this;if(!Z&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const ee=this.levelkeys.identity;if(ee)this._decryptdata=ee.getDecryptData(this.sn);else{const ae=Object.keys(this.levelkeys);if(ae.length===1)return this._decryptdata=this.levelkeys[ae[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null||!isFiniteNumber(this.programDateTime))return null;const Z=isFiniteNumber(this.duration)?this.duration:0;return this.programDateTime+Z*1e3}get encrypted(){var Z;if((Z=this._decryptdata)!=null&&Z.encrypted)return!0;if(this.levelkeys){const ee=Object.keys(this.levelkeys),ae=ee.length;if(ae>1||ae===1&&this.levelkeys[ee[0]].encrypted)return!0}return!1}setKeyFormat(Z){if(this.levelkeys){const ee=this.levelkeys[Z];ee&&!this._decryptdata&&(this._decryptdata=ee.getDecryptData(this.sn))}}abortRequests(){var Z,ee;(Z=this.loader)==null||Z.abort(),(ee=this.keyLoader)==null||ee.abort()}setElementaryStreamInfo(Z,ee,ae,ve,ye,be=!1){const{elementaryStreams:Ke}=this,Ye=Ke[Z];if(!Ye){Ke[Z]={startPTS:ee,endPTS:ae,startDTS:ve,endDTS:ye,partial:be};return}Ye.startPTS=Math.min(Ye.startPTS,ee),Ye.endPTS=Math.max(Ye.endPTS,ae),Ye.startDTS=Math.min(Ye.startDTS,ve),Ye.endDTS=Math.max(Ye.endDTS,ye)}clearElementaryStreamInfo(){const{elementaryStreams:Z}=this;Z[ElementaryStreamTypes.AUDIO]=null,Z[ElementaryStreamTypes.VIDEO]=null,Z[ElementaryStreamTypes.AUDIOVIDEO]=null}}class Part extends BaseSegment{constructor(Z,ee,ae,ve,ye){super(ae),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.stats=new LoadStats,this.duration=Z.decimalFloatingPoint("DURATION"),this.gap=Z.bool("GAP"),this.independent=Z.bool("INDEPENDENT"),this.relurl=Z.enumeratedString("URI"),this.fragment=ee,this.index=ve;const be=Z.enumeratedString("BYTERANGE");be&&this.setByteRange(be,ye),ye&&(this.fragOffset=ye.fragOffset+ye.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:Z}=this;return!!(Z.audio||Z.video||Z.audiovideo)}}const DEFAULT_TARGET_DURATION=10;class LevelDetails{constructor(Z){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=Z}reloaded(Z){if(!Z){this.advanced=!0,this.updated=!0;return}const ee=this.lastPartSn-Z.lastPartSn,ae=this.lastPartIndex-Z.lastPartIndex;this.updated=this.endSN!==Z.endSN||!!ae||!!ee||!this.live,this.advanced=this.endSN>Z.endSN||ee>0||ee===0&&ae>0,this.updated||this.advanced?this.misses=Math.floor(Z.misses*.6):this.misses=Z.misses+1,this.availabilityDelay=Z.availabilityDelay}get hasProgramDateTime(){return this.fragments.length?isFiniteNumber(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||DEFAULT_TARGET_DURATION}get drift(){const Z=this.driftEndTime-this.driftStartTime;return Z>0?(this.driftEnd-this.driftStart)*1e3/Z:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var Z;return(Z=this.partList)!=null&&Z.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var Z;return(Z=this.fragments)!=null&&Z.length?this.fragments[this.fragments.length-1].end:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var Z;return(Z=this.partList)!=null&&Z.length?this.partList[this.partList.length-1].index:-1}get lastPartSn(){var Z;return(Z=this.partList)!=null&&Z.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}function base64Decode(ie){return Uint8Array.from(atob(ie),Z=>Z.charCodeAt(0))}function getKeyIdBytes(ie){const Z=strToUtf8array(ie).subarray(0,16),ee=new Uint8Array(16);return ee.set(Z,16-Z.length),ee}function changeEndianness(ie){const Z=function(ae,ve,ye){const be=ae[ve];ae[ve]=ae[ye],ae[ye]=be};Z(ie,0,3),Z(ie,1,2),Z(ie,4,5),Z(ie,6,7)}function convertDataUriToArrayBytes(ie){const Z=ie.split(":");let ee=null;if(Z[0]==="data"&&Z.length===2){const ae=Z[1].split(";"),ve=ae[ae.length-1].split(",");if(ve.length===2){const ye=ve[0]==="base64",be=ve[1];ye?(ae.splice(-1,1),ee=base64Decode(be)):ee=getKeyIdBytes(be)}}return ee}function strToUtf8array(ie){return Uint8Array.from(unescape(encodeURIComponent(ie)),Z=>Z.charCodeAt(0))}var KeySystems={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},KeySystemFormats={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function keySystemFormatToKeySystemDomain(ie){switch(ie){case KeySystemFormats.FAIRPLAY:return KeySystems.FAIRPLAY;case KeySystemFormats.PLAYREADY:return KeySystems.PLAYREADY;case KeySystemFormats.WIDEVINE:return KeySystems.WIDEVINE;case KeySystemFormats.CLEARKEY:return KeySystems.CLEARKEY}}var KeySystemIds={WIDEVINE:"edef8ba979d64acea3c827dcd51d21ed"};function keySystemIdToKeySystemDomain(ie){if(ie===KeySystemIds.WIDEVINE)return KeySystems.WIDEVINE}function keySystemDomainToKeySystemFormat(ie){switch(ie){case KeySystems.FAIRPLAY:return KeySystemFormats.FAIRPLAY;case KeySystems.PLAYREADY:return KeySystemFormats.PLAYREADY;case KeySystems.WIDEVINE:return KeySystemFormats.WIDEVINE;case KeySystems.CLEARKEY:return KeySystemFormats.CLEARKEY}}function getKeySystemsForConfig(ie){const{drmSystems:Z,widevineLicenseUrl:ee}=ie,ae=Z?[KeySystems.FAIRPLAY,KeySystems.WIDEVINE,KeySystems.PLAYREADY,KeySystems.CLEARKEY].filter(ve=>!!Z[ve]):[];return!ae[KeySystems.WIDEVINE]&&ee&&ae.push(KeySystems.WIDEVINE),ae}const requestMediaKeySystemAccess=function(){return typeof self<"u"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function getSupportedMediaKeySystemConfigurations(ie,Z,ee,ae){let ve;switch(ie){case KeySystems.FAIRPLAY:ve=["cenc","sinf"];break;case KeySystems.WIDEVINE:case KeySystems.PLAYREADY:ve=["cenc"];break;case KeySystems.CLEARKEY:ve=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${ie}`)}return createMediaKeySystemConfigurations(ve,Z,ee,ae)}function createMediaKeySystemConfigurations(ie,Z,ee,ae){return[{initDataTypes:ie,persistentState:ae.persistentState||"not-allowed",distinctiveIdentifier:ae.distinctiveIdentifier||"not-allowed",sessionTypes:ae.sessionTypes||[ae.sessionType||"temporary"],audioCapabilities:Z.map(ye=>({contentType:`audio/mp4; codecs="${ye}"`,robustness:ae.audioRobustness||"",encryptionScheme:ae.audioEncryptionScheme||null})),videoCapabilities:ee.map(ye=>({contentType:`video/mp4; codecs="${ye}"`,robustness:ae.videoRobustness||"",encryptionScheme:ae.videoEncryptionScheme||null}))}]}function sliceUint8(ie,Z,ee){return Uint8Array.prototype.slice?ie.slice(Z,ee):new Uint8Array(Array.prototype.slice.call(ie,Z,ee))}const isHeader$2=(ie,Z)=>Z+10<=ie.length&&ie[Z]===73&&ie[Z+1]===68&&ie[Z+2]===51&&ie[Z+3]<255&&ie[Z+4]<255&&ie[Z+6]<128&&ie[Z+7]<128&&ie[Z+8]<128&&ie[Z+9]<128,isFooter=(ie,Z)=>Z+10<=ie.length&&ie[Z]===51&&ie[Z+1]===68&&ie[Z+2]===73&&ie[Z+3]<255&&ie[Z+4]<255&&ie[Z+6]<128&&ie[Z+7]<128&&ie[Z+8]<128&&ie[Z+9]<128,getID3Data=(ie,Z)=>{const ee=Z;let ae=0;for(;isHeader$2(ie,Z);){ae+=10;const ve=readSize(ie,Z+6);ae+=ve,isFooter(ie,Z+10)&&(ae+=10),Z+=ae}if(ae>0)return ie.subarray(ee,ee+ae)},readSize=(ie,Z)=>{let ee=0;return ee=(ie[Z]&127)<<21,ee|=(ie[Z+1]&127)<<14,ee|=(ie[Z+2]&127)<<7,ee|=ie[Z+3]&127,ee},canParse$2=(ie,Z)=>isHeader$2(ie,Z)&&readSize(ie,Z+6)+10<=ie.length-Z,getTimeStamp=ie=>{const Z=getID3Frames(ie);for(let ee=0;ee<Z.length;ee++){const ae=Z[ee];if(isTimeStampFrame(ae))return readTimeStamp(ae)}},isTimeStampFrame=ie=>ie&&ie.key==="PRIV"&&ie.info==="com.apple.streaming.transportStreamTimestamp",getFrameData=ie=>{const Z=String.fromCharCode(ie[0],ie[1],ie[2],ie[3]),ee=readSize(ie,4),ae=10;return{type:Z,size:ee,data:ie.subarray(ae,ae+ee)}},getID3Frames=ie=>{let Z=0;const ee=[];for(;isHeader$2(ie,Z);){const ae=readSize(ie,Z+6);Z+=10;const ve=Z+ae;for(;Z+8<ve;){const ye=getFrameData(ie.subarray(Z)),be=decodeFrame(ye);be&&ee.push(be),Z+=ye.size+10}isFooter(ie,Z)&&(Z+=10)}return ee},decodeFrame=ie=>ie.type==="PRIV"?decodePrivFrame(ie):ie.type[0]==="W"?decodeURLFrame(ie):decodeTextFrame(ie),decodePrivFrame=ie=>{if(ie.size<2)return;const Z=utf8ArrayToStr(ie.data,!0),ee=new Uint8Array(ie.data.subarray(Z.length+1));return{key:ie.type,info:Z,data:ee.buffer}},decodeTextFrame=ie=>{if(ie.size<2)return;if(ie.type==="TXXX"){let ee=1;const ae=utf8ArrayToStr(ie.data.subarray(ee),!0);ee+=ae.length+1;const ve=utf8ArrayToStr(ie.data.subarray(ee));return{key:ie.type,info:ae,data:ve}}const Z=utf8ArrayToStr(ie.data.subarray(1));return{key:ie.type,data:Z}},decodeURLFrame=ie=>{if(ie.type==="WXXX"){if(ie.size<2)return;let ee=1;const ae=utf8ArrayToStr(ie.data.subarray(ee),!0);ee+=ae.length+1;const ve=utf8ArrayToStr(ie.data.subarray(ee));return{key:ie.type,info:ae,data:ve}}const Z=utf8ArrayToStr(ie.data);return{key:ie.type,data:Z}},readTimeStamp=ie=>{if(ie.data.byteLength===8){const Z=new Uint8Array(ie.data),ee=Z[3]&1;let ae=(Z[4]<<23)+(Z[5]<<15)+(Z[6]<<7)+Z[7];return ae/=45,ee&&(ae+=4772185884e-2),Math.round(ae)}},utf8ArrayToStr=(ie,Z=!1)=>{const ee=getTextDecoder();if(ee){const Xe=ee.decode(ie);if(Z){const Qe=Xe.indexOf("\0");return Qe!==-1?Xe.substring(0,Qe):Xe}return Xe.replace(/\0/g,"")}const ae=ie.length;let ve,ye,be,Ke="",Ye=0;for(;Ye<ae;){if(ve=ie[Ye++],ve===0&&Z)return Ke;if(ve===0||ve===3)continue;switch(ve>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:Ke+=String.fromCharCode(ve);break;case 12:case 13:ye=ie[Ye++],Ke+=String.fromCharCode((ve&31)<<6|ye&63);break;case 14:ye=ie[Ye++],be=ie[Ye++],Ke+=String.fromCharCode((ve&15)<<12|(ye&63)<<6|(be&63)<<0);break}}return Ke};let decoder;function getTextDecoder(){if(!navigator.userAgent.includes("PlayStation 4"))return!decoder&&typeof self.TextDecoder<"u"&&(decoder=new self.TextDecoder("utf-8")),decoder}const Hex={hexDump:function(ie){let Z="";for(let ee=0;ee<ie.length;ee++){let ae=ie[ee].toString(16);ae.length<2&&(ae="0"+ae),Z+=ae}return Z}},UINT32_MAX$1=Math.pow(2,32)-1,push=[].push,RemuxerTrackIdConfig={video:1,audio:2,id3:3,text:4};function bin2str(ie){return String.fromCharCode.apply(null,ie)}function readUint16(ie,Z){const ee=ie[Z]<<8|ie[Z+1];return ee<0?65536+ee:ee}function readUint32(ie,Z){const ee=readSint32(ie,Z);return ee<0?4294967296+ee:ee}function readSint32(ie,Z){return ie[Z]<<24|ie[Z+1]<<16|ie[Z+2]<<8|ie[Z+3]}function writeUint32(ie,Z,ee){ie[Z]=ee>>24,ie[Z+1]=ee>>16&255,ie[Z+2]=ee>>8&255,ie[Z+3]=ee&255}function findBox(ie,Z){const ee=[];if(!Z.length)return ee;const ae=ie.byteLength;for(let ve=0;ve<ae;){const ye=readUint32(ie,ve),be=bin2str(ie.subarray(ve+4,ve+8)),Ke=ye>1?ve+ye:ae;if(be===Z[0])if(Z.length===1)ee.push(ie.subarray(ve+8,Ke));else{const Ye=findBox(ie.subarray(ve+8,Ke),Z.slice(1));Ye.length&&push.apply(ee,Ye)}ve=Ke}return ee}function parseSegmentIndex(ie){const Z=[],ee=ie[0];let ae=8;const ve=readUint32(ie,ae);ae+=4;const ye=0,be=0;ee===0?ae+=8:ae+=16,ae+=2;let Ke=ie.length+be;const Ye=readUint16(ie,ae);ae+=2;for(let Xe=0;Xe<Ye;Xe++){let Qe=ae;const et=readUint32(ie,Qe);Qe+=4;const Je=et&2147483647;if((et&2147483648)>>>31===1)return logger.warn("SIDX has hierarchical references (not supported)"),null;const it=readUint32(ie,Qe);Qe+=4,Z.push({referenceSize:Je,subsegmentDuration:it,info:{duration:it/ve,start:Ke,end:Ke+Je-1}}),Ke+=Je,Qe+=4,ae=Qe}return{earliestPresentationTime:ye,timescale:ve,version:ee,referencesCount:Ye,references:Z}}function parseInitSegment(ie){const Z=[],ee=findBox(ie,["moov","trak"]);for(let ve=0;ve<ee.length;ve++){const ye=ee[ve],be=findBox(ye,["tkhd"])[0];if(be){let Ke=be[0],Ye=Ke===0?12:20;const Xe=readUint32(be,Ye),Qe=findBox(ye,["mdia","mdhd"])[0];if(Qe){Ke=Qe[0],Ye=Ke===0?12:20;const et=readUint32(Qe,Ye),Je=findBox(ye,["mdia","hdlr"])[0];if(Je){const rt=bin2str(Je.subarray(8,12)),it={soun:ElementaryStreamTypes.AUDIO,vide:ElementaryStreamTypes.VIDEO}[rt];if(it){const nt=findBox(ye,["mdia","minf","stbl","stsd"])[0];let tt;nt&&(tt=bin2str(nt.subarray(12,16))),Z[Xe]={timescale:et,type:it},Z[it]={timescale:et,id:Xe,codec:tt}}}}}}return findBox(ie,["moov","mvex","trex"]).forEach(ve=>{const ye=readUint32(ve,4),be=Z[ye];be&&(be.default={duration:readUint32(ve,12),flags:readUint32(ve,20)})}),Z}function patchEncyptionData(ie,Z){if(!ie||!Z)return ie;const ee=Z.keyId;return ee&&Z.isCommonEncryption&&findBox(ie,["moov","trak"]).forEach(ve=>{const be=findBox(ve,["mdia","minf","stbl","stsd"])[0].subarray(8);let Ke=findBox(be,["enca"]);const Ye=Ke.length>0;Ye||(Ke=findBox(be,["encv"])),Ke.forEach(Xe=>{const Qe=Ye?Xe.subarray(28):Xe.subarray(78);findBox(Qe,["sinf"]).forEach(Je=>{const rt=parseSinf(Je);if(rt){const it=rt.subarray(8,24);it.some(nt=>nt!==0)||(logger.log(`[eme] Patching keyId in 'enc${Ye?"a":"v"}>sinf>>tenc' box: ${Hex.hexDump(it)} -> ${Hex.hexDump(ee)}`),rt.set(ee,8))}})})}),ie}function parseSinf(ie){const Z=findBox(ie,["schm"])[0];if(Z){const ee=bin2str(Z.subarray(4,8));if(ee==="cbcs"||ee==="cenc")return findBox(ie,["schi","tenc"])[0]}return logger.error("[eme] missing 'schm' box"),null}function getStartDTS(ie,Z){return findBox(Z,["moof","traf"]).reduce((ee,ae)=>{const ve=findBox(ae,["tfdt"])[0],ye=ve[0],be=findBox(ae,["tfhd"]).reduce((Ke,Ye)=>{const Xe=readUint32(Ye,4),Qe=ie[Xe];if(Qe){let et=readUint32(ve,4);if(ye===1){if(et===UINT32_MAX$1)return logger.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),Ke;et*=UINT32_MAX$1+1,et+=readUint32(ve,8)}const Je=Qe.timescale||9e4,rt=et/Je;if(isFiniteNumber(rt)&&(Ke===null||rt<Ke))return rt}return Ke},null);return be!==null&&isFiniteNumber(be)&&(ee===null||be<ee)?be:ee},null)}function getDuration(ie,Z){let ee=0,ae=0,ve=0;const ye=findBox(ie,["moof","traf"]);for(let be=0;be<ye.length;be++){const Ke=ye[be],Ye=findBox(Ke,["tfhd"])[0],Xe=readUint32(Ye,4),Qe=Z[Xe];if(!Qe)continue;const et=Qe.default,Je=readUint32(Ye,0)|(et==null?void 0:et.flags);let rt=et==null?void 0:et.duration;Je&8&&(Je&2?rt=readUint32(Ye,12):rt=readUint32(Ye,8));const it=Qe.timescale||9e4,nt=findBox(Ke,["trun"]);for(let tt=0;tt<nt.length;tt++){if(ee=computeRawDurationFromSamples(nt[tt]),!ee&&rt){const st=readUint32(nt[tt],4);ee=rt*st}Qe.type===ElementaryStreamTypes.VIDEO?ae+=ee/it:Qe.type===ElementaryStreamTypes.AUDIO&&(ve+=ee/it)}}if(ae===0&&ve===0){let be=0;const Ke=findBox(ie,["sidx"]);for(let Ye=0;Ye<Ke.length;Ye++){const Xe=parseSegmentIndex(Ke[Ye]);Xe!=null&&Xe.references&&(be+=Xe.references.reduce((Qe,et)=>Qe+et.info.duration||0,0))}return be}return ae||ve}function computeRawDurationFromSamples(ie){const Z=readUint32(ie,0);let ee=8;Z&1&&(ee+=4),Z&4&&(ee+=4);let ae=0;const ve=readUint32(ie,4);for(let ye=0;ye<ve;ye++){if(Z&256){const be=readUint32(ie,ee);ae+=be,ee+=4}Z&512&&(ee+=4),Z&1024&&(ee+=4),Z&2048&&(ee+=4)}return ae}function offsetStartDTS(ie,Z,ee){findBox(Z,["moof","traf"]).forEach(ae=>{findBox(ae,["tfhd"]).forEach(ve=>{const ye=readUint32(ve,4),be=ie[ye];if(!be)return;const Ke=be.timescale||9e4;findBox(ae,["tfdt"]).forEach(Ye=>{const Xe=Ye[0];let Qe=readUint32(Ye,4);if(Xe===0)Qe-=ee*Ke,Qe=Math.max(Qe,0),writeUint32(Ye,4,Qe);else{Qe*=Math.pow(2,32),Qe+=readUint32(Ye,8),Qe-=ee*Ke,Qe=Math.max(Qe,0);const et=Math.floor(Qe/(UINT32_MAX$1+1)),Je=Math.floor(Qe%(UINT32_MAX$1+1));writeUint32(Ye,4,et),writeUint32(Ye,8,Je)}})})})}function segmentValidRange(ie){const Z={valid:null,remainder:null},ee=findBox(ie,["moof"]);if(ee){if(ee.length<2)return Z.remainder=ie,Z}else return Z;const ae=ee[ee.length-1];return Z.valid=sliceUint8(ie,0,ae.byteOffset-8),Z.remainder=sliceUint8(ie,ae.byteOffset-8),Z}function appendUint8Array(ie,Z){const ee=new Uint8Array(ie.length+Z.length);return ee.set(ie),ee.set(Z,ie.length),ee}function parseSamples(ie,Z){const ee=[],ae=Z.samples,ve=Z.timescale,ye=Z.id;let be=!1;return findBox(ae,["moof"]).map(Ye=>{const Xe=Ye.byteOffset-8;findBox(Ye,["traf"]).map(et=>{const Je=findBox(et,["tfdt"]).map(rt=>{const it=rt[0];let nt=readUint32(rt,4);return it===1&&(nt*=Math.pow(2,32),nt+=readUint32(rt,8)),nt/ve})[0];return Je!==void 0&&(ie=Je),findBox(et,["tfhd"]).map(rt=>{const it=readUint32(rt,4),nt=readUint32(rt,0)&16777215,tt=(nt&1)!==0,st=(nt&2)!==0,ot=(nt&8)!==0;let ut=0;const ft=(nt&16)!==0;let pt=0;const Xr=(nt&32)!==0;let mt=8;it===ye&&(tt&&(mt+=8),st&&(mt+=4),ot&&(ut=readUint32(rt,mt),mt+=4),ft&&(pt=readUint32(rt,mt),mt+=4),Xr&&(mt+=4),Z.type==="video"&&(be=isHEVC(Z.codec)),findBox(et,["trun"]).map(Yr=>{const ri=Yr[0],Zr=readUint32(Yr,0)&16777215,_r=(Zr&1)!==0;let Kr=0;const si=(Zr&4)!==0,oi=(Zr&256)!==0;let Qr=0;const ii=(Zr&512)!==0;let ti=0;const ni=(Zr&1024)!==0,ui=(Zr&2048)!==0;let yi=0;const pi=readUint32(Yr,4);let gi=8;_r&&(Kr=readUint32(Yr,gi),gi+=4),si&&(gi+=4);let Ri=Kr+Xe;for(let Ei=0;Ei<pi;Ei++){if(oi?(Qr=readUint32(Yr,gi),gi+=4):Qr=ut,ii?(ti=readUint32(Yr,gi),gi+=4):ti=pt,ni&&(gi+=4),ui&&(ri===0?yi=readUint32(Yr,gi):yi=readSint32(Yr,gi),gi+=4),Z.type===ElementaryStreamTypes.VIDEO){let xi=0;for(;xi<ti;){const Ii=readUint32(ae,Ri);if(Ri+=4,isSEIMessage(be,ae[Ri])){const vi=ae.subarray(Ri,Ri+Ii);parseSEIMessageFromNALu(vi,be?2:1,ie+yi/ve,ee)}Ri+=Ii,xi+=Ii+4}}ie+=Qr/ve}}))})})}),ee}function isHEVC(ie){if(!ie)return!1;const Z=ie.indexOf("."),ee=Z<0?ie:ie.substring(0,Z);return ee==="hvc1"||ee==="hev1"||ee==="dvh1"||ee==="dvhe"}function isSEIMessage(ie,Z){if(ie){const ee=Z>>1&63;return ee===39||ee===40}else return(Z&31)===6}function parseSEIMessageFromNALu(ie,Z,ee,ae){const ve=discardEPB(ie);let ye=0;ye+=Z;let be=0,Ke=0,Ye=!1,Xe=0;for(;ye<ve.length;){be=0;do{if(ye>=ve.length)break;Xe=ve[ye++],be+=Xe}while(Xe===255);Ke=0;do{if(ye>=ve.length)break;Xe=ve[ye++],Ke+=Xe}while(Xe===255);const Qe=ve.length-ye;if(!Ye&&be===4&&ye<ve.length){if(Ye=!0,ve[ye++]===181){const Je=readUint16(ve,ye);if(ye+=2,Je===49){const rt=readUint32(ve,ye);if(ye+=4,rt===1195456820){const it=ve[ye++];if(it===3){const nt=ve[ye++],tt=31&nt,st=64&nt,ot=st?2+tt*3:0,ut=new Uint8Array(ot);if(st){ut[0]=nt;for(let ft=1;ft<ot;ft++)ut[ft]=ve[ye++]}ae.push({type:it,payloadType:be,pts:ee,bytes:ut})}}}}}else if(be===5&&Ke<Qe){if(Ye=!0,Ke>16){const et=[];for(let it=0;it<16;it++){const nt=ve[ye++].toString(16);et.push(nt.length==1?"0"+nt:nt),(it===3||it===5||it===7||it===9)&&et.push("-")}const Je=Ke-16,rt=new Uint8Array(Je);for(let it=0;it<Je;it++)rt[it]=ve[ye++];ae.push({payloadType:be,pts:ee,uuid:et.join(""),userData:utf8ArrayToStr(rt),userDataBytes:rt})}}else if(Ke<Qe)ye+=Ke;else if(Ke>Qe)break}}function discardEPB(ie){const Z=ie.byteLength,ee=[];let ae=1;for(;ae<Z-2;)ie[ae]===0&&ie[ae+1]===0&&ie[ae+2]===3?(ee.push(ae+2),ae+=2):ae++;if(ee.length===0)return ie;const ve=Z-ee.length,ye=new Uint8Array(ve);let be=0;for(ae=0;ae<ve;be++,ae++)be===ee[0]&&(be++,ee.shift()),ye[ae]=ie[be];return ye}function parseEmsg(ie){const Z=ie[0];let ee="",ae="",ve=0,ye=0,be=0,Ke=0,Ye=0,Xe=0;if(Z===0){for(;bin2str(ie.subarray(Xe,Xe+1))!=="\0";)ee+=bin2str(ie.subarray(Xe,Xe+1)),Xe+=1;for(ee+=bin2str(ie.subarray(Xe,Xe+1)),Xe+=1;bin2str(ie.subarray(Xe,Xe+1))!=="\0";)ae+=bin2str(ie.subarray(Xe,Xe+1)),Xe+=1;ae+=bin2str(ie.subarray(Xe,Xe+1)),Xe+=1,ve=readUint32(ie,12),ye=readUint32(ie,16),Ke=readUint32(ie,20),Ye=readUint32(ie,24),Xe=28}else if(Z===1){Xe+=4,ve=readUint32(ie,Xe),Xe+=4;const et=readUint32(ie,Xe);Xe+=4;const Je=readUint32(ie,Xe);for(Xe+=4,be=2**32*et+Je,isSafeInteger(be)||(be=Number.MAX_SAFE_INTEGER,logger.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),Ke=readUint32(ie,Xe),Xe+=4,Ye=readUint32(ie,Xe),Xe+=4;bin2str(ie.subarray(Xe,Xe+1))!=="\0";)ee+=bin2str(ie.subarray(Xe,Xe+1)),Xe+=1;for(ee+=bin2str(ie.subarray(Xe,Xe+1)),Xe+=1;bin2str(ie.subarray(Xe,Xe+1))!=="\0";)ae+=bin2str(ie.subarray(Xe,Xe+1)),Xe+=1;ae+=bin2str(ie.subarray(Xe,Xe+1)),Xe+=1}const Qe=ie.subarray(Xe,ie.byteLength);return{schemeIdUri:ee,value:ae,timeScale:ve,presentationTime:be,presentationTimeDelta:ye,eventDuration:Ke,id:Ye,payload:Qe}}function mp4Box(ie,...Z){const ee=Z.length;let ae=8,ve=ee;for(;ve--;)ae+=Z[ve].byteLength;const ye=new Uint8Array(ae);for(ye[0]=ae>>24&255,ye[1]=ae>>16&255,ye[2]=ae>>8&255,ye[3]=ae&255,ye.set(ie,4),ve=0,ae=8;ve<ee;ve++)ye.set(Z[ve],ae),ae+=Z[ve].byteLength;return ye}function mp4pssh(ie,Z,ee){if(ie.byteLength!==16)throw new RangeError("Invalid system id");let ae,ve;if(Z){ae=1,ve=new Uint8Array(Z.length*16);for(let Ke=0;Ke<Z.length;Ke++){const Ye=Z[Ke];if(Ye.byteLength!==16)throw new RangeError("Invalid key");ve.set(Ye,Ke*16)}}else ae=0,ve=new Uint8Array;let ye;ae>0?(ye=new Uint8Array(4),Z.length>0&&new DataView(ye.buffer).setUint32(0,Z.length,!1)):ye=new Uint8Array;const be=new Uint8Array(4);return ee&&ee.byteLength>0&&new DataView(be.buffer).setUint32(0,ee.byteLength,!1),mp4Box([112,115,115,104],new Uint8Array([ae,0,0,0]),ie,ye,ve,be,ee||new Uint8Array)}function parsePssh(ie){if(!(ie instanceof ArrayBuffer)||ie.byteLength<32)return null;const Z={version:0,systemId:"",kids:null,data:null},ee=new DataView(ie),ae=ee.getUint32(0);if(ie.byteLength!==ae&&ae>44||ee.getUint32(4)!==1886614376||(Z.version=ee.getUint32(8)>>>24,Z.version>1))return null;Z.systemId=Hex.hexDump(new Uint8Array(ie,12,16));const ye=ee.getUint32(28);if(Z.version===0){if(ae-32<ye)return null;Z.data=new Uint8Array(ie,32,ye)}else if(Z.version===1){Z.kids=[];for(let be=0;be<ye;be++)Z.kids.push(new Uint8Array(ie,32+be*16,16))}return Z}let keyUriToKeyIdMap={};class LevelKey{static clearKeyUriToKeyIdMap(){keyUriToKeyIdMap={}}constructor(Z,ee,ae,ve=[1],ye=null){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=Z,this.uri=ee,this.keyFormat=ae,this.keyFormatVersions=ve,this.iv=ye,this.encrypted=Z?Z!=="NONE":!1,this.isCommonEncryption=this.encrypted&&Z!=="AES-128"}isSupported(){if(this.method){if(this.method==="AES-128"||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case KeySystemFormats.FAIRPLAY:case KeySystemFormats.WIDEVINE:case KeySystemFormats.PLAYREADY:case KeySystemFormats.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(Z){if(!this.encrypted||!this.uri)return null;if(this.method==="AES-128"&&this.uri&&!this.iv){typeof Z!="number"&&(this.method==="AES-128"&&!this.iv&&logger.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),Z=0);const ae=createInitializationVector(Z);return new LevelKey(this.method,this.uri,"identity",this.keyFormatVersions,ae)}const ee=convertDataUriToArrayBytes(this.uri);if(ee)switch(this.keyFormat){case KeySystemFormats.WIDEVINE:this.pssh=ee,ee.length>=22&&(this.keyId=ee.subarray(ee.length-22,ee.length-6));break;case KeySystemFormats.PLAYREADY:{const ae=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=mp4pssh(ae,null,ee);const ve=new Uint16Array(ee.buffer,ee.byteOffset,ee.byteLength/2),ye=String.fromCharCode.apply(null,Array.from(ve)),be=ye.substring(ye.indexOf("<"),ye.length),Xe=new DOMParser().parseFromString(be,"text/xml").getElementsByTagName("KID")[0];if(Xe){const Qe=Xe.childNodes[0]?Xe.childNodes[0].nodeValue:Xe.getAttribute("VALUE");if(Qe){const et=base64Decode(Qe).subarray(0,16);changeEndianness(et),this.keyId=et}}break}default:{let ae=ee.subarray(0,16);if(ae.length!==16){const ve=new Uint8Array(16);ve.set(ae,16-ae.length),ae=ve}this.keyId=ae;break}}if(!this.keyId||this.keyId.byteLength!==16){let ae=keyUriToKeyIdMap[this.uri];if(!ae){const ve=Object.keys(keyUriToKeyIdMap).length%Number.MAX_SAFE_INTEGER;ae=new Uint8Array(16),new DataView(ae.buffer,12,4).setUint32(0,ve),keyUriToKeyIdMap[this.uri]=ae}this.keyId=ae}return this}}function createInitializationVector(ie){const Z=new Uint8Array(16);for(let ee=12;ee<16;ee++)Z[ee]=ie>>8*(15-ee)&255;return Z}const VARIABLE_REPLACEMENT_REGEX=/\{\$([a-zA-Z0-9-_]+)\}/g;function hasVariableReferences(ie){return VARIABLE_REPLACEMENT_REGEX.test(ie)}function substituteVariablesInAttributes(ie,Z,ee){if(ie.variableList!==null||ie.hasVariableRefs)for(let ae=ee.length;ae--;){const ve=ee[ae],ye=Z[ve];ye&&(Z[ve]=substituteVariables(ie,ye))}}function substituteVariables(ie,Z){if(ie.variableList!==null||ie.hasVariableRefs){const ee=ie.variableList;return Z.replace(VARIABLE_REPLACEMENT_REGEX,ae=>{const ve=ae.substring(2,ae.length-1),ye=ee==null?void 0:ee[ve];return ye===void 0?(ie.playlistParsingError||(ie.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${ve}"`)),ae):ye})}return Z}function addVariableDefinition(ie,Z,ee){let ae=ie.variableList;ae||(ie.variableList=ae={});let ve,ye;if("QUERYPARAM"in Z){ve=Z.QUERYPARAM;try{const be=new self.URL(ee).searchParams;if(be.has(ve))ye=be.get(ve);else throw new Error(`"${ve}" does not match any query parameter in URI: "${ee}"`)}catch(be){ie.playlistParsingError||(ie.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${be.message}`))}}else ve=Z.NAME,ye=Z.VALUE;ve in ae?ie.playlistParsingError||(ie.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${ve}"`)):ae[ve]=ye||""}function importVariableDefinition(ie,Z,ee){const ae=Z.IMPORT;if(ee&&ae in ee){let ve=ie.variableList;ve||(ie.variableList=ve={}),ve[ae]=ee[ae]}else ie.playlistParsingError||(ie.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${ae}"`))}function getMediaSource(){if(!(typeof self>"u"))return self.MediaSource||self.WebKitMediaSource}const sampleEntryCodesISO={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}},MediaSource$2=getMediaSource();function isCodecType(ie,Z){const ee=sampleEntryCodesISO[Z];return!!ee&&ee[ie.slice(0,4)]===!0}function isCodecSupportedInMp4(ie,Z){var ee;return(ee=MediaSource$2==null?void 0:MediaSource$2.isTypeSupported(`${Z||"video"}/mp4;codecs="${ie}"`))!=null?ee:!1}const MASTER_PLAYLIST_REGEX=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,MASTER_PLAYLIST_MEDIA_REGEX=/#EXT-X-MEDIA:(.*)/g,IS_MEDIA_PLAYLIST=/^#EXT(?:INF|-X-TARGETDURATION):/m,LEVEL_PLAYLIST_REGEX_FAST=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),LEVEL_PLAYLIST_REGEX_SLOW=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class M3U8Parser{static findGroup(Z,ee){for(let ae=0;ae<Z.length;ae++){const ve=Z[ae];if(ve.id===ee)return ve}}static convertAVC1ToAVCOTI(Z){const ee=Z.split(".");if(ee.length>2){let ae=ee.shift()+".";return ae+=parseInt(ee.shift()).toString(16),ae+=("000"+parseInt(ee.shift()).toString(16)).slice(-4),ae}return Z}static resolve(Z,ee){return urlToolkitExports.buildAbsoluteURL(ee,Z,{alwaysNormalize:!0})}static isMediaPlaylist(Z){return IS_MEDIA_PLAYLIST.test(Z)}static parseMasterPlaylist(Z,ee){const ae=hasVariableReferences(Z),ve={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:ae},ye=[];MASTER_PLAYLIST_REGEX.lastIndex=0;let be;for(;(be=MASTER_PLAYLIST_REGEX.exec(Z))!=null;)if(be[1]){var Ke;const Xe=new AttrList(be[1]);substituteVariablesInAttributes(ve,Xe,["CODECS","SUPPLEMENTAL-CODECS","ALLOWED-CPC","PATHWAY-ID","STABLE-VARIANT-ID","AUDIO","VIDEO","SUBTITLES","CLOSED-CAPTIONS","NAME"]);const Qe=substituteVariables(ve,be[2]),et={attrs:Xe,bitrate:Xe.decimalInteger("AVERAGE-BANDWIDTH")||Xe.decimalInteger("BANDWIDTH"),name:Xe.NAME,url:M3U8Parser.resolve(Qe,ee)},Je=Xe.decimalResolution("RESOLUTION");Je&&(et.width=Je.width,et.height=Je.height),setCodecs((Xe.CODECS||"").split(/[ ,]+/).filter(rt=>rt),et),et.videoCodec&&et.videoCodec.indexOf("avc1")!==-1&&(et.videoCodec=M3U8Parser.convertAVC1ToAVCOTI(et.videoCodec)),(Ke=et.unknownCodecs)!=null&&Ke.length||ye.push(et),ve.levels.push(et)}else if(be[3]){const Xe=be[3],Qe=be[4];switch(Xe){case"SESSION-DATA":{const et=new AttrList(Qe);substituteVariablesInAttributes(ve,et,["DATA-ID","LANGUAGE","VALUE","URI"]);const Je=et["DATA-ID"];Je&&(ve.sessionData===null&&(ve.sessionData={}),ve.sessionData[Je]=et);break}case"SESSION-KEY":{const et=parseKey(Qe,ee,ve);et.encrypted&&et.isSupported()?(ve.sessionKeys===null&&(ve.sessionKeys=[]),ve.sessionKeys.push(et)):logger.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${Qe}"`);break}case"DEFINE":{{const et=new AttrList(Qe);substituteVariablesInAttributes(ve,et,["NAME","VALUE","QUERYPARAM"]),addVariableDefinition(ve,et,ee)}break}case"CONTENT-STEERING":{const et=new AttrList(Qe);substituteVariablesInAttributes(ve,et,["SERVER-URI","PATHWAY-ID"]),ve.contentSteering={uri:M3U8Parser.resolve(et["SERVER-URI"],ee),pathwayId:et["PATHWAY-ID"]||"."};break}case"START":{ve.startTimeOffset=parseStartTimeOffset(Qe);break}}}const Ye=ye.length>0&&ye.length<ve.levels.length;return ve.levels=Ye?ye:ve.levels,ve.levels.length===0&&(ve.playlistParsingError=new Error("no levels found in manifest")),ve}static parseMasterPlaylistMedia(Z,ee,ae){let ve;const ye={},be=ae.levels,Ke={AUDIO:be.map(Xe=>({id:Xe.attrs.AUDIO,audioCodec:Xe.audioCodec})),SUBTITLES:be.map(Xe=>({id:Xe.attrs.SUBTITLES,textCodec:Xe.textCodec})),"CLOSED-CAPTIONS":[]};let Ye=0;for(MASTER_PLAYLIST_MEDIA_REGEX.lastIndex=0;(ve=MASTER_PLAYLIST_MEDIA_REGEX.exec(Z))!==null;){const Xe=new AttrList(ve[1]),Qe=Xe.TYPE;if(Qe){const et=Ke[Qe],Je=ye[Qe]||[];ye[Qe]=Je,substituteVariablesInAttributes(ae,Xe,["URI","GROUP-ID","LANGUAGE","ASSOC-LANGUAGE","STABLE-RENDITION-ID","NAME","INSTREAM-ID","CHARACTERISTICS","CHANNELS"]);const rt={attrs:Xe,bitrate:0,id:Ye++,groupId:Xe["GROUP-ID"]||"",instreamId:Xe["INSTREAM-ID"],name:Xe.NAME||Xe.LANGUAGE||"",type:Qe,default:Xe.bool("DEFAULT"),autoselect:Xe.bool("AUTOSELECT"),forced:Xe.bool("FORCED"),lang:Xe.LANGUAGE,url:Xe.URI?M3U8Parser.resolve(Xe.URI,ee):""};if(et!=null&&et.length){const it=M3U8Parser.findGroup(et,rt.groupId)||et[0];assignCodec(rt,it,"audioCodec"),assignCodec(rt,it,"textCodec")}Je.push(rt)}}return ye}static parseLevelPlaylist(Z,ee,ae,ve,ye,be){const Ke=new LevelDetails(ee),Ye=Ke.fragments;let Xe=null,Qe=0,et=0,Je=0,rt=0,it=null,nt=new Fragment(ve,ee),tt,st,ot,ut=-1,ft=!1;for(LEVEL_PLAYLIST_REGEX_FAST.lastIndex=0,Ke.m3u8=Z,Ke.hasVariableRefs=hasVariableReferences(Z);(tt=LEVEL_PLAYLIST_REGEX_FAST.exec(Z))!==null;){ft&&(ft=!1,nt=new Fragment(ve,ee),nt.start=Je,nt.sn=Qe,nt.cc=rt,nt.level=ae,Xe&&(nt.initSegment=Xe,nt.rawProgramDateTime=Xe.rawProgramDateTime,Xe.rawProgramDateTime=null));const Yr=tt[1];if(Yr){nt.duration=parseFloat(Yr);const ri=(" "+tt[2]).slice(1);nt.title=ri||null,nt.tagList.push(ri?["INF",Yr,ri]:["INF",Yr])}else if(tt[3]){if(isFiniteNumber(nt.duration)){nt.start=Je,ot&&setFragLevelKeys(nt,ot,Ke),nt.sn=Qe,nt.level=ae,nt.cc=rt,nt.urlId=ye,Ye.push(nt);const ri=(" "+tt[3]).slice(1);nt.relurl=substituteVariables(Ke,ri),assignProgramDateTime(nt,it),it=nt,Je+=nt.duration,Qe++,et=0,ft=!0}}else if(tt[4]){const ri=(" "+tt[4]).slice(1);it?nt.setByteRange(ri,it):nt.setByteRange(ri)}else if(tt[5])nt.rawProgramDateTime=(" "+tt[5]).slice(1),nt.tagList.push(["PROGRAM-DATE-TIME",nt.rawProgramDateTime]),ut===-1&&(ut=Ye.length);else{if(tt=tt[0].match(LEVEL_PLAYLIST_REGEX_SLOW),!tt){logger.warn("No matches on slow regex match for level playlist!");continue}for(st=1;st<tt.length&&!(typeof tt[st]<"u");st++);const ri=(" "+tt[st]).slice(1),Zr=(" "+tt[st+1]).slice(1),_r=tt[st+2]?(" "+tt[st+2]).slice(1):"";switch(ri){case"PLAYLIST-TYPE":Ke.type=Zr.toUpperCase();break;case"MEDIA-SEQUENCE":Qe=Ke.startSN=parseInt(Zr);break;case"SKIP":{const Kr=new AttrList(Zr);substituteVariablesInAttributes(Ke,Kr,["RECENTLY-REMOVED-DATERANGES"]);const si=Kr.decimalInteger("SKIPPED-SEGMENTS");if(isFiniteNumber(si)){Ke.skippedSegments=si;for(let Qr=si;Qr--;)Ye.unshift(null);Qe+=si}const oi=Kr.enumeratedString("RECENTLY-REMOVED-DATERANGES");oi&&(Ke.recentlyRemovedDateranges=oi.split("	"));break}case"TARGETDURATION":Ke.targetduration=Math.max(parseInt(Zr),1);break;case"VERSION":Ke.version=parseInt(Zr);break;case"EXTM3U":break;case"ENDLIST":Ke.live=!1;break;case"#":(Zr||_r)&&nt.tagList.push(_r?[Zr,_r]:[Zr]);break;case"DISCONTINUITY":rt++,nt.tagList.push(["DIS"]);break;case"GAP":nt.gap=!0,nt.tagList.push([ri]);break;case"BITRATE":nt.tagList.push([ri,Zr]);break;case"DATERANGE":{const Kr=new AttrList(Zr);substituteVariablesInAttributes(Ke,Kr,["ID","CLASS","START-DATE","END-DATE","SCTE35-CMD","SCTE35-OUT","SCTE35-IN"]),substituteVariablesInAttributes(Ke,Kr,Kr.clientAttrs);const si=new DateRange(Kr,Ke.dateRanges[Kr.ID]);si.isValid||Ke.skippedSegments?Ke.dateRanges[si.id]=si:logger.warn(`Ignoring invalid DATERANGE tag: "${Zr}"`),nt.tagList.push(["EXT-X-DATERANGE",Zr]);break}case"DEFINE":{{const Kr=new AttrList(Zr);substituteVariablesInAttributes(Ke,Kr,["NAME","VALUE","IMPORT","QUERYPARAM"]),"IMPORT"in Kr?importVariableDefinition(Ke,Kr,be):addVariableDefinition(Ke,Kr,ee)}break}case"DISCONTINUITY-SEQUENCE":rt=parseInt(Zr);break;case"KEY":{const Kr=parseKey(Zr,ee,Ke);if(Kr.isSupported()){if(Kr.method==="NONE"){ot=void 0;break}ot||(ot={}),ot[Kr.keyFormat]&&(ot=_extends({},ot)),ot[Kr.keyFormat]=Kr}else logger.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${Zr}"`);break}case"START":Ke.startTimeOffset=parseStartTimeOffset(Zr);break;case"MAP":{const Kr=new AttrList(Zr);if(substituteVariablesInAttributes(Ke,Kr,["BYTERANGE","URI"]),nt.duration){const si=new Fragment(ve,ee);setInitSegment(si,Kr,ae,ot),Xe=si,nt.initSegment=Xe,Xe.rawProgramDateTime&&!nt.rawProgramDateTime&&(nt.rawProgramDateTime=Xe.rawProgramDateTime)}else setInitSegment(nt,Kr,ae,ot),Xe=nt,ft=!0;break}case"SERVER-CONTROL":{const Kr=new AttrList(Zr);Ke.canBlockReload=Kr.bool("CAN-BLOCK-RELOAD"),Ke.canSkipUntil=Kr.optionalFloat("CAN-SKIP-UNTIL",0),Ke.canSkipDateRanges=Ke.canSkipUntil>0&&Kr.bool("CAN-SKIP-DATERANGES"),Ke.partHoldBack=Kr.optionalFloat("PART-HOLD-BACK",0),Ke.holdBack=Kr.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{const Kr=new AttrList(Zr);Ke.partTarget=Kr.decimalFloatingPoint("PART-TARGET");break}case"PART":{let Kr=Ke.partList;Kr||(Kr=Ke.partList=[]);const si=et>0?Kr[Kr.length-1]:void 0,oi=et++,Qr=new AttrList(Zr);substituteVariablesInAttributes(Ke,Qr,["BYTERANGE","URI"]);const ii=new Part(Qr,nt,ee,oi,si);Kr.push(ii),nt.duration+=ii.duration;break}case"PRELOAD-HINT":{const Kr=new AttrList(Zr);substituteVariablesInAttributes(Ke,Kr,["URI"]),Ke.preloadHint=Kr;break}case"RENDITION-REPORT":{const Kr=new AttrList(Zr);substituteVariablesInAttributes(Ke,Kr,["URI"]),Ke.renditionReports=Ke.renditionReports||[],Ke.renditionReports.push(Kr);break}default:logger.warn(`line parsed but not handled: ${tt}`);break}}}it&&!it.relurl?(Ye.pop(),Je-=it.duration,Ke.partList&&(Ke.fragmentHint=it)):Ke.partList&&(assignProgramDateTime(nt,it),nt.cc=rt,Ke.fragmentHint=nt,ot&&setFragLevelKeys(nt,ot,Ke));const pt=Ye.length,Xr=Ye[0],mt=Ye[pt-1];if(Je+=Ke.skippedSegments*Ke.targetduration,Je>0&&pt&&mt){Ke.averagetargetduration=Je/pt;const Yr=mt.sn;Ke.endSN=Yr!=="initSegment"?Yr:0,Ke.live||(mt.endList=!0),Xr&&(Ke.startCC=Xr.cc)}else Ke.endSN=0,Ke.startCC=0;return Ke.fragmentHint&&(Je+=Ke.fragmentHint.duration),Ke.totalduration=Je,Ke.endCC=rt,ut>0&&backfillProgramDateTimes(Ye,ut),Ke}}function parseKey(ie,Z,ee){var ae,ve;const ye=new AttrList(ie);substituteVariablesInAttributes(ee,ye,["KEYFORMAT","KEYFORMATVERSIONS","URI","IV","URI"]);const be=(ae=ye.METHOD)!=null?ae:"",Ke=ye.URI,Ye=ye.hexadecimalInteger("IV"),Xe=ye.KEYFORMATVERSIONS,Qe=(ve=ye.KEYFORMAT)!=null?ve:"identity";Ke&&ye.IV&&!Ye&&logger.error(`Invalid IV: ${ye.IV}`);const et=Ke?M3U8Parser.resolve(Ke,Z):"",Je=(Xe||"1").split("/").map(Number).filter(Number.isFinite);return new LevelKey(be,et,Qe,Je,Ye)}function parseStartTimeOffset(ie){const ee=new AttrList(ie).decimalFloatingPoint("TIME-OFFSET");return isFiniteNumber(ee)?ee:null}function setCodecs(ie,Z){["video","audio","text"].forEach(ee=>{const ae=ie.filter(ve=>isCodecType(ve,ee));if(ae.length){const ve=ae.filter(ye=>ye.lastIndexOf("avc1",0)===0||ye.lastIndexOf("mp4a",0)===0);Z[`${ee}Codec`]=ve.length>0?ve[0]:ae[0],ie=ie.filter(ye=>ae.indexOf(ye)===-1)}}),Z.unknownCodecs=ie}function assignCodec(ie,Z,ee){const ae=Z[ee];ae&&(ie[ee]=ae)}function backfillProgramDateTimes(ie,Z){let ee=ie[Z];for(let ae=Z;ae--;){const ve=ie[ae];if(!ve)return;ve.programDateTime=ee.programDateTime-ve.duration*1e3,ee=ve}}function assignProgramDateTime(ie,Z){ie.rawProgramDateTime?ie.programDateTime=Date.parse(ie.rawProgramDateTime):Z!=null&&Z.programDateTime&&(ie.programDateTime=Z.endProgramDateTime),isFiniteNumber(ie.programDateTime)||(ie.programDateTime=null,ie.rawProgramDateTime=null)}function setInitSegment(ie,Z,ee,ae){ie.relurl=Z.URI,Z.BYTERANGE&&ie.setByteRange(Z.BYTERANGE),ie.level=ee,ie.sn="initSegment",ae&&(ie.levelkeys=ae),ie.initSegment=null}function setFragLevelKeys(ie,Z,ee){ie.levelkeys=Z;const{encryptedFragments:ae}=ee;(!ae.length||ae[ae.length-1].levelkeys!==Z)&&Object.keys(Z).some(ve=>Z[ve].isCommonEncryption)&&ae.push(ie)}var PlaylistContextType={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},PlaylistLevelType={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};function mapContextToLevelType(ie){const{type:Z}=ie;switch(Z){case PlaylistContextType.AUDIO_TRACK:return PlaylistLevelType.AUDIO;case PlaylistContextType.SUBTITLE_TRACK:return PlaylistLevelType.SUBTITLE;default:return PlaylistLevelType.MAIN}}function getResponseUrl(ie,Z){let ee=ie.url;return(ee===void 0||ee.indexOf("data:")===0)&&(ee=Z.url),ee}class PlaylistLoader{constructor(Z){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=Z,this.registerListeners()}startLoad(Z){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:Z}=this;Z.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),Z.on(Events.LEVEL_LOADING,this.onLevelLoading,this),Z.on(Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),Z.on(Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}unregisterListeners(){const{hls:Z}=this;Z.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),Z.off(Events.LEVEL_LOADING,this.onLevelLoading,this),Z.off(Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),Z.off(Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}createInternalLoader(Z){const ee=this.hls.config,ae=ee.pLoader,ve=ee.loader,ye=ae||ve,be=new ye(ee);return this.loaders[Z.type]=be,be}getInternalLoader(Z){return this.loaders[Z.type]}resetInternalLoader(Z){this.loaders[Z]&&delete this.loaders[Z]}destroyInternalLoaders(){for(const Z in this.loaders){const ee=this.loaders[Z];ee&&ee.destroy(),this.resetInternalLoader(Z)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(Z,ee){const{url:ae}=ee;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:PlaylistContextType.MANIFEST,url:ae,deliveryDirectives:null})}onLevelLoading(Z,ee){const{id:ae,level:ve,url:ye,deliveryDirectives:be}=ee;this.load({id:ae,level:ve,responseType:"text",type:PlaylistContextType.LEVEL,url:ye,deliveryDirectives:be})}onAudioTrackLoading(Z,ee){const{id:ae,groupId:ve,url:ye,deliveryDirectives:be}=ee;this.load({id:ae,groupId:ve,level:null,responseType:"text",type:PlaylistContextType.AUDIO_TRACK,url:ye,deliveryDirectives:be})}onSubtitleTrackLoading(Z,ee){const{id:ae,groupId:ve,url:ye,deliveryDirectives:be}=ee;this.load({id:ae,groupId:ve,level:null,responseType:"text",type:PlaylistContextType.SUBTITLE_TRACK,url:ye,deliveryDirectives:be})}load(Z){var ee;const ae=this.hls.config;let ve=this.getInternalLoader(Z);if(ve){const Xe=ve.context;if(Xe&&Xe.url===Z.url){logger.trace("[playlist-loader]: playlist request ongoing");return}logger.log(`[playlist-loader]: aborting previous loader for type: ${Z.type}`),ve.abort()}let ye;if(Z.type===PlaylistContextType.MANIFEST?ye=ae.manifestLoadPolicy.default:ye=_extends({},ae.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),ve=this.createInternalLoader(Z),(ee=Z.deliveryDirectives)!=null&&ee.part){let Xe;if(Z.type===PlaylistContextType.LEVEL&&Z.level!==null?Xe=this.hls.levels[Z.level].details:Z.type===PlaylistContextType.AUDIO_TRACK&&Z.id!==null?Xe=this.hls.audioTracks[Z.id].details:Z.type===PlaylistContextType.SUBTITLE_TRACK&&Z.id!==null&&(Xe=this.hls.subtitleTracks[Z.id].details),Xe){const Qe=Xe.partTarget,et=Xe.targetduration;if(Qe&&et){const Je=Math.max(Qe*3,et*.8)*1e3;ye=_extends({},ye,{maxTimeToFirstByteMs:Math.min(Je,ye.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(Je,ye.maxTimeToFirstByteMs)})}}}const be=ye.errorRetry||ye.timeoutRetry||{},Ke={loadPolicy:ye,timeout:ye.maxLoadTimeMs,maxRetry:be.maxNumRetry||0,retryDelay:be.retryDelayMs||0,maxRetryDelay:be.maxRetryDelayMs||0},Ye={onSuccess:(Xe,Qe,et,Je)=>{const rt=this.getInternalLoader(et);this.resetInternalLoader(et.type);const it=Xe.data;if(it.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(Xe,et,new Error("no EXTM3U delimiter"),Je||null,Qe);return}Qe.parsing.start=performance.now(),M3U8Parser.isMediaPlaylist(it)?this.handleTrackOrLevelPlaylist(Xe,Qe,et,Je||null,rt):this.handleMasterPlaylist(Xe,Qe,et,Je)},onError:(Xe,Qe,et,Je)=>{this.handleNetworkError(Qe,et,!1,Xe,Je)},onTimeout:(Xe,Qe,et)=>{this.handleNetworkError(Qe,et,!0,void 0,Xe)}};ve.load(Z,Ke,Ye)}handleMasterPlaylist(Z,ee,ae,ve){const ye=this.hls,be=Z.data,Ke=getResponseUrl(Z,ae),Ye=M3U8Parser.parseMasterPlaylist(be,Ke);if(Ye.playlistParsingError){this.handleManifestParsingError(Z,ae,Ye.playlistParsingError,ve,ee);return}const{contentSteering:Xe,levels:Qe,sessionData:et,sessionKeys:Je,startTimeOffset:rt,variableList:it}=Ye;this.variableList=it;const{AUDIO:nt=[],SUBTITLES:tt,"CLOSED-CAPTIONS":st}=M3U8Parser.parseMasterPlaylistMedia(be,Ke,Ye);nt.length&&!nt.some(ut=>!ut.url)&&Qe[0].audioCodec&&!Qe[0].attrs.AUDIO&&(logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),nt.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new AttrList({}),bitrate:0,url:""})),ye.trigger(Events.MANIFEST_LOADED,{levels:Qe,audioTracks:nt,subtitles:tt,captions:st,contentSteering:Xe,url:Ke,stats:ee,networkDetails:ve,sessionData:et,sessionKeys:Je,startTimeOffset:rt,variableList:it})}handleTrackOrLevelPlaylist(Z,ee,ae,ve,ye){const be=this.hls,{id:Ke,level:Ye,type:Xe}=ae,Qe=getResponseUrl(Z,ae),et=isFiniteNumber(Ke)?Ke:0,Je=isFiniteNumber(Ye)?Ye:et,rt=mapContextToLevelType(ae),it=M3U8Parser.parseLevelPlaylist(Z.data,Qe,Je,rt,et,this.variableList);if(Xe===PlaylistContextType.MANIFEST){const nt={attrs:new AttrList({}),bitrate:0,details:it,name:"",url:Qe};be.trigger(Events.MANIFEST_LOADED,{levels:[nt],audioTracks:[],url:Qe,stats:ee,networkDetails:ve,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}ee.parsing.end=performance.now(),ae.levelDetails=it,this.handlePlaylistLoaded(it,Z,ee,ae,ve,ye)}handleManifestParsingError(Z,ee,ae,ve,ye){this.hls.trigger(Events.ERROR,{type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.MANIFEST_PARSING_ERROR,fatal:ee.type===PlaylistContextType.MANIFEST,url:Z.url,err:ae,error:ae,reason:ae.message,response:Z,context:ee,networkDetails:ve,stats:ye})}handleNetworkError(Z,ee,ae=!1,ve,ye){let be=`A network ${ae?"timeout":"error"+(ve?" (status "+ve.code+")":"")} occurred while loading ${Z.type}`;Z.type===PlaylistContextType.LEVEL?be+=`: ${Z.level} id: ${Z.id}`:(Z.type===PlaylistContextType.AUDIO_TRACK||Z.type===PlaylistContextType.SUBTITLE_TRACK)&&(be+=` id: ${Z.id} group-id: "${Z.groupId}"`);const Ke=new Error(be);logger.warn(`[playlist-loader]: ${be}`);let Ye=ErrorDetails.UNKNOWN,Xe=!1;const Qe=this.getInternalLoader(Z);switch(Z.type){case PlaylistContextType.MANIFEST:Ye=ae?ErrorDetails.MANIFEST_LOAD_TIMEOUT:ErrorDetails.MANIFEST_LOAD_ERROR,Xe=!0;break;case PlaylistContextType.LEVEL:Ye=ae?ErrorDetails.LEVEL_LOAD_TIMEOUT:ErrorDetails.LEVEL_LOAD_ERROR,Xe=!1;break;case PlaylistContextType.AUDIO_TRACK:Ye=ae?ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:ErrorDetails.AUDIO_TRACK_LOAD_ERROR,Xe=!1;break;case PlaylistContextType.SUBTITLE_TRACK:Ye=ae?ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:ErrorDetails.SUBTITLE_LOAD_ERROR,Xe=!1;break}Qe&&this.resetInternalLoader(Z.type);const et={type:ErrorTypes.NETWORK_ERROR,details:Ye,fatal:Xe,url:Z.url,loader:Qe,context:Z,error:Ke,networkDetails:ee,stats:ye};if(ve){const Je=(ee==null?void 0:ee.url)||Z.url;et.response=_objectSpread2({url:Je,data:void 0},ve)}this.hls.trigger(Events.ERROR,et)}handlePlaylistLoaded(Z,ee,ae,ve,ye,be){const Ke=this.hls,{type:Ye,level:Xe,id:Qe,groupId:et,deliveryDirectives:Je}=ve,rt=getResponseUrl(ee,ve),it=mapContextToLevelType(ve),nt=typeof ve.level=="number"&&it===PlaylistLevelType.MAIN?Xe:void 0;if(!Z.fragments.length){const st=new Error("No Segments found in Playlist");Ke.trigger(Events.ERROR,{type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:rt,error:st,reason:st.message,response:ee,context:ve,level:nt,parent:it,networkDetails:ye,stats:ae});return}Z.targetduration||(Z.playlistParsingError=new Error("Missing Target Duration"));const tt=Z.playlistParsingError;if(tt){Ke.trigger(Events.ERROR,{type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.LEVEL_PARSING_ERROR,fatal:!1,url:rt,error:tt,reason:tt.message,response:ee,context:ve,level:nt,parent:it,networkDetails:ye,stats:ae});return}switch(Z.live&&be&&(be.getCacheAge&&(Z.ageHeader=be.getCacheAge()||0),(!be.getCacheAge||isNaN(Z.ageHeader))&&(Z.ageHeader=0)),Ye){case PlaylistContextType.MANIFEST:case PlaylistContextType.LEVEL:Ke.trigger(Events.LEVEL_LOADED,{details:Z,level:nt||0,id:Qe||0,stats:ae,networkDetails:ye,deliveryDirectives:Je});break;case PlaylistContextType.AUDIO_TRACK:Ke.trigger(Events.AUDIO_TRACK_LOADED,{details:Z,id:Qe||0,groupId:et||"",stats:ae,networkDetails:ye,deliveryDirectives:Je});break;case PlaylistContextType.SUBTITLE_TRACK:Ke.trigger(Events.SUBTITLE_TRACK_LOADED,{details:Z,id:Qe||0,groupId:et||"",stats:ae,networkDetails:ye,deliveryDirectives:Je});break}}}function sendAddTrackEvent(ie,Z){let ee;try{ee=new Event("addtrack")}catch{ee=document.createEvent("Event"),ee.initEvent("addtrack",!1,!1)}ee.track=ie,Z.dispatchEvent(ee)}function addCueToTrack(ie,Z){const ee=ie.mode;if(ee==="disabled"&&(ie.mode="hidden"),ie.cues&&!ie.cues.getCueById(Z.id))try{if(ie.addCue(Z),!ie.cues.getCueById(Z.id))throw new Error(`addCue is failed for: ${Z}`)}catch(ae){logger.debug(`[texttrack-utils]: ${ae}`);try{const ve=new self.TextTrackCue(Z.startTime,Z.endTime,Z.text);ve.id=Z.id,ie.addCue(ve)}catch(ve){logger.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${ve}`)}}ee==="disabled"&&(ie.mode=ee)}function clearCurrentCues(ie){const Z=ie.mode;if(Z==="disabled"&&(ie.mode="hidden"),ie.cues)for(let ee=ie.cues.length;ee--;)ie.removeCue(ie.cues[ee]);Z==="disabled"&&(ie.mode=Z)}function removeCuesInRange(ie,Z,ee,ae){const ve=ie.mode;if(ve==="disabled"&&(ie.mode="hidden"),ie.cues&&ie.cues.length>0){const ye=getCuesInRange(ie.cues,Z,ee);for(let be=0;be<ye.length;be++)(!ae||ae(ye[be]))&&ie.removeCue(ye[be])}ve==="disabled"&&(ie.mode=ve)}function getFirstCueIndexAfterTime(ie,Z){if(Z<ie[0].startTime)return 0;const ee=ie.length-1;if(Z>ie[ee].endTime)return-1;let ae=0,ve=ee;for(;ae<=ve;){const ye=Math.floor((ve+ae)/2);if(Z<ie[ye].startTime)ve=ye-1;else if(Z>ie[ye].startTime&&ae<ee)ae=ye+1;else return ye}return ie[ae].startTime-Z<Z-ie[ve].startTime?ae:ve}function getCuesInRange(ie,Z,ee){const ae=[],ve=getFirstCueIndexAfterTime(ie,Z);if(ve>-1)for(let ye=ve,be=ie.length;ye<be;ye++){const Ke=ie[ye];if(Ke.startTime>=Z&&Ke.endTime<=ee)ae.push(Ke);else if(Ke.startTime>ee)return ae}return ae}var MetadataSchema={audioId3:"org.id3",dateRange:"com.apple.quicktime.HLS",emsg:"https://aomedia.org/emsg/ID3"};const MIN_CUE_DURATION=.25;function getCueClass(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function createCueWithDataFields(ie,Z,ee,ae,ve){let ye=new ie(Z,ee,"");try{ye.value=ae,ve&&(ye.type=ve)}catch{ye=new ie(Z,ee,JSON.stringify(ve?_objectSpread2({type:ve},ae):ae))}return ye}const MAX_CUE_ENDTIME=(()=>{const ie=getCueClass();try{ie&&new ie(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();function dateRangeDateToTimelineSeconds(ie,Z){return ie.getTime()/1e3-Z}function hexToArrayBuffer(ie){return Uint8Array.from(ie.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}class ID3TrackController{constructor(Z){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=Z,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null}_registerListeners(){const{hls:Z}=this;Z.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),Z.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),Z.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),Z.on(Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),Z.on(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),Z.on(Events.LEVEL_UPDATED,this.onLevelUpdated,this)}_unregisterListeners(){const{hls:Z}=this;Z.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),Z.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),Z.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),Z.off(Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),Z.off(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),Z.off(Events.LEVEL_UPDATED,this.onLevelUpdated,this)}onMediaAttached(Z,ee){this.media=ee.media}onMediaDetaching(){this.id3Track&&(clearCurrentCues(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(Z){const ee=this.getID3Track(Z.textTracks);return ee.mode="hidden",ee}getID3Track(Z){if(this.media){for(let ee=0;ee<Z.length;ee++){const ae=Z[ee];if(ae.kind==="metadata"&&ae.label==="id3")return sendAddTrackEvent(ae,this.media),ae}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(Z,ee){if(!this.media)return;const{hls:{config:{enableEmsgMetadataCues:ae,enableID3MetadataCues:ve}}}=this;if(!ae&&!ve)return;const{samples:ye}=ee;this.id3Track||(this.id3Track=this.createTrack(this.media));const be=getCueClass();if(be)for(let Ke=0;Ke<ye.length;Ke++){const Ye=ye[Ke].type;if(Ye===MetadataSchema.emsg&&!ae||!ve)continue;const Xe=getID3Frames(ye[Ke].data);if(Xe){const Qe=ye[Ke].pts;let et=Qe+ye[Ke].duration;et>MAX_CUE_ENDTIME&&(et=MAX_CUE_ENDTIME),et-Qe<=0&&(et=Qe+MIN_CUE_DURATION);for(let rt=0;rt<Xe.length;rt++){const it=Xe[rt];if(!isTimeStampFrame(it)){this.updateId3CueEnds(Qe,Ye);const nt=createCueWithDataFields(be,Qe,et,it,Ye);nt&&this.id3Track.addCue(nt)}}}}}updateId3CueEnds(Z,ee){var ae;const ve=(ae=this.id3Track)==null?void 0:ae.cues;if(ve)for(let ye=ve.length;ye--;){const be=ve[ye];be.type===ee&&be.startTime<Z&&be.endTime===MAX_CUE_ENDTIME&&(be.endTime=Z)}}onBufferFlushing(Z,{startOffset:ee,endOffset:ae,type:ve}){const{id3Track:ye,hls:be}=this;if(!be)return;const{config:{enableEmsgMetadataCues:Ke,enableID3MetadataCues:Ye}}=be;if(ye&&(Ke||Ye)){let Xe;ve==="audio"?Xe=Qe=>Qe.type===MetadataSchema.audioId3&&Ye:ve==="video"?Xe=Qe=>Qe.type===MetadataSchema.emsg&&Ke:Xe=Qe=>Qe.type===MetadataSchema.audioId3&&Ye||Qe.type===MetadataSchema.emsg&&Ke,removeCuesInRange(ye,ee,ae,Xe)}}onLevelUpdated(Z,{details:ee}){if(!this.media||!ee.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;const{dateRangeCuesAppended:ae,id3Track:ve}=this,{dateRanges:ye}=ee,be=Object.keys(ye);if(ve){const Qe=Object.keys(ae).filter(et=>!be.includes(et));for(let et=Qe.length;et--;){const Je=Qe[et];Object.keys(ae[Je].cues).forEach(rt=>{ve.removeCue(ae[Je].cues[rt])}),delete ae[Je]}}const Ke=ee.fragments[ee.fragments.length-1];if(be.length===0||!isFiniteNumber(Ke==null?void 0:Ke.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));const Ye=Ke.programDateTime/1e3-Ke.start,Xe=getCueClass();for(let Qe=0;Qe<be.length;Qe++){const et=be[Qe],Je=ye[et],rt=ae[et],it=(rt==null?void 0:rt.cues)||{};let nt=(rt==null?void 0:rt.durationKnown)||!1;const tt=dateRangeDateToTimelineSeconds(Je.startDate,Ye);let st=MAX_CUE_ENDTIME;const ot=Je.endDate;if(ot)st=dateRangeDateToTimelineSeconds(ot,Ye),nt=!0;else if(Je.endOnNext&&!nt){const ft=be.reduce((pt,Xr)=>{const mt=ye[Xr];return mt.class===Je.class&&mt.id!==Xr&&mt.startDate>Je.startDate&&pt.push(mt),pt},[]).sort((pt,Xr)=>pt.startDate.getTime()-Xr.startDate.getTime())[0];ft&&(st=dateRangeDateToTimelineSeconds(ft.startDate,Ye),nt=!0)}const ut=Object.keys(Je.attr);for(let ft=0;ft<ut.length;ft++){const pt=ut[ft];if(!isDateRangeCueAttribute(pt))continue;const Xr=it[pt];if(Xr)nt&&!rt.durationKnown&&(Xr.endTime=st);else if(Xe){let mt=Je.attr[pt];isSCTE35Attribute(pt)&&(mt=hexToArrayBuffer(mt));const Yr=createCueWithDataFields(Xe,tt,st,{key:pt,data:mt},MetadataSchema.dateRange);Yr&&(Yr.id=et,this.id3Track.addCue(Yr),it[pt]=Yr)}}ae[et]={cues:it,dateRange:Je,durationKnown:nt}}}}class LatencyController{constructor(Z){this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=()=>this.timeupdate(),this.hls=Z,this.config=Z.config,this.registerListeners()}get latency(){return this._latency||0}get maxLatency(){const{config:Z,levelDetails:ee}=this;return Z.liveMaxLatencyDuration!==void 0?Z.liveMaxLatencyDuration:ee?Z.liveMaxLatencyDurationCount*ee.targetduration:0}get targetLatency(){const{levelDetails:Z}=this;if(Z===null)return null;const{holdBack:ee,partHoldBack:ae,targetduration:ve}=Z,{liveSyncDuration:ye,liveSyncDurationCount:be,lowLatencyMode:Ke}=this.config,Ye=this.hls.userConfig;let Xe=Ke&&ae||ee;(Ye.liveSyncDuration||Ye.liveSyncDurationCount||Xe===0)&&(Xe=ye!==void 0?ye:be*ve);const Qe=ve,et=1;return Xe+Math.min(this.stallCount*et,Qe)}get liveSyncPosition(){const Z=this.estimateLiveEdge(),ee=this.targetLatency,ae=this.levelDetails;if(Z===null||ee===null||ae===null)return null;const ve=ae.edge,ye=Z-ee-this.edgeStalled,be=ve-ae.totalduration,Ke=ve-(this.config.lowLatencyMode&&ae.partTarget||ae.targetduration);return Math.min(Math.max(be,ye),Ke)}get drift(){const{levelDetails:Z}=this;return Z===null?1:Z.drift}get edgeStalled(){const{levelDetails:Z}=this;if(Z===null)return 0;const ee=(this.config.lowLatencyMode&&Z.partTarget||Z.targetduration)*3;return Math.max(Z.age-ee,0)}get forwardBufferLength(){const{media:Z,levelDetails:ee}=this;if(!Z||!ee)return 0;const ae=Z.buffered.length;return(ae?Z.buffered.end(ae-1):ee.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null}registerListeners(){this.hls.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(Events.ERROR,this.onError,this)}unregisterListeners(){this.hls.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(Events.ERROR,this.onError,this)}onMediaAttached(Z,ee){this.media=ee.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)}onManifestLoading(){this.levelDetails=null,this._latency=null,this.stallCount=0}onLevelUpdated(Z,{details:ee}){this.levelDetails=ee,ee.advanced&&this.timeupdate(),!ee.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)}onError(Z,ee){var ae;ee.details===ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,(ae=this.levelDetails)!=null&&ae.live&&logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))}timeupdate(){const{media:Z,levelDetails:ee}=this;if(!Z||!ee)return;this.currentTime=Z.currentTime;const ae=this.computeLatency();if(ae===null)return;this._latency=ae;const{lowLatencyMode:ve,maxLiveSyncPlaybackRate:ye}=this.config;if(!ve||ye===1)return;const be=this.targetLatency;if(be===null)return;const Ke=ae-be,Ye=Math.min(this.maxLatency,be+ee.targetduration),Xe=Ke<Ye;if(ee.live&&Xe&&Ke>.05&&this.forwardBufferLength>1){const Qe=Math.min(2,Math.max(1,ye)),et=Math.round(2/(1+Math.exp(-.75*Ke-this.edgeStalled))*20)/20;Z.playbackRate=Math.min(Qe,Math.max(1,et))}else Z.playbackRate!==1&&Z.playbackRate!==0&&(Z.playbackRate=1)}estimateLiveEdge(){const{levelDetails:Z}=this;return Z===null?null:Z.edge+Z.age}computeLatency(){const Z=this.estimateLiveEdge();return Z===null?null:Z-this.currentTime}}const HdcpLevels=["NONE","TYPE-0","TYPE-1",null];var HlsSkip={No:"",Yes:"YES",v2:"v2"};function getSkipValue(ie,Z){const{canSkipUntil:ee,canSkipDateRanges:ae,endSN:ve}=ie,ye=Z!==void 0?Z-ve:0;return ee&&ye<ee?ae?HlsSkip.v2:HlsSkip.Yes:HlsSkip.No}class HlsUrlParameters{constructor(Z,ee,ae){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=Z,this.part=ee,this.skip=ae}addDirectives(Z){const ee=new self.URL(Z);return this.msn!==void 0&&ee.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&ee.searchParams.set("_HLS_part",this.part.toString()),this.skip&&ee.searchParams.set("_HLS_skip",this.skip),ee.href}}class Level{constructor(Z){this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[Z.url],this._attrs=[Z.attrs],this.bitrate=Z.bitrate,Z.details&&(this.details=Z.details),this.id=Z.id||0,this.name=Z.name,this.width=Z.width||0,this.height=Z.height||0,this.audioCodec=Z.audioCodec,this.videoCodec=Z.videoCodec,this.unknownCodecs=Z.unknownCodecs,this.codecSet=[Z.videoCodec,Z.audioCodec].filter(ee=>ee).join(",").replace(/\.[^.,]+/g,"")}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get attrs(){return this._attrs[this._urlId]}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get uri(){return this.url[this._urlId]||""}get urlId(){return this._urlId}set urlId(Z){const ee=Z%this.url.length;this._urlId!==ee&&(this.fragmentError=0,this.loadError=0,this.details=void 0,this._urlId=ee)}get audioGroupId(){var Z;return(Z=this.audioGroupIds)==null?void 0:Z[this.urlId]}get textGroupId(){var Z;return(Z=this.textGroupIds)==null?void 0:Z[this.urlId]}addFallback(Z){this.url.push(Z.url),this._attrs.push(Z.attrs)}}function updateFromToPTS(ie,Z){const ee=Z.startPTS;if(isFiniteNumber(ee)){let ae=0,ve;Z.sn>ie.sn?(ae=ee-ie.start,ve=ie):(ae=ie.start-ee,ve=Z),ve.duration!==ae&&(ve.duration=ae)}else Z.sn>ie.sn?ie.cc===Z.cc&&ie.minEndPTS?Z.start=ie.start+(ie.minEndPTS-ie.start):Z.start=ie.start+ie.duration:Z.start=Math.max(ie.start-Z.duration,0)}function updateFragPTSDTS(ie,Z,ee,ae,ve,ye){ae-ee<=0&&(logger.warn("Fragment should have a positive duration",Z),ae=ee+Z.duration,ye=ve+Z.duration);let Ke=ee,Ye=ae;const Xe=Z.startPTS,Qe=Z.endPTS;if(isFiniteNumber(Xe)){const tt=Math.abs(Xe-ee);isFiniteNumber(Z.deltaPTS)?Z.deltaPTS=Math.max(tt,Z.deltaPTS):Z.deltaPTS=tt,Ke=Math.max(ee,Xe),ee=Math.min(ee,Xe),ve=Math.min(ve,Z.startDTS),Ye=Math.min(ae,Qe),ae=Math.max(ae,Qe),ye=Math.max(ye,Z.endDTS)}const et=ee-Z.start;Z.start!==0&&(Z.start=ee),Z.duration=ae-Z.start,Z.startPTS=ee,Z.maxStartPTS=Ke,Z.startDTS=ve,Z.endPTS=ae,Z.minEndPTS=Ye,Z.endDTS=ye;const Je=Z.sn;if(!ie||Je<ie.startSN||Je>ie.endSN)return 0;let rt;const it=Je-ie.startSN,nt=ie.fragments;for(nt[it]=Z,rt=it;rt>0;rt--)updateFromToPTS(nt[rt],nt[rt-1]);for(rt=it;rt<nt.length-1;rt++)updateFromToPTS(nt[rt],nt[rt+1]);return ie.fragmentHint&&updateFromToPTS(nt[nt.length-1],ie.fragmentHint),ie.PTSKnown=ie.alignedSliding=!0,et}function mergeDetails(ie,Z){let ee=null;const ae=ie.fragments;for(let Ye=ae.length-1;Ye>=0;Ye--){const Xe=ae[Ye].initSegment;if(Xe){ee=Xe;break}}ie.fragmentHint&&delete ie.fragmentHint.endPTS;let ve=0,ye;if(mapFragmentIntersection(ie,Z,(Ye,Xe)=>{Ye.relurl&&(ve=Ye.cc-Xe.cc),isFiniteNumber(Ye.startPTS)&&isFiniteNumber(Ye.endPTS)&&(Xe.start=Xe.startPTS=Ye.startPTS,Xe.startDTS=Ye.startDTS,Xe.maxStartPTS=Ye.maxStartPTS,Xe.endPTS=Ye.endPTS,Xe.endDTS=Ye.endDTS,Xe.minEndPTS=Ye.minEndPTS,Xe.duration=Ye.endPTS-Ye.startPTS,Xe.duration&&(ye=Xe),Z.PTSKnown=Z.alignedSliding=!0),Xe.elementaryStreams=Ye.elementaryStreams,Xe.loader=Ye.loader,Xe.stats=Ye.stats,Xe.urlId=Ye.urlId,Ye.initSegment&&(Xe.initSegment=Ye.initSegment,ee=Ye.initSegment)}),ee&&(Z.fragmentHint?Z.fragments.concat(Z.fragmentHint):Z.fragments).forEach(Xe=>{var Qe;(!Xe.initSegment||Xe.initSegment.relurl===((Qe=ee)==null?void 0:Qe.relurl))&&(Xe.initSegment=ee)}),Z.skippedSegments)if(Z.deltaUpdateFailed=Z.fragments.some(Ye=>!Ye),Z.deltaUpdateFailed){logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let Ye=Z.skippedSegments;Ye--;)Z.fragments.shift();Z.startSN=Z.fragments[0].sn,Z.startCC=Z.fragments[0].cc}else Z.canSkipDateRanges&&(Z.dateRanges=mergeDateRanges(ie.dateRanges,Z.dateRanges,Z.recentlyRemovedDateranges));const be=Z.fragments;if(ve){logger.warn("discontinuity sliding from playlist, take drift into account");for(let Ye=0;Ye<be.length;Ye++)be[Ye].cc+=ve}Z.skippedSegments&&(Z.startCC=Z.fragments[0].cc),mapPartIntersection(ie.partList,Z.partList,(Ye,Xe)=>{Xe.elementaryStreams=Ye.elementaryStreams,Xe.stats=Ye.stats}),ye?updateFragPTSDTS(Z,ye,ye.startPTS,ye.endPTS,ye.startDTS,ye.endDTS):adjustSliding(ie,Z),be.length&&(Z.totalduration=Z.edge-be[0].start),Z.driftStartTime=ie.driftStartTime,Z.driftStart=ie.driftStart;const Ke=Z.advancedDateTime;if(Z.advanced&&Ke){const Ye=Z.edge;Z.driftStart||(Z.driftStartTime=Ke,Z.driftStart=Ye),Z.driftEndTime=Ke,Z.driftEnd=Ye}else Z.driftEndTime=ie.driftEndTime,Z.driftEnd=ie.driftEnd,Z.advancedDateTime=ie.advancedDateTime}function mergeDateRanges(ie,Z,ee){const ae=_extends({},ie);return ee&&ee.forEach(ve=>{delete ae[ve]}),Object.keys(Z).forEach(ve=>{const ye=new DateRange(Z[ve].attr,ae[ve]);ye.isValid?ae[ve]=ye:logger.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${JSON.stringify(Z[ve].attr)}"`)}),ae}function mapPartIntersection(ie,Z,ee){if(ie&&Z){let ae=0;for(let ve=0,ye=ie.length;ve<=ye;ve++){const be=ie[ve],Ke=Z[ve+ae];be&&Ke&&be.index===Ke.index&&be.fragment.sn===Ke.fragment.sn?ee(be,Ke):ae--}}}function mapFragmentIntersection(ie,Z,ee){const ae=Z.skippedSegments,ve=Math.max(ie.startSN,Z.startSN)-Z.startSN,ye=(ie.fragmentHint?1:0)+(ae?Z.endSN:Math.min(ie.endSN,Z.endSN))-Z.startSN,be=Z.startSN-ie.startSN,Ke=Z.fragmentHint?Z.fragments.concat(Z.fragmentHint):Z.fragments,Ye=ie.fragmentHint?ie.fragments.concat(ie.fragmentHint):ie.fragments;for(let Xe=ve;Xe<=ye;Xe++){const Qe=Ye[be+Xe];let et=Ke[Xe];ae&&!et&&Xe<ae&&(et=Z.fragments[Xe]=Qe),Qe&&et&&ee(Qe,et)}}function adjustSliding(ie,Z){const ee=Z.startSN+Z.skippedSegments-ie.startSN,ae=ie.fragments;ee<0||ee>=ae.length||addSliding(Z,ae[ee].start)}function addSliding(ie,Z){if(Z){const ee=ie.fragments;for(let ae=ie.skippedSegments;ae<ee.length;ae++)ee[ae].start+=Z;ie.fragmentHint&&(ie.fragmentHint.start+=Z)}}function computeReloadInterval(ie,Z=1/0){let ee=1e3*ie.targetduration;if(ie.updated){const ae=ie.fragments,ve=4;if(ae.length&&ee*ve>Z){const ye=ae[ae.length-1].duration*1e3;ye<ee&&(ee=ye)}}else ee/=2;return Math.round(ee)}function getFragmentWithSN(ie,Z,ee){if(!(ie!=null&&ie.details))return null;const ae=ie.details;let ve=ae.fragments[Z-ae.startSN];return ve||(ve=ae.fragmentHint,ve&&ve.sn===Z)?ve:Z<ae.startSN&&ee&&ee.sn===Z?ee:null}function getPartWith(ie,Z,ee){var ae;return ie!=null&&ie.details?findPart((ae=ie.details)==null?void 0:ae.partList,Z,ee):null}function findPart(ie,Z,ee){if(ie)for(let ae=ie.length;ae--;){const ve=ie[ae];if(ve.index===ee&&ve.fragment.sn===Z)return ve}return null}function isTimeoutError(ie){switch(ie.details){case ErrorDetails.FRAG_LOAD_TIMEOUT:case ErrorDetails.KEY_LOAD_TIMEOUT:case ErrorDetails.LEVEL_LOAD_TIMEOUT:case ErrorDetails.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function getRetryConfig(ie,Z){const ee=isTimeoutError(Z);return ie.default[`${ee?"timeout":"error"}Retry`]}function getRetryDelay(ie,Z){const ee=ie.backoff==="linear"?1:Math.pow(2,Z);return Math.min(ee*ie.retryDelayMs,ie.maxRetryDelayMs)}function getLoaderConfigWithoutReties(ie){return _objectSpread2(_objectSpread2({},ie),{errorRetry:null,timeoutRetry:null})}function shouldRetry(ie,Z,ee,ae){return!!ie&&Z<ie.maxNumRetry&&(retryForHttpStatus(ae)||!!ee)}function retryForHttpStatus(ie){return ie===0&&navigator.onLine===!1||!!ie&&(ie<400||ie>499)}const BinarySearch={search:function(ie,Z){let ee=0,ae=ie.length-1,ve=null,ye=null;for(;ee<=ae;){ve=(ee+ae)/2|0,ye=ie[ve];const be=Z(ye);if(be>0)ee=ve+1;else if(be<0)ae=ve-1;else return ye}return null}};function findFragmentByPDT(ie,Z,ee){if(Z===null||!Array.isArray(ie)||!ie.length||!isFiniteNumber(Z))return null;const ae=ie[0].programDateTime;if(Z<(ae||0))return null;const ve=ie[ie.length-1].endProgramDateTime;if(Z>=(ve||0))return null;ee=ee||0;for(let ye=0;ye<ie.length;++ye){const be=ie[ye];if(pdtWithinToleranceTest(Z,ee,be))return be}return null}function findFragmentByPTS(ie,Z,ee=0,ae=0){let ve=null;if(ie?ve=Z[ie.sn-Z[0].sn+1]||null:ee===0&&Z[0].start===0&&(ve=Z[0]),ve&&fragmentWithinToleranceTest(ee,ae,ve)===0)return ve;const ye=BinarySearch.search(Z,fragmentWithinToleranceTest.bind(null,ee,ae));return ye&&(ye!==ie||!ve)?ye:ve}function fragmentWithinToleranceTest(ie=0,Z=0,ee){if(ee.start<=ie&&ee.start+ee.duration>ie)return 0;const ae=Math.min(Z,ee.duration+(ee.deltaPTS?ee.deltaPTS:0));return ee.start+ee.duration-ae<=ie?1:ee.start-ae>ie&&ee.start?-1:0}function pdtWithinToleranceTest(ie,Z,ee){const ae=Math.min(Z,ee.duration+(ee.deltaPTS?ee.deltaPTS:0))*1e3;return(ee.endProgramDateTime||0)-ae>ie}function findFragWithCC(ie,Z){return BinarySearch.search(ie,ee=>ee.cc<Z?1:ee.cc>Z?-1:0)}const RENDITION_PENALTY_DURATION_MS=3e5;var NetworkErrorAction={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},ErrorActionFlags={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,SwitchToSDR:4};class ErrorController{constructor(Z){this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=Z,this.log=logger.log.bind(logger,"[info]:"),this.warn=logger.warn.bind(logger,"[warning]:"),this.error=logger.error.bind(logger,"[error]:"),this.registerListeners()}registerListeners(){const Z=this.hls;Z.on(Events.ERROR,this.onError,this),Z.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),Z.on(Events.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const Z=this.hls;Z&&(Z.off(Events.ERROR,this.onError,this),Z.off(Events.ERROR,this.onErrorOut,this),Z.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),Z.off(Events.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(Z){this.playlistError=0}stopLoad(){}getVariantLevelIndex(Z){return(Z==null?void 0:Z.type)===PlaylistLevelType.MAIN?Z.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(Z,ee){var ae,ve;if(ee.fatal)return;const ye=this.hls,be=ee.context;switch(ee.details){case ErrorDetails.FRAG_LOAD_ERROR:case ErrorDetails.FRAG_LOAD_TIMEOUT:case ErrorDetails.KEY_LOAD_ERROR:case ErrorDetails.KEY_LOAD_TIMEOUT:ee.errorAction=this.getFragRetryOrSwitchAction(ee);return;case ErrorDetails.FRAG_PARSING_ERROR:if((ae=ee.frag)!=null&&ae.gap){ee.errorAction={action:NetworkErrorAction.DoNothing,flags:ErrorActionFlags.None};return}case ErrorDetails.FRAG_GAP:case ErrorDetails.FRAG_DECRYPT_ERROR:{ee.errorAction=this.getFragRetryOrSwitchAction(ee),ee.errorAction.action=NetworkErrorAction.SendAlternateToPenaltyBox;return}case ErrorDetails.LEVEL_EMPTY_ERROR:case ErrorDetails.LEVEL_PARSING_ERROR:{var Ke,Ye;const Xe=ee.parent===PlaylistLevelType.MAIN?ee.level:ye.loadLevel;ee.details===ErrorDetails.LEVEL_EMPTY_ERROR&&((Ke=ee.context)!=null&&(Ye=Ke.levelDetails)!=null&&Ye.live)?ee.errorAction=this.getPlaylistRetryOrSwitchAction(ee,Xe):(ee.levelRetry=!1,ee.errorAction=this.getLevelSwitchAction(ee,Xe))}return;case ErrorDetails.LEVEL_LOAD_ERROR:case ErrorDetails.LEVEL_LOAD_TIMEOUT:typeof(be==null?void 0:be.level)=="number"&&(ee.errorAction=this.getPlaylistRetryOrSwitchAction(ee,be.level));return;case ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case ErrorDetails.SUBTITLE_LOAD_ERROR:case ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:if(be){const Xe=ye.levels[ye.loadLevel];if(Xe&&(be.type===PlaylistContextType.AUDIO_TRACK&&be.groupId===Xe.audioGroupId||be.type===PlaylistContextType.SUBTITLE_TRACK&&be.groupId===Xe.textGroupId)){ee.errorAction=this.getPlaylistRetryOrSwitchAction(ee,ye.loadLevel),ee.errorAction.action=NetworkErrorAction.SendAlternateToPenaltyBox,ee.errorAction.flags=ErrorActionFlags.MoveAllAlternatesMatchingHost;return}}return;case ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const Xe=ye.levels[ye.loadLevel],Qe=Xe==null?void 0:Xe.attrs["HDCP-LEVEL"];Qe&&(ee.errorAction={action:NetworkErrorAction.SendAlternateToPenaltyBox,flags:ErrorActionFlags.MoveAllAlternatesMatchingHDCP,hdcpLevel:Qe})}return;case ErrorDetails.BUFFER_ADD_CODEC_ERROR:case ErrorDetails.REMUX_ALLOC_ERROR:ee.errorAction=this.getLevelSwitchAction(ee,(ve=ee.level)!=null?ve:ye.loadLevel);return;case ErrorDetails.INTERNAL_EXCEPTION:case ErrorDetails.BUFFER_APPENDING_ERROR:case ErrorDetails.BUFFER_APPEND_ERROR:case ErrorDetails.BUFFER_FULL_ERROR:case ErrorDetails.LEVEL_SWITCH_ERROR:case ErrorDetails.BUFFER_STALLED_ERROR:case ErrorDetails.BUFFER_SEEK_OVER_HOLE:case ErrorDetails.BUFFER_NUDGE_ON_STALL:ee.errorAction={action:NetworkErrorAction.DoNothing,flags:ErrorActionFlags.None};return}if(ee.type===ErrorTypes.KEY_SYSTEM_ERROR){const Xe=this.getVariantLevelIndex(ee.frag);ee.levelRetry=!1,ee.errorAction=this.getLevelSwitchAction(ee,Xe);return}}getPlaylistRetryOrSwitchAction(Z,ee){var ae;const ve=this.hls,ye=getRetryConfig(ve.config.playlistLoadPolicy,Z),be=this.playlistError++,Ke=(ae=Z.response)==null?void 0:ae.code;if(shouldRetry(ye,be,isTimeoutError(Z),Ke))return{action:NetworkErrorAction.RetryRequest,flags:ErrorActionFlags.None,retryConfig:ye,retryCount:be};const Xe=this.getLevelSwitchAction(Z,ee);return ye&&(Xe.retryConfig=ye,Xe.retryCount=be),Xe}getFragRetryOrSwitchAction(Z){const ee=this.hls,ae=this.getVariantLevelIndex(Z.frag),ve=ee.levels[ae],{fragLoadPolicy:ye,keyLoadPolicy:be}=ee.config,Ke=getRetryConfig(Z.details.startsWith("key")?be:ye,Z),Ye=ee.levels.reduce((et,Je)=>et+Je.fragmentError,0);if(ve){var Xe;Z.details!==ErrorDetails.FRAG_GAP&&ve.fragmentError++;const et=(Xe=Z.response)==null?void 0:Xe.code;if(shouldRetry(Ke,Ye,isTimeoutError(Z),et))return{action:NetworkErrorAction.RetryRequest,flags:ErrorActionFlags.None,retryConfig:Ke,retryCount:Ye}}const Qe=this.getLevelSwitchAction(Z,ae);return Ke&&(Qe.retryConfig=Ke,Qe.retryCount=Ye),Qe}getLevelSwitchAction(Z,ee){const ae=this.hls;ee==null&&(ee=ae.loadLevel);const ve=this.hls.levels[ee];if(ve&&(ve.loadError++,ae.autoLevelEnabled)){var ye,be;let Ke=-1;const{levels:Ye,loadLevel:Xe,minAutoLevel:Qe,maxAutoLevel:et}=ae,Je=(ye=Z.frag)==null?void 0:ye.type,{type:rt,groupId:it}=(be=Z.context)!=null?be:{};for(let nt=Ye.length;nt--;){const tt=(nt+Xe)%Ye.length;if(tt!==Xe&&tt>=Qe&&tt<=et&&Ye[tt].loadError===0){const st=Ye[tt];if(Z.details===ErrorDetails.FRAG_GAP&&Z.frag){const ot=Ye[tt].details;if(ot){const ut=findFragmentByPTS(Z.frag,ot.fragments,Z.frag.start);if(ut!=null&&ut.gap)continue}}else{if(rt===PlaylistContextType.AUDIO_TRACK&&it===st.audioGroupId||rt===PlaylistContextType.SUBTITLE_TRACK&&it===st.textGroupId)continue;if(Je===PlaylistLevelType.AUDIO&&ve.audioGroupId===st.audioGroupId||Je===PlaylistLevelType.SUBTITLE&&ve.textGroupId===st.textGroupId)continue}Ke=tt;break}}if(Ke>-1&&ae.loadLevel!==Ke)return Z.levelRetry=!0,this.playlistError=0,{action:NetworkErrorAction.SendAlternateToPenaltyBox,flags:ErrorActionFlags.None,nextAutoLevel:Ke}}return{action:NetworkErrorAction.SendAlternateToPenaltyBox,flags:ErrorActionFlags.MoveAllAlternatesMatchingHost}}onErrorOut(Z,ee){var ae;switch((ae=ee.errorAction)==null?void 0:ae.action){case NetworkErrorAction.DoNothing:break;case NetworkErrorAction.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(ee),!ee.errorAction.resolved&&ee.details!==ErrorDetails.FRAG_GAP&&(ee.fatal=!0);break}if(ee.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(Z){const ee=this.hls,ae=Z.errorAction;if(!ae)return;const{flags:ve,hdcpLevel:ye,nextAutoLevel:be}=ae;switch(ve){case ErrorActionFlags.None:this.switchLevel(Z,be);break;case ErrorActionFlags.MoveAllAlternatesMatchingHost:ae.resolved||(ae.resolved=this.redundantFailover(Z));break;case ErrorActionFlags.MoveAllAlternatesMatchingHDCP:ye&&(ee.maxHdcpLevel=HdcpLevels[HdcpLevels.indexOf(ye)-1],ae.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${ee.maxHdcpLevel}" or lower`);break}ae.resolved||this.switchLevel(Z,be)}switchLevel(Z,ee){ee!==void 0&&Z.errorAction&&(this.warn(`switching to level ${ee} after ${Z.details}`),this.hls.nextAutoLevel=ee,Z.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)}redundantFailover(Z){const{hls:ee,penalizedRenditions:ae}=this,ve=Z.parent===PlaylistLevelType.MAIN?Z.level:ee.loadLevel,ye=ee.levels[ve],be=ye.url.length,Ke=Z.frag?Z.frag.urlId:ye.urlId;ye.urlId===Ke&&(!Z.frag||ye.details)&&this.penalizeRendition(ye,Z);for(let Ye=1;Ye<be;Ye++){const Xe=(Ke+Ye)%be,Qe=ae[Xe];if(!Qe||checkExpired(Qe,Z,ae[Ke]))return this.warn(`Switching to Redundant Stream ${Xe+1}/${be}: "${ye.url[Xe]}" after ${Z.details}`),this.playlistError=0,ee.levels.forEach(et=>{et.urlId=Xe}),ee.nextLoadLevel=ve,!0}return!1}penalizeRendition(Z,ee){const{penalizedRenditions:ae}=this,ve=ae[Z.urlId]||{lastErrorPerfMs:0,errors:[],details:void 0};ve.lastErrorPerfMs=performance.now(),ve.errors.push(ee),ve.details=Z.details,ae[Z.urlId]=ve}}function checkExpired(ie,Z,ee){if(performance.now()-ie.lastErrorPerfMs>RENDITION_PENALTY_DURATION_MS)return!0;const ae=ie.details;if(Z.details===ErrorDetails.FRAG_GAP&&ae&&Z.frag){const ve=Z.frag.start,ye=findFragmentByPTS(null,ae.fragments,ve);if(ye&&!ye.gap)return!0}if(ee&&ie.errors.length<ee.errors.length){const ve=ie.errors[ie.errors.length-1];if(ae&&ve.frag&&Z.frag&&Math.abs(ve.frag.start-Z.frag.start)>ae.targetduration*3)return!0}return!1}class BasePlaylistController{constructor(Z,ee){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=logger.log.bind(logger,`${ee}:`),this.warn=logger.warn.bind(logger,`${ee}:`),this.hls=Z}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){clearTimeout(this.timer),this.timer=-1}startLoad(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(Z,ee){const ae=ee==null?void 0:ee.renditionReports;if(ae){let ve=-1;for(let ye=0;ye<ae.length;ye++){const be=ae[ye];let Ke;try{Ke=new self.URL(be.URI,ee.url).href}catch(Ye){logger.warn(`Could not construct new URL for Rendition Report: ${Ye}`),Ke=be.URI||""}if(Ke===Z){ve=ye;break}else Ke===Z.substring(0,Ke.length)&&(ve=ye)}if(ve!==-1){const ye=ae[ve],be=parseInt(ye["LAST-MSN"])||(ee==null?void 0:ee.lastPartSn);let Ke=parseInt(ye["LAST-PART"])||(ee==null?void 0:ee.lastPartIndex);if(this.hls.config.lowLatencyMode){const Ye=Math.min(ee.age-ee.partTarget,ee.targetduration);Ke>=0&&Ye>ee.partTarget&&(Ke+=1)}return new HlsUrlParameters(be,Ke>=0?Ke:void 0,HlsSkip.No)}}}loadPlaylist(Z){this.requestScheduled===-1&&(this.requestScheduled=self.performance.now())}shouldLoadPlaylist(Z){return this.canLoad&&!!Z&&!!Z.url&&(!Z.details||Z.details.live)}shouldReloadPlaylist(Z){return this.timer===-1&&this.requestScheduled===-1&&this.shouldLoadPlaylist(Z)}playlistLoaded(Z,ee,ae){const{details:ve,stats:ye}=ee,be=self.performance.now(),Ke=ye.loading.first?Math.max(0,be-ye.loading.first):0;if(ve.advancedDateTime=Date.now()-Ke,ve.live||ae!=null&&ae.live){if(ve.reloaded(ae),ae&&this.log(`live playlist ${Z} ${ve.advanced?"REFRESHED "+ve.lastPartSn+"-"+ve.lastPartIndex:ve.updated?"UPDATED":"MISSED"}`),ae&&ve.fragments.length>0&&mergeDetails(ae,ve),!this.canLoad||!ve.live)return;let Ye,Xe,Qe;if(ve.canBlockReload&&ve.endSN&&ve.advanced){const tt=this.hls.config.lowLatencyMode,st=ve.lastPartSn,ot=ve.endSN,ut=ve.lastPartIndex,ft=ut!==-1,pt=st===ot,Xr=tt?0:ut;ft?(Xe=pt?ot+1:st,Qe=pt?Xr:ut+1):Xe=ot+1;const mt=ve.age,Yr=mt+ve.ageHeader;let ri=Math.min(Yr-ve.partTarget,ve.targetduration*1.5);if(ri>0){if(ae&&ri>ae.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${ae.tuneInGoal} to: ${ri} with playlist age: ${ve.age}`),ri=0;else{const Zr=Math.floor(ri/ve.targetduration);if(Xe+=Zr,Qe!==void 0){const _r=Math.round(ri%ve.targetduration/ve.partTarget);Qe+=_r}this.log(`CDN Tune-in age: ${ve.ageHeader}s last advanced ${mt.toFixed(2)}s goal: ${ri} skip sn ${Zr} to part ${Qe}`)}ve.tuneInGoal=ri}if(Ye=this.getDeliveryDirectives(ve,ee.deliveryDirectives,Xe,Qe),tt||!pt){this.loadPlaylist(Ye);return}}else(ve.canBlockReload||ve.canSkipUntil)&&(Ye=this.getDeliveryDirectives(ve,ee.deliveryDirectives,Xe,Qe));const et=this.hls.mainForwardBufferInfo,Je=et?et.end-et.len:0,rt=(ve.edge-Je)*1e3,it=computeReloadInterval(ve,rt);ve.updated&&be>this.requestScheduled+it&&(this.requestScheduled=ye.loading.start),Xe!==void 0&&ve.canBlockReload?this.requestScheduled=ye.loading.first+it-(ve.partTarget*1e3||1e3):this.requestScheduled===-1||this.requestScheduled+it<be?this.requestScheduled=be:this.requestScheduled-be<=0&&(this.requestScheduled+=it);let nt=this.requestScheduled-be;nt=Math.max(0,nt),this.log(`reload live playlist ${Z} in ${Math.round(nt)} ms`),this.timer=self.setTimeout(()=>this.loadPlaylist(Ye),nt)}else this.clearTimer()}getDeliveryDirectives(Z,ee,ae,ve){let ye=getSkipValue(Z,ae);return ee!=null&&ee.skip&&Z.deltaUpdateFailed&&(ae=ee.msn,ve=ee.part,ye=HlsSkip.No),new HlsUrlParameters(ae,ve,ye)}checkRetry(Z){const ee=Z.details,ae=isTimeoutError(Z),ve=Z.errorAction,{action:ye,retryCount:be=0,retryConfig:Ke}=ve||{},Ye=!!ve&&!!Ke&&(ye===NetworkErrorAction.RetryRequest||!ve.resolved&&ye===NetworkErrorAction.SendAlternateToPenaltyBox);if(Ye){var Xe;if(this.requestScheduled=-1,be>=Ke.maxNumRetry)return!1;if(ae&&(Xe=Z.context)!=null&&Xe.deliveryDirectives)this.warn(`Retrying playlist loading ${be+1}/${Ke.maxNumRetry} after "${ee}" without delivery-directives`),this.loadPlaylist();else{const Qe=getRetryDelay(Ke,be);this.timer=self.setTimeout(()=>this.loadPlaylist(),Qe),this.warn(`Retrying playlist loading ${be+1}/${Ke.maxNumRetry} after "${ee}" in ${Qe}ms`)}Z.levelRetry=!0,ve.resolved=!0}return Ye}}let chromeOrFirefox;class LevelController extends BasePlaylistController{constructor(Z,ee){super(Z,"[level-controller]"),this._levels=[],this._firstLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=ee,this._registerListeners()}_registerListeners(){const{hls:Z}=this;Z.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),Z.on(Events.MANIFEST_LOADED,this.onManifestLoaded,this),Z.on(Events.LEVEL_LOADED,this.onLevelLoaded,this),Z.on(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),Z.on(Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),Z.on(Events.FRAG_LOADED,this.onFragLoaded,this),Z.on(Events.ERROR,this.onError,this)}_unregisterListeners(){const{hls:Z}=this;Z.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),Z.off(Events.MANIFEST_LOADED,this.onManifestLoaded,this),Z.off(Events.LEVEL_LOADED,this.onLevelLoaded,this),Z.off(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),Z.off(Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),Z.off(Events.FRAG_LOADED,this.onFragLoaded,this),Z.off(Events.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}startLoad(){this._levels.forEach(ee=>{ee.loadError=0,ee.fragmentError=0}),super.startLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[]}onManifestLoading(Z,ee){this.resetLevels()}onManifestLoaded(Z,ee){const ae=[],ve={};let ye;ee.levels.forEach(be=>{var Ke;const Ye=be.attrs;((Ke=be.audioCodec)==null?void 0:Ke.indexOf("mp4a.40.34"))!==-1&&(chromeOrFirefox||(chromeOrFirefox=/chrome|firefox/i.test(navigator.userAgent)),chromeOrFirefox&&(be.audioCodec=void 0));const{AUDIO:Xe,CODECS:Qe,"FRAME-RATE":et,"PATHWAY-ID":Je,RESOLUTION:rt,SUBTITLES:it}=Ye,tt=`${`${Je||"."}-`}${be.bitrate}-${rt}-${et}-${Qe}`;ye=ve[tt],ye?ye.addFallback(be):(ye=new Level(be),ve[tt]=ye,ae.push(ye)),addGroupId(ye,"audio",Xe),addGroupId(ye,"text",it)}),this.filterAndSortMediaOptions(ae,ee)}filterAndSortMediaOptions(Z,ee){let ae=[],ve=[],ye=!1,be=!1,Ke=!1,Ye=Z.filter(({audioCodec:rt,videoCodec:it,width:nt,height:tt,unknownCodecs:st})=>(ye||(ye=!!(nt&&tt)),be||(be=!!it),Ke||(Ke=!!rt),!(st!=null&&st.length)&&(!rt||isCodecSupportedInMp4(rt,"audio"))&&(!it||isCodecSupportedInMp4(it,"video"))));if((ye||be)&&Ke&&(Ye=Ye.filter(({videoCodec:rt,width:it,height:nt})=>!!rt||!!(it&&nt))),Ye.length===0){Promise.resolve().then(()=>{if(this.hls){const rt=new Error("no level with compatible codecs found in manifest");this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:ee.url,error:rt,reason:rt.message})}});return}ee.audioTracks&&(ae=ee.audioTracks.filter(rt=>!rt.audioCodec||isCodecSupportedInMp4(rt.audioCodec,"audio")),assignTrackIdsByGroup(ae)),ee.subtitles&&(ve=ee.subtitles,assignTrackIdsByGroup(ve));const Xe=Ye.slice(0);Ye.sort((rt,it)=>rt.attrs["HDCP-LEVEL"]!==it.attrs["HDCP-LEVEL"]?(rt.attrs["HDCP-LEVEL"]||"")>(it.attrs["HDCP-LEVEL"]||"")?1:-1:rt.bitrate!==it.bitrate?rt.bitrate-it.bitrate:rt.attrs["FRAME-RATE"]!==it.attrs["FRAME-RATE"]?rt.attrs.decimalFloatingPoint("FRAME-RATE")-it.attrs.decimalFloatingPoint("FRAME-RATE"):rt.attrs.SCORE!==it.attrs.SCORE?rt.attrs.decimalFloatingPoint("SCORE")-it.attrs.decimalFloatingPoint("SCORE"):ye&&rt.height!==it.height?rt.height-it.height:0);let Qe=Xe[0];if(this.steering&&(Ye=this.steering.filterParsedLevels(Ye),Ye.length!==Xe.length)){for(let rt=0;rt<Xe.length;rt++)if(Xe[rt].pathwayId===Ye[0].pathwayId){Qe=Xe[rt];break}}this._levels=Ye;for(let rt=0;rt<Ye.length;rt++)if(Ye[rt]===Qe){this._firstLevel=rt,this.log(`manifest loaded, ${Ye.length} level(s) found, first bitrate: ${Qe.bitrate}`);break}const et=Ke&&!be,Je={levels:Ye,audioTracks:ae,subtitleTracks:ve,sessionData:ee.sessionData,sessionKeys:ee.sessionKeys,firstLevel:this._firstLevel,stats:ee.stats,audio:Ke,video:be,altAudio:!et&&ae.some(rt=>!!rt.url)};this.hls.trigger(Events.MANIFEST_PARSED,Je),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}get levels(){return this._levels.length===0?null:this._levels}get level(){return this.currentLevelIndex}set level(Z){const ee=this._levels;if(ee.length===0)return;if(Z<0||Z>=ee.length){const Qe=new Error("invalid level idx"),et=Z<0;if(this.hls.trigger(Events.ERROR,{type:ErrorTypes.OTHER_ERROR,details:ErrorDetails.LEVEL_SWITCH_ERROR,level:Z,fatal:et,error:Qe,reason:Qe.message}),et)return;Z=Math.min(Z,ee.length-1)}const ae=this.currentLevelIndex,ve=this.currentLevel,ye=ve?ve.attrs["PATHWAY-ID"]:void 0,be=ee[Z],Ke=be.attrs["PATHWAY-ID"];if(this.currentLevelIndex=Z,this.currentLevel=be,ae===Z&&be.details&&ve&&ye===Ke)return;this.log(`Switching to level ${Z}${Ke?" with Pathway "+Ke:""} from level ${ae}${ye?" with Pathway "+ye:""}`);const Ye=_extends({},be,{level:Z,maxBitrate:be.maxBitrate,attrs:be.attrs,uri:be.uri,urlId:be.urlId});delete Ye._attrs,delete Ye._urlId,this.hls.trigger(Events.LEVEL_SWITCHING,Ye);const Xe=be.details;if(!Xe||Xe.live){const Qe=this.switchParams(be.uri,ve==null?void 0:ve.details);this.loadPlaylist(Qe)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(Z){this.manualLevelIndex=Z,this._startLevel===void 0&&(this._startLevel=Z),Z!==-1&&(this.level=Z)}get firstLevel(){return this._firstLevel}set firstLevel(Z){this._firstLevel=Z}get startLevel(){if(this._startLevel===void 0){const Z=this.hls.config.startLevel;return Z!==void 0?Z:this._firstLevel}else return this._startLevel}set startLevel(Z){this._startLevel=Z}onError(Z,ee){ee.fatal||!ee.context||ee.context.type===PlaylistContextType.LEVEL&&ee.context.level===this.level&&this.checkRetry(ee)}onFragLoaded(Z,{frag:ee}){if(ee!==void 0&&ee.type===PlaylistLevelType.MAIN){const ae=this._levels[ee.level];ae!==void 0&&(ae.loadError=0)}}onLevelLoaded(Z,ee){var ae;const{level:ve,details:ye}=ee,be=this._levels[ve];if(!be){var Ke;this.warn(`Invalid level index ${ve}`),(Ke=ee.deliveryDirectives)!=null&&Ke.skip&&(ye.deltaUpdateFailed=!0);return}ve===this.currentLevelIndex?(be.fragmentError===0&&(be.loadError=0),this.playlistLoaded(ve,ee,be.details)):(ae=ee.deliveryDirectives)!=null&&ae.skip&&(ye.deltaUpdateFailed=!0)}onAudioTrackSwitched(Z,ee){const ae=this.currentLevel;if(!ae)return;const ve=this.hls.audioTracks[ee.id].groupId;if(ae.audioGroupIds&&ae.audioGroupId!==ve){let ye=-1;for(let be=0;be<ae.audioGroupIds.length;be++)if(ae.audioGroupIds[be]===ve){ye=be;break}ye!==-1&&ye!==ae.urlId&&(ae.urlId=ye,this.canLoad&&this.startLoad())}}loadPlaylist(Z){super.loadPlaylist();const ee=this.currentLevelIndex,ae=this.currentLevel;if(ae&&this.shouldLoadPlaylist(ae)){const ve=ae.urlId;let ye=ae.uri;if(Z)try{ye=Z.addDirectives(ye)}catch(Ke){this.warn(`Could not construct new URL with HLS Delivery Directives: ${Ke}`)}const be=ae.attrs["PATHWAY-ID"];this.log(`Loading level index ${ee}${(Z==null?void 0:Z.msn)!==void 0?" at sn "+Z.msn+" part "+Z.part:""} with${be?" Pathway "+be:""} URI ${ve+1}/${ae.url.length} ${ye}`),this.clearTimer(),this.hls.trigger(Events.LEVEL_LOADING,{url:ye,level:ee,id:ve,deliveryDirectives:Z||null})}}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(Z){this.level=Z,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=Z)}removeLevel(Z,ee){const ae=(ye,be)=>be!==ee,ve=this._levels.filter((ye,be)=>be!==Z?!0:ye.url.length>1&&ee!==void 0?(ye.url=ye.url.filter(ae),ye.audioGroupIds&&(ye.audioGroupIds=ye.audioGroupIds.filter(ae)),ye.textGroupIds&&(ye.textGroupIds=ye.textGroupIds.filter(ae)),ye.urlId=0,!0):(this.steering&&this.steering.removeLevel(ye),!1));this.hls.trigger(Events.LEVELS_UPDATED,{levels:ve})}onLevelsUpdated(Z,{levels:ee}){ee.forEach((ae,ve)=>{const{details:ye}=ae;ye!=null&&ye.fragments&&ye.fragments.forEach(be=>{be.level=ve})}),this._levels=ee}}function addGroupId(ie,Z,ee){ee&&(Z==="audio"?(ie.audioGroupIds||(ie.audioGroupIds=[]),ie.audioGroupIds[ie.url.length-1]=ee):Z==="text"&&(ie.textGroupIds||(ie.textGroupIds=[]),ie.textGroupIds[ie.url.length-1]=ee))}function assignTrackIdsByGroup(ie){const Z={};ie.forEach(ee=>{const ae=ee.groupId||"";ee.id=Z[ae]=Z[ae]||0,Z[ae]++})}var FragmentState={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class FragmentTracker{constructor(Z){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=Z,this._registerListeners()}_registerListeners(){const{hls:Z}=this;Z.on(Events.BUFFER_APPENDED,this.onBufferAppended,this),Z.on(Events.FRAG_BUFFERED,this.onFragBuffered,this),Z.on(Events.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){const{hls:Z}=this;Z.off(Events.BUFFER_APPENDED,this.onBufferAppended,this),Z.off(Events.FRAG_BUFFERED,this.onFragBuffered,this),Z.off(Events.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(Z,ee){const ae=this.activePartLists[ee];if(ae)for(let ve=ae.length;ve--;){const ye=ae[ve];if(!ye)break;const be=ye.end;if(ye.start<=Z&&be!==null&&Z<=be)return ye}return this.getBufferedFrag(Z,ee)}getBufferedFrag(Z,ee){const{fragments:ae}=this,ve=Object.keys(ae);for(let ye=ve.length;ye--;){const be=ae[ve[ye]];if((be==null?void 0:be.body.type)===ee&&be.buffered){const Ke=be.body;if(Ke.start<=Z&&Z<=Ke.end)return Ke}}return null}detectEvictedFragments(Z,ee,ae,ve){this.timeRanges&&(this.timeRanges[Z]=ee);const ye=(ve==null?void 0:ve.fragment.sn)||-1;Object.keys(this.fragments).forEach(be=>{const Ke=this.fragments[be];if(!Ke||ye>=Ke.body.sn)return;if(!Ke.buffered&&!Ke.loaded){Ke.body.type===ae&&this.removeFragment(Ke.body);return}const Ye=Ke.range[Z];Ye&&Ye.time.some(Xe=>{const Qe=!this.isTimeBuffered(Xe.startPTS,Xe.endPTS,ee);return Qe&&this.removeFragment(Ke.body),Qe})})}detectPartialFragments(Z){const ee=this.timeRanges,{frag:ae,part:ve}=Z;if(!ee||ae.sn==="initSegment")return;const ye=getFragmentKey(ae),be=this.fragments[ye];if(!be||be.buffered&&ae.gap)return;const Ke=!ae.relurl;Object.keys(ee).forEach(Ye=>{const Xe=ae.elementaryStreams[Ye];if(!Xe)return;const Qe=ee[Ye],et=Ke||Xe.partial===!0;be.range[Ye]=this.getBufferedTimes(ae,ve,et,Qe)}),be.loaded=null,Object.keys(be.range).length?(be.buffered=!0,(be.body.endList=ae.endList||be.body.endList)&&(this.endListFragments[be.body.type]=be),isPartial(be)||this.removeParts(ae.sn-1,ae.type)):this.removeFragment(be.body)}removeParts(Z,ee){const ae=this.activePartLists[ee];ae&&(this.activePartLists[ee]=ae.filter(ve=>ve.fragment.sn>=Z))}fragBuffered(Z,ee){const ae=getFragmentKey(Z);let ve=this.fragments[ae];!ve&&ee&&(ve=this.fragments[ae]={body:Z,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},Z.gap&&(this.hasGaps=!0)),ve&&(ve.loaded=null,ve.buffered=!0)}getBufferedTimes(Z,ee,ae,ve){const ye={time:[],partial:ae},be=Z.start,Ke=Z.end,Ye=Z.minEndPTS||Ke,Xe=Z.maxStartPTS||be;for(let Qe=0;Qe<ve.length;Qe++){const et=ve.start(Qe)-this.bufferPadding,Je=ve.end(Qe)+this.bufferPadding;if(Xe>=et&&Ye<=Je){ye.time.push({startPTS:Math.max(be,ve.start(Qe)),endPTS:Math.min(Ke,ve.end(Qe))});break}else if(be<Je&&Ke>et)ye.partial=!0,ye.time.push({startPTS:Math.max(be,ve.start(Qe)),endPTS:Math.min(Ke,ve.end(Qe))});else if(Ke<=et)break}return ye}getPartialFragment(Z){let ee=null,ae,ve,ye,be=0;const{bufferPadding:Ke,fragments:Ye}=this;return Object.keys(Ye).forEach(Xe=>{const Qe=Ye[Xe];Qe&&isPartial(Qe)&&(ve=Qe.body.start-Ke,ye=Qe.body.end+Ke,Z>=ve&&Z<=ye&&(ae=Math.min(Z-ve,ye-Z),be<=ae&&(ee=Qe.body,be=ae)))}),ee}isEndListAppended(Z){const ee=this.endListFragments[Z];return ee!==void 0&&(ee.buffered||isPartial(ee))}getState(Z){const ee=getFragmentKey(Z),ae=this.fragments[ee];return ae?ae.buffered?isPartial(ae)?FragmentState.PARTIAL:FragmentState.OK:FragmentState.APPENDING:FragmentState.NOT_LOADED}isTimeBuffered(Z,ee,ae){let ve,ye;for(let be=0;be<ae.length;be++){if(ve=ae.start(be)-this.bufferPadding,ye=ae.end(be)+this.bufferPadding,Z>=ve&&ee<=ye)return!0;if(ee<=ve)return!1}return!1}onFragLoaded(Z,ee){const{frag:ae,part:ve}=ee;if(ae.sn==="initSegment"||ae.bitrateTest)return;const ye=ve?null:ee,be=getFragmentKey(ae);this.fragments[be]={body:ae,appendedPTS:null,loaded:ye,buffered:!1,range:Object.create(null)}}onBufferAppended(Z,ee){const{frag:ae,part:ve,timeRanges:ye}=ee;if(ae.sn==="initSegment")return;const be=ae.type;if(ve){let Ke=this.activePartLists[be];Ke||(this.activePartLists[be]=Ke=[]),Ke.push(ve)}this.timeRanges=ye,Object.keys(ye).forEach(Ke=>{const Ye=ye[Ke];this.detectEvictedFragments(Ke,Ye,be,ve)})}onFragBuffered(Z,ee){this.detectPartialFragments(ee)}hasFragment(Z){const ee=getFragmentKey(Z);return!!this.fragments[ee]}hasParts(Z){var ee;return!!((ee=this.activePartLists[Z])!=null&&ee.length)}removeFragmentsInRange(Z,ee,ae,ve,ye){ve&&!this.hasGaps||Object.keys(this.fragments).forEach(be=>{const Ke=this.fragments[be];if(!Ke)return;const Ye=Ke.body;Ye.type!==ae||ve&&!Ye.gap||Ye.start<ee&&Ye.end>Z&&(Ke.buffered||ye)&&this.removeFragment(Ye)})}removeFragment(Z){const ee=getFragmentKey(Z);Z.stats.loaded=0,Z.clearElementaryStreamInfo();const ae=this.activePartLists[Z.type];if(ae){const ve=Z.sn;this.activePartLists[Z.type]=ae.filter(ye=>ye.fragment.sn!==ve)}delete this.fragments[ee],Z.endList&&delete this.endListFragments[Z.type]}removeAllFragments(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1}}function isPartial(ie){var Z,ee,ae;return ie.buffered&&(ie.body.gap||((Z=ie.range.video)==null?void 0:Z.partial)||((ee=ie.range.audio)==null?void 0:ee.partial)||((ae=ie.range.audiovideo)==null?void 0:ae.partial))}function getFragmentKey(ie){return`${ie.type}_${ie.level}_${ie.urlId}_${ie.sn}`}const MIN_CHUNK_SIZE=Math.pow(2,17);class FragmentLoader{constructor(Z){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=Z}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(Z,ee){const ae=Z.url;if(!ae)return Promise.reject(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:Z,error:new Error(`Fragment does not have a ${ae?"part list":"url"}`),networkDetails:null}));this.abort();const ve=this.config,ye=ve.fLoader,be=ve.loader;return new Promise((Ke,Ye)=>{if(this.loader&&this.loader.destroy(),Z.gap)if(Z.tagList.some(rt=>rt[0]==="GAP")){Ye(createGapLoadError(Z));return}else Z.gap=!1;const Xe=this.loader=Z.loader=ye?new ye(ve):new be(ve),Qe=createLoaderContext(Z),et=getLoaderConfigWithoutReties(ve.fragLoadPolicy.default),Je={loadPolicy:et,timeout:et.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:Z.sn==="initSegment"?1/0:MIN_CHUNK_SIZE};Z.stats=Xe.stats,Xe.load(Qe,Je,{onSuccess:(rt,it,nt,tt)=>{this.resetLoader(Z,Xe);let st=rt.data;nt.resetIV&&Z.decryptdata&&(Z.decryptdata.iv=new Uint8Array(st.slice(0,16)),st=st.slice(16)),Ke({frag:Z,part:null,payload:st,networkDetails:tt})},onError:(rt,it,nt,tt)=>{this.resetLoader(Z,Xe),Ye(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:Z,response:_objectSpread2({url:ae,data:void 0},rt),error:new Error(`HTTP Error ${rt.code} ${rt.text}`),networkDetails:nt,stats:tt}))},onAbort:(rt,it,nt)=>{this.resetLoader(Z,Xe),Ye(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:Z,error:new Error("Aborted"),networkDetails:nt,stats:rt}))},onTimeout:(rt,it,nt)=>{this.resetLoader(Z,Xe),Ye(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:Z,error:new Error(`Timeout after ${Je.timeout}ms`),networkDetails:nt,stats:rt}))},onProgress:(rt,it,nt,tt)=>{ee&&ee({frag:Z,part:null,payload:nt,networkDetails:tt})}})})}loadPart(Z,ee,ae){this.abort();const ve=this.config,ye=ve.fLoader,be=ve.loader;return new Promise((Ke,Ye)=>{if(this.loader&&this.loader.destroy(),Z.gap||ee.gap){Ye(createGapLoadError(Z,ee));return}const Xe=this.loader=Z.loader=ye?new ye(ve):new be(ve),Qe=createLoaderContext(Z,ee),et=getLoaderConfigWithoutReties(ve.fragLoadPolicy.default),Je={loadPolicy:et,timeout:et.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:MIN_CHUNK_SIZE};ee.stats=Xe.stats,Xe.load(Qe,Je,{onSuccess:(rt,it,nt,tt)=>{this.resetLoader(Z,Xe),this.updateStatsFromPart(Z,ee);const st={frag:Z,part:ee,payload:rt.data,networkDetails:tt};ae(st),Ke(st)},onError:(rt,it,nt,tt)=>{this.resetLoader(Z,Xe),Ye(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:Z,part:ee,response:_objectSpread2({url:Qe.url,data:void 0},rt),error:new Error(`HTTP Error ${rt.code} ${rt.text}`),networkDetails:nt,stats:tt}))},onAbort:(rt,it,nt)=>{Z.stats.aborted=ee.stats.aborted,this.resetLoader(Z,Xe),Ye(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:Z,part:ee,error:new Error("Aborted"),networkDetails:nt,stats:rt}))},onTimeout:(rt,it,nt)=>{this.resetLoader(Z,Xe),Ye(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:Z,part:ee,error:new Error(`Timeout after ${Je.timeout}ms`),networkDetails:nt,stats:rt}))}})})}updateStatsFromPart(Z,ee){const ae=Z.stats,ve=ee.stats,ye=ve.total;if(ae.loaded+=ve.loaded,ye){const Ye=Math.round(Z.duration/ee.duration),Xe=Math.min(Math.round(ae.loaded/ye),Ye),et=(Ye-Xe)*Math.round(ae.loaded/Xe);ae.total=ae.loaded+et}else ae.total=Math.max(ae.loaded,ae.total);const be=ae.loading,Ke=ve.loading;be.start?be.first+=Ke.first-Ke.start:(be.start=Ke.start,be.first=Ke.first),be.end=Ke.end}resetLoader(Z,ee){Z.loader=null,this.loader===ee&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),ee.destroy()}}function createLoaderContext(ie,Z=null){const ee=Z||ie,ae={frag:ie,part:Z,responseType:"arraybuffer",url:ee.url,headers:{},rangeStart:0,rangeEnd:0},ve=ee.byteRangeStartOffset,ye=ee.byteRangeEndOffset;if(isFiniteNumber(ve)&&isFiniteNumber(ye)){var be;let Ke=ve,Ye=ye;if(ie.sn==="initSegment"&&((be=ie.decryptdata)==null?void 0:be.method)==="AES-128"){const Xe=ye-ve;Xe%16&&(Ye=ye+(16-Xe%16)),ve!==0&&(ae.resetIV=!0,Ke=ve-16)}ae.rangeStart=Ke,ae.rangeEnd=Ye}return ae}function createGapLoadError(ie,Z){const ee=new Error(`GAP ${ie.gap?"tag":"attribute"} found`),ae={type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_GAP,fatal:!1,frag:ie,error:ee,networkDetails:null};return Z&&(ae.part=Z),(Z||ie).stats.aborted=!0,new LoadError(ae)}class LoadError extends Error{constructor(Z){super(Z.error.message),this.data=void 0,this.data=Z}}class KeyLoader{constructor(Z){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=Z}abort(Z){for(const ee in this.keyUriToKeyInfo){const ae=this.keyUriToKeyInfo[ee].loader;if(ae){if(Z&&Z!==ae.context.frag.type)return;ae.abort()}}}detach(){for(const Z in this.keyUriToKeyInfo){const ee=this.keyUriToKeyInfo[Z];(ee.mediaKeySessionContext||ee.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[Z]}}destroy(){this.detach();for(const Z in this.keyUriToKeyInfo){const ee=this.keyUriToKeyInfo[Z].loader;ee&&ee.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(Z,ee=ErrorDetails.KEY_LOAD_ERROR,ae,ve,ye){return new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ee,fatal:!1,frag:Z,response:ye,error:ae,networkDetails:ve})}loadClear(Z,ee){if(this.emeController&&this.config.emeEnabled){const{sn:ae,cc:ve}=Z;for(let ye=0;ye<ee.length;ye++){const be=ee[ye];if(ve<=be.cc&&(ae==="initSegment"||be.sn==="initSegment"||ae<be.sn)){this.emeController.selectKeySystemFormat(be).then(Ke=>{be.setKeyFormat(Ke)});break}}}}load(Z){return!Z.decryptdata&&Z.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(Z).then(ee=>this.loadInternal(Z,ee)):this.loadInternal(Z)}loadInternal(Z,ee){var ae,ve;ee&&Z.setKeyFormat(ee);const ye=Z.decryptdata;if(!ye){const Xe=new Error(ee?`Expected frag.decryptdata to be defined after setting format ${ee}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(Z,ErrorDetails.KEY_LOAD_ERROR,Xe))}const be=ye.uri;if(!be)return Promise.reject(this.createKeyLoadError(Z,ErrorDetails.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${be}"`)));let Ke=this.keyUriToKeyInfo[be];if((ae=Ke)!=null&&ae.decryptdata.key)return ye.key=Ke.decryptdata.key,Promise.resolve({frag:Z,keyInfo:Ke});if((ve=Ke)!=null&&ve.keyLoadPromise){var Ye;switch((Ye=Ke.mediaKeySessionContext)==null?void 0:Ye.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return Ke.keyLoadPromise.then(Xe=>(ye.key=Xe.keyInfo.decryptdata.key,{frag:Z,keyInfo:Ke}))}}switch(Ke=this.keyUriToKeyInfo[be]={decryptdata:ye,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},ye.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return ye.keyFormat==="identity"?this.loadKeyHTTP(Ke,Z):this.loadKeyEME(Ke,Z);case"AES-128":return this.loadKeyHTTP(Ke,Z);default:return Promise.reject(this.createKeyLoadError(Z,ErrorDetails.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${ye.method}"`)))}}loadKeyEME(Z,ee){const ae={frag:ee,keyInfo:Z};if(this.emeController&&this.config.emeEnabled){const ve=this.emeController.loadKey(ae);if(ve)return(Z.keyLoadPromise=ve.then(ye=>(Z.mediaKeySessionContext=ye,ae))).catch(ye=>{throw Z.keyLoadPromise=null,ye})}return Promise.resolve(ae)}loadKeyHTTP(Z,ee){const ae=this.config,ve=ae.loader,ye=new ve(ae);return ee.keyLoader=Z.loader=ye,Z.keyLoadPromise=new Promise((be,Ke)=>{const Ye={keyInfo:Z,frag:ee,responseType:"arraybuffer",url:Z.decryptdata.uri},Xe=ae.keyLoadPolicy.default,Qe={loadPolicy:Xe,timeout:Xe.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},et={onSuccess:(Je,rt,it,nt)=>{const{frag:tt,keyInfo:st,url:ot}=it;if(!tt.decryptdata||st!==this.keyUriToKeyInfo[ot])return Ke(this.createKeyLoadError(tt,ErrorDetails.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),nt));st.decryptdata.key=tt.decryptdata.key=new Uint8Array(Je.data),tt.keyLoader=null,st.loader=null,be({frag:tt,keyInfo:st})},onError:(Je,rt,it,nt)=>{this.resetLoader(rt),Ke(this.createKeyLoadError(ee,ErrorDetails.KEY_LOAD_ERROR,new Error(`HTTP Error ${Je.code} loading key ${Je.text}`),it,_objectSpread2({url:Ye.url,data:void 0},Je)))},onTimeout:(Je,rt,it)=>{this.resetLoader(rt),Ke(this.createKeyLoadError(ee,ErrorDetails.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),it))},onAbort:(Je,rt,it)=>{this.resetLoader(rt),Ke(this.createKeyLoadError(ee,ErrorDetails.INTERNAL_ABORTED,new Error("key loading aborted"),it))}};ye.load(Ye,Qe,et)})}resetLoader(Z){const{frag:ee,keyInfo:ae,url:ve}=Z,ye=ae.loader;ee.keyLoader===ye&&(ee.keyLoader=null,ae.loader=null),delete this.keyUriToKeyInfo[ve],ye&&ye.destroy()}}class TaskLoop{constructor(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(Z){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,Z),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}const noopBuffered={length:0,start:()=>0,end:()=>0};class BufferHelper{static isBuffered(Z,ee){try{if(Z){const ae=BufferHelper.getBuffered(Z);for(let ve=0;ve<ae.length;ve++)if(ee>=ae.start(ve)&&ee<=ae.end(ve))return!0}}catch{}return!1}static bufferInfo(Z,ee,ae){try{if(Z){const ve=BufferHelper.getBuffered(Z),ye=[];let be;for(be=0;be<ve.length;be++)ye.push({start:ve.start(be),end:ve.end(be)});return this.bufferedInfo(ye,ee,ae)}}catch{}return{len:0,start:ee,end:ee,nextStart:void 0}}static bufferedInfo(Z,ee,ae){ee=Math.max(0,ee),Z.sort(function(Xe,Qe){const et=Xe.start-Qe.start;return et||Qe.end-Xe.end});let ve=[];if(ae)for(let Xe=0;Xe<Z.length;Xe++){const Qe=ve.length;if(Qe){const et=ve[Qe-1].end;Z[Xe].start-et<ae?Z[Xe].end>et&&(ve[Qe-1].end=Z[Xe].end):ve.push(Z[Xe])}else ve.push(Z[Xe])}else ve=Z;let ye=0,be,Ke=ee,Ye=ee;for(let Xe=0;Xe<ve.length;Xe++){const Qe=ve[Xe].start,et=ve[Xe].end;if(ee+ae>=Qe&&ee<et)Ke=Qe,Ye=et,ye=Ye-ee;else if(ee+ae<Qe){be=Qe;break}}return{len:ye,start:Ke||0,end:Ye||0,nextStart:be}}static getBuffered(Z){try{return Z.buffered}catch(ee){return logger.log("failed to get media.buffered",ee),noopBuffered}}}class ChunkMetadata{constructor(Z,ee,ae,ve=0,ye=-1,be=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=getNewPerformanceTiming(),this.buffering={audio:getNewPerformanceTiming(),video:getNewPerformanceTiming(),audiovideo:getNewPerformanceTiming()},this.level=Z,this.sn=ee,this.id=ae,this.size=ve,this.part=ye,this.partial=be}}function getNewPerformanceTiming(){return{start:0,executeStart:0,executeEnd:0,end:0}}function findFirstFragWithCC(ie,Z){let ee=null;for(let ae=0,ve=ie.length;ae<ve;ae++){const ye=ie[ae];if(ye&&ye.cc===Z){ee=ye;break}}return ee}function shouldAlignOnDiscontinuities(ie,Z,ee){return!!(Z.details&&(ee.endCC>ee.startCC||ie&&ie.cc<ee.startCC))}function findDiscontinuousReferenceFrag(ie,Z,ee=0){const ae=ie.fragments,ve=Z.fragments;if(!ve.length||!ae.length){logger.log("No fragments to align");return}const ye=findFirstFragWithCC(ae,ve[0].cc);if(!ye||ye&&!ye.startPTS){logger.log("No frag in previous level to align on");return}return ye}function adjustFragmentStart(ie,Z){if(ie){const ee=ie.start+Z;ie.start=ie.startPTS=ee,ie.endPTS=ee+ie.duration}}function adjustSlidingStart(ie,Z){const ee=Z.fragments;for(let ae=0,ve=ee.length;ae<ve;ae++)adjustFragmentStart(ee[ae],ie);Z.fragmentHint&&adjustFragmentStart(Z.fragmentHint,ie),Z.alignedSliding=!0}function alignStream(ie,Z,ee){Z&&(alignDiscontinuities(ie,ee,Z),!ee.alignedSliding&&Z.details&&alignPDT(ee,Z.details),!ee.alignedSliding&&Z.details&&!ee.skippedSegments&&adjustSliding(Z.details,ee))}function alignDiscontinuities(ie,Z,ee){if(shouldAlignOnDiscontinuities(ie,ee,Z)){const ae=findDiscontinuousReferenceFrag(ee.details,Z);ae&&isFiniteNumber(ae.start)&&(logger.log(`Adjusting PTS using last level due to CC increase within current level ${Z.url}`),adjustSlidingStart(ae.start,Z))}}function alignPDT(ie,Z){if(!Z.fragments.length||!ie.hasProgramDateTime||!Z.hasProgramDateTime)return;const ee=Z.fragments[0].programDateTime,ae=ie.fragments[0].programDateTime,ve=(ae-ee)/1e3+Z.fragments[0].start;ve&&isFiniteNumber(ve)&&(logger.log(`Adjusting PTS using programDateTime delta ${ae-ee}ms, sliding:${ve.toFixed(3)} ${ie.url} `),adjustSlidingStart(ve,ie))}function alignMediaPlaylistByPDT(ie,Z){if(!ie.hasProgramDateTime||!Z.hasProgramDateTime)return;const ee=ie.fragments,ae=Z.fragments;if(!ee.length||!ae.length)return;const ve=Math.round(ae.length/2)-1,ye=ae[ve],be=findFirstFragWithCC(ee,ye.cc)||ee[Math.round(ee.length/2)-1],Ke=ye.programDateTime,Ye=be.programDateTime;if(Ke===null||Ye===null)return;const Xe=(Ye-Ke)/1e3-(be.start-ye.start);adjustSlidingStart(Xe,ie)}class AESCrypto{constructor(Z,ee){this.subtle=void 0,this.aesIV=void 0,this.subtle=Z,this.aesIV=ee}decrypt(Z,ee){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},ee,Z)}}class FastAESKey{constructor(Z,ee){this.subtle=void 0,this.key=void 0,this.subtle=Z,this.key=ee}expandKey(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}function removePadding(ie){const Z=ie.byteLength,ee=Z&&new DataView(ie.buffer).getUint8(Z-1);return ee?sliceUint8(ie,0,Z-ee):ie}class AESDecryptor{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(Z){const ee=new DataView(Z),ae=new Uint32Array(4);for(let ve=0;ve<4;ve++)ae[ve]=ee.getUint32(ve*4);return ae}initTable(){const Z=this.sBox,ee=this.invSBox,ae=this.subMix,ve=ae[0],ye=ae[1],be=ae[2],Ke=ae[3],Ye=this.invSubMix,Xe=Ye[0],Qe=Ye[1],et=Ye[2],Je=Ye[3],rt=new Uint32Array(256);let it=0,nt=0,tt=0;for(tt=0;tt<256;tt++)tt<128?rt[tt]=tt<<1:rt[tt]=tt<<1^283;for(tt=0;tt<256;tt++){let st=nt^nt<<1^nt<<2^nt<<3^nt<<4;st=st>>>8^st&255^99,Z[it]=st,ee[st]=it;const ot=rt[it],ut=rt[ot],ft=rt[ut];let pt=rt[st]*257^st*16843008;ve[it]=pt<<24|pt>>>8,ye[it]=pt<<16|pt>>>16,be[it]=pt<<8|pt>>>24,Ke[it]=pt,pt=ft*16843009^ut*65537^ot*257^it*16843008,Xe[st]=pt<<24|pt>>>8,Qe[st]=pt<<16|pt>>>16,et[st]=pt<<8|pt>>>24,Je[st]=pt,it?(it=ot^rt[rt[rt[ft^ot]]],nt^=rt[rt[nt]]):it=nt=1}}expandKey(Z){const ee=this.uint8ArrayToUint32Array_(Z);let ae=!0,ve=0;for(;ve<ee.length&&ae;)ae=ee[ve]===this.key[ve],ve++;if(ae)return;this.key=ee;const ye=this.keySize=ee.length;if(ye!==4&&ye!==6&&ye!==8)throw new Error("Invalid aes key size="+ye);const be=this.ksRows=(ye+6+1)*4;let Ke,Ye;const Xe=this.keySchedule=new Uint32Array(be),Qe=this.invKeySchedule=new Uint32Array(be),et=this.sBox,Je=this.rcon,rt=this.invSubMix,it=rt[0],nt=rt[1],tt=rt[2],st=rt[3];let ot,ut;for(Ke=0;Ke<be;Ke++){if(Ke<ye){ot=Xe[Ke]=ee[Ke];continue}ut=ot,Ke%ye===0?(ut=ut<<8|ut>>>24,ut=et[ut>>>24]<<24|et[ut>>>16&255]<<16|et[ut>>>8&255]<<8|et[ut&255],ut^=Je[Ke/ye|0]<<24):ye>6&&Ke%ye===4&&(ut=et[ut>>>24]<<24|et[ut>>>16&255]<<16|et[ut>>>8&255]<<8|et[ut&255]),Xe[Ke]=ot=(Xe[Ke-ye]^ut)>>>0}for(Ye=0;Ye<be;Ye++)Ke=be-Ye,Ye&3?ut=Xe[Ke]:ut=Xe[Ke-4],Ye<4||Ke<=4?Qe[Ye]=ut:Qe[Ye]=it[et[ut>>>24]]^nt[et[ut>>>16&255]]^tt[et[ut>>>8&255]]^st[et[ut&255]],Qe[Ye]=Qe[Ye]>>>0}networkToHostOrderSwap(Z){return Z<<24|(Z&65280)<<8|(Z&16711680)>>8|Z>>>24}decrypt(Z,ee,ae){const ve=this.keySize+6,ye=this.invKeySchedule,be=this.invSBox,Ke=this.invSubMix,Ye=Ke[0],Xe=Ke[1],Qe=Ke[2],et=Ke[3],Je=this.uint8ArrayToUint32Array_(ae);let rt=Je[0],it=Je[1],nt=Je[2],tt=Je[3];const st=new Int32Array(Z),ot=new Int32Array(st.length);let ut,ft,pt,Xr,mt,Yr,ri,Zr,_r,Kr,si,oi,Qr,ii;const ti=this.networkToHostOrderSwap;for(;ee<st.length;){for(_r=ti(st[ee]),Kr=ti(st[ee+1]),si=ti(st[ee+2]),oi=ti(st[ee+3]),mt=_r^ye[0],Yr=oi^ye[1],ri=si^ye[2],Zr=Kr^ye[3],Qr=4,ii=1;ii<ve;ii++)ut=Ye[mt>>>24]^Xe[Yr>>16&255]^Qe[ri>>8&255]^et[Zr&255]^ye[Qr],ft=Ye[Yr>>>24]^Xe[ri>>16&255]^Qe[Zr>>8&255]^et[mt&255]^ye[Qr+1],pt=Ye[ri>>>24]^Xe[Zr>>16&255]^Qe[mt>>8&255]^et[Yr&255]^ye[Qr+2],Xr=Ye[Zr>>>24]^Xe[mt>>16&255]^Qe[Yr>>8&255]^et[ri&255]^ye[Qr+3],mt=ut,Yr=ft,ri=pt,Zr=Xr,Qr=Qr+4;ut=be[mt>>>24]<<24^be[Yr>>16&255]<<16^be[ri>>8&255]<<8^be[Zr&255]^ye[Qr],ft=be[Yr>>>24]<<24^be[ri>>16&255]<<16^be[Zr>>8&255]<<8^be[mt&255]^ye[Qr+1],pt=be[ri>>>24]<<24^be[Zr>>16&255]<<16^be[mt>>8&255]<<8^be[Yr&255]^ye[Qr+2],Xr=be[Zr>>>24]<<24^be[mt>>16&255]<<16^be[Yr>>8&255]<<8^be[ri&255]^ye[Qr+3],ot[ee]=ti(ut^rt),ot[ee+1]=ti(Xr^it),ot[ee+2]=ti(pt^nt),ot[ee+3]=ti(ft^tt),rt=_r,it=Kr,nt=si,tt=oi,ee=ee+4}return ot.buffer}}const CHUNK_SIZE=16;class Decrypter{constructor(Z,{removePKCS7Padding:ee=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=Z.enableSoftwareAES,this.removePKCS7Padding=ee,ee)try{const ae=self.crypto;ae&&(this.subtle=ae.subtle||ae.webkitSubtle)}catch{}this.subtle===null&&(this.useSoftware=!0)}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:Z,remainderData:ee}=this;if(!Z||ee)return this.reset(),null;const ae=new Uint8Array(Z);return this.reset(),this.removePKCS7Padding?removePadding(ae):ae}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(Z,ee,ae){return this.useSoftware?new Promise((ve,ye)=>{this.softwareDecrypt(new Uint8Array(Z),ee,ae);const be=this.flush();be?ve(be.buffer):ye(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(Z),ee,ae)}softwareDecrypt(Z,ee,ae){const{currentIV:ve,currentResult:ye,remainderData:be}=this;this.logOnce("JS AES decrypt"),be&&(Z=appendUint8Array(be,Z),this.remainderData=null);const Ke=this.getValidChunk(Z);if(!Ke.length)return null;ve&&(ae=ve);let Ye=this.softwareDecrypter;Ye||(Ye=this.softwareDecrypter=new AESDecryptor),Ye.expandKey(ee);const Xe=ye;return this.currentResult=Ye.decrypt(Ke.buffer,0,ae),this.currentIV=sliceUint8(Ke,-16).buffer,Xe||null}webCryptoDecrypt(Z,ee,ae){const ve=this.subtle;return(this.key!==ee||!this.fastAesKey)&&(this.key=ee,this.fastAesKey=new FastAESKey(ve,ee)),this.fastAesKey.expandKey().then(ye=>ve?(this.logOnce("WebCrypto AES decrypt"),new AESCrypto(ve,new Uint8Array(ae)).decrypt(Z.buffer,ye)):Promise.reject(new Error("web crypto not initialized"))).catch(ye=>(logger.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${ye.name}: ${ye.message}`),this.onWebCryptoError(Z,ee,ae)))}onWebCryptoError(Z,ee,ae){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(Z,ee,ae);const ve=this.flush();if(ve)return ve.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")}getValidChunk(Z){let ee=Z;const ae=Z.length-Z.length%CHUNK_SIZE;return ae!==Z.length&&(ee=sliceUint8(Z,0,ae),this.remainderData=sliceUint8(Z,ae)),ee}logOnce(Z){this.logEnabled&&(logger.log(`[decrypter]: ${Z}`),this.logEnabled=!1)}}const TimeRanges={toString:function(ie){let Z="";const ee=ie.length;for(let ae=0;ae<ee;ae++)Z+=`[${ie.start(ae).toFixed(3)}-${ie.end(ae).toFixed(3)}]`;return Z}},State={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class BaseStreamController extends TaskLoop{constructor(Z,ee,ae,ve,ye){super(),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=State.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.loadedmetadata=!1,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.onvseeking=null,this.onvended=null,this.logPrefix="",this.log=void 0,this.warn=void 0,this.playlistType=ye,this.logPrefix=ve,this.log=logger.log.bind(logger,`${ve}:`),this.warn=logger.warn.bind(logger,`${ve}:`),this.hls=Z,this.fragmentLoader=new FragmentLoader(Z.config),this.keyLoader=ae,this.fragmentTracker=ee,this.config=Z.config,this.decrypter=new Decrypter(Z.config),Z.on(Events.MANIFEST_LOADED,this.onManifestLoaded,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(Z){}stopLoad(){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const Z=this.fragCurrent;Z!=null&&Z.loader&&(Z.abortRequests(),this.fragmentTracker.removeFragment(Z)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=State.STOPPED}_streamEnded(Z,ee){if(ee.live||Z.nextStart||!Z.end||!this.media)return!1;const ae=ee.partList;if(ae!=null&&ae.length){const ye=ae[ae.length-1];return BufferHelper.isBuffered(this.media,ye.start+ye.duration/2)}const ve=ee.fragments[ee.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(ve)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null){var Z;return(Z=this.levels[this.levelLastLoaded])==null?void 0:Z.details}}onMediaAttached(Z,ee){const ae=this.media=this.mediaBuffer=ee.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),ae.addEventListener("seeking",this.onvseeking),ae.addEventListener("ended",this.onvended);const ve=this.config;this.levels&&ve.autoStartLoad&&this.state===State.STOPPED&&this.startLoad(ve.startPosition)}onMediaDetaching(){const Z=this.media;Z!=null&&Z.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),Z&&this.onvseeking&&this.onvended&&(Z.removeEventListener("seeking",this.onvseeking),Z.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}onMediaSeeking(){const{config:Z,fragCurrent:ee,media:ae,mediaBuffer:ve,state:ye}=this,be=ae?ae.currentTime:0,Ke=BufferHelper.bufferInfo(ve||ae,be,Z.maxBufferHole);if(this.log(`media seeking to ${isFiniteNumber(be)?be.toFixed(3):be}, state: ${ye}`),this.state===State.ENDED)this.resetLoadingState();else if(ee){const Ye=Z.maxFragLookUpTolerance,Xe=ee.start-Ye,Qe=ee.start+ee.duration+Ye;if(!Ke.len||Qe<Ke.start||Xe>Ke.end){const et=be>Qe;(be<Xe||et)&&(et&&ee.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),ee.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}ae&&(this.fragmentTracker.removeFragmentsInRange(be,1/0,this.playlistType,!0),this.lastCurrentTime=be),!this.loadedmetadata&&!Ke.len&&(this.nextLoadPosition=this.startPosition=be),this.tickImmediate()}onMediaEnded(){this.startPosition=this.lastCurrentTime=0}onManifestLoaded(Z,ee){this.startTimeOffset=ee.startTimeOffset,this.initPTS=[]}onHandlerDestroying(){this.stopLoad(),super.onHandlerDestroying()}onHandlerDestroyed(){this.state=State.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(Z,ee,ae){this._loadFragForPlayback(Z,ee,ae)}_loadFragForPlayback(Z,ee,ae){const ve=ye=>{if(this.fragContextChanged(Z)){this.warn(`Fragment ${Z.sn}${ye.part?" p: "+ye.part.index:""} of level ${Z.level} was dropped during download.`),this.fragmentTracker.removeFragment(Z);return}Z.stats.chunkCount++,this._handleFragmentLoadProgress(ye)};this._doFragLoad(Z,ee,ae,ve).then(ye=>{if(!ye)return;const be=this.state;if(this.fragContextChanged(Z)){(be===State.FRAG_LOADING||!this.fragCurrent&&be===State.PARSING)&&(this.fragmentTracker.removeFragment(Z),this.state=State.IDLE);return}"payload"in ye&&(this.log(`Loaded fragment ${Z.sn} of level ${Z.level}`),this.hls.trigger(Events.FRAG_LOADED,ye)),this._handleFragmentLoadComplete(ye)}).catch(ye=>{this.state===State.STOPPED||this.state===State.ERROR||(this.warn(ye),this.resetFragmentLoading(Z))})}clearTrackerIfNeeded(Z){var ee;const{fragmentTracker:ae}=this;if(ae.getState(Z)===FragmentState.APPENDING){const ye=Z.type,be=this.getFwdBufferInfo(this.mediaBuffer,ye),Ke=Math.max(Z.duration,be?be.len:this.config.maxBufferLength);this.reduceMaxBufferLength(Ke)&&ae.removeFragment(Z)}else((ee=this.mediaBuffer)==null?void 0:ee.buffered.length)===0?ae.removeAllFragments():ae.hasParts(Z.type)&&(ae.detectPartialFragments({frag:Z,part:null,stats:Z.stats,id:Z.type}),ae.getState(Z)===FragmentState.PARTIAL&&ae.removeFragment(Z))}checkLiveUpdate(Z){if(Z.updated&&!Z.live){const ee=Z.fragments[Z.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:ee,part:null,stats:ee.stats,id:ee.type})}Z.fragments[0]||(Z.deltaUpdateFailed=!0)}flushMainBuffer(Z,ee,ae=null){if(!(Z-ee))return;const ve={startOffset:Z,endOffset:ee,type:ae};this.hls.trigger(Events.BUFFER_FLUSHING,ve)}_loadInitSegment(Z,ee){this._doFragLoad(Z,ee).then(ae=>{if(!ae||this.fragContextChanged(Z)||!this.levels)throw new Error("init load aborted");return ae}).then(ae=>{const{hls:ve}=this,{payload:ye}=ae,be=Z.decryptdata;if(ye&&ye.byteLength>0&&be&&be.key&&be.iv&&be.method==="AES-128"){const Ke=self.performance.now();return this.decrypter.decrypt(new Uint8Array(ye),be.key.buffer,be.iv.buffer).catch(Ye=>{throw ve.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!1,error:Ye,reason:Ye.message,frag:Z}),Ye}).then(Ye=>{const Xe=self.performance.now();return ve.trigger(Events.FRAG_DECRYPTED,{frag:Z,payload:Ye,stats:{tstart:Ke,tdecrypt:Xe}}),ae.payload=Ye,ae})}return ae}).then(ae=>{const{fragCurrent:ve,hls:ye,levels:be}=this;if(!be)throw new Error("init load aborted, missing levels");const Ke=Z.stats;this.state=State.IDLE,ee.fragmentError=0,Z.data=new Uint8Array(ae.payload),Ke.parsing.start=Ke.buffering.start=self.performance.now(),Ke.parsing.end=Ke.buffering.end=self.performance.now(),ae.frag===ve&&ye.trigger(Events.FRAG_BUFFERED,{stats:Ke,frag:ve,part:null,id:Z.type}),this.tick()}).catch(ae=>{this.state===State.STOPPED||this.state===State.ERROR||(this.warn(ae),this.resetFragmentLoading(Z))})}fragContextChanged(Z){const{fragCurrent:ee}=this;return!Z||!ee||Z.level!==ee.level||Z.sn!==ee.sn||Z.urlId!==ee.urlId}fragBufferedComplete(Z,ee){var ae,ve,ye,be;const Ke=this.mediaBuffer?this.mediaBuffer:this.media;this.log(`Buffered ${Z.type} sn: ${Z.sn}${ee?" part: "+ee.index:""} of ${this.playlistType===PlaylistLevelType.MAIN?"level":"track"} ${Z.level} (frag:[${((ae=Z.startPTS)!=null?ae:NaN).toFixed(3)}-${((ve=Z.endPTS)!=null?ve:NaN).toFixed(3)}] > buffer:${Ke?TimeRanges.toString(BufferHelper.getBuffered(Ke)):"(detached)"})`),this.state=State.IDLE,Ke&&(!this.loadedmetadata&&Z.type==PlaylistLevelType.MAIN&&Ke.buffered.length&&((ye=this.fragCurrent)==null?void 0:ye.sn)===((be=this.fragPrevious)==null?void 0:be.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())}seekToStartPos(){}_handleFragmentLoadComplete(Z){const{transmuxer:ee}=this;if(!ee)return;const{frag:ae,part:ve,partsLoaded:ye}=Z,be=!ye||ye.length===0||ye.some(Ye=>!Ye),Ke=new ChunkMetadata(ae.level,ae.sn,ae.stats.chunkCount+1,0,ve?ve.index:-1,!be);ee.flush(Ke)}_handleFragmentLoadProgress(Z){}_doFragLoad(Z,ee,ae=null,ve){var ye;const be=ee==null?void 0:ee.details;if(!this.levels||!be)throw new Error(`frag load aborted, missing level${be?"":" detail"}s`);let Ke=null;if(Z.encrypted&&!((ye=Z.decryptdata)!=null&&ye.key)?(this.log(`Loading key for ${Z.sn} of [${be.startSN}-${be.endSN}], ${this.logPrefix==="[stream-controller]"?"level":"track"} ${Z.level}`),this.state=State.KEY_LOADING,this.fragCurrent=Z,Ke=this.keyLoader.load(Z).then(Qe=>{if(!this.fragContextChanged(Qe.frag))return this.hls.trigger(Events.KEY_LOADED,Qe),this.state===State.KEY_LOADING&&(this.state=State.IDLE),Qe}),this.hls.trigger(Events.KEY_LOADING,{frag:Z}),this.fragCurrent===null&&(Ke=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))):!Z.encrypted&&be.encryptedFragments.length&&this.keyLoader.loadClear(Z,be.encryptedFragments),ae=Math.max(Z.start,ae||0),this.config.lowLatencyMode&&Z.sn!=="initSegment"){const Qe=be.partList;if(Qe&&ve){ae>Z.end&&be.fragmentHint&&(Z=be.fragmentHint);const et=this.getNextPart(Qe,Z,ae);if(et>-1){const Je=Qe[et];this.log(`Loading part sn: ${Z.sn} p: ${Je.index} cc: ${Z.cc} of playlist [${be.startSN}-${be.endSN}] parts [0-${et}-${Qe.length-1}] ${this.logPrefix==="[stream-controller]"?"level":"track"}: ${Z.level}, target: ${parseFloat(ae.toFixed(3))}`),this.nextLoadPosition=Je.start+Je.duration,this.state=State.FRAG_LOADING;let rt;return Ke?rt=Ke.then(it=>!it||this.fragContextChanged(it.frag)?null:this.doFragPartsLoad(Z,Je,ee,ve)).catch(it=>this.handleFragLoadError(it)):rt=this.doFragPartsLoad(Z,Je,ee,ve).catch(it=>this.handleFragLoadError(it)),this.hls.trigger(Events.FRAG_LOADING,{frag:Z,part:Je,targetBufferTime:ae}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):rt}else if(!Z.url||this.loadedEndOfParts(Qe,ae))return Promise.resolve(null)}}this.log(`Loading fragment ${Z.sn} cc: ${Z.cc} ${be?"of ["+be.startSN+"-"+be.endSN+"] ":""}${this.logPrefix==="[stream-controller]"?"level":"track"}: ${Z.level}, target: ${parseFloat(ae.toFixed(3))}`),isFiniteNumber(Z.sn)&&!this.bitrateTest&&(this.nextLoadPosition=Z.start+Z.duration),this.state=State.FRAG_LOADING;const Ye=this.config.progressive;let Xe;return Ye&&Ke?Xe=Ke.then(Qe=>!Qe||this.fragContextChanged(Qe==null?void 0:Qe.frag)?null:this.fragmentLoader.load(Z,ve)).catch(Qe=>this.handleFragLoadError(Qe)):Xe=Promise.all([this.fragmentLoader.load(Z,Ye?ve:void 0),Ke]).then(([Qe])=>(!Ye&&Qe&&ve&&ve(Qe),Qe)).catch(Qe=>this.handleFragLoadError(Qe)),this.hls.trigger(Events.FRAG_LOADING,{frag:Z,targetBufferTime:ae}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):Xe}doFragPartsLoad(Z,ee,ae,ve){return new Promise((ye,be)=>{var Ke;const Ye=[],Xe=(Ke=ae.details)==null?void 0:Ke.partList,Qe=et=>{this.fragmentLoader.loadPart(Z,et,ve).then(Je=>{Ye[et.index]=Je;const rt=Je.part;this.hls.trigger(Events.FRAG_LOADED,Je);const it=getPartWith(ae,Z.sn,et.index+1)||findPart(Xe,Z.sn,et.index+1);if(it)Qe(it);else return ye({frag:Z,part:rt,partsLoaded:Ye})}).catch(be)};Qe(ee)})}handleFragLoadError(Z){if("data"in Z){const ee=Z.data;Z.data&&ee.details===ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(ee.frag,ee.part):this.hls.trigger(Events.ERROR,ee)}else this.hls.trigger(Events.ERROR,{type:ErrorTypes.OTHER_ERROR,details:ErrorDetails.INTERNAL_EXCEPTION,err:Z,error:Z,fatal:!0});return null}_handleTransmuxerFlush(Z){const ee=this.getCurrentContext(Z);if(!ee||this.state!==State.PARSING){!this.fragCurrent&&this.state!==State.STOPPED&&this.state!==State.ERROR&&(this.state=State.IDLE);return}const{frag:ae,part:ve,level:ye}=ee,be=self.performance.now();ae.stats.parsing.end=be,ve&&(ve.stats.parsing.end=be),this.updateLevelTiming(ae,ve,ye,Z.partial)}getCurrentContext(Z){const{levels:ee,fragCurrent:ae}=this,{level:ve,sn:ye,part:be}=Z;if(!(ee!=null&&ee[ve]))return this.warn(`Levels object was unset while buffering fragment ${ye} of level ${ve}. The current chunk will not be buffered.`),null;const Ke=ee[ve],Ye=be>-1?getPartWith(Ke,ye,be):null,Xe=Ye?Ye.fragment:getFragmentWithSN(Ke,ye,ae);return Xe?(ae&&ae!==Xe&&(Xe.stats=ae.stats),{frag:Xe,part:Ye,level:Ke}):null}bufferFragmentData(Z,ee,ae,ve,ye){var be;if(!Z||this.state!==State.PARSING)return;const{data1:Ke,data2:Ye}=Z;let Xe=Ke;if(Ke&&Ye&&(Xe=appendUint8Array(Ke,Ye)),!((be=Xe)!=null&&be.length))return;const Qe={type:Z.type,frag:ee,part:ae,chunkMeta:ve,parent:ee.type,data:Xe};if(this.hls.trigger(Events.BUFFER_APPENDING,Qe),Z.dropped&&Z.independent&&!ae){if(ye)return;this.flushBufferGap(ee)}}flushBufferGap(Z){const ee=this.media;if(!ee)return;if(!BufferHelper.isBuffered(ee,ee.currentTime)){this.flushMainBuffer(0,Z.start);return}const ae=ee.currentTime,ve=BufferHelper.bufferInfo(ee,ae,0),ye=Z.duration,be=Math.min(this.config.maxFragLookUpTolerance*2,ye*.25),Ke=Math.max(Math.min(Z.start-be,ve.end-be),ae+be);Z.start-Ke>be&&this.flushMainBuffer(Ke,Z.start)}getFwdBufferInfo(Z,ee){const ae=this.getLoadPosition();return isFiniteNumber(ae)?this.getFwdBufferInfoAtPos(Z,ae,ee):null}getFwdBufferInfoAtPos(Z,ee,ae){const{config:{maxBufferHole:ve}}=this,ye=BufferHelper.bufferInfo(Z,ee,ve);if(ye.len===0&&ye.nextStart!==void 0){const be=this.fragmentTracker.getBufferedFrag(ee,ae);if(be&&ye.nextStart<be.end)return BufferHelper.bufferInfo(Z,ee,Math.max(ye.nextStart,ve))}return ye}getMaxBufferLength(Z){const{config:ee}=this;let ae;return Z?ae=Math.max(8*ee.maxBufferSize/Z,ee.maxBufferLength):ae=ee.maxBufferLength,Math.min(ae,ee.maxMaxBufferLength)}reduceMaxBufferLength(Z){const ee=this.config,ae=Z||ee.maxBufferLength;return ee.maxMaxBufferLength>=ae?(ee.maxMaxBufferLength/=2,this.warn(`Reduce max buffer length to ${ee.maxMaxBufferLength}s`),!0):!1}getAppendedFrag(Z,ee=PlaylistLevelType.MAIN){const ae=this.fragmentTracker.getAppendedFrag(Z,PlaylistLevelType.MAIN);return ae&&"fragment"in ae?ae.fragment:ae}getNextFragment(Z,ee){const ae=ee.fragments,ve=ae.length;if(!ve)return null;const{config:ye}=this,be=ae[0].start;let Ke;if(ee.live){const Ye=ye.initialLiveManifestSize;if(ve<Ye)return this.warn(`Not enough fragments to start playback (have: ${ve}, need: ${Ye})`),null;!ee.PTSKnown&&!this.startFragRequested&&this.startPosition===-1&&(Ke=this.getInitialLiveFragment(ee,ae),this.startPosition=Ke?this.hls.liveSyncPosition||Ke.start:Z)}else Z<=be&&(Ke=ae[0]);if(!Ke){const Ye=ye.lowLatencyMode?ee.partEnd:ee.fragmentEnd;Ke=this.getFragmentAtPosition(Z,Ye,ee)}return this.mapToInitFragWhenRequired(Ke)}isLoopLoading(Z,ee){const ae=this.fragmentTracker.getState(Z);return(ae===FragmentState.OK||ae===FragmentState.PARTIAL&&!!Z.gap)&&this.nextLoadPosition>ee}getNextFragmentLoopLoading(Z,ee,ae,ve,ye){const be=Z.gap,Ke=this.getNextFragment(this.nextLoadPosition,ee);if(Ke===null)return Ke;if(Z=Ke,be&&Z&&!Z.gap&&ae.nextStart){const Ye=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,ae.nextStart,ve);if(Ye!==null&&ae.len+Ye.len>=ye)return this.log(`buffer full after gaps in "${ve}" playlist starting at sn: ${Z.sn}`),null}return Z}mapToInitFragWhenRequired(Z){return Z!=null&&Z.initSegment&&!(Z!=null&&Z.initSegment.data)&&!this.bitrateTest?Z.initSegment:Z}getNextPart(Z,ee,ae){let ve=-1,ye=!1,be=!0;for(let Ke=0,Ye=Z.length;Ke<Ye;Ke++){const Xe=Z[Ke];if(be=be&&!Xe.independent,ve>-1&&ae<Xe.start)break;const Qe=Xe.loaded;Qe?ve=-1:(ye||Xe.independent||be)&&Xe.fragment===ee&&(ve=Ke),ye=Qe}return ve}loadedEndOfParts(Z,ee){const ae=Z[Z.length-1];return ae&&ee>ae.start&&ae.loaded}getInitialLiveFragment(Z,ee){const ae=this.fragPrevious;let ve=null;if(ae){if(Z.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${ae.programDateTime}`),ve=findFragmentByPDT(ee,ae.endProgramDateTime,this.config.maxFragLookUpTolerance)),!ve){const ye=ae.sn+1;if(ye>=Z.startSN&&ye<=Z.endSN){const be=ee[ye-Z.startSN];ae.cc===be.cc&&(ve=be,this.log(`Live playlist, switching playlist, load frag with next SN: ${ve.sn}`))}ve||(ve=findFragWithCC(ee,ae.cc),ve&&this.log(`Live playlist, switching playlist, load frag with same CC: ${ve.sn}`))}}else{const ye=this.hls.liveSyncPosition;ye!==null&&(ve=this.getFragmentAtPosition(ye,this.bitrateTest?Z.fragmentEnd:Z.edge,Z))}return ve}getFragmentAtPosition(Z,ee,ae){const{config:ve}=this;let{fragPrevious:ye}=this,{fragments:be,endSN:Ke}=ae;const{fragmentHint:Ye}=ae,Xe=ve.maxFragLookUpTolerance,Qe=ae.partList,et=!!(ve.lowLatencyMode&&Qe!=null&&Qe.length&&Ye);et&&Ye&&!this.bitrateTest&&(be=be.concat(Ye),Ke=Ye.sn);let Je;if(Z<ee){const rt=Z>ee-Xe?0:Xe;Je=findFragmentByPTS(ye,be,Z,rt)}else Je=be[be.length-1];if(Je){const rt=Je.sn-ae.startSN,it=this.fragmentTracker.getState(Je);if((it===FragmentState.OK||it===FragmentState.PARTIAL&&Je.gap)&&(ye=Je),ye&&Je.sn===ye.sn&&(!et||Qe[0].fragment.sn>Je.sn)&&ye&&Je.level===ye.level){const tt=be[rt+1];Je.sn<Ke&&this.fragmentTracker.getState(tt)!==FragmentState.OK?Je=tt:Je=null}}return Je}synchronizeToLiveEdge(Z){const{config:ee,media:ae}=this;if(!ae)return;const ve=this.hls.liveSyncPosition,ye=ae.currentTime,be=Z.fragments[0].start,Ke=Z.edge,Ye=ye>=be-ee.maxFragLookUpTolerance&&ye<=Ke;if(ve!==null&&ae.duration>ve&&(ye<ve||!Ye)){const Xe=ee.liveMaxLatencyDuration!==void 0?ee.liveMaxLatencyDuration:ee.liveMaxLatencyDurationCount*Z.targetduration;(!Ye&&ae.readyState<4||ye<Ke-Xe)&&(this.loadedmetadata||(this.nextLoadPosition=ve),ae.readyState&&(this.warn(`Playback: ${ye.toFixed(3)} is located too far from the end of live sliding playlist: ${Ke}, reset currentTime to : ${ve.toFixed(3)}`),ae.currentTime=ve))}}alignPlaylists(Z,ee){const{levels:ae,levelLastLoaded:ve,fragPrevious:ye}=this,be=ve!==null?ae[ve]:null,Ke=Z.fragments.length;if(!Ke)return this.warn("No fragments in live playlist"),0;const Ye=Z.fragments[0].start,Xe=!ee,Qe=Z.alignedSliding&&isFiniteNumber(Ye);if(Xe||!Qe&&!Ye){alignStream(ye,be,Z);const et=Z.fragments[0].start;return this.log(`Live playlist sliding: ${et.toFixed(2)} start-sn: ${ee?ee.startSN:"na"}->${Z.startSN} prev-sn: ${ye?ye.sn:"na"} fragments: ${Ke}`),et}return Ye}waitForCdnTuneIn(Z){return Z.live&&Z.canBlockReload&&Z.partTarget&&Z.tuneInGoal>Math.max(Z.partHoldBack,Z.partTarget*3)}setStartPosition(Z,ee){let ae=this.startPosition;if(ae<ee&&(ae=-1),ae===-1||this.lastCurrentTime===-1){const ve=this.startTimeOffset!==null,ye=ve?this.startTimeOffset:Z.startTimeOffset;ye!==null&&isFiniteNumber(ye)?(ae=ee+ye,ye<0&&(ae+=Z.totalduration),ae=Math.min(Math.max(ee,ae),ee+Z.totalduration),this.log(`Start time offset ${ye} found in ${ve?"multivariant":"media"} playlist, adjust startPosition to ${ae}`),this.startPosition=ae):Z.live?ae=this.hls.liveSyncPosition||ee:this.startPosition=ae=0,this.lastCurrentTime=ae}this.nextLoadPosition=ae}getLoadPosition(){const{media:Z}=this;let ee=0;return this.loadedmetadata&&Z?ee=Z.currentTime:this.nextLoadPosition&&(ee=this.nextLoadPosition),ee}handleFragLoadAborted(Z,ee){this.transmuxer&&Z.sn!=="initSegment"&&Z.stats.aborted&&(this.warn(`Fragment ${Z.sn}${ee?" part "+ee.index:""} of level ${Z.level} was aborted`),this.resetFragmentLoading(Z))}resetFragmentLoading(Z){(!this.fragCurrent||!this.fragContextChanged(Z)&&this.state!==State.FRAG_LOADING_WAITING_RETRY)&&(this.state=State.IDLE)}onFragmentOrKeyLoadError(Z,ee){if(ee.chunkMeta&&!ee.frag){const et=this.getCurrentContext(ee.chunkMeta);et&&(ee.frag=et.frag)}const ae=ee.frag;if(!ae||ae.type!==Z||!this.levels)return;if(this.fragContextChanged(ae)){var ve;this.warn(`Frag load error must match current frag to retry ${ae.url} > ${(ve=this.fragCurrent)==null?void 0:ve.url}`);return}const ye=ee.details===ErrorDetails.FRAG_GAP;ye&&this.fragmentTracker.fragBuffered(ae,!0);const be=ee.errorAction,{action:Ke,retryCount:Ye=0,retryConfig:Xe}=be||{};if(be&&Ke===NetworkErrorAction.RetryRequest&&Xe){var Qe;this.resetStartWhenNotLoaded((Qe=this.levelLastLoaded)!=null?Qe:ae.level);const et=getRetryDelay(Xe,Ye);this.warn(`Fragment ${ae.sn} of ${Z} ${ae.level} errored with ${ee.details}, retrying loading ${Ye+1}/${Xe.maxNumRetry} in ${et}ms`),be.resolved=!0,this.retryDate=self.performance.now()+et,this.state=State.FRAG_LOADING_WAITING_RETRY}else Xe&&be?(this.resetFragmentErrors(Z),Ye<Xe.maxNumRetry?ye||(be.resolved=!0):logger.warn(`${ee.details} reached or exceeded max retry (${Ye})`)):(be==null?void 0:be.action)===NetworkErrorAction.SendAlternateToPenaltyBox?this.state=State.WAITING_LEVEL:this.state=State.ERROR;this.tickImmediate()}reduceLengthAndFlushBuffer(Z){if(this.state===State.PARSING||this.state===State.PARSED){const ee=Z.parent,ae=this.getFwdBufferInfo(this.mediaBuffer,ee),ve=ae&&ae.len>.5;ve&&this.reduceMaxBufferLength(ae.len);const ye=!ve;return ye&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${ee} buffer`),Z.frag&&(this.fragmentTracker.removeFragment(Z.frag),this.nextLoadPosition=Z.frag.start),this.resetLoadingState(),ye}return!1}resetFragmentErrors(Z){Z===PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),this.state!==State.STOPPED&&(this.state=State.IDLE)}afterBufferFlushed(Z,ee,ae){if(!Z)return;const ve=BufferHelper.getBuffered(Z);this.fragmentTracker.detectEvictedFragments(ee,ve,ae),this.state===State.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=State.IDLE}resetStartWhenNotLoaded(Z){if(!this.loadedmetadata){this.startFragRequested=!1;const ee=this.levels?this.levels[Z].details:null;ee!=null&&ee.live?(this.startPosition=-1,this.setStartPosition(ee,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(Z){var ee;this.warn(`The loading context changed while buffering fragment ${Z.sn} of level ${Z.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded((ee=this.levelLastLoaded)!=null?ee:Z.level),this.resetLoadingState()}removeUnbufferedFrags(Z=0){this.fragmentTracker.removeFragmentsInRange(Z,1/0,this.playlistType,!1,!0)}updateLevelTiming(Z,ee,ae,ve){var ye;const be=ae.details;if(!be){this.warn("level.details undefined");return}if(Object.keys(Z.elementaryStreams).reduce((Ye,Xe)=>{const Qe=Z.elementaryStreams[Xe];if(Qe){const et=Qe.endPTS-Qe.startPTS;if(et<=0)return this.warn(`Could not parse fragment ${Z.sn} ${Xe} duration reliably (${et})`),Ye||!1;const Je=ve?0:updateFragPTSDTS(be,Z,Qe.startPTS,Qe.endPTS,Qe.startDTS,Qe.endDTS);return this.hls.trigger(Events.LEVEL_PTS_UPDATED,{details:be,level:ae,drift:Je,type:Xe,frag:Z,start:Qe.startPTS,end:Qe.endPTS}),!0}return Ye},!1))ae.fragmentError=0;else if(((ye=this.transmuxer)==null?void 0:ye.error)===null){const Ye=new Error(`Found no media in fragment ${Z.sn} of level ${Z.level} resetting transmuxer to fallback to playlist timing`);if(ae.fragmentError===0&&(ae.fragmentError++,Z.gap=!0,this.fragmentTracker.removeFragment(Z),this.fragmentTracker.fragBuffered(Z,!0)),this.warn(Ye.message),this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,error:Ye,frag:Z,reason:`Found no media in msn ${Z.sn} of level "${ae.url}"`}),!this.hls)return;this.resetTransmuxer()}this.state=State.PARSED,this.hls.trigger(Events.FRAG_PARSED,{frag:Z,part:ee})}resetTransmuxer(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)}recoverWorkerError(Z){if(Z.event==="demuxerWorker"){var ee,ae,ve;this.fragmentTracker.removeAllFragments(),this.resetTransmuxer(),this.resetStartWhenNotLoaded((ee=(ae=this.levelLastLoaded)!=null?ae:(ve=this.fragCurrent)==null?void 0:ve.level)!=null?ee:0),this.resetLoadingState()}}set state(Z){const ee=this._state;ee!==Z&&(this._state=Z,this.log(`${ee}->${Z}`))}get state(){return this._state}}function getSourceBuffer(){return self.SourceBuffer||self.WebKitSourceBuffer}function isSupported(){const ie=getMediaSource();if(!ie)return!1;const Z=getSourceBuffer(),ee=ie&&typeof ie.isTypeSupported=="function"&&ie.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),ae=!Z||Z.prototype&&typeof Z.prototype.appendBuffer=="function"&&typeof Z.prototype.remove=="function";return!!ee&&!!ae}function changeTypeSupported(){var ie;const Z=getSourceBuffer();return typeof(Z==null||(ie=Z.prototype)==null?void 0:ie.changeType)=="function"}function hasUMDWorker(){return typeof __HLS_WORKER_BUNDLE__=="function"}function injectWorker(){const ie=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),Z=self.URL.createObjectURL(ie);return{worker:new self.Worker(Z),objectURL:Z}}function loadWorker(ie){const Z=new self.URL(ie,self.location.href).href;return{worker:new self.Worker(Z),scriptURL:Z}}function dummyTrack(ie="",Z=9e4){return{type:ie,id:-1,pid:-1,inputTimeScale:Z,sequenceNumber:-1,samples:[],dropped:0}}class BaseAudioDemuxer{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(Z,ee,ae,ve){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(Z){this.initPTS=Z,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(Z,ee){return!1}appendFrame(Z,ee,ae){}demux(Z,ee){this.cachedData&&(Z=appendUint8Array(this.cachedData,Z),this.cachedData=null);let ae=getID3Data(Z,0),ve=ae?ae.length:0,ye;const be=this._audioTrack,Ke=this._id3Track,Ye=ae?getTimeStamp(ae):void 0,Xe=Z.length;for((this.basePTS===null||this.frameIndex===0&&isFiniteNumber(Ye))&&(this.basePTS=initPTSFn(Ye,ee,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),ae&&ae.length>0&&Ke.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:ae,type:MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});ve<Xe;){if(this.canParse(Z,ve)){const Qe=this.appendFrame(be,Z,ve);Qe?(this.frameIndex++,this.lastPTS=Qe.sample.pts,ve+=Qe.length,ye=ve):ve=Xe}else canParse$2(Z,ve)?(ae=getID3Data(Z,ve),Ke.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:ae,type:MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY}),ve+=ae.length,ye=ve):ve++;if(ve===Xe&&ye!==Xe){const Qe=sliceUint8(Z,ye);this.cachedData?this.cachedData=appendUint8Array(this.cachedData,Qe):this.cachedData=Qe}}return{audioTrack:be,videoTrack:dummyTrack(),id3Track:Ke,textTrack:dummyTrack()}}demuxSampleAes(Z,ee,ae){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(Z){const ee=this.cachedData;return ee&&(this.cachedData=null,this.demux(ee,0)),{audioTrack:this._audioTrack,videoTrack:dummyTrack(),id3Track:this._id3Track,textTrack:dummyTrack()}}destroy(){}}const initPTSFn=(ie,Z,ee)=>{if(isFiniteNumber(ie))return ie*90;const ae=ee?ee.baseTime*9e4/ee.timescale:0;return Z*9e4+ae};function getAudioConfig(ie,Z,ee,ae){let ve,ye,be,Ke;const Ye=navigator.userAgent.toLowerCase(),Xe=ae,Qe=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];ve=((Z[ee+2]&192)>>>6)+1;const et=(Z[ee+2]&60)>>>2;if(et>Qe.length-1){ie.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:`invalid ADTS sampling index:${et}`});return}return be=(Z[ee+2]&1)<<2,be|=(Z[ee+3]&192)>>>6,logger.log(`manifest codec:${ae}, ADTS type:${ve}, samplingIndex:${et}`),/firefox/i.test(Ye)?et>=6?(ve=5,Ke=new Array(4),ye=et-3):(ve=2,Ke=new Array(2),ye=et):Ye.indexOf("android")!==-1?(ve=2,Ke=new Array(2),ye=et):(ve=5,Ke=new Array(4),ae&&(ae.indexOf("mp4a.40.29")!==-1||ae.indexOf("mp4a.40.5")!==-1)||!ae&&et>=6?ye=et-3:((ae&&ae.indexOf("mp4a.40.2")!==-1&&(et>=6&&be===1||/vivaldi/i.test(Ye))||!ae&&be===1)&&(ve=2,Ke=new Array(2)),ye=et)),Ke[0]=ve<<3,Ke[0]|=(et&14)>>1,Ke[1]|=(et&1)<<7,Ke[1]|=be<<3,ve===5&&(Ke[1]|=(ye&14)>>1,Ke[2]=(ye&1)<<7,Ke[2]|=8,Ke[3]=0),{config:Ke,samplerate:Qe[et],channelCount:be,codec:"mp4a.40."+ve,manifestCodec:Xe}}function isHeaderPattern$1(ie,Z){return ie[Z]===255&&(ie[Z+1]&246)===240}function getHeaderLength(ie,Z){return ie[Z+1]&1?7:9}function getFullFrameLength(ie,Z){return(ie[Z+3]&3)<<11|ie[Z+4]<<3|(ie[Z+5]&224)>>>5}function canGetFrameLength(ie,Z){return Z+5<ie.length}function isHeader$1(ie,Z){return Z+1<ie.length&&isHeaderPattern$1(ie,Z)}function canParse$1(ie,Z){return canGetFrameLength(ie,Z)&&isHeaderPattern$1(ie,Z)&&getFullFrameLength(ie,Z)<=ie.length-Z}function probe$1(ie,Z){if(isHeader$1(ie,Z)){const ee=getHeaderLength(ie,Z);if(Z+ee>=ie.length)return!1;const ae=getFullFrameLength(ie,Z);if(ae<=ee)return!1;const ve=Z+ae;return ve===ie.length||isHeader$1(ie,ve)}return!1}function initTrackConfig(ie,Z,ee,ae,ve){if(!ie.samplerate){const ye=getAudioConfig(Z,ee,ae,ve);if(!ye)return;ie.config=ye.config,ie.samplerate=ye.samplerate,ie.channelCount=ye.channelCount,ie.codec=ye.codec,ie.manifestCodec=ye.manifestCodec,logger.log(`parsed codec:${ie.codec}, rate:${ye.samplerate}, channels:${ye.channelCount}`)}}function getFrameDuration(ie){return 1024*9e4/ie}function parseFrameHeader(ie,Z){const ee=getHeaderLength(ie,Z);if(Z+ee<=ie.length){const ae=getFullFrameLength(ie,Z)-ee;if(ae>0)return{headerLength:ee,frameLength:ae}}}function appendFrame$1(ie,Z,ee,ae,ve){const ye=getFrameDuration(ie.samplerate),be=ae+ve*ye,Ke=parseFrameHeader(Z,ee);let Ye;if(Ke){const{frameLength:et,headerLength:Je}=Ke,rt=Je+et,it=Math.max(0,ee+rt-Z.length);it?(Ye=new Uint8Array(rt-Je),Ye.set(Z.subarray(ee+Je,Z.length),0)):Ye=Z.subarray(ee+Je,ee+rt);const nt={unit:Ye,pts:be};return it||ie.samples.push(nt),{sample:nt,length:rt,missing:it}}const Xe=Z.length-ee;return Ye=new Uint8Array(Xe),Ye.set(Z.subarray(ee,Z.length),0),{sample:{unit:Ye,pts:be},length:Xe,missing:-1}}class AACDemuxer extends BaseAudioDemuxer{constructor(Z,ee){super(),this.observer=void 0,this.config=void 0,this.observer=Z,this.config=ee}resetInitSegment(Z,ee,ae,ve){super.resetInitSegment(Z,ee,ae,ve),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:ee,duration:ve,inputTimeScale:9e4,dropped:0}}static probe(Z){if(!Z)return!1;let ae=(getID3Data(Z,0)||[]).length;for(let ve=Z.length;ae<ve;ae++)if(probe$1(Z,ae))return logger.log("ADTS sync word found !"),!0;return!1}canParse(Z,ee){return canParse$1(Z,ee)}appendFrame(Z,ee,ae){initTrackConfig(Z,this.observer,ee,ae,Z.manifestCodec);const ve=appendFrame$1(Z,ee,ae,this.basePTS,this.frameIndex);if(ve&&ve.missing===0)return ve}}const emsgSchemePattern=/\/emsg[-/]ID3/i;class MP4Demuxer{constructor(Z,ee){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=ee}resetTimeStamp(){}resetInitSegment(Z,ee,ae,ve){const ye=this.videoTrack=dummyTrack("video",1),be=this.audioTrack=dummyTrack("audio",1),Ke=this.txtTrack=dummyTrack("text",1);if(this.id3Track=dummyTrack("id3",1),this.timeOffset=0,!(Z!=null&&Z.byteLength))return;const Ye=parseInitSegment(Z);if(Ye.video){const{id:Xe,timescale:Qe,codec:et}=Ye.video;ye.id=Xe,ye.timescale=Ke.timescale=Qe,ye.codec=et}if(Ye.audio){const{id:Xe,timescale:Qe,codec:et}=Ye.audio;be.id=Xe,be.timescale=Qe,be.codec=et}Ke.id=RemuxerTrackIdConfig.text,ye.sampleDuration=0,ye.duration=be.duration=ve}resetContiguity(){this.remainderData=null}static probe(Z){return Z=Z.length>16384?Z.subarray(0,16384):Z,findBox(Z,["moof"]).length>0}demux(Z,ee){this.timeOffset=ee;let ae=Z;const ve=this.videoTrack,ye=this.txtTrack;if(this.config.progressive){this.remainderData&&(ae=appendUint8Array(this.remainderData,Z));const Ke=segmentValidRange(ae);this.remainderData=Ke.remainder,ve.samples=Ke.valid||new Uint8Array}else ve.samples=ae;const be=this.extractID3Track(ve,ee);return ye.samples=parseSamples(ee,ve),{videoTrack:ve,audioTrack:this.audioTrack,id3Track:be,textTrack:this.txtTrack}}flush(){const Z=this.timeOffset,ee=this.videoTrack,ae=this.txtTrack;ee.samples=this.remainderData||new Uint8Array,this.remainderData=null;const ve=this.extractID3Track(ee,this.timeOffset);return ae.samples=parseSamples(Z,ee),{videoTrack:ee,audioTrack:dummyTrack(),id3Track:ve,textTrack:dummyTrack()}}extractID3Track(Z,ee){const ae=this.id3Track;if(Z.samples.length){const ve=findBox(Z.samples,["emsg"]);ve&&ve.forEach(ye=>{const be=parseEmsg(ye);if(emsgSchemePattern.test(be.schemeIdUri)){const Ke=isFiniteNumber(be.presentationTime)?be.presentationTime/be.timeScale:ee+be.presentationTimeDelta/be.timeScale;let Ye=be.eventDuration===4294967295?Number.POSITIVE_INFINITY:be.eventDuration/be.timeScale;Ye<=.001&&(Ye=Number.POSITIVE_INFINITY);const Xe=be.payload;ae.samples.push({data:Xe,len:Xe.byteLength,dts:Ke,pts:Ke,type:MetadataSchema.emsg,duration:Ye})}})}return ae}demuxSampleAes(Z,ee,ae){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){}}let chromeVersion$1=null;const BitratesMap=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot=[0,1,1,4];function appendFrame(ie,Z,ee,ae,ve){if(ee+24>Z.length)return;const ye=parseHeader(Z,ee);if(ye&&ee+ye.frameLength<=Z.length){const be=ye.samplesPerFrame*9e4/ye.sampleRate,Ke=ae+ve*be,Ye={unit:Z.subarray(ee,ee+ye.frameLength),pts:Ke,dts:Ke};return ie.config=[],ie.channelCount=ye.channelCount,ie.samplerate=ye.sampleRate,ie.samples.push(Ye),{sample:Ye,length:ye.frameLength,missing:0}}}function parseHeader(ie,Z){const ee=ie[Z+1]>>3&3,ae=ie[Z+1]>>1&3,ve=ie[Z+2]>>4&15,ye=ie[Z+2]>>2&3;if(ee!==1&&ve!==0&&ve!==15&&ye!==3){const be=ie[Z+2]>>1&1,Ke=ie[Z+3]>>6,Ye=ee===3?3-ae:ae===3?3:4,Xe=BitratesMap[Ye*14+ve-1]*1e3,et=SamplingRateMap[(ee===3?0:ee===2?1:2)*3+ye],Je=Ke===3?1:2,rt=SamplesCoefficients[ee][ae],it=BytesInSlot[ae],nt=rt*8*it,tt=Math.floor(rt*Xe/et+be)*it;if(chromeVersion$1===null){const ut=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);chromeVersion$1=ut?parseInt(ut[1]):0}return!!chromeVersion$1&&chromeVersion$1<=87&&ae===2&&Xe>=224e3&&Ke===0&&(ie[Z+3]=ie[Z+3]|128),{sampleRate:et,channelCount:Je,frameLength:tt,samplesPerFrame:nt}}}function isHeaderPattern(ie,Z){return ie[Z]===255&&(ie[Z+1]&224)===224&&(ie[Z+1]&6)!==0}function isHeader(ie,Z){return Z+1<ie.length&&isHeaderPattern(ie,Z)}function canParse(ie,Z){return isHeaderPattern(ie,Z)&&4<=ie.length-Z}function probe(ie,Z){if(Z+1<ie.length&&isHeaderPattern(ie,Z)){const ae=parseHeader(ie,Z);let ve=4;ae!=null&&ae.frameLength&&(ve=ae.frameLength);const ye=Z+ve;return ye===ie.length||isHeader(ie,ye)}return!1}class ExpGolomb{constructor(Z){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=Z,this.bytesAvailable=Z.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const Z=this.data,ee=this.bytesAvailable,ae=Z.byteLength-ee,ve=new Uint8Array(4),ye=Math.min(4,ee);if(ye===0)throw new Error("no bytes available");ve.set(Z.subarray(ae,ae+ye)),this.word=new DataView(ve.buffer).getUint32(0),this.bitsAvailable=ye*8,this.bytesAvailable-=ye}skipBits(Z){let ee;Z=Math.min(Z,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>Z?(this.word<<=Z,this.bitsAvailable-=Z):(Z-=this.bitsAvailable,ee=Z>>3,Z-=ee<<3,this.bytesAvailable-=ee,this.loadWord(),this.word<<=Z,this.bitsAvailable-=Z)}readBits(Z){let ee=Math.min(this.bitsAvailable,Z);const ae=this.word>>>32-ee;if(Z>32&&logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=ee,this.bitsAvailable>0)this.word<<=ee;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return ee=Z-ee,ee>0&&this.bitsAvailable?ae<<ee|this.readBits(ee):ae}skipLZ(){let Z;for(Z=0;Z<this.bitsAvailable;++Z)if(this.word&2147483648>>>Z)return this.word<<=Z,this.bitsAvailable-=Z,Z;return this.loadWord(),Z+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const Z=this.skipLZ();return this.readBits(Z+1)-1}readEG(){const Z=this.readUEG();return 1&Z?1+Z>>>1:-1*(Z>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}skipScalingList(Z){let ee=8,ae=8,ve;for(let ye=0;ye<Z;ye++)ae!==0&&(ve=this.readEG(),ae=(ee+ve+256)%256),ee=ae===0?ee:ae}readSPS(){let Z=0,ee=0,ae=0,ve=0,ye,be,Ke;const Ye=this.readUByte.bind(this),Xe=this.readBits.bind(this),Qe=this.readUEG.bind(this),et=this.readBoolean.bind(this),Je=this.skipBits.bind(this),rt=this.skipEG.bind(this),it=this.skipUEG.bind(this),nt=this.skipScalingList.bind(this);Ye();const tt=Ye();if(Xe(5),Je(3),Ye(),it(),tt===100||tt===110||tt===122||tt===244||tt===44||tt===83||tt===86||tt===118||tt===128){const Xr=Qe();if(Xr===3&&Je(1),it(),it(),Je(1),et())for(be=Xr!==3?8:12,Ke=0;Ke<be;Ke++)et()&&(Ke<6?nt(16):nt(64))}it();const st=Qe();if(st===0)Qe();else if(st===1)for(Je(1),rt(),rt(),ye=Qe(),Ke=0;Ke<ye;Ke++)rt();it(),Je(1);const ot=Qe(),ut=Qe(),ft=Xe(1);ft===0&&Je(1),Je(1),et()&&(Z=Qe(),ee=Qe(),ae=Qe(),ve=Qe());let pt=[1,1];if(et()&&et())switch(Ye()){case 1:pt=[1,1];break;case 2:pt=[12,11];break;case 3:pt=[10,11];break;case 4:pt=[16,11];break;case 5:pt=[40,33];break;case 6:pt=[24,11];break;case 7:pt=[20,11];break;case 8:pt=[32,11];break;case 9:pt=[80,33];break;case 10:pt=[18,11];break;case 11:pt=[15,11];break;case 12:pt=[64,33];break;case 13:pt=[160,99];break;case 14:pt=[4,3];break;case 15:pt=[3,2];break;case 16:pt=[2,1];break;case 255:{pt=[Ye()<<8|Ye(),Ye()<<8|Ye()];break}}return{width:Math.ceil((ot+1)*16-Z*2-ee*2),height:(2-ft)*(ut+1)*16-(ft?2:4)*(ae+ve),pixelRatio:pt}}readSliceType(){return this.readUByte(),this.readUEG(),this.readUEG()}}class SampleAesDecrypter{constructor(Z,ee,ae){this.keyData=void 0,this.decrypter=void 0,this.keyData=ae,this.decrypter=new Decrypter(ee,{removePKCS7Padding:!1})}decryptBuffer(Z){return this.decrypter.decrypt(Z,this.keyData.key.buffer,this.keyData.iv.buffer)}decryptAacSample(Z,ee,ae){const ve=Z[ee].unit;if(ve.length<=16)return;const ye=ve.subarray(16,ve.length-ve.length%16),be=ye.buffer.slice(ye.byteOffset,ye.byteOffset+ye.length);this.decryptBuffer(be).then(Ke=>{const Ye=new Uint8Array(Ke);ve.set(Ye,16),this.decrypter.isSync()||this.decryptAacSamples(Z,ee+1,ae)})}decryptAacSamples(Z,ee,ae){for(;;ee++){if(ee>=Z.length){ae();return}if(!(Z[ee].unit.length<32)&&(this.decryptAacSample(Z,ee,ae),!this.decrypter.isSync()))return}}getAvcEncryptedData(Z){const ee=Math.floor((Z.length-48)/160)*16+16,ae=new Int8Array(ee);let ve=0;for(let ye=32;ye<Z.length-16;ye+=160,ve+=16)ae.set(Z.subarray(ye,ye+16),ve);return ae}getAvcDecryptedUnit(Z,ee){const ae=new Uint8Array(ee);let ve=0;for(let ye=32;ye<Z.length-16;ye+=160,ve+=16)Z.set(ae.subarray(ve,ve+16),ye);return Z}decryptAvcSample(Z,ee,ae,ve,ye){const be=discardEPB(ye.data),Ke=this.getAvcEncryptedData(be);this.decryptBuffer(Ke.buffer).then(Ye=>{ye.data=this.getAvcDecryptedUnit(be,Ye),this.decrypter.isSync()||this.decryptAvcSamples(Z,ee,ae+1,ve)})}decryptAvcSamples(Z,ee,ae,ve){if(Z instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;ee++,ae=0){if(ee>=Z.length){ve();return}const ye=Z[ee].units;for(;!(ae>=ye.length);ae++){const be=ye[ae];if(!(be.data.length<=48||be.type!==1&&be.type!==5)&&(this.decryptAvcSample(Z,ee,ae,ve,be),!this.decrypter.isSync()))return}}}}const PACKET_LENGTH=188;class TSDemuxer{constructor(Z,ee,ae){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=Z,this.config=ee,this.typeSupported=ae}static probe(Z){const ee=TSDemuxer.syncOffset(Z);return ee>0&&logger.warn(`MPEG2-TS detected but first sync word found @ offset ${ee}`),ee!==-1}static syncOffset(Z){const ee=Z.length;let ae=Math.min(PACKET_LENGTH*5,Z.length-PACKET_LENGTH)+1,ve=0;for(;ve<ae;){let ye=!1,be=-1,Ke=0;for(let Ye=ve;Ye<ee;Ye+=PACKET_LENGTH)if(Z[Ye]===71){if(Ke++,be===-1&&(be=Ye,be!==0&&(ae=Math.min(be+PACKET_LENGTH*99,Z.length-PACKET_LENGTH)+1)),ye||(ye=parsePID(Z,Ye)===0),ye&&Ke>1&&(be===0&&Ke>2||Ye+PACKET_LENGTH>ae))return be}else{if(Ke)return-1;break}ve++}return-1}static createTrack(Z,ee){return{container:Z==="video"||Z==="audio"?"video/mp2t":void 0,type:Z,id:RemuxerTrackIdConfig[Z],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:Z==="audio"?ee:void 0}}resetInitSegment(Z,ee,ae,ve){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=TSDemuxer.createTrack("video"),this._audioTrack=TSDemuxer.createTrack("audio",ve),this._id3Track=TSDemuxer.createTrack("id3"),this._txtTrack=TSDemuxer.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=ee,this.videoCodec=ae,this._duration=ve}resetTimeStamp(){}resetContiguity(){const{_audioTrack:Z,_avcTrack:ee,_id3Track:ae}=this;Z&&(Z.pesData=null),ee&&(ee.pesData=null),ae&&(ae.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null}demux(Z,ee,ae=!1,ve=!1){ae||(this.sampleAes=null);let ye;const be=this._avcTrack,Ke=this._audioTrack,Ye=this._id3Track,Xe=this._txtTrack;let Qe=be.pid,et=be.pesData,Je=Ke.pid,rt=Ye.pid,it=Ke.pesData,nt=Ye.pesData,tt=null,st=this.pmtParsed,ot=this._pmtId,ut=Z.length;if(this.remainderData&&(Z=appendUint8Array(this.remainderData,Z),ut=Z.length,this.remainderData=null),ut<PACKET_LENGTH&&!ve)return this.remainderData=Z,{audioTrack:Ke,videoTrack:be,id3Track:Ye,textTrack:Xe};const ft=Math.max(0,TSDemuxer.syncOffset(Z));ut-=(ut-ft)%PACKET_LENGTH,ut<Z.byteLength&&!ve&&(this.remainderData=new Uint8Array(Z.buffer,ut,Z.buffer.byteLength-ut));let pt=0;for(let mt=ft;mt<ut;mt+=PACKET_LENGTH)if(Z[mt]===71){const Yr=!!(Z[mt+1]&64),ri=parsePID(Z,mt),Zr=(Z[mt+3]&48)>>4;let _r;if(Zr>1){if(_r=mt+5+Z[mt+4],_r===mt+PACKET_LENGTH)continue}else _r=mt+4;switch(ri){case Qe:Yr&&(et&&(ye=parsePES(et))&&this.parseAVCPES(be,Xe,ye,!1),et={data:[],size:0}),et&&(et.data.push(Z.subarray(_r,mt+PACKET_LENGTH)),et.size+=mt+PACKET_LENGTH-_r);break;case Je:if(Yr){if(it&&(ye=parsePES(it)))switch(Ke.segmentCodec){case"aac":this.parseAACPES(Ke,ye);break;case"mp3":this.parseMPEGPES(Ke,ye);break}it={data:[],size:0}}it&&(it.data.push(Z.subarray(_r,mt+PACKET_LENGTH)),it.size+=mt+PACKET_LENGTH-_r);break;case rt:Yr&&(nt&&(ye=parsePES(nt))&&this.parseID3PES(Ye,ye),nt={data:[],size:0}),nt&&(nt.data.push(Z.subarray(_r,mt+PACKET_LENGTH)),nt.size+=mt+PACKET_LENGTH-_r);break;case 0:Yr&&(_r+=Z[_r]+1),ot=this._pmtId=parsePAT(Z,_r);break;case ot:{Yr&&(_r+=Z[_r]+1);const Kr=parsePMT(Z,_r,this.typeSupported,ae);Qe=Kr.avc,Qe>0&&(be.pid=Qe),Je=Kr.audio,Je>0&&(Ke.pid=Je,Ke.segmentCodec=Kr.segmentCodec),rt=Kr.id3,rt>0&&(Ye.pid=rt),tt!==null&&!st&&(logger.warn(`MPEG-TS PMT found at ${mt} after unknown PID '${tt}'. Backtracking to sync byte @${ft} to parse all TS packets.`),tt=null,mt=ft-188),st=this.pmtParsed=!0;break}case 17:case 8191:break;default:tt=ri;break}}else pt++;if(pt>0){const mt=new Error(`Found ${pt} TS packet/s that do not start with 0x47`);this.observer.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,error:mt,reason:mt.message})}be.pesData=et,Ke.pesData=it,Ye.pesData=nt;const Xr={audioTrack:Ke,videoTrack:be,id3Track:Ye,textTrack:Xe};return ve&&this.extractRemainingSamples(Xr),Xr}flush(){const{remainderData:Z}=this;this.remainderData=null;let ee;return Z?ee=this.demux(Z,-1,!1,!0):ee={videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(ee),this.sampleAes?this.decrypt(ee,this.sampleAes):ee}extractRemainingSamples(Z){const{audioTrack:ee,videoTrack:ae,id3Track:ve,textTrack:ye}=Z,be=ae.pesData,Ke=ee.pesData,Ye=ve.pesData;let Xe;if(be&&(Xe=parsePES(be))?(this.parseAVCPES(ae,ye,Xe,!0),ae.pesData=null):ae.pesData=be,Ke&&(Xe=parsePES(Ke))){switch(ee.segmentCodec){case"aac":this.parseAACPES(ee,Xe);break;case"mp3":this.parseMPEGPES(ee,Xe);break}ee.pesData=null}else Ke!=null&&Ke.size&&logger.log("last AAC PES packet truncated,might overlap between fragments"),ee.pesData=Ke;Ye&&(Xe=parsePES(Ye))?(this.parseID3PES(ve,Xe),ve.pesData=null):ve.pesData=Ye}demuxSampleAes(Z,ee,ae){const ve=this.demux(Z,ae,!0,!this.config.progressive),ye=this.sampleAes=new SampleAesDecrypter(this.observer,this.config,ee);return this.decrypt(ve,ye)}decrypt(Z,ee){return new Promise(ae=>{const{audioTrack:ve,videoTrack:ye}=Z;ve.samples&&ve.segmentCodec==="aac"?ee.decryptAacSamples(ve.samples,0,()=>{ye.samples?ee.decryptAvcSamples(ye.samples,0,0,()=>{ae(Z)}):ae(Z)}):ye.samples&&ee.decryptAvcSamples(ye.samples,0,0,()=>{ae(Z)})})}destroy(){this._duration=0}parseAVCPES(Z,ee,ae,ve){const ye=this.parseAVCNALu(Z,ae.data);let be=this.avcSample,Ke,Ye=!1;ae.data=null,be&&ye.length&&!Z.audFound&&(pushAccessUnit(be,Z),be=this.avcSample=createAVCSample(!1,ae.pts,ae.dts,"")),ye.forEach(Xe=>{var Qe;switch(Xe.type){case 1:{let Je=!1;Ke=!0;const rt=Xe.data;if(Ye&&rt.length>4){const it=new ExpGolomb(rt).readSliceType();(it===2||it===4||it===7||it===9)&&(Je=!0)}if(Je){var et;(et=be)!=null&&et.frame&&!be.key&&(pushAccessUnit(be,Z),be=this.avcSample=null)}be||(be=this.avcSample=createAVCSample(!0,ae.pts,ae.dts,"")),be.frame=!0,be.key=Je;break}case 5:Ke=!0,(Qe=be)!=null&&Qe.frame&&!be.key&&(pushAccessUnit(be,Z),be=this.avcSample=null),be||(be=this.avcSample=createAVCSample(!0,ae.pts,ae.dts,"")),be.key=!0,be.frame=!0;break;case 6:{Ke=!0,parseSEIMessageFromNALu(Xe.data,1,ae.pts,ee.samples);break}case 7:if(Ke=!0,Ye=!0,!Z.sps){const Je=Xe.data,it=new ExpGolomb(Je).readSPS();Z.width=it.width,Z.height=it.height,Z.pixelRatio=it.pixelRatio,Z.sps=[Je],Z.duration=this._duration;const nt=Je.subarray(1,4);let tt="avc1.";for(let st=0;st<3;st++){let ot=nt[st].toString(16);ot.length<2&&(ot="0"+ot),tt+=ot}Z.codec=tt}break;case 8:Ke=!0,Z.pps||(Z.pps=[Xe.data]);break;case 9:Ke=!1,Z.audFound=!0,be&&pushAccessUnit(be,Z),be=this.avcSample=createAVCSample(!1,ae.pts,ae.dts,"");break;case 12:Ke=!0;break;default:Ke=!1,be&&(be.debug+="unknown NAL "+Xe.type+" ");break}be&&Ke&&be.units.push(Xe)}),ve&&be&&(pushAccessUnit(be,Z),this.avcSample=null)}getLastNalUnit(Z){var ee;let ae=this.avcSample,ve;if((!ae||ae.units.length===0)&&(ae=Z[Z.length-1]),(ee=ae)!=null&&ee.units){const ye=ae.units;ve=ye[ye.length-1]}return ve}parseAVCNALu(Z,ee){const ae=ee.byteLength;let ve=Z.naluState||0;const ye=ve,be=[];let Ke=0,Ye,Xe,Qe,et=-1,Je=0;for(ve===-1&&(et=0,Je=ee[0]&31,ve=0,Ke=1);Ke<ae;){if(Ye=ee[Ke++],!ve){ve=Ye?0:1;continue}if(ve===1){ve=Ye?0:2;continue}if(!Ye)ve=3;else if(Ye===1){if(et>=0){const rt={data:ee.subarray(et,Ke-ve-1),type:Je};be.push(rt)}else{const rt=this.getLastNalUnit(Z.samples);if(rt&&(ye&&Ke<=4-ye&&rt.state&&(rt.data=rt.data.subarray(0,rt.data.byteLength-ye)),Xe=Ke-ve-1,Xe>0)){const it=new Uint8Array(rt.data.byteLength+Xe);it.set(rt.data,0),it.set(ee.subarray(0,Xe),rt.data.byteLength),rt.data=it,rt.state=0}}Ke<ae?(Qe=ee[Ke]&31,et=Ke,Je=Qe,ve=0):ve=-1}else ve=0}if(et>=0&&ve>=0){const rt={data:ee.subarray(et,ae),type:Je,state:ve};be.push(rt)}if(be.length===0){const rt=this.getLastNalUnit(Z.samples);if(rt){const it=new Uint8Array(rt.data.byteLength+ee.byteLength);it.set(rt.data,0),it.set(ee,rt.data.byteLength),rt.data=it}}return Z.naluState=ve,be}parseAACPES(Z,ee){let ae=0;const ve=this.aacOverFlow;let ye=ee.data;if(ve){this.aacOverFlow=null;const et=ve.missing,Je=ve.sample.unit.byteLength;if(et===-1){const rt=new Uint8Array(Je+ye.byteLength);rt.set(ve.sample.unit,0),rt.set(ye,Je),ye=rt}else{const rt=Je-et;ve.sample.unit.set(ye.subarray(0,et),rt),Z.samples.push(ve.sample),ae=ve.missing}}let be,Ke;for(be=ae,Ke=ye.length;be<Ke-1&&!isHeader$1(ye,be);be++);if(be!==ae){let et;const Je=be<Ke-1;Je?et=`AAC PES did not start with ADTS header,offset:${be}`:et="No ADTS header found in AAC PES";const rt=new Error(et);if(logger.warn(`parsing error: ${et}`),this.observer.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,levelRetry:Je,error:rt,reason:et}),!Je)return}initTrackConfig(Z,this.observer,ye,be,this.audioCodec);let Ye;if(ee.pts!==void 0)Ye=ee.pts;else if(ve){const et=getFrameDuration(Z.samplerate);Ye=ve.sample.pts+et}else{logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let Xe=0,Qe;for(;be<Ke;)if(Qe=appendFrame$1(Z,ye,be,Ye,Xe),be+=Qe.length,Qe.missing){this.aacOverFlow=Qe;break}else for(Xe++;be<Ke-1&&!isHeader$1(ye,be);be++);}parseMPEGPES(Z,ee){const ae=ee.data,ve=ae.length;let ye=0,be=0;const Ke=ee.pts;if(Ke===void 0){logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;be<ve;)if(isHeader(ae,be)){const Ye=appendFrame(Z,ae,be,Ke,ye);if(Ye)be+=Ye.length,ye++;else break}else be++}parseID3PES(Z,ee){if(ee.pts===void 0){logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const ae=_extends({},ee,{type:this._avcTrack?MetadataSchema.emsg:MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});Z.samples.push(ae)}}function createAVCSample(ie,Z,ee,ae){return{key:ie,frame:!1,pts:Z,dts:ee,units:[],debug:ae,length:0}}function parsePID(ie,Z){return((ie[Z+1]&31)<<8)+ie[Z+2]}function parsePAT(ie,Z){return(ie[Z+10]&31)<<8|ie[Z+11]}function parsePMT(ie,Z,ee,ae){const ve={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},ye=(ie[Z+1]&15)<<8|ie[Z+2],be=Z+3+ye-4,Ke=(ie[Z+10]&15)<<8|ie[Z+11];for(Z+=12+Ke;Z<be;){const Ye=parsePID(ie,Z);switch(ie[Z]){case 207:if(!ae){logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:ve.audio===-1&&(ve.audio=Ye);break;case 21:ve.id3===-1&&(ve.id3=Ye);break;case 219:if(!ae){logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:ve.avc===-1&&(ve.avc=Ye);break;case 3:case 4:ee.mpeg!==!0&&ee.mp3!==!0?logger.log("MPEG audio found, not supported in this browser"):ve.audio===-1&&(ve.audio=Ye,ve.segmentCodec="mp3");break;case 36:logger.warn("Unsupported HEVC stream type found");break}Z+=((ie[Z+3]&15)<<8|ie[Z+4])+5}return ve}function parsePES(ie){let Z=0,ee,ae,ve,ye,be;const Ke=ie.data;if(!ie||ie.size===0)return null;for(;Ke[0].length<19&&Ke.length>1;){const Xe=new Uint8Array(Ke[0].length+Ke[1].length);Xe.set(Ke[0]),Xe.set(Ke[1],Ke[0].length),Ke[0]=Xe,Ke.splice(1,1)}if(ee=Ke[0],(ee[0]<<16)+(ee[1]<<8)+ee[2]===1){if(ae=(ee[4]<<8)+ee[5],ae&&ae>ie.size-6)return null;const Xe=ee[7];Xe&192&&(ye=(ee[9]&14)*536870912+(ee[10]&255)*4194304+(ee[11]&254)*16384+(ee[12]&255)*128+(ee[13]&254)/2,Xe&64?(be=(ee[14]&14)*536870912+(ee[15]&255)*4194304+(ee[16]&254)*16384+(ee[17]&255)*128+(ee[18]&254)/2,ye-be>60*9e4&&(logger.warn(`${Math.round((ye-be)/9e4)}s delta between PTS and DTS, align them`),ye=be)):be=ye),ve=ee[8];let Qe=ve+9;if(ie.size<=Qe)return null;ie.size-=Qe;const et=new Uint8Array(ie.size);for(let Je=0,rt=Ke.length;Je<rt;Je++){ee=Ke[Je];let it=ee.byteLength;if(Qe)if(Qe>it){Qe-=it;continue}else ee=ee.subarray(Qe),it-=Qe,Qe=0;et.set(ee,Z),Z+=it}return ae&&(ae-=ve+3),{data:et,pts:ye,dts:be,len:ae}}return null}function pushAccessUnit(ie,Z){if(ie.units.length&&ie.frame){if(ie.pts===void 0){const ee=Z.samples,ae=ee.length;if(ae){const ve=ee[ae-1];ie.pts=ve.pts,ie.dts=ve.dts}else{Z.dropped++;return}}Z.samples.push(ie)}ie.debug.length&&logger.log(ie.pts+"/"+ie.dts+":"+ie.debug)}class MP3Demuxer extends BaseAudioDemuxer{resetInitSegment(Z,ee,ae,ve){super.resetInitSegment(Z,ee,ae,ve),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:ee,duration:ve,inputTimeScale:9e4,dropped:0}}static probe(Z){if(!Z)return!1;let ae=(getID3Data(Z,0)||[]).length;for(let ve=Z.length;ae<ve;ae++)if(probe(Z,ae))return logger.log("MPEG Audio sync word found !"),!0;return!1}canParse(Z,ee){return canParse(Z,ee)}appendFrame(Z,ee,ae){if(this.basePTS!==null)return appendFrame(Z,ee,ae,this.basePTS,this.frameIndex)}}class AAC{static getSilentFrame(Z,ee){switch(Z){case"mp4a.40.2":if(ee===1)return new Uint8Array([0,200,0,128,35,128]);if(ee===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(ee===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(ee===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(ee===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(ee===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(ee===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(ee===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(ee===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const UINT32_MAX=Math.pow(2,32)-1;class MP4{static init(){MP4.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let Z;for(Z in MP4.types)MP4.types.hasOwnProperty(Z)&&(MP4.types[Z]=[Z.charCodeAt(0),Z.charCodeAt(1),Z.charCodeAt(2),Z.charCodeAt(3)]);const ee=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),ae=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);MP4.HDLR_TYPES={video:ee,audio:ae};const ve=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),ye=new Uint8Array([0,0,0,0,0,0,0,0]);MP4.STTS=MP4.STSC=MP4.STCO=ye,MP4.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),MP4.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),MP4.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),MP4.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const be=new Uint8Array([105,115,111,109]),Ke=new Uint8Array([97,118,99,49]),Ye=new Uint8Array([0,0,0,1]);MP4.FTYP=MP4.box(MP4.types.ftyp,be,Ye,be,Ke),MP4.DINF=MP4.box(MP4.types.dinf,MP4.box(MP4.types.dref,ve))}static box(Z,...ee){let ae=8,ve=ee.length;const ye=ve;for(;ve--;)ae+=ee[ve].byteLength;const be=new Uint8Array(ae);for(be[0]=ae>>24&255,be[1]=ae>>16&255,be[2]=ae>>8&255,be[3]=ae&255,be.set(Z,4),ve=0,ae=8;ve<ye;ve++)be.set(ee[ve],ae),ae+=ee[ve].byteLength;return be}static hdlr(Z){return MP4.box(MP4.types.hdlr,MP4.HDLR_TYPES[Z])}static mdat(Z){return MP4.box(MP4.types.mdat,Z)}static mdhd(Z,ee){ee*=Z;const ae=Math.floor(ee/(UINT32_MAX+1)),ve=Math.floor(ee%(UINT32_MAX+1));return MP4.box(MP4.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,Z>>24&255,Z>>16&255,Z>>8&255,Z&255,ae>>24,ae>>16&255,ae>>8&255,ae&255,ve>>24,ve>>16&255,ve>>8&255,ve&255,85,196,0,0]))}static mdia(Z){return MP4.box(MP4.types.mdia,MP4.mdhd(Z.timescale,Z.duration),MP4.hdlr(Z.type),MP4.minf(Z))}static mfhd(Z){return MP4.box(MP4.types.mfhd,new Uint8Array([0,0,0,0,Z>>24,Z>>16&255,Z>>8&255,Z&255]))}static minf(Z){return Z.type==="audio"?MP4.box(MP4.types.minf,MP4.box(MP4.types.smhd,MP4.SMHD),MP4.DINF,MP4.stbl(Z)):MP4.box(MP4.types.minf,MP4.box(MP4.types.vmhd,MP4.VMHD),MP4.DINF,MP4.stbl(Z))}static moof(Z,ee,ae){return MP4.box(MP4.types.moof,MP4.mfhd(Z),MP4.traf(ae,ee))}static moov(Z){let ee=Z.length;const ae=[];for(;ee--;)ae[ee]=MP4.trak(Z[ee]);return MP4.box.apply(null,[MP4.types.moov,MP4.mvhd(Z[0].timescale,Z[0].duration)].concat(ae).concat(MP4.mvex(Z)))}static mvex(Z){let ee=Z.length;const ae=[];for(;ee--;)ae[ee]=MP4.trex(Z[ee]);return MP4.box.apply(null,[MP4.types.mvex,...ae])}static mvhd(Z,ee){ee*=Z;const ae=Math.floor(ee/(UINT32_MAX+1)),ve=Math.floor(ee%(UINT32_MAX+1)),ye=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,Z>>24&255,Z>>16&255,Z>>8&255,Z&255,ae>>24,ae>>16&255,ae>>8&255,ae&255,ve>>24,ve>>16&255,ve>>8&255,ve&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return MP4.box(MP4.types.mvhd,ye)}static sdtp(Z){const ee=Z.samples||[],ae=new Uint8Array(4+ee.length);let ve,ye;for(ve=0;ve<ee.length;ve++)ye=ee[ve].flags,ae[ve+4]=ye.dependsOn<<4|ye.isDependedOn<<2|ye.hasRedundancy;return MP4.box(MP4.types.sdtp,ae)}static stbl(Z){return MP4.box(MP4.types.stbl,MP4.stsd(Z),MP4.box(MP4.types.stts,MP4.STTS),MP4.box(MP4.types.stsc,MP4.STSC),MP4.box(MP4.types.stsz,MP4.STSZ),MP4.box(MP4.types.stco,MP4.STCO))}static avc1(Z){let ee=[],ae=[],ve,ye,be;for(ve=0;ve<Z.sps.length;ve++)ye=Z.sps[ve],be=ye.byteLength,ee.push(be>>>8&255),ee.push(be&255),ee=ee.concat(Array.prototype.slice.call(ye));for(ve=0;ve<Z.pps.length;ve++)ye=Z.pps[ve],be=ye.byteLength,ae.push(be>>>8&255),ae.push(be&255),ae=ae.concat(Array.prototype.slice.call(ye));const Ke=MP4.box(MP4.types.avcC,new Uint8Array([1,ee[3],ee[4],ee[5],255,224|Z.sps.length].concat(ee).concat([Z.pps.length]).concat(ae))),Ye=Z.width,Xe=Z.height,Qe=Z.pixelRatio[0],et=Z.pixelRatio[1];return MP4.box(MP4.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,Ye>>8&255,Ye&255,Xe>>8&255,Xe&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),Ke,MP4.box(MP4.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),MP4.box(MP4.types.pasp,new Uint8Array([Qe>>24,Qe>>16&255,Qe>>8&255,Qe&255,et>>24,et>>16&255,et>>8&255,et&255])))}static esds(Z){const ee=Z.config.length;return new Uint8Array([0,0,0,0,3,23+ee,0,1,0,4,15+ee,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([ee]).concat(Z.config).concat([6,1,2]))}static mp4a(Z){const ee=Z.samplerate;return MP4.box(MP4.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,Z.channelCount,0,16,0,0,0,0,ee>>8&255,ee&255,0,0]),MP4.box(MP4.types.esds,MP4.esds(Z)))}static mp3(Z){const ee=Z.samplerate;return MP4.box(MP4.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,Z.channelCount,0,16,0,0,0,0,ee>>8&255,ee&255,0,0]))}static stsd(Z){return Z.type==="audio"?Z.segmentCodec==="mp3"&&Z.codec==="mp3"?MP4.box(MP4.types.stsd,MP4.STSD,MP4.mp3(Z)):MP4.box(MP4.types.stsd,MP4.STSD,MP4.mp4a(Z)):MP4.box(MP4.types.stsd,MP4.STSD,MP4.avc1(Z))}static tkhd(Z){const ee=Z.id,ae=Z.duration*Z.timescale,ve=Z.width,ye=Z.height,be=Math.floor(ae/(UINT32_MAX+1)),Ke=Math.floor(ae%(UINT32_MAX+1));return MP4.box(MP4.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,ee>>24&255,ee>>16&255,ee>>8&255,ee&255,0,0,0,0,be>>24,be>>16&255,be>>8&255,be&255,Ke>>24,Ke>>16&255,Ke>>8&255,Ke&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,ve>>8&255,ve&255,0,0,ye>>8&255,ye&255,0,0]))}static traf(Z,ee){const ae=MP4.sdtp(Z),ve=Z.id,ye=Math.floor(ee/(UINT32_MAX+1)),be=Math.floor(ee%(UINT32_MAX+1));return MP4.box(MP4.types.traf,MP4.box(MP4.types.tfhd,new Uint8Array([0,0,0,0,ve>>24,ve>>16&255,ve>>8&255,ve&255])),MP4.box(MP4.types.tfdt,new Uint8Array([1,0,0,0,ye>>24,ye>>16&255,ye>>8&255,ye&255,be>>24,be>>16&255,be>>8&255,be&255])),MP4.trun(Z,ae.length+16+20+8+16+8+8),ae)}static trak(Z){return Z.duration=Z.duration||4294967295,MP4.box(MP4.types.trak,MP4.tkhd(Z),MP4.mdia(Z))}static trex(Z){const ee=Z.id;return MP4.box(MP4.types.trex,new Uint8Array([0,0,0,0,ee>>24,ee>>16&255,ee>>8&255,ee&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(Z,ee){const ae=Z.samples||[],ve=ae.length,ye=12+16*ve,be=new Uint8Array(ye);let Ke,Ye,Xe,Qe,et,Je;for(ee+=8+ye,be.set([Z.type==="video"?1:0,0,15,1,ve>>>24&255,ve>>>16&255,ve>>>8&255,ve&255,ee>>>24&255,ee>>>16&255,ee>>>8&255,ee&255],0),Ke=0;Ke<ve;Ke++)Ye=ae[Ke],Xe=Ye.duration,Qe=Ye.size,et=Ye.flags,Je=Ye.cts,be.set([Xe>>>24&255,Xe>>>16&255,Xe>>>8&255,Xe&255,Qe>>>24&255,Qe>>>16&255,Qe>>>8&255,Qe&255,et.isLeading<<2|et.dependsOn,et.isDependedOn<<6|et.hasRedundancy<<4|et.paddingValue<<1|et.isNonSync,et.degradPrio&61440,et.degradPrio&15,Je>>>24&255,Je>>>16&255,Je>>>8&255,Je&255],12+16*Ke);return MP4.box(MP4.types.trun,be)}static initSegment(Z){MP4.types||MP4.init();const ee=MP4.moov(Z),ae=new Uint8Array(MP4.FTYP.byteLength+ee.byteLength);return ae.set(MP4.FTYP),ae.set(ee,MP4.FTYP.byteLength),ae}}MP4.types=void 0;MP4.HDLR_TYPES=void 0;MP4.STTS=void 0;MP4.STSC=void 0;MP4.STCO=void 0;MP4.STSZ=void 0;MP4.VMHD=void 0;MP4.SMHD=void 0;MP4.STSD=void 0;MP4.FTYP=void 0;MP4.DINF=void 0;const MPEG_TS_CLOCK_FREQ_HZ=9e4;function toTimescaleFromBase(ie,Z,ee=1,ae=!1){const ve=ie*Z*ee;return ae?Math.round(ve):ve}function toTimescaleFromScale(ie,Z,ee=1,ae=!1){return toTimescaleFromBase(ie,Z,1/ee,ae)}function toMsFromMpegTsClock(ie,Z=!1){return toTimescaleFromBase(ie,1e3,1/MPEG_TS_CLOCK_FREQ_HZ,Z)}function toMpegTsClockFromTimescale(ie,Z=1){return toTimescaleFromBase(ie,MPEG_TS_CLOCK_FREQ_HZ,1/Z)}const MAX_SILENT_FRAME_DURATION=10*1e3,AAC_SAMPLES_PER_FRAME=1024,MPEG_AUDIO_SAMPLE_PER_FRAME=1152;let chromeVersion=null,safariWebkitVersion=null;class MP4Remuxer{constructor(Z,ee,ae,ve=""){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=Z,this.config=ee,this.typeSupported=ae,this.ISGenerated=!1,chromeVersion===null){const be=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);chromeVersion=be?parseInt(be[1]):0}if(safariWebkitVersion===null){const ye=navigator.userAgent.match(/Safari\/(\d+)/i);safariWebkitVersion=ye?parseInt(ye[1]):0}}destroy(){}resetTimeStamp(Z){logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=Z}resetNextTimestamp(){logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1}getVideoStartPts(Z){let ee=!1;const ae=Z.reduce((ve,ye)=>{const be=ye.pts-ve;return be<-4294967296?(ee=!0,normalizePts(ve,ye.pts)):be>0?ve:ye.pts},Z[0].pts);return ee&&logger.debug("PTS rollover detected"),ae}remux(Z,ee,ae,ve,ye,be,Ke,Ye){let Xe,Qe,et,Je,rt,it,nt=ye,tt=ye;const st=Z.pid>-1,ot=ee.pid>-1,ut=ee.samples.length,ft=Z.samples.length>0,pt=Ke&&ut>0||ut>1;if((!st||ft)&&(!ot||pt)||this.ISGenerated||Ke){this.ISGenerated||(et=this.generateIS(Z,ee,ye,be));const mt=this.isVideoContiguous;let Yr=-1,ri;if(pt&&(Yr=findKeyframeIndex(ee.samples),!mt&&this.config.forceKeyFrameOnDiscontinuity))if(it=!0,Yr>0){logger.warn(`[mp4-remuxer]: Dropped ${Yr} out of ${ut} video samples due to a missing keyframe`);const Zr=this.getVideoStartPts(ee.samples);ee.samples=ee.samples.slice(Yr),ee.dropped+=Yr,tt+=(ee.samples[0].pts-Zr)/ee.inputTimeScale,ri=tt}else Yr===-1&&(logger.warn(`[mp4-remuxer]: No keyframe found out of ${ut} video samples`),it=!1);if(this.ISGenerated){if(ft&&pt){const Zr=this.getVideoStartPts(ee.samples),Kr=(normalizePts(Z.samples[0].pts,Zr)-Zr)/ee.inputTimeScale;nt+=Math.max(0,Kr),tt+=Math.max(0,-Kr)}if(ft){if(Z.samplerate||(logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),et=this.generateIS(Z,ee,ye,be)),Qe=this.remuxAudio(Z,nt,this.isAudioContiguous,be,ot||pt||Ye===PlaylistLevelType.AUDIO?tt:void 0),pt){const Zr=Qe?Qe.endPTS-Qe.startPTS:0;ee.inputTimeScale||(logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),et=this.generateIS(Z,ee,ye,be)),Xe=this.remuxVideo(ee,tt,mt,Zr)}}else pt&&(Xe=this.remuxVideo(ee,tt,mt,0));Xe&&(Xe.firstKeyFrame=Yr,Xe.independent=Yr!==-1,Xe.firstKeyFramePTS=ri)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(ae.samples.length&&(rt=flushTextTrackMetadataCueSamples(ae,ye,this._initPTS,this._initDTS)),ve.samples.length&&(Je=flushTextTrackUserdataCueSamples(ve,ye,this._initPTS))),{audio:Qe,video:Xe,initSegment:et,independent:it,text:Je,id3:rt}}generateIS(Z,ee,ae,ve){const ye=Z.samples,be=ee.samples,Ke=this.typeSupported,Ye={},Xe=this._initPTS;let Qe=!Xe||ve,et="audio/mp4",Je,rt,it;if(Qe&&(Je=rt=1/0),Z.config&&ye.length){switch(Z.timescale=Z.samplerate,Z.segmentCodec){case"mp3":Ke.mpeg?(et="audio/mpeg",Z.codec=""):Ke.mp3&&(Z.codec="mp3");break}Ye.audio={id:"audio",container:et,codec:Z.codec,initSegment:Z.segmentCodec==="mp3"&&Ke.mpeg?new Uint8Array(0):MP4.initSegment([Z]),metadata:{channelCount:Z.channelCount}},Qe&&(it=Z.inputTimeScale,!Xe||it!==Xe.timescale?Je=rt=ye[0].pts-Math.round(it*ae):Qe=!1)}if(ee.sps&&ee.pps&&be.length&&(ee.timescale=ee.inputTimeScale,Ye.video={id:"main",container:"video/mp4",codec:ee.codec,initSegment:MP4.initSegment([ee]),metadata:{width:ee.width,height:ee.height}},Qe))if(it=ee.inputTimeScale,!Xe||it!==Xe.timescale){const nt=this.getVideoStartPts(be),tt=Math.round(it*ae);rt=Math.min(rt,normalizePts(be[0].dts,nt)-tt),Je=Math.min(Je,nt-tt)}else Qe=!1;if(Object.keys(Ye).length)return this.ISGenerated=!0,Qe?(this._initPTS={baseTime:Je,timescale:it},this._initDTS={baseTime:rt,timescale:it}):Je=it=void 0,{tracks:Ye,initPTS:Je,timescale:it}}remuxVideo(Z,ee,ae,ve){const ye=Z.inputTimeScale,be=Z.samples,Ke=[],Ye=be.length,Xe=this._initPTS;let Qe=this.nextAvcDts,et=8,Je=this.videoSampleDuration,rt,it,nt=Number.POSITIVE_INFINITY,tt=Number.NEGATIVE_INFINITY,st=!1;if(!ae||Qe===null){const ni=ee*ye,ui=be[0].pts-normalizePts(be[0].dts,be[0].pts);Qe=ni-ui}const ot=Xe.baseTime*ye/Xe.timescale;for(let ni=0;ni<Ye;ni++){const ui=be[ni];ui.pts=normalizePts(ui.pts-ot,Qe),ui.dts=normalizePts(ui.dts-ot,Qe),ui.dts<be[ni>0?ni-1:ni].dts&&(st=!0)}st&&be.sort(function(ni,ui){const yi=ni.dts-ui.dts,pi=ni.pts-ui.pts;return yi||pi}),rt=be[0].dts,it=be[be.length-1].dts;const ut=it-rt,ft=ut?Math.round(ut/(Ye-1)):Je||Z.inputTimeScale/30;if(ae){const ni=rt-Qe,ui=ni>ft,yi=ni<-1;if((ui||yi)&&(ui?logger.warn(`AVC: ${toMsFromMpegTsClock(ni,!0)} ms (${ni}dts) hole between fragments detected, filling it`):logger.warn(`AVC: ${toMsFromMpegTsClock(-ni,!0)} ms (${ni}dts) overlapping between fragments detected`),!yi||Qe>=be[0].pts)){rt=Qe;const pi=be[0].pts-ni;be[0].dts=rt,be[0].pts=pi,logger.log(`Video: First PTS/DTS adjusted: ${toMsFromMpegTsClock(pi,!0)}/${toMsFromMpegTsClock(rt,!0)}, delta: ${toMsFromMpegTsClock(ni,!0)} ms`)}}rt=Math.max(0,rt);let pt=0,Xr=0;for(let ni=0;ni<Ye;ni++){const ui=be[ni],yi=ui.units,pi=yi.length;let gi=0;for(let Ri=0;Ri<pi;Ri++)gi+=yi[Ri].data.length;Xr+=gi,pt+=pi,ui.length=gi,ui.dts=Math.max(ui.dts,rt),nt=Math.min(ui.pts,nt),tt=Math.max(ui.pts,tt)}it=be[Ye-1].dts;const mt=Xr+4*pt+8;let Yr;try{Yr=new Uint8Array(mt)}catch(ni){this.observer.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MUX_ERROR,details:ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,error:ni,bytes:mt,reason:`fail allocating video mdat ${mt}`});return}const ri=new DataView(Yr.buffer);ri.setUint32(0,mt),Yr.set(MP4.types.mdat,4);let Zr=!1,_r=Number.POSITIVE_INFINITY,Kr=Number.POSITIVE_INFINITY,si=Number.NEGATIVE_INFINITY,oi=Number.NEGATIVE_INFINITY;for(let ni=0;ni<Ye;ni++){const ui=be[ni],yi=ui.units;let pi=0;for(let Ei=0,xi=yi.length;Ei<xi;Ei++){const Ii=yi[Ei],vi=Ii.data,Si=Ii.data.byteLength;ri.setUint32(et,Si),et+=4,Yr.set(vi,et),et+=Si,pi+=4+Si}let gi;if(ni<Ye-1)Je=be[ni+1].dts-ui.dts,gi=be[ni+1].pts-ui.pts;else{const Ei=this.config,xi=ni>0?ui.dts-be[ni-1].dts:ft;if(gi=ni>0?ui.pts-be[ni-1].pts:ft,Ei.stretchShortVideoTrack&&this.nextAudioPts!==null){const Ii=Math.floor(Ei.maxBufferHole*ye),vi=(ve?nt+ve*ye:this.nextAudioPts)-ui.pts;vi>Ii?(Je=vi-xi,Je<0?Je=xi:Zr=!0,logger.log(`[mp4-remuxer]: It is approximately ${vi/90} ms to the next segment; using duration ${Je/90} ms for the last video frame.`)):Je=xi}else Je=xi}const Ri=Math.round(ui.pts-ui.dts);_r=Math.min(_r,Je),si=Math.max(si,Je),Kr=Math.min(Kr,gi),oi=Math.max(oi,gi),Ke.push(new Mp4Sample(ui.key,Je,pi,Ri))}if(Ke.length){if(chromeVersion){if(chromeVersion<70){const ni=Ke[0].flags;ni.dependsOn=2,ni.isNonSync=0}}else if(safariWebkitVersion&&oi-Kr<si-_r&&ft/si<.025&&Ke[0].cts===0){logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let ni=rt;for(let ui=0,yi=Ke.length;ui<yi;ui++){const pi=ni+Ke[ui].duration,gi=ni+Ke[ui].cts;if(ui<yi-1){const Ri=pi+Ke[ui+1].cts;Ke[ui].duration=Ri-gi}else Ke[ui].duration=ui?Ke[ui-1].duration:ft;Ke[ui].cts=0,ni=pi}}}Je=Zr||!Je?ft:Je,this.nextAvcDts=Qe=it+Je,this.videoSampleDuration=Je,this.isVideoContiguous=!0;const Qr=MP4.moof(Z.sequenceNumber++,rt,_extends({},Z,{samples:Ke})),ii="video",ti={data1:Qr,data2:Yr,startPTS:nt/ye,endPTS:(tt+Je)/ye,startDTS:rt/ye,endDTS:Qe/ye,type:ii,hasAudio:!1,hasVideo:!0,nb:Ke.length,dropped:Z.dropped};return Z.samples=[],Z.dropped=0,ti}remuxAudio(Z,ee,ae,ve,ye){const be=Z.inputTimeScale,Ke=Z.samplerate?Z.samplerate:be,Ye=be/Ke,Xe=Z.segmentCodec==="aac"?AAC_SAMPLES_PER_FRAME:MPEG_AUDIO_SAMPLE_PER_FRAME,Qe=Xe*Ye,et=this._initPTS,Je=Z.segmentCodec==="mp3"&&this.typeSupported.mpeg,rt=[],it=ye!==void 0;let nt=Z.samples,tt=Je?0:8,st=this.nextAudioPts||-1;const ot=ee*be,ut=et.baseTime*be/et.timescale;if(this.isAudioContiguous=ae=ae||nt.length&&st>0&&(ve&&Math.abs(ot-st)<9e3||Math.abs(normalizePts(nt[0].pts-ut,ot)-st)<20*Qe),nt.forEach(function(ii){ii.pts=normalizePts(ii.pts-ut,ot)}),!ae||st<0){if(nt=nt.filter(ii=>ii.pts>=0),!nt.length)return;ye===0?st=0:ve&&!it?st=Math.max(0,ot):st=nt[0].pts}if(Z.segmentCodec==="aac"){const ii=this.config.maxAudioFramesDrift;for(let ti=0,ni=st;ti<nt.length;ti++){const ui=nt[ti],yi=ui.pts,pi=yi-ni,gi=Math.abs(1e3*pi/be);if(pi<=-ii*Qe&&it)ti===0&&(logger.warn(`Audio frame @ ${(yi/be).toFixed(3)}s overlaps nextAudioPts by ${Math.round(1e3*pi/be)} ms.`),this.nextAudioPts=st=ni=yi);else if(pi>=ii*Qe&&gi<MAX_SILENT_FRAME_DURATION&&it){let Ri=Math.round(pi/Qe);ni=yi-Ri*Qe,ni<0&&(Ri--,ni+=Qe),ti===0&&(this.nextAudioPts=st=ni),logger.warn(`[mp4-remuxer]: Injecting ${Ri} audio frame @ ${(ni/be).toFixed(3)}s due to ${Math.round(1e3*pi/be)} ms gap.`);for(let Ei=0;Ei<Ri;Ei++){const xi=Math.max(ni,0);let Ii=AAC.getSilentFrame(Z.manifestCodec||Z.codec,Z.channelCount);Ii||(logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),Ii=ui.unit.subarray()),nt.splice(ti,0,{unit:Ii,pts:xi}),ni+=Qe,ti++}}ui.pts=ni,ni+=Qe}}let ft=null,pt=null,Xr,mt=0,Yr=nt.length;for(;Yr--;)mt+=nt[Yr].unit.byteLength;for(let ii=0,ti=nt.length;ii<ti;ii++){const ni=nt[ii],ui=ni.unit;let yi=ni.pts;if(pt!==null){const gi=rt[ii-1];gi.duration=Math.round((yi-pt)/Ye)}else if(ae&&Z.segmentCodec==="aac"&&(yi=st),ft=yi,mt>0){mt+=tt;try{Xr=new Uint8Array(mt)}catch(gi){this.observer.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MUX_ERROR,details:ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,error:gi,bytes:mt,reason:`fail allocating audio mdat ${mt}`});return}Je||(new DataView(Xr.buffer).setUint32(0,mt),Xr.set(MP4.types.mdat,4))}else return;Xr.set(ui,tt);const pi=ui.byteLength;tt+=pi,rt.push(new Mp4Sample(!0,Xe,pi,0)),pt=yi}const ri=rt.length;if(!ri)return;const Zr=rt[rt.length-1];this.nextAudioPts=st=pt+Ye*Zr.duration;const _r=Je?new Uint8Array(0):MP4.moof(Z.sequenceNumber++,ft/Ye,_extends({},Z,{samples:rt}));Z.samples=[];const Kr=ft/be,si=st/be,Qr={data1:_r,data2:Xr,startPTS:Kr,endPTS:si,startDTS:Kr,endDTS:si,type:"audio",hasAudio:!0,hasVideo:!1,nb:ri};return this.isAudioContiguous=!0,Qr}remuxEmptyAudio(Z,ee,ae,ve){const ye=Z.inputTimeScale,be=Z.samplerate?Z.samplerate:ye,Ke=ye/be,Ye=this.nextAudioPts,Xe=this._initDTS,Qe=Xe.baseTime*9e4/Xe.timescale,et=(Ye!==null?Ye:ve.startDTS*ye)+Qe,Je=ve.endDTS*ye+Qe,rt=Ke*AAC_SAMPLES_PER_FRAME,it=Math.ceil((Je-et)/rt),nt=AAC.getSilentFrame(Z.manifestCodec||Z.codec,Z.channelCount);if(logger.warn("[mp4-remuxer]: remux empty Audio"),!nt){logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}const tt=[];for(let st=0;st<it;st++){const ot=et+st*rt;tt.push({unit:nt,pts:ot,dts:ot})}return Z.samples=tt,this.remuxAudio(Z,ee,ae,!1)}}function normalizePts(ie,Z){let ee;if(Z===null)return ie;for(Z<ie?ee=-8589934592:ee=8589934592;Math.abs(ie-Z)>4294967296;)ie+=ee;return ie}function findKeyframeIndex(ie){for(let Z=0;Z<ie.length;Z++)if(ie[Z].key)return Z;return-1}function flushTextTrackMetadataCueSamples(ie,Z,ee,ae){const ve=ie.samples.length;if(!ve)return;const ye=ie.inputTimeScale;for(let Ke=0;Ke<ve;Ke++){const Ye=ie.samples[Ke];Ye.pts=normalizePts(Ye.pts-ee.baseTime*ye/ee.timescale,Z*ye)/ye,Ye.dts=normalizePts(Ye.dts-ae.baseTime*ye/ae.timescale,Z*ye)/ye}const be=ie.samples;return ie.samples=[],{samples:be}}function flushTextTrackUserdataCueSamples(ie,Z,ee){const ae=ie.samples.length;if(!ae)return;const ve=ie.inputTimeScale;for(let be=0;be<ae;be++){const Ke=ie.samples[be];Ke.pts=normalizePts(Ke.pts-ee.baseTime*ve/ee.timescale,Z*ve)/ve}ie.samples.sort((be,Ke)=>be.pts-Ke.pts);const ye=ie.samples;return ie.samples=[],{samples:ye}}class Mp4Sample{constructor(Z,ee,ae,ve){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=ee,this.size=ae,this.cts=ve,this.flags=new Mp4SampleFlags(Z)}}class Mp4SampleFlags{constructor(Z){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=Z?2:1,this.isNonSync=Z?0:1}}class PassThroughRemuxer{constructor(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}destroy(){}resetTimeStamp(Z){this.initPTS=Z,this.lastEndTime=null}resetNextTimestamp(){this.lastEndTime=null}resetInitSegment(Z,ee,ae,ve){this.audioCodec=ee,this.videoCodec=ae,this.generateInitSegment(patchEncyptionData(Z,ve)),this.emitInitSegment=!0}generateInitSegment(Z){let{audioCodec:ee,videoCodec:ae}=this;if(!(Z!=null&&Z.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const ve=this.initData=parseInitSegment(Z);ee||(ee=getParsedTrackCodec(ve.audio,ElementaryStreamTypes.AUDIO)),ae||(ae=getParsedTrackCodec(ve.video,ElementaryStreamTypes.VIDEO));const ye={};ve.audio&&ve.video?ye.audiovideo={container:"video/mp4",codec:ee+","+ae,initSegment:Z,id:"main"}:ve.audio?ye.audio={container:"audio/mp4",codec:ee,initSegment:Z,id:"audio"}:ve.video?ye.video={container:"video/mp4",codec:ae,initSegment:Z,id:"main"}:logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=ye}remux(Z,ee,ae,ve,ye,be){var Ke,Ye;let{initPTS:Xe,lastEndTime:Qe}=this;const et={audio:void 0,video:void 0,text:ve,id3:ae,initSegment:void 0};isFiniteNumber(Qe)||(Qe=this.lastEndTime=ye||0);const Je=ee.samples;if(!(Je!=null&&Je.length))return et;const rt={initPTS:void 0,timescale:1};let it=this.initData;if((Ke=it)!=null&&Ke.length||(this.generateInitSegment(Je),it=this.initData),!((Ye=it)!=null&&Ye.length))return logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),et;this.emitInitSegment&&(rt.tracks=this.initTracks,this.emitInitSegment=!1);const nt=getDuration(Je,it),tt=getStartDTS(it,Je),st=tt===null?ye:tt;(isInvalidInitPts(Xe,st,ye,nt)||rt.timescale!==Xe.timescale&&be)&&(rt.initPTS=st-ye,Xe&&Xe.timescale===1&&logger.warn(`Adjusting initPTS by ${rt.initPTS-Xe.baseTime}`),this.initPTS=Xe={baseTime:rt.initPTS,timescale:1});const ot=Z?st-Xe.baseTime/Xe.timescale:Qe,ut=ot+nt;offsetStartDTS(it,Je,Xe.baseTime/Xe.timescale),nt>0?this.lastEndTime=ut:(logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const ft=!!it.audio,pt=!!it.video;let Xr="";ft&&(Xr+="audio"),pt&&(Xr+="video");const mt={data1:Je,startPTS:ot,startDTS:ot,endPTS:ut,endDTS:ut,type:Xr,hasAudio:ft,hasVideo:pt,nb:1,dropped:0};return et.audio=mt.type==="audio"?mt:void 0,et.video=mt.type!=="audio"?mt:void 0,et.initSegment=rt,et.id3=flushTextTrackMetadataCueSamples(ae,ye,Xe,Xe),ve.samples.length&&(et.text=flushTextTrackUserdataCueSamples(ve,ye,Xe)),et}}function isInvalidInitPts(ie,Z,ee,ae){if(ie===null)return!0;const ve=Math.max(ae,1),ye=Z-ie.baseTime/ie.timescale;return Math.abs(ye-ee)>ve}function getParsedTrackCodec(ie,Z){const ee=ie==null?void 0:ie.codec;return ee&&ee.length>4?ee:ee==="hvc1"||ee==="hev1"?"hvc1.1.6.L120.90":ee==="av01"?"av01.0.04M.08":ee==="avc1"||Z===ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}let now;try{now=self.performance.now.bind(self.performance)}catch{logger.debug("Unable to use Performance API on this environment"),now=typeof self<"u"&&self.Date.now}const muxConfig=[{demux:MP4Demuxer,remux:PassThroughRemuxer},{demux:TSDemuxer,remux:MP4Remuxer},{demux:AACDemuxer,remux:MP4Remuxer},{demux:MP3Demuxer,remux:MP4Remuxer}];class Transmuxer{constructor(Z,ee,ae,ve,ye){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=Z,this.typeSupported=ee,this.config=ae,this.vendor=ve,this.id=ye}configure(Z){this.transmuxConfig=Z,this.decrypter&&this.decrypter.reset()}push(Z,ee,ae,ve){const ye=ae.transmuxing;ye.executeStart=now();let be=new Uint8Array(Z);const{currentTransmuxState:Ke,transmuxConfig:Ye}=this;ve&&(this.currentTransmuxState=ve);const{contiguous:Xe,discontinuity:Qe,trackSwitch:et,accurateTimeOffset:Je,timeOffset:rt,initSegmentChange:it}=ve||Ke,{audioCodec:nt,videoCodec:tt,defaultInitPts:st,duration:ot,initSegmentData:ut}=Ye,ft=getEncryptionType(be,ee);if(ft&&ft.method==="AES-128"){const Yr=this.getDecrypter();if(Yr.isSync()){let ri=Yr.softwareDecrypt(be,ft.key.buffer,ft.iv.buffer);if(ae.part>-1&&(ri=Yr.flush()),!ri)return ye.executeEnd=now(),emptyResult(ae);be=new Uint8Array(ri)}else return this.decryptionPromise=Yr.webCryptoDecrypt(be,ft.key.buffer,ft.iv.buffer).then(ri=>{const Zr=this.push(ri,null,ae);return this.decryptionPromise=null,Zr}),this.decryptionPromise}const pt=this.needsProbing(Qe,et);if(pt){const Yr=this.configureTransmuxer(be);if(Yr)return logger.warn(`[transmuxer] ${Yr.message}`),this.observer.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,error:Yr,reason:Yr.message}),ye.executeEnd=now(),emptyResult(ae)}(Qe||et||it||pt)&&this.resetInitSegment(ut,nt,tt,ot,ee),(Qe||it||pt)&&this.resetInitialTimestamp(st),Xe||this.resetContiguity();const Xr=this.transmux(be,ft,rt,Je,ae),mt=this.currentTransmuxState;return mt.contiguous=!0,mt.discontinuity=!1,mt.trackSwitch=!1,ye.executeEnd=now(),Xr}flush(Z){const ee=Z.transmuxing;ee.executeStart=now();const{decrypter:ae,currentTransmuxState:ve,decryptionPromise:ye}=this;if(ye)return ye.then(()=>this.flush(Z));const be=[],{timeOffset:Ke}=ve;if(ae){const et=ae.flush();et&&be.push(this.push(et,null,Z))}const{demuxer:Ye,remuxer:Xe}=this;if(!Ye||!Xe)return ee.executeEnd=now(),[emptyResult(Z)];const Qe=Ye.flush(Ke);return isPromise(Qe)?Qe.then(et=>(this.flushRemux(be,et,Z),be)):(this.flushRemux(be,Qe,Z),be)}flushRemux(Z,ee,ae){const{audioTrack:ve,videoTrack:ye,id3Track:be,textTrack:Ke}=ee,{accurateTimeOffset:Ye,timeOffset:Xe}=this.currentTransmuxState;logger.log(`[transmuxer.ts]: Flushed fragment ${ae.sn}${ae.part>-1?" p: "+ae.part:""} of level ${ae.level}`);const Qe=this.remuxer.remux(ve,ye,be,Ke,Xe,Ye,!0,this.id);Z.push({remuxResult:Qe,chunkMeta:ae}),ae.transmuxing.executeEnd=now()}resetInitialTimestamp(Z){const{demuxer:ee,remuxer:ae}=this;!ee||!ae||(ee.resetTimeStamp(Z),ae.resetTimeStamp(Z))}resetContiguity(){const{demuxer:Z,remuxer:ee}=this;!Z||!ee||(Z.resetContiguity(),ee.resetNextTimestamp())}resetInitSegment(Z,ee,ae,ve,ye){const{demuxer:be,remuxer:Ke}=this;!be||!Ke||(be.resetInitSegment(Z,ee,ae,ve),Ke.resetInitSegment(Z,ee,ae,ye))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(Z,ee,ae,ve,ye){let be;return ee&&ee.method==="SAMPLE-AES"?be=this.transmuxSampleAes(Z,ee,ae,ve,ye):be=this.transmuxUnencrypted(Z,ae,ve,ye),be}transmuxUnencrypted(Z,ee,ae,ve){const{audioTrack:ye,videoTrack:be,id3Track:Ke,textTrack:Ye}=this.demuxer.demux(Z,ee,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(ye,be,Ke,Ye,ee,ae,!1,this.id),chunkMeta:ve}}transmuxSampleAes(Z,ee,ae,ve,ye){return this.demuxer.demuxSampleAes(Z,ee,ae).then(be=>({remuxResult:this.remuxer.remux(be.audioTrack,be.videoTrack,be.id3Track,be.textTrack,ae,ve,!1,this.id),chunkMeta:ye}))}configureTransmuxer(Z){const{config:ee,observer:ae,typeSupported:ve,vendor:ye}=this;let be;for(let et=0,Je=muxConfig.length;et<Je;et++)if(muxConfig[et].demux.probe(Z)){be=muxConfig[et];break}if(!be)return new Error("Failed to find demuxer by probing fragment data");const Ke=this.demuxer,Ye=this.remuxer,Xe=be.remux,Qe=be.demux;(!Ye||!(Ye instanceof Xe))&&(this.remuxer=new Xe(ae,ee,ve,ye)),(!Ke||!(Ke instanceof Qe))&&(this.demuxer=new Qe(ae,ee,ve),this.probe=Qe.probe)}needsProbing(Z,ee){return!this.demuxer||!this.remuxer||Z||ee}getDecrypter(){let Z=this.decrypter;return Z||(Z=this.decrypter=new Decrypter(this.config)),Z}}function getEncryptionType(ie,Z){let ee=null;return ie.byteLength>0&&Z!=null&&Z.key!=null&&Z.iv!==null&&Z.method!=null&&(ee=Z),ee}const emptyResult=ie=>({remuxResult:{},chunkMeta:ie});function isPromise(ie){return"then"in ie&&ie.then instanceof Function}class TransmuxConfig{constructor(Z,ee,ae,ve,ye){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=Z,this.videoCodec=ee,this.initSegmentData=ae,this.duration=ve,this.defaultInitPts=ye||null}}class TransmuxState{constructor(Z,ee,ae,ve,ye,be){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=Z,this.contiguous=ee,this.accurateTimeOffset=ae,this.trackSwitch=ve,this.timeOffset=ye,this.initSegmentChange=be}}var eventemitter3={exports:{}};(function(ie){var Z=Object.prototype.hasOwnProperty,ee="~";function ae(){}Object.create&&(ae.prototype=Object.create(null),new ae().__proto__||(ee=!1));function ve(Ye,Xe,Qe){this.fn=Ye,this.context=Xe,this.once=Qe||!1}function ye(Ye,Xe,Qe,et,Je){if(typeof Qe!="function")throw new TypeError("The listener must be a function");var rt=new ve(Qe,et||Ye,Je),it=ee?ee+Xe:Xe;return Ye._events[it]?Ye._events[it].fn?Ye._events[it]=[Ye._events[it],rt]:Ye._events[it].push(rt):(Ye._events[it]=rt,Ye._eventsCount++),Ye}function be(Ye,Xe){--Ye._eventsCount===0?Ye._events=new ae:delete Ye._events[Xe]}function Ke(){this._events=new ae,this._eventsCount=0}Ke.prototype.eventNames=function(){var Xe=[],Qe,et;if(this._eventsCount===0)return Xe;for(et in Qe=this._events)Z.call(Qe,et)&&Xe.push(ee?et.slice(1):et);return Object.getOwnPropertySymbols?Xe.concat(Object.getOwnPropertySymbols(Qe)):Xe},Ke.prototype.listeners=function(Xe){var Qe=ee?ee+Xe:Xe,et=this._events[Qe];if(!et)return[];if(et.fn)return[et.fn];for(var Je=0,rt=et.length,it=new Array(rt);Je<rt;Je++)it[Je]=et[Je].fn;return it},Ke.prototype.listenerCount=function(Xe){var Qe=ee?ee+Xe:Xe,et=this._events[Qe];return et?et.fn?1:et.length:0},Ke.prototype.emit=function(Xe,Qe,et,Je,rt,it){var nt=ee?ee+Xe:Xe;if(!this._events[nt])return!1;var tt=this._events[nt],st=arguments.length,ot,ut;if(tt.fn){switch(tt.once&&this.removeListener(Xe,tt.fn,void 0,!0),st){case 1:return tt.fn.call(tt.context),!0;case 2:return tt.fn.call(tt.context,Qe),!0;case 3:return tt.fn.call(tt.context,Qe,et),!0;case 4:return tt.fn.call(tt.context,Qe,et,Je),!0;case 5:return tt.fn.call(tt.context,Qe,et,Je,rt),!0;case 6:return tt.fn.call(tt.context,Qe,et,Je,rt,it),!0}for(ut=1,ot=new Array(st-1);ut<st;ut++)ot[ut-1]=arguments[ut];tt.fn.apply(tt.context,ot)}else{var ft=tt.length,pt;for(ut=0;ut<ft;ut++)switch(tt[ut].once&&this.removeListener(Xe,tt[ut].fn,void 0,!0),st){case 1:tt[ut].fn.call(tt[ut].context);break;case 2:tt[ut].fn.call(tt[ut].context,Qe);break;case 3:tt[ut].fn.call(tt[ut].context,Qe,et);break;case 4:tt[ut].fn.call(tt[ut].context,Qe,et,Je);break;default:if(!ot)for(pt=1,ot=new Array(st-1);pt<st;pt++)ot[pt-1]=arguments[pt];tt[ut].fn.apply(tt[ut].context,ot)}}return!0},Ke.prototype.on=function(Xe,Qe,et){return ye(this,Xe,Qe,et,!1)},Ke.prototype.once=function(Xe,Qe,et){return ye(this,Xe,Qe,et,!0)},Ke.prototype.removeListener=function(Xe,Qe,et,Je){var rt=ee?ee+Xe:Xe;if(!this._events[rt])return this;if(!Qe)return be(this,rt),this;var it=this._events[rt];if(it.fn)it.fn===Qe&&(!Je||it.once)&&(!et||it.context===et)&&be(this,rt);else{for(var nt=0,tt=[],st=it.length;nt<st;nt++)(it[nt].fn!==Qe||Je&&!it[nt].once||et&&it[nt].context!==et)&&tt.push(it[nt]);tt.length?this._events[rt]=tt.length===1?tt[0]:tt:be(this,rt)}return this},Ke.prototype.removeAllListeners=function(Xe){var Qe;return Xe?(Qe=ee?ee+Xe:Xe,this._events[Qe]&&be(this,Qe)):(this._events=new ae,this._eventsCount=0),this},Ke.prototype.off=Ke.prototype.removeListener,Ke.prototype.addListener=Ke.prototype.on,Ke.prefixed=ee,Ke.EventEmitter=Ke,ie.exports=Ke})(eventemitter3);var eventemitter3Exports=eventemitter3.exports,EventEmitter=getDefaultExportFromCjs(eventemitter3Exports);const MediaSource$1=getMediaSource()||{isTypeSupported:()=>!1};class TransmuxerInterface{constructor(Z,ee,ae,ve){this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;const ye=Z.config;this.hls=Z,this.id=ee,this.useWorker=!!ye.enableWorker,this.onTransmuxComplete=ae,this.onFlush=ve;const be=(Xe,Qe)=>{Qe=Qe||{},Qe.frag=this.frag,Qe.id=this.id,Xe===Events.ERROR&&(this.error=Qe.error),this.hls.trigger(Xe,Qe)};this.observer=new EventEmitter,this.observer.on(Events.FRAG_DECRYPTED,be),this.observer.on(Events.ERROR,be);const Ke={mp4:MediaSource$1.isTypeSupported("video/mp4"),mpeg:MediaSource$1.isTypeSupported("audio/mpeg"),mp3:MediaSource$1.isTypeSupported('audio/mp4; codecs="mp3"')},Ye=navigator.vendor;if(this.useWorker&&typeof Worker<"u"&&(ye.workerPath||hasUMDWorker())){try{ye.workerPath?(logger.log(`loading Web Worker ${ye.workerPath} for "${ee}"`),this.workerContext=loadWorker(ye.workerPath)):(logger.log(`injecting Web Worker for "${ee}"`),this.workerContext=injectWorker()),this.onwmsg=et=>this.onWorkerMessage(et);const{worker:Qe}=this.workerContext;Qe.addEventListener("message",this.onwmsg),Qe.onerror=et=>{const Je=new Error(`${et.message}  (${et.filename}:${et.lineno})`);ye.enableWorker=!1,logger.warn(`Error in "${ee}" Web Worker, fallback to inline`),this.hls.trigger(Events.ERROR,{type:ErrorTypes.OTHER_ERROR,details:ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:Je})},Qe.postMessage({cmd:"init",typeSupported:Ke,vendor:Ye,id:ee,config:JSON.stringify(ye)})}catch(Qe){logger.warn(`Error setting up "${ee}" Web Worker, fallback to inline`,Qe),this.resetWorker(),this.error=null,this.transmuxer=new Transmuxer(this.observer,Ke,ye,Ye,ee)}return}this.transmuxer=new Transmuxer(this.observer,Ke,ye,Ye,ee)}resetWorker(){if(this.workerContext){const{worker:Z,objectURL:ee}=this.workerContext;ee&&self.URL.revokeObjectURL(ee),Z.removeEventListener("message",this.onwmsg),Z.onerror=null,Z.terminate(),this.workerContext=null}}destroy(){if(this.workerContext)this.resetWorker(),this.onwmsg=void 0;else{const ee=this.transmuxer;ee&&(ee.destroy(),this.transmuxer=null)}const Z=this.observer;Z&&Z.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null}push(Z,ee,ae,ve,ye,be,Ke,Ye,Xe,Qe){var et,Je;Xe.transmuxing.start=self.performance.now();const{transmuxer:rt}=this,it=be?be.start:ye.start,nt=ye.decryptdata,tt=this.frag,st=!(tt&&ye.cc===tt.cc),ot=!(tt&&Xe.level===tt.level),ut=tt?Xe.sn-tt.sn:-1,ft=this.part?Xe.part-this.part.index:-1,pt=ut===0&&Xe.id>1&&Xe.id===(tt==null?void 0:tt.stats.chunkCount),Xr=!ot&&(ut===1||ut===0&&(ft===1||pt&&ft<=0)),mt=self.performance.now();(ot||ut||ye.stats.parsing.start===0)&&(ye.stats.parsing.start=mt),be&&(ft||!Xr)&&(be.stats.parsing.start=mt);const Yr=!(tt&&((et=ye.initSegment)==null?void 0:et.url)===((Je=tt.initSegment)==null?void 0:Je.url)),ri=new TransmuxState(st,Xr,Ye,ot,it,Yr);if(!Xr||st||Yr){logger.log(`[transmuxer-interface, ${ye.type}]: Starting new transmux session for sn: ${Xe.sn} p: ${Xe.part} level: ${Xe.level} id: ${Xe.id}
        discontinuity: ${st}
        trackSwitch: ${ot}
        contiguous: ${Xr}
        accurateTimeOffset: ${Ye}
        timeOffset: ${it}
        initSegmentChange: ${Yr}`);const Zr=new TransmuxConfig(ae,ve,ee,Ke,Qe);this.configureTransmuxer(Zr)}if(this.frag=ye,this.part=be,this.workerContext)this.workerContext.worker.postMessage({cmd:"demux",data:Z,decryptdata:nt,chunkMeta:Xe,state:ri},Z instanceof ArrayBuffer?[Z]:[]);else if(rt){const Zr=rt.push(Z,nt,Xe,ri);isPromise(Zr)?(rt.async=!0,Zr.then(_r=>{this.handleTransmuxComplete(_r)}).catch(_r=>{this.transmuxerError(_r,Xe,"transmuxer-interface push error")})):(rt.async=!1,this.handleTransmuxComplete(Zr))}}flush(Z){Z.transmuxing.start=self.performance.now();const{transmuxer:ee}=this;if(this.workerContext)this.workerContext.worker.postMessage({cmd:"flush",chunkMeta:Z});else if(ee){let ae=ee.flush(Z);isPromise(ae)||ee.async?(isPromise(ae)||(ae=Promise.resolve(ae)),ae.then(ye=>{this.handleFlushResult(ye,Z)}).catch(ye=>{this.transmuxerError(ye,Z,"transmuxer-interface flush error")})):this.handleFlushResult(ae,Z)}}transmuxerError(Z,ee,ae){this.hls&&(this.error=Z,this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:ee,fatal:!1,error:Z,err:Z,reason:ae}))}handleFlushResult(Z,ee){Z.forEach(ae=>{this.handleTransmuxComplete(ae)}),this.onFlush(ee)}onWorkerMessage(Z){const ee=Z.data,ae=this.hls;switch(ee.event){case"init":{var ve;const ye=(ve=this.workerContext)==null?void 0:ve.objectURL;ye&&self.URL.revokeObjectURL(ye);break}case"transmuxComplete":{this.handleTransmuxComplete(ee.data);break}case"flush":{this.onFlush(ee.data);break}case"workerLog":logger[ee.data.logType]&&logger[ee.data.logType](ee.data.message);break;default:{ee.data=ee.data||{},ee.data.frag=this.frag,ee.data.id=this.id,ae.trigger(ee.event,ee.data);break}}}configureTransmuxer(Z){const{transmuxer:ee}=this;this.workerContext?this.workerContext.worker.postMessage({cmd:"configure",config:Z}):ee&&ee.configure(Z)}handleTransmuxComplete(Z){Z.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(Z)}}const STALL_MINIMUM_DURATION_MS=250,MAX_START_GAP_JUMP=2,SKIP_BUFFER_HOLE_STEP_SECONDS=.1,SKIP_BUFFER_RANGE_START=.05;class GapController{constructor(Z,ee,ae,ve){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=Z,this.media=ee,this.fragmentTracker=ae,this.hls=ve}destroy(){this.media=null,this.hls=this.fragmentTracker=null}poll(Z,ee){const{config:ae,media:ve,stalled:ye}=this;if(ve===null)return;const{currentTime:be,seeking:Ke}=ve,Ye=this.seeking&&!Ke,Xe=!this.seeking&&Ke;if(this.seeking=Ke,be!==Z){if(this.moved=!0,ye!==null){if(this.stallReported){const st=self.performance.now()-ye;logger.warn(`playback not stuck anymore @${be}, after ${Math.round(st)}ms`),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if(Xe||Ye){this.stalled=null;return}if(ve.paused&&!Ke||ve.ended||ve.playbackRate===0||!BufferHelper.getBuffered(ve).length)return;const Qe=BufferHelper.bufferInfo(ve,be,0),et=Qe.len>0,Je=Qe.nextStart||0;if(!et&&!Je)return;if(Ke){const st=Qe.len>MAX_START_GAP_JUMP,ot=!Je||ee&&ee.start<=be||Je-be>MAX_START_GAP_JUMP&&!this.fragmentTracker.getPartialFragment(be);if(st||ot)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var rt;const st=Math.max(Je,Qe.start||0)-be,ot=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,ft=(ot==null||(rt=ot.details)==null?void 0:rt.live)?ot.details.targetduration*2:MAX_START_GAP_JUMP,pt=this.fragmentTracker.getPartialFragment(be);if(st>0&&(st<=ft||pt)){this._trySkipBufferHole(pt);return}}const it=self.performance.now();if(ye===null){this.stalled=it;return}const nt=it-ye;if(!Ke&&nt>=STALL_MINIMUM_DURATION_MS&&(this._reportStall(Qe),!this.media))return;const tt=BufferHelper.bufferInfo(ve,be,ae.maxBufferHole);this._tryFixBufferStall(tt,nt)}_tryFixBufferStall(Z,ee){const{config:ae,fragmentTracker:ve,media:ye}=this;if(ye===null)return;const be=ye.currentTime,Ke=ve.getPartialFragment(be);Ke&&(this._trySkipBufferHole(Ke)||!this.media)||(Z.len>ae.maxBufferHole||Z.nextStart&&Z.nextStart-be<ae.maxBufferHole)&&ee>ae.highBufferWatchdogPeriod*1e3&&(logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}_reportStall(Z){const{hls:ee,media:ae,stallReported:ve}=this;if(!ve&&ae){this.stallReported=!0;const ye=new Error(`Playback stalling at @${ae.currentTime} due to low buffer (${JSON.stringify(Z)})`);logger.warn(ye.message),ee.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,error:ye,buffer:Z.len})}}_trySkipBufferHole(Z){const{config:ee,hls:ae,media:ve}=this;if(ve===null)return 0;const ye=ve.currentTime,be=BufferHelper.bufferInfo(ve,ye,0),Ke=ye<be.start?be.start:be.nextStart;if(Ke){const Ye=be.len<=ee.maxBufferHole,Xe=be.len>0&&be.len<1&&ve.readyState<3,Qe=Ke-ye;if(Qe>0&&(Ye||Xe)){if(Qe>ee.maxBufferHole){const{fragmentTracker:Je}=this;let rt=!1;if(ye===0){const it=Je.getAppendedFrag(0,PlaylistLevelType.MAIN);it&&Ke<it.end&&(rt=!0)}if(!rt){const it=Z||Je.getAppendedFrag(ye,PlaylistLevelType.MAIN);if(it){let nt=!1,tt=it.end;for(;tt<Ke;){const st=Je.getPartialFragment(tt);if(st)tt+=st.duration;else{nt=!0;break}}if(nt)return 0}}}const et=Math.max(Ke+SKIP_BUFFER_RANGE_START,ye+SKIP_BUFFER_HOLE_STEP_SECONDS);if(logger.warn(`skipping hole, adjusting currentTime from ${ye} to ${et}`),this.moved=!0,this.stalled=null,ve.currentTime=et,Z&&!Z.gap){const Je=new Error(`fragment loaded with buffer holes, seeking from ${ye} to ${et}`);ae.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:Je,reason:Je.message,frag:Z})}return et}}return 0}_tryNudgeBuffer(){const{config:Z,hls:ee,media:ae,nudgeRetry:ve}=this;if(ae===null)return;const ye=ae.currentTime;if(this.nudgeRetry++,ve<Z.nudgeMaxRetry){const be=ye+(ve+1)*Z.nudgeOffset,Ke=new Error(`Nudging 'currentTime' from ${ye} to ${be}`);logger.warn(Ke.message),ae.currentTime=be,ee.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_NUDGE_ON_STALL,error:Ke,fatal:!1})}else{const be=new Error(`Playhead still not moving while enough data buffered @${ye} after ${Z.nudgeMaxRetry} nudges`);logger.error(be.message),ee.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_STALLED_ERROR,error:be,fatal:!0})}}}const TICK_INTERVAL$2=100;class StreamController extends BaseStreamController{constructor(Z,ee,ae){super(Z,ee,ae,"[stream-controller]",PlaylistLevelType.MAIN),this.audioCodecSwap=!1,this.gapController=null,this.level=-1,this._forceStartLoad=!1,this.altAudio=!1,this.audioOnly=!1,this.fragPlaying=null,this.onvplaying=null,this.onvseeked=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this._registerListeners()}_registerListeners(){const{hls:Z}=this;Z.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),Z.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),Z.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),Z.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),Z.on(Events.LEVEL_LOADING,this.onLevelLoading,this),Z.on(Events.LEVEL_LOADED,this.onLevelLoaded,this),Z.on(Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),Z.on(Events.ERROR,this.onError,this),Z.on(Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),Z.on(Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),Z.on(Events.BUFFER_CREATED,this.onBufferCreated,this),Z.on(Events.BUFFER_FLUSHED,this.onBufferFlushed,this),Z.on(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),Z.on(Events.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:Z}=this;Z.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),Z.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),Z.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),Z.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),Z.off(Events.LEVEL_LOADED,this.onLevelLoaded,this),Z.off(Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),Z.off(Events.ERROR,this.onError,this),Z.off(Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),Z.off(Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),Z.off(Events.BUFFER_CREATED,this.onBufferCreated,this),Z.off(Events.BUFFER_FLUSHED,this.onBufferFlushed,this),Z.off(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),Z.off(Events.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this._unregisterListeners(),this.onMediaDetaching()}startLoad(Z){if(this.levels){const{lastCurrentTime:ee,hls:ae}=this;if(this.stopLoad(),this.setInterval(TICK_INTERVAL$2),this.level=-1,!this.startFragRequested){let ve=ae.startLevel;ve===-1&&(ae.config.testBandwidth&&this.levels.length>1?(ve=0,this.bitrateTest=!0):ve=ae.nextAutoLevel),this.level=ae.nextLoadLevel=ve,this.loadedmetadata=!1}ee>0&&Z===-1&&(this.log(`Override startPosition with lastCurrentTime @${ee.toFixed(3)}`),Z=ee),this.state=State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=Z,this.tick()}else this._forceStartLoad=!0,this.state=State.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case State.WAITING_LEVEL:{var Z;const{levels:ae,level:ve}=this,ye=ae==null||(Z=ae[ve])==null?void 0:Z.details;if(ye&&(!ye.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(ye))break;this.state=State.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=State.IDLE;break}break}case State.FRAG_LOADING_WAITING_RETRY:{var ee;const ae=self.performance.now(),ve=this.retryDate;(!ve||ae>=ve||(ee=this.media)!=null&&ee.seeking)&&(this.resetStartWhenNotLoaded(this.level),this.state=State.IDLE)}break}this.state===State.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){super.onTickEnd(),this.checkBuffer(),this.checkFragmentChanged()}doTickIdle(){const{hls:Z,levelLastLoaded:ee,levels:ae,media:ve}=this,{config:ye,nextLoadLevel:be}=Z;if(ee===null||!ve&&(this.startFragRequested||!ye.startFragPrefetch)||this.altAudio&&this.audioOnly||!(ae!=null&&ae[be]))return;const Ke=ae[be],Ye=this.getMainFwdBufferInfo();if(Ye===null)return;const Xe=this.getLevelDetails();if(Xe&&this._streamEnded(Ye,Xe)){const tt={};this.altAudio&&(tt.type="video"),this.hls.trigger(Events.BUFFER_EOS,tt),this.state=State.ENDED;return}Z.loadLevel!==be&&Z.manualLevel===-1&&this.log(`Adapting to level ${be} from level ${this.level}`),this.level=Z.nextLoadLevel=be;const Qe=Ke.details;if(!Qe||this.state===State.WAITING_LEVEL||Qe.live&&this.levelLastLoaded!==be){this.level=be,this.state=State.WAITING_LEVEL;return}const et=Ye.len,Je=this.getMaxBufferLength(Ke.maxBitrate);if(et>=Je)return;this.backtrackFragment&&this.backtrackFragment.start>Ye.end&&(this.backtrackFragment=null);const rt=this.backtrackFragment?this.backtrackFragment.start:Ye.end;let it=this.getNextFragment(rt,Qe);if(this.couldBacktrack&&!this.fragPrevious&&it&&it.sn!=="initSegment"&&this.fragmentTracker.getState(it)!==FragmentState.OK){var nt;const st=((nt=this.backtrackFragment)!=null?nt:it).sn-Qe.startSN,ot=Qe.fragments[st-1];ot&&it.cc===ot.cc&&(it=ot,this.fragmentTracker.removeFragment(ot))}else this.backtrackFragment&&Ye.len&&(this.backtrackFragment=null);if(it&&this.isLoopLoading(it,rt)){if(!it.gap){const st=this.audioOnly&&!this.altAudio?ElementaryStreamTypes.AUDIO:ElementaryStreamTypes.VIDEO,ot=(st===ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;ot&&this.afterBufferFlushed(ot,st,PlaylistLevelType.MAIN)}it=this.getNextFragmentLoopLoading(it,Qe,Ye,PlaylistLevelType.MAIN,Je)}it&&(it.initSegment&&!it.initSegment.data&&!this.bitrateTest&&(it=it.initSegment),this.loadFragment(it,Ke,rt))}loadFragment(Z,ee,ae){const ve=this.fragmentTracker.getState(Z);this.fragCurrent=Z,ve===FragmentState.NOT_LOADED||ve===FragmentState.PARTIAL?Z.sn==="initSegment"?this._loadInitSegment(Z,ee):this.bitrateTest?(this.log(`Fragment ${Z.sn} of level ${Z.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(Z,ee)):(this.startFragRequested=!0,super.loadFragment(Z,ee,ae)):this.clearTrackerIfNeeded(Z)}getBufferedFrag(Z){return this.fragmentTracker.getBufferedFrag(Z,PlaylistLevelType.MAIN)}followingBufferedFrag(Z){return Z?this.getBufferedFrag(Z.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:Z,media:ee}=this;if(ee!=null&&ee.readyState){let ae;const ve=this.getAppendedFrag(ee.currentTime);ve&&ve.start>1&&this.flushMainBuffer(0,ve.start-1);const ye=this.getLevelDetails();if(ye!=null&&ye.live){const Ke=this.getMainFwdBufferInfo();if(!Ke||Ke.len<ye.targetduration*2)return}if(!ee.paused&&Z){const Ke=this.hls.nextLoadLevel,Ye=Z[Ke],Xe=this.fragLastKbps;Xe&&this.fragCurrent?ae=this.fragCurrent.duration*Ye.maxBitrate/(1e3*Xe)+1:ae=0}else ae=0;const be=this.getBufferedFrag(ee.currentTime+ae);if(be){const Ke=this.followingBufferedFrag(be);if(Ke){this.abortCurrentFrag();const Ye=Ke.maxStartPTS?Ke.maxStartPTS:Ke.start,Xe=Ke.duration,Qe=Math.max(be.end,Ye+Math.min(Math.max(Xe-this.config.maxFragLookUpTolerance,Xe*.5),Xe*.75));this.flushMainBuffer(Qe,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const Z=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,Z&&(Z.abortRequests(),this.fragmentTracker.removeFragment(Z)),this.state){case State.KEY_LOADING:case State.FRAG_LOADING:case State.FRAG_LOADING_WAITING_RETRY:case State.PARSING:case State.PARSED:this.state=State.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(Z,ee){super.flushMainBuffer(Z,ee,this.altAudio?"video":null)}onMediaAttached(Z,ee){super.onMediaAttached(Z,ee);const ae=ee.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),ae.addEventListener("playing",this.onvplaying),ae.addEventListener("seeked",this.onvseeked),this.gapController=new GapController(this.config,ae,this.fragmentTracker,this.hls)}onMediaDetaching(){const{media:Z}=this;Z&&this.onvplaying&&this.onvseeked&&(Z.removeEventListener("playing",this.onvplaying),Z.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),super.onMediaDetaching()}onMediaPlaying(){this.tick()}onMediaSeeked(){const Z=this.media,ee=Z?Z.currentTime:null;isFiniteNumber(ee)&&this.log(`Media seeked to ${ee.toFixed(3)}`);const ae=this.getMainFwdBufferInfo();if(ae===null||ae.len===0){this.warn(`Main forward buffer length on "seeked" event ${ae?ae.len:"empty"})`);return}this.tick()}onManifestLoading(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.levels=this.fragPlaying=this.backtrackFragment=null,this.altAudio=this.audioOnly=!1}onManifestParsed(Z,ee){let ae=!1,ve=!1,ye;ee.levels.forEach(be=>{ye=be.audioCodec,ye&&(ye.indexOf("mp4a.40.2")!==-1&&(ae=!0),ye.indexOf("mp4a.40.5")!==-1&&(ve=!0))}),this.audioCodecSwitch=ae&&ve&&!changeTypeSupported(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=ee.levels,this.startFragRequested=!1}onLevelLoading(Z,ee){const{levels:ae}=this;if(!ae||this.state!==State.IDLE)return;const ve=ae[ee.level];(!ve.details||ve.details.live&&this.levelLastLoaded!==ee.level||this.waitForCdnTuneIn(ve.details))&&(this.state=State.WAITING_LEVEL)}onLevelLoaded(Z,ee){var ae;const{levels:ve}=this,ye=ee.level,be=ee.details,Ke=be.totalduration;if(!ve){this.warn(`Levels were reset while loading level ${ye}`);return}this.log(`Level ${ye} loaded [${be.startSN},${be.endSN}]${be.lastPartSn?`[part-${be.lastPartSn}-${be.lastPartIndex}]`:""}, cc [${be.startCC}, ${be.endCC}] duration:${Ke}`);const Ye=ve[ye],Xe=this.fragCurrent;Xe&&(this.state===State.FRAG_LOADING||this.state===State.FRAG_LOADING_WAITING_RETRY)&&(Xe.level!==ee.level||Xe.urlId!==Ye.urlId)&&Xe.loader&&this.abortCurrentFrag();let Qe=0;if(be.live||(ae=Ye.details)!=null&&ae.live){if(this.checkLiveUpdate(be),be.deltaUpdateFailed)return;Qe=this.alignPlaylists(be,Ye.details)}if(Ye.details=be,this.levelLastLoaded=ye,this.hls.trigger(Events.LEVEL_UPDATED,{details:be,level:ye}),this.state===State.WAITING_LEVEL){if(this.waitForCdnTuneIn(be))return;this.state=State.IDLE}this.startFragRequested?be.live&&this.synchronizeToLiveEdge(be):this.setStartPosition(be,Qe),this.tick()}_handleFragmentLoadProgress(Z){var ee;const{frag:ae,part:ve,payload:ye}=Z,{levels:be}=this;if(!be){this.warn(`Levels were reset while fragment load was in progress. Fragment ${ae.sn} of level ${ae.level} will not be buffered`);return}const Ke=be[ae.level],Ye=Ke.details;if(!Ye){this.warn(`Dropping fragment ${ae.sn} of level ${ae.level} after level details were reset`),this.fragmentTracker.removeFragment(ae);return}const Xe=Ke.videoCodec,Qe=Ye.PTSKnown||!Ye.live,et=(ee=ae.initSegment)==null?void 0:ee.data,Je=this._getAudioCodec(Ke),rt=this.transmuxer=this.transmuxer||new TransmuxerInterface(this.hls,PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),it=ve?ve.index:-1,nt=it!==-1,tt=new ChunkMetadata(ae.level,ae.sn,ae.stats.chunkCount,ye.byteLength,it,nt),st=this.initPTS[ae.cc];rt.push(ye,et,Je,Xe,ae,ve,Ye.totalduration,Qe,tt,st)}onAudioTrackSwitching(Z,ee){const ae=this.altAudio;if(!!!ee.url){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const be=this.fragCurrent;be&&(this.log("Switching to main audio track, cancel main fragment load"),be.abortRequests(),this.fragmentTracker.removeFragment(be)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();const ye=this.hls;ae&&(ye.trigger(Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null}),this.fragmentTracker.removeAllFragments()),ye.trigger(Events.AUDIO_TRACK_SWITCHED,ee)}}onAudioTrackSwitched(Z,ee){const ae=ee.id,ve=!!this.hls.audioTracks[ae].url;if(ve){const ye=this.videoBuffer;ye&&this.mediaBuffer!==ye&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=ye)}this.altAudio=ve,this.tick()}onBufferCreated(Z,ee){const ae=ee.tracks;let ve,ye,be=!1;for(const Ke in ae){const Ye=ae[Ke];if(Ye.id==="main"){if(ye=Ke,ve=Ye,Ke==="video"){const Xe=ae[Ke];Xe&&(this.videoBuffer=Xe.buffer)}}else be=!0}be&&ve?(this.log(`Alternate track found, use ${ye}.buffered to schedule main fragment loading`),this.mediaBuffer=ve.buffer):this.mediaBuffer=this.media}onFragBuffered(Z,ee){const{frag:ae,part:ve}=ee;if(ae&&ae.type!==PlaylistLevelType.MAIN)return;if(this.fragContextChanged(ae)){this.warn(`Fragment ${ae.sn}${ve?" p: "+ve.index:""} of level ${ae.level} finished buffering, but was aborted. state: ${this.state}`),this.state===State.PARSED&&(this.state=State.IDLE);return}const ye=ve?ve.stats:ae.stats;this.fragLastKbps=Math.round(8*ye.total/(ye.buffering.end-ye.loading.first)),ae.sn!=="initSegment"&&(this.fragPrevious=ae),this.fragBufferedComplete(ae,ve)}onError(Z,ee){var ae;if(ee.fatal){this.state=State.ERROR;return}switch(ee.details){case ErrorDetails.FRAG_GAP:case ErrorDetails.FRAG_PARSING_ERROR:case ErrorDetails.FRAG_DECRYPT_ERROR:case ErrorDetails.FRAG_LOAD_ERROR:case ErrorDetails.FRAG_LOAD_TIMEOUT:case ErrorDetails.KEY_LOAD_ERROR:case ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(PlaylistLevelType.MAIN,ee);break;case ErrorDetails.LEVEL_LOAD_ERROR:case ErrorDetails.LEVEL_LOAD_TIMEOUT:case ErrorDetails.LEVEL_PARSING_ERROR:!ee.levelRetry&&this.state===State.WAITING_LEVEL&&((ae=ee.context)==null?void 0:ae.type)===PlaylistContextType.LEVEL&&(this.state=State.IDLE);break;case ErrorDetails.BUFFER_FULL_ERROR:if(!ee.parent||ee.parent!=="main")return;this.reduceLengthAndFlushBuffer(ee)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case ErrorDetails.INTERNAL_EXCEPTION:this.recoverWorkerError(ee);break}}checkBuffer(){const{media:Z,gapController:ee}=this;if(!(!Z||!ee||!Z.readyState)){if(this.loadedmetadata||!BufferHelper.getBuffered(Z).length){const ae=this.state!==State.IDLE?this.fragCurrent:null;ee.poll(this.lastCurrentTime,ae)}this.lastCurrentTime=Z.currentTime}}onFragLoadEmergencyAborted(){this.state=State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()}onBufferFlushed(Z,{type:ee}){if(ee!==ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){const ae=(ee===ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(ae,ee,PlaylistLevelType.MAIN)}}onLevelsUpdated(Z,ee){this.levels=ee.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:Z}=this;if(!Z)return;const ee=Z.currentTime;let ae=this.startPosition;if(ae>=0&&ee<ae){if(Z.seeking){this.log(`could not seek to ${ae}, already seeking at ${ee}`);return}const ve=BufferHelper.getBuffered(Z),be=(ve.length?ve.start(0):0)-ae;be>0&&(be<this.config.maxBufferHole||be<this.config.maxFragLookUpTolerance)&&(this.log(`adjusting start position by ${be} to match buffer start`),ae+=be,this.startPosition=ae),this.log(`seek to target start position ${ae} from current time ${ee}`),Z.currentTime=ae}}_getAudioCodec(Z){let ee=this.config.defaultAudioCodec||Z.audioCodec;return this.audioCodecSwap&&ee&&(this.log("Swapping audio codec"),ee.indexOf("mp4a.40.5")!==-1?ee="mp4a.40.2":ee="mp4a.40.5"),ee}_loadBitrateTestFrag(Z,ee){Z.bitrateTest=!0,this._doFragLoad(Z,ee).then(ae=>{const{hls:ve}=this;if(!ae||this.fragContextChanged(Z))return;ee.fragmentError=0,this.state=State.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const ye=Z.stats;ye.parsing.start=ye.parsing.end=ye.buffering.start=ye.buffering.end=self.performance.now(),ve.trigger(Events.FRAG_LOADED,ae),Z.bitrateTest=!1})}_handleTransmuxComplete(Z){var ee;const ae="main",{hls:ve}=this,{remuxResult:ye,chunkMeta:be}=Z,Ke=this.getCurrentContext(be);if(!Ke){this.resetWhenMissingContext(be);return}const{frag:Ye,part:Xe,level:Qe}=Ke,{video:et,text:Je,id3:rt,initSegment:it}=ye,{details:nt}=Qe,tt=this.altAudio?void 0:ye.audio;if(this.fragContextChanged(Ye)){this.fragmentTracker.removeFragment(Ye);return}if(this.state=State.PARSING,it){if(it!=null&&it.tracks){const ut=Ye.initSegment||Ye;this._bufferInitSegment(Qe,it.tracks,ut,be),ve.trigger(Events.FRAG_PARSING_INIT_SEGMENT,{frag:ut,id:ae,tracks:it.tracks})}const st=it.initPTS,ot=it.timescale;isFiniteNumber(st)&&(this.initPTS[Ye.cc]={baseTime:st,timescale:ot},ve.trigger(Events.INIT_PTS_FOUND,{frag:Ye,id:ae,initPTS:st,timescale:ot}))}if(et&&nt&&Ye.sn!=="initSegment"){const st=nt.fragments[Ye.sn-1-nt.startSN],ot=Ye.sn===nt.startSN,ut=!st||Ye.cc>st.cc;if(ye.independent!==!1){const{startPTS:ft,endPTS:pt,startDTS:Xr,endDTS:mt}=et;if(Xe)Xe.elementaryStreams[et.type]={startPTS:ft,endPTS:pt,startDTS:Xr,endDTS:mt};else if(et.firstKeyFrame&&et.independent&&be.id===1&&!ut&&(this.couldBacktrack=!0),et.dropped&&et.independent){const Yr=this.getMainFwdBufferInfo(),ri=(Yr?Yr.end:this.getLoadPosition())+this.config.maxBufferHole,Zr=et.firstKeyFramePTS?et.firstKeyFramePTS:ft;if(!ot&&ri<Zr-this.config.maxBufferHole&&!ut){this.backtrack(Ye);return}else ut&&(Ye.gap=!0);Ye.setElementaryStreamInfo(et.type,Ye.start,pt,Ye.start,mt,!0)}Ye.setElementaryStreamInfo(et.type,ft,pt,Xr,mt),this.backtrackFragment&&(this.backtrackFragment=Ye),this.bufferFragmentData(et,Ye,Xe,be,ot||ut)}else if(ot||ut)Ye.gap=!0;else{this.backtrack(Ye);return}}if(tt){const{startPTS:st,endPTS:ot,startDTS:ut,endDTS:ft}=tt;Xe&&(Xe.elementaryStreams[ElementaryStreamTypes.AUDIO]={startPTS:st,endPTS:ot,startDTS:ut,endDTS:ft}),Ye.setElementaryStreamInfo(ElementaryStreamTypes.AUDIO,st,ot,ut,ft),this.bufferFragmentData(tt,Ye,Xe,be)}if(nt&&rt!=null&&(ee=rt.samples)!=null&&ee.length){const st={id:ae,frag:Ye,details:nt,samples:rt.samples};ve.trigger(Events.FRAG_PARSING_METADATA,st)}if(nt&&Je){const st={id:ae,frag:Ye,details:nt,samples:Je.samples};ve.trigger(Events.FRAG_PARSING_USERDATA,st)}}_bufferInitSegment(Z,ee,ae,ve){if(this.state!==State.PARSING)return;this.audioOnly=!!ee.audio&&!ee.video,this.altAudio&&!this.audioOnly&&delete ee.audio;const{audio:ye,video:be,audiovideo:Ke}=ee;if(ye){let Ye=Z.audioCodec;const Xe=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(Ye&&(Ye.indexOf("mp4a.40.5")!==-1?Ye="mp4a.40.2":Ye="mp4a.40.5"),ye.metadata.channelCount!==1&&Xe.indexOf("firefox")===-1&&(Ye="mp4a.40.5")),Xe.indexOf("android")!==-1&&ye.container!=="audio/mpeg"&&(Ye="mp4a.40.2",this.log(`Android: force audio codec to ${Ye}`)),Z.audioCodec&&Z.audioCodec!==Ye&&this.log(`Swapping manifest audio codec "${Z.audioCodec}" for "${Ye}"`),ye.levelCodec=Ye,ye.id="main",this.log(`Init audio buffer, container:${ye.container}, codecs[selected/level/parsed]=[${Ye||""}/${Z.audioCodec||""}/${ye.codec}]`)}be&&(be.levelCodec=Z.videoCodec,be.id="main",this.log(`Init video buffer, container:${be.container}, codecs[level/parsed]=[${Z.videoCodec||""}/${be.codec}]`)),Ke&&this.log(`Init audiovideo buffer, container:${Ke.container}, codecs[level/parsed]=[${Z.attrs.CODECS||""}/${Ke.codec}]`),this.hls.trigger(Events.BUFFER_CODECS,ee),Object.keys(ee).forEach(Ye=>{const Qe=ee[Ye].initSegment;Qe!=null&&Qe.byteLength&&this.hls.trigger(Events.BUFFER_APPENDING,{type:Ye,data:Qe,frag:ae,part:null,chunkMeta:ve,parent:ae.type})}),this.tick()}getMainFwdBufferInfo(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,PlaylistLevelType.MAIN)}backtrack(Z){this.couldBacktrack=!0,this.backtrackFragment=Z,this.resetTransmuxer(),this.flushBufferGap(Z),this.fragmentTracker.removeFragment(Z),this.fragPrevious=null,this.nextLoadPosition=Z.start,this.state=State.IDLE}checkFragmentChanged(){const Z=this.media;let ee=null;if(Z&&Z.readyState>1&&Z.seeking===!1){const ae=Z.currentTime;if(BufferHelper.isBuffered(Z,ae)?ee=this.getAppendedFrag(ae):BufferHelper.isBuffered(Z,ae+.1)&&(ee=this.getAppendedFrag(ae+.1)),ee){this.backtrackFragment=null;const ve=this.fragPlaying,ye=ee.level;(!ve||ee.sn!==ve.sn||ve.level!==ye||ee.urlId!==ve.urlId)&&(this.fragPlaying=ee,this.hls.trigger(Events.FRAG_CHANGED,{frag:ee}),(!ve||ve.level!==ye)&&this.hls.trigger(Events.LEVEL_SWITCHED,{level:ye}))}}}get nextLevel(){const Z=this.nextBufferedFrag;return Z?Z.level:-1}get currentFrag(){const Z=this.media;return Z?this.fragPlaying||this.getAppendedFrag(Z.currentTime):null}get currentProgramDateTime(){const Z=this.media;if(Z){const ee=Z.currentTime,ae=this.currentFrag;if(ae&&isFiniteNumber(ee)&&isFiniteNumber(ae.programDateTime)){const ve=ae.programDateTime+(ee-ae.start)*1e3;return new Date(ve)}}return null}get currentLevel(){const Z=this.currentFrag;return Z?Z.level:-1}get nextBufferedFrag(){const Z=this.currentFrag;return Z?this.followingBufferedFrag(Z):null}get forceStartLoad(){return this._forceStartLoad}}class EWMA{constructor(Z,ee=0,ae=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=Z,this.alpha_=Z?Math.exp(Math.log(.5)/Z):0,this.estimate_=ee,this.totalWeight_=ae}sample(Z,ee){const ae=Math.pow(this.alpha_,Z);this.estimate_=ee*(1-ae)+ae*this.estimate_,this.totalWeight_+=Z}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const Z=1-Math.pow(this.alpha_,this.totalWeight_);if(Z)return this.estimate_/Z}return this.estimate_}}class EwmaBandWidthEstimator{constructor(Z,ee,ae,ve=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=ae,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new EWMA(Z),this.fast_=new EWMA(ee),this.defaultTTFB_=ve,this.ttfb_=new EWMA(Z)}update(Z,ee){const{slow_:ae,fast_:ve,ttfb_:ye}=this;ae.halfLife!==Z&&(this.slow_=new EWMA(Z,ae.getEstimate(),ae.getTotalWeight())),ve.halfLife!==ee&&(this.fast_=new EWMA(ee,ve.getEstimate(),ve.getTotalWeight())),ye.halfLife!==Z&&(this.ttfb_=new EWMA(Z,ye.getEstimate(),ye.getTotalWeight()))}sample(Z,ee){Z=Math.max(Z,this.minDelayMs_);const ae=8*ee,ve=Z/1e3,ye=ae/ve;this.fast_.sample(ve,ye),this.slow_.sample(ve,ye)}sampleTTFB(Z){const ee=Z/1e3,ae=Math.sqrt(2)*Math.exp(-Math.pow(ee,2)/2);this.ttfb_.sample(ae,Math.max(Z,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}destroy(){}}class AbrController{constructor(Z){this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=-1,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=Z;const ee=Z.config;this.bwEstimator=new EwmaBandWidthEstimator(ee.abrEwmaSlowVoD,ee.abrEwmaFastVoD,ee.abrEwmaDefaultEstimate),this.registerListeners()}registerListeners(){const{hls:Z}=this;Z.on(Events.FRAG_LOADING,this.onFragLoading,this),Z.on(Events.FRAG_LOADED,this.onFragLoaded,this),Z.on(Events.FRAG_BUFFERED,this.onFragBuffered,this),Z.on(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),Z.on(Events.LEVEL_LOADED,this.onLevelLoaded,this)}unregisterListeners(){const{hls:Z}=this;Z.off(Events.FRAG_LOADING,this.onFragLoading,this),Z.off(Events.FRAG_LOADED,this.onFragLoaded,this),Z.off(Events.FRAG_BUFFERED,this.onFragBuffered,this),Z.off(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),Z.off(Events.LEVEL_LOADED,this.onLevelLoaded,this)}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null}onFragLoading(Z,ee){var ae;const ve=ee.frag;this.ignoreFragment(ve)||(this.fragCurrent=ve,this.partCurrent=(ae=ee.part)!=null?ae:null,this.clearTimer(),this.timer=self.setInterval(this.onCheck,100))}onLevelSwitching(Z,ee){this.clearTimer()}getTimeToLoadFrag(Z,ee,ae,ve){const ye=Z+ae/ee,be=ve?this.lastLevelLoadSec:0;return ye+be}onLevelLoaded(Z,ee){const ae=this.hls.config,{total:ve,bwEstimate:ye}=ee.stats;isFiniteNumber(ve)&&isFiniteNumber(ye)&&(this.lastLevelLoadSec=8*ve/ye),ee.details.live?this.bwEstimator.update(ae.abrEwmaSlowLive,ae.abrEwmaFastLive):this.bwEstimator.update(ae.abrEwmaSlowVoD,ae.abrEwmaFastVoD)}_abandonRulesCheck(){const{fragCurrent:Z,partCurrent:ee,hls:ae}=this,{autoLevelEnabled:ve,media:ye}=ae;if(!Z||!ye)return;const be=performance.now(),Ke=ee?ee.stats:Z.stats,Ye=ee?ee.duration:Z.duration,Xe=be-Ke.loading.start;if(Ke.aborted||Ke.loaded&&Ke.loaded===Ke.total||Z.level===0){this.clearTimer(),this._nextAutoLevel=-1;return}if(!ve||ye.paused||!ye.playbackRate||!ye.readyState)return;const Qe=ae.mainForwardBufferInfo;if(Qe===null)return;const et=this.bwEstimator.getEstimateTTFB(),Je=Math.abs(ye.playbackRate);if(Xe<=Math.max(et,1e3*(Ye/(Je*2))))return;const rt=Qe.len/Je;if(rt>=2*Ye/Je)return;const it=Ke.loading.first?Ke.loading.first-Ke.loading.start:-1,nt=Ke.loaded&&it>-1,tt=this.bwEstimator.getEstimate(),{levels:st,minAutoLevel:ot}=ae,ut=st[Z.level],ft=Ke.total||Math.max(Ke.loaded,Math.round(Ye*ut.maxBitrate/8));let pt=Xe-it;pt<1&&nt&&(pt=Math.min(Xe,Ke.loaded*8/tt));const Xr=nt?Ke.loaded*1e3/pt:0,mt=Xr?(ft-Ke.loaded)/Xr:ft*8/tt+et/1e3;if(mt<=rt)return;const Yr=Xr?Xr*8:tt;let ri=Number.POSITIVE_INFINITY,Zr;for(Zr=Z.level-1;Zr>ot;Zr--){const _r=st[Zr].maxBitrate;if(ri=this.getTimeToLoadFrag(et/1e3,Yr,Ye*_r,!st[Zr].details),ri<rt)break}ri>=mt||ri>Ye*10||(ae.nextLoadLevel=Zr,nt?this.bwEstimator.sample(Xe-Math.min(et,it),Ke.loaded):this.bwEstimator.sampleTTFB(Xe),this.clearTimer(),logger.warn(`[abr] Fragment ${Z.sn}${ee?" part "+ee.index:""} of level ${Z.level} is loading too slowly;
      Time to underbuffer: ${rt.toFixed(3)} s
      Estimated load time for current fragment: ${mt.toFixed(3)} s
      Estimated load time for down switch fragment: ${ri.toFixed(3)} s
      TTFB estimate: ${it}
      Current BW estimate: ${isFiniteNumber(tt)?(tt/1024).toFixed(3):"Unknown"} Kb/s
      New BW estimate: ${(this.bwEstimator.getEstimate()/1024).toFixed(3)} Kb/s
      Aborting and switching to level ${Zr}`),Z.loader&&(this.fragCurrent=this.partCurrent=null,Z.abortRequests()),ae.trigger(Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:Z,part:ee,stats:Ke}))}onFragLoaded(Z,{frag:ee,part:ae}){const ve=ae?ae.stats:ee.stats;if(ee.type===PlaylistLevelType.MAIN&&this.bwEstimator.sampleTTFB(ve.loading.first-ve.loading.start),!this.ignoreFragment(ee)){if(this.clearTimer(),this.lastLoadedFragLevel=ee.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){const ye=ae?ae.duration:ee.duration,be=this.hls.levels[ee.level],Ke=(be.loaded?be.loaded.bytes:0)+ve.loaded,Ye=(be.loaded?be.loaded.duration:0)+ye;be.loaded={bytes:Ke,duration:Ye},be.realBitrate=Math.round(8*Ke/Ye)}if(ee.bitrateTest){const ye={stats:ve,frag:ee,part:ae,id:ee.type};this.onFragBuffered(Events.FRAG_BUFFERED,ye),ee.bitrateTest=!1}}}onFragBuffered(Z,ee){const{frag:ae,part:ve}=ee,ye=ve!=null&&ve.stats.loaded?ve.stats:ae.stats;if(ye.aborted||this.ignoreFragment(ae))return;const be=ye.parsing.end-ye.loading.start-Math.min(ye.loading.first-ye.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(be,ye.loaded),ye.bwEstimate=this.bwEstimator.getEstimate(),ae.bitrateTest?this.bitrateTestDelay=be/1e3:this.bitrateTestDelay=0}ignoreFragment(Z){return Z.type!==PlaylistLevelType.MAIN||Z.sn==="initSegment"}clearTimer(){self.clearInterval(this.timer)}get nextAutoLevel(){const Z=this._nextAutoLevel,ee=this.bwEstimator;if(Z!==-1&&!ee.canEstimate())return Z;let ae=this.getNextABRAutoLevel();if(Z!==-1){const ve=this.hls.levels;if(ve.length>Math.max(Z,ae)&&ve[Z].loadError<=ve[ae].loadError)return Z}return Z!==-1&&(ae=Math.min(Z,ae)),ae}getNextABRAutoLevel(){const{fragCurrent:Z,partCurrent:ee,hls:ae}=this,{maxAutoLevel:ve,config:ye,minAutoLevel:be,media:Ke}=ae,Ye=ee?ee.duration:Z?Z.duration:0,Xe=Ke&&Ke.playbackRate!==0?Math.abs(Ke.playbackRate):1,Qe=this.bwEstimator?this.bwEstimator.getEstimate():ye.abrEwmaDefaultEstimate,et=ae.mainForwardBufferInfo,Je=(et?et.len:0)/Xe;let rt=this.findBestLevel(Qe,be,ve,Je,ye.abrBandWidthFactor,ye.abrBandWidthUpFactor);if(rt>=0)return rt;logger.trace(`[abr] ${Je?"rebuffering expected":"buffer is empty"}, finding optimal quality level`);let it=Ye?Math.min(Ye,ye.maxStarvationDelay):ye.maxStarvationDelay,nt=ye.abrBandWidthFactor,tt=ye.abrBandWidthUpFactor;if(!Je){const st=this.bitrateTestDelay;st&&(it=(Ye?Math.min(Ye,ye.maxLoadingDelay):ye.maxLoadingDelay)-st,logger.trace(`[abr] bitrate test took ${Math.round(1e3*st)}ms, set first fragment max fetchDuration to ${Math.round(1e3*it)} ms`),nt=tt=1)}return rt=this.findBestLevel(Qe,be,ve,Je+it,nt,tt),Math.max(rt,0)}findBestLevel(Z,ee,ae,ve,ye,be){var Ke;const{fragCurrent:Ye,partCurrent:Xe,lastLoadedFragLevel:Qe}=this,{levels:et}=this.hls,Je=et[Qe],rt=!!(Je!=null&&(Ke=Je.details)!=null&&Ke.live),it=Je==null?void 0:Je.codecSet,nt=Xe?Xe.duration:Ye?Ye.duration:0,tt=this.bwEstimator.getEstimateTTFB()/1e3;let st=ee,ot=-1;for(let ut=ae;ut>=ee;ut--){const ft=et[ut];if(!ft||it&&ft.codecSet!==it){ft&&(st=Math.min(ut,st),ot=Math.max(ut,ot));continue}ot!==-1&&logger.trace(`[abr] Skipped level(s) ${st}-${ot} with CODECS:"${et[ot].attrs.CODECS}"; not compatible with "${Je.attrs.CODECS}"`);const pt=ft.details,Xr=(Xe?pt==null?void 0:pt.partTarget:pt==null?void 0:pt.averagetargetduration)||nt;let mt;ut<=Qe?mt=ye*Z:mt=be*Z;const Yr=et[ut].maxBitrate,ri=this.getTimeToLoadFrag(tt,mt,Yr*Xr,pt===void 0);if(logger.trace(`[abr] level:${ut} adjustedbw-bitrate:${Math.round(mt-Yr)} avgDuration:${Xr.toFixed(1)} maxFetchDuration:${ve.toFixed(1)} fetchDuration:${ri.toFixed(1)}`),mt>Yr&&(ri===0||!isFiniteNumber(ri)||rt&&!this.bitrateTestDelay||ri<ve))return ut}return-1}set nextAutoLevel(Z){this._nextAutoLevel=Z}}class ChunkCache{constructor(){this.chunks=[],this.dataLength=0}push(Z){this.chunks.push(Z),this.dataLength+=Z.length}flush(){const{chunks:Z,dataLength:ee}=this;let ae;if(Z.length)Z.length===1?ae=Z[0]:ae=concatUint8Arrays(Z,ee);else return new Uint8Array(0);return this.reset(),ae}reset(){this.chunks.length=0,this.dataLength=0}}function concatUint8Arrays(ie,Z){const ee=new Uint8Array(Z);let ae=0;for(let ve=0;ve<ie.length;ve++){const ye=ie[ve];ee.set(ye,ae),ae+=ye.length}return ee}const TICK_INTERVAL$1=100;class AudioStreamController extends BaseStreamController{constructor(Z,ee,ae){super(Z,ee,ae,"[audio-stream-controller]",PlaylistLevelType.AUDIO),this.videoBuffer=null,this.videoTrackCC=-1,this.waitingVideoCC=-1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),this.mainDetails=null,this.bufferedTrack=null,this.switchingTrack=null}_registerListeners(){const{hls:Z}=this;Z.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),Z.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),Z.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),Z.on(Events.LEVEL_LOADED,this.onLevelLoaded,this),Z.on(Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),Z.on(Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),Z.on(Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),Z.on(Events.ERROR,this.onError,this),Z.on(Events.BUFFER_RESET,this.onBufferReset,this),Z.on(Events.BUFFER_CREATED,this.onBufferCreated,this),Z.on(Events.BUFFER_FLUSHED,this.onBufferFlushed,this),Z.on(Events.INIT_PTS_FOUND,this.onInitPtsFound,this),Z.on(Events.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:Z}=this;Z.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),Z.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),Z.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),Z.off(Events.LEVEL_LOADED,this.onLevelLoaded,this),Z.off(Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),Z.off(Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),Z.off(Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),Z.off(Events.ERROR,this.onError,this),Z.off(Events.BUFFER_RESET,this.onBufferReset,this),Z.off(Events.BUFFER_CREATED,this.onBufferCreated,this),Z.off(Events.BUFFER_FLUSHED,this.onBufferFlushed,this),Z.off(Events.INIT_PTS_FOUND,this.onInitPtsFound,this),Z.off(Events.FRAG_BUFFERED,this.onFragBuffered,this)}onInitPtsFound(Z,{frag:ee,id:ae,initPTS:ve,timescale:ye}){if(ae==="main"){const be=ee.cc;this.initPTS[ee.cc]={baseTime:ve,timescale:ye},this.log(`InitPTS for cc: ${be} found from main: ${ve}`),this.videoTrackCC=be,this.state===State.WAITING_INIT_PTS&&this.tick()}}startLoad(Z){if(!this.levels){this.startPosition=Z,this.state=State.STOPPED;return}const ee=this.lastCurrentTime;this.stopLoad(),this.setInterval(TICK_INTERVAL$1),ee>0&&Z===-1?(this.log(`Override startPosition with lastCurrentTime @${ee.toFixed(3)}`),Z=ee,this.state=State.IDLE):(this.loadedmetadata=!1,this.state=State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=Z,this.tick()}doTick(){switch(this.state){case State.IDLE:this.doTickIdle();break;case State.WAITING_TRACK:{var Z;const{levels:ae,trackId:ve}=this,ye=ae==null||(Z=ae[ve])==null?void 0:Z.details;if(ye){if(this.waitForCdnTuneIn(ye))break;this.state=State.WAITING_INIT_PTS}break}case State.FRAG_LOADING_WAITING_RETRY:{var ee;const ae=performance.now(),ve=this.retryDate;(!ve||ae>=ve||(ee=this.media)!=null&&ee.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=State.IDLE);break}case State.WAITING_INIT_PTS:{const ae=this.waitingData;if(ae){const{frag:ve,part:ye,cache:be,complete:Ke}=ae;if(this.initPTS[ve.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=State.FRAG_LOADING;const Ye=be.flush(),Xe={frag:ve,part:ye,payload:Ye,networkDetails:null};this._handleFragmentLoadProgress(Xe),Ke&&super._handleFragmentLoadComplete(Xe)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log(`Waiting fragment cc (${ve.cc}) cancelled because video is at cc ${this.videoTrackCC}`),this.clearWaitingFragment();else{const Ye=this.getLoadPosition(),Xe=BufferHelper.bufferInfo(this.mediaBuffer,Ye,this.config.maxBufferHole);fragmentWithinToleranceTest(Xe.end,this.config.maxFragLookUpTolerance,ve)<0&&(this.log(`Waiting fragment cc (${ve.cc}) @ ${ve.start} cancelled because another fragment at ${Xe.end} is needed`),this.clearWaitingFragment())}}else this.state=State.IDLE}}this.onTickEnd()}clearWaitingFragment(){const Z=this.waitingData;Z&&(this.fragmentTracker.removeFragment(Z.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=State.IDLE)}resetLoadingState(){this.clearWaitingFragment(),super.resetLoadingState()}onTickEnd(){const{media:Z}=this;Z!=null&&Z.readyState&&(this.lastCurrentTime=Z.currentTime)}doTickIdle(){const{hls:Z,levels:ee,media:ae,trackId:ve}=this,ye=Z.config;if(!(ee!=null&&ee[ve])||!ae&&(this.startFragRequested||!ye.startFragPrefetch))return;const be=ee[ve],Ke=be.details;if(!Ke||Ke.live&&this.levelLastLoaded!==ve||this.waitForCdnTuneIn(Ke)){this.state=State.WAITING_TRACK;return}const Ye=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&Ye&&(this.bufferFlushed=!1,this.afterBufferFlushed(Ye,ElementaryStreamTypes.AUDIO,PlaylistLevelType.AUDIO));const Xe=this.getFwdBufferInfo(Ye,PlaylistLevelType.AUDIO);if(Xe===null)return;const{bufferedTrack:Qe,switchingTrack:et}=this;if(!et&&this._streamEnded(Xe,Ke)){Z.trigger(Events.BUFFER_EOS,{type:"audio"}),this.state=State.ENDED;return}const Je=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,PlaylistLevelType.MAIN),rt=Xe.len,it=this.getMaxBufferLength(Je==null?void 0:Je.len);if(rt>=it&&!et)return;const tt=Ke.fragments[0].start;let st=Xe.end;if(et&&ae){const pt=this.getLoadPosition();Qe&&et.attrs!==Qe.attrs&&(st=pt),Ke.PTSKnown&&pt<tt&&(Xe.end>tt||Xe.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),ae.currentTime=tt+.05)}let ot=this.getNextFragment(st,Ke),ut=!1;if(ot&&this.isLoopLoading(ot,st)&&(ut=!!ot.gap,ot=this.getNextFragmentLoopLoading(ot,Ke,Xe,PlaylistLevelType.MAIN,it)),!ot){this.bufferFlushed=!0;return}const ft=Je&&ot.start>Je.end+Ke.targetduration;if(ft||!(Je!=null&&Je.len)&&Xe.len){const pt=this.getAppendedFrag(ot.start,PlaylistLevelType.MAIN);if(pt===null||(ut||(ut=!!pt.gap||!!ft&&Je.len===0),ft&&!ut||ut&&Xe.nextStart&&Xe.nextStart<pt.end))return}this.loadFragment(ot,be,st)}getMaxBufferLength(Z){const ee=super.getMaxBufferLength();return Z?Math.min(Math.max(ee,Z),this.config.maxMaxBufferLength):ee}onMediaDetaching(){this.videoBuffer=null,super.onMediaDetaching()}onAudioTracksUpdated(Z,{audioTracks:ee}){this.resetTransmuxer(),this.levels=ee.map(ae=>new Level(ae))}onAudioTrackSwitching(Z,ee){const ae=!!ee.url;this.trackId=ee.id;const{fragCurrent:ve}=this;ve&&(ve.abortRequests(),this.removeUnbufferedFrags(ve.start)),this.resetLoadingState(),ae?this.setInterval(TICK_INTERVAL$1):this.resetTransmuxer(),ae?(this.switchingTrack=ee,this.state=State.IDLE):(this.switchingTrack=null,this.bufferedTrack=ee,this.state=State.STOPPED),this.tick()}onManifestLoading(){this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1,this.levels=this.mainDetails=this.waitingData=this.bufferedTrack=this.cachedTrackLoadedData=this.switchingTrack=null,this.startFragRequested=!1,this.trackId=this.videoTrackCC=this.waitingVideoCC=-1}onLevelLoaded(Z,ee){this.mainDetails=ee.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(Events.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)}onAudioTrackLoaded(Z,ee){var ae;if(this.mainDetails==null){this.cachedTrackLoadedData=ee;return}const{levels:ve}=this,{details:ye,id:be}=ee;if(!ve){this.warn(`Audio tracks were reset while loading level ${be}`);return}this.log(`Track ${be} loaded [${ye.startSN},${ye.endSN}]${ye.lastPartSn?`[part-${ye.lastPartSn}-${ye.lastPartIndex}]`:""},duration:${ye.totalduration}`);const Ke=ve[be];let Ye=0;if(ye.live||(ae=Ke.details)!=null&&ae.live){this.checkLiveUpdate(ye);const Xe=this.mainDetails;if(ye.deltaUpdateFailed||!Xe)return;!Ke.details&&ye.hasProgramDateTime&&Xe.hasProgramDateTime?(alignMediaPlaylistByPDT(ye,Xe),Ye=ye.fragments[0].start):Ye=this.alignPlaylists(ye,Ke.details)}Ke.details=ye,this.levelLastLoaded=be,!this.startFragRequested&&(this.mainDetails||!ye.live)&&this.setStartPosition(Ke.details,Ye),this.state===State.WAITING_TRACK&&!this.waitForCdnTuneIn(ye)&&(this.state=State.IDLE),this.tick()}_handleFragmentLoadProgress(Z){var ee;const{frag:ae,part:ve,payload:ye}=Z,{config:be,trackId:Ke,levels:Ye}=this;if(!Ye){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${ae.sn} of level ${ae.level} will not be buffered`);return}const Xe=Ye[Ke];if(!Xe){this.warn("Audio track is undefined on fragment load progress");return}const Qe=Xe.details;if(!Qe){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(ae.start);return}const et=be.defaultAudioCodec||Xe.audioCodec||"mp4a.40.2";let Je=this.transmuxer;Je||(Je=this.transmuxer=new TransmuxerInterface(this.hls,PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const rt=this.initPTS[ae.cc],it=(ee=ae.initSegment)==null?void 0:ee.data;if(rt!==void 0){const tt=ve?ve.index:-1,st=tt!==-1,ot=new ChunkMetadata(ae.level,ae.sn,ae.stats.chunkCount,ye.byteLength,tt,st);Je.push(ye,it,et,"",ae,ve,Qe.totalduration,!1,ot,rt)}else{this.log(`Unknown video PTS for cc ${ae.cc}, waiting for video PTS before demuxing audio frag ${ae.sn} of [${Qe.startSN} ,${Qe.endSN}],track ${Ke}`);const{cache:nt}=this.waitingData=this.waitingData||{frag:ae,part:ve,cache:new ChunkCache,complete:!1};nt.push(new Uint8Array(ye)),this.waitingVideoCC=this.videoTrackCC,this.state=State.WAITING_INIT_PTS}}_handleFragmentLoadComplete(Z){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(Z)}onBufferReset(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1}onBufferCreated(Z,ee){const ae=ee.tracks.audio;ae&&(this.mediaBuffer=ae.buffer||null),ee.tracks.video&&(this.videoBuffer=ee.tracks.video.buffer||null)}onFragBuffered(Z,ee){const{frag:ae,part:ve}=ee;if(ae.type!==PlaylistLevelType.AUDIO){if(!this.loadedmetadata&&ae.type===PlaylistLevelType.MAIN){const ye=this.videoBuffer||this.media;ye&&BufferHelper.getBuffered(ye).length&&(this.loadedmetadata=!0)}return}if(this.fragContextChanged(ae)){this.warn(`Fragment ${ae.sn}${ve?" p: "+ve.index:""} of level ${ae.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(ae.sn!=="initSegment"){this.fragPrevious=ae;const ye=this.switchingTrack;ye&&(this.bufferedTrack=ye,this.switchingTrack=null,this.hls.trigger(Events.AUDIO_TRACK_SWITCHED,_objectSpread2({},ye)))}this.fragBufferedComplete(ae,ve)}onError(Z,ee){var ae;if(ee.fatal){this.state=State.ERROR;return}switch(ee.details){case ErrorDetails.FRAG_GAP:case ErrorDetails.FRAG_PARSING_ERROR:case ErrorDetails.FRAG_DECRYPT_ERROR:case ErrorDetails.FRAG_LOAD_ERROR:case ErrorDetails.FRAG_LOAD_TIMEOUT:case ErrorDetails.KEY_LOAD_ERROR:case ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(PlaylistLevelType.AUDIO,ee);break;case ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case ErrorDetails.LEVEL_PARSING_ERROR:!ee.levelRetry&&this.state===State.WAITING_TRACK&&((ae=ee.context)==null?void 0:ae.type)===PlaylistContextType.AUDIO_TRACK&&(this.state=State.IDLE);break;case ErrorDetails.BUFFER_FULL_ERROR:if(!ee.parent||ee.parent!=="audio")return;this.reduceLengthAndFlushBuffer(ee)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case ErrorDetails.INTERNAL_EXCEPTION:this.recoverWorkerError(ee);break}}onBufferFlushed(Z,{type:ee}){ee===ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0,this.state===State.ENDED&&(this.state=State.IDLE))}_handleTransmuxComplete(Z){var ee;const ae="audio",{hls:ve}=this,{remuxResult:ye,chunkMeta:be}=Z,Ke=this.getCurrentContext(be);if(!Ke){this.resetWhenMissingContext(be);return}const{frag:Ye,part:Xe,level:Qe}=Ke,{details:et}=Qe,{audio:Je,text:rt,id3:it,initSegment:nt}=ye;if(this.fragContextChanged(Ye)||!et){this.fragmentTracker.removeFragment(Ye);return}if(this.state=State.PARSING,this.switchingTrack&&Je&&this.completeAudioSwitch(this.switchingTrack),nt!=null&&nt.tracks){const tt=Ye.initSegment||Ye;this._bufferInitSegment(nt.tracks,tt,be),ve.trigger(Events.FRAG_PARSING_INIT_SEGMENT,{frag:tt,id:ae,tracks:nt.tracks})}if(Je){const{startPTS:tt,endPTS:st,startDTS:ot,endDTS:ut}=Je;Xe&&(Xe.elementaryStreams[ElementaryStreamTypes.AUDIO]={startPTS:tt,endPTS:st,startDTS:ot,endDTS:ut}),Ye.setElementaryStreamInfo(ElementaryStreamTypes.AUDIO,tt,st,ot,ut),this.bufferFragmentData(Je,Ye,Xe,be)}if(it!=null&&(ee=it.samples)!=null&&ee.length){const tt=_extends({id:ae,frag:Ye,details:et},it);ve.trigger(Events.FRAG_PARSING_METADATA,tt)}if(rt){const tt=_extends({id:ae,frag:Ye,details:et},rt);ve.trigger(Events.FRAG_PARSING_USERDATA,tt)}}_bufferInitSegment(Z,ee,ae){if(this.state!==State.PARSING)return;Z.video&&delete Z.video;const ve=Z.audio;if(!ve)return;ve.levelCodec=ve.codec,ve.id="audio",this.log(`Init audio buffer, container:${ve.container}, codecs[parsed]=[${ve.codec}]`),this.hls.trigger(Events.BUFFER_CODECS,Z);const ye=ve.initSegment;if(ye!=null&&ye.byteLength){const be={type:"audio",frag:ee,part:null,chunkMeta:ae,parent:ee.type,data:ye};this.hls.trigger(Events.BUFFER_APPENDING,be)}this.tick()}loadFragment(Z,ee,ae){const ve=this.fragmentTracker.getState(Z);if(this.fragCurrent=Z,this.switchingTrack||ve===FragmentState.NOT_LOADED||ve===FragmentState.PARTIAL){var ye;Z.sn==="initSegment"?this._loadInitSegment(Z,ee):(ye=ee.details)!=null&&ye.live&&!this.initPTS[Z.cc]?(this.log(`Waiting for video PTS in continuity counter ${Z.cc} of live stream before loading audio fragment ${Z.sn} of level ${this.trackId}`),this.state=State.WAITING_INIT_PTS):(this.startFragRequested=!0,super.loadFragment(Z,ee,ae))}else this.clearTrackerIfNeeded(Z)}completeAudioSwitch(Z){const{hls:ee,media:ae,bufferedTrack:ve}=this,ye=ve==null?void 0:ve.attrs,be=Z.attrs;ae&&ye&&(ye.CHANNELS!==be.CHANNELS||ye.NAME!==be.NAME||ye.LANGUAGE!==be.LANGUAGE)&&(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio")),this.bufferedTrack=Z,this.switchingTrack=null,ee.trigger(Events.AUDIO_TRACK_SWITCHED,_objectSpread2({},Z))}}class AudioTrackController extends BasePlaylistController{constructor(Z){super(Z,"[audio-track-controller]"),this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:Z}=this;Z.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),Z.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),Z.on(Events.LEVEL_LOADING,this.onLevelLoading,this),Z.on(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),Z.on(Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),Z.on(Events.ERROR,this.onError,this)}unregisterListeners(){const{hls:Z}=this;Z.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),Z.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),Z.off(Events.LEVEL_LOADING,this.onLevelLoading,this),Z.off(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),Z.off(Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),Z.off(Events.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(Z,ee){this.tracks=ee.audioTracks||[]}onAudioTrackLoaded(Z,ee){const{id:ae,groupId:ve,details:ye}=ee,be=this.tracksInGroup[ae];if(!be||be.groupId!==ve){this.warn(`Track with id:${ae} and group:${ve} not found in active group ${be.groupId}`);return}const Ke=be.details;be.details=ee.details,this.log(`audio-track ${ae} "${be.name}" lang:${be.lang} group:${ve} loaded [${ye.startSN}-${ye.endSN}]`),ae===this.trackId&&this.playlistLoaded(ae,ee,Ke)}onLevelLoading(Z,ee){this.switchLevel(ee.level)}onLevelSwitching(Z,ee){this.switchLevel(ee.level)}switchLevel(Z){const ee=this.hls.levels[Z];if(!(ee!=null&&ee.audioGroupIds))return;const ae=ee.audioGroupIds[ee.urlId];if(this.groupId!==ae){this.groupId=ae||null;const ve=this.tracks.filter(be=>!ae||be.groupId===ae);this.selectDefaultTrack&&!ve.some(be=>be.default)&&(this.selectDefaultTrack=!1),this.tracksInGroup=ve;const ye={audioTracks:ve};this.log(`Updating audio tracks, ${ve.length} track(s) found in group:${ae}`),this.hls.trigger(Events.AUDIO_TRACKS_UPDATED,ye),this.selectInitialTrack()}else this.shouldReloadPlaylist(this.currentTrack)&&this.setAudioTrack(this.trackId)}onError(Z,ee){ee.fatal||!ee.context||ee.context.type===PlaylistContextType.AUDIO_TRACK&&ee.context.id===this.trackId&&ee.context.groupId===this.groupId&&(this.requestScheduled=-1,this.checkRetry(ee))}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(Z){this.selectDefaultTrack=!1,this.setAudioTrack(Z)}setAudioTrack(Z){const ee=this.tracksInGroup;if(Z<0||Z>=ee.length){this.warn("Invalid id passed to audio-track controller");return}this.clearTimer();const ae=this.currentTrack;ee[this.trackId];const ve=ee[Z],{groupId:ye,name:be}=ve;if(this.log(`Switching to audio-track ${Z} "${be}" lang:${ve.lang} group:${ye}`),this.trackId=Z,this.currentTrack=ve,this.selectDefaultTrack=!1,this.hls.trigger(Events.AUDIO_TRACK_SWITCHING,_objectSpread2({},ve)),ve.details&&!ve.details.live)return;const Ke=this.switchParams(ve.url,ae==null?void 0:ae.details);this.loadPlaylist(Ke)}selectInitialTrack(){const Z=this.tracksInGroup,ee=this.findTrackId(this.currentTrack)|this.findTrackId(null);if(ee!==-1)this.setAudioTrack(ee);else{const ae=new Error(`No track found for running audio group-ID: ${this.groupId} track count: ${Z.length}`);this.warn(ae.message),this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:ae})}}findTrackId(Z){const ee=this.tracksInGroup;for(let ae=0;ae<ee.length;ae++){const ve=ee[ae];if((!this.selectDefaultTrack||ve.default)&&(!Z||Z.attrs["STABLE-RENDITION-ID"]!==void 0&&Z.attrs["STABLE-RENDITION-ID"]===ve.attrs["STABLE-RENDITION-ID"]||Z.name===ve.name&&Z.lang===ve.lang))return ve.id}return-1}loadPlaylist(Z){super.loadPlaylist();const ee=this.tracksInGroup[this.trackId];if(this.shouldLoadPlaylist(ee)){const ae=ee.id,ve=ee.groupId;let ye=ee.url;if(Z)try{ye=Z.addDirectives(ye)}catch(be){this.warn(`Could not construct new URL with HLS Delivery Directives: ${be}`)}this.log(`loading audio-track playlist ${ae} "${ee.name}" lang:${ee.lang} group:${ve}`),this.clearTimer(),this.hls.trigger(Events.AUDIO_TRACK_LOADING,{url:ye,id:ae,groupId:ve,deliveryDirectives:Z||null})}}}function subtitleOptionsIdentical(ie,Z){if(ie.length!==Z.length)return!1;for(let ee=0;ee<ie.length;ee++)if(!subtitleAttributesIdentical(ie[ee].attrs,Z[ee].attrs))return!1;return!0}function subtitleAttributesIdentical(ie,Z){const ee=ie["STABLE-RENDITION-ID"];return ee?ee===Z["STABLE-RENDITION-ID"]:!["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED"].some(ae=>ie[ae]!==Z[ae])}const TICK_INTERVAL=500;class SubtitleStreamController extends BaseStreamController{constructor(Z,ee,ae){super(Z,ee,ae,"[subtitle-stream-controller]",PlaylistLevelType.SUBTITLE),this.levels=[],this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),this.mainDetails=null}_registerListeners(){const{hls:Z}=this;Z.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),Z.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),Z.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),Z.on(Events.LEVEL_LOADED,this.onLevelLoaded,this),Z.on(Events.ERROR,this.onError,this),Z.on(Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),Z.on(Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),Z.on(Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),Z.on(Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),Z.on(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),Z.on(Events.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:Z}=this;Z.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),Z.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),Z.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),Z.off(Events.LEVEL_LOADED,this.onLevelLoaded,this),Z.off(Events.ERROR,this.onError,this),Z.off(Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),Z.off(Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),Z.off(Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),Z.off(Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),Z.off(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),Z.off(Events.FRAG_BUFFERED,this.onFragBuffered,this)}startLoad(Z){this.stopLoad(),this.state=State.IDLE,this.setInterval(TICK_INTERVAL),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=Z,this.tick()}onManifestLoading(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()}onMediaDetaching(){this.tracksBuffered=[],super.onMediaDetaching()}onLevelLoaded(Z,ee){this.mainDetails=ee.details}onSubtitleFragProcessed(Z,ee){const{frag:ae,success:ve}=ee;if(this.fragPrevious=ae,this.state=State.IDLE,!ve)return;const ye=this.tracksBuffered[this.currentTrackId];if(!ye)return;let be;const Ke=ae.start;for(let Xe=0;Xe<ye.length;Xe++)if(Ke>=ye[Xe].start&&Ke<=ye[Xe].end){be=ye[Xe];break}const Ye=ae.start+ae.duration;be?be.end=Ye:(be={start:Ke,end:Ye},ye.push(be)),this.fragmentTracker.fragBuffered(ae)}onBufferFlushing(Z,ee){const{startOffset:ae,endOffset:ve}=ee;if(ae===0&&ve!==Number.POSITIVE_INFINITY){const ye=ve-1;if(ye<=0)return;ee.endOffsetSubtitles=Math.max(0,ye),this.tracksBuffered.forEach(be=>{for(let Ke=0;Ke<be.length;){if(be[Ke].end<=ye){be.shift();continue}else if(be[Ke].start<ye)be[Ke].start=ye;else break;Ke++}}),this.fragmentTracker.removeFragmentsInRange(ae,ye,PlaylistLevelType.SUBTITLE)}}onFragBuffered(Z,ee){if(!this.loadedmetadata&&ee.frag.type===PlaylistLevelType.MAIN){var ae;(ae=this.media)!=null&&ae.buffered.length&&(this.loadedmetadata=!0)}}onError(Z,ee){const ae=ee.frag;(ae==null?void 0:ae.type)===PlaylistLevelType.SUBTITLE&&(this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==State.STOPPED&&(this.state=State.IDLE))}onSubtitleTracksUpdated(Z,{subtitleTracks:ee}){if(subtitleOptionsIdentical(this.levels,ee)){this.levels=ee.map(ae=>new Level(ae));return}this.tracksBuffered=[],this.levels=ee.map(ae=>{const ve=new Level(ae);return this.tracksBuffered[ve.id]=[],ve}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,PlaylistLevelType.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(Z,ee){if(this.currentTrackId=ee.id,!this.levels.length||this.currentTrackId===-1){this.clearInterval();return}const ae=this.levels[this.currentTrackId];ae!=null&&ae.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,ae&&this.setInterval(TICK_INTERVAL)}onSubtitleTrackLoaded(Z,ee){var ae;const{details:ve,id:ye}=ee,{currentTrackId:be,levels:Ke}=this;if(!Ke.length)return;const Ye=Ke[be];if(ye>=Ke.length||ye!==be||!Ye)return;this.mediaBuffer=this.mediaBufferTimeRanges;let Xe=0;if(ve.live||(ae=Ye.details)!=null&&ae.live){const Qe=this.mainDetails;if(ve.deltaUpdateFailed||!Qe)return;const et=Qe.fragments[0];Ye.details?(Xe=this.alignPlaylists(ve,Ye.details),Xe===0&&et&&(Xe=et.start,addSliding(ve,Xe))):ve.hasProgramDateTime&&Qe.hasProgramDateTime?(alignMediaPlaylistByPDT(ve,Qe),Xe=ve.fragments[0].start):et&&(Xe=et.start,addSliding(ve,Xe))}Ye.details=ve,this.levelLastLoaded=ye,!this.startFragRequested&&(this.mainDetails||!ve.live)&&this.setStartPosition(Ye.details,Xe),this.tick(),ve.live&&!this.fragCurrent&&this.media&&this.state===State.IDLE&&(findFragmentByPTS(null,ve.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),Ye.details=void 0))}_handleFragmentLoadComplete(Z){const{frag:ee,payload:ae}=Z,ve=ee.decryptdata,ye=this.hls;if(!this.fragContextChanged(ee)&&ae&&ae.byteLength>0&&ve&&ve.key&&ve.iv&&ve.method==="AES-128"){const be=performance.now();this.decrypter.decrypt(new Uint8Array(ae),ve.key.buffer,ve.iv.buffer).catch(Ke=>{throw ye.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!1,error:Ke,reason:Ke.message,frag:ee}),Ke}).then(Ke=>{const Ye=performance.now();ye.trigger(Events.FRAG_DECRYPTED,{frag:ee,payload:Ke,stats:{tstart:be,tdecrypt:Ye}})}).catch(Ke=>{this.warn(`${Ke.name}: ${Ke.message}`),this.state=State.IDLE})}}doTick(){if(!this.media){this.state=State.IDLE;return}if(this.state===State.IDLE){const{currentTrackId:Z,levels:ee}=this,ae=ee[Z];if(!ee.length||!ae||!ae.details)return;const{config:ve}=this,ye=this.getLoadPosition(),be=BufferHelper.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],ye,ve.maxBufferHole),{end:Ke,len:Ye}=be,Xe=this.getFwdBufferInfo(this.media,PlaylistLevelType.MAIN),Qe=ae.details,et=this.getMaxBufferLength(Xe==null?void 0:Xe.len)+Qe.levelTargetDuration;if(Ye>et)return;const Je=Qe.fragments,rt=Je.length,it=Qe.edge;let nt=null;const tt=this.fragPrevious;if(Ke<it){const st=ve.maxFragLookUpTolerance,ot=Ke>it-st?0:st;nt=findFragmentByPTS(tt,Je,Math.max(Je[0].start,Ke),ot),!nt&&tt&&tt.start<Je[0].start&&(nt=Je[0])}else nt=Je[rt-1];if(!nt)return;if(nt=this.mapToInitFragWhenRequired(nt),nt.sn!=="initSegment"){const st=nt.sn-Qe.startSN,ot=Je[st-1];ot&&ot.cc===nt.cc&&this.fragmentTracker.getState(ot)===FragmentState.NOT_LOADED&&(nt=ot)}this.fragmentTracker.getState(nt)===FragmentState.NOT_LOADED&&this.loadFragment(nt,ae,Ke)}}getMaxBufferLength(Z){const ee=super.getMaxBufferLength();return Z?Math.max(ee,Z):ee}loadFragment(Z,ee,ae){this.fragCurrent=Z,Z.sn==="initSegment"?this._loadInitSegment(Z,ee):(this.startFragRequested=!0,super.loadFragment(Z,ee,ae))}get mediaBufferTimeRanges(){return new BufferableInstance(this.tracksBuffered[this.currentTrackId]||[])}}class BufferableInstance{constructor(Z){this.buffered=void 0;const ee=(ae,ve,ye)=>{if(ve=ve>>>0,ve>ye-1)throw new DOMException(`Failed to execute '${ae}' on 'TimeRanges': The index provided (${ve}) is greater than the maximum bound (${ye})`);return Z[ve][ae]};this.buffered={get length(){return Z.length},end(ae){return ee("end",ae,Z.length)},start(ae){return ee("start",ae,Z.length)}}}}class SubtitleTrackController extends BasePlaylistController{constructor(Z){super(Z,"[subtitle-track-controller]"),this.media=null,this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.trackChangeListener=()=>this.onTextTracksChanged(),this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(Z){this._subtitleDisplay=Z,this.trackId>-1&&this.toggleTrackModes(this.trackId)}registerListeners(){const{hls:Z}=this;Z.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),Z.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),Z.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),Z.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),Z.on(Events.LEVEL_LOADING,this.onLevelLoading,this),Z.on(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),Z.on(Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),Z.on(Events.ERROR,this.onError,this)}unregisterListeners(){const{hls:Z}=this;Z.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),Z.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),Z.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),Z.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),Z.off(Events.LEVEL_LOADING,this.onLevelLoading,this),Z.off(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),Z.off(Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),Z.off(Events.ERROR,this.onError,this)}onMediaAttached(Z,ee){this.media=ee.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(Z){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,Z)}onMediaDetaching(){if(!this.media)return;self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),filterSubtitleTracks(this.media.textTracks).forEach(ee=>{clearCurrentCues(ee)}),this.subtitleTrack=-1,this.media=null}onManifestLoading(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(Z,ee){this.tracks=ee.subtitleTracks}onSubtitleTrackLoaded(Z,ee){const{id:ae,details:ve}=ee,{trackId:ye}=this,be=this.tracksInGroup[ye];if(!be){this.warn(`Invalid subtitle track id ${ae}`);return}const Ke=be.details;be.details=ee.details,this.log(`subtitle track ${ae} loaded [${ve.startSN}-${ve.endSN}]`),ae===this.trackId&&this.playlistLoaded(ae,ee,Ke)}onLevelLoading(Z,ee){this.switchLevel(ee.level)}onLevelSwitching(Z,ee){this.switchLevel(ee.level)}switchLevel(Z){const ee=this.hls.levels[Z];if(!(ee!=null&&ee.textGroupIds))return;const ae=ee.textGroupIds[ee.urlId],ve=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;if(this.groupId!==ae){const ye=this.tracks.filter(Ye=>!ae||Ye.groupId===ae);this.tracksInGroup=ye;const be=this.findTrackId(ve==null?void 0:ve.name)||this.findTrackId();this.groupId=ae||null;const Ke={subtitleTracks:ye};this.log(`Updating subtitle tracks, ${ye.length} track(s) found in "${ae}" group-id`),this.hls.trigger(Events.SUBTITLE_TRACKS_UPDATED,Ke),be!==-1&&this.setSubtitleTrack(be,ve)}else this.shouldReloadPlaylist(ve)&&this.setSubtitleTrack(this.trackId,ve)}findTrackId(Z){const ee=this.tracksInGroup;for(let ae=0;ae<ee.length;ae++){const ve=ee[ae];if((!this.selectDefaultTrack||ve.default)&&(!Z||Z===ve.name))return ve.id}return-1}onError(Z,ee){ee.fatal||!ee.context||ee.context.type===PlaylistContextType.SUBTITLE_TRACK&&ee.context.id===this.trackId&&ee.context.groupId===this.groupId&&this.checkRetry(ee)}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(Z){this.selectDefaultTrack=!1;const ee=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(Z,ee)}loadPlaylist(Z){super.loadPlaylist();const ee=this.tracksInGroup[this.trackId];if(this.shouldLoadPlaylist(ee)){const ae=ee.id,ve=ee.groupId;let ye=ee.url;if(Z)try{ye=Z.addDirectives(ye)}catch(be){this.warn(`Could not construct new URL with HLS Delivery Directives: ${be}`)}this.log(`Loading subtitle playlist for id ${ae}`),this.hls.trigger(Events.SUBTITLE_TRACK_LOADING,{url:ye,id:ae,groupId:ve,deliveryDirectives:Z||null})}}toggleTrackModes(Z){const{media:ee,trackId:ae}=this;if(!ee)return;const ve=filterSubtitleTracks(ee.textTracks),ye=ve.filter(Ke=>Ke.groupId===this.groupId);if(Z===-1)[].slice.call(ve).forEach(Ke=>{Ke.mode="disabled"});else{const Ke=ye[ae];Ke&&(Ke.mode="disabled")}const be=ye[Z];be&&(be.mode=this.subtitleDisplay?"showing":"hidden")}setSubtitleTrack(Z,ee){var ae;const ve=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=Z;return}if(this.trackId!==Z&&this.toggleTrackModes(Z),this.trackId===Z&&(Z===-1||(ae=ve[Z])!=null&&ae.details)||Z<-1||Z>=ve.length)return;this.clearTimer();const ye=ve[Z];if(this.log(`Switching to subtitle-track ${Z}`+(ye?` "${ye.name}" lang:${ye.lang} group:${ye.groupId}`:"")),this.trackId=Z,ye){const{id:be,groupId:Ke="",name:Ye,type:Xe,url:Qe}=ye;this.hls.trigger(Events.SUBTITLE_TRACK_SWITCH,{id:be,groupId:Ke,name:Ye,type:Xe,url:Qe});const et=this.switchParams(ye.url,ee==null?void 0:ee.details);this.loadPlaylist(et)}else this.hls.trigger(Events.SUBTITLE_TRACK_SWITCH,{id:Z})}onTextTracksChanged(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let Z=-1;const ee=filterSubtitleTracks(this.media.textTracks);for(let ae=0;ae<ee.length;ae++)if(ee[ae].mode==="hidden")Z=ae;else if(ee[ae].mode==="showing"){Z=ae;break}this.subtitleTrack!==Z&&(this.subtitleTrack=Z)}}function filterSubtitleTracks(ie){const Z=[];for(let ee=0;ee<ie.length;ee++){const ae=ie[ee];(ae.kind==="subtitles"||ae.kind==="captions")&&ae.label&&Z.push(ie[ee])}return Z}class BufferOperationQueue{constructor(Z){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=Z}append(Z,ee){const ae=this.queues[ee];ae.push(Z),ae.length===1&&this.buffers[ee]&&this.executeNext(ee)}insertAbort(Z,ee){this.queues[ee].unshift(Z),this.executeNext(ee)}appendBlocker(Z){let ee;const ae=new Promise(ye=>{ee=ye}),ve={execute:ee,onStart:()=>{},onComplete:()=>{},onError:()=>{}};return this.append(ve,Z),ae}executeNext(Z){const{buffers:ee,queues:ae}=this,ve=ee[Z],ye=ae[Z];if(ye.length){const be=ye[0];try{be.execute()}catch(Ke){logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),be.onError(Ke),ve!=null&&ve.updating||(ye.shift(),this.executeNext(Z))}}}shiftAndExecuteNext(Z){this.queues[Z].shift(),this.executeNext(Z)}current(Z){return this.queues[Z][0]}}const MediaSource=getMediaSource(),VIDEO_CODEC_PROFILE_REPACE=/([ha]vc.)(?:\.[^.,]+)+/;class BufferController{constructor(Z){this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=()=>{const{media:ee,mediaSource:ae}=this;logger.log("[buffer-controller]: Media source opened"),ee&&(ee.removeEventListener("emptied",this._onMediaEmptied),this.updateMediaElementDuration(),this.hls.trigger(Events.MEDIA_ATTACHED,{media:ee})),ae&&ae.removeEventListener("sourceopen",this._onMediaSourceOpen),this.checkPendingTracks()},this._onMediaSourceClose=()=>{logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=()=>{logger.log("[buffer-controller]: Media source ended")},this._onMediaEmptied=()=>{const{media:ee,_objectUrl:ae}=this;ee&&ee.src!==ae&&logger.error(`Media element src was set while attaching MediaSource (${ae} > ${ee.src})`)},this.hls=Z,this._initSourceBuffer(),this.registerListeners()}hasSourceTypes(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null}registerListeners(){const{hls:Z}=this;Z.on(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),Z.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),Z.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),Z.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),Z.on(Events.BUFFER_RESET,this.onBufferReset,this),Z.on(Events.BUFFER_APPENDING,this.onBufferAppending,this),Z.on(Events.BUFFER_CODECS,this.onBufferCodecs,this),Z.on(Events.BUFFER_EOS,this.onBufferEos,this),Z.on(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),Z.on(Events.LEVEL_UPDATED,this.onLevelUpdated,this),Z.on(Events.FRAG_PARSED,this.onFragParsed,this),Z.on(Events.FRAG_CHANGED,this.onFragChanged,this)}unregisterListeners(){const{hls:Z}=this;Z.off(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),Z.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),Z.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),Z.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),Z.off(Events.BUFFER_RESET,this.onBufferReset,this),Z.off(Events.BUFFER_APPENDING,this.onBufferAppending,this),Z.off(Events.BUFFER_CODECS,this.onBufferCodecs,this),Z.off(Events.BUFFER_EOS,this.onBufferEos,this),Z.off(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),Z.off(Events.LEVEL_UPDATED,this.onLevelUpdated,this),Z.off(Events.FRAG_PARSED,this.onFragParsed,this),Z.off(Events.FRAG_CHANGED,this.onFragChanged,this)}_initSourceBuffer(){this.sourceBuffer={},this.operationQueue=new BufferOperationQueue(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.lastMpegAudioChunk=null}onManifestLoading(){this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=0,this.details=null}onManifestParsed(Z,ee){let ae=2;(ee.audio&&!ee.video||!ee.altAudio)&&(ae=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=ae,logger.log(`${this.bufferCodecEventsExpected} bufferCodec event(s) expected`)}onMediaAttaching(Z,ee){const ae=this.media=ee.media;if(ae&&MediaSource){const ve=this.mediaSource=new MediaSource;ve.addEventListener("sourceopen",this._onMediaSourceOpen),ve.addEventListener("sourceended",this._onMediaSourceEnded),ve.addEventListener("sourceclose",this._onMediaSourceClose),ae.src=self.URL.createObjectURL(ve),this._objectUrl=ae.src,ae.addEventListener("emptied",this._onMediaEmptied)}}onMediaDetaching(){const{media:Z,mediaSource:ee,_objectUrl:ae}=this;if(ee){if(logger.log("[buffer-controller]: media source detaching"),ee.readyState==="open")try{ee.endOfStream()}catch(ve){logger.warn(`[buffer-controller]: onMediaDetaching: ${ve.message} while calling endOfStream`)}this.onBufferReset(),ee.removeEventListener("sourceopen",this._onMediaSourceOpen),ee.removeEventListener("sourceended",this._onMediaSourceEnded),ee.removeEventListener("sourceclose",this._onMediaSourceClose),Z&&(Z.removeEventListener("emptied",this._onMediaEmptied),ae&&self.URL.revokeObjectURL(ae),Z.src===ae?(Z.removeAttribute("src"),Z.load()):logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(Events.MEDIA_DETACHED,void 0)}onBufferReset(){this.getSourceBufferTypes().forEach(Z=>{const ee=this.sourceBuffer[Z];try{ee&&(this.removeBufferListeners(Z),this.mediaSource&&this.mediaSource.removeSourceBuffer(ee),this.sourceBuffer[Z]=void 0)}catch(ae){logger.warn(`[buffer-controller]: Failed to reset the ${Z} buffer`,ae)}}),this._initSourceBuffer()}onBufferCodecs(Z,ee){const ae=this.getSourceBufferTypes().length;Object.keys(ee).forEach(ve=>{if(ae){const ye=this.tracks[ve];if(ye&&typeof ye.buffer.changeType=="function"){const{id:be,codec:Ke,levelCodec:Ye,container:Xe,metadata:Qe}=ee[ve],et=(ye.levelCodec||ye.codec).replace(VIDEO_CODEC_PROFILE_REPACE,"$1"),Je=(Ye||Ke).replace(VIDEO_CODEC_PROFILE_REPACE,"$1");if(et!==Je){const rt=`${Xe};codecs=${Ye||Ke}`;this.appendChangeType(ve,rt),logger.log(`[buffer-controller]: switching codec ${et} to ${Je}`),this.tracks[ve]={buffer:ye.buffer,codec:Ke,container:Xe,levelCodec:Ye,metadata:Qe,id:be}}}}else this.pendingTracks[ve]=ee[ve]}),!ae&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())}appendChangeType(Z,ee){const{operationQueue:ae}=this,ve={execute:()=>{const ye=this.sourceBuffer[Z];ye&&(logger.log(`[buffer-controller]: changing ${Z} sourceBuffer type to ${ee}`),ye.changeType(ee)),ae.shiftAndExecuteNext(Z)},onStart:()=>{},onComplete:()=>{},onError:ye=>{logger.warn(`[buffer-controller]: Failed to change ${Z} SourceBuffer type`,ye)}};ae.append(ve,Z)}onBufferAppending(Z,ee){const{hls:ae,operationQueue:ve,tracks:ye}=this,{data:be,type:Ke,frag:Ye,part:Xe,chunkMeta:Qe}=ee,et=Qe.buffering[Ke],Je=self.performance.now();et.start=Je;const rt=Ye.stats.buffering,it=Xe?Xe.stats.buffering:null;rt.start===0&&(rt.start=Je),it&&it.start===0&&(it.start=Je);const nt=ye.audio;let tt=!1;Ke==="audio"&&(nt==null?void 0:nt.container)==="audio/mpeg"&&(tt=!this.lastMpegAudioChunk||Qe.id===1||this.lastMpegAudioChunk.sn!==Qe.sn,this.lastMpegAudioChunk=Qe);const st=Ye.start,ot={execute:()=>{if(et.executeStart=self.performance.now(),tt){const ut=this.sourceBuffer[Ke];if(ut){const ft=st-ut.timestampOffset;Math.abs(ft)>=.1&&(logger.log(`[buffer-controller]: Updating audio SourceBuffer timestampOffset to ${st} (delta: ${ft}) sn: ${Ye.sn})`),ut.timestampOffset=st)}}this.appendExecutor(be,Ke)},onStart:()=>{},onComplete:()=>{const ut=self.performance.now();et.executeEnd=et.end=ut,rt.first===0&&(rt.first=ut),it&&it.first===0&&(it.first=ut);const{sourceBuffer:ft}=this,pt={};for(const Xr in ft)pt[Xr]=BufferHelper.getBuffered(ft[Xr]);this.appendError=0,this.hls.trigger(Events.BUFFER_APPENDED,{type:Ke,frag:Ye,part:Xe,chunkMeta:Qe,parent:Ye.type,timeRanges:pt})},onError:ut=>{logger.error(`[buffer-controller]: Error encountered while trying to append to the ${Ke} SourceBuffer`,ut);const ft={type:ErrorTypes.MEDIA_ERROR,parent:Ye.type,details:ErrorDetails.BUFFER_APPEND_ERROR,frag:Ye,part:Xe,chunkMeta:Qe,error:ut,err:ut,fatal:!1};ut.code===DOMException.QUOTA_EXCEEDED_ERR?ft.details=ErrorDetails.BUFFER_FULL_ERROR:(this.appendError++,ft.details=ErrorDetails.BUFFER_APPEND_ERROR,this.appendError>ae.config.appendErrorMaxRetry&&(logger.error(`[buffer-controller]: Failed ${ae.config.appendErrorMaxRetry} times to append segment in sourceBuffer`),ft.fatal=!0)),ae.trigger(Events.ERROR,ft)}};ve.append(ot,Ke)}onBufferFlushing(Z,ee){const{operationQueue:ae}=this,ve=ye=>({execute:this.removeExecutor.bind(this,ye,ee.startOffset,ee.endOffset),onStart:()=>{},onComplete:()=>{this.hls.trigger(Events.BUFFER_FLUSHED,{type:ye})},onError:be=>{logger.warn(`[buffer-controller]: Failed to remove from ${ye} SourceBuffer`,be)}});ee.type?ae.append(ve(ee.type),ee.type):this.getSourceBufferTypes().forEach(ye=>{ae.append(ve(ye),ye)})}onFragParsed(Z,ee){const{frag:ae,part:ve}=ee,ye=[],be=ve?ve.elementaryStreams:ae.elementaryStreams;be[ElementaryStreamTypes.AUDIOVIDEO]?ye.push("audiovideo"):(be[ElementaryStreamTypes.AUDIO]&&ye.push("audio"),be[ElementaryStreamTypes.VIDEO]&&ye.push("video"));const Ke=()=>{const Ye=self.performance.now();ae.stats.buffering.end=Ye,ve&&(ve.stats.buffering.end=Ye);const Xe=ve?ve.stats:ae.stats;this.hls.trigger(Events.FRAG_BUFFERED,{frag:ae,part:ve,stats:Xe,id:ae.type})};ye.length===0&&logger.warn(`Fragments must have at least one ElementaryStreamType set. type: ${ae.type} level: ${ae.level} sn: ${ae.sn}`),this.blockBuffers(Ke,ye)}onFragChanged(Z,ee){this.flushBackBuffer()}onBufferEos(Z,ee){this.getSourceBufferTypes().reduce((ve,ye)=>{const be=this.sourceBuffer[ye];return be&&(!ee.type||ee.type===ye)&&(be.ending=!0,be.ended||(be.ended=!0,logger.log(`[buffer-controller]: ${ye} sourceBuffer now EOS`))),ve&&!!(!be||be.ended)},!0)&&(logger.log("[buffer-controller]: Queueing mediaSource.endOfStream()"),this.blockBuffers(()=>{this.getSourceBufferTypes().forEach(ye=>{const be=this.sourceBuffer[ye];be&&(be.ending=!1)});const{mediaSource:ve}=this;if(!ve||ve.readyState!=="open"){ve&&logger.info(`[buffer-controller]: Could not call mediaSource.endOfStream(). mediaSource.readyState: ${ve.readyState}`);return}logger.log("[buffer-controller]: Calling mediaSource.endOfStream()"),ve.endOfStream()}))}onLevelUpdated(Z,{details:ee}){ee.fragments.length&&(this.details=ee,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())}flushBackBuffer(){const{hls:Z,details:ee,media:ae,sourceBuffer:ve}=this;if(!ae||ee===null)return;const ye=this.getSourceBufferTypes();if(!ye.length)return;const be=ee.live&&Z.config.liveBackBufferLength!==null?Z.config.liveBackBufferLength:Z.config.backBufferLength;if(!isFiniteNumber(be)||be<0)return;const Ke=ae.currentTime,Ye=ee.levelTargetDuration,Xe=Math.max(be,Ye),Qe=Math.floor(Ke/Ye)*Ye-Xe;ye.forEach(et=>{const Je=ve[et];if(Je){const rt=BufferHelper.getBuffered(Je);if(rt.length>0&&Qe>rt.start(0)){if(Z.trigger(Events.BACK_BUFFER_REACHED,{bufferEnd:Qe}),ee.live)Z.trigger(Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:Qe});else if(Je.ended&&rt.end(rt.length-1)-Ke<Ye*2){logger.info(`[buffer-controller]: Cannot flush ${et} back buffer while SourceBuffer is in ended state`);return}Z.trigger(Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Qe,type:et})}}})}updateMediaElementDuration(){if(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")return;const{details:Z,hls:ee,media:ae,mediaSource:ve}=this,ye=Z.fragments[0].start+Z.totalduration,be=ae.duration,Ke=isFiniteNumber(ve.duration)?ve.duration:0;Z.live&&ee.config.liveDurationInfinity?(logger.log("[buffer-controller]: Media Source duration is set to Infinity"),ve.duration=1/0,this.updateSeekableRange(Z)):(ye>Ke&&ye>be||!isFiniteNumber(be))&&(logger.log(`[buffer-controller]: Updating Media Source duration to ${ye.toFixed(3)}`),ve.duration=ye)}updateSeekableRange(Z){const ee=this.mediaSource,ae=Z.fragments;if(ae.length&&Z.live&&ee!=null&&ee.setLiveSeekableRange){const ye=Math.max(0,ae[0].start),be=Math.max(ye,ye+Z.totalduration);ee.setLiveSeekableRange(ye,be)}}checkPendingTracks(){const{bufferCodecEventsExpected:Z,operationQueue:ee,pendingTracks:ae}=this,ve=Object.keys(ae).length;if(ve&&!Z||ve===2){this.createSourceBuffers(ae),this.pendingTracks={};const ye=this.getSourceBufferTypes();if(ye.length)this.hls.trigger(Events.BUFFER_CREATED,{tracks:this.tracks}),ye.forEach(be=>{ee.executeNext(be)});else{const be=new Error("could not create source buffer for media codec(s)");this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:be,reason:be.message})}}}createSourceBuffers(Z){const{sourceBuffer:ee,mediaSource:ae}=this;if(!ae)throw Error("createSourceBuffers called when mediaSource was null");for(const ve in Z)if(!ee[ve]){const ye=Z[ve];if(!ye)throw Error(`source buffer exists for track ${ve}, however track does not`);const be=ye.levelCodec||ye.codec,Ke=`${ye.container};codecs=${be}`;logger.log(`[buffer-controller]: creating sourceBuffer(${Ke})`);try{const Ye=ee[ve]=ae.addSourceBuffer(Ke),Xe=ve;this.addBufferListener(Xe,"updatestart",this._onSBUpdateStart),this.addBufferListener(Xe,"updateend",this._onSBUpdateEnd),this.addBufferListener(Xe,"error",this._onSBUpdateError),this.tracks[ve]={buffer:Ye,codec:be,container:ye.container,levelCodec:ye.levelCodec,metadata:ye.metadata,id:ye.id}}catch(Ye){logger.error(`[buffer-controller]: error while trying to add sourceBuffer: ${Ye.message}`),this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:Ye,mimeType:Ke})}}}_onSBUpdateStart(Z){const{operationQueue:ee}=this;ee.current(Z).onStart()}_onSBUpdateEnd(Z){const{operationQueue:ee}=this;ee.current(Z).onComplete(),ee.shiftAndExecuteNext(Z)}_onSBUpdateError(Z,ee){const ae=new Error(`${Z} SourceBuffer error`);logger.error(`[buffer-controller]: ${ae}`,ee),this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_APPENDING_ERROR,error:ae,fatal:!1});const ve=this.operationQueue.current(Z);ve&&ve.onError(ee)}removeExecutor(Z,ee,ae){const{media:ve,mediaSource:ye,operationQueue:be,sourceBuffer:Ke}=this,Ye=Ke[Z];if(!ve||!ye||!Ye){logger.warn(`[buffer-controller]: Attempting to remove from the ${Z} SourceBuffer, but it does not exist`),be.shiftAndExecuteNext(Z);return}const Xe=isFiniteNumber(ve.duration)?ve.duration:1/0,Qe=isFiniteNumber(ye.duration)?ye.duration:1/0,et=Math.max(0,ee),Je=Math.min(ae,Xe,Qe);Je>et&&!Ye.ending?(Ye.ended=!1,logger.log(`[buffer-controller]: Removing [${et},${Je}] from the ${Z} SourceBuffer`),Ye.remove(et,Je)):be.shiftAndExecuteNext(Z)}appendExecutor(Z,ee){const{operationQueue:ae,sourceBuffer:ve}=this,ye=ve[ee];if(!ye){logger.warn(`[buffer-controller]: Attempting to append to the ${ee} SourceBuffer, but it does not exist`),ae.shiftAndExecuteNext(ee);return}ye.ended=!1,ye.appendBuffer(Z)}blockBuffers(Z,ee=this.getSourceBufferTypes()){if(!ee.length){logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(Z);return}const{operationQueue:ae}=this,ve=ee.map(ye=>ae.appendBlocker(ye));Promise.all(ve).then(()=>{Z(),ee.forEach(ye=>{const be=this.sourceBuffer[ye];be!=null&&be.updating||ae.shiftAndExecuteNext(ye)})})}getSourceBufferTypes(){return Object.keys(this.sourceBuffer)}addBufferListener(Z,ee,ae){const ve=this.sourceBuffer[Z];if(!ve)return;const ye=ae.bind(this,Z);this.listeners[Z].push({event:ee,listener:ye}),ve.addEventListener(ee,ye)}removeBufferListeners(Z){const ee=this.sourceBuffer[Z];ee&&this.listeners[Z].forEach(ae=>{ee.removeEventListener(ae.event,ae.listener)})}}const specialCea608CharsCodes={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},getCharForByte=function(Z){let ee=Z;return specialCea608CharsCodes.hasOwnProperty(Z)&&(ee=specialCea608CharsCodes[Z]),String.fromCharCode(ee)},NR_ROWS=15,NR_COLS=100,rowsLowCh1={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},rowsHighCh1={17:2,18:4,21:6,22:8,23:10,19:13,20:15},rowsLowCh2={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},rowsHighCh2={25:2,26:4,29:6,30:8,31:10,27:13,28:15},backgroundColors=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class CaptionsLogger{constructor(){this.time=null,this.verboseLevel=0}log(Z,ee){if(this.verboseLevel>=Z){const ae=typeof ee=="function"?ee():ee;logger.log(`${this.time} [${Z}] ${ae}`)}}}const numArrayToHexArray=function(Z){const ee=[];for(let ae=0;ae<Z.length;ae++)ee.push(Z[ae].toString(16));return ee};class PenState{constructor(Z,ee,ae,ve,ye){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=Z||"white",this.underline=ee||!1,this.italics=ae||!1,this.background=ve||"black",this.flash=ye||!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(Z){const ee=["foreground","underline","italics","background","flash"];for(let ae=0;ae<ee.length;ae++){const ve=ee[ae];Z.hasOwnProperty(ve)&&(this[ve]=Z[ve])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(Z){return this.foreground===Z.foreground&&this.underline===Z.underline&&this.italics===Z.italics&&this.background===Z.background&&this.flash===Z.flash}copy(Z){this.foreground=Z.foreground,this.underline=Z.underline,this.italics=Z.italics,this.background=Z.background,this.flash=Z.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class StyledUnicodeChar{constructor(Z,ee,ae,ve,ye,be){this.uchar=void 0,this.penState=void 0,this.uchar=Z||" ",this.penState=new PenState(ee,ae,ve,ye,be)}reset(){this.uchar=" ",this.penState.reset()}setChar(Z,ee){this.uchar=Z,this.penState.copy(ee)}setPenState(Z){this.penState.copy(Z)}equals(Z){return this.uchar===Z.uchar&&this.penState.equals(Z.penState)}copy(Z){this.uchar=Z.uchar,this.penState.copy(Z.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class Row{constructor(Z){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(let ee=0;ee<NR_COLS;ee++)this.chars.push(new StyledUnicodeChar);this.logger=Z,this.pos=0,this.currPenState=new PenState}equals(Z){let ee=!0;for(let ae=0;ae<NR_COLS;ae++)if(!this.chars[ae].equals(Z.chars[ae])){ee=!1;break}return ee}copy(Z){for(let ee=0;ee<NR_COLS;ee++)this.chars[ee].copy(Z.chars[ee])}isEmpty(){let Z=!0;for(let ee=0;ee<NR_COLS;ee++)if(!this.chars[ee].isEmpty()){Z=!1;break}return Z}setCursor(Z){this.pos!==Z&&(this.pos=Z),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>NR_COLS&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=NR_COLS)}moveCursor(Z){const ee=this.pos+Z;if(Z>1)for(let ae=this.pos+1;ae<ee+1;ae++)this.chars[ae].setPenState(this.currPenState);this.setCursor(ee)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(Z){Z>=144&&this.backSpace();const ee=getCharForByte(Z);if(this.pos>=NR_COLS){this.logger.log(0,()=>"Cannot insert "+Z.toString(16)+" ("+ee+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(ee,this.currPenState),this.moveCursor(1)}clearFromPos(Z){let ee;for(ee=Z;ee<NR_COLS;ee++)this.chars[ee].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const Z=[];let ee=!0;for(let ae=0;ae<NR_COLS;ae++){const ve=this.chars[ae].uchar;ve!==" "&&(ee=!1),Z.push(ve)}return ee?"":Z.join("")}setPenStyles(Z){this.currPenState.setStyles(Z),this.chars[this.pos].setPenState(this.currPenState)}}class CaptionScreen{constructor(Z){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(let ee=0;ee<NR_ROWS;ee++)this.rows.push(new Row(Z));this.logger=Z,this.currRow=NR_ROWS-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}reset(){for(let Z=0;Z<NR_ROWS;Z++)this.rows[Z].clear();this.currRow=NR_ROWS-1}equals(Z){let ee=!0;for(let ae=0;ae<NR_ROWS;ae++)if(!this.rows[ae].equals(Z.rows[ae])){ee=!1;break}return ee}copy(Z){for(let ee=0;ee<NR_ROWS;ee++)this.rows[ee].copy(Z.rows[ee])}isEmpty(){let Z=!0;for(let ee=0;ee<NR_ROWS;ee++)if(!this.rows[ee].isEmpty()){Z=!1;break}return Z}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(Z){this.rows[this.currRow].insertChar(Z)}setPen(Z){this.rows[this.currRow].setPenStyles(Z)}moveCursor(Z){this.rows[this.currRow].moveCursor(Z)}setCursor(Z){this.logger.log(2,"setCursor: "+Z),this.rows[this.currRow].setCursor(Z)}setPAC(Z){this.logger.log(2,()=>"pacData = "+JSON.stringify(Z));let ee=Z.row-1;if(this.nrRollUpRows&&ee<this.nrRollUpRows-1&&(ee=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==ee){for(let Ke=0;Ke<NR_ROWS;Ke++)this.rows[Ke].clear();const ye=this.currRow+1-this.nrRollUpRows,be=this.lastOutputScreen;if(be){const Ke=be.rows[ye].cueStartTime,Ye=this.logger.time;if(Ke&&Ye!==null&&Ke<Ye)for(let Xe=0;Xe<this.nrRollUpRows;Xe++)this.rows[ee-this.nrRollUpRows+Xe+1].copy(be.rows[ye+Xe])}}this.currRow=ee;const ae=this.rows[this.currRow];if(Z.indent!==null){const ye=Z.indent,be=Math.max(ye-1,0);ae.setCursor(Z.indent),Z.color=ae.chars[be].penState.foreground}const ve={foreground:Z.color,underline:Z.underline,italics:Z.italics,background:"black",flash:!1};this.setPen(ve)}setBkgData(Z){this.logger.log(2,()=>"bkgData = "+JSON.stringify(Z)),this.backSpace(),this.setPen(Z),this.insertChar(32)}setRollUpRows(Z){this.nrRollUpRows=Z}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const Z=this.currRow+1-this.nrRollUpRows,ee=this.rows.splice(Z,1)[0];ee.clear(),this.rows.splice(this.currRow,0,ee),this.logger.log(2,"Rolling up")}getDisplayText(Z){Z=Z||!1;const ee=[];let ae="",ve=-1;for(let ye=0;ye<NR_ROWS;ye++){const be=this.rows[ye].getTextString();be&&(ve=ye+1,Z?ee.push("Row "+ve+": '"+be+"'"):ee.push(be.trim()))}return ee.length>0&&(Z?ae="["+ee.join(" | ")+"]":ae=ee.join(`
`)),ae}getTextAndFormat(){return this.rows}}class Cea608Channel{constructor(Z,ee,ae){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=Z,this.outputFilter=ee,this.mode=null,this.verbose=0,this.displayedMemory=new CaptionScreen(ae),this.nonDisplayedMemory=new CaptionScreen(ae),this.lastOutputScreen=new CaptionScreen(ae),this.currRollUpRow=this.displayedMemory.rows[NR_ROWS-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=ae}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[NR_ROWS-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(Z){this.outputFilter=Z}setPAC(Z){this.writeScreen.setPAC(Z)}setBkgData(Z){this.writeScreen.setBkgData(Z)}setMode(Z){Z!==this.mode&&(this.mode=Z,this.logger.log(2,()=>"MODE="+Z),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=Z)}insertChars(Z){for(let ae=0;ae<Z.length;ae++)this.writeScreen.insertChar(Z[ae]);const ee=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>ee+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(Z){this.logger.log(2,"RU("+Z+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(Z)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const Z=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=Z,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(Z){this.logger.log(2,"TO("+Z+") - Tab Offset"),this.writeScreen.moveCursor(Z)}ccMIDROW(Z){const ee={flash:!1};if(ee.underline=Z%2===1,ee.italics=Z>=46,ee.italics)ee.foreground="white";else{const ae=Math.floor(Z/2)-16,ve=["white","green","blue","cyan","red","yellow","magenta"];ee.foreground=ve[ae]}this.logger.log(2,"MIDROW: "+JSON.stringify(ee)),this.writeScreen.setPen(ee)}outputDataUpdate(Z=!1){const ee=this.logger.time;ee!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=ee:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,ee,this.lastOutputScreen),Z&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:ee),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(Z){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,Z,this.displayedMemory),this.cueStartTime=Z))}}class Cea608Parser{constructor(Z,ee,ae){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;const ve=new CaptionsLogger;this.channels=[null,new Cea608Channel(Z,ee,ve),new Cea608Channel(Z+1,ae,ve)],this.cmdHistory=createCmdHistory(),this.logger=ve}getHandler(Z){return this.channels[Z].getHandler()}setHandler(Z,ee){this.channels[Z].setHandler(ee)}addData(Z,ee){let ae,ve,ye,be=!1;this.logger.time=Z;for(let Ke=0;Ke<ee.length;Ke+=2)if(ve=ee[Ke]&127,ye=ee[Ke+1]&127,!(ve===0&&ye===0)){if(this.logger.log(3,"["+numArrayToHexArray([ee[Ke],ee[Ke+1]])+"] -> ("+numArrayToHexArray([ve,ye])+")"),ae=this.parseCmd(ve,ye),ae||(ae=this.parseMidrow(ve,ye)),ae||(ae=this.parsePAC(ve,ye)),ae||(ae=this.parseBackgroundAttributes(ve,ye)),!ae&&(be=this.parseChars(ve,ye),be)){const Ye=this.currentChannel;Ye&&Ye>0?this.channels[Ye].insertChars(be):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!ae&&!be&&this.logger.log(2,"Couldn't parse cleaned data "+numArrayToHexArray([ve,ye])+" orig: "+numArrayToHexArray([ee[Ke],ee[Ke+1]]))}}parseCmd(Z,ee){const{cmdHistory:ae}=this,ve=(Z===20||Z===28||Z===21||Z===29)&&ee>=32&&ee<=47,ye=(Z===23||Z===31)&&ee>=33&&ee<=35;if(!(ve||ye))return!1;if(hasCmdRepeated(Z,ee,ae))return setLastCmd(null,null,ae),this.logger.log(3,"Repeated command ("+numArrayToHexArray([Z,ee])+") is dropped"),!0;const be=Z===20||Z===21||Z===23?1:2,Ke=this.channels[be];return Z===20||Z===21||Z===28||Z===29?ee===32?Ke.ccRCL():ee===33?Ke.ccBS():ee===34?Ke.ccAOF():ee===35?Ke.ccAON():ee===36?Ke.ccDER():ee===37?Ke.ccRU(2):ee===38?Ke.ccRU(3):ee===39?Ke.ccRU(4):ee===40?Ke.ccFON():ee===41?Ke.ccRDC():ee===42?Ke.ccTR():ee===43?Ke.ccRTD():ee===44?Ke.ccEDM():ee===45?Ke.ccCR():ee===46?Ke.ccENM():ee===47&&Ke.ccEOC():Ke.ccTO(ee-32),setLastCmd(Z,ee,ae),this.currentChannel=be,!0}parseMidrow(Z,ee){let ae=0;if((Z===17||Z===25)&&ee>=32&&ee<=47){if(Z===17?ae=1:ae=2,ae!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const ve=this.channels[ae];return ve?(ve.ccMIDROW(ee),this.logger.log(3,"MIDROW ("+numArrayToHexArray([Z,ee])+")"),!0):!1}return!1}parsePAC(Z,ee){let ae;const ve=this.cmdHistory,ye=(Z>=17&&Z<=23||Z>=25&&Z<=31)&&ee>=64&&ee<=127,be=(Z===16||Z===24)&&ee>=64&&ee<=95;if(!(ye||be))return!1;if(hasCmdRepeated(Z,ee,ve))return setLastCmd(null,null,ve),!0;const Ke=Z<=23?1:2;ee>=64&&ee<=95?ae=Ke===1?rowsLowCh1[Z]:rowsLowCh2[Z]:ae=Ke===1?rowsHighCh1[Z]:rowsHighCh2[Z];const Ye=this.channels[Ke];return Ye?(Ye.setPAC(this.interpretPAC(ae,ee)),setLastCmd(Z,ee,ve),this.currentChannel=Ke,!0):!1}interpretPAC(Z,ee){let ae;const ve={color:null,italics:!1,indent:null,underline:!1,row:Z};return ee>95?ae=ee-96:ae=ee-64,ve.underline=(ae&1)===1,ae<=13?ve.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(ae/2)]:ae<=15?(ve.italics=!0,ve.color="white"):ve.indent=Math.floor((ae-16)/2)*4,ve}parseChars(Z,ee){let ae,ve=null,ye=null;if(Z>=25?(ae=2,ye=Z-8):(ae=1,ye=Z),ye>=17&&ye<=19){let be;ye===17?be=ee+80:ye===18?be=ee+112:be=ee+144,this.logger.log(2,"Special char '"+getCharForByte(be)+"' in channel "+ae),ve=[be]}else Z>=32&&Z<=127&&(ve=ee===0?[Z]:[Z,ee]);if(ve){const be=numArrayToHexArray(ve);this.logger.log(3,"Char codes =  "+be.join(",")),setLastCmd(Z,ee,this.cmdHistory)}return ve}parseBackgroundAttributes(Z,ee){const ae=(Z===16||Z===24)&&ee>=32&&ee<=47,ve=(Z===23||Z===31)&&ee>=45&&ee<=47;if(!(ae||ve))return!1;let ye;const be={};Z===16||Z===24?(ye=Math.floor((ee-32)/2),be.background=backgroundColors[ye],ee%2===1&&(be.background=be.background+"_semi")):ee===45?be.background="transparent":(be.foreground="black",ee===47&&(be.underline=!0));const Ke=Z<=23?1:2;return this.channels[Ke].setBkgData(be),setLastCmd(Z,ee,this.cmdHistory),!0}reset(){for(let Z=0;Z<Object.keys(this.channels).length;Z++){const ee=this.channels[Z];ee&&ee.reset()}this.cmdHistory=createCmdHistory()}cueSplitAtTime(Z){for(let ee=0;ee<this.channels.length;ee++){const ae=this.channels[ee];ae&&ae.cueSplitAtTime(Z)}}}function setLastCmd(ie,Z,ee){ee.a=ie,ee.b=Z}function hasCmdRepeated(ie,Z,ee){return ee.a===ie&&ee.b===Z}function createCmdHistory(){return{a:null,b:null}}class OutputFilter{constructor(Z,ee){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=Z,this.trackName=ee}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(Z,ee,ae){(this.startTime===null||this.startTime>Z)&&(this.startTime=Z),this.endTime=ee,this.screen=ae,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}var VTTCue=function(){if(typeof self<"u"&&self.VTTCue)return self.VTTCue;const ie=["","lr","rl"],Z=["start","middle","end","left","right"];function ee(Ke,Ye){if(typeof Ye!="string"||!Array.isArray(Ke))return!1;const Xe=Ye.toLowerCase();return~Ke.indexOf(Xe)?Xe:!1}function ae(Ke){return ee(ie,Ke)}function ve(Ke){return ee(Z,Ke)}function ye(Ke,...Ye){let Xe=1;for(;Xe<arguments.length;Xe++){const Qe=arguments[Xe];for(const et in Qe)Ke[et]=Qe[et]}return Ke}function be(Ke,Ye,Xe){const Qe=this,et={enumerable:!0};Qe.hasBeenReset=!1;let Je="",rt=!1,it=Ke,nt=Ye,tt=Xe,st=null,ot="",ut=!0,ft="auto",pt="start",Xr=50,mt="middle",Yr=50,ri="middle";Object.defineProperty(Qe,"id",ye({},et,{get:function(){return Je},set:function(Zr){Je=""+Zr}})),Object.defineProperty(Qe,"pauseOnExit",ye({},et,{get:function(){return rt},set:function(Zr){rt=!!Zr}})),Object.defineProperty(Qe,"startTime",ye({},et,{get:function(){return it},set:function(Zr){if(typeof Zr!="number")throw new TypeError("Start time must be set to a number.");it=Zr,this.hasBeenReset=!0}})),Object.defineProperty(Qe,"endTime",ye({},et,{get:function(){return nt},set:function(Zr){if(typeof Zr!="number")throw new TypeError("End time must be set to a number.");nt=Zr,this.hasBeenReset=!0}})),Object.defineProperty(Qe,"text",ye({},et,{get:function(){return tt},set:function(Zr){tt=""+Zr,this.hasBeenReset=!0}})),Object.defineProperty(Qe,"region",ye({},et,{get:function(){return st},set:function(Zr){st=Zr,this.hasBeenReset=!0}})),Object.defineProperty(Qe,"vertical",ye({},et,{get:function(){return ot},set:function(Zr){const _r=ae(Zr);if(_r===!1)throw new SyntaxError("An invalid or illegal string was specified.");ot=_r,this.hasBeenReset=!0}})),Object.defineProperty(Qe,"snapToLines",ye({},et,{get:function(){return ut},set:function(Zr){ut=!!Zr,this.hasBeenReset=!0}})),Object.defineProperty(Qe,"line",ye({},et,{get:function(){return ft},set:function(Zr){if(typeof Zr!="number"&&Zr!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");ft=Zr,this.hasBeenReset=!0}})),Object.defineProperty(Qe,"lineAlign",ye({},et,{get:function(){return pt},set:function(Zr){const _r=ve(Zr);if(!_r)throw new SyntaxError("An invalid or illegal string was specified.");pt=_r,this.hasBeenReset=!0}})),Object.defineProperty(Qe,"position",ye({},et,{get:function(){return Xr},set:function(Zr){if(Zr<0||Zr>100)throw new Error("Position must be between 0 and 100.");Xr=Zr,this.hasBeenReset=!0}})),Object.defineProperty(Qe,"positionAlign",ye({},et,{get:function(){return mt},set:function(Zr){const _r=ve(Zr);if(!_r)throw new SyntaxError("An invalid or illegal string was specified.");mt=_r,this.hasBeenReset=!0}})),Object.defineProperty(Qe,"size",ye({},et,{get:function(){return Yr},set:function(Zr){if(Zr<0||Zr>100)throw new Error("Size must be between 0 and 100.");Yr=Zr,this.hasBeenReset=!0}})),Object.defineProperty(Qe,"align",ye({},et,{get:function(){return ri},set:function(Zr){const _r=ve(Zr);if(!_r)throw new SyntaxError("An invalid or illegal string was specified.");ri=_r,this.hasBeenReset=!0}})),Qe.displayState=void 0}return be.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},be}();class StringDecoder{decode(Z,ee){if(!Z)return"";if(typeof Z!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(Z))}}function parseTimeStamp(ie){function Z(ae,ve,ye,be){return(ae|0)*3600+(ve|0)*60+(ye|0)+parseFloat(be||0)}const ee=ie.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return ee?parseFloat(ee[2])>59?Z(ee[2],ee[3],0,ee[4]):Z(ee[1],ee[2],ee[3],ee[4]):null}class Settings{constructor(){this.values=Object.create(null)}set(Z,ee){!this.get(Z)&&ee!==""&&(this.values[Z]=ee)}get(Z,ee,ae){return ae?this.has(Z)?this.values[Z]:ee[ae]:this.has(Z)?this.values[Z]:ee}has(Z){return Z in this.values}alt(Z,ee,ae){for(let ve=0;ve<ae.length;++ve)if(ee===ae[ve]){this.set(Z,ee);break}}integer(Z,ee){/^-?\d+$/.test(ee)&&this.set(Z,parseInt(ee,10))}percent(Z,ee){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(ee)){const ae=parseFloat(ee);if(ae>=0&&ae<=100)return this.set(Z,ae),!0}return!1}}function parseOptions(ie,Z,ee,ae){const ve=ae?ie.split(ae):[ie];for(const ye in ve){if(typeof ve[ye]!="string")continue;const be=ve[ye].split(ee);if(be.length!==2)continue;const Ke=be[0],Ye=be[1];Z(Ke,Ye)}}const defaults=new VTTCue(0,0,""),center=defaults.align==="middle"?"middle":"center";function parseCue$1(ie,Z,ee){const ae=ie;function ve(){const Ke=parseTimeStamp(ie);if(Ke===null)throw new Error("Malformed timestamp: "+ae);return ie=ie.replace(/^[^\sa-zA-Z-]+/,""),Ke}function ye(Ke,Ye){const Xe=new Settings;parseOptions(Ke,function(Je,rt){let it;switch(Je){case"region":for(let nt=ee.length-1;nt>=0;nt--)if(ee[nt].id===rt){Xe.set(Je,ee[nt].region);break}break;case"vertical":Xe.alt(Je,rt,["rl","lr"]);break;case"line":it=rt.split(","),Xe.integer(Je,it[0]),Xe.percent(Je,it[0])&&Xe.set("snapToLines",!1),Xe.alt(Je,it[0],["auto"]),it.length===2&&Xe.alt("lineAlign",it[1],["start",center,"end"]);break;case"position":it=rt.split(","),Xe.percent(Je,it[0]),it.length===2&&Xe.alt("positionAlign",it[1],["start",center,"end","line-left","line-right","auto"]);break;case"size":Xe.percent(Je,rt);break;case"align":Xe.alt(Je,rt,["start",center,"end","left","right"]);break}},/:/,/\s/),Ye.region=Xe.get("region",null),Ye.vertical=Xe.get("vertical","");let Qe=Xe.get("line","auto");Qe==="auto"&&defaults.line===-1&&(Qe=-1),Ye.line=Qe,Ye.lineAlign=Xe.get("lineAlign","start"),Ye.snapToLines=Xe.get("snapToLines",!0),Ye.size=Xe.get("size",100),Ye.align=Xe.get("align",center);let et=Xe.get("position","auto");et==="auto"&&defaults.position===50&&(et=Ye.align==="start"||Ye.align==="left"?0:Ye.align==="end"||Ye.align==="right"?100:50),Ye.position=et}function be(){ie=ie.replace(/^\s+/,"")}if(be(),Z.startTime=ve(),be(),ie.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+ae);ie=ie.slice(3),be(),Z.endTime=ve(),be(),ye(ie,Z)}function fixLineBreaks(ie){return ie.replace(/<br(?: \/)?>/gi,`
`)}class VTTParser{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new StringDecoder,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(Z){const ee=this;Z&&(ee.buffer+=ee.decoder.decode(Z,{stream:!0}));function ae(){let ye=ee.buffer,be=0;for(ye=fixLineBreaks(ye);be<ye.length&&ye[be]!=="\r"&&ye[be]!==`
`;)++be;const Ke=ye.slice(0,be);return ye[be]==="\r"&&++be,ye[be]===`
`&&++be,ee.buffer=ye.slice(be),Ke}function ve(ye){parseOptions(ye,function(be,Ke){},/:/)}try{let ye="";if(ee.state==="INITIAL"){if(!/\r\n|\n/.test(ee.buffer))return this;ye=ae();const Ke=ye.match(/^()?WEBVTT([ \t].*)?$/);if(!(Ke!=null&&Ke[0]))throw new Error("Malformed WebVTT signature.");ee.state="HEADER"}let be=!1;for(;ee.buffer;){if(!/\r\n|\n/.test(ee.buffer))return this;switch(be?be=!1:ye=ae(),ee.state){case"HEADER":/:/.test(ye)?ve(ye):ye||(ee.state="ID");continue;case"NOTE":ye||(ee.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(ye)){ee.state="NOTE";break}if(!ye)continue;if(ee.cue=new VTTCue(0,0,""),ee.state="CUE",ye.indexOf("-->")===-1){ee.cue.id=ye;continue}case"CUE":if(!ee.cue){ee.state="BADCUE";continue}try{parseCue$1(ye,ee.cue,ee.regionList)}catch{ee.cue=null,ee.state="BADCUE";continue}ee.state="CUETEXT";continue;case"CUETEXT":{const Ke=ye.indexOf("-->")!==-1;if(!ye||Ke&&(be=!0)){ee.oncue&&ee.cue&&ee.oncue(ee.cue),ee.cue=null,ee.state="ID";continue}if(ee.cue===null)continue;ee.cue.text&&(ee.cue.text+=`
`),ee.cue.text+=ye}continue;case"BADCUE":ye||(ee.state="ID")}}}catch{ee.state==="CUETEXT"&&ee.cue&&ee.oncue&&ee.oncue(ee.cue),ee.cue=null,ee.state=ee.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const Z=this;try{if((Z.cue||Z.state==="HEADER")&&(Z.buffer+=`

`,Z.parse()),Z.state==="INITIAL"||Z.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(ee){Z.onparsingerror&&Z.onparsingerror(ee)}return Z.onflush&&Z.onflush(),this}}const LINEBREAKS=/\r\n|\n\r|\n|\r/g,startsWith=function(Z,ee,ae=0){return Z.slice(ae,ae+ee.length)===ee},cueString2millis=function(Z){let ee=parseInt(Z.slice(-3));const ae=parseInt(Z.slice(-6,-4)),ve=parseInt(Z.slice(-9,-7)),ye=Z.length>9?parseInt(Z.substring(0,Z.indexOf(":"))):0;if(!isFiniteNumber(ee)||!isFiniteNumber(ae)||!isFiniteNumber(ve)||!isFiniteNumber(ye))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${Z}`);return ee+=1e3*ae,ee+=60*1e3*ve,ee+=60*60*1e3*ye,ee},hash=function(Z){let ee=5381,ae=Z.length;for(;ae;)ee=ee*33^Z.charCodeAt(--ae);return(ee>>>0).toString()};function generateCueId(ie,Z,ee){return hash(ie.toString())+hash(Z.toString())+hash(ee)}const calculateOffset=function(Z,ee,ae){let ve=Z[ee],ye=Z[ve.prevCC];if(!ye||!ye.new&&ve.new){Z.ccOffset=Z.presentationOffset=ve.start,ve.new=!1;return}for(;(be=ye)!=null&&be.new;){var be;Z.ccOffset+=ve.start-ye.start,ve.new=!1,ve=ye,ye=Z[ve.prevCC]}Z.presentationOffset=ae};function parseWebVTT(ie,Z,ee,ae,ve,ye,be){const Ke=new VTTParser,Ye=utf8ArrayToStr(new Uint8Array(ie)).trim().replace(LINEBREAKS,`
`).split(`
`),Xe=[],Qe=Z?toMpegTsClockFromTimescale(Z.baseTime,Z.timescale):0;let et="00:00.000",Je=0,rt=0,it,nt=!0;Ke.oncue=function(tt){const st=ee[ae];let ot=ee.ccOffset;const ut=(Je-Qe)/9e4;if(st!=null&&st.new&&(rt!==void 0?ot=ee.ccOffset=st.start:calculateOffset(ee,ae,ut)),ut){if(!Z){it=new Error("Missing initPTS for VTT MPEGTS");return}ot=ut-ee.presentationOffset}const ft=tt.endTime-tt.startTime,pt=normalizePts((tt.startTime+ot-rt)*9e4,ve*9e4)/9e4;tt.startTime=Math.max(pt,0),tt.endTime=Math.max(pt+ft,0);const Xr=tt.text.trim();tt.text=decodeURIComponent(encodeURIComponent(Xr)),tt.id||(tt.id=generateCueId(tt.startTime,tt.endTime,Xr)),tt.endTime>0&&Xe.push(tt)},Ke.onparsingerror=function(tt){it=tt},Ke.onflush=function(){if(it){be(it);return}ye(Xe)},Ye.forEach(tt=>{if(nt)if(startsWith(tt,"X-TIMESTAMP-MAP=")){nt=!1,tt.slice(16).split(",").forEach(st=>{startsWith(st,"LOCAL:")?et=st.slice(6):startsWith(st,"MPEGTS:")&&(Je=parseInt(st.slice(7)))});try{rt=cueString2millis(et)/1e3}catch(st){it=st}return}else tt===""&&(nt=!1);Ke.parse(tt+`
`)}),Ke.flush()}const IMSC1_CODEC="stpp.ttml.im1t",HMSF_REGEX=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,TIME_UNIT_REGEX=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,textAlignToLineAlign={left:"start",center:"center",right:"end",start:"start",end:"end"};function parseIMSC1(ie,Z,ee,ae){const ve=findBox(new Uint8Array(ie),["mdat"]);if(ve.length===0){ae(new Error("Could not parse IMSC1 mdat"));return}const ye=ve.map(Ke=>utf8ArrayToStr(Ke)),be=toTimescaleFromScale(Z.baseTime,1,Z.timescale);try{ye.forEach(Ke=>ee(parseTTML(Ke,be)))}catch(Ke){ae(Ke)}}function parseTTML(ie,Z){const ve=new DOMParser().parseFromString(ie,"text/xml").getElementsByTagName("tt")[0];if(!ve)throw new Error("Invalid ttml");const ye={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},be=Object.keys(ye).reduce((et,Je)=>(et[Je]=ve.getAttribute(`ttp:${Je}`)||ye[Je],et),{}),Ke=ve.getAttribute("xml:space")!=="preserve",Ye=collectionToDictionary(getElementCollection(ve,"styling","style")),Xe=collectionToDictionary(getElementCollection(ve,"layout","region")),Qe=getElementCollection(ve,"body","[begin]");return[].map.call(Qe,et=>{const Je=getTextContent(et,Ke);if(!Je||!et.hasAttribute("begin"))return null;const rt=parseTtmlTime(et.getAttribute("begin"),be),it=parseTtmlTime(et.getAttribute("dur"),be);let nt=parseTtmlTime(et.getAttribute("end"),be);if(rt===null)throw timestampParsingError(et);if(nt===null){if(it===null)throw timestampParsingError(et);nt=rt+it}const tt=new VTTCue(rt-Z,nt-Z,Je);tt.id=generateCueId(tt.startTime,tt.endTime,tt.text);const st=Xe[et.getAttribute("region")],ot=Ye[et.getAttribute("style")],ut=getTtmlStyles(st,ot,Ye),{textAlign:ft}=ut;if(ft){const pt=textAlignToLineAlign[ft];pt&&(tt.lineAlign=pt),tt.align=ft}return _extends(tt,ut),tt}).filter(et=>et!==null)}function getElementCollection(ie,Z,ee){const ae=ie.getElementsByTagName(Z)[0];return ae?[].slice.call(ae.querySelectorAll(ee)):[]}function collectionToDictionary(ie){return ie.reduce((Z,ee)=>{const ae=ee.getAttribute("xml:id");return ae&&(Z[ae]=ee),Z},{})}function getTextContent(ie,Z){return[].slice.call(ie.childNodes).reduce((ee,ae,ve)=>{var ye;return ae.nodeName==="br"&&ve?ee+`
`:(ye=ae.childNodes)!=null&&ye.length?getTextContent(ae,Z):Z?ee+ae.textContent.trim().replace(/\s+/g," "):ee+ae.textContent},"")}function getTtmlStyles(ie,Z,ee){const ae="http://www.w3.org/ns/ttml#styling";let ve=null;const ye=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],be=ie!=null&&ie.hasAttribute("style")?ie.getAttribute("style"):null;return be&&ee.hasOwnProperty(be)&&(ve=ee[be]),ye.reduce((Ke,Ye)=>{const Xe=getAttributeNS(Z,ae,Ye)||getAttributeNS(ie,ae,Ye)||getAttributeNS(ve,ae,Ye);return Xe&&(Ke[Ye]=Xe),Ke},{})}function getAttributeNS(ie,Z,ee){return ie&&ie.hasAttributeNS(Z,ee)?ie.getAttributeNS(Z,ee):null}function timestampParsingError(ie){return new Error(`Could not parse ttml timestamp ${ie}`)}function parseTtmlTime(ie,Z){if(!ie)return null;let ee=parseTimeStamp(ie);return ee===null&&(HMSF_REGEX.test(ie)?ee=parseHoursMinutesSecondsFrames(ie,Z):TIME_UNIT_REGEX.test(ie)&&(ee=parseTimeUnits(ie,Z))),ee}function parseHoursMinutesSecondsFrames(ie,Z){const ee=HMSF_REGEX.exec(ie),ae=(ee[4]|0)+(ee[5]|0)/Z.subFrameRate;return(ee[1]|0)*3600+(ee[2]|0)*60+(ee[3]|0)+ae/Z.frameRate}function parseTimeUnits(ie,Z){const ee=TIME_UNIT_REGEX.exec(ie),ae=Number(ee[1]);switch(ee[2]){case"h":return ae*3600;case"m":return ae*60;case"ms":return ae*1e3;case"f":return ae/Z.frameRate;case"t":return ae/Z.tickRate}return ae}class TimelineController{constructor(Z){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=newVTTCCs(),this.captionsProperties=void 0,this.hls=Z,this.config=Z.config,this.Cues=Z.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){const ee=new OutputFilter(this,"textTrack1"),ae=new OutputFilter(this,"textTrack2"),ve=new OutputFilter(this,"textTrack3"),ye=new OutputFilter(this,"textTrack4");this.cea608Parser1=new Cea608Parser(1,ee,ae),this.cea608Parser2=new Cea608Parser(3,ve,ye)}Z.on(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),Z.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),Z.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),Z.on(Events.MANIFEST_LOADED,this.onManifestLoaded,this),Z.on(Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),Z.on(Events.FRAG_LOADING,this.onFragLoading,this),Z.on(Events.FRAG_LOADED,this.onFragLoaded,this),Z.on(Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),Z.on(Events.FRAG_DECRYPTED,this.onFragDecrypted,this),Z.on(Events.INIT_PTS_FOUND,this.onInitPtsFound,this),Z.on(Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),Z.on(Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:Z}=this;Z.off(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),Z.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),Z.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),Z.off(Events.MANIFEST_LOADED,this.onManifestLoaded,this),Z.off(Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),Z.off(Events.FRAG_LOADING,this.onFragLoading,this),Z.off(Events.FRAG_LOADED,this.onFragLoaded,this),Z.off(Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),Z.off(Events.FRAG_DECRYPTED,this.onFragDecrypted,this),Z.off(Events.INIT_PTS_FOUND,this.onInitPtsFound,this),Z.off(Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),Z.off(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null}addCues(Z,ee,ae,ve,ye){let be=!1;for(let Ke=ye.length;Ke--;){const Ye=ye[Ke],Xe=intersection(Ye[0],Ye[1],ee,ae);if(Xe>=0&&(Ye[0]=Math.min(Ye[0],ee),Ye[1]=Math.max(Ye[1],ae),be=!0,Xe/(ae-ee)>.5))return}if(be||ye.push([ee,ae]),this.config.renderTextTracksNatively){const Ke=this.captionsTracks[Z];this.Cues.newCue(Ke,ee,ae,ve)}else{const Ke=this.Cues.newCue(null,ee,ae,ve);this.hls.trigger(Events.CUES_PARSED,{type:"captions",cues:Ke,track:Z})}}onInitPtsFound(Z,{frag:ee,id:ae,initPTS:ve,timescale:ye}){const{unparsedVttFrags:be}=this;ae==="main"&&(this.initPTS[ee.cc]={baseTime:ve,timescale:ye}),be.length&&(this.unparsedVttFrags=[],be.forEach(Ke=>{this.onFragLoaded(Events.FRAG_LOADED,Ke)}))}getExistingTrack(Z){const{media:ee}=this;if(ee)for(let ae=0;ae<ee.textTracks.length;ae++){const ve=ee.textTracks[ae];if(ve[Z])return ve}return null}createCaptionsTrack(Z){this.config.renderTextTracksNatively?this.createNativeTrack(Z):this.createNonNativeTrack(Z)}createNativeTrack(Z){if(this.captionsTracks[Z])return;const{captionsProperties:ee,captionsTracks:ae,media:ve}=this,{label:ye,languageCode:be}=ee[Z],Ke=this.getExistingTrack(Z);if(Ke)ae[Z]=Ke,clearCurrentCues(ae[Z]),sendAddTrackEvent(ae[Z],ve);else{const Ye=this.createTextTrack("captions",ye,be);Ye&&(Ye[Z]=!0,ae[Z]=Ye)}}createNonNativeTrack(Z){if(this.nonNativeCaptionsTracks[Z])return;const ee=this.captionsProperties[Z];if(!ee)return;const ae=ee.label,ve={_id:Z,label:ae,kind:"captions",default:ee.media?!!ee.media.default:!1,closedCaptions:ee.media};this.nonNativeCaptionsTracks[Z]=ve,this.hls.trigger(Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[ve]})}createTextTrack(Z,ee,ae){const ve=this.media;if(ve)return ve.addTextTrack(Z,ee,ae)}onMediaAttaching(Z,ee){this.media=ee.media,this._cleanTracks()}onMediaDetaching(){const{captionsTracks:Z}=this;Object.keys(Z).forEach(ee=>{clearCurrentCues(Z[ee]),delete Z[ee]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=newVTTCCs(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:Z}=this;if(!Z)return;const ee=Z.textTracks;if(ee)for(let ae=0;ae<ee.length;ae++)clearCurrentCues(ee[ae])}onSubtitleTracksUpdated(Z,ee){const ae=ee.subtitleTracks||[],ve=ae.some(ye=>ye.textCodec===IMSC1_CODEC);if(this.config.enableWebVTT||ve&&this.config.enableIMSC1){if(subtitleOptionsIdentical(this.tracks,ae)){this.tracks=ae;return}if(this.textTracks=[],this.tracks=ae,this.config.renderTextTracksNatively){const be=this.media?this.media.textTracks:null;this.tracks.forEach((Ke,Ye)=>{let Xe;if(be&&Ye<be.length){let Qe=null;for(let et=0;et<be.length;et++)if(canReuseVttTextTrack(be[et],Ke)){Qe=be[et];break}Qe&&(Xe=Qe)}if(Xe)clearCurrentCues(Xe);else{const Qe=this._captionsOrSubtitlesFromCharacteristics(Ke);Xe=this.createTextTrack(Qe,Ke.name,Ke.lang),Xe&&(Xe.mode="disabled")}Xe&&(Xe.groupId=Ke.groupId,this.textTracks.push(Xe))})}else if(this.tracks.length){const be=this.tracks.map(Ke=>({label:Ke.name,kind:Ke.type.toLowerCase(),default:Ke.default,subtitleTrack:Ke}));this.hls.trigger(Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:be})}}}_captionsOrSubtitlesFromCharacteristics(Z){if(Z.attrs.CHARACTERISTICS){const ee=/transcribes-spoken-dialog/gi.test(Z.attrs.CHARACTERISTICS),ae=/describes-music-and-sound/gi.test(Z.attrs.CHARACTERISTICS);if(ee&&ae)return"captions"}return"subtitles"}onManifestLoaded(Z,ee){this.config.enableCEA708Captions&&ee.captions&&ee.captions.forEach(ae=>{const ve=/(?:CC|SERVICE)([1-4])/.exec(ae.instreamId);if(!ve)return;const ye=`textTrack${ve[1]}`,be=this.captionsProperties[ye];be&&(be.label=ae.name,ae.lang&&(be.languageCode=ae.lang),be.media=ae)})}closedCaptionsForLevel(Z){const ee=this.hls.levels[Z.level];return ee==null?void 0:ee.attrs["CLOSED-CAPTIONS"]}onFragLoading(Z,ee){const{cea608Parser1:ae,cea608Parser2:ve,lastSn:ye,lastPartIndex:be}=this;if(!(!this.enabled||!(ae&&ve))&&ee.frag.type===PlaylistLevelType.MAIN){var Ke,Ye;const Xe=ee.frag.sn,Qe=(Ke=ee==null||(Ye=ee.part)==null?void 0:Ye.index)!=null?Ke:-1;Xe===ye+1||Xe===ye&&Qe===be+1||(ae.reset(),ve.reset()),this.lastSn=Xe,this.lastPartIndex=Qe}}onFragLoaded(Z,ee){const{frag:ae,payload:ve}=ee;if(ae.type===PlaylistLevelType.SUBTITLE)if(ve.byteLength){const ye=ae.decryptdata,be="stats"in ee;if(ye==null||!ye.encrypted||be){const Ke=this.tracks[ae.level],Ye=this.vttCCs;Ye[ae.cc]||(Ye[ae.cc]={start:ae.start,prevCC:this.prevCC,new:!0},this.prevCC=ae.cc),Ke&&Ke.textCodec===IMSC1_CODEC?this._parseIMSC1(ae,ve):this._parseVTTs(ee)}}else this.hls.trigger(Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:ae,error:new Error("Empty subtitle payload")})}_parseIMSC1(Z,ee){const ae=this.hls;parseIMSC1(ee,this.initPTS[Z.cc],ve=>{this._appendCues(ve,Z.level),ae.trigger(Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:Z})},ve=>{logger.log(`Failed to parse IMSC1: ${ve}`),ae.trigger(Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:Z,error:ve})})}_parseVTTs(Z){var ee;const{frag:ae,payload:ve}=Z,{initPTS:ye,unparsedVttFrags:be}=this,Ke=ye.length-1;if(!ye[ae.cc]&&Ke===-1){be.push(Z);return}const Ye=this.hls,Xe=(ee=ae.initSegment)!=null&&ee.data?appendUint8Array(ae.initSegment.data,new Uint8Array(ve)):ve;parseWebVTT(Xe,this.initPTS[ae.cc],this.vttCCs,ae.cc,ae.start,Qe=>{this._appendCues(Qe,ae.level),Ye.trigger(Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:ae})},Qe=>{const et=Qe.message==="Missing initPTS for VTT MPEGTS";et?be.push(Z):this._fallbackToIMSC1(ae,ve),logger.log(`Failed to parse VTT cue: ${Qe}`),!(et&&Ke>ae.cc)&&Ye.trigger(Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:ae,error:Qe})})}_fallbackToIMSC1(Z,ee){const ae=this.tracks[Z.level];ae.textCodec||parseIMSC1(ee,this.initPTS[Z.cc],()=>{ae.textCodec=IMSC1_CODEC,this._parseIMSC1(Z,ee)},()=>{ae.textCodec="wvtt"})}_appendCues(Z,ee){const ae=this.hls;if(this.config.renderTextTracksNatively){const ve=this.textTracks[ee];if(!ve||ve.mode==="disabled")return;Z.forEach(ye=>addCueToTrack(ve,ye))}else{const ve=this.tracks[ee];if(!ve)return;const ye=ve.default?"default":"subtitles"+ee;ae.trigger(Events.CUES_PARSED,{type:"subtitles",cues:Z,track:ye})}}onFragDecrypted(Z,ee){const{frag:ae}=ee;ae.type===PlaylistLevelType.SUBTITLE&&this.onFragLoaded(Events.FRAG_LOADED,ee)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(Z,ee){const{cea608Parser1:ae,cea608Parser2:ve}=this;if(!this.enabled||!(ae&&ve))return;const{frag:ye,samples:be}=ee;if(!(ye.type===PlaylistLevelType.MAIN&&this.closedCaptionsForLevel(ye)==="NONE"))for(let Ke=0;Ke<be.length;Ke++){const Ye=be[Ke].bytes;if(Ye){const Xe=this.extractCea608Data(Ye);ae.addData(be[Ke].pts,Xe[0]),ve.addData(be[Ke].pts,Xe[1])}}}onBufferFlushing(Z,{startOffset:ee,endOffset:ae,endOffsetSubtitles:ve,type:ye}){const{media:be}=this;if(!(!be||be.currentTime<ae)){if(!ye||ye==="video"){const{captionsTracks:Ke}=this;Object.keys(Ke).forEach(Ye=>removeCuesInRange(Ke[Ye],ee,ae))}if(this.config.renderTextTracksNatively&&ee===0&&ve!==void 0){const{textTracks:Ke}=this;Object.keys(Ke).forEach(Ye=>removeCuesInRange(Ke[Ye],ee,ve))}}}extractCea608Data(Z){const ee=[[],[]],ae=Z[0]&31;let ve=2;for(let ye=0;ye<ae;ye++){const be=Z[ve++],Ke=127&Z[ve++],Ye=127&Z[ve++];if(Ke===0&&Ye===0)continue;if((4&be)!==0){const Qe=3&be;(Qe===0||Qe===1)&&(ee[Qe].push(Ke),ee[Qe].push(Ye))}}return ee}}function canReuseVttTextTrack(ie,Z){return!!ie&&ie.label===Z.name&&!(ie.textTrack1||ie.textTrack2)}function intersection(ie,Z,ee,ae){return Math.min(Z,ae)-Math.max(ie,ee)}function newVTTCCs(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}class CapLevelController{constructor(Z){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=Z,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(Z){this.streamController=Z}destroy(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:Z}=this;Z.on(Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),Z.on(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),Z.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),Z.on(Events.BUFFER_CODECS,this.onBufferCodecs,this),Z.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:Z}=this;Z.off(Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),Z.off(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),Z.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),Z.off(Events.BUFFER_CODECS,this.onBufferCodecs,this),Z.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(Z,ee){const ae=this.hls.levels[ee.droppedLevel];this.isLevelAllowed(ae)&&this.restrictedLevels.push({bitrate:ae.bitrate,height:ae.height,width:ae.width})}onMediaAttaching(Z,ee){this.media=ee.media instanceof HTMLVideoElement?ee.media:null,this.clientRect=null}onManifestParsed(Z,ee){const ae=this.hls;this.restrictedLevels=[],this.firstLevel=ee.firstLevel,ae.config.capLevelToPlayerSize&&ee.video&&this.startCapping()}onBufferCodecs(Z,ee){this.hls.config.capLevelToPlayerSize&&ee.video&&this.startCapping()}onMediaDetaching(){this.stopCapping()}detectPlayerSize(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){const Z=this.hls.levels;if(Z.length){const ee=this.hls;ee.autoLevelCapping=this.getMaxLevel(Z.length-1),ee.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=ee.autoLevelCapping}}}getMaxLevel(Z){const ee=this.hls.levels;if(!ee.length)return-1;const ae=ee.filter((ve,ye)=>this.isLevelAllowed(ve)&&ye<=Z);return this.clientRect=null,CapLevelController.getMaxLevelByMediaSize(ae,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const Z=this.media,ee={width:0,height:0};if(Z){const ae=Z.getBoundingClientRect();ee.width=ae.width,ee.height=ae.height,!ee.width&&!ee.height&&(ee.width=ae.right-ae.left||Z.width||0,ee.height=ae.bottom-ae.top||Z.height||0)}return this.clientRect=ee,ee}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let Z=1;if(!this.hls.config.ignoreDevicePixelRatio)try{Z=self.devicePixelRatio}catch{}return Z}isLevelAllowed(Z){return!this.restrictedLevels.some(ae=>Z.bitrate===ae.bitrate&&Z.width===ae.width&&Z.height===ae.height)}static getMaxLevelByMediaSize(Z,ee,ae){if(!(Z!=null&&Z.length))return-1;const ve=(be,Ke)=>Ke?be.width!==Ke.width||be.height!==Ke.height:!0;let ye=Z.length-1;for(let be=0;be<Z.length;be+=1){const Ke=Z[be];if((Ke.width>=ee||Ke.height>=ae)&&ve(Ke,Z[be+1])){ye=be;break}}return ye}}class FPSController{constructor(Z){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=Z,this.registerListeners()}setStreamController(Z){this.streamController=Z}registerListeners(){this.hls.on(Events.MEDIA_ATTACHING,this.onMediaAttaching,this)}unregisterListeners(){this.hls.off(Events.MEDIA_ATTACHING,this.onMediaAttaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(Z,ee){const ae=this.hls.config;if(ae.capLevelOnFPSDrop){const ve=ee.media instanceof self.HTMLVideoElement?ee.media:null;this.media=ve,ve&&typeof ve.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),ae.fpsDroppedMonitoringPeriod)}}checkFPS(Z,ee,ae){const ve=performance.now();if(ee){if(this.lastTime){const ye=ve-this.lastTime,be=ae-this.lastDroppedFrames,Ke=ee-this.lastDecodedFrames,Ye=1e3*be/ye,Xe=this.hls;if(Xe.trigger(Events.FPS_DROP,{currentDropped:be,currentDecoded:Ke,totalDroppedFrames:ae}),Ye>0&&be>Xe.config.fpsDroppedMonitoringThreshold*Ke){let Qe=Xe.currentLevel;logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+Qe),Qe>0&&(Xe.autoLevelCapping===-1||Xe.autoLevelCapping>=Qe)&&(Qe=Qe-1,Xe.trigger(Events.FPS_DROP_LEVEL_CAPPING,{level:Qe,droppedLevel:Xe.currentLevel}),Xe.autoLevelCapping=Qe,this.streamController.nextLevelSwitch())}}this.lastTime=ve,this.lastDroppedFrames=ae,this.lastDecodedFrames=ee}}checkFPSInterval(){const Z=this.media;if(Z)if(this.isVideoPlaybackQualityAvailable){const ee=Z.getVideoPlaybackQuality();this.checkFPS(Z,ee.totalVideoFrames,ee.droppedVideoFrames)}else this.checkFPS(Z,Z.webkitDecodedFrameCount,Z.webkitDroppedFrameCount)}}const LOGGER_PREFIX="[eme]";class EMEController{constructor(Z){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=EMEController.CDMCleanupPromise?[EMEController.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=logger.debug.bind(logger,LOGGER_PREFIX),this.log=logger.log.bind(logger,LOGGER_PREFIX),this.warn=logger.warn.bind(logger,LOGGER_PREFIX),this.error=logger.error.bind(logger,LOGGER_PREFIX),this.hls=Z,this.config=Z.config,this.registerListeners()}destroy(){this.unregisterListeners(),this.onMediaDetached();const Z=this.config;Z.requestMediaKeySystemAccessFunc=null,Z.licenseXhrSetup=Z.licenseResponseCallback=void 0,Z.drmSystems=Z.drmSystemOptions={},this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null,this.config=null}registerListeners(){this.hls.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(Events.MANIFEST_LOADED,this.onManifestLoaded,this)}unregisterListeners(){this.hls.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(Events.MANIFEST_LOADED,this.onManifestLoaded,this)}getLicenseServerUrl(Z){const{drmSystems:ee,widevineLicenseUrl:ae}=this.config,ve=ee[Z];if(ve)return ve.licenseUrl;if(Z===KeySystems.WIDEVINE&&ae)return ae;throw new Error(`no license server URL configured for key-system "${Z}"`)}getServerCertificateUrl(Z){const{drmSystems:ee}=this.config,ae=ee[Z];if(ae)return ae.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${Z}"]`)}attemptKeySystemAccess(Z){const ee=this.hls.levels,ae=(be,Ke,Ye)=>!!be&&Ye.indexOf(be)===Ke,ve=ee.map(be=>be.audioCodec).filter(ae),ye=ee.map(be=>be.videoCodec).filter(ae);return ve.length+ye.length===0&&ye.push("avc1.42e01e"),new Promise((be,Ke)=>{const Ye=Xe=>{const Qe=Xe.shift();this.getMediaKeysPromise(Qe,ve,ye).then(et=>be({keySystem:Qe,mediaKeys:et})).catch(et=>{Xe.length?Ye(Xe):et instanceof EMEKeyError?Ke(et):Ke(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_NO_ACCESS,error:et,fatal:!0},et.message))})};Ye(Z)})}requestMediaKeySystemAccess(Z,ee){const{requestMediaKeySystemAccessFunc:ae}=this.config;if(typeof ae!="function"){let ve=`Configured requestMediaKeySystemAccess is not a function ${ae}`;return requestMediaKeySystemAccess===null&&self.location.protocol==="http:"&&(ve=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(ve))}return ae(Z,ee)}getMediaKeysPromise(Z,ee,ae){const ve=getSupportedMediaKeySystemConfigurations(Z,ee,ae,this.config.drmSystemOptions),ye=this.keySystemAccessPromises[Z];let be=ye==null?void 0:ye.keySystemAccess;if(!be){this.log(`Requesting encrypted media "${Z}" key-system access with config: ${JSON.stringify(ve)}`),be=this.requestMediaKeySystemAccess(Z,ve);const Ke=this.keySystemAccessPromises[Z]={keySystemAccess:be};return be.catch(Ye=>{this.log(`Failed to obtain access to key-system "${Z}": ${Ye}`)}),be.then(Ye=>{this.log(`Access for key-system "${Ye.keySystem}" obtained`);const Xe=this.fetchServerCertificate(Z);return this.log(`Create media-keys for "${Z}"`),Ke.mediaKeys=Ye.createMediaKeys().then(Qe=>(this.log(`Media-keys created for "${Z}"`),Xe.then(et=>et?this.setMediaKeysServerCertificate(Qe,Z,et):Qe))),Ke.mediaKeys.catch(Qe=>{this.error(`Failed to create media-keys for "${Z}"}: ${Qe}`)}),Ke.mediaKeys})}return be.then(()=>ye.mediaKeys)}createMediaKeySessionContext({decryptdata:Z,keySystem:ee,mediaKeys:ae}){this.log(`Creating key-system session "${ee}" keyId: ${Hex.hexDump(Z.keyId||[])}`);const ve=ae.createSession(),ye={decryptdata:Z,keySystem:ee,mediaKeys:ae,mediaKeysSession:ve,keyStatus:"status-pending"};return this.mediaKeySessions.push(ye),ye}renewKeySession(Z){const ee=Z.decryptdata;if(ee.pssh){const ae=this.createMediaKeySessionContext(Z),ve=this.getKeyIdString(ee),ye="cenc";this.keyIdToKeySessionPromise[ve]=this.generateRequestWithPreferredKeySession(ae,ye,ee.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(Z)}getKeyIdString(Z){if(!Z)throw new Error("Could not read keyId of undefined decryptdata");if(Z.keyId===null)throw new Error("keyId is null");return Hex.hexDump(Z.keyId)}updateKeySession(Z,ee){var ae;const ve=Z.mediaKeysSession;return this.log(`Updating key-session "${ve.sessionId}" for keyID ${Hex.hexDump(((ae=Z.decryptdata)==null?void 0:ae.keyId)||[])}
      } (data length: ${ee&&ee.byteLength})`),ve.update(ee)}selectKeySystemFormat(Z){const ee=Object.keys(Z.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${Z.sn} ${Z.type}: ${Z.level}) key formats ${ee.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(ee)),this.keyFormatPromise}getKeyFormatPromise(Z){return new Promise((ee,ae)=>{const ve=getKeySystemsForConfig(this.config),ye=Z.map(keySystemFormatToKeySystemDomain).filter(be=>!!be&&ve.indexOf(be)!==-1);return this.getKeySystemSelectionPromise(ye).then(({keySystem:be})=>{const Ke=keySystemDomainToKeySystemFormat(be);Ke?ee(Ke):ae(new Error(`Unable to find format for key-system "${be}"`))}).catch(ae)})}loadKey(Z){const ee=Z.keyInfo.decryptdata,ae=this.getKeyIdString(ee),ve=`(keyId: ${ae} format: "${ee.keyFormat}" method: ${ee.method} uri: ${ee.uri})`;this.log(`Starting session for key ${ve}`);let ye=this.keyIdToKeySessionPromise[ae];return ye||(ye=this.keyIdToKeySessionPromise[ae]=this.getKeySystemForKeyPromise(ee).then(({keySystem:be,mediaKeys:Ke})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${Z.frag.sn} ${Z.frag.type}: ${Z.frag.level} using key ${ve}`),this.attemptSetMediaKeys(be,Ke).then(()=>{this.throwIfDestroyed();const Ye=this.createMediaKeySessionContext({keySystem:be,mediaKeys:Ke,decryptdata:ee}),Xe="cenc";return this.generateRequestWithPreferredKeySession(Ye,Xe,ee.pssh,"playlist-key")}))),ye.catch(be=>this.handleError(be))),ye}throwIfDestroyed(Z="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(Z){this.hls&&(this.error(Z.message),Z instanceof EMEKeyError?this.hls.trigger(Events.ERROR,Z.data):this.hls.trigger(Events.ERROR,{type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_NO_KEYS,error:Z,fatal:!0}))}getKeySystemForKeyPromise(Z){const ee=this.getKeyIdString(Z),ae=this.keyIdToKeySessionPromise[ee];if(!ae){const ve=keySystemFormatToKeySystemDomain(Z.keyFormat),ye=ve?[ve]:getKeySystemsForConfig(this.config);return this.attemptKeySystemAccess(ye)}return ae}getKeySystemSelectionPromise(Z){if(Z.length||(Z=getKeySystemsForConfig(this.config)),Z.length===0)throw new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${JSON.stringify({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(Z)}_onMediaEncrypted(Z){const{initDataType:ee,initData:ae}=Z;if(this.debug(`"${Z.type}" event: init data type: "${ee}"`),ae===null)return;let ve,ye;if(ee==="sinf"&&this.config.drmSystems[KeySystems.FAIRPLAY]){const Qe=bin2str(new Uint8Array(ae));try{const et=base64Decode(JSON.parse(Qe).sinf),Je=parseSinf(new Uint8Array(et));if(!Je)return;ve=Je.subarray(8,24),ye=KeySystems.FAIRPLAY}catch{this.warn('Failed to parse sinf "encrypted" event message initData');return}}else{const Qe=parsePssh(ae);if(Qe===null)return;Qe.version===0&&Qe.systemId===KeySystemIds.WIDEVINE&&Qe.data&&(ve=Qe.data.subarray(8,24)),ye=keySystemIdToKeySystemDomain(Qe.systemId)}if(!ye||!ve)return;const be=Hex.hexDump(ve),{keyIdToKeySessionPromise:Ke,mediaKeySessions:Ye}=this;let Xe=Ke[be];for(let Qe=0;Qe<Ye.length;Qe++){const et=Ye[Qe],Je=et.decryptdata;if(Je.pssh||!Je.keyId)continue;const rt=Hex.hexDump(Je.keyId);if(be===rt||Je.uri.replace(/-/g,"").indexOf(be)!==-1){Xe=Ke[rt],delete Ke[rt],Je.pssh=new Uint8Array(ae),Je.keyId=ve,Xe=Ke[be]=Xe.then(()=>this.generateRequestWithPreferredKeySession(et,ee,ae,"encrypted-event-key-match"));break}}Xe||(Xe=Ke[be]=this.getKeySystemSelectionPromise([ye]).then(({keySystem:Qe,mediaKeys:et})=>{var Je;this.throwIfDestroyed();const rt=new LevelKey("ISO-23001-7",be,(Je=keySystemDomainToKeySystemFormat(Qe))!=null?Je:"");return rt.pssh=new Uint8Array(ae),rt.keyId=ve,this.attemptSetMediaKeys(Qe,et).then(()=>{this.throwIfDestroyed();const it=this.createMediaKeySessionContext({decryptdata:rt,keySystem:Qe,mediaKeys:et});return this.generateRequestWithPreferredKeySession(it,ee,ae,"encrypted-event-no-match")})})),Xe.catch(Qe=>this.handleError(Qe))}_onWaitingForKey(Z){this.log(`"${Z.type}" event`)}attemptSetMediaKeys(Z,ee){const ae=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${Z}"`);const ve=Promise.all(ae).then(()=>{if(!this.media)throw new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(ee)});return this.setMediaKeysQueue.push(ve),ve.then(()=>{this.log(`Media-keys set for "${Z}"`),ae.push(ve),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(ye=>ae.indexOf(ye)===-1)})}generateRequestWithPreferredKeySession(Z,ee,ae,ve){var ye,be;const Ke=(ye=this.config.drmSystems)==null||(be=ye[Z.keySystem])==null?void 0:be.generateRequest;if(Ke)try{const Je=Ke.call(this.hls,ee,ae,Z);if(!Je)throw new Error("Invalid response from configured generateRequest filter");ee=Je.initDataType,ae=Z.decryptdata.pssh=Je.initData?new Uint8Array(Je.initData):null}catch(Je){var Ye;if(this.warn(Je.message),(Ye=this.hls)!=null&&Ye.config.debug)throw Je}if(ae===null)return this.log(`Skipping key-session request for "${ve}" (no initData)`),Promise.resolve(Z);const Xe=this.getKeyIdString(Z.decryptdata);this.log(`Generating key-session request for "${ve}": ${Xe} (init data type: ${ee} length: ${ae?ae.byteLength:null})`);const Qe=new EventEmitter;Z.mediaKeysSession.onmessage=Je=>{const rt=Z.mediaKeysSession;if(!rt){Qe.emit("error",new Error("invalid state"));return}const{messageType:it,message:nt}=Je;this.log(`"${it}" message event for session "${rt.sessionId}" message size: ${nt.byteLength}`),it==="license-request"||it==="license-renewal"?this.renewLicense(Z,nt).catch(tt=>{this.handleError(tt),Qe.emit("error",tt)}):it==="license-release"?Z.keySystem===KeySystems.FAIRPLAY&&(this.updateKeySession(Z,strToUtf8array("acknowledged")),this.removeSession(Z)):this.warn(`unhandled media key message type "${it}"`)},Z.mediaKeysSession.onkeystatuseschange=Je=>{if(!Z.mediaKeysSession){Qe.emit("error",new Error("invalid state"));return}this.onKeyStatusChange(Z);const it=Z.keyStatus;Qe.emit("keyStatus",it),it==="expired"&&(this.warn(`${Z.keySystem} expired for key ${Xe}`),this.renewKeySession(Z))};const et=new Promise((Je,rt)=>{Qe.on("error",rt),Qe.on("keyStatus",it=>{it.startsWith("usable")?Je():it==="output-restricted"?rt(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):it==="internal-error"?rt(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${it}"`)):it==="expired"?rt(new Error("key expired while generating request")):this.warn(`unhandled key status change "${it}"`)})});return Z.mediaKeysSession.generateRequest(ee,ae).then(()=>{var Je;this.log(`Request generated for key-session "${(Je=Z.mediaKeysSession)==null?void 0:Je.sessionId}" keyId: ${Xe}`)}).catch(Je=>{throw new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_NO_SESSION,error:Je,fatal:!1},`Error generating key-session request: ${Je}`)}).then(()=>et).catch(Je=>{throw Qe.removeAllListeners(),this.removeSession(Z),Je}).then(()=>(Qe.removeAllListeners(),Z))}onKeyStatusChange(Z){Z.mediaKeysSession.keyStatuses.forEach((ee,ae)=>{this.log(`key status change "${ee}" for keyStatuses keyId: ${Hex.hexDump("buffer"in ae?new Uint8Array(ae.buffer,ae.byteOffset,ae.byteLength):new Uint8Array(ae))} session keyId: ${Hex.hexDump(new Uint8Array(Z.decryptdata.keyId||[]))} uri: ${Z.decryptdata.uri}`),Z.keyStatus=ee})}fetchServerCertificate(Z){const ee=this.config,ae=ee.loader,ve=new ae(ee),ye=this.getServerCertificateUrl(Z);return ye?(this.log(`Fetching serverCertificate for "${Z}"`),new Promise((be,Ke)=>{const Ye={responseType:"arraybuffer",url:ye},Xe=ee.certLoadPolicy.default,Qe={loadPolicy:Xe,timeout:Xe.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},et={onSuccess:(Je,rt,it,nt)=>{be(Je.data)},onError:(Je,rt,it,nt)=>{Ke(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:it,response:_objectSpread2({url:Ye.url,data:void 0},Je)},`"${Z}" certificate request failed (${ye}). Status: ${Je.code} (${Je.text})`))},onTimeout:(Je,rt,it)=>{Ke(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:it,response:{url:Ye.url,data:void 0}},`"${Z}" certificate request timed out (${ye})`))},onAbort:(Je,rt,it)=>{Ke(new Error("aborted"))}};ve.load(Ye,Qe,et)})):Promise.resolve()}setMediaKeysServerCertificate(Z,ee,ae){return new Promise((ve,ye)=>{Z.setServerCertificate(ae).then(be=>{this.log(`setServerCertificate ${be?"success":"not supported by CDM"} (${ae==null?void 0:ae.byteLength}) on "${ee}"`),ve(Z)}).catch(be=>{ye(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:be,fatal:!0},be.message))})})}renewLicense(Z,ee){return this.requestLicense(Z,new Uint8Array(ee)).then(ae=>this.updateKeySession(Z,new Uint8Array(ae)).catch(ve=>{throw new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:ve,fatal:!0},ve.message)}))}setupLicenseXHR(Z,ee,ae,ve){const ye=this.config.licenseXhrSetup;return ye?Promise.resolve().then(()=>{if(!ae.decryptdata)throw new Error("Key removed");return ye.call(this.hls,Z,ee,ae,ve)}).catch(be=>{if(!ae.decryptdata)throw be;return Z.open("POST",ee,!0),ye.call(this.hls,Z,ee,ae,ve)}).then(be=>(Z.readyState||Z.open("POST",ee,!0),{xhr:Z,licenseChallenge:be||ve})):(Z.open("POST",ee,!0),Promise.resolve({xhr:Z,licenseChallenge:ve}))}requestLicense(Z,ee){const ae=this.config.keyLoadPolicy.default;return new Promise((ve,ye)=>{const be=this.getLicenseServerUrl(Z.keySystem);this.log(`Sending license request to URL: ${be}`);const Ke=new XMLHttpRequest;Ke.responseType="arraybuffer",Ke.onreadystatechange=()=>{if(!this.hls||!Z.mediaKeysSession)return ye(new Error("invalid state"));if(Ke.readyState===4)if(Ke.status===200){this._requestLicenseFailureCount=0;let Ye=Ke.response;this.log(`License received ${Ye instanceof ArrayBuffer?Ye.byteLength:Ye}`);const Xe=this.config.licenseResponseCallback;if(Xe)try{Ye=Xe.call(this.hls,Ke,be,Z)}catch(Qe){this.error(Qe)}ve(Ye)}else{const Ye=ae.errorRetry,Xe=Ye?Ye.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>Xe||Ke.status>=400&&Ke.status<500)ye(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:Ke,response:{url:be,data:void 0,code:Ke.status,text:Ke.statusText}},`License Request XHR failed (${be}). Status: ${Ke.status} (${Ke.statusText})`));else{const Qe=Xe-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${Qe} attempts left`),this.requestLicense(Z,ee).then(ve,ye)}}},Z.licenseXhr&&Z.licenseXhr.readyState!==XMLHttpRequest.DONE&&Z.licenseXhr.abort(),Z.licenseXhr=Ke,this.setupLicenseXHR(Ke,be,Z,ee).then(({xhr:Ye,licenseChallenge:Xe})=>{Ye.send(Xe)})})}onMediaAttached(Z,ee){if(!this.config.emeEnabled)return;const ae=ee.media;this.media=ae,ae.addEventListener("encrypted",this.onMediaEncrypted),ae.addEventListener("waitingforkey",this.onWaitingForKey)}onMediaDetached(){const Z=this.media,ee=this.mediaKeySessions;Z&&(Z.removeEventListener("encrypted",this.onMediaEncrypted),Z.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},LevelKey.clearKeyUriToKeyIdMap();const ae=ee.length;EMEController.CDMCleanupPromise=Promise.all(ee.map(ve=>this.removeSession(ve)).concat(Z==null?void 0:Z.setMediaKeys(null).catch(ve=>{this.log(`Could not clear media keys: ${ve}. media.src: ${Z==null?void 0:Z.src}`)}))).then(()=>{ae&&(this.log("finished closing key sessions and clearing media keys"),ee.length=0)}).catch(ve=>{this.log(`Could not close sessions and clear media keys: ${ve}. media.src: ${Z==null?void 0:Z.src}`)})}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(Z,{sessionKeys:ee}){if(!(!ee||!this.config.emeEnabled)&&!this.keyFormatPromise){const ae=ee.reduce((ve,ye)=>(ve.indexOf(ye.keyFormat)===-1&&ve.push(ye.keyFormat),ve),[]);this.log(`Selecting key-system from session-keys ${ae.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(ae)}}removeSession(Z){const{mediaKeysSession:ee,licenseXhr:ae}=Z;if(ee){this.log(`Remove licenses and keys and close session ${ee.sessionId}`),ee.onmessage=null,ee.onkeystatuseschange=null,ae&&ae.readyState!==XMLHttpRequest.DONE&&ae.abort(),Z.mediaKeysSession=Z.decryptdata=Z.licenseXhr=void 0;const ve=this.mediaKeySessions.indexOf(Z);return ve>-1&&this.mediaKeySessions.splice(ve,1),ee.remove().catch(ye=>{this.log(`Could not remove session: ${ye}`)}).then(()=>ee.close()).catch(ye=>{this.log(`Could not close session: ${ye}`)})}}}EMEController.CDMCleanupPromise=void 0;class EMEKeyError extends Error{constructor(Z,ee){super(ee),this.data=void 0,Z.error||(Z.error=new Error(ee)),this.data=Z,Z.err=Z.error}}const CMCDVersion=1;var CMCDObjectType={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"};const CMCDStreamingFormatHLS="h";class CMCDController{constructor(Z){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=ve=>{try{this.apply(ve,{ot:CMCDObjectType.MANIFEST,su:!this.initialized})}catch(ye){logger.warn("Could not generate manifest CMCD data.",ye)}},this.applyFragmentData=ve=>{try{const ye=ve.frag,be=this.hls.levels[ye.level],Ke=this.getObjectType(ye),Ye={d:ye.duration*1e3,ot:Ke};(Ke===CMCDObjectType.VIDEO||Ke===CMCDObjectType.AUDIO||Ke==CMCDObjectType.MUXED)&&(Ye.br=be.bitrate/1e3,Ye.tb=this.getTopBandwidth(Ke)/1e3,Ye.bl=this.getBufferLength(Ke)),this.apply(ve,Ye)}catch(ye){logger.warn("Could not generate segment CMCD data.",ye)}},this.hls=Z;const ee=this.config=Z.config,{cmcd:ae}=ee;ae!=null&&(ee.pLoader=this.createPlaylistLoader(),ee.fLoader=this.createFragmentLoader(),this.sid=ae.sessionId||CMCDController.uuid(),this.cid=ae.contentId,this.useHeaders=ae.useHeaders===!0,this.registerListeners())}registerListeners(){const Z=this.hls;Z.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),Z.on(Events.MEDIA_DETACHED,this.onMediaDetached,this),Z.on(Events.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const Z=this.hls;Z.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),Z.off(Events.MEDIA_DETACHED,this.onMediaDetached,this),Z.off(Events.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null}onMediaAttached(Z,ee){this.media=ee.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(Z,ee){var ae,ve;this.audioBuffer=(ae=ee.tracks.audio)==null?void 0:ae.buffer,this.videoBuffer=(ve=ee.tracks.video)==null?void 0:ve.buffer}createData(){var Z;return{v:CMCDVersion,sf:CMCDStreamingFormatHLS,sid:this.sid,cid:this.cid,pr:(Z=this.media)==null?void 0:Z.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(Z,ee={}){_extends(ee,this.createData());const ae=ee.ot===CMCDObjectType.INIT||ee.ot===CMCDObjectType.VIDEO||ee.ot===CMCDObjectType.MUXED;if(this.starved&&ae&&(ee.bs=!0,ee.su=!0,this.starved=!1),ee.su==null&&(ee.su=this.buffering),this.useHeaders){const ve=CMCDController.toHeaders(ee);if(!Object.keys(ve).length)return;Z.headers||(Z.headers={}),_extends(Z.headers,ve)}else{const ve=CMCDController.toQuery(ee);if(!ve)return;Z.url=CMCDController.appendQueryToUri(Z.url,ve)}}getObjectType(Z){const{type:ee}=Z;if(ee==="subtitle")return CMCDObjectType.TIMED_TEXT;if(Z.sn==="initSegment")return CMCDObjectType.INIT;if(ee==="audio")return CMCDObjectType.AUDIO;if(ee==="main")return this.hls.audioTracks.length?CMCDObjectType.VIDEO:CMCDObjectType.MUXED}getTopBandwidth(Z){let ee=0,ae;const ve=this.hls;if(Z===CMCDObjectType.AUDIO)ae=ve.audioTracks;else{const ye=ve.maxAutoLevel,be=ye>-1?ye+1:ve.levels.length;ae=ve.levels.slice(0,be)}for(const ye of ae)ye.bitrate>ee&&(ee=ye.bitrate);return ee>0?ee:NaN}getBufferLength(Z){const ee=this.hls.media,ae=Z===CMCDObjectType.AUDIO?this.audioBuffer:this.videoBuffer;return!ae||!ee?NaN:BufferHelper.bufferInfo(ae,ee.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:Z}=this.config,ee=this.applyPlaylistData,ae=Z||this.config.loader;return class{constructor(ye){this.loader=void 0,this.loader=new ae(ye)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(ye,be,Ke){ee(ye),this.loader.load(ye,be,Ke)}}}createFragmentLoader(){const{fLoader:Z}=this.config,ee=this.applyFragmentData,ae=Z||this.config.loader;return class{constructor(ye){this.loader=void 0,this.loader=new ae(ye)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(ye,be,Ke){ee(ye),this.loader.load(ye,be,Ke)}}}static uuid(){const Z=URL.createObjectURL(new Blob),ee=Z.toString();return URL.revokeObjectURL(Z),ee.slice(ee.lastIndexOf("/")+1)}static serialize(Z){const ee=[],ae=Xe=>!Number.isNaN(Xe)&&Xe!=null&&Xe!==""&&Xe!==!1,ve=Xe=>Math.round(Xe),ye=Xe=>ve(Xe/100)*100,Ke={br:ve,d:ve,bl:ye,dl:ye,mtp:ye,nor:Xe=>encodeURIComponent(Xe),rtp:ye,tb:ve},Ye=Object.keys(Z||{}).sort();for(const Xe of Ye){let Qe=Z[Xe];if(!ae(Qe)||Xe==="v"&&Qe===1||Xe=="pr"&&Qe===1)continue;const et=Ke[Xe];et&&(Qe=et(Qe));const Je=typeof Qe;let rt;Xe==="ot"||Xe==="sf"||Xe==="st"?rt=`${Xe}=${Qe}`:Je==="boolean"?rt=Xe:Je==="number"?rt=`${Xe}=${Qe}`:rt=`${Xe}=${JSON.stringify(Qe)}`,ee.push(rt)}return ee.join(",")}static toHeaders(Z){const ee=Object.keys(Z),ae={},ve=["Object","Request","Session","Status"],ye=[{},{},{},{}],be={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3};for(const Ke of ee){const Ye=be[Ke]!=null?be[Ke]:1;ye[Ye][Ke]=Z[Ke]}for(let Ke=0;Ke<ye.length;Ke++){const Ye=CMCDController.serialize(ye[Ke]);Ye&&(ae[`CMCD-${ve[Ke]}`]=Ye)}return ae}static toQuery(Z){return`CMCD=${encodeURIComponent(CMCDController.serialize(Z))}`}static appendQueryToUri(Z,ee){if(!ee)return Z;const ae=Z.includes("?")?"&":"?";return`${Z}${ae}${ee}`}}const PATHWAY_PENALTY_DURATION_MS=3e5;class ContentSteeringController{constructor(Z){this.hls=void 0,this.log=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this.pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=Z,this.log=logger.log.bind(logger,"[content-steering]:"),this.registerListeners()}registerListeners(){const Z=this.hls;Z.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),Z.on(Events.MANIFEST_LOADED,this.onManifestLoaded,this),Z.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),Z.on(Events.ERROR,this.onError,this)}unregisterListeners(){const Z=this.hls;Z&&(Z.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),Z.off(Events.MANIFEST_LOADED,this.onManifestLoaded,this),Z.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),Z.off(Events.ERROR,this.onError,this))}startLoad(){if(this.started=!0,self.clearTimeout(this.reloadTimer),this.enabled&&this.uri)if(this.updated){const Z=Math.max(this.timeToLoad*1e3-(performance.now()-this.updated),0);this.scheduleRefresh(this.uri,Z)}else this.loadSteeringManifest(this.uri)}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),self.clearTimeout(this.reloadTimer)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(Z){const ee=this.levels;ee&&(this.levels=ee.filter(ae=>ae!==Z))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(Z,ee){const{contentSteering:ae}=ee;ae!==null&&(this.pathwayId=ae.pathwayId,this.uri=ae.uri,this.started&&this.startLoad())}onManifestParsed(Z,ee){this.audioTracks=ee.audioTracks,this.subtitleTracks=ee.subtitleTracks}onError(Z,ee){const{errorAction:ae}=ee;if((ae==null?void 0:ae.action)===NetworkErrorAction.SendAlternateToPenaltyBox&&ae.flags===ErrorActionFlags.MoveAllAlternatesMatchingHost){let ve=this.pathwayPriority;const ye=this.pathwayId;this.penalizedPathways[ye]||(this.penalizedPathways[ye]=performance.now()),!ve&&this.levels&&(ve=this.levels.reduce((be,Ke)=>(be.indexOf(Ke.pathwayId)===-1&&be.push(Ke.pathwayId),be),[])),ve&&ve.length>1&&(this.updatePathwayPriority(ve),ae.resolved=this.pathwayId!==ye)}}filterParsedLevels(Z){this.levels=Z;let ee=this.getLevelsForPathway(this.pathwayId);if(ee.length===0){const ae=Z[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${ae}"`),ee=this.getLevelsForPathway(ae),this.pathwayId=ae}return ee.length!==Z.length?(this.log(`Found ${ee.length}/${Z.length} levels in Pathway "${this.pathwayId}"`),ee):Z}getLevelsForPathway(Z){return this.levels===null?[]:this.levels.filter(ee=>Z===ee.pathwayId)}updatePathwayPriority(Z){this.pathwayPriority=Z;let ee;const ae=this.penalizedPathways,ve=performance.now();Object.keys(ae).forEach(ye=>{ve-ae[ye]>PATHWAY_PENALTY_DURATION_MS&&delete ae[ye]});for(let ye=0;ye<Z.length;ye++){const be=Z[ye];if(ae[be])continue;if(be===this.pathwayId)return;const Ke=this.hls.nextLoadLevel,Ye=this.hls.levels[Ke];if(ee=this.getLevelsForPathway(be),ee.length>0){this.log(`Setting Pathway to "${be}"`),this.pathwayId=be,this.hls.trigger(Events.LEVELS_UPDATED,{levels:ee});const Xe=this.hls.levels[Ke];Ye&&Xe&&this.levels&&(Xe.attrs["STABLE-VARIANT-ID"]!==Ye.attrs["STABLE-VARIANT-ID"]&&Xe.bitrate!==Ye.bitrate&&this.log(`Unstable Pathways change from bitrate ${Ye.bitrate} to ${Xe.bitrate}`),this.hls.nextLoadLevel=Ke);break}}}clonePathways(Z){const ee=this.levels;if(!ee)return;const ae={},ve={};Z.forEach(ye=>{const{ID:be,"BASE-ID":Ke,"URI-REPLACEMENT":Ye}=ye;if(ee.some(Qe=>Qe.pathwayId===be))return;const Xe=this.getLevelsForPathway(Ke).map(Qe=>{const et=_extends({},Qe);et.details=void 0,et.url=performUriReplacement(Qe.uri,Qe.attrs["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",Ye);const Je=new AttrList(Qe.attrs);Je["PATHWAY-ID"]=be;const rt=Je.AUDIO&&`${Je.AUDIO}_clone_${be}`,it=Je.SUBTITLES&&`${Je.SUBTITLES}_clone_${be}`;rt&&(ae[Je.AUDIO]=rt,Je.AUDIO=rt),it&&(ve[Je.SUBTITLES]=it,Je.SUBTITLES=it),et.attrs=Je;const nt=new Level(et);return addGroupId(nt,"audio",rt),addGroupId(nt,"text",it),nt});ee.push(...Xe),cloneRenditionGroups(this.audioTracks,ae,Ye,be),cloneRenditionGroups(this.subtitleTracks,ve,Ye,be)})}loadSteeringManifest(Z){const ee=this.hls.config,ae=ee.loader;this.loader&&this.loader.destroy(),this.loader=new ae(ee);let ve;try{ve=new self.URL(Z)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${Z}`);return}if(ve.protocol!=="data:"){const Qe=(this.hls.bandwidthEstimate||ee.abrEwmaDefaultEstimate)|0;ve.searchParams.set("_HLS_pathway",this.pathwayId),ve.searchParams.set("_HLS_throughput",""+Qe)}const ye={responseType:"json",url:ve.href},be=ee.steeringManifestLoadPolicy.default,Ke=be.errorRetry||be.timeoutRetry||{},Ye={loadPolicy:be,timeout:be.maxLoadTimeMs,maxRetry:Ke.maxNumRetry||0,retryDelay:Ke.retryDelayMs||0,maxRetryDelay:Ke.maxRetryDelayMs||0},Xe={onSuccess:(Qe,et,Je,rt)=>{this.log(`Loaded steering manifest: "${ve}"`);const it=Qe.data;if(it.VERSION!==1){this.log(`Steering VERSION ${it.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=it.TTL;const{"RELOAD-URI":nt,"PATHWAY-CLONES":tt,"PATHWAY-PRIORITY":st}=it;if(nt)try{this.uri=new self.URL(nt,ve).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${nt}`);return}this.scheduleRefresh(this.uri||Je.url),tt&&this.clonePathways(tt),st&&this.updatePathwayPriority(st)},onError:(Qe,et,Je,rt)=>{if(this.log(`Error loading steering manifest: ${Qe.code} ${Qe.text} (${et.url})`),this.stopLoad(),Qe.code===410){this.enabled=!1,this.log(`Steering manifest ${et.url} no longer available`);return}let it=this.timeToLoad*1e3;if(Qe.code===429){const nt=this.loader;if(typeof(nt==null?void 0:nt.getResponseHeader)=="function"){const tt=nt.getResponseHeader("Retry-After");tt&&(it=parseFloat(tt)*1e3)}this.log(`Steering manifest ${et.url} rate limited`);return}this.scheduleRefresh(this.uri||et.url,it)},onTimeout:(Qe,et,Je)=>{this.log(`Timeout loading steering manifest (${et.url})`),this.scheduleRefresh(this.uri||et.url)}};this.log(`Requesting steering manifest: ${ve}`),this.loader.load(ye,Ye,Xe)}scheduleRefresh(Z,ee=this.timeToLoad*1e3){self.clearTimeout(this.reloadTimer),this.reloadTimer=self.setTimeout(()=>{this.loadSteeringManifest(Z)},ee)}}function cloneRenditionGroups(ie,Z,ee,ae){ie&&Object.keys(Z).forEach(ve=>{const ye=ie.filter(be=>be.groupId===ve).map(be=>{const Ke=_extends({},be);return Ke.details=void 0,Ke.attrs=new AttrList(Ke.attrs),Ke.url=Ke.attrs.URI=performUriReplacement(be.url,be.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",ee),Ke.groupId=Ke.attrs["GROUP-ID"]=Z[ve],Ke.attrs["PATHWAY-ID"]=ae,Ke});ie.push(...ye)})}function performUriReplacement(ie,Z,ee,ae){const{HOST:ve,PARAMS:ye,[ee]:be}=ae;let Ke;Z&&(Ke=be==null?void 0:be[Z],Ke&&(ie=Ke));const Ye=new self.URL(ie);return ve&&!Ke&&(Ye.host=ve),ye&&Object.keys(ye).sort().forEach(Xe=>{Xe&&Ye.searchParams.set(Xe,ye[Xe])}),Ye.href}const AGE_HEADER_LINE_REGEX=/^age:\s*[\d.]+\s*$/im;class XhrLoader{constructor(Z){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=Z&&Z.xhrSetup||null,this.stats=new LoadStats,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null}abortInternal(){const Z=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),Z&&(Z.onreadystatechange=null,Z.onprogress=null,Z.readyState!==4&&(this.stats.aborted=!0,Z.abort()))}abort(){var Z;this.abortInternal(),(Z=this.callbacks)!=null&&Z.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(Z,ee,ae){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=Z,this.config=ee,this.callbacks=ae,this.loadInternal()}loadInternal(){const{config:Z,context:ee}=this;if(!Z)return;const ae=this.loader=new self.XMLHttpRequest,ve=this.stats;ve.loading.first=0,ve.loaded=0,ve.aborted=!1;const ye=this.xhrSetup;ye?Promise.resolve().then(()=>{if(!this.stats.aborted)return ye(ae,ee.url)}).catch(be=>(ae.open("GET",ee.url,!0),ye(ae,ee.url))).then(()=>{this.stats.aborted||this.openAndSendXhr(ae,ee,Z)}).catch(be=>{this.callbacks.onError({code:ae.status,text:be.message},ee,ae,ve)}):this.openAndSendXhr(ae,ee,Z)}openAndSendXhr(Z,ee,ae){Z.readyState||Z.open("GET",ee.url,!0);const ve=this.context.headers,{maxTimeToFirstByteMs:ye,maxLoadTimeMs:be}=ae.loadPolicy;if(ve)for(const Ke in ve)Z.setRequestHeader(Ke,ve[Ke]);ee.rangeEnd&&Z.setRequestHeader("Range","bytes="+ee.rangeStart+"-"+(ee.rangeEnd-1)),Z.onreadystatechange=this.readystatechange.bind(this),Z.onprogress=this.loadprogress.bind(this),Z.responseType=ee.responseType,self.clearTimeout(this.requestTimeout),ae.timeout=ye&&isFiniteNumber(ye)?ye:be,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),ae.timeout),Z.send()}readystatechange(){const{context:Z,loader:ee,stats:ae}=this;if(!Z||!ee)return;const ve=ee.readyState,ye=this.config;if(!ae.aborted&&ve>=2&&(ae.loading.first===0&&(ae.loading.first=Math.max(self.performance.now(),ae.loading.start),ye.timeout!==ye.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),ye.timeout=ye.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),ye.loadPolicy.maxLoadTimeMs-(ae.loading.first-ae.loading.start)))),ve===4)){self.clearTimeout(this.requestTimeout),ee.onreadystatechange=null,ee.onprogress=null;const be=ee.status,Ke=ee.responseType!=="text";if(be>=200&&be<300&&(Ke&&ee.response||ee.responseText!==null)){ae.loading.end=Math.max(self.performance.now(),ae.loading.first);const Ye=Ke?ee.response:ee.responseText,Xe=ee.responseType==="arraybuffer"?Ye.byteLength:Ye.length;if(ae.loaded=ae.total=Xe,ae.bwEstimate=ae.total*8e3/(ae.loading.end-ae.loading.first),!this.callbacks)return;const Qe=this.callbacks.onProgress;if(Qe&&Qe(ae,Z,Ye,ee),!this.callbacks)return;const et={url:ee.responseURL,data:Ye,code:be};this.callbacks.onSuccess(et,ae,Z,ee)}else{const Ye=ye.loadPolicy.errorRetry,Xe=ae.retry;shouldRetry(Ye,Xe,!1,be)?this.retry(Ye):(logger.error(`${be} while loading ${Z.url}`),this.callbacks.onError({code:be,text:ee.statusText},Z,ee,ae))}}}loadtimeout(){var Z;const ee=(Z=this.config)==null?void 0:Z.loadPolicy.timeoutRetry,ae=this.stats.retry;if(shouldRetry(ee,ae,!0))this.retry(ee);else{logger.warn(`timeout while loading ${this.context.url}`);const ve=this.callbacks;ve&&(this.abortInternal(),ve.onTimeout(this.stats,this.context,this.loader))}}retry(Z){const{context:ee,stats:ae}=this;this.retryDelay=getRetryDelay(Z,ae.retry),ae.retry++,logger.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${ee.url}, retrying ${ae.retry}/${Z.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(Z){const ee=this.stats;ee.loaded=Z.loaded,Z.lengthComputable&&(ee.total=Z.total)}getCacheAge(){let Z=null;if(this.loader&&AGE_HEADER_LINE_REGEX.test(this.loader.getAllResponseHeaders())){const ee=this.loader.getResponseHeader("age");Z=ee?parseFloat(ee):null}return Z}getResponseHeader(Z){return this.loader&&new RegExp(`^${Z}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(Z):null}}function fetchSupported(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const BYTERANGE=/(\d+)-(\d+)\/(\d+)/;class FetchLoader{constructor(Z){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=Z.fetchSetup||getRequest,this.controller=new self.AbortController,this.stats=new LoadStats}destroy(){this.loader=this.callbacks=null,this.abortInternal()}abortInternal(){const Z=this.response;Z!=null&&Z.ok||(this.stats.aborted=!0,this.controller.abort())}abort(){var Z;this.abortInternal(),(Z=this.callbacks)!=null&&Z.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(Z,ee,ae){const ve=this.stats;if(ve.loading.start)throw new Error("Loader can only be used once.");ve.loading.start=self.performance.now();const ye=getRequestParameters(Z,this.controller.signal),be=ae.onProgress,Ke=Z.responseType==="arraybuffer",Ye=Ke?"byteLength":"length",{maxTimeToFirstByteMs:Xe,maxLoadTimeMs:Qe}=ee.loadPolicy;this.context=Z,this.config=ee,this.callbacks=ae,this.request=this.fetchSetup(Z,ye),self.clearTimeout(this.requestTimeout),ee.timeout=Xe&&isFiniteNumber(Xe)?Xe:Qe,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),ae.onTimeout(ve,Z,this.response)},ee.timeout),self.fetch(this.request).then(et=>{this.response=this.loader=et;const Je=Math.max(self.performance.now(),ve.loading.start);if(self.clearTimeout(this.requestTimeout),ee.timeout=Qe,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),ae.onTimeout(ve,Z,this.response)},Qe-(Je-ve.loading.start)),!et.ok){const{status:rt,statusText:it}=et;throw new FetchError(it||"fetch, bad network response",rt,et)}return ve.loading.first=Je,ve.total=getContentLength(et.headers)||ve.total,be&&isFiniteNumber(ee.highWaterMark)?this.loadProgressively(et,ve,Z,ee.highWaterMark,be):Ke?et.arrayBuffer():Z.responseType==="json"?et.json():et.text()}).then(et=>{const{response:Je}=this;self.clearTimeout(this.requestTimeout),ve.loading.end=Math.max(self.performance.now(),ve.loading.first);const rt=et[Ye];rt&&(ve.loaded=ve.total=rt);const it={url:Je.url,data:et,code:Je.status};be&&!isFiniteNumber(ee.highWaterMark)&&be(ve,Z,et,Je),ae.onSuccess(it,ve,Z,Je)}).catch(et=>{if(self.clearTimeout(this.requestTimeout),ve.aborted)return;const Je=et&&et.code||0,rt=et?et.message:null;ae.onError({code:Je,text:rt},Z,et?et.details:null,ve)})}getCacheAge(){let Z=null;if(this.response){const ee=this.response.headers.get("age");Z=ee?parseFloat(ee):null}return Z}getResponseHeader(Z){return this.response?this.response.headers.get(Z):null}loadProgressively(Z,ee,ae,ve=0,ye){const be=new ChunkCache,Ke=Z.body.getReader(),Ye=()=>Ke.read().then(Xe=>{if(Xe.done)return be.dataLength&&ye(ee,ae,be.flush(),Z),Promise.resolve(new ArrayBuffer(0));const Qe=Xe.value,et=Qe.length;return ee.loaded+=et,et<ve||be.dataLength?(be.push(Qe),be.dataLength>=ve&&ye(ee,ae,be.flush(),Z)):ye(ee,ae,Qe,Z),Ye()}).catch(()=>Promise.reject());return Ye()}}function getRequestParameters(ie,Z){const ee={method:"GET",mode:"cors",credentials:"same-origin",signal:Z,headers:new self.Headers(_extends({},ie.headers))};return ie.rangeEnd&&ee.headers.set("Range","bytes="+ie.rangeStart+"-"+String(ie.rangeEnd-1)),ee}function getByteRangeLength(ie){const Z=BYTERANGE.exec(ie);if(Z)return parseInt(Z[2])-parseInt(Z[1])+1}function getContentLength(ie){const Z=ie.get("Content-Range");if(Z){const ae=getByteRangeLength(Z);if(isFiniteNumber(ae))return ae}const ee=ie.get("Content-Length");if(ee)return parseInt(ee)}function getRequest(ie,Z){return new self.Request(ie.url,Z)}class FetchError extends Error{constructor(Z,ee,ae){super(Z),this.code=void 0,this.details=void 0,this.code=ee,this.details=ae}}const WHITESPACE_CHAR=/\s/,Cues={newCue(ie,Z,ee,ae){const ve=[];let ye,be,Ke,Ye,Xe;const Qe=self.VTTCue||self.TextTrackCue;for(let Je=0;Je<ae.rows.length;Je++)if(ye=ae.rows[Je],Ke=!0,Ye=0,Xe="",!ye.isEmpty()){var et;for(let nt=0;nt<ye.chars.length;nt++)WHITESPACE_CHAR.test(ye.chars[nt].uchar)&&Ke?Ye++:(Xe+=ye.chars[nt].uchar,Ke=!1);ye.cueStartTime=Z,Z===ee&&(ee+=1e-4),Ye>=16?Ye--:Ye++;const rt=fixLineBreaks(Xe.trim()),it=generateCueId(Z,ee,rt);ie!=null&&(et=ie.cues)!=null&&et.getCueById(it)||(be=new Qe(Z,ee,rt),be.id=it,be.line=Je+1,be.align="left",be.position=10+Math.min(80,Math.floor(Ye*8/32)*10),ve.push(be))}return ie&&ve.length&&(ve.sort((Je,rt)=>Je.line==="auto"||rt.line==="auto"?0:Je.line>8&&rt.line>8?rt.line-Je.line:Je.line-rt.line),ve.forEach(Je=>addCueToTrack(ie,Je))),ve}},defaultLoadPolicy={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},hlsDefaultConfig=_objectSpread2(_objectSpread2({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:XhrLoader,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:AbrController,bufferController:BufferController,capLevelController:CapLevelController,errorController:ErrorController,fpsController:FPSController,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,certLoadPolicy:{default:defaultLoadPolicy},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},timelineConfig()),{},{subtitleStreamController:SubtitleStreamController,subtitleTrackController:SubtitleTrackController,timelineController:TimelineController,audioStreamController:AudioStreamController,audioTrackController:AudioTrackController,emeController:EMEController,cmcdController:CMCDController,contentSteeringController:ContentSteeringController});function timelineConfig(){return{cueHandler:Cues,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function mergeConfig(ie,Z){if((Z.liveSyncDurationCount||Z.liveMaxLatencyDurationCount)&&(Z.liveSyncDuration||Z.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(Z.liveMaxLatencyDurationCount!==void 0&&(Z.liveSyncDurationCount===void 0||Z.liveMaxLatencyDurationCount<=Z.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(Z.liveMaxLatencyDuration!==void 0&&(Z.liveSyncDuration===void 0||Z.liveMaxLatencyDuration<=Z.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const ee=deepCpy(ie),ae=["manifest","level","frag"],ve=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return ae.forEach(ye=>{const be=`${ye==="level"?"playlist":ye}LoadPolicy`,Ke=Z[be]===void 0,Ye=[];ve.forEach(Xe=>{const Qe=`${ye}Loading${Xe}`,et=Z[Qe];if(et!==void 0&&Ke){Ye.push(Qe);const Je=ee[be].default;switch(Z[be]={default:Je},Xe){case"TimeOut":Je.maxLoadTimeMs=et,Je.maxTimeToFirstByteMs=et;break;case"MaxRetry":Je.errorRetry.maxNumRetry=et,Je.timeoutRetry.maxNumRetry=et;break;case"RetryDelay":Je.errorRetry.retryDelayMs=et,Je.timeoutRetry.retryDelayMs=et;break;case"MaxRetryTimeout":Je.errorRetry.maxRetryDelayMs=et,Je.timeoutRetry.maxRetryDelayMs=et;break}}}),Ye.length&&logger.warn(`hls.js config: "${Ye.join('", "')}" setting(s) are deprecated, use "${be}": ${JSON.stringify(Z[be])}`)}),_objectSpread2(_objectSpread2({},ee),Z)}function deepCpy(ie){return ie&&typeof ie=="object"?Array.isArray(ie)?ie.map(deepCpy):Object.keys(ie).reduce((Z,ee)=>(Z[ee]=deepCpy(ie[ee]),Z),{}):ie}function enableStreamingMode(ie){const Z=ie.loader;Z!==FetchLoader&&Z!==XhrLoader?(logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),ie.progressive=!1):fetchSupported()&&(ie.loader=FetchLoader,ie.progressive=!0,ie.enableSoftwareAES=!0,logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}class Hls{static get version(){return"1.4.14"}static isSupported(){return isSupported()}static get Events(){return Events}static get ErrorTypes(){return ErrorTypes}static get ErrorDetails(){return ErrorDetails}static get DefaultConfig(){return Hls.defaultConfig?Hls.defaultConfig:hlsDefaultConfig}static set DefaultConfig(Z){Hls.defaultConfig=Z}constructor(Z={}){this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new EventEmitter,this._autoLevelCapping=void 0,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null,enableLogs(Z.debug||!1,"Hls instance");const ee=this.config=mergeConfig(Hls.DefaultConfig,Z);this.userConfig=Z,this._autoLevelCapping=-1,ee.progressive&&enableStreamingMode(ee);const{abrController:ae,bufferController:ve,capLevelController:ye,errorController:be,fpsController:Ke}=ee,Ye=new be(this),Xe=this.abrController=new ae(this),Qe=this.bufferController=new ve(this),et=this.capLevelController=new ye(this),Je=new Ke(this),rt=new PlaylistLoader(this),it=new ID3TrackController(this),nt=ee.contentSteeringController,tt=nt?new nt(this):null,st=this.levelController=new LevelController(this,tt),ot=new FragmentTracker(this),ut=new KeyLoader(this.config),ft=this.streamController=new StreamController(this,ot,ut);et.setStreamController(ft),Je.setStreamController(ft);const pt=[rt,st,ft];tt&&pt.splice(1,0,tt),this.networkControllers=pt;const Xr=[Xe,Qe,et,Je,it,ot];this.audioTrackController=this.createController(ee.audioTrackController,pt);const mt=ee.audioStreamController;mt&&pt.push(new mt(this,ot,ut)),this.subtitleTrackController=this.createController(ee.subtitleTrackController,pt);const Yr=ee.subtitleStreamController;Yr&&pt.push(new Yr(this,ot,ut)),this.createController(ee.timelineController,Xr),ut.emeController=this.emeController=this.createController(ee.emeController,Xr),this.cmcdController=this.createController(ee.cmcdController,Xr),this.latencyController=this.createController(LatencyController,Xr),this.coreComponents=Xr,pt.push(Ye);const ri=Ye.onErrorOut;typeof ri=="function"&&this.on(Events.ERROR,ri,Ye)}createController(Z,ee){if(Z){const ae=new Z(this);return ee&&ee.push(ae),ae}return null}on(Z,ee,ae=this){this._emitter.on(Z,ee,ae)}once(Z,ee,ae=this){this._emitter.once(Z,ee,ae)}removeAllListeners(Z){this._emitter.removeAllListeners(Z)}off(Z,ee,ae=this,ve){this._emitter.off(Z,ee,ae,ve)}listeners(Z){return this._emitter.listeners(Z)}emit(Z,ee,ae){return this._emitter.emit(Z,ee,ae)}trigger(Z,ee){if(this.config.debug)return this.emit(Z,Z,ee);try{return this.emit(Z,Z,ee)}catch(ae){logger.error("An internal error happened while handling event "+Z+'. Error message: "'+ae.message+'". Here is a stacktrace:',ae),this.trigger(Events.ERROR,{type:ErrorTypes.OTHER_ERROR,details:ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:Z,error:ae})}return!1}listenerCount(Z){return this._emitter.listenerCount(Z)}destroy(){logger.log("destroy"),this.trigger(Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(ee=>ee.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(ee=>ee.destroy()),this.coreComponents.length=0;const Z=this.config;Z.xhrSetup=Z.fetchSetup=void 0,this.userConfig=null}attachMedia(Z){logger.log("attachMedia"),this._media=Z,this.trigger(Events.MEDIA_ATTACHING,{media:Z})}detachMedia(){logger.log("detachMedia"),this.trigger(Events.MEDIA_DETACHING,void 0),this._media=null}loadSource(Z){this.stopLoad();const ee=this.media,ae=this.url,ve=this.url=urlToolkitExports.buildAbsoluteURL(self.location.href,Z,{alwaysNormalize:!0});logger.log(`loadSource:${ve}`),ee&&ae&&(ae!==ve||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(ee)),this.trigger(Events.MANIFEST_LOADING,{url:Z})}startLoad(Z=-1){logger.log(`startLoad(${Z})`),this.networkControllers.forEach(ee=>{ee.startLoad(Z)})}stopLoad(){logger.log("stopLoad"),this.networkControllers.forEach(Z=>{Z.stopLoad()})}swapAudioCodec(){logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){logger.log("recoverMediaError");const Z=this._media;this.detachMedia(),Z&&this.attachMedia(Z)}removeLevel(Z,ee=0){this.levelController.removeLevel(Z,ee)}get levels(){const Z=this.levelController.levels;return Z||[]}get currentLevel(){return this.streamController.currentLevel}set currentLevel(Z){logger.log(`set currentLevel:${Z}`),this.loadLevel=Z,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(Z){logger.log(`set nextLevel:${Z}`),this.levelController.manualLevel=Z,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(Z){logger.log(`set loadLevel:${Z}`),this.levelController.manualLevel=Z}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(Z){this.levelController.nextLoadLevel=Z}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(Z){logger.log(`set firstLevel:${Z}`),this.levelController.firstLevel=Z}get startLevel(){return this.levelController.startLevel}set startLevel(Z){logger.log(`set startLevel:${Z}`),Z!==-1&&(Z=Math.max(Z,this.minAutoLevel)),this.levelController.startLevel=Z}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(Z){const ee=!!Z;ee!==this.config.capLevelToPlayerSize&&(ee?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=ee)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:Z}=this.abrController;return Z?Z.getEstimate():NaN}get ttfbEstimate(){const{bwEstimator:Z}=this.abrController;return Z?Z.getEstimateTTFB():NaN}set autoLevelCapping(Z){this._autoLevelCapping!==Z&&(logger.log(`set autoLevelCapping:${Z}`),this._autoLevelCapping=Z)}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(Z){HdcpLevels.indexOf(Z)>-1&&(this._maxHdcpLevel=Z)}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:Z,config:{minAutoBitrate:ee}}=this;if(!Z)return 0;const ae=Z.length;for(let ve=0;ve<ae;ve++)if(Z[ve].maxBitrate>=ee)return ve;return 0}get maxAutoLevel(){const{levels:Z,autoLevelCapping:ee,maxHdcpLevel:ae}=this;let ve;if(ee===-1&&Z&&Z.length?ve=Z.length-1:ve=ee,ae)for(let ye=ve;ye--;){const be=Z[ye].attrs["HDCP-LEVEL"];if(be&&be<=ae)return ye}return ve}get nextAutoLevel(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)}set nextAutoLevel(Z){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,Z)}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get audioTracks(){const Z=this.audioTrackController;return Z?Z.audioTracks:[]}get audioTrack(){const Z=this.audioTrackController;return Z?Z.audioTrack:-1}set audioTrack(Z){const ee=this.audioTrackController;ee&&(ee.audioTrack=Z)}get subtitleTracks(){const Z=this.subtitleTrackController;return Z?Z.subtitleTracks:[]}get subtitleTrack(){const Z=this.subtitleTrackController;return Z?Z.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(Z){const ee=this.subtitleTrackController;ee&&(ee.subtitleTrack=Z)}get subtitleDisplay(){const Z=this.subtitleTrackController;return Z?Z.subtitleDisplay:!1}set subtitleDisplay(Z){const ee=this.subtitleTrackController;ee&&(ee.subtitleDisplay=Z)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(Z){this.config.lowLatencyMode=Z}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}}Hls.defaultConfig=void 0;let getRandomValues;const rnds8=new Uint8Array(16);function rng(){if(!getRandomValues&&(getRandomValues=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!getRandomValues))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return getRandomValues(rnds8)}const byteToHex=[];for(let ie=0;ie<256;++ie)byteToHex.push((ie+256).toString(16).slice(1));function unsafeStringify(ie,Z=0){return byteToHex[ie[Z+0]]+byteToHex[ie[Z+1]]+byteToHex[ie[Z+2]]+byteToHex[ie[Z+3]]+"-"+byteToHex[ie[Z+4]]+byteToHex[ie[Z+5]]+"-"+byteToHex[ie[Z+6]]+byteToHex[ie[Z+7]]+"-"+byteToHex[ie[Z+8]]+byteToHex[ie[Z+9]]+"-"+byteToHex[ie[Z+10]]+byteToHex[ie[Z+11]]+byteToHex[ie[Z+12]]+byteToHex[ie[Z+13]]+byteToHex[ie[Z+14]]+byteToHex[ie[Z+15]]}const randomUUID=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),native={randomUUID};function v4(ie,Z,ee){if(native.randomUUID&&!Z&&!ie)return native.randomUUID();ie=ie||{};const ae=ie.random||(ie.rng||rng)();if(ae[6]=ae[6]&15|64,ae[8]=ae[8]&63|128,Z){ee=ee||0;for(let ve=0;ve<16;++ve)Z[ee+ve]=ae[ve];return Z}return unsafeStringify(ae)}function $db6c3485150b8e66$export$1ab7ae714698c4b8(ie){const[Z,ee]=reactExports.useState(void 0);return $9f79659886946c16$export$e5c5a5f917a5871c(()=>{if(ie){ee({width:ie.offsetWidth,height:ie.offsetHeight});const ae=new ResizeObserver(ve=>{if(!Array.isArray(ve)||!ve.length)return;const ye=ve[0];let be,Ke;if("borderBoxSize"in ye){const Ye=ye.borderBoxSize,Xe=Array.isArray(Ye)?Ye[0]:Ye;be=Xe.inlineSize,Ke=Xe.blockSize}else be=ie.offsetWidth,Ke=ie.offsetHeight;ee({width:be,height:Ke})});return ae.observe(ie,{box:"border-box"}),()=>ae.unobserve(ie)}else ee(void 0)},[ie]),Z}function $010c2913dbd2fe3d$export$5cae361ad82dce8b(ie){const Z=reactExports.useRef({value:ie,previous:ie});return reactExports.useMemo(()=>(Z.current.value!==ie&&(Z.current.previous=Z.current.value,Z.current.value=ie),Z.current.previous),[ie])}const $ce77a8961b41be9e$var$RADIO_NAME="Radio",[$ce77a8961b41be9e$var$createRadioContext,$ce77a8961b41be9e$export$67d2296460f1b002]=$c512c27ab02ef895$export$50c7b4e9d9f19c1($ce77a8961b41be9e$var$RADIO_NAME),[$ce77a8961b41be9e$var$RadioProvider,$ce77a8961b41be9e$var$useRadioContext]=$ce77a8961b41be9e$var$createRadioContext($ce77a8961b41be9e$var$RADIO_NAME),$ce77a8961b41be9e$export$d7b12c4107be0d61=reactExports.forwardRef((ie,Z)=>{const{__scopeRadio:ee,name:ae,checked:ve=!1,required:ye,disabled:be,value:Ke="on",onCheck:Ye,...Xe}=ie,[Qe,et]=reactExports.useState(null),Je=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(Z,nt=>et(nt)),rt=reactExports.useRef(!1),it=Qe?!!Qe.closest("form"):!0;return reactExports.createElement($ce77a8961b41be9e$var$RadioProvider,{scope:ee,checked:ve,disabled:be},reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.button,_extends$1({type:"button",role:"radio","aria-checked":ve,"data-state":$ce77a8961b41be9e$var$getState(ve),"data-disabled":be?"":void 0,disabled:be,value:Ke},Xe,{ref:Je,onClick:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ie.onClick,nt=>{ve||Ye==null||Ye(),it&&(rt.current=nt.isPropagationStopped(),rt.current||nt.stopPropagation())})})),it&&reactExports.createElement($ce77a8961b41be9e$var$BubbleInput,{control:Qe,bubbles:!rt.current,name:ae,value:Ke,checked:ve,required:ye,disabled:be,style:{transform:"translateX(-100%)"}}))}),$ce77a8961b41be9e$var$BubbleInput=ie=>{const{control:Z,checked:ee,bubbles:ae=!0,...ve}=ie,ye=reactExports.useRef(null),be=$010c2913dbd2fe3d$export$5cae361ad82dce8b(ee),Ke=$db6c3485150b8e66$export$1ab7ae714698c4b8(Z);return reactExports.useEffect(()=>{const Ye=ye.current,Xe=window.HTMLInputElement.prototype,et=Object.getOwnPropertyDescriptor(Xe,"checked").set;if(be!==ee&&et){const Je=new Event("click",{bubbles:ae});et.call(Ye,ee),Ye.dispatchEvent(Je)}},[be,ee,ae]),reactExports.createElement("input",_extends$1({type:"radio","aria-hidden":!0,defaultChecked:ee},ve,{tabIndex:-1,ref:ye,style:{...ie.style,...Ke,position:"absolute",pointerEvents:"none",opacity:0,margin:0}}))};function $ce77a8961b41be9e$var$getState(ie){return ie?"checked":"unchecked"}const $f99a8c78507165f7$var$ARROW_KEYS=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],$f99a8c78507165f7$var$RADIO_GROUP_NAME="RadioGroup",[$f99a8c78507165f7$var$createRadioGroupContext,$f99a8c78507165f7$export$c547093f11b76da2]=$c512c27ab02ef895$export$50c7b4e9d9f19c1($f99a8c78507165f7$var$RADIO_GROUP_NAME,[$d7bdfb9eb0fdf311$export$c7109489551a4f4,$ce77a8961b41be9e$export$67d2296460f1b002]),$f99a8c78507165f7$var$useRovingFocusGroupScope=$d7bdfb9eb0fdf311$export$c7109489551a4f4(),$f99a8c78507165f7$var$useRadioScope=$ce77a8961b41be9e$export$67d2296460f1b002(),[$f99a8c78507165f7$var$RadioGroupProvider,$f99a8c78507165f7$var$useRadioGroupContext]=$f99a8c78507165f7$var$createRadioGroupContext($f99a8c78507165f7$var$RADIO_GROUP_NAME),$f99a8c78507165f7$export$a98f0dcb43a68a25=reactExports.forwardRef((ie,Z)=>{const{__scopeRadioGroup:ee,name:ae,defaultValue:ve,value:ye,required:be=!1,disabled:Ke=!1,orientation:Ye,dir:Xe,loop:Qe=!0,onValueChange:et,...Je}=ie,rt=$f99a8c78507165f7$var$useRovingFocusGroupScope(ee),it=$f631663db3294ace$export$b39126d51d94e6f3(Xe),[nt,tt]=$71cd76cc60e0454e$export$6f32135080cb4c3({prop:ye,defaultProp:ve,onChange:et});return reactExports.createElement($f99a8c78507165f7$var$RadioGroupProvider,{scope:ee,name:ae,required:be,disabled:Ke,value:nt,onValueChange:tt},reactExports.createElement($d7bdfb9eb0fdf311$export$be92b6f5f03c0fe9,_extends$1({asChild:!0},rt,{orientation:Ye,dir:it,loop:Qe}),reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({role:"radiogroup","aria-required":be,"aria-orientation":Ye,"data-disabled":Ke?"":void 0,dir:it},Je,{ref:Z}))))}),$f99a8c78507165f7$var$ITEM_NAME="RadioGroupItem",$f99a8c78507165f7$export$9f866c100ef519e4=reactExports.forwardRef((ie,Z)=>{const{__scopeRadioGroup:ee,disabled:ae,...ve}=ie,ye=$f99a8c78507165f7$var$useRadioGroupContext($f99a8c78507165f7$var$ITEM_NAME,ee),be=ye.disabled||ae,Ke=$f99a8c78507165f7$var$useRovingFocusGroupScope(ee),Ye=$f99a8c78507165f7$var$useRadioScope(ee),Xe=reactExports.useRef(null),Qe=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(Z,Xe),et=ye.value===ve.value,Je=reactExports.useRef(!1);return reactExports.useEffect(()=>{const rt=nt=>{$f99a8c78507165f7$var$ARROW_KEYS.includes(nt.key)&&(Je.current=!0)},it=()=>Je.current=!1;return document.addEventListener("keydown",rt),document.addEventListener("keyup",it),()=>{document.removeEventListener("keydown",rt),document.removeEventListener("keyup",it)}},[]),reactExports.createElement($d7bdfb9eb0fdf311$export$6d08773d2e66f8f2,_extends$1({asChild:!0},Ke,{focusable:!be,active:et}),reactExports.createElement($ce77a8961b41be9e$export$d7b12c4107be0d61,_extends$1({disabled:be,required:ye.required,checked:et},Ye,ve,{name:ye.name,ref:Qe,onCheck:()=>ye.onValueChange(ve.value),onKeyDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(rt=>{rt.key==="Enter"&&rt.preventDefault()}),onFocus:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ve.onFocus,()=>{var rt;Je.current&&((rt=Xe.current)===null||rt===void 0||rt.click())})})))}),$f99a8c78507165f7$export$be92b6f5f03c0fe9=$f99a8c78507165f7$export$a98f0dcb43a68a25,$f99a8c78507165f7$export$6d08773d2e66f8f2=$f99a8c78507165f7$export$9f866c100ef519e4;function ParserError(ie,Z){this.message=ie,this.error=Z}ParserError.prototype=Object.create(Error.prototype);const TIMESTAMP_REGEXP=/([0-9]+)?:?([0-9]{2}):([0-9]{2}\.[0-9]{2,3})/;function parse$3(ie,Z){Z||(Z={});const{meta:ee=!1,strict:ae=!0}=Z;if(typeof ie!="string")throw new ParserError("Input must be a string");ie=ie.trim(),ie=ie.replace(/\r\n/g,`
`),ie=ie.replace(/\r/g,`
`);const ve=ie.split(`

`),ye=ve.shift();if(!ye.startsWith("WEBVTT"))throw new ParserError('Must start with "WEBVTT"');const be=ye.split(`
`),Ke=be[0].replace("WEBVTT","");if(Ke.length>0&&Ke[0]!==" "&&Ke[0]!=="	")throw new ParserError("Header comment must start with space or tab");if(ve.length===0&&be.length===1)return{valid:!0,strict:ae,cues:[],errors:[]};if(!ee&&be.length>1&&be[1]!=="")throw new ParserError("Missing blank line after signature");const{cues:Ye,errors:Xe}=parseCues(ve,ae);if(ae&&Xe.length>0)throw Xe[0];const Qe=ee?parseMeta(be):null,et={valid:Xe.length===0,strict:ae,cues:Ye,errors:Xe};return ee&&(et.meta=Qe),et}function parseMeta(ie){const Z={};return ie.slice(1).forEach(ee=>{const ae=ee.indexOf(":"),ve=ee.slice(0,ae).trim(),ye=ee.slice(ae+1).trim();Z[ve]=ye}),Object.keys(Z).length>0?Z:null}function parseCues(ie,Z){const ee=[];return{cues:ie.map((ve,ye)=>{try{return parseCue(ve,ye,Z)}catch(be){return ee.push(be),null}}).filter(Boolean),errors:ee}}function parseCue(ie,Z,ee){let ae="",ve=0,ye=.01,be="",Ke="";const Ye=ie.split(`
`).filter(Boolean);if(Ye.length>0&&Ye[0].trim().startsWith("NOTE"))return null;if(Ye.length===1&&!Ye[0].includes("-->"))throw new ParserError(`Cue identifier cannot be standalone (cue #${Z})`);if(Ye.length>1&&!(Ye[0].includes("-->")||Ye[1].includes("-->"))){const Qe=`Cue identifier needs to be followed by timestamp (cue #${Z})`;throw new ParserError(Qe)}Ye.length>1&&Ye[1].includes("-->")&&(ae=Ye.shift());const Xe=typeof Ye[0]=="string"&&Ye[0].split(" --> ");if(Xe.length!==2||!validTimestamp(Xe[0])||!validTimestamp(Xe[1]))throw new ParserError(`Invalid cue timestamp (cue #${Z})`);if(ve=parseTimestamp(Xe[0]),ye=parseTimestamp(Xe[1]),ee){if(ve>ye)throw new ParserError(`Start timestamp greater than end (cue #${Z})`);if(ye<=ve)throw new ParserError(`End must be greater than start (cue #${Z})`)}if(!ee&&ye<ve)throw new ParserError(`End must be greater or equal to start when not strict (cue #${Z})`);return Ke=Xe[1].replace(TIMESTAMP_REGEXP,"").trim(),Ye.shift(),be=Ye.join(`
`),be?{identifier:ae,start:ve,end:ye,text:be,styles:Ke}:!1}function validTimestamp(ie){return TIMESTAMP_REGEXP.test(ie)}function parseTimestamp(ie){const Z=ie.match(TIMESTAMP_REGEXP);let ee=parseFloat(Z[1]||0)*60*60;return ee+=parseFloat(Z[2])*60,ee+=parseFloat(Z[3]),ee}var parser={ParserError,parse:parse$3};function CompilerError(ie,Z){this.message=ie,this.error=Z}CompilerError.prototype=Object.create(Error.prototype);function compile$1(ie){if(!ie)throw new CompilerError("Input must be non-null");if(typeof ie!="object")throw new CompilerError("Input must be an object");if(Array.isArray(ie))throw new CompilerError("Input cannot be array");if(!ie.valid)throw new CompilerError("Input must be valid");let Z=`WEBVTT
`;if(ie.meta){if(typeof ie.meta!="object"||Array.isArray(ie.meta))throw new CompilerError("Metadata must be an object");Object.entries(ie.meta).forEach(ae=>{if(typeof ae[1]!="string")throw new CompilerError(`Metadata value for "${ae[0]}" must be string`);Z+=`${ae[0]}: ${ae[1]}
`})}let ee=null;return ie.cues.forEach((ae,ve)=>{if(ee&&ee>ae.start)throw new CompilerError(`Cue number ${ve} is not in chronological order`);ee=ae.start,Z+=`
`,Z+=compileCue(ae),Z+=`
`}),Z}function compileCue(ie){if(typeof ie!="object")throw new CompilerError("Cue malformed: not of type object");if(typeof ie.identifier!="string"&&typeof ie.identifier!="number"&&ie.identifier!==null)throw new CompilerError(`Cue malformed: identifier value is not a string.
    ${JSON.stringify(ie)}`);if(isNaN(ie.start))throw new CompilerError(`Cue malformed: null start value.
    ${JSON.stringify(ie)}`);if(isNaN(ie.end))throw new CompilerError(`Cue malformed: null end value.
    ${JSON.stringify(ie)}`);if(ie.start>=ie.end)throw new CompilerError(`Cue malformed: start timestamp greater than end
    ${JSON.stringify(ie)}`);if(typeof ie.text!="string")throw new CompilerError(`Cue malformed: null text value.
    ${JSON.stringify(ie)}`);if(typeof ie.styles!="string")throw new CompilerError(`Cue malformed: null styles value.
    ${JSON.stringify(ie)}`);let Z="";ie.identifier.length>0&&(Z+=`${ie.identifier}
`);const ee=convertTimestamp(ie.start),ae=convertTimestamp(ie.end);return Z+=`${ee} --> ${ae}`,Z+=ie.styles?` ${ie.styles}`:"",Z+=`
${ie.text}`,Z}function convertTimestamp(ie){const Z=pad$1(calculateHours(ie),2),ee=pad$1(calculateMinutes(ie),2),ae=pad$1(calculateSeconds(ie),2),ve=pad$1(calculateMs(ie),3);return`${Z}:${ee}:${ae}.${ve}`}function pad$1(ie,Z){let ee=`${ie}`;for(;ee.length<Z;)ee=`0${ee}`;return ee}function calculateHours(ie){return Math.floor(ie/60/60)}function calculateMinutes(ie){return Math.floor(ie/60)%60}function calculateSeconds(ie){return Math.floor(ie%60)}function calculateMs(ie){return Math.floor((ie%1).toFixed(4)*1e3)}var compiler={CompilerError,compile:compile$1};const parse$2=parser.parse;function segment$2(ie,Z){Z=Z||10;const ee=parse$2(ie),ae=[];let ve=[],ye=null,be=0,Ke=0;return ee.cues.forEach((Ye,Xe)=>{const Qe=Xe===0,et=Xe===ee.cues.length-1,Je=Ye.start,rt=Ye.end,it=et?1/0:ee.cues[Xe+1].start,nt=Qe?rt:rt-Je,tt=Qe?0:Je-ee.cues[Xe-1].end;be=be+nt+tt,`${Xe}`,ae.length+1,ye&&(ve.push(ye),be+=ye.end-Ke,ye=null),ve.push(Ye);let st=it-rt<Z&&tt<Z&&be>Z;if(shouldSegment(Ke,Z,it,tt)){const ot=segmentDuration(et,rt,Z,be,Ke);ae.push({duration:ot,cues:ve}),Ke+=ot,be=0,ve=[]}else st=!1;st&&(ye=Ye)}),ae}function shouldSegment(ie,Z,ee,ae){const ve=alignToSegmentLength(ae,Z);return(ae<=Z||ve+ie<ee)&&ee-ie>=Z}function segmentDuration(ie,Z,ee,ae,ve){let ye=ee;return ae>ee&&(ye=alignToSegmentLength(ae-ee,ee)),ie?ye=parseFloat((Z-ve).toFixed(2)):ye=Math.round(ye),ye}function alignToSegmentLength(ie,Z){return ie+=Z-ie%Z,ie}function debug(ie){}var segmenter={segment:segment$2};const segment$1=segmenter.segment;function hlsSegment(ie,Z,ee){typeof ee>"u"&&(ee="900000");const ae=segment$1(ie,Z),ve=[];return ae.forEach((ye,be)=>{const Ke=`WEBVTT
X-TIMESTAMP-MAP=MPEGTS:${ee},LOCAL:00:00:00.000

${printableCues(ye.cues)}
`,Ye=generateSegmentFilename(be);ve.push({filename:Ye,content:Ke})}),ve}function hlsSegmentPlaylist(ie,Z){const ee=segment$1(ie,Z),ae=printableSegments(ee);return`#EXTM3U
#EXT-X-TARGETDURATION:${Math.round(findLongestSegment(ee))}
#EXT-X-VERSION:3
#EXT-X-MEDIA-SEQUENCE:0
#EXT-X-PLAYLIST-TYPE:VOD
${ae}
#EXT-X-ENDLIST
`}function pad(ie,Z){return`${"0".repeat(Math.max(0,Z-ie.toString().length))}${ie}`}function generateSegmentFilename(ie){return`${ie}.vtt`}function printableSegments(ie){const Z=[];return ie.forEach((ee,ae)=>{Z.push(`#EXTINF:${ee.duration.toFixed(5)},
${generateSegmentFilename(ae)}`)}),Z.join(`
`)}function findLongestSegment(ie){let Z=0;return ie.forEach(ee=>{ee.duration>Z&&(Z=ee.duration)}),Z}function printableCues(ie){const Z=[];return ie.forEach(ee=>{Z.push(printableCue(ee))}),Z.join(`

`)}function printableCue(ie){const Z=[];ie.identifier&&Z.push(ie.identifier);const ee=printableTimestamp(ie.start),ae=printableTimestamp(ie.end),ve=ie.styles?`${ie.styles}`:"";return Z.push(`${ee} --> ${ae} ${ve}`),Z.push(ie.text),Z.join(`
`)}function printableTimestamp(ie){const Z=(ie%1).toFixed(3);ie=Math.round(ie-Z);const ee=Math.floor(ie/3600),ae=Math.floor((ie-ee*3600)/60),ve=ie-ee*3600-ae*60;return`${`${pad(ee,2)}:`}${pad(ae,2)}:${pad(ve,2)}.${pad(Z*1e3,3)}`}var hls$1={hlsSegment,hlsSegmentPlaylist};const parse$1=parser.parse,compile=compiler.compile,segment=segmenter.segment,hls=hls$1;var nodeWebvtt={parse:parse$1,compile,segment,hls};function $addc16e1bbe58fd0$export$3a72a57244d6e765(ie,Z=globalThis==null?void 0:globalThis.document){const ee=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(ie);reactExports.useEffect(()=>{const ae=ve=>{ve.key==="Escape"&&ee(ve)};return Z.addEventListener("keydown",ae),()=>Z.removeEventListener("keydown",ae)},[ee,Z])}const $5cb92bef7577960e$var$CONTEXT_UPDATE="dismissableLayer.update",$5cb92bef7577960e$var$POINTER_DOWN_OUTSIDE="dismissableLayer.pointerDownOutside",$5cb92bef7577960e$var$FOCUS_OUTSIDE="dismissableLayer.focusOutside";let $5cb92bef7577960e$var$originalBodyPointerEvents;const $5cb92bef7577960e$var$DismissableLayerContext=reactExports.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),$5cb92bef7577960e$export$177fb62ff3ec1f22=reactExports.forwardRef((ie,Z)=>{var ee;const{disableOutsidePointerEvents:ae=!1,onEscapeKeyDown:ve,onPointerDownOutside:ye,onFocusOutside:be,onInteractOutside:Ke,onDismiss:Ye,...Xe}=ie,Qe=reactExports.useContext($5cb92bef7577960e$var$DismissableLayerContext),[et,Je]=reactExports.useState(null),rt=(ee=et==null?void 0:et.ownerDocument)!==null&&ee!==void 0?ee:globalThis==null?void 0:globalThis.document,[,it]=reactExports.useState({}),nt=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(Z,Yr=>Je(Yr)),tt=Array.from(Qe.layers),[st]=[...Qe.layersWithOutsidePointerEventsDisabled].slice(-1),ot=tt.indexOf(st),ut=et?tt.indexOf(et):-1,ft=Qe.layersWithOutsidePointerEventsDisabled.size>0,pt=ut>=ot,Xr=$5cb92bef7577960e$var$usePointerDownOutside(Yr=>{const ri=Yr.target,Zr=[...Qe.branches].some(_r=>_r.contains(ri));!pt||Zr||(ye==null||ye(Yr),Ke==null||Ke(Yr),Yr.defaultPrevented||Ye==null||Ye())},rt),mt=$5cb92bef7577960e$var$useFocusOutside(Yr=>{const ri=Yr.target;[...Qe.branches].some(_r=>_r.contains(ri))||(be==null||be(Yr),Ke==null||Ke(Yr),Yr.defaultPrevented||Ye==null||Ye())},rt);return $addc16e1bbe58fd0$export$3a72a57244d6e765(Yr=>{ut===Qe.layers.size-1&&(ve==null||ve(Yr),!Yr.defaultPrevented&&Ye&&(Yr.preventDefault(),Ye()))},rt),reactExports.useEffect(()=>{if(et)return ae&&(Qe.layersWithOutsidePointerEventsDisabled.size===0&&($5cb92bef7577960e$var$originalBodyPointerEvents=rt.body.style.pointerEvents,rt.body.style.pointerEvents="none"),Qe.layersWithOutsidePointerEventsDisabled.add(et)),Qe.layers.add(et),$5cb92bef7577960e$var$dispatchUpdate(),()=>{ae&&Qe.layersWithOutsidePointerEventsDisabled.size===1&&(rt.body.style.pointerEvents=$5cb92bef7577960e$var$originalBodyPointerEvents)}},[et,rt,ae,Qe]),reactExports.useEffect(()=>()=>{et&&(Qe.layers.delete(et),Qe.layersWithOutsidePointerEventsDisabled.delete(et),$5cb92bef7577960e$var$dispatchUpdate())},[et,Qe]),reactExports.useEffect(()=>{const Yr=()=>it({});return document.addEventListener($5cb92bef7577960e$var$CONTEXT_UPDATE,Yr),()=>document.removeEventListener($5cb92bef7577960e$var$CONTEXT_UPDATE,Yr)},[]),reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({},Xe,{ref:nt,style:{pointerEvents:ft?pt?"auto":"none":void 0,...ie.style},onFocusCapture:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ie.onFocusCapture,mt.onFocusCapture),onBlurCapture:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ie.onBlurCapture,mt.onBlurCapture),onPointerDownCapture:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ie.onPointerDownCapture,Xr.onPointerDownCapture)}))});function $5cb92bef7577960e$var$usePointerDownOutside(ie,Z=globalThis==null?void 0:globalThis.document){const ee=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(ie),ae=reactExports.useRef(!1),ve=reactExports.useRef(()=>{});return reactExports.useEffect(()=>{const ye=Ke=>{if(Ke.target&&!ae.current){let Xe=function(){$5cb92bef7577960e$var$handleAndDispatchCustomEvent($5cb92bef7577960e$var$POINTER_DOWN_OUTSIDE,ee,Ye,{discrete:!0})};const Ye={originalEvent:Ke};Ke.pointerType==="touch"?(Z.removeEventListener("click",ve.current),ve.current=Xe,Z.addEventListener("click",ve.current,{once:!0})):Xe()}else Z.removeEventListener("click",ve.current);ae.current=!1},be=window.setTimeout(()=>{Z.addEventListener("pointerdown",ye)},0);return()=>{window.clearTimeout(be),Z.removeEventListener("pointerdown",ye),Z.removeEventListener("click",ve.current)}},[Z,ee]),{onPointerDownCapture:()=>ae.current=!0}}function $5cb92bef7577960e$var$useFocusOutside(ie,Z=globalThis==null?void 0:globalThis.document){const ee=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(ie),ae=reactExports.useRef(!1);return reactExports.useEffect(()=>{const ve=ye=>{ye.target&&!ae.current&&$5cb92bef7577960e$var$handleAndDispatchCustomEvent($5cb92bef7577960e$var$FOCUS_OUTSIDE,ee,{originalEvent:ye},{discrete:!1})};return Z.addEventListener("focusin",ve),()=>Z.removeEventListener("focusin",ve)},[Z,ee]),{onFocusCapture:()=>ae.current=!0,onBlurCapture:()=>ae.current=!1}}function $5cb92bef7577960e$var$dispatchUpdate(){const ie=new CustomEvent($5cb92bef7577960e$var$CONTEXT_UPDATE);document.dispatchEvent(ie)}function $5cb92bef7577960e$var$handleAndDispatchCustomEvent(ie,Z,ee,{discrete:ae}){const ve=ee.originalEvent.target,ye=new CustomEvent(ie,{bubbles:!1,cancelable:!0,detail:ee});Z&&ve.addEventListener(ie,Z,{once:!0}),ae?$8927f6f2acc4f386$export$6d1a0317bde7de7f(ve,ye):ve.dispatchEvent(ye)}let $3db38b7d1fb3fe6a$var$count=0;function $3db38b7d1fb3fe6a$export$b7ece24a22aeda8c(){reactExports.useEffect(()=>{var ie,Z;const ee=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",(ie=ee[0])!==null&&ie!==void 0?ie:$3db38b7d1fb3fe6a$var$createFocusGuard()),document.body.insertAdjacentElement("beforeend",(Z=ee[1])!==null&&Z!==void 0?Z:$3db38b7d1fb3fe6a$var$createFocusGuard()),$3db38b7d1fb3fe6a$var$count++,()=>{$3db38b7d1fb3fe6a$var$count===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(ae=>ae.remove()),$3db38b7d1fb3fe6a$var$count--}},[])}function $3db38b7d1fb3fe6a$var$createFocusGuard(){const ie=document.createElement("span");return ie.setAttribute("data-radix-focus-guard",""),ie.tabIndex=0,ie.style.cssText="outline: none; opacity: 0; position: fixed; pointer-events: none",ie}const $d3863c46a17e8a28$var$AUTOFOCUS_ON_MOUNT="focusScope.autoFocusOnMount",$d3863c46a17e8a28$var$AUTOFOCUS_ON_UNMOUNT="focusScope.autoFocusOnUnmount",$d3863c46a17e8a28$var$EVENT_OPTIONS={bubbles:!1,cancelable:!0},$d3863c46a17e8a28$export$20e40289641fbbb6=reactExports.forwardRef((ie,Z)=>{const{loop:ee=!1,trapped:ae=!1,onMountAutoFocus:ve,onUnmountAutoFocus:ye,...be}=ie,[Ke,Ye]=reactExports.useState(null),Xe=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(ve),Qe=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(ye),et=reactExports.useRef(null),Je=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(Z,nt=>Ye(nt)),rt=reactExports.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;reactExports.useEffect(()=>{if(ae){let nt=function(ut){if(rt.paused||!Ke)return;const ft=ut.target;Ke.contains(ft)?et.current=ft:$d3863c46a17e8a28$var$focus(et.current,{select:!0})},tt=function(ut){if(rt.paused||!Ke)return;const ft=ut.relatedTarget;ft!==null&&(Ke.contains(ft)||$d3863c46a17e8a28$var$focus(et.current,{select:!0}))},st=function(ut){if(document.activeElement===document.body)for(const pt of ut)pt.removedNodes.length>0&&$d3863c46a17e8a28$var$focus(Ke)};document.addEventListener("focusin",nt),document.addEventListener("focusout",tt);const ot=new MutationObserver(st);return Ke&&ot.observe(Ke,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",nt),document.removeEventListener("focusout",tt),ot.disconnect()}}},[ae,Ke,rt.paused]),reactExports.useEffect(()=>{if(Ke){$d3863c46a17e8a28$var$focusScopesStack.add(rt);const nt=document.activeElement;if(!Ke.contains(nt)){const st=new CustomEvent($d3863c46a17e8a28$var$AUTOFOCUS_ON_MOUNT,$d3863c46a17e8a28$var$EVENT_OPTIONS);Ke.addEventListener($d3863c46a17e8a28$var$AUTOFOCUS_ON_MOUNT,Xe),Ke.dispatchEvent(st),st.defaultPrevented||($d3863c46a17e8a28$var$focusFirst($d3863c46a17e8a28$var$removeLinks($d3863c46a17e8a28$var$getTabbableCandidates(Ke)),{select:!0}),document.activeElement===nt&&$d3863c46a17e8a28$var$focus(Ke))}return()=>{Ke.removeEventListener($d3863c46a17e8a28$var$AUTOFOCUS_ON_MOUNT,Xe),setTimeout(()=>{const st=new CustomEvent($d3863c46a17e8a28$var$AUTOFOCUS_ON_UNMOUNT,$d3863c46a17e8a28$var$EVENT_OPTIONS);Ke.addEventListener($d3863c46a17e8a28$var$AUTOFOCUS_ON_UNMOUNT,Qe),Ke.dispatchEvent(st),st.defaultPrevented||$d3863c46a17e8a28$var$focus(nt??document.body,{select:!0}),Ke.removeEventListener($d3863c46a17e8a28$var$AUTOFOCUS_ON_UNMOUNT,Qe),$d3863c46a17e8a28$var$focusScopesStack.remove(rt)},0)}}},[Ke,Xe,Qe,rt]);const it=reactExports.useCallback(nt=>{if(!ee&&!ae||rt.paused)return;const tt=nt.key==="Tab"&&!nt.altKey&&!nt.ctrlKey&&!nt.metaKey,st=document.activeElement;if(tt&&st){const ot=nt.currentTarget,[ut,ft]=$d3863c46a17e8a28$var$getTabbableEdges(ot);ut&&ft?!nt.shiftKey&&st===ft?(nt.preventDefault(),ee&&$d3863c46a17e8a28$var$focus(ut,{select:!0})):nt.shiftKey&&st===ut&&(nt.preventDefault(),ee&&$d3863c46a17e8a28$var$focus(ft,{select:!0})):st===ot&&nt.preventDefault()}},[ee,ae,rt.paused]);return reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({tabIndex:-1},be,{ref:Je,onKeyDown:it}))});function $d3863c46a17e8a28$var$focusFirst(ie,{select:Z=!1}={}){const ee=document.activeElement;for(const ae of ie)if($d3863c46a17e8a28$var$focus(ae,{select:Z}),document.activeElement!==ee)return}function $d3863c46a17e8a28$var$getTabbableEdges(ie){const Z=$d3863c46a17e8a28$var$getTabbableCandidates(ie),ee=$d3863c46a17e8a28$var$findVisible(Z,ie),ae=$d3863c46a17e8a28$var$findVisible(Z.reverse(),ie);return[ee,ae]}function $d3863c46a17e8a28$var$getTabbableCandidates(ie){const Z=[],ee=document.createTreeWalker(ie,NodeFilter.SHOW_ELEMENT,{acceptNode:ae=>{const ve=ae.tagName==="INPUT"&&ae.type==="hidden";return ae.disabled||ae.hidden||ve?NodeFilter.FILTER_SKIP:ae.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;ee.nextNode();)Z.push(ee.currentNode);return Z}function $d3863c46a17e8a28$var$findVisible(ie,Z){for(const ee of ie)if(!$d3863c46a17e8a28$var$isHidden(ee,{upTo:Z}))return ee}function $d3863c46a17e8a28$var$isHidden(ie,{upTo:Z}){if(getComputedStyle(ie).visibility==="hidden")return!0;for(;ie;){if(Z!==void 0&&ie===Z)return!1;if(getComputedStyle(ie).display==="none")return!0;ie=ie.parentElement}return!1}function $d3863c46a17e8a28$var$isSelectableInput(ie){return ie instanceof HTMLInputElement&&"select"in ie}function $d3863c46a17e8a28$var$focus(ie,{select:Z=!1}={}){if(ie&&ie.focus){const ee=document.activeElement;ie.focus({preventScroll:!0}),ie!==ee&&$d3863c46a17e8a28$var$isSelectableInput(ie)&&Z&&ie.select()}}const $d3863c46a17e8a28$var$focusScopesStack=$d3863c46a17e8a28$var$createFocusScopesStack();function $d3863c46a17e8a28$var$createFocusScopesStack(){let ie=[];return{add(Z){const ee=ie[0];Z!==ee&&(ee==null||ee.pause()),ie=$d3863c46a17e8a28$var$arrayRemove(ie,Z),ie.unshift(Z)},remove(Z){var ee;ie=$d3863c46a17e8a28$var$arrayRemove(ie,Z),(ee=ie[0])===null||ee===void 0||ee.resume()}}}function $d3863c46a17e8a28$var$arrayRemove(ie,Z){const ee=[...ie],ae=ee.indexOf(Z);return ae!==-1&&ee.splice(ae,1),ee}function $d3863c46a17e8a28$var$removeLinks(ie){return ie.filter(Z=>Z.tagName!=="A")}const sides=["top","right","bottom","left"],min=Math.min,max=Math.max,round=Math.round,floor=Math.floor,createCoords=ie=>({x:ie,y:ie}),oppositeSideMap={left:"right",right:"left",bottom:"top",top:"bottom"},oppositeAlignmentMap={start:"end",end:"start"};function clamp(ie,Z,ee){return max(ie,min(Z,ee))}function evaluate(ie,Z){return typeof ie=="function"?ie(Z):ie}function getSide(ie){return ie.split("-")[0]}function getAlignment(ie){return ie.split("-")[1]}function getOppositeAxis(ie){return ie==="x"?"y":"x"}function getAxisLength(ie){return ie==="y"?"height":"width"}function getSideAxis(ie){return["top","bottom"].includes(getSide(ie))?"y":"x"}function getAlignmentAxis(ie){return getOppositeAxis(getSideAxis(ie))}function getAlignmentSides(ie,Z,ee){ee===void 0&&(ee=!1);const ae=getAlignment(ie),ve=getAlignmentAxis(ie),ye=getAxisLength(ve);let be=ve==="x"?ae===(ee?"end":"start")?"right":"left":ae==="start"?"bottom":"top";return Z.reference[ye]>Z.floating[ye]&&(be=getOppositePlacement(be)),[be,getOppositePlacement(be)]}function getExpandedPlacements(ie){const Z=getOppositePlacement(ie);return[getOppositeAlignmentPlacement(ie),Z,getOppositeAlignmentPlacement(Z)]}function getOppositeAlignmentPlacement(ie){return ie.replace(/start|end/g,Z=>oppositeAlignmentMap[Z])}function getSideList(ie,Z,ee){const ae=["left","right"],ve=["right","left"],ye=["top","bottom"],be=["bottom","top"];switch(ie){case"top":case"bottom":return ee?Z?ve:ae:Z?ae:ve;case"left":case"right":return Z?ye:be;default:return[]}}function getOppositeAxisPlacements(ie,Z,ee,ae){const ve=getAlignment(ie);let ye=getSideList(getSide(ie),ee==="start",ae);return ve&&(ye=ye.map(be=>be+"-"+ve),Z&&(ye=ye.concat(ye.map(getOppositeAlignmentPlacement)))),ye}function getOppositePlacement(ie){return ie.replace(/left|right|bottom|top/g,Z=>oppositeSideMap[Z])}function expandPaddingObject(ie){return{top:0,right:0,bottom:0,left:0,...ie}}function getPaddingObject(ie){return typeof ie!="number"?expandPaddingObject(ie):{top:ie,right:ie,bottom:ie,left:ie}}function rectToClientRect(ie){return{...ie,top:ie.y,left:ie.x,right:ie.x+ie.width,bottom:ie.y+ie.height}}function computeCoordsFromPlacement(ie,Z,ee){let{reference:ae,floating:ve}=ie;const ye=getSideAxis(Z),be=getAlignmentAxis(Z),Ke=getAxisLength(be),Ye=getSide(Z),Xe=ye==="y",Qe=ae.x+ae.width/2-ve.width/2,et=ae.y+ae.height/2-ve.height/2,Je=ae[Ke]/2-ve[Ke]/2;let rt;switch(Ye){case"top":rt={x:Qe,y:ae.y-ve.height};break;case"bottom":rt={x:Qe,y:ae.y+ae.height};break;case"right":rt={x:ae.x+ae.width,y:et};break;case"left":rt={x:ae.x-ve.width,y:et};break;default:rt={x:ae.x,y:ae.y}}switch(getAlignment(Z)){case"start":rt[be]-=Je*(ee&&Xe?-1:1);break;case"end":rt[be]+=Je*(ee&&Xe?-1:1);break}return rt}const computePosition$1=async(ie,Z,ee)=>{const{placement:ae="bottom",strategy:ve="absolute",middleware:ye=[],platform:be}=ee,Ke=ye.filter(Boolean),Ye=await(be.isRTL==null?void 0:be.isRTL(Z));let Xe=await be.getElementRects({reference:ie,floating:Z,strategy:ve}),{x:Qe,y:et}=computeCoordsFromPlacement(Xe,ae,Ye),Je=ae,rt={},it=0;for(let nt=0;nt<Ke.length;nt++){const{name:tt,fn:st}=Ke[nt],{x:ot,y:ut,data:ft,reset:pt}=await st({x:Qe,y:et,initialPlacement:ae,placement:Je,strategy:ve,middlewareData:rt,rects:Xe,platform:be,elements:{reference:ie,floating:Z}});if(Qe=ot??Qe,et=ut??et,rt={...rt,[tt]:{...rt[tt],...ft}},pt&&it<=50){it++,typeof pt=="object"&&(pt.placement&&(Je=pt.placement),pt.rects&&(Xe=pt.rects===!0?await be.getElementRects({reference:ie,floating:Z,strategy:ve}):pt.rects),{x:Qe,y:et}=computeCoordsFromPlacement(Xe,Je,Ye)),nt=-1;continue}}return{x:Qe,y:et,placement:Je,strategy:ve,middlewareData:rt}};async function detectOverflow(ie,Z){var ee;Z===void 0&&(Z={});const{x:ae,y:ve,platform:ye,rects:be,elements:Ke,strategy:Ye}=ie,{boundary:Xe="clippingAncestors",rootBoundary:Qe="viewport",elementContext:et="floating",altBoundary:Je=!1,padding:rt=0}=evaluate(Z,ie),it=getPaddingObject(rt),tt=Ke[Je?et==="floating"?"reference":"floating":et],st=rectToClientRect(await ye.getClippingRect({element:(ee=await(ye.isElement==null?void 0:ye.isElement(tt)))==null||ee?tt:tt.contextElement||await(ye.getDocumentElement==null?void 0:ye.getDocumentElement(Ke.floating)),boundary:Xe,rootBoundary:Qe,strategy:Ye})),ot=et==="floating"?{...be.floating,x:ae,y:ve}:be.reference,ut=await(ye.getOffsetParent==null?void 0:ye.getOffsetParent(Ke.floating)),ft=await(ye.isElement==null?void 0:ye.isElement(ut))?await(ye.getScale==null?void 0:ye.getScale(ut))||{x:1,y:1}:{x:1,y:1},pt=rectToClientRect(ye.convertOffsetParentRelativeRectToViewportRelativeRect?await ye.convertOffsetParentRelativeRectToViewportRelativeRect({rect:ot,offsetParent:ut,strategy:Ye}):ot);return{top:(st.top-pt.top+it.top)/ft.y,bottom:(pt.bottom-st.bottom+it.bottom)/ft.y,left:(st.left-pt.left+it.left)/ft.x,right:(pt.right-st.right+it.right)/ft.x}}const arrow$1=ie=>({name:"arrow",options:ie,async fn(Z){const{x:ee,y:ae,placement:ve,rects:ye,platform:be,elements:Ke,middlewareData:Ye}=Z,{element:Xe,padding:Qe=0}=evaluate(ie,Z)||{};if(Xe==null)return{};const et=getPaddingObject(Qe),Je={x:ee,y:ae},rt=getAlignmentAxis(ve),it=getAxisLength(rt),nt=await be.getDimensions(Xe),tt=rt==="y",st=tt?"top":"left",ot=tt?"bottom":"right",ut=tt?"clientHeight":"clientWidth",ft=ye.reference[it]+ye.reference[rt]-Je[rt]-ye.floating[it],pt=Je[rt]-ye.reference[rt],Xr=await(be.getOffsetParent==null?void 0:be.getOffsetParent(Xe));let mt=Xr?Xr[ut]:0;(!mt||!await(be.isElement==null?void 0:be.isElement(Xr)))&&(mt=Ke.floating[ut]||ye.floating[it]);const Yr=ft/2-pt/2,ri=mt/2-nt[it]/2-1,Zr=min(et[st],ri),_r=min(et[ot],ri),Kr=Zr,si=mt-nt[it]-_r,oi=mt/2-nt[it]/2+Yr,Qr=clamp(Kr,oi,si),ii=!Ye.arrow&&getAlignment(ve)!=null&&oi!=Qr&&ye.reference[it]/2-(oi<Kr?Zr:_r)-nt[it]/2<0,ti=ii?oi<Kr?oi-Kr:oi-si:0;return{[rt]:Je[rt]+ti,data:{[rt]:Qr,centerOffset:oi-Qr-ti,...ii&&{alignmentOffset:ti}},reset:ii}}}),flip=function(ie){return ie===void 0&&(ie={}),{name:"flip",options:ie,async fn(Z){var ee,ae;const{placement:ve,middlewareData:ye,rects:be,initialPlacement:Ke,platform:Ye,elements:Xe}=Z,{mainAxis:Qe=!0,crossAxis:et=!0,fallbackPlacements:Je,fallbackStrategy:rt="bestFit",fallbackAxisSideDirection:it="none",flipAlignment:nt=!0,...tt}=evaluate(ie,Z);if((ee=ye.arrow)!=null&&ee.alignmentOffset)return{};const st=getSide(ve),ot=getSide(Ke)===Ke,ut=await(Ye.isRTL==null?void 0:Ye.isRTL(Xe.floating)),ft=Je||(ot||!nt?[getOppositePlacement(Ke)]:getExpandedPlacements(Ke));!Je&&it!=="none"&&ft.push(...getOppositeAxisPlacements(Ke,nt,it,ut));const pt=[Ke,...ft],Xr=await detectOverflow(Z,tt),mt=[];let Yr=((ae=ye.flip)==null?void 0:ae.overflows)||[];if(Qe&&mt.push(Xr[st]),et){const Kr=getAlignmentSides(ve,be,ut);mt.push(Xr[Kr[0]],Xr[Kr[1]])}if(Yr=[...Yr,{placement:ve,overflows:mt}],!mt.every(Kr=>Kr<=0)){var ri,Zr;const Kr=(((ri=ye.flip)==null?void 0:ri.index)||0)+1,si=pt[Kr];if(si)return{data:{index:Kr,overflows:Yr},reset:{placement:si}};let oi=(Zr=Yr.filter(Qr=>Qr.overflows[0]<=0).sort((Qr,ii)=>Qr.overflows[1]-ii.overflows[1])[0])==null?void 0:Zr.placement;if(!oi)switch(rt){case"bestFit":{var _r;const Qr=(_r=Yr.map(ii=>[ii.placement,ii.overflows.filter(ti=>ti>0).reduce((ti,ni)=>ti+ni,0)]).sort((ii,ti)=>ii[1]-ti[1])[0])==null?void 0:_r[0];Qr&&(oi=Qr);break}case"initialPlacement":oi=Ke;break}if(ve!==oi)return{reset:{placement:oi}}}return{}}}};function getSideOffsets(ie,Z){return{top:ie.top-Z.height,right:ie.right-Z.width,bottom:ie.bottom-Z.height,left:ie.left-Z.width}}function isAnySideFullyClipped(ie){return sides.some(Z=>ie[Z]>=0)}const hide=function(ie){return ie===void 0&&(ie={}),{name:"hide",options:ie,async fn(Z){const{rects:ee}=Z,{strategy:ae="referenceHidden",...ve}=evaluate(ie,Z);switch(ae){case"referenceHidden":{const ye=await detectOverflow(Z,{...ve,elementContext:"reference"}),be=getSideOffsets(ye,ee.reference);return{data:{referenceHiddenOffsets:be,referenceHidden:isAnySideFullyClipped(be)}}}case"escaped":{const ye=await detectOverflow(Z,{...ve,altBoundary:!0}),be=getSideOffsets(ye,ee.floating);return{data:{escapedOffsets:be,escaped:isAnySideFullyClipped(be)}}}default:return{}}}}};async function convertValueToCoords(ie,Z){const{placement:ee,platform:ae,elements:ve}=ie,ye=await(ae.isRTL==null?void 0:ae.isRTL(ve.floating)),be=getSide(ee),Ke=getAlignment(ee),Ye=getSideAxis(ee)==="y",Xe=["left","top"].includes(be)?-1:1,Qe=ye&&Ye?-1:1,et=evaluate(Z,ie);let{mainAxis:Je,crossAxis:rt,alignmentAxis:it}=typeof et=="number"?{mainAxis:et,crossAxis:0,alignmentAxis:null}:{mainAxis:0,crossAxis:0,alignmentAxis:null,...et};return Ke&&typeof it=="number"&&(rt=Ke==="end"?it*-1:it),Ye?{x:rt*Qe,y:Je*Xe}:{x:Je*Xe,y:rt*Qe}}const offset=function(ie){return ie===void 0&&(ie=0),{name:"offset",options:ie,async fn(Z){const{x:ee,y:ae}=Z,ve=await convertValueToCoords(Z,ie);return{x:ee+ve.x,y:ae+ve.y,data:ve}}}},shift=function(ie){return ie===void 0&&(ie={}),{name:"shift",options:ie,async fn(Z){const{x:ee,y:ae,placement:ve}=Z,{mainAxis:ye=!0,crossAxis:be=!1,limiter:Ke={fn:tt=>{let{x:st,y:ot}=tt;return{x:st,y:ot}}},...Ye}=evaluate(ie,Z),Xe={x:ee,y:ae},Qe=await detectOverflow(Z,Ye),et=getSideAxis(getSide(ve)),Je=getOppositeAxis(et);let rt=Xe[Je],it=Xe[et];if(ye){const tt=Je==="y"?"top":"left",st=Je==="y"?"bottom":"right",ot=rt+Qe[tt],ut=rt-Qe[st];rt=clamp(ot,rt,ut)}if(be){const tt=et==="y"?"top":"left",st=et==="y"?"bottom":"right",ot=it+Qe[tt],ut=it-Qe[st];it=clamp(ot,it,ut)}const nt=Ke.fn({...Z,[Je]:rt,[et]:it});return{...nt,data:{x:nt.x-ee,y:nt.y-ae}}}}},limitShift=function(ie){return ie===void 0&&(ie={}),{options:ie,fn(Z){const{x:ee,y:ae,placement:ve,rects:ye,middlewareData:be}=Z,{offset:Ke=0,mainAxis:Ye=!0,crossAxis:Xe=!0}=evaluate(ie,Z),Qe={x:ee,y:ae},et=getSideAxis(ve),Je=getOppositeAxis(et);let rt=Qe[Je],it=Qe[et];const nt=evaluate(Ke,Z),tt=typeof nt=="number"?{mainAxis:nt,crossAxis:0}:{mainAxis:0,crossAxis:0,...nt};if(Ye){const ut=Je==="y"?"height":"width",ft=ye.reference[Je]-ye.floating[ut]+tt.mainAxis,pt=ye.reference[Je]+ye.reference[ut]-tt.mainAxis;rt<ft?rt=ft:rt>pt&&(rt=pt)}if(Xe){var st,ot;const ut=Je==="y"?"width":"height",ft=["top","left"].includes(getSide(ve)),pt=ye.reference[et]-ye.floating[ut]+(ft&&((st=be.offset)==null?void 0:st[et])||0)+(ft?0:tt.crossAxis),Xr=ye.reference[et]+ye.reference[ut]+(ft?0:((ot=be.offset)==null?void 0:ot[et])||0)-(ft?tt.crossAxis:0);it<pt?it=pt:it>Xr&&(it=Xr)}return{[Je]:rt,[et]:it}}}},size=function(ie){return ie===void 0&&(ie={}),{name:"size",options:ie,async fn(Z){const{placement:ee,rects:ae,platform:ve,elements:ye}=Z,{apply:be=()=>{},...Ke}=evaluate(ie,Z),Ye=await detectOverflow(Z,Ke),Xe=getSide(ee),Qe=getAlignment(ee),et=getSideAxis(ee)==="y",{width:Je,height:rt}=ae.floating;let it,nt;Xe==="top"||Xe==="bottom"?(it=Xe,nt=Qe===(await(ve.isRTL==null?void 0:ve.isRTL(ye.floating))?"start":"end")?"left":"right"):(nt=Xe,it=Qe==="end"?"top":"bottom");const tt=rt-Ye[it],st=Je-Ye[nt],ot=!Z.middlewareData.shift;let ut=tt,ft=st;if(et){const Xr=Je-Ye.left-Ye.right;ft=Qe||ot?min(st,Xr):Xr}else{const Xr=rt-Ye.top-Ye.bottom;ut=Qe||ot?min(tt,Xr):Xr}if(ot&&!Qe){const Xr=max(Ye.left,0),mt=max(Ye.right,0),Yr=max(Ye.top,0),ri=max(Ye.bottom,0);et?ft=Je-2*(Xr!==0||mt!==0?Xr+mt:max(Ye.left,Ye.right)):ut=rt-2*(Yr!==0||ri!==0?Yr+ri:max(Ye.top,Ye.bottom))}await be({...Z,availableWidth:ft,availableHeight:ut});const pt=await ve.getDimensions(ye.floating);return Je!==pt.width||rt!==pt.height?{reset:{rects:!0}}:{}}}};function getNodeName(ie){return isNode(ie)?(ie.nodeName||"").toLowerCase():"#document"}function getWindow(ie){var Z;return(ie==null||(Z=ie.ownerDocument)==null?void 0:Z.defaultView)||window}function getDocumentElement(ie){var Z;return(Z=(isNode(ie)?ie.ownerDocument:ie.document)||window.document)==null?void 0:Z.documentElement}function isNode(ie){return ie instanceof Node||ie instanceof getWindow(ie).Node}function isElement(ie){return ie instanceof Element||ie instanceof getWindow(ie).Element}function isHTMLElement(ie){return ie instanceof HTMLElement||ie instanceof getWindow(ie).HTMLElement}function isShadowRoot(ie){return typeof ShadowRoot>"u"?!1:ie instanceof ShadowRoot||ie instanceof getWindow(ie).ShadowRoot}function isOverflowElement(ie){const{overflow:Z,overflowX:ee,overflowY:ae,display:ve}=getComputedStyle$1(ie);return/auto|scroll|overlay|hidden|clip/.test(Z+ae+ee)&&!["inline","contents"].includes(ve)}function isTableElement(ie){return["table","td","th"].includes(getNodeName(ie))}function isContainingBlock(ie){const Z=isWebKit(),ee=getComputedStyle$1(ie);return ee.transform!=="none"||ee.perspective!=="none"||(ee.containerType?ee.containerType!=="normal":!1)||!Z&&(ee.backdropFilter?ee.backdropFilter!=="none":!1)||!Z&&(ee.filter?ee.filter!=="none":!1)||["transform","perspective","filter"].some(ae=>(ee.willChange||"").includes(ae))||["paint","layout","strict","content"].some(ae=>(ee.contain||"").includes(ae))}function getContainingBlock(ie){let Z=getParentNode(ie);for(;isHTMLElement(Z)&&!isLastTraversableNode(Z);){if(isContainingBlock(Z))return Z;Z=getParentNode(Z)}return null}function isWebKit(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function isLastTraversableNode(ie){return["html","body","#document"].includes(getNodeName(ie))}function getComputedStyle$1(ie){return getWindow(ie).getComputedStyle(ie)}function getNodeScroll(ie){return isElement(ie)?{scrollLeft:ie.scrollLeft,scrollTop:ie.scrollTop}:{scrollLeft:ie.pageXOffset,scrollTop:ie.pageYOffset}}function getParentNode(ie){if(getNodeName(ie)==="html")return ie;const Z=ie.assignedSlot||ie.parentNode||isShadowRoot(ie)&&ie.host||getDocumentElement(ie);return isShadowRoot(Z)?Z.host:Z}function getNearestOverflowAncestor(ie){const Z=getParentNode(ie);return isLastTraversableNode(Z)?ie.ownerDocument?ie.ownerDocument.body:ie.body:isHTMLElement(Z)&&isOverflowElement(Z)?Z:getNearestOverflowAncestor(Z)}function getOverflowAncestors(ie,Z,ee){var ae;Z===void 0&&(Z=[]),ee===void 0&&(ee=!0);const ve=getNearestOverflowAncestor(ie),ye=ve===((ae=ie.ownerDocument)==null?void 0:ae.body),be=getWindow(ve);return ye?Z.concat(be,be.visualViewport||[],isOverflowElement(ve)?ve:[],be.frameElement&&ee?getOverflowAncestors(be.frameElement):[]):Z.concat(ve,getOverflowAncestors(ve,[],ee))}function getCssDimensions(ie){const Z=getComputedStyle$1(ie);let ee=parseFloat(Z.width)||0,ae=parseFloat(Z.height)||0;const ve=isHTMLElement(ie),ye=ve?ie.offsetWidth:ee,be=ve?ie.offsetHeight:ae,Ke=round(ee)!==ye||round(ae)!==be;return Ke&&(ee=ye,ae=be),{width:ee,height:ae,$:Ke}}function unwrapElement(ie){return isElement(ie)?ie:ie.contextElement}function getScale(ie){const Z=unwrapElement(ie);if(!isHTMLElement(Z))return createCoords(1);const ee=Z.getBoundingClientRect(),{width:ae,height:ve,$:ye}=getCssDimensions(Z);let be=(ye?round(ee.width):ee.width)/ae,Ke=(ye?round(ee.height):ee.height)/ve;return(!be||!Number.isFinite(be))&&(be=1),(!Ke||!Number.isFinite(Ke))&&(Ke=1),{x:be,y:Ke}}const noOffsets=createCoords(0);function getVisualOffsets(ie){const Z=getWindow(ie);return!isWebKit()||!Z.visualViewport?noOffsets:{x:Z.visualViewport.offsetLeft,y:Z.visualViewport.offsetTop}}function shouldAddVisualOffsets(ie,Z,ee){return Z===void 0&&(Z=!1),!ee||Z&&ee!==getWindow(ie)?!1:Z}function getBoundingClientRect(ie,Z,ee,ae){Z===void 0&&(Z=!1),ee===void 0&&(ee=!1);const ve=ie.getBoundingClientRect(),ye=unwrapElement(ie);let be=createCoords(1);Z&&(ae?isElement(ae)&&(be=getScale(ae)):be=getScale(ie));const Ke=shouldAddVisualOffsets(ye,ee,ae)?getVisualOffsets(ye):createCoords(0);let Ye=(ve.left+Ke.x)/be.x,Xe=(ve.top+Ke.y)/be.y,Qe=ve.width/be.x,et=ve.height/be.y;if(ye){const Je=getWindow(ye),rt=ae&&isElement(ae)?getWindow(ae):ae;let it=Je.frameElement;for(;it&&ae&&rt!==Je;){const nt=getScale(it),tt=it.getBoundingClientRect(),st=getComputedStyle$1(it),ot=tt.left+(it.clientLeft+parseFloat(st.paddingLeft))*nt.x,ut=tt.top+(it.clientTop+parseFloat(st.paddingTop))*nt.y;Ye*=nt.x,Xe*=nt.y,Qe*=nt.x,et*=nt.y,Ye+=ot,Xe+=ut,it=getWindow(it).frameElement}}return rectToClientRect({width:Qe,height:et,x:Ye,y:Xe})}function convertOffsetParentRelativeRectToViewportRelativeRect(ie){let{rect:Z,offsetParent:ee,strategy:ae}=ie;const ve=isHTMLElement(ee),ye=getDocumentElement(ee);if(ee===ye)return Z;let be={scrollLeft:0,scrollTop:0},Ke=createCoords(1);const Ye=createCoords(0);if((ve||!ve&&ae!=="fixed")&&((getNodeName(ee)!=="body"||isOverflowElement(ye))&&(be=getNodeScroll(ee)),isHTMLElement(ee))){const Xe=getBoundingClientRect(ee);Ke=getScale(ee),Ye.x=Xe.x+ee.clientLeft,Ye.y=Xe.y+ee.clientTop}return{width:Z.width*Ke.x,height:Z.height*Ke.y,x:Z.x*Ke.x-be.scrollLeft*Ke.x+Ye.x,y:Z.y*Ke.y-be.scrollTop*Ke.y+Ye.y}}function getClientRects(ie){return Array.from(ie.getClientRects())}function getWindowScrollBarX(ie){return getBoundingClientRect(getDocumentElement(ie)).left+getNodeScroll(ie).scrollLeft}function getDocumentRect(ie){const Z=getDocumentElement(ie),ee=getNodeScroll(ie),ae=ie.ownerDocument.body,ve=max(Z.scrollWidth,Z.clientWidth,ae.scrollWidth,ae.clientWidth),ye=max(Z.scrollHeight,Z.clientHeight,ae.scrollHeight,ae.clientHeight);let be=-ee.scrollLeft+getWindowScrollBarX(ie);const Ke=-ee.scrollTop;return getComputedStyle$1(ae).direction==="rtl"&&(be+=max(Z.clientWidth,ae.clientWidth)-ve),{width:ve,height:ye,x:be,y:Ke}}function getViewportRect(ie,Z){const ee=getWindow(ie),ae=getDocumentElement(ie),ve=ee.visualViewport;let ye=ae.clientWidth,be=ae.clientHeight,Ke=0,Ye=0;if(ve){ye=ve.width,be=ve.height;const Xe=isWebKit();(!Xe||Xe&&Z==="fixed")&&(Ke=ve.offsetLeft,Ye=ve.offsetTop)}return{width:ye,height:be,x:Ke,y:Ye}}function getInnerBoundingClientRect(ie,Z){const ee=getBoundingClientRect(ie,!0,Z==="fixed"),ae=ee.top+ie.clientTop,ve=ee.left+ie.clientLeft,ye=isHTMLElement(ie)?getScale(ie):createCoords(1),be=ie.clientWidth*ye.x,Ke=ie.clientHeight*ye.y,Ye=ve*ye.x,Xe=ae*ye.y;return{width:be,height:Ke,x:Ye,y:Xe}}function getClientRectFromClippingAncestor(ie,Z,ee){let ae;if(Z==="viewport")ae=getViewportRect(ie,ee);else if(Z==="document")ae=getDocumentRect(getDocumentElement(ie));else if(isElement(Z))ae=getInnerBoundingClientRect(Z,ee);else{const ve=getVisualOffsets(ie);ae={...Z,x:Z.x-ve.x,y:Z.y-ve.y}}return rectToClientRect(ae)}function hasFixedPositionAncestor(ie,Z){const ee=getParentNode(ie);return ee===Z||!isElement(ee)||isLastTraversableNode(ee)?!1:getComputedStyle$1(ee).position==="fixed"||hasFixedPositionAncestor(ee,Z)}function getClippingElementAncestors(ie,Z){const ee=Z.get(ie);if(ee)return ee;let ae=getOverflowAncestors(ie,[],!1).filter(Ke=>isElement(Ke)&&getNodeName(Ke)!=="body"),ve=null;const ye=getComputedStyle$1(ie).position==="fixed";let be=ye?getParentNode(ie):ie;for(;isElement(be)&&!isLastTraversableNode(be);){const Ke=getComputedStyle$1(be),Ye=isContainingBlock(be);!Ye&&Ke.position==="fixed"&&(ve=null),(ye?!Ye&&!ve:!Ye&&Ke.position==="static"&&!!ve&&["absolute","fixed"].includes(ve.position)||isOverflowElement(be)&&!Ye&&hasFixedPositionAncestor(ie,be))?ae=ae.filter(Qe=>Qe!==be):ve=Ke,be=getParentNode(be)}return Z.set(ie,ae),ae}function getClippingRect(ie){let{element:Z,boundary:ee,rootBoundary:ae,strategy:ve}=ie;const be=[...ee==="clippingAncestors"?getClippingElementAncestors(Z,this._c):[].concat(ee),ae],Ke=be[0],Ye=be.reduce((Xe,Qe)=>{const et=getClientRectFromClippingAncestor(Z,Qe,ve);return Xe.top=max(et.top,Xe.top),Xe.right=min(et.right,Xe.right),Xe.bottom=min(et.bottom,Xe.bottom),Xe.left=max(et.left,Xe.left),Xe},getClientRectFromClippingAncestor(Z,Ke,ve));return{width:Ye.right-Ye.left,height:Ye.bottom-Ye.top,x:Ye.left,y:Ye.top}}function getDimensions(ie){return getCssDimensions(ie)}function getRectRelativeToOffsetParent(ie,Z,ee){const ae=isHTMLElement(Z),ve=getDocumentElement(Z),ye=ee==="fixed",be=getBoundingClientRect(ie,!0,ye,Z);let Ke={scrollLeft:0,scrollTop:0};const Ye=createCoords(0);if(ae||!ae&&!ye)if((getNodeName(Z)!=="body"||isOverflowElement(ve))&&(Ke=getNodeScroll(Z)),ae){const Xe=getBoundingClientRect(Z,!0,ye,Z);Ye.x=Xe.x+Z.clientLeft,Ye.y=Xe.y+Z.clientTop}else ve&&(Ye.x=getWindowScrollBarX(ve));return{x:be.left+Ke.scrollLeft-Ye.x,y:be.top+Ke.scrollTop-Ye.y,width:be.width,height:be.height}}function getTrueOffsetParent(ie,Z){return!isHTMLElement(ie)||getComputedStyle$1(ie).position==="fixed"?null:Z?Z(ie):ie.offsetParent}function getOffsetParent(ie,Z){const ee=getWindow(ie);if(!isHTMLElement(ie))return ee;let ae=getTrueOffsetParent(ie,Z);for(;ae&&isTableElement(ae)&&getComputedStyle$1(ae).position==="static";)ae=getTrueOffsetParent(ae,Z);return ae&&(getNodeName(ae)==="html"||getNodeName(ae)==="body"&&getComputedStyle$1(ae).position==="static"&&!isContainingBlock(ae))?ee:ae||getContainingBlock(ie)||ee}const getElementRects=async function(ie){let{reference:Z,floating:ee,strategy:ae}=ie;const ve=this.getOffsetParent||getOffsetParent,ye=this.getDimensions;return{reference:getRectRelativeToOffsetParent(Z,await ve(ee),ae),floating:{x:0,y:0,...await ye(ee)}}};function isRTL(ie){return getComputedStyle$1(ie).direction==="rtl"}const platform={convertOffsetParentRelativeRectToViewportRelativeRect,getDocumentElement,getClippingRect,getOffsetParent,getElementRects,getClientRects,getDimensions,getScale,isElement,isRTL};function observeMove(ie,Z){let ee=null,ae;const ve=getDocumentElement(ie);function ye(){clearTimeout(ae),ee&&ee.disconnect(),ee=null}function be(Ke,Ye){Ke===void 0&&(Ke=!1),Ye===void 0&&(Ye=1),ye();const{left:Xe,top:Qe,width:et,height:Je}=ie.getBoundingClientRect();if(Ke||Z(),!et||!Je)return;const rt=floor(Qe),it=floor(ve.clientWidth-(Xe+et)),nt=floor(ve.clientHeight-(Qe+Je)),tt=floor(Xe),ot={rootMargin:-rt+"px "+-it+"px "+-nt+"px "+-tt+"px",threshold:max(0,min(1,Ye))||1};let ut=!0;function ft(pt){const Xr=pt[0].intersectionRatio;if(Xr!==Ye){if(!ut)return be();Xr?be(!1,Xr):ae=setTimeout(()=>{be(!1,1e-7)},100)}ut=!1}try{ee=new IntersectionObserver(ft,{...ot,root:ve.ownerDocument})}catch{ee=new IntersectionObserver(ft,ot)}ee.observe(ie)}return be(!0),ye}function autoUpdate(ie,Z,ee,ae){ae===void 0&&(ae={});const{ancestorScroll:ve=!0,ancestorResize:ye=!0,elementResize:be=typeof ResizeObserver=="function",layoutShift:Ke=typeof IntersectionObserver=="function",animationFrame:Ye=!1}=ae,Xe=unwrapElement(ie),Qe=ve||ye?[...Xe?getOverflowAncestors(Xe):[],...getOverflowAncestors(Z)]:[];Qe.forEach(st=>{ve&&st.addEventListener("scroll",ee,{passive:!0}),ye&&st.addEventListener("resize",ee)});const et=Xe&&Ke?observeMove(Xe,ee):null;let Je=-1,rt=null;be&&(rt=new ResizeObserver(st=>{let[ot]=st;ot&&ot.target===Xe&&rt&&(rt.unobserve(Z),cancelAnimationFrame(Je),Je=requestAnimationFrame(()=>{rt&&rt.observe(Z)})),ee()}),Xe&&!Ye&&rt.observe(Xe),rt.observe(Z));let it,nt=Ye?getBoundingClientRect(ie):null;Ye&&tt();function tt(){const st=getBoundingClientRect(ie);nt&&(st.x!==nt.x||st.y!==nt.y||st.width!==nt.width||st.height!==nt.height)&&ee(),nt=st,it=requestAnimationFrame(tt)}return ee(),()=>{Qe.forEach(st=>{ve&&st.removeEventListener("scroll",ee),ye&&st.removeEventListener("resize",ee)}),et&&et(),rt&&rt.disconnect(),rt=null,Ye&&cancelAnimationFrame(it)}}const computePosition=(ie,Z,ee)=>{const ae=new Map,ve={platform,...ee},ye={...ve.platform,_c:ae};return computePosition$1(ie,Z,{...ve,platform:ye})},arrow=ie=>{function Z(ee){return{}.hasOwnProperty.call(ee,"current")}return{name:"arrow",options:ie,fn(ee){const{element:ae,padding:ve}=typeof ie=="function"?ie(ee):ie;return ae&&Z(ae)?ae.current!=null?arrow$1({element:ae.current,padding:ve}).fn(ee):{}:ae?arrow$1({element:ae,padding:ve}).fn(ee):{}}}};var index=typeof document<"u"?reactExports.useLayoutEffect:reactExports.useEffect;function deepEqual(ie,Z){if(ie===Z)return!0;if(typeof ie!=typeof Z)return!1;if(typeof ie=="function"&&ie.toString()===Z.toString())return!0;let ee,ae,ve;if(ie&&Z&&typeof ie=="object"){if(Array.isArray(ie)){if(ee=ie.length,ee!=Z.length)return!1;for(ae=ee;ae--!==0;)if(!deepEqual(ie[ae],Z[ae]))return!1;return!0}if(ve=Object.keys(ie),ee=ve.length,ee!==Object.keys(Z).length)return!1;for(ae=ee;ae--!==0;)if(!{}.hasOwnProperty.call(Z,ve[ae]))return!1;for(ae=ee;ae--!==0;){const ye=ve[ae];if(!(ye==="_owner"&&ie.$$typeof)&&!deepEqual(ie[ye],Z[ye]))return!1}return!0}return ie!==ie&&Z!==Z}function getDPR(ie){return typeof window>"u"?1:(ie.ownerDocument.defaultView||window).devicePixelRatio||1}function roundByDPR(ie,Z){const ee=getDPR(ie);return Math.round(Z*ee)/ee}function useLatestRef(ie){const Z=reactExports.useRef(ie);return index(()=>{Z.current=ie}),Z}function useFloating(ie){ie===void 0&&(ie={});const{placement:Z="bottom",strategy:ee="absolute",middleware:ae=[],platform:ve,elements:{reference:ye,floating:be}={},transform:Ke=!0,whileElementsMounted:Ye,open:Xe}=ie,[Qe,et]=reactExports.useState({x:0,y:0,strategy:ee,placement:Z,middlewareData:{},isPositioned:!1}),[Je,rt]=reactExports.useState(ae);deepEqual(Je,ae)||rt(ae);const[it,nt]=reactExports.useState(null),[tt,st]=reactExports.useState(null),ot=reactExports.useCallback(ii=>{ii!=Xr.current&&(Xr.current=ii,nt(ii))},[nt]),ut=reactExports.useCallback(ii=>{ii!==mt.current&&(mt.current=ii,st(ii))},[st]),ft=ye||it,pt=be||tt,Xr=reactExports.useRef(null),mt=reactExports.useRef(null),Yr=reactExports.useRef(Qe),ri=useLatestRef(Ye),Zr=useLatestRef(ve),_r=reactExports.useCallback(()=>{if(!Xr.current||!mt.current)return;const ii={placement:Z,strategy:ee,middleware:Je};Zr.current&&(ii.platform=Zr.current),computePosition(Xr.current,mt.current,ii).then(ti=>{const ni={...ti,isPositioned:!0};Kr.current&&!deepEqual(Yr.current,ni)&&(Yr.current=ni,reactDomExports.flushSync(()=>{et(ni)}))})},[Je,Z,ee,Zr]);index(()=>{Xe===!1&&Yr.current.isPositioned&&(Yr.current.isPositioned=!1,et(ii=>({...ii,isPositioned:!1})))},[Xe]);const Kr=reactExports.useRef(!1);index(()=>(Kr.current=!0,()=>{Kr.current=!1}),[]),index(()=>{if(ft&&(Xr.current=ft),pt&&(mt.current=pt),ft&&pt){if(ri.current)return ri.current(ft,pt,_r);_r()}},[ft,pt,_r,ri]);const si=reactExports.useMemo(()=>({reference:Xr,floating:mt,setReference:ot,setFloating:ut}),[ot,ut]),oi=reactExports.useMemo(()=>({reference:ft,floating:pt}),[ft,pt]),Qr=reactExports.useMemo(()=>{const ii={position:ee,left:0,top:0};if(!oi.floating)return ii;const ti=roundByDPR(oi.floating,Qe.x),ni=roundByDPR(oi.floating,Qe.y);return Ke?{...ii,transform:"translate("+ti+"px, "+ni+"px)",...getDPR(oi.floating)>=1.5&&{willChange:"transform"}}:{position:ee,left:ti,top:ni}},[ee,Ke,oi.floating,Qe.x,Qe.y]);return reactExports.useMemo(()=>({...Qe,update:_r,refs:si,elements:oi,floatingStyles:Qr}),[Qe,_r,si,oi,Qr])}const $7e8f5cd07187803e$export$21b07c8f274aebd5=reactExports.forwardRef((ie,Z)=>{const{children:ee,width:ae=10,height:ve=5,...ye}=ie;return reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.svg,_extends$1({},ye,{ref:Z,width:ae,height:ve,viewBox:"0 0 30 10",preserveAspectRatio:"none"}),ie.asChild?ee:reactExports.createElement("polygon",{points:"0,0 30,0 15,10"}))}),$7e8f5cd07187803e$export$be92b6f5f03c0fe9=$7e8f5cd07187803e$export$21b07c8f274aebd5,$cf1ac5d9fe0e8206$var$POPPER_NAME="Popper",[$cf1ac5d9fe0e8206$var$createPopperContext,$cf1ac5d9fe0e8206$export$722aac194ae923]=$c512c27ab02ef895$export$50c7b4e9d9f19c1($cf1ac5d9fe0e8206$var$POPPER_NAME),[$cf1ac5d9fe0e8206$var$PopperProvider,$cf1ac5d9fe0e8206$var$usePopperContext]=$cf1ac5d9fe0e8206$var$createPopperContext($cf1ac5d9fe0e8206$var$POPPER_NAME),$cf1ac5d9fe0e8206$export$badac9ada3a0bdf9=ie=>{const{__scopePopper:Z,children:ee}=ie,[ae,ve]=reactExports.useState(null);return reactExports.createElement($cf1ac5d9fe0e8206$var$PopperProvider,{scope:Z,anchor:ae,onAnchorChange:ve},ee)},$cf1ac5d9fe0e8206$var$ANCHOR_NAME="PopperAnchor",$cf1ac5d9fe0e8206$export$ecd4e1ccab6ed6d=reactExports.forwardRef((ie,Z)=>{const{__scopePopper:ee,virtualRef:ae,...ve}=ie,ye=$cf1ac5d9fe0e8206$var$usePopperContext($cf1ac5d9fe0e8206$var$ANCHOR_NAME,ee),be=reactExports.useRef(null),Ke=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(Z,be);return reactExports.useEffect(()=>{ye.onAnchorChange((ae==null?void 0:ae.current)||be.current)}),ae?null:reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({},ve,{ref:Ke}))}),$cf1ac5d9fe0e8206$var$CONTENT_NAME="PopperContent",[$cf1ac5d9fe0e8206$var$PopperContentProvider,$cf1ac5d9fe0e8206$var$useContentContext]=$cf1ac5d9fe0e8206$var$createPopperContext($cf1ac5d9fe0e8206$var$CONTENT_NAME),$cf1ac5d9fe0e8206$export$bc4ae5855d3c4fc=reactExports.forwardRef((ie,Z)=>{var ee,ae,ve,ye,be,Ke,Ye,Xe;const{__scopePopper:Qe,side:et="bottom",sideOffset:Je=0,align:rt="center",alignOffset:it=0,arrowPadding:nt=0,avoidCollisions:tt=!0,collisionBoundary:st=[],collisionPadding:ot=0,sticky:ut="partial",hideWhenDetached:ft=!1,updatePositionStrategy:pt="optimized",onPlaced:Xr,...mt}=ie,Yr=$cf1ac5d9fe0e8206$var$usePopperContext($cf1ac5d9fe0e8206$var$CONTENT_NAME,Qe),[ri,Zr]=reactExports.useState(null),_r=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(Z,ai=>Zr(ai)),[Kr,si]=reactExports.useState(null),oi=$db6c3485150b8e66$export$1ab7ae714698c4b8(Kr),Qr=(ee=oi==null?void 0:oi.width)!==null&&ee!==void 0?ee:0,ii=(ae=oi==null?void 0:oi.height)!==null&&ae!==void 0?ae:0,ti=et+(rt!=="center"?"-"+rt:""),ni=typeof ot=="number"?ot:{top:0,right:0,bottom:0,left:0,...ot},ui=Array.isArray(st)?st:[st],yi=ui.length>0,pi={padding:ni,boundary:ui.filter($cf1ac5d9fe0e8206$var$isNotNull),altBoundary:yi},{refs:gi,floatingStyles:Ri,placement:Ei,isPositioned:xi,middlewareData:Ii}=useFloating({strategy:"fixed",placement:ti,whileElementsMounted:(...ai)=>autoUpdate(...ai,{animationFrame:pt==="always"}),elements:{reference:Yr.anchor},middleware:[offset({mainAxis:Je+ii,alignmentAxis:it}),tt&&shift({mainAxis:!0,crossAxis:!1,limiter:ut==="partial"?limitShift():void 0,...pi}),tt&&flip({...pi}),size({...pi,apply:({elements:ai,rects:li,availableWidth:ci,availableHeight:Ai})=>{const{width:mi,height:Ni}=li.reference,ki=ai.floating.style;ki.setProperty("--radix-popper-available-width",`${ci}px`),ki.setProperty("--radix-popper-available-height",`${Ai}px`),ki.setProperty("--radix-popper-anchor-width",`${mi}px`),ki.setProperty("--radix-popper-anchor-height",`${Ni}px`)}}),Kr&&arrow({element:Kr,padding:nt}),$cf1ac5d9fe0e8206$var$transformOrigin({arrowWidth:Qr,arrowHeight:ii}),ft&&hide({strategy:"referenceHidden",...pi})]}),[vi,Si]=$cf1ac5d9fe0e8206$var$getSideAndAlignFromPlacement(Ei),Fi=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(Xr);$9f79659886946c16$export$e5c5a5f917a5871c(()=>{xi&&(Fi==null||Fi())},[xi,Fi]);const Di=(ve=Ii.arrow)===null||ve===void 0?void 0:ve.x,Oi=(ye=Ii.arrow)===null||ye===void 0?void 0:ye.y,Mi=((be=Ii.arrow)===null||be===void 0?void 0:be.centerOffset)!==0,[lt,gt]=reactExports.useState();return $9f79659886946c16$export$e5c5a5f917a5871c(()=>{ri&&gt(window.getComputedStyle(ri).zIndex)},[ri]),reactExports.createElement("div",{ref:gi.setFloating,"data-radix-popper-content-wrapper":"",style:{...Ri,transform:xi?Ri.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:lt,"--radix-popper-transform-origin":[(Ke=Ii.transformOrigin)===null||Ke===void 0?void 0:Ke.x,(Ye=Ii.transformOrigin)===null||Ye===void 0?void 0:Ye.y].join(" ")},dir:ie.dir},reactExports.createElement($cf1ac5d9fe0e8206$var$PopperContentProvider,{scope:Qe,placedSide:vi,onArrowChange:si,arrowX:Di,arrowY:Oi,shouldHideArrow:Mi},reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({"data-side":vi,"data-align":Si},mt,{ref:_r,style:{...mt.style,animation:xi?void 0:"none",opacity:(Xe=Ii.hide)!==null&&Xe!==void 0&&Xe.referenceHidden?0:void 0}}))))}),$cf1ac5d9fe0e8206$var$ARROW_NAME="PopperArrow",$cf1ac5d9fe0e8206$var$OPPOSITE_SIDE={top:"bottom",right:"left",bottom:"top",left:"right"},$cf1ac5d9fe0e8206$export$79d62cd4e10a3fd0=reactExports.forwardRef(function(Z,ee){const{__scopePopper:ae,...ve}=Z,ye=$cf1ac5d9fe0e8206$var$useContentContext($cf1ac5d9fe0e8206$var$ARROW_NAME,ae),be=$cf1ac5d9fe0e8206$var$OPPOSITE_SIDE[ye.placedSide];return reactExports.createElement("span",{ref:ye.onArrowChange,style:{position:"absolute",left:ye.arrowX,top:ye.arrowY,[be]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[ye.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[ye.placedSide],visibility:ye.shouldHideArrow?"hidden":void 0}},reactExports.createElement($7e8f5cd07187803e$export$be92b6f5f03c0fe9,_extends$1({},ve,{ref:ee,style:{...ve.style,display:"block"}})))});function $cf1ac5d9fe0e8206$var$isNotNull(ie){return ie!==null}const $cf1ac5d9fe0e8206$var$transformOrigin=ie=>({name:"transformOrigin",options:ie,fn(Z){var ee,ae,ve,ye,be;const{placement:Ke,rects:Ye,middlewareData:Xe}=Z,et=((ee=Xe.arrow)===null||ee===void 0?void 0:ee.centerOffset)!==0,Je=et?0:ie.arrowWidth,rt=et?0:ie.arrowHeight,[it,nt]=$cf1ac5d9fe0e8206$var$getSideAndAlignFromPlacement(Ke),tt={start:"0%",center:"50%",end:"100%"}[nt],st=((ae=(ve=Xe.arrow)===null||ve===void 0?void 0:ve.x)!==null&&ae!==void 0?ae:0)+Je/2,ot=((ye=(be=Xe.arrow)===null||be===void 0?void 0:be.y)!==null&&ye!==void 0?ye:0)+rt/2;let ut="",ft="";return it==="bottom"?(ut=et?tt:`${st}px`,ft=`${-rt}px`):it==="top"?(ut=et?tt:`${st}px`,ft=`${Ye.floating.height+rt}px`):it==="right"?(ut=`${-rt}px`,ft=et?tt:`${ot}px`):it==="left"&&(ut=`${Ye.floating.width+rt}px`,ft=et?tt:`${ot}px`),{data:{x:ut,y:ft}}}});function $cf1ac5d9fe0e8206$var$getSideAndAlignFromPlacement(ie){const[Z,ee="center"]=ie.split("-");return[Z,ee]}const $cf1ac5d9fe0e8206$export$be92b6f5f03c0fe9=$cf1ac5d9fe0e8206$export$badac9ada3a0bdf9,$cf1ac5d9fe0e8206$export$b688253958b8dfe7=$cf1ac5d9fe0e8206$export$ecd4e1ccab6ed6d,$cf1ac5d9fe0e8206$export$7c6e2c02157bb7d2=$cf1ac5d9fe0e8206$export$bc4ae5855d3c4fc,$cf1ac5d9fe0e8206$export$21b07c8f274aebd5=$cf1ac5d9fe0e8206$export$79d62cd4e10a3fd0,$f1701beae083dbae$export$602eac185826482c=reactExports.forwardRef((ie,Z)=>{var ee;const{container:ae=globalThis==null||(ee=globalThis.document)===null||ee===void 0?void 0:ee.body,...ve}=ie;return ae?$7SXl2$reactdom.createPortal(reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({},ve,{ref:Z})),ae):null});var getDefaultParent=function(ie){if(typeof document>"u")return null;var Z=Array.isArray(ie)?ie[0]:ie;return Z.ownerDocument.body},counterMap=new WeakMap,uncontrolledNodes=new WeakMap,markerMap={},lockCount=0,unwrapHost=function(ie){return ie&&(ie.host||unwrapHost(ie.parentNode))},correctTargets=function(ie,Z){return Z.map(function(ee){if(ie.contains(ee))return ee;var ae=unwrapHost(ee);return ae&&ie.contains(ae)?ae:(console.error("aria-hidden",ee,"in not contained inside",ie,". Doing nothing"),null)}).filter(function(ee){return!!ee})},applyAttributeToOthers=function(ie,Z,ee,ae){var ve=correctTargets(Z,Array.isArray(ie)?ie:[ie]);markerMap[ee]||(markerMap[ee]=new WeakMap);var ye=markerMap[ee],be=[],Ke=new Set,Ye=new Set(ve),Xe=function(et){!et||Ke.has(et)||(Ke.add(et),Xe(et.parentNode))};ve.forEach(Xe);var Qe=function(et){!et||Ye.has(et)||Array.prototype.forEach.call(et.children,function(Je){if(Ke.has(Je))Qe(Je);else{var rt=Je.getAttribute(ae),it=rt!==null&&rt!=="false",nt=(counterMap.get(Je)||0)+1,tt=(ye.get(Je)||0)+1;counterMap.set(Je,nt),ye.set(Je,tt),be.push(Je),nt===1&&it&&uncontrolledNodes.set(Je,!0),tt===1&&Je.setAttribute(ee,"true"),it||Je.setAttribute(ae,"true")}})};return Qe(Z),Ke.clear(),lockCount++,function(){be.forEach(function(et){var Je=counterMap.get(et)-1,rt=ye.get(et)-1;counterMap.set(et,Je),ye.set(et,rt),Je||(uncontrolledNodes.has(et)||et.removeAttribute(ae),uncontrolledNodes.delete(et)),rt||et.removeAttribute(ee)}),lockCount--,lockCount||(counterMap=new WeakMap,counterMap=new WeakMap,uncontrolledNodes=new WeakMap,markerMap={})}},hideOthers=function(ie,Z,ee){ee===void 0&&(ee="data-aria-hidden");var ae=Array.from(Array.isArray(ie)?ie:[ie]),ve=Z||getDefaultParent(ie);return ve?(ae.push.apply(ae,Array.from(ve.querySelectorAll("[aria-live]"))),applyAttributeToOthers(ae,ve,ee,"aria-hidden")):function(){return null}},__assign=function(){return __assign=Object.assign||function(Z){for(var ee,ae=1,ve=arguments.length;ae<ve;ae++){ee=arguments[ae];for(var ye in ee)Object.prototype.hasOwnProperty.call(ee,ye)&&(Z[ye]=ee[ye])}return Z},__assign.apply(this,arguments)};function __rest(ie,Z){var ee={};for(var ae in ie)Object.prototype.hasOwnProperty.call(ie,ae)&&Z.indexOf(ae)<0&&(ee[ae]=ie[ae]);if(ie!=null&&typeof Object.getOwnPropertySymbols=="function")for(var ve=0,ae=Object.getOwnPropertySymbols(ie);ve<ae.length;ve++)Z.indexOf(ae[ve])<0&&Object.prototype.propertyIsEnumerable.call(ie,ae[ve])&&(ee[ae[ve]]=ie[ae[ve]]);return ee}function __spreadArray(ie,Z,ee){if(ee||arguments.length===2)for(var ae=0,ve=Z.length,ye;ae<ve;ae++)(ye||!(ae in Z))&&(ye||(ye=Array.prototype.slice.call(Z,0,ae)),ye[ae]=Z[ae]);return ie.concat(ye||Array.prototype.slice.call(Z))}typeof SuppressedError=="function"&&SuppressedError;var zeroRightClassName="right-scroll-bar-position",fullWidthClassName="width-before-scroll-bar",noScrollbarsClassName="with-scroll-bars-hidden",removedBarSizeVariable="--removed-body-scroll-bar-size";function assignRef(ie,Z){return typeof ie=="function"?ie(Z):ie&&(ie.current=Z),ie}function useCallbackRef(ie,Z){var ee=reactExports.useState(function(){return{value:ie,callback:Z,facade:{get current(){return ee.value},set current(ae){var ve=ee.value;ve!==ae&&(ee.value=ae,ee.callback(ae,ve))}}}})[0];return ee.callback=Z,ee.facade}function useMergeRefs(ie,Z){return useCallbackRef(Z||null,function(ee){return ie.forEach(function(ae){return assignRef(ae,ee)})})}function ItoI(ie){return ie}function innerCreateMedium(ie,Z){Z===void 0&&(Z=ItoI);var ee=[],ae=!1,ve={read:function(){if(ae)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return ee.length?ee[ee.length-1]:ie},useMedium:function(ye){var be=Z(ye,ae);return ee.push(be),function(){ee=ee.filter(function(Ke){return Ke!==be})}},assignSyncMedium:function(ye){for(ae=!0;ee.length;){var be=ee;ee=[],be.forEach(ye)}ee={push:function(Ke){return ye(Ke)},filter:function(){return ee}}},assignMedium:function(ye){ae=!0;var be=[];if(ee.length){var Ke=ee;ee=[],Ke.forEach(ye),be=ee}var Ye=function(){var Qe=be;be=[],Qe.forEach(ye)},Xe=function(){return Promise.resolve().then(Ye)};Xe(),ee={push:function(Qe){be.push(Qe),Xe()},filter:function(Qe){return be=be.filter(Qe),ee}}}};return ve}function createSidecarMedium(ie){ie===void 0&&(ie={});var Z=innerCreateMedium(null);return Z.options=__assign({async:!0,ssr:!1},ie),Z}var SideCar$1=function(ie){var Z=ie.sideCar,ee=__rest(ie,["sideCar"]);if(!Z)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var ae=Z.read();if(!ae)throw new Error("Sidecar medium not found");return reactExports.createElement(ae,__assign({},ee))};SideCar$1.isSideCarExport=!0;function exportSidecar(ie,Z){return ie.useMedium(Z),SideCar$1}var effectCar=createSidecarMedium(),nothing=function(){},RemoveScroll=reactExports.forwardRef(function(ie,Z){var ee=reactExports.useRef(null),ae=reactExports.useState({onScrollCapture:nothing,onWheelCapture:nothing,onTouchMoveCapture:nothing}),ve=ae[0],ye=ae[1],be=ie.forwardProps,Ke=ie.children,Ye=ie.className,Xe=ie.removeScrollBar,Qe=ie.enabled,et=ie.shards,Je=ie.sideCar,rt=ie.noIsolation,it=ie.inert,nt=ie.allowPinchZoom,tt=ie.as,st=tt===void 0?"div":tt,ot=__rest(ie,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as"]),ut=Je,ft=useMergeRefs([ee,Z]),pt=__assign(__assign({},ot),ve);return reactExports.createElement(reactExports.Fragment,null,Qe&&reactExports.createElement(ut,{sideCar:effectCar,removeScrollBar:Xe,shards:et,noIsolation:rt,inert:it,setCallbacks:ye,allowPinchZoom:!!nt,lockRef:ee}),be?reactExports.cloneElement(reactExports.Children.only(Ke),__assign(__assign({},pt),{ref:ft})):reactExports.createElement(st,__assign({},pt,{className:Ye,ref:ft}),Ke))});RemoveScroll.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};RemoveScroll.classNames={fullWidth:fullWidthClassName,zeroRight:zeroRightClassName};var currentNonce,getNonce=function(){if(currentNonce)return currentNonce;if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function makeStyleTag(){if(!document)return null;var ie=document.createElement("style");ie.type="text/css";var Z=getNonce();return Z&&ie.setAttribute("nonce",Z),ie}function injectStyles(ie,Z){ie.styleSheet?ie.styleSheet.cssText=Z:ie.appendChild(document.createTextNode(Z))}function insertStyleTag(ie){var Z=document.head||document.getElementsByTagName("head")[0];Z.appendChild(ie)}var stylesheetSingleton=function(){var ie=0,Z=null;return{add:function(ee){ie==0&&(Z=makeStyleTag())&&(injectStyles(Z,ee),insertStyleTag(Z)),ie++},remove:function(){ie--,!ie&&Z&&(Z.parentNode&&Z.parentNode.removeChild(Z),Z=null)}}},styleHookSingleton=function(){var ie=stylesheetSingleton();return function(Z,ee){reactExports.useEffect(function(){return ie.add(Z),function(){ie.remove()}},[Z&&ee])}},styleSingleton=function(){var ie=styleHookSingleton(),Z=function(ee){var ae=ee.styles,ve=ee.dynamic;return ie(ae,ve),null};return Z},zeroGap={left:0,top:0,right:0,gap:0},parse=function(ie){return parseInt(ie||"",10)||0},getOffset=function(ie){var Z=window.getComputedStyle(document.body),ee=Z[ie==="padding"?"paddingLeft":"marginLeft"],ae=Z[ie==="padding"?"paddingTop":"marginTop"],ve=Z[ie==="padding"?"paddingRight":"marginRight"];return[parse(ee),parse(ae),parse(ve)]},getGapWidth=function(ie){if(ie===void 0&&(ie="margin"),typeof window>"u")return zeroGap;var Z=getOffset(ie),ee=document.documentElement.clientWidth,ae=window.innerWidth;return{left:Z[0],top:Z[1],right:Z[2],gap:Math.max(0,ae-ee+Z[2]-Z[0])}},Style=styleSingleton(),getStyles=function(ie,Z,ee,ae){var ve=ie.left,ye=ie.top,be=ie.right,Ke=ie.gap;return ee===void 0&&(ee="margin"),`
  .`.concat(noScrollbarsClassName,` {
   overflow: hidden `).concat(ae,`;
   padding-right: `).concat(Ke,"px ").concat(ae,`;
  }
  body {
    overflow: hidden `).concat(ae,`;
    overscroll-behavior: contain;
    `).concat([Z&&"position: relative ".concat(ae,";"),ee==="margin"&&`
    padding-left: `.concat(ve,`px;
    padding-top: `).concat(ye,`px;
    padding-right: `).concat(be,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(Ke,"px ").concat(ae,`;
    `),ee==="padding"&&"padding-right: ".concat(Ke,"px ").concat(ae,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(zeroRightClassName,` {
    right: `).concat(Ke,"px ").concat(ae,`;
  }
  
  .`).concat(fullWidthClassName,` {
    margin-right: `).concat(Ke,"px ").concat(ae,`;
  }
  
  .`).concat(zeroRightClassName," .").concat(zeroRightClassName,` {
    right: 0 `).concat(ae,`;
  }
  
  .`).concat(fullWidthClassName," .").concat(fullWidthClassName,` {
    margin-right: 0 `).concat(ae,`;
  }
  
  body {
    `).concat(removedBarSizeVariable,": ").concat(Ke,`px;
  }
`)},RemoveScrollBar=function(ie){var Z=ie.noRelative,ee=ie.noImportant,ae=ie.gapMode,ve=ae===void 0?"margin":ae,ye=reactExports.useMemo(function(){return getGapWidth(ve)},[ve]);return reactExports.createElement(Style,{styles:getStyles(ye,!Z,ve,ee?"":"!important")})},passiveSupported=!1;if(typeof window<"u")try{var options=Object.defineProperty({},"passive",{get:function(){return passiveSupported=!0,!0}});window.addEventListener("test",options,options),window.removeEventListener("test",options,options)}catch{passiveSupported=!1}var nonPassive=passiveSupported?{passive:!1}:!1,alwaysContainsScroll=function(ie){return ie.tagName==="TEXTAREA"},elementCanBeScrolled=function(ie,Z){var ee=window.getComputedStyle(ie);return ee[Z]!=="hidden"&&!(ee.overflowY===ee.overflowX&&!alwaysContainsScroll(ie)&&ee[Z]==="visible")},elementCouldBeVScrolled=function(ie){return elementCanBeScrolled(ie,"overflowY")},elementCouldBeHScrolled=function(ie){return elementCanBeScrolled(ie,"overflowX")},locationCouldBeScrolled=function(ie,Z){var ee=Z;do{typeof ShadowRoot<"u"&&ee instanceof ShadowRoot&&(ee=ee.host);var ae=elementCouldBeScrolled(ie,ee);if(ae){var ve=getScrollVariables(ie,ee),ye=ve[1],be=ve[2];if(ye>be)return!0}ee=ee.parentNode}while(ee&&ee!==document.body);return!1},getVScrollVariables=function(ie){var Z=ie.scrollTop,ee=ie.scrollHeight,ae=ie.clientHeight;return[Z,ee,ae]},getHScrollVariables=function(ie){var Z=ie.scrollLeft,ee=ie.scrollWidth,ae=ie.clientWidth;return[Z,ee,ae]},elementCouldBeScrolled=function(ie,Z){return ie==="v"?elementCouldBeVScrolled(Z):elementCouldBeHScrolled(Z)},getScrollVariables=function(ie,Z){return ie==="v"?getVScrollVariables(Z):getHScrollVariables(Z)},getDirectionFactor=function(ie,Z){return ie==="h"&&Z==="rtl"?-1:1},handleScroll=function(ie,Z,ee,ae,ve){var ye=getDirectionFactor(ie,window.getComputedStyle(Z).direction),be=ye*ae,Ke=ee.target,Ye=Z.contains(Ke),Xe=!1,Qe=be>0,et=0,Je=0;do{var rt=getScrollVariables(ie,Ke),it=rt[0],nt=rt[1],tt=rt[2],st=nt-tt-ye*it;(it||st)&&elementCouldBeScrolled(ie,Ke)&&(et+=st,Je+=it),Ke=Ke.parentNode}while(!Ye&&Ke!==document.body||Ye&&(Z.contains(Ke)||Z===Ke));return(Qe&&(ve&&et===0||!ve&&be>et)||!Qe&&(ve&&Je===0||!ve&&-be>Je))&&(Xe=!0),Xe},getTouchXY=function(ie){return"changedTouches"in ie?[ie.changedTouches[0].clientX,ie.changedTouches[0].clientY]:[0,0]},getDeltaXY=function(ie){return[ie.deltaX,ie.deltaY]},extractRef=function(ie){return ie&&"current"in ie?ie.current:ie},deltaCompare=function(ie,Z){return ie[0]===Z[0]&&ie[1]===Z[1]},generateStyle=function(ie){return`
  .block-interactivity-`.concat(ie,` {pointer-events: none;}
  .allow-interactivity-`).concat(ie,` {pointer-events: all;}
`)},idCounter=0,lockStack=[];function RemoveScrollSideCar(ie){var Z=reactExports.useRef([]),ee=reactExports.useRef([0,0]),ae=reactExports.useRef(),ve=reactExports.useState(idCounter++)[0],ye=reactExports.useState(function(){return styleSingleton()})[0],be=reactExports.useRef(ie);reactExports.useEffect(function(){be.current=ie},[ie]),reactExports.useEffect(function(){if(ie.inert){document.body.classList.add("block-interactivity-".concat(ve));var nt=__spreadArray([ie.lockRef.current],(ie.shards||[]).map(extractRef),!0).filter(Boolean);return nt.forEach(function(tt){return tt.classList.add("allow-interactivity-".concat(ve))}),function(){document.body.classList.remove("block-interactivity-".concat(ve)),nt.forEach(function(tt){return tt.classList.remove("allow-interactivity-".concat(ve))})}}},[ie.inert,ie.lockRef.current,ie.shards]);var Ke=reactExports.useCallback(function(nt,tt){if("touches"in nt&&nt.touches.length===2)return!be.current.allowPinchZoom;var st=getTouchXY(nt),ot=ee.current,ut="deltaX"in nt?nt.deltaX:ot[0]-st[0],ft="deltaY"in nt?nt.deltaY:ot[1]-st[1],pt,Xr=nt.target,mt=Math.abs(ut)>Math.abs(ft)?"h":"v";if("touches"in nt&&mt==="h"&&Xr.type==="range")return!1;var Yr=locationCouldBeScrolled(mt,Xr);if(!Yr)return!0;if(Yr?pt=mt:(pt=mt==="v"?"h":"v",Yr=locationCouldBeScrolled(mt,Xr)),!Yr)return!1;if(!ae.current&&"changedTouches"in nt&&(ut||ft)&&(ae.current=pt),!pt)return!0;var ri=ae.current||pt;return handleScroll(ri,tt,nt,ri==="h"?ut:ft,!0)},[]),Ye=reactExports.useCallback(function(nt){var tt=nt;if(!(!lockStack.length||lockStack[lockStack.length-1]!==ye)){var st="deltaY"in tt?getDeltaXY(tt):getTouchXY(tt),ot=Z.current.filter(function(pt){return pt.name===tt.type&&pt.target===tt.target&&deltaCompare(pt.delta,st)})[0];if(ot&&ot.should){tt.cancelable&&tt.preventDefault();return}if(!ot){var ut=(be.current.shards||[]).map(extractRef).filter(Boolean).filter(function(pt){return pt.contains(tt.target)}),ft=ut.length>0?Ke(tt,ut[0]):!be.current.noIsolation;ft&&tt.cancelable&&tt.preventDefault()}}},[]),Xe=reactExports.useCallback(function(nt,tt,st,ot){var ut={name:nt,delta:tt,target:st,should:ot};Z.current.push(ut),setTimeout(function(){Z.current=Z.current.filter(function(ft){return ft!==ut})},1)},[]),Qe=reactExports.useCallback(function(nt){ee.current=getTouchXY(nt),ae.current=void 0},[]),et=reactExports.useCallback(function(nt){Xe(nt.type,getDeltaXY(nt),nt.target,Ke(nt,ie.lockRef.current))},[]),Je=reactExports.useCallback(function(nt){Xe(nt.type,getTouchXY(nt),nt.target,Ke(nt,ie.lockRef.current))},[]);reactExports.useEffect(function(){return lockStack.push(ye),ie.setCallbacks({onScrollCapture:et,onWheelCapture:et,onTouchMoveCapture:Je}),document.addEventListener("wheel",Ye,nonPassive),document.addEventListener("touchmove",Ye,nonPassive),document.addEventListener("touchstart",Qe,nonPassive),function(){lockStack=lockStack.filter(function(nt){return nt!==ye}),document.removeEventListener("wheel",Ye,nonPassive),document.removeEventListener("touchmove",Ye,nonPassive),document.removeEventListener("touchstart",Qe,nonPassive)}},[]);var rt=ie.removeScrollBar,it=ie.inert;return reactExports.createElement(reactExports.Fragment,null,it?reactExports.createElement(ye,{styles:generateStyle(ve)}):null,rt?reactExports.createElement(RemoveScrollBar,{gapMode:"margin"}):null)}const SideCar=exportSidecar(effectCar,RemoveScrollSideCar);var ReactRemoveScroll=reactExports.forwardRef(function(ie,Z){return reactExports.createElement(RemoveScroll,__assign({},ie,{ref:Z,sideCar:SideCar}))});ReactRemoveScroll.classNames=RemoveScroll.classNames;const $01b9c$RemoveScroll=ReactRemoveScroll,$cb5cc270b50c6fcd$var$POPOVER_NAME="Popover",[$cb5cc270b50c6fcd$var$createPopoverContext,$cb5cc270b50c6fcd$export$c8393c9e73286932]=$c512c27ab02ef895$export$50c7b4e9d9f19c1($cb5cc270b50c6fcd$var$POPOVER_NAME,[$cf1ac5d9fe0e8206$export$722aac194ae923]),$cb5cc270b50c6fcd$var$usePopperScope=$cf1ac5d9fe0e8206$export$722aac194ae923(),[$cb5cc270b50c6fcd$var$PopoverProvider,$cb5cc270b50c6fcd$var$usePopoverContext]=$cb5cc270b50c6fcd$var$createPopoverContext($cb5cc270b50c6fcd$var$POPOVER_NAME),$cb5cc270b50c6fcd$export$5b6b19405a83ff9d=ie=>{const{__scopePopover:Z,children:ee,open:ae,defaultOpen:ve,onOpenChange:ye,modal:be=!1}=ie,Ke=$cb5cc270b50c6fcd$var$usePopperScope(Z),Ye=reactExports.useRef(null),[Xe,Qe]=reactExports.useState(!1),[et=!1,Je]=$71cd76cc60e0454e$export$6f32135080cb4c3({prop:ae,defaultProp:ve,onChange:ye});return reactExports.createElement($cf1ac5d9fe0e8206$export$be92b6f5f03c0fe9,Ke,reactExports.createElement($cb5cc270b50c6fcd$var$PopoverProvider,{scope:Z,contentId:$1746a345f3d73bb7$export$f680877a34711e37(),triggerRef:Ye,open:et,onOpenChange:Je,onOpenToggle:reactExports.useCallback(()=>Je(rt=>!rt),[Je]),hasCustomAnchor:Xe,onCustomAnchorAdd:reactExports.useCallback(()=>Qe(!0),[]),onCustomAnchorRemove:reactExports.useCallback(()=>Qe(!1),[]),modal:be},ee))},$cb5cc270b50c6fcd$var$TRIGGER_NAME="PopoverTrigger",$cb5cc270b50c6fcd$export$7dacb05d26466c3=reactExports.forwardRef((ie,Z)=>{const{__scopePopover:ee,...ae}=ie,ve=$cb5cc270b50c6fcd$var$usePopoverContext($cb5cc270b50c6fcd$var$TRIGGER_NAME,ee),ye=$cb5cc270b50c6fcd$var$usePopperScope(ee),be=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(Z,ve.triggerRef),Ke=reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.button,_extends$1({type:"button","aria-haspopup":"dialog","aria-expanded":ve.open,"aria-controls":ve.contentId,"data-state":$cb5cc270b50c6fcd$var$getState(ve.open)},ae,{ref:be,onClick:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ie.onClick,ve.onOpenToggle)}));return ve.hasCustomAnchor?Ke:reactExports.createElement($cf1ac5d9fe0e8206$export$b688253958b8dfe7,_extends$1({asChild:!0},ye),Ke)}),$cb5cc270b50c6fcd$var$PORTAL_NAME="PopoverPortal",[$cb5cc270b50c6fcd$var$PortalProvider,$cb5cc270b50c6fcd$var$usePortalContext]=$cb5cc270b50c6fcd$var$createPopoverContext($cb5cc270b50c6fcd$var$PORTAL_NAME,{forceMount:void 0}),$cb5cc270b50c6fcd$var$CONTENT_NAME="PopoverContent",$cb5cc270b50c6fcd$export$d7e1f420b25549ff=reactExports.forwardRef((ie,Z)=>{const ee=$cb5cc270b50c6fcd$var$usePortalContext($cb5cc270b50c6fcd$var$CONTENT_NAME,ie.__scopePopover),{forceMount:ae=ee.forceMount,...ve}=ie,ye=$cb5cc270b50c6fcd$var$usePopoverContext($cb5cc270b50c6fcd$var$CONTENT_NAME,ie.__scopePopover);return reactExports.createElement($921a889cee6df7e8$export$99c2b779aa4e8b8b,{present:ae||ye.open},ye.modal?reactExports.createElement($cb5cc270b50c6fcd$var$PopoverContentModal,_extends$1({},ve,{ref:Z})):reactExports.createElement($cb5cc270b50c6fcd$var$PopoverContentNonModal,_extends$1({},ve,{ref:Z})))}),$cb5cc270b50c6fcd$var$PopoverContentModal=reactExports.forwardRef((ie,Z)=>{const ee=$cb5cc270b50c6fcd$var$usePopoverContext($cb5cc270b50c6fcd$var$CONTENT_NAME,ie.__scopePopover),ae=reactExports.useRef(null),ve=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(Z,ae),ye=reactExports.useRef(!1);return reactExports.useEffect(()=>{const be=ae.current;if(be)return hideOthers(be)},[]),reactExports.createElement($01b9c$RemoveScroll,{as:$5e63c961fc1ce211$export$8c6ed5c666ac1360,allowPinchZoom:!0},reactExports.createElement($cb5cc270b50c6fcd$var$PopoverContentImpl,_extends$1({},ie,{ref:ve,trapFocus:ee.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ie.onCloseAutoFocus,be=>{var Ke;be.preventDefault(),ye.current||(Ke=ee.triggerRef.current)===null||Ke===void 0||Ke.focus()}),onPointerDownOutside:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ie.onPointerDownOutside,be=>{const Ke=be.detail.originalEvent,Ye=Ke.button===0&&Ke.ctrlKey===!0,Xe=Ke.button===2||Ye;ye.current=Xe},{checkForDefaultPrevented:!1}),onFocusOutside:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ie.onFocusOutside,be=>be.preventDefault(),{checkForDefaultPrevented:!1})})))}),$cb5cc270b50c6fcd$var$PopoverContentNonModal=reactExports.forwardRef((ie,Z)=>{const ee=$cb5cc270b50c6fcd$var$usePopoverContext($cb5cc270b50c6fcd$var$CONTENT_NAME,ie.__scopePopover),ae=reactExports.useRef(!1),ve=reactExports.useRef(!1);return reactExports.createElement($cb5cc270b50c6fcd$var$PopoverContentImpl,_extends$1({},ie,{ref:Z,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:ye=>{var be;if((be=ie.onCloseAutoFocus)===null||be===void 0||be.call(ie,ye),!ye.defaultPrevented){var Ke;ae.current||(Ke=ee.triggerRef.current)===null||Ke===void 0||Ke.focus(),ye.preventDefault()}ae.current=!1,ve.current=!1},onInteractOutside:ye=>{var be,Ke;(be=ie.onInteractOutside)===null||be===void 0||be.call(ie,ye),ye.defaultPrevented||(ae.current=!0,ye.detail.originalEvent.type==="pointerdown"&&(ve.current=!0));const Ye=ye.target;((Ke=ee.triggerRef.current)===null||Ke===void 0?void 0:Ke.contains(Ye))&&ye.preventDefault(),ye.detail.originalEvent.type==="focusin"&&ve.current&&ye.preventDefault()}}))}),$cb5cc270b50c6fcd$var$PopoverContentImpl=reactExports.forwardRef((ie,Z)=>{const{__scopePopover:ee,trapFocus:ae,onOpenAutoFocus:ve,onCloseAutoFocus:ye,disableOutsidePointerEvents:be,onEscapeKeyDown:Ke,onPointerDownOutside:Ye,onFocusOutside:Xe,onInteractOutside:Qe,...et}=ie,Je=$cb5cc270b50c6fcd$var$usePopoverContext($cb5cc270b50c6fcd$var$CONTENT_NAME,ee),rt=$cb5cc270b50c6fcd$var$usePopperScope(ee);return $3db38b7d1fb3fe6a$export$b7ece24a22aeda8c(),reactExports.createElement($d3863c46a17e8a28$export$20e40289641fbbb6,{asChild:!0,loop:!0,trapped:ae,onMountAutoFocus:ve,onUnmountAutoFocus:ye},reactExports.createElement($5cb92bef7577960e$export$177fb62ff3ec1f22,{asChild:!0,disableOutsidePointerEvents:be,onInteractOutside:Qe,onEscapeKeyDown:Ke,onPointerDownOutside:Ye,onFocusOutside:Xe,onDismiss:()=>Je.onOpenChange(!1)},reactExports.createElement($cf1ac5d9fe0e8206$export$7c6e2c02157bb7d2,_extends$1({"data-state":$cb5cc270b50c6fcd$var$getState(Je.open),role:"dialog",id:Je.contentId},rt,et,{ref:Z,style:{...et.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}}))))}),$cb5cc270b50c6fcd$var$CLOSE_NAME="PopoverClose",$cb5cc270b50c6fcd$export$d6ac43ebaa40d53e=reactExports.forwardRef((ie,Z)=>{const{__scopePopover:ee,...ae}=ie,ve=$cb5cc270b50c6fcd$var$usePopoverContext($cb5cc270b50c6fcd$var$CLOSE_NAME,ee);return reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.button,_extends$1({type:"button"},ae,{ref:Z,onClick:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ie.onClick,()=>ve.onOpenChange(!1))}))}),$cb5cc270b50c6fcd$export$3152841115e061b2=reactExports.forwardRef((ie,Z)=>{const{__scopePopover:ee,...ae}=ie,ve=$cb5cc270b50c6fcd$var$usePopperScope(ee);return reactExports.createElement($cf1ac5d9fe0e8206$export$21b07c8f274aebd5,_extends$1({},ve,ae,{ref:Z}))});function $cb5cc270b50c6fcd$var$getState(ie){return ie?"open":"closed"}const $cb5cc270b50c6fcd$export$be92b6f5f03c0fe9=$cb5cc270b50c6fcd$export$5b6b19405a83ff9d,$cb5cc270b50c6fcd$export$41fb9f06171c75f4=$cb5cc270b50c6fcd$export$7dacb05d26466c3,$cb5cc270b50c6fcd$export$7c6e2c02157bb7d2=$cb5cc270b50c6fcd$export$d7e1f420b25549ff,$cb5cc270b50c6fcd$export$f39c2d165cd861fe=$cb5cc270b50c6fcd$export$d6ac43ebaa40d53e,$cb5cc270b50c6fcd$export$21b07c8f274aebd5=$cb5cc270b50c6fcd$export$3152841115e061b2;function $ae6933e535247d3d$export$7d15b64cf5a3a4c4(ie,[Z,ee]){return Math.min(ee,Math.max(Z,ie))}const $ea1ef594cf570d83$export$439d29a4e110a164=reactExports.forwardRef((ie,Z)=>reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.span,_extends$1({},ie,{ref:Z,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...ie.style}}))),$cc7e05a45900e73f$var$OPEN_KEYS=[" ","Enter","ArrowUp","ArrowDown"],$cc7e05a45900e73f$var$SELECTION_KEYS=[" ","Enter"],$cc7e05a45900e73f$var$SELECT_NAME="Select",[$cc7e05a45900e73f$var$Collection,$cc7e05a45900e73f$var$useCollection,$cc7e05a45900e73f$var$createCollectionScope]=$e02a7d9cb1dc128c$export$c74125a8e3af6bb2($cc7e05a45900e73f$var$SELECT_NAME),[$cc7e05a45900e73f$var$createSelectContext,$cc7e05a45900e73f$export$286727a75dc039bd]=$c512c27ab02ef895$export$50c7b4e9d9f19c1($cc7e05a45900e73f$var$SELECT_NAME,[$cc7e05a45900e73f$var$createCollectionScope,$cf1ac5d9fe0e8206$export$722aac194ae923]),$cc7e05a45900e73f$var$usePopperScope=$cf1ac5d9fe0e8206$export$722aac194ae923(),[$cc7e05a45900e73f$var$SelectProvider,$cc7e05a45900e73f$var$useSelectContext]=$cc7e05a45900e73f$var$createSelectContext($cc7e05a45900e73f$var$SELECT_NAME),[$cc7e05a45900e73f$var$SelectNativeOptionsProvider,$cc7e05a45900e73f$var$useSelectNativeOptionsContext]=$cc7e05a45900e73f$var$createSelectContext($cc7e05a45900e73f$var$SELECT_NAME),$cc7e05a45900e73f$export$ef9b1a59e592288f=ie=>{const{__scopeSelect:Z,children:ee,open:ae,defaultOpen:ve,onOpenChange:ye,value:be,defaultValue:Ke,onValueChange:Ye,dir:Xe,name:Qe,autoComplete:et,disabled:Je,required:rt}=ie,it=$cc7e05a45900e73f$var$usePopperScope(Z),[nt,tt]=reactExports.useState(null),[st,ot]=reactExports.useState(null),[ut,ft]=reactExports.useState(!1),pt=$f631663db3294ace$export$b39126d51d94e6f3(Xe),[Xr=!1,mt]=$71cd76cc60e0454e$export$6f32135080cb4c3({prop:ae,defaultProp:ve,onChange:ye}),[Yr,ri]=$71cd76cc60e0454e$export$6f32135080cb4c3({prop:be,defaultProp:Ke,onChange:Ye}),Zr=reactExports.useRef(null),_r=nt?!!nt.closest("form"):!0,[Kr,si]=reactExports.useState(new Set),oi=Array.from(Kr).map(Qr=>Qr.props.value).join(";");return reactExports.createElement($cf1ac5d9fe0e8206$export$be92b6f5f03c0fe9,it,reactExports.createElement($cc7e05a45900e73f$var$SelectProvider,{required:rt,scope:Z,trigger:nt,onTriggerChange:tt,valueNode:st,onValueNodeChange:ot,valueNodeHasChildren:ut,onValueNodeHasChildrenChange:ft,contentId:$1746a345f3d73bb7$export$f680877a34711e37(),value:Yr,onValueChange:ri,open:Xr,onOpenChange:mt,dir:pt,triggerPointerDownPosRef:Zr,disabled:Je},reactExports.createElement($cc7e05a45900e73f$var$Collection.Provider,{scope:Z},reactExports.createElement($cc7e05a45900e73f$var$SelectNativeOptionsProvider,{scope:ie.__scopeSelect,onNativeOptionAdd:reactExports.useCallback(Qr=>{si(ii=>new Set(ii).add(Qr))},[]),onNativeOptionRemove:reactExports.useCallback(Qr=>{si(ii=>{const ti=new Set(ii);return ti.delete(Qr),ti})},[])},ee)),_r?reactExports.createElement($cc7e05a45900e73f$var$BubbleSelect,{key:oi,"aria-hidden":!0,required:rt,tabIndex:-1,name:Qe,autoComplete:et,value:Yr,onChange:Qr=>ri(Qr.target.value),disabled:Je},Yr===void 0?reactExports.createElement("option",{value:""}):null,Array.from(Kr)):null))},$cc7e05a45900e73f$var$TRIGGER_NAME="SelectTrigger",$cc7e05a45900e73f$export$3ac1e88a1c0b9f1=reactExports.forwardRef((ie,Z)=>{const{__scopeSelect:ee,disabled:ae=!1,...ve}=ie,ye=$cc7e05a45900e73f$var$usePopperScope(ee),be=$cc7e05a45900e73f$var$useSelectContext($cc7e05a45900e73f$var$TRIGGER_NAME,ee),Ke=be.disabled||ae,Ye=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(Z,be.onTriggerChange),Xe=$cc7e05a45900e73f$var$useCollection(ee),[Qe,et,Je]=$cc7e05a45900e73f$var$useTypeaheadSearch(it=>{const nt=Xe().filter(ot=>!ot.disabled),tt=nt.find(ot=>ot.value===be.value),st=$cc7e05a45900e73f$var$findNextItem(nt,it,tt);st!==void 0&&be.onValueChange(st.value)}),rt=()=>{Ke||(be.onOpenChange(!0),Je())};return reactExports.createElement($cf1ac5d9fe0e8206$export$b688253958b8dfe7,_extends$1({asChild:!0},ye),reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.button,_extends$1({type:"button",role:"combobox","aria-controls":be.contentId,"aria-expanded":be.open,"aria-required":be.required,"aria-autocomplete":"none",dir:be.dir,"data-state":be.open?"open":"closed",disabled:Ke,"data-disabled":Ke?"":void 0,"data-placeholder":$cc7e05a45900e73f$var$shouldShowPlaceholder(be.value)?"":void 0},ve,{ref:Ye,onClick:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ve.onClick,it=>{it.currentTarget.focus()}),onPointerDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ve.onPointerDown,it=>{const nt=it.target;nt.hasPointerCapture(it.pointerId)&&nt.releasePointerCapture(it.pointerId),it.button===0&&it.ctrlKey===!1&&(rt(),be.triggerPointerDownPosRef.current={x:Math.round(it.pageX),y:Math.round(it.pageY)},it.preventDefault())}),onKeyDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ve.onKeyDown,it=>{const nt=Qe.current!=="";!(it.ctrlKey||it.altKey||it.metaKey)&&it.key.length===1&&et(it.key),!(nt&&it.key===" ")&&$cc7e05a45900e73f$var$OPEN_KEYS.includes(it.key)&&(rt(),it.preventDefault())})})))}),$cc7e05a45900e73f$var$VALUE_NAME="SelectValue",$cc7e05a45900e73f$export$e288731fd71264f0=reactExports.forwardRef((ie,Z)=>{const{__scopeSelect:ee,className:ae,style:ve,children:ye,placeholder:be="",...Ke}=ie,Ye=$cc7e05a45900e73f$var$useSelectContext($cc7e05a45900e73f$var$VALUE_NAME,ee),{onValueNodeHasChildrenChange:Xe}=Ye,Qe=ye!==void 0,et=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(Z,Ye.onValueNodeChange);return $9f79659886946c16$export$e5c5a5f917a5871c(()=>{Xe(Qe)},[Xe,Qe]),reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.span,_extends$1({},Ke,{ref:et,style:{pointerEvents:"none"}}),$cc7e05a45900e73f$var$shouldShowPlaceholder(Ye.value)?reactExports.createElement(reactExports.Fragment,null,be):ye)}),$cc7e05a45900e73f$export$99b400cabb58c515=reactExports.forwardRef((ie,Z)=>{const{__scopeSelect:ee,children:ae,...ve}=ie;return reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.span,_extends$1({"aria-hidden":!0},ve,{ref:Z}),ae||"")}),$cc7e05a45900e73f$export$b2af6c9944296213=ie=>reactExports.createElement($f1701beae083dbae$export$602eac185826482c,_extends$1({asChild:!0},ie)),$cc7e05a45900e73f$var$CONTENT_NAME="SelectContent",$cc7e05a45900e73f$export$c973a4b3cb86a03d=reactExports.forwardRef((ie,Z)=>{const ee=$cc7e05a45900e73f$var$useSelectContext($cc7e05a45900e73f$var$CONTENT_NAME,ie.__scopeSelect),[ae,ve]=reactExports.useState();if($9f79659886946c16$export$e5c5a5f917a5871c(()=>{ve(new DocumentFragment)},[]),!ee.open){const ye=ae;return ye?reactDomExports.createPortal(reactExports.createElement($cc7e05a45900e73f$var$SelectContentProvider,{scope:ie.__scopeSelect},reactExports.createElement($cc7e05a45900e73f$var$Collection.Slot,{scope:ie.__scopeSelect},reactExports.createElement("div",null,ie.children))),ye):null}return reactExports.createElement($cc7e05a45900e73f$var$SelectContentImpl,_extends$1({},ie,{ref:Z}))}),$cc7e05a45900e73f$var$CONTENT_MARGIN=10,[$cc7e05a45900e73f$var$SelectContentProvider,$cc7e05a45900e73f$var$useSelectContentContext]=$cc7e05a45900e73f$var$createSelectContext($cc7e05a45900e73f$var$CONTENT_NAME),$cc7e05a45900e73f$var$SelectContentImpl=reactExports.forwardRef((ie,Z)=>{const{__scopeSelect:ee,position:ae="item-aligned",onCloseAutoFocus:ve,onEscapeKeyDown:ye,onPointerDownOutside:be,side:Ke,sideOffset:Ye,align:Xe,alignOffset:Qe,arrowPadding:et,collisionBoundary:Je,collisionPadding:rt,sticky:it,hideWhenDetached:nt,avoidCollisions:tt,...st}=ie,ot=$cc7e05a45900e73f$var$useSelectContext($cc7e05a45900e73f$var$CONTENT_NAME,ee),[ut,ft]=reactExports.useState(null),[pt,Xr]=reactExports.useState(null),mt=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(Z,vi=>ft(vi)),[Yr,ri]=reactExports.useState(null),[Zr,_r]=reactExports.useState(null),Kr=$cc7e05a45900e73f$var$useCollection(ee),[si,oi]=reactExports.useState(!1),Qr=reactExports.useRef(!1);reactExports.useEffect(()=>{if(ut)return hideOthers(ut)},[ut]),$3db38b7d1fb3fe6a$export$b7ece24a22aeda8c();const ii=reactExports.useCallback(vi=>{const[Si,...Fi]=Kr().map(Mi=>Mi.ref.current),[Di]=Fi.slice(-1),Oi=document.activeElement;for(const Mi of vi)if(Mi===Oi||(Mi==null||Mi.scrollIntoView({block:"nearest"}),Mi===Si&&pt&&(pt.scrollTop=0),Mi===Di&&pt&&(pt.scrollTop=pt.scrollHeight),Mi==null||Mi.focus(),document.activeElement!==Oi))return},[Kr,pt]),ti=reactExports.useCallback(()=>ii([Yr,ut]),[ii,Yr,ut]);reactExports.useEffect(()=>{si&&ti()},[si,ti]);const{onOpenChange:ni,triggerPointerDownPosRef:ui}=ot;reactExports.useEffect(()=>{if(ut){let vi={x:0,y:0};const Si=Di=>{var Oi,Mi,lt,gt;vi={x:Math.abs(Math.round(Di.pageX)-((Oi=(Mi=ui.current)===null||Mi===void 0?void 0:Mi.x)!==null&&Oi!==void 0?Oi:0)),y:Math.abs(Math.round(Di.pageY)-((lt=(gt=ui.current)===null||gt===void 0?void 0:gt.y)!==null&&lt!==void 0?lt:0))}},Fi=Di=>{vi.x<=10&&vi.y<=10?Di.preventDefault():ut.contains(Di.target)||ni(!1),document.removeEventListener("pointermove",Si),ui.current=null};return ui.current!==null&&(document.addEventListener("pointermove",Si),document.addEventListener("pointerup",Fi,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",Si),document.removeEventListener("pointerup",Fi,{capture:!0})}}},[ut,ni,ui]),reactExports.useEffect(()=>{const vi=()=>ni(!1);return window.addEventListener("blur",vi),window.addEventListener("resize",vi),()=>{window.removeEventListener("blur",vi),window.removeEventListener("resize",vi)}},[ni]);const[yi,pi]=$cc7e05a45900e73f$var$useTypeaheadSearch(vi=>{const Si=Kr().filter(Oi=>!Oi.disabled),Fi=Si.find(Oi=>Oi.ref.current===document.activeElement),Di=$cc7e05a45900e73f$var$findNextItem(Si,vi,Fi);Di&&setTimeout(()=>Di.ref.current.focus())}),gi=reactExports.useCallback((vi,Si,Fi)=>{const Di=!Qr.current&&!Fi;(ot.value!==void 0&&ot.value===Si||Di)&&(ri(vi),Di&&(Qr.current=!0))},[ot.value]),Ri=reactExports.useCallback(()=>ut==null?void 0:ut.focus(),[ut]),Ei=reactExports.useCallback((vi,Si,Fi)=>{const Di=!Qr.current&&!Fi;(ot.value!==void 0&&ot.value===Si||Di)&&_r(vi)},[ot.value]),xi=ae==="popper"?$cc7e05a45900e73f$var$SelectPopperPosition:$cc7e05a45900e73f$var$SelectItemAlignedPosition,Ii=xi===$cc7e05a45900e73f$var$SelectPopperPosition?{side:Ke,sideOffset:Ye,align:Xe,alignOffset:Qe,arrowPadding:et,collisionBoundary:Je,collisionPadding:rt,sticky:it,hideWhenDetached:nt,avoidCollisions:tt}:{};return reactExports.createElement($cc7e05a45900e73f$var$SelectContentProvider,{scope:ee,content:ut,viewport:pt,onViewportChange:Xr,itemRefCallback:gi,selectedItem:Yr,onItemLeave:Ri,itemTextRefCallback:Ei,focusSelectedItem:ti,selectedItemText:Zr,position:ae,isPositioned:si,searchRef:yi},reactExports.createElement($01b9c$RemoveScroll,{as:$5e63c961fc1ce211$export$8c6ed5c666ac1360,allowPinchZoom:!0},reactExports.createElement($d3863c46a17e8a28$export$20e40289641fbbb6,{asChild:!0,trapped:ot.open,onMountAutoFocus:vi=>{vi.preventDefault()},onUnmountAutoFocus:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ve,vi=>{var Si;(Si=ot.trigger)===null||Si===void 0||Si.focus({preventScroll:!0}),vi.preventDefault()})},reactExports.createElement($5cb92bef7577960e$export$177fb62ff3ec1f22,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:ye,onPointerDownOutside:be,onFocusOutside:vi=>vi.preventDefault(),onDismiss:()=>ot.onOpenChange(!1)},reactExports.createElement(xi,_extends$1({role:"listbox",id:ot.contentId,"data-state":ot.open?"open":"closed",dir:ot.dir,onContextMenu:vi=>vi.preventDefault()},st,Ii,{onPlaced:()=>oi(!0),ref:mt,style:{display:"flex",flexDirection:"column",outline:"none",...st.style},onKeyDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(st.onKeyDown,vi=>{const Si=vi.ctrlKey||vi.altKey||vi.metaKey;if(vi.key==="Tab"&&vi.preventDefault(),!Si&&vi.key.length===1&&pi(vi.key),["ArrowUp","ArrowDown","Home","End"].includes(vi.key)){let Di=Kr().filter(Oi=>!Oi.disabled).map(Oi=>Oi.ref.current);if(["ArrowUp","End"].includes(vi.key)&&(Di=Di.slice().reverse()),["ArrowUp","ArrowDown"].includes(vi.key)){const Oi=vi.target,Mi=Di.indexOf(Oi);Di=Di.slice(Mi+1)}setTimeout(()=>ii(Di)),vi.preventDefault()}})}))))))}),$cc7e05a45900e73f$var$SelectItemAlignedPosition=reactExports.forwardRef((ie,Z)=>{const{__scopeSelect:ee,onPlaced:ae,...ve}=ie,ye=$cc7e05a45900e73f$var$useSelectContext($cc7e05a45900e73f$var$CONTENT_NAME,ee),be=$cc7e05a45900e73f$var$useSelectContentContext($cc7e05a45900e73f$var$CONTENT_NAME,ee),[Ke,Ye]=reactExports.useState(null),[Xe,Qe]=reactExports.useState(null),et=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(Z,mt=>Qe(mt)),Je=$cc7e05a45900e73f$var$useCollection(ee),rt=reactExports.useRef(!1),it=reactExports.useRef(!0),{viewport:nt,selectedItem:tt,selectedItemText:st,focusSelectedItem:ot}=be,ut=reactExports.useCallback(()=>{if(ye.trigger&&ye.valueNode&&Ke&&Xe&&nt&&tt&&st){const mt=ye.trigger.getBoundingClientRect(),Yr=Xe.getBoundingClientRect(),ri=ye.valueNode.getBoundingClientRect(),Zr=st.getBoundingClientRect();if(ye.dir!=="rtl"){const Oi=Zr.left-Yr.left,Mi=ri.left-Oi,lt=mt.left-Mi,gt=mt.width+lt,ai=Math.max(gt,Yr.width),li=window.innerWidth-$cc7e05a45900e73f$var$CONTENT_MARGIN,ci=$ae6933e535247d3d$export$7d15b64cf5a3a4c4(Mi,[$cc7e05a45900e73f$var$CONTENT_MARGIN,li-ai]);Ke.style.minWidth=gt+"px",Ke.style.left=ci+"px"}else{const Oi=Yr.right-Zr.right,Mi=window.innerWidth-ri.right-Oi,lt=window.innerWidth-mt.right-Mi,gt=mt.width+lt,ai=Math.max(gt,Yr.width),li=window.innerWidth-$cc7e05a45900e73f$var$CONTENT_MARGIN,ci=$ae6933e535247d3d$export$7d15b64cf5a3a4c4(Mi,[$cc7e05a45900e73f$var$CONTENT_MARGIN,li-ai]);Ke.style.minWidth=gt+"px",Ke.style.right=ci+"px"}const _r=Je(),Kr=window.innerHeight-$cc7e05a45900e73f$var$CONTENT_MARGIN*2,si=nt.scrollHeight,oi=window.getComputedStyle(Xe),Qr=parseInt(oi.borderTopWidth,10),ii=parseInt(oi.paddingTop,10),ti=parseInt(oi.borderBottomWidth,10),ni=parseInt(oi.paddingBottom,10),ui=Qr+ii+si+ni+ti,yi=Math.min(tt.offsetHeight*5,ui),pi=window.getComputedStyle(nt),gi=parseInt(pi.paddingTop,10),Ri=parseInt(pi.paddingBottom,10),Ei=mt.top+mt.height/2-$cc7e05a45900e73f$var$CONTENT_MARGIN,xi=Kr-Ei,Ii=tt.offsetHeight/2,vi=tt.offsetTop+Ii,Si=Qr+ii+vi,Fi=ui-Si;if(Si<=Ei){const Oi=tt===_r[_r.length-1].ref.current;Ke.style.bottom="0px";const Mi=Xe.clientHeight-nt.offsetTop-nt.offsetHeight,lt=Math.max(xi,Ii+(Oi?Ri:0)+Mi+ti),gt=Si+lt;Ke.style.height=gt+"px"}else{const Oi=tt===_r[0].ref.current;Ke.style.top="0px";const lt=Math.max(Ei,Qr+nt.offsetTop+(Oi?gi:0)+Ii)+Fi;Ke.style.height=lt+"px",nt.scrollTop=Si-Ei+nt.offsetTop}Ke.style.margin=`${$cc7e05a45900e73f$var$CONTENT_MARGIN}px 0`,Ke.style.minHeight=yi+"px",Ke.style.maxHeight=Kr+"px",ae==null||ae(),requestAnimationFrame(()=>rt.current=!0)}},[Je,ye.trigger,ye.valueNode,Ke,Xe,nt,tt,st,ye.dir,ae]);$9f79659886946c16$export$e5c5a5f917a5871c(()=>ut(),[ut]);const[ft,pt]=reactExports.useState();$9f79659886946c16$export$e5c5a5f917a5871c(()=>{Xe&&pt(window.getComputedStyle(Xe).zIndex)},[Xe]);const Xr=reactExports.useCallback(mt=>{mt&&it.current===!0&&(ut(),ot==null||ot(),it.current=!1)},[ut,ot]);return reactExports.createElement($cc7e05a45900e73f$var$SelectViewportProvider,{scope:ee,contentWrapper:Ke,shouldExpandOnScrollRef:rt,onScrollButtonChange:Xr},reactExports.createElement("div",{ref:Ye,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:ft}},reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({},ve,{ref:et,style:{boxSizing:"border-box",maxHeight:"100%",...ve.style}}))))}),$cc7e05a45900e73f$var$SelectPopperPosition=reactExports.forwardRef((ie,Z)=>{const{__scopeSelect:ee,align:ae="start",collisionPadding:ve=$cc7e05a45900e73f$var$CONTENT_MARGIN,...ye}=ie,be=$cc7e05a45900e73f$var$usePopperScope(ee);return reactExports.createElement($cf1ac5d9fe0e8206$export$7c6e2c02157bb7d2,_extends$1({},be,ye,{ref:Z,align:ae,collisionPadding:ve,style:{boxSizing:"border-box",...ye.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}}))}),[$cc7e05a45900e73f$var$SelectViewportProvider,$cc7e05a45900e73f$var$useSelectViewportContext]=$cc7e05a45900e73f$var$createSelectContext($cc7e05a45900e73f$var$CONTENT_NAME,{}),$cc7e05a45900e73f$var$VIEWPORT_NAME="SelectViewport",$cc7e05a45900e73f$export$9ed6e7b40248d36d=reactExports.forwardRef((ie,Z)=>{const{__scopeSelect:ee,...ae}=ie,ve=$cc7e05a45900e73f$var$useSelectContentContext($cc7e05a45900e73f$var$VIEWPORT_NAME,ee),ye=$cc7e05a45900e73f$var$useSelectViewportContext($cc7e05a45900e73f$var$VIEWPORT_NAME,ee),be=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(Z,ve.onViewportChange),Ke=reactExports.useRef(0);return reactExports.createElement(reactExports.Fragment,null,reactExports.createElement("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"}}),reactExports.createElement($cc7e05a45900e73f$var$Collection.Slot,{scope:ee},reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({"data-radix-select-viewport":"",role:"presentation"},ae,{ref:be,style:{position:"relative",flex:1,overflow:"auto",...ae.style},onScroll:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ae.onScroll,Ye=>{const Xe=Ye.currentTarget,{contentWrapper:Qe,shouldExpandOnScrollRef:et}=ye;if(et!=null&&et.current&&Qe){const Je=Math.abs(Ke.current-Xe.scrollTop);if(Je>0){const rt=window.innerHeight-$cc7e05a45900e73f$var$CONTENT_MARGIN*2,it=parseFloat(Qe.style.minHeight),nt=parseFloat(Qe.style.height),tt=Math.max(it,nt);if(tt<rt){const st=tt+Je,ot=Math.min(rt,st),ut=st-ot;Qe.style.height=ot+"px",Qe.style.bottom==="0px"&&(Xe.scrollTop=ut>0?ut:0,Qe.style.justifyContent="flex-end")}}}Ke.current=Xe.scrollTop})}))))}),$cc7e05a45900e73f$var$GROUP_NAME="SelectGroup",[$cc7e05a45900e73f$var$SelectGroupContextProvider,$cc7e05a45900e73f$var$useSelectGroupContext]=$cc7e05a45900e73f$var$createSelectContext($cc7e05a45900e73f$var$GROUP_NAME),$cc7e05a45900e73f$export$ee25a334c55de1f4=reactExports.forwardRef((ie,Z)=>{const{__scopeSelect:ee,...ae}=ie,ve=$1746a345f3d73bb7$export$f680877a34711e37();return reactExports.createElement($cc7e05a45900e73f$var$SelectGroupContextProvider,{scope:ee,id:ve},reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({role:"group","aria-labelledby":ve},ae,{ref:Z})))}),$cc7e05a45900e73f$var$LABEL_NAME="SelectLabel",$cc7e05a45900e73f$export$f67338d29bd972f8=reactExports.forwardRef((ie,Z)=>{const{__scopeSelect:ee,...ae}=ie,ve=$cc7e05a45900e73f$var$useSelectGroupContext($cc7e05a45900e73f$var$LABEL_NAME,ee);return reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({id:ve.id},ae,{ref:Z}))}),$cc7e05a45900e73f$var$ITEM_NAME="SelectItem",[$cc7e05a45900e73f$var$SelectItemContextProvider,$cc7e05a45900e73f$var$useSelectItemContext]=$cc7e05a45900e73f$var$createSelectContext($cc7e05a45900e73f$var$ITEM_NAME),$cc7e05a45900e73f$export$13ef48a934230896=reactExports.forwardRef((ie,Z)=>{const{__scopeSelect:ee,value:ae,disabled:ve=!1,textValue:ye,...be}=ie,Ke=$cc7e05a45900e73f$var$useSelectContext($cc7e05a45900e73f$var$ITEM_NAME,ee),Ye=$cc7e05a45900e73f$var$useSelectContentContext($cc7e05a45900e73f$var$ITEM_NAME,ee),Xe=Ke.value===ae,[Qe,et]=reactExports.useState(ye??""),[Je,rt]=reactExports.useState(!1),it=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(Z,st=>{var ot;return(ot=Ye.itemRefCallback)===null||ot===void 0?void 0:ot.call(Ye,st,ae,ve)}),nt=$1746a345f3d73bb7$export$f680877a34711e37(),tt=()=>{ve||(Ke.onValueChange(ae),Ke.onOpenChange(!1))};if(ae==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return reactExports.createElement($cc7e05a45900e73f$var$SelectItemContextProvider,{scope:ee,value:ae,disabled:ve,textId:nt,isSelected:Xe,onItemTextChange:reactExports.useCallback(st=>{et(ot=>{var ut;return ot||((ut=st==null?void 0:st.textContent)!==null&&ut!==void 0?ut:"").trim()})},[])},reactExports.createElement($cc7e05a45900e73f$var$Collection.ItemSlot,{scope:ee,value:ae,disabled:ve,textValue:Qe},reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({role:"option","aria-labelledby":nt,"data-highlighted":Je?"":void 0,"aria-selected":Xe&&Je,"data-state":Xe?"checked":"unchecked","aria-disabled":ve||void 0,"data-disabled":ve?"":void 0,tabIndex:ve?void 0:-1},be,{ref:it,onFocus:$e42e1063c40fb3ef$export$b9ecd428b558ff10(be.onFocus,()=>rt(!0)),onBlur:$e42e1063c40fb3ef$export$b9ecd428b558ff10(be.onBlur,()=>rt(!1)),onPointerUp:$e42e1063c40fb3ef$export$b9ecd428b558ff10(be.onPointerUp,tt),onPointerMove:$e42e1063c40fb3ef$export$b9ecd428b558ff10(be.onPointerMove,st=>{if(ve){var ot;(ot=Ye.onItemLeave)===null||ot===void 0||ot.call(Ye)}else st.currentTarget.focus({preventScroll:!0})}),onPointerLeave:$e42e1063c40fb3ef$export$b9ecd428b558ff10(be.onPointerLeave,st=>{if(st.currentTarget===document.activeElement){var ot;(ot=Ye.onItemLeave)===null||ot===void 0||ot.call(Ye)}}),onKeyDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(be.onKeyDown,st=>{var ot;((ot=Ye.searchRef)===null||ot===void 0?void 0:ot.current)!==""&&st.key===" "||($cc7e05a45900e73f$var$SELECTION_KEYS.includes(st.key)&&tt(),st.key===" "&&st.preventDefault())})}))))}),$cc7e05a45900e73f$var$ITEM_TEXT_NAME="SelectItemText",$cc7e05a45900e73f$export$3572fb0fb821ff49=reactExports.forwardRef((ie,Z)=>{const{__scopeSelect:ee,className:ae,style:ve,...ye}=ie,be=$cc7e05a45900e73f$var$useSelectContext($cc7e05a45900e73f$var$ITEM_TEXT_NAME,ee),Ke=$cc7e05a45900e73f$var$useSelectContentContext($cc7e05a45900e73f$var$ITEM_TEXT_NAME,ee),Ye=$cc7e05a45900e73f$var$useSelectItemContext($cc7e05a45900e73f$var$ITEM_TEXT_NAME,ee),Xe=$cc7e05a45900e73f$var$useSelectNativeOptionsContext($cc7e05a45900e73f$var$ITEM_TEXT_NAME,ee),[Qe,et]=reactExports.useState(null),Je=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(Z,st=>et(st),Ye.onItemTextChange,st=>{var ot;return(ot=Ke.itemTextRefCallback)===null||ot===void 0?void 0:ot.call(Ke,st,Ye.value,Ye.disabled)}),rt=Qe==null?void 0:Qe.textContent,it=reactExports.useMemo(()=>reactExports.createElement("option",{key:Ye.value,value:Ye.value,disabled:Ye.disabled},rt),[Ye.disabled,Ye.value,rt]),{onNativeOptionAdd:nt,onNativeOptionRemove:tt}=Xe;return $9f79659886946c16$export$e5c5a5f917a5871c(()=>(nt(it),()=>tt(it)),[nt,tt,it]),reactExports.createElement(reactExports.Fragment,null,reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.span,_extends$1({id:Ye.textId},ye,{ref:Je})),Ye.isSelected&&be.valueNode&&!be.valueNodeHasChildren?reactDomExports.createPortal(ye.children,be.valueNode):null)}),$cc7e05a45900e73f$var$ITEM_INDICATOR_NAME="SelectItemIndicator",$cc7e05a45900e73f$export$6b9198de19accfe6=reactExports.forwardRef((ie,Z)=>{const{__scopeSelect:ee,...ae}=ie;return $cc7e05a45900e73f$var$useSelectItemContext($cc7e05a45900e73f$var$ITEM_INDICATOR_NAME,ee).isSelected?reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.span,_extends$1({"aria-hidden":!0},ae,{ref:Z})):null}),$cc7e05a45900e73f$var$SCROLL_UP_BUTTON_NAME="SelectScrollUpButton",$cc7e05a45900e73f$export$d8117927658af6d7=reactExports.forwardRef((ie,Z)=>{const ee=$cc7e05a45900e73f$var$useSelectContentContext($cc7e05a45900e73f$var$SCROLL_UP_BUTTON_NAME,ie.__scopeSelect),ae=$cc7e05a45900e73f$var$useSelectViewportContext($cc7e05a45900e73f$var$SCROLL_UP_BUTTON_NAME,ie.__scopeSelect),[ve,ye]=reactExports.useState(!1),be=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(Z,ae.onScrollButtonChange);return $9f79659886946c16$export$e5c5a5f917a5871c(()=>{if(ee.viewport&&ee.isPositioned){let Ye=function(){const Xe=Ke.scrollTop>0;ye(Xe)};const Ke=ee.viewport;return Ye(),Ke.addEventListener("scroll",Ye),()=>Ke.removeEventListener("scroll",Ye)}},[ee.viewport,ee.isPositioned]),ve?reactExports.createElement($cc7e05a45900e73f$var$SelectScrollButtonImpl,_extends$1({},ie,{ref:be,onAutoScroll:()=>{const{viewport:Ke,selectedItem:Ye}=ee;Ke&&Ye&&(Ke.scrollTop=Ke.scrollTop-Ye.offsetHeight)}})):null}),$cc7e05a45900e73f$var$SCROLL_DOWN_BUTTON_NAME="SelectScrollDownButton",$cc7e05a45900e73f$export$ff951e476c12189=reactExports.forwardRef((ie,Z)=>{const ee=$cc7e05a45900e73f$var$useSelectContentContext($cc7e05a45900e73f$var$SCROLL_DOWN_BUTTON_NAME,ie.__scopeSelect),ae=$cc7e05a45900e73f$var$useSelectViewportContext($cc7e05a45900e73f$var$SCROLL_DOWN_BUTTON_NAME,ie.__scopeSelect),[ve,ye]=reactExports.useState(!1),be=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(Z,ae.onScrollButtonChange);return $9f79659886946c16$export$e5c5a5f917a5871c(()=>{if(ee.viewport&&ee.isPositioned){let Ye=function(){const Xe=Ke.scrollHeight-Ke.clientHeight,Qe=Math.ceil(Ke.scrollTop)<Xe;ye(Qe)};const Ke=ee.viewport;return Ye(),Ke.addEventListener("scroll",Ye),()=>Ke.removeEventListener("scroll",Ye)}},[ee.viewport,ee.isPositioned]),ve?reactExports.createElement($cc7e05a45900e73f$var$SelectScrollButtonImpl,_extends$1({},ie,{ref:be,onAutoScroll:()=>{const{viewport:Ke,selectedItem:Ye}=ee;Ke&&Ye&&(Ke.scrollTop=Ke.scrollTop+Ye.offsetHeight)}})):null}),$cc7e05a45900e73f$var$SelectScrollButtonImpl=reactExports.forwardRef((ie,Z)=>{const{__scopeSelect:ee,onAutoScroll:ae,...ve}=ie,ye=$cc7e05a45900e73f$var$useSelectContentContext("SelectScrollButton",ee),be=reactExports.useRef(null),Ke=$cc7e05a45900e73f$var$useCollection(ee),Ye=reactExports.useCallback(()=>{be.current!==null&&(window.clearInterval(be.current),be.current=null)},[]);return reactExports.useEffect(()=>()=>Ye(),[Ye]),$9f79659886946c16$export$e5c5a5f917a5871c(()=>{var Xe;const Qe=Ke().find(et=>et.ref.current===document.activeElement);Qe==null||(Xe=Qe.ref.current)===null||Xe===void 0||Xe.scrollIntoView({block:"nearest"})},[Ke]),reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({"aria-hidden":!0},ve,{ref:Z,style:{flexShrink:0,...ve.style},onPointerDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ve.onPointerDown,()=>{be.current===null&&(be.current=window.setInterval(ae,50))}),onPointerMove:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ve.onPointerMove,()=>{var Xe;(Xe=ye.onItemLeave)===null||Xe===void 0||Xe.call(ye),be.current===null&&(be.current=window.setInterval(ae,50))}),onPointerLeave:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ve.onPointerLeave,()=>{Ye()})}))});function $cc7e05a45900e73f$var$shouldShowPlaceholder(ie){return ie===""||ie===void 0}const $cc7e05a45900e73f$var$BubbleSelect=reactExports.forwardRef((ie,Z)=>{const{value:ee,...ae}=ie,ve=reactExports.useRef(null),ye=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(Z,ve),be=$010c2913dbd2fe3d$export$5cae361ad82dce8b(ee);return reactExports.useEffect(()=>{const Ke=ve.current,Ye=window.HTMLSelectElement.prototype,Qe=Object.getOwnPropertyDescriptor(Ye,"value").set;if(be!==ee&&Qe){const et=new Event("change",{bubbles:!0});Qe.call(Ke,ee),Ke.dispatchEvent(et)}},[be,ee]),reactExports.createElement($ea1ef594cf570d83$export$439d29a4e110a164,{asChild:!0},reactExports.createElement("select",_extends$1({},ae,{ref:ye,defaultValue:ee})))});$cc7e05a45900e73f$var$BubbleSelect.displayName="BubbleSelect";function $cc7e05a45900e73f$var$useTypeaheadSearch(ie){const Z=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(ie),ee=reactExports.useRef(""),ae=reactExports.useRef(0),ve=reactExports.useCallback(be=>{const Ke=ee.current+be;Z(Ke),function Ye(Xe){ee.current=Xe,window.clearTimeout(ae.current),Xe!==""&&(ae.current=window.setTimeout(()=>Ye(""),1e3))}(Ke)},[Z]),ye=reactExports.useCallback(()=>{ee.current="",window.clearTimeout(ae.current)},[]);return reactExports.useEffect(()=>()=>window.clearTimeout(ae.current),[]),[ee,ve,ye]}function $cc7e05a45900e73f$var$findNextItem(ie,Z,ee){const ve=Z.length>1&&Array.from(Z).every(Xe=>Xe===Z[0])?Z[0]:Z,ye=ee?ie.indexOf(ee):-1;let be=$cc7e05a45900e73f$var$wrapArray(ie,Math.max(ye,0));ve.length===1&&(be=be.filter(Xe=>Xe!==ee));const Ye=be.find(Xe=>Xe.textValue.toLowerCase().startsWith(ve.toLowerCase()));return Ye!==ee?Ye:void 0}function $cc7e05a45900e73f$var$wrapArray(ie,Z){return ie.map((ee,ae)=>ie[(Z+ae)%ie.length])}const $cc7e05a45900e73f$export$be92b6f5f03c0fe9=$cc7e05a45900e73f$export$ef9b1a59e592288f,$cc7e05a45900e73f$export$41fb9f06171c75f4=$cc7e05a45900e73f$export$3ac1e88a1c0b9f1,$cc7e05a45900e73f$export$7c6e2c02157bb7d2=$cc7e05a45900e73f$export$c973a4b3cb86a03d,$cc7e05a45900e73f$export$b04be29aa201d4f5=$cc7e05a45900e73f$export$f67338d29bd972f8,$cc7e05a45900e73f$export$6d08773d2e66f8f2=$cc7e05a45900e73f$export$13ef48a934230896;var openseadragon={exports:{}};(function(module){//! openseadragon 2.4.2
//! Built on 2020-03-05
//! Git commit: v2.4.2-0-c450749
//! http://openseadragon.github.io
//! License: http://openseadragon.github.io/license/
function OpenSeadragon(ie){return new OpenSeadragon.Viewer(ie)}(function(ie){ie.version={versionStr:"2.4.2",major:parseInt("2",10),minor:parseInt("4",10),revision:parseInt("2",10)};var Z={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},ee=Object.prototype.toString,ae=Object.prototype.hasOwnProperty;ie.isFunction=function(ve){return ie.type(ve)==="function"},ie.isArray=Array.isArray||function(ve){return ie.type(ve)==="array"},ie.isWindow=function(ve){return ve&&typeof ve=="object"&&"setInterval"in ve},ie.type=function(ve){return ve==null?String(ve):Z[ee.call(ve)]||"object"},ie.isPlainObject=function(ve){if(!ve||OpenSeadragon.type(ve)!=="object"||ve.nodeType||ie.isWindow(ve)||ve.constructor&&!ae.call(ve,"constructor")&&!ae.call(ve.constructor.prototype,"isPrototypeOf"))return!1;var ye;for(var be in ve)ye=be;return ye===void 0||ae.call(ve,ye)},ie.isEmptyObject=function(ve){for(var ye in ve)return!1;return!0},ie.freezeObject=function(ve){return Object.freeze?ie.freezeObject=Object.freeze:ie.freezeObject=function(ye){return ye},ie.freezeObject(ve)},ie.supportsCanvas=function(){var ve=document.createElement("canvas");return!!(ie.isFunction(ve.getContext)&&ve.getContext("2d"))}(),ie.isCanvasTainted=function(ve){var ye=!1;try{ve.getContext("2d").getImageData(0,0,1,1)}catch{ye=!0}return ye},ie.pixelDensityRatio=function(){if(ie.supportsCanvas){var ve=document.createElement("canvas").getContext("2d"),ye=window.devicePixelRatio||1,be=ve.webkitBackingStorePixelRatio||ve.mozBackingStorePixelRatio||ve.msBackingStorePixelRatio||ve.oBackingStorePixelRatio||ve.backingStorePixelRatio||1;return Math.max(ye,1)/be}else return 1}()})(OpenSeadragon),function($){$.extend=function(){var ie,Z,ee,ae,ve,ye,be=arguments[0]||{},Ke=arguments.length,Ye=!1,Xe=1;for(typeof be=="boolean"&&(Ye=be,be=arguments[1]||{},Xe=2),typeof be!="object"&&!OpenSeadragon.isFunction(be)&&(be={}),Ke===Xe&&(be=this,--Xe);Xe<Ke;Xe++)if(ie=arguments[Xe],ie!==null||ie!==void 0)for(Z in ie)ee=be[Z],ae=ie[Z],be!==ae&&(Ye&&ae&&(OpenSeadragon.isPlainObject(ae)||(ve=OpenSeadragon.isArray(ae)))?(ve?(ve=!1,ye=ee&&OpenSeadragon.isArray(ee)?ee:[]):ye=ee&&OpenSeadragon.isPlainObject(ee)?ee:{},be[Z]=OpenSeadragon.extend(Ye,ye,ae)):ae!==void 0&&(be[Z]=ae));return be};var isIOSDevice=function(){if(typeof navigator!="object")return!1;var ie=navigator.userAgent;return typeof ie!="string"?!1:ie.indexOf("iPhone")!==-1||ie.indexOf("iPad")!==-1||ie.indexOf("iPod")!==-1};$.extend($,{DEFAULT_SETTINGS:{xmlPath:null,tileSources:null,tileHost:null,initialPage:0,crossOriginPolicy:!1,ajaxWithCredentials:!1,loadTilesWithAjax:!1,ajaxHeaders:{},panHorizontal:!0,panVertical:!0,constrainDuringPan:!1,wrapHorizontal:!1,wrapVertical:!1,visibilityRatio:.5,minPixelRatio:.5,defaultZoomLevel:0,minZoomLevel:null,maxZoomLevel:null,homeFillsViewer:!1,clickTimeThreshold:300,clickDistThreshold:5,dblClickTimeThreshold:300,dblClickDistThreshold:20,springStiffness:6.5,animationTime:1.2,gestureSettingsMouse:{scrollToZoom:!0,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsTouch:{scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsPen:{scrollToZoom:!1,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsUnknown:{scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},zoomPerClick:2,zoomPerScroll:1.2,zoomPerSecond:1,blendTime:0,alwaysBlend:!1,autoHideControls:!0,immediateRender:!1,minZoomImageRatio:.9,maxZoomPixelRatio:1.1,smoothTileEdgesMinZoom:1.1,iOSDevice:isIOSDevice(),pixelsPerWheelLine:40,pixelsPerArrowPress:40,autoResize:!0,preserveImageSizeOnResize:!1,minScrollDeltaTime:50,rotationIncrement:90,showSequenceControl:!0,sequenceControlAnchor:null,preserveViewport:!1,preserveOverlays:!1,navPrevNextWrap:!1,showNavigationControl:!0,navigationControlAnchor:null,showZoomControl:!0,showHomeControl:!0,showFullPageControl:!0,showRotationControl:!1,showFlipControl:!1,controlsFadeDelay:2e3,controlsFadeLength:1500,mouseNavEnabled:!0,showNavigator:!1,navigatorId:null,navigatorPosition:null,navigatorSizeRatio:.2,navigatorMaintainSizeRatio:!1,navigatorTop:null,navigatorLeft:null,navigatorHeight:null,navigatorWidth:null,navigatorAutoResize:!0,navigatorAutoFade:!0,navigatorRotate:!0,navigatorBackground:"#000",navigatorOpacity:.8,navigatorBorderColor:"#555",navigatorDisplayRegionColor:"#900",degrees:0,flipped:!1,opacity:1,preload:!1,compositeOperation:null,imageSmoothingEnabled:!0,placeholderFillStyle:null,showReferenceStrip:!1,referenceStripScroll:"horizontal",referenceStripElement:null,referenceStripHeight:null,referenceStripWidth:null,referenceStripPosition:"BOTTOM_LEFT",referenceStripSizeRatio:.2,collectionRows:3,collectionColumns:0,collectionLayout:"horizontal",collectionMode:!1,collectionTileSize:800,collectionTileMargin:80,imageLoaderLimit:0,maxImageCacheCount:200,timeout:3e4,useCanvas:!0,prefixUrl:"/images/",navImages:{zoomIn:{REST:"zoomin_rest.png",GROUP:"zoomin_grouphover.png",HOVER:"zoomin_hover.png",DOWN:"zoomin_pressed.png"},zoomOut:{REST:"zoomout_rest.png",GROUP:"zoomout_grouphover.png",HOVER:"zoomout_hover.png",DOWN:"zoomout_pressed.png"},home:{REST:"home_rest.png",GROUP:"home_grouphover.png",HOVER:"home_hover.png",DOWN:"home_pressed.png"},fullpage:{REST:"fullpage_rest.png",GROUP:"fullpage_grouphover.png",HOVER:"fullpage_hover.png",DOWN:"fullpage_pressed.png"},rotateleft:{REST:"rotateleft_rest.png",GROUP:"rotateleft_grouphover.png",HOVER:"rotateleft_hover.png",DOWN:"rotateleft_pressed.png"},rotateright:{REST:"rotateright_rest.png",GROUP:"rotateright_grouphover.png",HOVER:"rotateright_hover.png",DOWN:"rotateright_pressed.png"},flip:{REST:"flip_rest.png",GROUP:"flip_grouphover.png",HOVER:"flip_hover.png",DOWN:"flip_pressed.png"},previous:{REST:"previous_rest.png",GROUP:"previous_grouphover.png",HOVER:"previous_hover.png",DOWN:"previous_pressed.png"},next:{REST:"next_rest.png",GROUP:"next_grouphover.png",HOVER:"next_hover.png",DOWN:"next_pressed.png"}},debugMode:!1,debugGridColor:["#437AB2","#1B9E77","#D95F02","#7570B3","#E7298A","#66A61E","#E6AB02","#A6761D","#666666"]},SIGNAL:"----seadragon----",delegate:function(ie,Z){return function(){var ee=arguments;return ee===void 0&&(ee=[]),Z.apply(ie,ee)}},BROWSERS:{UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5},getElement:function(ie){return typeof ie=="string"&&(ie=document.getElementById(ie)),ie},getElementPosition:function(ie){var Z=new $.Point,ee,ae;for(ie=$.getElement(ie),ee=$.getElementStyle(ie).position=="fixed",ae=getOffsetParent(ie,ee);ae;)Z.x+=ie.offsetLeft,Z.y+=ie.offsetTop,ee&&(Z=Z.plus($.getPageScroll())),ie=ae,ee=$.getElementStyle(ie).position=="fixed",ae=getOffsetParent(ie,ee);return Z},getElementOffset:function(ie){ie=$.getElement(ie);var Z=ie&&ie.ownerDocument,ee,ae,ve={top:0,left:0};return Z?(ee=Z.documentElement,typeof ie.getBoundingClientRect<"u"&&(ve=ie.getBoundingClientRect()),ae=Z==Z.window?Z:Z.nodeType===9?Z.defaultView||Z.parentWindow:!1,new $.Point(ve.left+(ae.pageXOffset||ee.scrollLeft)-(ee.clientLeft||0),ve.top+(ae.pageYOffset||ee.scrollTop)-(ee.clientTop||0))):new $.Point},getElementSize:function(ie){return ie=$.getElement(ie),new $.Point(ie.clientWidth,ie.clientHeight)},getElementStyle:document.documentElement.currentStyle?function(ie){return ie=$.getElement(ie),ie.currentStyle}:function(ie){return ie=$.getElement(ie),window.getComputedStyle(ie,"")},getCssPropertyWithVendorPrefix:function(ie){var Z={};return $.getCssPropertyWithVendorPrefix=function(ee){if(Z[ee]!==void 0)return Z[ee];var ae=document.createElement("div").style,ve=null;if(ae[ee]!==void 0)ve=ee;else for(var ye=["Webkit","Moz","MS","O","webkit","moz","ms","o"],be=$.capitalizeFirstLetter(ee),Ke=0;Ke<ye.length;Ke++){var Ye=ye[Ke]+be;if(ae[Ye]!==void 0){ve=Ye;break}}return Z[ee]=ve,ve},$.getCssPropertyWithVendorPrefix(ie)},capitalizeFirstLetter:function(ie){return ie.charAt(0).toUpperCase()+ie.slice(1)},positiveModulo:function(ie,Z){var ee=ie%Z;return ee<0&&(ee+=Z),ee},pointInElement:function(ie,Z){ie=$.getElement(ie);var ee=$.getElementOffset(ie),ae=$.getElementSize(ie);return Z.x>=ee.x&&Z.x<ee.x+ae.x&&Z.y<ee.y+ae.y&&Z.y>=ee.y},getEvent:function(ie){return ie?$.getEvent=function(Z){return Z}:$.getEvent=function(){return window.event},$.getEvent(ie)},getMousePosition:function(ie){if(typeof ie.pageX=="number")$.getMousePosition=function(Z){var ee=new $.Point;return Z=$.getEvent(Z),ee.x=Z.pageX,ee.y=Z.pageY,ee};else if(typeof ie.clientX=="number")$.getMousePosition=function(Z){var ee=new $.Point;return Z=$.getEvent(Z),ee.x=Z.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,ee.y=Z.clientY+document.body.scrollTop+document.documentElement.scrollTop,ee};else throw new Error("Unknown event mouse position, no known technique.");return $.getMousePosition(ie)},getPageScroll:function(){var ie=document.documentElement||{},Z=document.body||{};if(typeof window.pageXOffset=="number")$.getPageScroll=function(){return new $.Point(window.pageXOffset,window.pageYOffset)};else if(Z.scrollLeft||Z.scrollTop)$.getPageScroll=function(){return new $.Point(document.body.scrollLeft,document.body.scrollTop)};else if(ie.scrollLeft||ie.scrollTop)$.getPageScroll=function(){return new $.Point(document.documentElement.scrollLeft,document.documentElement.scrollTop)};else return new $.Point(0,0);return $.getPageScroll()},setPageScroll:function(ie){if(typeof window.scrollTo<"u")$.setPageScroll=function(ae){window.scrollTo(ae.x,ae.y)};else{var Z=$.getPageScroll();if(Z.x===ie.x&&Z.y===ie.y)return;document.body.scrollLeft=ie.x,document.body.scrollTop=ie.y;var ee=$.getPageScroll();if(ee.x!==Z.x&&ee.y!==Z.y){$.setPageScroll=function(ae){document.body.scrollLeft=ae.x,document.body.scrollTop=ae.y};return}if(document.documentElement.scrollLeft=ie.x,document.documentElement.scrollTop=ie.y,ee=$.getPageScroll(),ee.x!==Z.x&&ee.y!==Z.y){$.setPageScroll=function(ae){document.documentElement.scrollLeft=ae.x,document.documentElement.scrollTop=ae.y};return}$.setPageScroll=function(ae){}}return $.setPageScroll(ie)},getWindowSize:function(){var ie=document.documentElement||{},Z=document.body||{};if(typeof window.innerWidth=="number")$.getWindowSize=function(){return new $.Point(window.innerWidth,window.innerHeight)};else if(ie.clientWidth||ie.clientHeight)$.getWindowSize=function(){return new $.Point(document.documentElement.clientWidth,document.documentElement.clientHeight)};else if(Z.clientWidth||Z.clientHeight)$.getWindowSize=function(){return new $.Point(document.body.clientWidth,document.body.clientHeight)};else throw new Error("Unknown window size, no known technique.");return $.getWindowSize()},makeCenteredNode:function(ie){ie=$.getElement(ie);var Z=[$.makeNeutralElement("div"),$.makeNeutralElement("div"),$.makeNeutralElement("div")];return $.extend(Z[0].style,{display:"table",height:"100%",width:"100%"}),$.extend(Z[1].style,{display:"table-row"}),$.extend(Z[2].style,{display:"table-cell",verticalAlign:"middle",textAlign:"center"}),Z[0].appendChild(Z[1]),Z[1].appendChild(Z[2]),Z[2].appendChild(ie),Z[0]},makeNeutralElement:function(ie){var Z=document.createElement(ie),ee=Z.style;return ee.background="transparent none",ee.border="none",ee.margin="0px",ee.padding="0px",ee.position="static",Z},now:function(){return Date.now?$.now=Date.now:$.now=function(){return new Date().getTime()},$.now()},makeTransparentImage:function(ie){return $.makeTransparentImage=function(Z){var ee=$.makeNeutralElement("img");return ee.src=Z,ee},$.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<7&&($.makeTransparentImage=function(Z){var ee=$.makeNeutralElement("img"),ae=null;return ae=$.makeNeutralElement("span"),ae.style.display="inline-block",ee.onload=function(){ae.style.width=ae.style.width||ee.width+"px",ae.style.height=ae.style.height||ee.height+"px",ee.onload=null,ee=null},ee.src=Z,ae.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+Z+"', sizingMethod='scale')",ae}),$.makeTransparentImage(ie)},setElementOpacity:function(ie,Z,ee){var ae,ve;ie=$.getElement(ie),ee&&!$.Browser.alpha&&(Z=Math.round(Z)),$.Browser.opacity?ie.style.opacity=Z<1?Z:"":Z<1?(ae=Math.round(100*Z),ve="alpha(opacity="+ae+")",ie.style.filter=ve):ie.style.filter=""},setElementTouchActionNone:function(ie){ie=$.getElement(ie),typeof ie.style.touchAction<"u"?ie.style.touchAction="none":typeof ie.style.msTouchAction<"u"&&(ie.style.msTouchAction="none")},addClass:function(ie,Z){ie=$.getElement(ie),ie.className?(" "+ie.className+" ").indexOf(" "+Z+" ")===-1&&(ie.className+=" "+Z):ie.className=Z},indexOf:function(ie,Z,ee){return Array.prototype.indexOf?this.indexOf=function(ae,ve,ye){return ae.indexOf(ve,ye)}:this.indexOf=function(ae,ve,ye){var be,Ke=ye||0,Ye;if(!ae)throw new TypeError;if(Ye=ae.length,Ye===0||Ke>=Ye)return-1;for(Ke<0&&(Ke=Ye-Math.abs(Ke)),be=Ke;be<Ye;be++)if(ae[be]===ve)return be;return-1},this.indexOf(ie,Z,ee)},removeClass:function(ie,Z){var ee,ae=[],ve;for(ie=$.getElement(ie),ee=ie.className.split(/\s+/),ve=0;ve<ee.length;ve++)ee[ve]&&ee[ve]!==Z&&ae.push(ee[ve]);ie.className=ae.join(" ")},addEvent:function(){if(window.addEventListener)return function(ie,Z,ee,ae){ie=$.getElement(ie),ie.addEventListener(Z,ee,ae)};if(window.attachEvent)return function(ie,Z,ee,ae){ie=$.getElement(ie),ie.attachEvent("on"+Z,ee)};throw new Error("No known event model.")}(),removeEvent:function(){if(window.removeEventListener)return function(ie,Z,ee,ae){ie=$.getElement(ie),ie.removeEventListener(Z,ee,ae)};if(window.detachEvent)return function(ie,Z,ee,ae){ie=$.getElement(ie),ie.detachEvent("on"+Z,ee)};throw new Error("No known event model.")}(),cancelEvent:function(ie){ie=$.getEvent(ie),ie.preventDefault?$.cancelEvent=function(Z){Z.preventDefault()}:$.cancelEvent=function(Z){Z=$.getEvent(Z),Z.cancel=!0,Z.returnValue=!1},$.cancelEvent(ie)},stopEvent:function(ie){ie=$.getEvent(ie),ie.stopPropagation?$.stopEvent=function(Z){Z.stopPropagation()}:$.stopEvent=function(Z){Z=$.getEvent(Z),Z.cancelBubble=!0},$.stopEvent(ie)},createCallback:function(ie,Z){var ee=[],ae;for(ae=2;ae<arguments.length;ae++)ee.push(arguments[ae]);return function(){var ve=ee.concat([]),ye;for(ye=0;ye<arguments.length;ye++)ve.push(arguments[ye]);return Z.apply(ie,ve)}},getUrlParameter:function(ie){var Z=URLPARAMS[ie];return Z||null},getUrlProtocol:function(ie){var Z=ie.match(/^([a-z]+:)\/\//i);return Z===null?window.location.protocol:Z[1].toLowerCase()},createAjaxRequest:function(ie){var Z;try{Z=!!new ActiveXObject("Microsoft.XMLHTTP")}catch{Z=!1}if(Z)window.XMLHttpRequest?$.createAjaxRequest=function(ee){return ee?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest}:$.createAjaxRequest=function(){return new ActiveXObject("Microsoft.XMLHTTP")};else if(window.XMLHttpRequest)$.createAjaxRequest=function(){return new XMLHttpRequest};else throw new Error("Browser doesn't support XMLHttpRequest.");return $.createAjaxRequest(ie)},makeAjaxRequest:function(ie,Z,ee){var ae,ve,ye;$.isPlainObject(ie)&&(Z=ie.success,ee=ie.error,ae=ie.withCredentials,ve=ie.headers,ye=ie.responseType||null,ie=ie.url);var be=$.getUrlProtocol(ie),Ke=$.createAjaxRequest(be==="file:");if(!$.isFunction(Z))throw new Error("makeAjaxRequest requires a success callback");Ke.onreadystatechange=function(){Ke.readyState==4&&(Ke.onreadystatechange=function(){},Ke.status>=200&&Ke.status<300||Ke.status===0&&be!=="http:"&&be!=="https:"?Z(Ke):($.console.log("AJAX request returned %d: %s",Ke.status,ie),$.isFunction(ee)&&ee(Ke)))};try{if(Ke.open("GET",ie,!0),ye&&(Ke.responseType=ye),ve)for(var Ye in ve)Object.prototype.hasOwnProperty.call(ve,Ye)&&ve[Ye]&&Ke.setRequestHeader(Ye,ve[Ye]);ae&&(Ke.withCredentials=!0),Ke.send(null)}catch(Je){var Xe=Je.message,Qe=$.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<10;if(Qe&&typeof Je.number<"u"&&Je.number==-2147024891&&(Xe+=`
See http://msdn.microsoft.com/en-us/library/ms537505(v=vs.85).aspx#xdomain`),$.console.log("%s while making AJAX request: %s",Je.name,Xe),Ke.onreadystatechange=function(){},window.XDomainRequest){var et=new window.XDomainRequest;if(et){et.onload=function(rt){$.isFunction(Z)&&Z({responseText:et.responseText,status:200,statusText:"OK"})},et.onerror=function(rt){$.isFunction(ee)&&ee({responseText:et.responseText,status:444,statusText:"An error happened. Due to an XDomainRequest deficiency we can not extract any information about this error. Upgrade your browser."})};try{et.open("GET",ie),et.send()}catch{$.isFunction(ee)&&ee(Ke,Je)}}}else $.isFunction(ee)&&ee(Ke,Je)}return Ke},jsonp:function(ie){var Z,ee=ie.url,ae=document.head||document.getElementsByTagName("head")[0]||document.documentElement,ve=ie.callbackName||"openseadragon"+$.now(),ye=window[ve],be="$1"+ve+"$2",Ke=ie.param||"callback",Ye=ie.callback;ee=ee.replace(/(\=)\?(&|$)|\?\?/i,be),ee+=(/\?/.test(ee)?"&":"?")+Ke+"="+ve,window[ve]=function(Xe){if(ye)window[ve]=ye;else try{delete window[ve]}catch{}Ye&&$.isFunction(Ye)&&Ye(Xe)},Z=document.createElement("script"),(ie.async!==void 0||ie.async!==!1)&&(Z.async="async"),ie.scriptCharset&&(Z.charset=ie.scriptCharset),Z.src=ee,Z.onload=Z.onreadystatechange=function(Xe,Qe){(Qe||!Z.readyState||/loaded|complete/.test(Z.readyState))&&(Z.onload=Z.onreadystatechange=null,ae&&Z.parentNode&&ae.removeChild(Z),Z=void 0)},ae.insertBefore(Z,ae.firstChild)},createFromDZI:function(){throw"OpenSeadragon.createFromDZI is deprecated, use Viewer.open."},parseXml:function(ie){if(window.DOMParser)$.parseXml=function(Z){var ee=null,ae;return ae=new DOMParser,ee=ae.parseFromString(Z,"text/xml"),ee};else if(window.ActiveXObject)$.parseXml=function(Z){var ee=null;return ee=new ActiveXObject("Microsoft.XMLDOM"),ee.async=!1,ee.loadXML(Z),ee};else throw new Error("Browser doesn't support XML DOM.");return $.parseXml(ie)},parseJSON:function(string){return window.JSON&&window.JSON.parse?$.parseJSON=window.JSON.parse:$.parseJSON=function(string){return eval("("+string+")")},$.parseJSON(string)},imageFormatSupported:function(ie){return ie=ie||"",!!FILEFORMATS[ie.toLowerCase()]}});var nullfunction=function(ie){};$.console=window.console||{log:nullfunction,debug:nullfunction,info:nullfunction,warn:nullfunction,error:nullfunction,assert:nullfunction},$.Browser={vendor:$.BROWSERS.UNKNOWN,version:0,alpha:!0};var FILEFORMATS={bmp:!1,jpeg:!0,jpg:!0,png:!0,tif:!1,wdp:!1},URLPARAMS={};(function(){var ie=navigator.appVersion,Z=navigator.userAgent,ee;switch(navigator.appName){case"Microsoft Internet Explorer":window.attachEvent&&window.ActiveXObject&&($.Browser.vendor=$.BROWSERS.IE,$.Browser.version=parseFloat(Z.substring(Z.indexOf("MSIE")+5,Z.indexOf(";",Z.indexOf("MSIE")))));break;case"Netscape":window.addEventListener&&(Z.indexOf("Firefox")>=0?($.Browser.vendor=$.BROWSERS.FIREFOX,$.Browser.version=parseFloat(Z.substring(Z.indexOf("Firefox")+8))):Z.indexOf("Safari")>=0?($.Browser.vendor=Z.indexOf("Chrome")>=0?$.BROWSERS.CHROME:$.BROWSERS.SAFARI,$.Browser.version=parseFloat(Z.substring(Z.substring(0,Z.indexOf("Safari")).lastIndexOf("/")+1,Z.indexOf("Safari")))):(ee=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})"),ee.exec(Z)!==null&&($.Browser.vendor=$.BROWSERS.IE,$.Browser.version=parseFloat(RegExp.$1))));break;case"Opera":$.Browser.vendor=$.BROWSERS.OPERA,$.Browser.version=parseFloat(ie);break}var ae=window.location.search.substring(1),ve=ae.split("&"),ye,be,Ke;for(Ke=0;Ke<ve.length;Ke++)if(ye=ve[Ke],be=ye.indexOf("="),be>0){var Ye=ye.substring(0,be),Xe=ye.substring(be+1);try{URLPARAMS[Ye]=decodeURIComponent(Xe)}catch{$.console.error("Ignoring malformed URL parameter: %s=%s",Ye,Xe)}}$.Browser.alpha=!($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<9||$.Browser.vendor==$.BROWSERS.CHROME&&$.Browser.version<2),$.Browser.opacity=!($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<9)})(),function(ie){var Z=ie.requestAnimationFrame||ie.mozRequestAnimationFrame||ie.webkitRequestAnimationFrame||ie.msRequestAnimationFrame,ee=ie.cancelAnimationFrame||ie.mozCancelAnimationFrame||ie.webkitCancelAnimationFrame||ie.msCancelAnimationFrame;if(Z&&ee)$.requestAnimationFrame=function(){return Z.apply(ie,arguments)},$.cancelAnimationFrame=function(){return ee.apply(ie,arguments)};else{var ae=[],ve=[],ye=0,be;$.requestAnimationFrame=function(Ke){return ae.push([++ye,Ke]),be||(be=setInterval(function(){if(ae.length){var Ye=$.now(),Xe=ve;for(ve=ae,ae=Xe;ve.length;)ve.shift()[1](Ye)}else clearInterval(be),be=void 0},1e3/50)),ye},$.cancelAnimationFrame=function(Ke){var Ye,Xe;for(Ye=0,Xe=ae.length;Ye<Xe;Ye+=1)if(ae[Ye][0]===Ke){ae.splice(Ye,1);return}for(Ye=0,Xe=ve.length;Ye<Xe;Ye+=1)if(ve[Ye][0]===Ke){ve.splice(Ye,1);return}}}}(window);function getOffsetParent(ie,Z){return Z&&ie!=document.body?document.body:ie.offsetParent}}(OpenSeadragon),function(ie,Z){module.exports?module.exports=Z():ie.OpenSeadragon=Z()}(commonjsGlobal,function(){return OpenSeadragon}),function(ie){var Z={supportsFullScreen:!1,isFullScreen:function(){return!1},getFullScreenElement:function(){return null},requestFullScreen:function(){},exitFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",fullScreenErrorEventName:""};document.exitFullscreen?(Z.supportsFullScreen=!0,Z.getFullScreenElement=function(){return document.fullscreenElement},Z.requestFullScreen=function(ee){return ee.requestFullscreen()},Z.exitFullScreen=function(){document.exitFullscreen()},Z.fullScreenEventName="fullscreenchange",Z.fullScreenErrorEventName="fullscreenerror"):document.msExitFullscreen?(Z.supportsFullScreen=!0,Z.getFullScreenElement=function(){return document.msFullscreenElement},Z.requestFullScreen=function(ee){return ee.msRequestFullscreen()},Z.exitFullScreen=function(){document.msExitFullscreen()},Z.fullScreenEventName="MSFullscreenChange",Z.fullScreenErrorEventName="MSFullscreenError"):document.webkitExitFullscreen?(Z.supportsFullScreen=!0,Z.getFullScreenElement=function(){return document.webkitFullscreenElement},Z.requestFullScreen=function(ee){return ee.webkitRequestFullscreen()},Z.exitFullScreen=function(){document.webkitExitFullscreen()},Z.fullScreenEventName="webkitfullscreenchange",Z.fullScreenErrorEventName="webkitfullscreenerror"):document.webkitCancelFullScreen?(Z.supportsFullScreen=!0,Z.getFullScreenElement=function(){return document.webkitCurrentFullScreenElement},Z.requestFullScreen=function(ee){return ee.webkitRequestFullScreen()},Z.exitFullScreen=function(){document.webkitCancelFullScreen()},Z.fullScreenEventName="webkitfullscreenchange",Z.fullScreenErrorEventName="webkitfullscreenerror"):document.mozCancelFullScreen&&(Z.supportsFullScreen=!0,Z.getFullScreenElement=function(){return document.mozFullScreenElement},Z.requestFullScreen=function(ee){return ee.mozRequestFullScreen()},Z.exitFullScreen=function(){document.mozCancelFullScreen()},Z.fullScreenEventName="mozfullscreenchange",Z.fullScreenErrorEventName="mozfullscreenerror"),Z.isFullScreen=function(){return Z.getFullScreenElement()!==null},Z.cancelFullScreen=function(){ie.console.error("cancelFullScreen is deprecated. Use exitFullScreen instead."),Z.exitFullScreen()},ie.extend(ie,Z)}(OpenSeadragon),function(ie){ie.EventSource=function(){this.events={}},ie.EventSource.prototype={addOnceHandler:function(Z,ee,ae,ve){var ye=this;ve=ve||1;var be=0,Ke=function(Ye){be++,be===ve&&ye.removeHandler(Z,Ke),ee(Ye)};this.addHandler(Z,Ke,ae)},addHandler:function(Z,ee,ae){var ve=this.events[Z];ve||(this.events[Z]=ve=[]),ee&&ie.isFunction(ee)&&(ve[ve.length]={handler:ee,userData:ae||null})},removeHandler:function(Z,ee){var ae=this.events[Z],ve=[],ye;if(ae&&ie.isArray(ae)){for(ye=0;ye<ae.length;ye++)ae[ye].handler!==ee&&ve.push(ae[ye]);this.events[Z]=ve}},removeAllHandlers:function(Z){if(Z)this.events[Z]=[];else for(var ee in this.events)this.events[ee]=[]},getHandler:function(Z){var ee=this.events[Z];return!ee||!ee.length?null:(ee=ee.length===1?[ee[0]]:Array.apply(null,ee),function(ae,ve){var ye,be=ee.length;for(ye=0;ye<be;ye++)ee[ye]&&(ve.eventSource=ae,ve.userData=ee[ye].userData,ee[ye].handler(ve))})},raiseEvent:function(Z,ee){var ae=this.getHandler(Z);ae&&(ee||(ee={}),ae(this,ee))}}}(OpenSeadragon),function(ie){var Z=[],ee={};ie.MouseTracker=function(dt){Z.push(this);var ct=arguments;ie.isPlainObject(dt)||(dt={element:ct[0],clickTimeThreshold:ct[1],clickDistThreshold:ct[2]}),this.hash=Math.random(),this.element=ie.getElement(dt.element),this.clickTimeThreshold=dt.clickTimeThreshold||ie.DEFAULT_SETTINGS.clickTimeThreshold,this.clickDistThreshold=dt.clickDistThreshold||ie.DEFAULT_SETTINGS.clickDistThreshold,this.dblClickTimeThreshold=dt.dblClickTimeThreshold||ie.DEFAULT_SETTINGS.dblClickTimeThreshold,this.dblClickDistThreshold=dt.dblClickDistThreshold||ie.DEFAULT_SETTINGS.dblClickDistThreshold,this.userData=dt.userData||null,this.stopDelay=dt.stopDelay||50,this.enterHandler=dt.enterHandler||null,this.exitHandler=dt.exitHandler||null,this.pressHandler=dt.pressHandler||null,this.nonPrimaryPressHandler=dt.nonPrimaryPressHandler||null,this.releaseHandler=dt.releaseHandler||null,this.nonPrimaryReleaseHandler=dt.nonPrimaryReleaseHandler||null,this.moveHandler=dt.moveHandler||null,this.scrollHandler=dt.scrollHandler||null,this.clickHandler=dt.clickHandler||null,this.dblClickHandler=dt.dblClickHandler||null,this.dragHandler=dt.dragHandler||null,this.dragEndHandler=dt.dragEndHandler||null,this.pinchHandler=dt.pinchHandler||null,this.stopHandler=dt.stopHandler||null,this.keyDownHandler=dt.keyDownHandler||null,this.keyUpHandler=dt.keyUpHandler||null,this.keyHandler=dt.keyHandler||null,this.focusHandler=dt.focusHandler||null,this.blurHandler=dt.blurHandler||null;var Jr=this;ee[this.hash]={click:function(ei){it(Jr,ei)},dblclick:function(ei){nt(Jr,ei)},keydown:function(ei){tt(Jr,ei)},keyup:function(ei){st(Jr,ei)},keypress:function(ei){ot(Jr,ei)},focus:function(ei){ut(Jr,ei)},blur:function(ei){ft(Jr,ei)},wheel:function(ei){pt(Jr,ei)},mousewheel:function(ei){Xr(Jr,ei)},DOMMouseScroll:function(ei){Xr(Jr,ei)},MozMousePixelScroll:function(ei){Xr(Jr,ei)},mouseenter:function(ei){ri(Jr,ei)},mouseleave:function(ei){Kr(Jr,ei)},mouseover:function(ei){Zr(Jr,ei)},mouseout:function(ei){si(Jr,ei)},mousedown:function(ei){ii(Jr,ei)},mouseup:function(ei){ti(Jr,ei)},mouseupcaptured:function(ei){ni(Jr,ei)},mousemove:function(ei){yi(Jr,ei)},mousemovecaptured:function(ei){pi(Jr,ei)},touchstart:function(ei){Ei(Jr,ei)},touchend:function(ei){xi(Jr,ei)},touchendcaptured:function(ei){Ii(Jr,ei)},touchmove:function(ei){Si(Jr,ei)},touchmovecaptured:function(ei){Fi(Jr,ei)},touchcancel:function(ei){Oi(Jr,ei)},gesturestart:function(ei){Mi(Jr,ei)},gesturechange:function(ei){lt(Jr,ei)},pointerover:function(ei){gt(Jr,ei)},MSPointerOver:function(ei){gt(Jr,ei)},pointerout:function(ei){ai(Jr,ei)},MSPointerOut:function(ei){ai(Jr,ei)},pointerdown:function(ei){li(Jr,ei)},MSPointerDown:function(ei){li(Jr,ei)},pointerup:function(ei){ci(Jr,ei)},MSPointerUp:function(ei){ci(Jr,ei)},pointermove:function(ei){Ni(Jr,ei)},MSPointerMove:function(ei){Ni(Jr,ei)},pointercancel:function(ei){wi(Jr,ei)},MSPointerCancel:function(ei){wi(Jr,ei)},pointerupcaptured:function(ei){Ai(Jr,ei)},pointermovecaptured:function(ei){ki(Jr,ei)},tracking:!1,activePointersLists:[],lastClickPos:null,dblClickTimeOut:null,pinchGPoints:[],lastPinchDist:0,currentPinchDist:0,lastPinchCenter:null,currentPinchCenter:null},dt.startDisabled||this.setTracking(!0)},ie.MouseTracker.prototype={destroy:function(){var dt;for(ye(this),this.element=null,dt=0;dt<Z.length;dt++)if(Z[dt]===this){Z.splice(dt,1);break}ee[this.hash]=null,delete ee[this.hash]},isTracking:function(){return ee[this.hash].tracking},setTracking:function(dt){return dt?ve(this):ye(this),this},getActivePointersListsExceptType:function(dt){for(var ct=ee[this.hash],Jr=[],ei=0;ei<ct.activePointersLists.length;++ei)ct.activePointersLists[ei].type!==dt&&Jr.push(ct.activePointersLists[ei]);return Jr},getActivePointersListByType:function(dt){var ct=ee[this.hash],Jr,ei=ct.activePointersLists.length,di;for(Jr=0;Jr<ei;Jr++)if(ct.activePointersLists[Jr].type===dt)return ct.activePointersLists[Jr];return di=new ie.MouseTracker.GesturePointList(dt),ct.activePointersLists.push(di),di},getActivePointerCount:function(){var dt=ee[this.hash],ct,Jr=dt.activePointersLists.length,ei=0;for(ct=0;ct<Jr;ct++)ei+=dt.activePointersLists[ct].getLength();return ei},enterHandler:function(){},exitHandler:function(){},pressHandler:function(){},nonPrimaryPressHandler:function(){},releaseHandler:function(){},nonPrimaryReleaseHandler:function(){},moveHandler:function(){},scrollHandler:function(){},clickHandler:function(){},dblClickHandler:function(){},dragHandler:function(){},dragEndHandler:function(){},pinchHandler:function(){},stopHandler:function(){},keyDownHandler:function(){},keyUpHandler:function(){},keyHandler:function(){},focusHandler:function(){},blurHandler:function(){}},ie.MouseTracker.resetAllMouseTrackers=function(){for(var dt=0;dt<Z.length;dt++)Z[dt].isTracking()&&(Z[dt].setTracking(!1),Z[dt].setTracking(!0))},ie.MouseTracker.gesturePointVelocityTracker=function(){var dt=[],ct=0,Jr=0,ei=function(fi,Ti){return fi.hash.toString()+Ti.type+Ti.id.toString()},di=function(){var fi,Ti=dt.length,_i,Pi,Bi=ie.now(),Ci,Wi,ji;for(Ci=Bi-Jr,Jr=Bi,fi=0;fi<Ti;fi++)_i=dt[fi],Pi=_i.gPoint,Pi.direction=Math.atan2(Pi.currentPos.y-_i.lastPos.y,Pi.currentPos.x-_i.lastPos.x),Wi=_i.lastPos.distanceTo(Pi.currentPos),_i.lastPos=Pi.currentPos,ji=1e3*Wi/(Ci+1),Pi.speed=.75*ji+.25*Pi.speed},bi=function(fi,Ti){var _i=ei(fi,Ti);dt.push({guid:_i,gPoint:Ti,lastPos:Ti.currentPos}),dt.length===1&&(Jr=ie.now(),ct=window.setInterval(di,50))},hi=function(fi,Ti){var _i=ei(fi,Ti),Pi,Bi=dt.length;for(Pi=0;Pi<Bi;Pi++)if(dt[Pi].guid===_i){dt.splice(Pi,1),Bi--,Bi===0&&window.clearInterval(ct);break}};return{addPoint:bi,removePoint:hi}}(),ie.MouseTracker.captureElement=document,ie.MouseTracker.wheelEventName=ie.Browser.vendor==ie.BROWSERS.IE&&ie.Browser.version>8||"onwheel"in document.createElement("div")?"wheel":document.onmousewheel!==void 0?"mousewheel":"DOMMouseScroll",ie.MouseTracker.supportsMouseCapture=function(){var dt=document.createElement("div");return ie.isFunction(dt.setCapture)&&ie.isFunction(dt.releaseCapture)}(),ie.MouseTracker.subscribeEvents=["click","dblclick","keydown","keyup","keypress","focus","blur",ie.MouseTracker.wheelEventName],ie.MouseTracker.wheelEventName=="DOMMouseScroll"&&ie.MouseTracker.subscribeEvents.push("MozMousePixelScroll"),window.PointerEvent&&(window.navigator.pointerEnabled||ie.Browser.vendor!==ie.BROWSERS.IE)?(ie.MouseTracker.havePointerEvents=!0,ie.MouseTracker.subscribeEvents.push("pointerover","pointerout","pointerdown","pointerup","pointermove","pointercancel"),ie.MouseTracker.unprefixedPointerEvents=!0,navigator.maxTouchPoints?ie.MouseTracker.maxTouchPoints=navigator.maxTouchPoints:ie.MouseTracker.maxTouchPoints=0,ie.MouseTracker.haveMouseEnter=!1):window.MSPointerEvent&&window.navigator.msPointerEnabled?(ie.MouseTracker.havePointerEvents=!0,ie.MouseTracker.subscribeEvents.push("MSPointerOver","MSPointerOut","MSPointerDown","MSPointerUp","MSPointerMove","MSPointerCancel"),ie.MouseTracker.unprefixedPointerEvents=!1,navigator.msMaxTouchPoints?ie.MouseTracker.maxTouchPoints=navigator.msMaxTouchPoints:ie.MouseTracker.maxTouchPoints=0,ie.MouseTracker.haveMouseEnter=!1):(ie.MouseTracker.havePointerEvents=!1,ie.Browser.vendor===ie.BROWSERS.IE&&ie.Browser.version<9?(ie.MouseTracker.subscribeEvents.push("mouseenter","mouseleave"),ie.MouseTracker.haveMouseEnter=!0):(ie.MouseTracker.subscribeEvents.push("mouseover","mouseout"),ie.MouseTracker.haveMouseEnter=!1),ie.MouseTracker.subscribeEvents.push("mousedown","mouseup","mousemove"),"ontouchstart"in window&&ie.MouseTracker.subscribeEvents.push("touchstart","touchend","touchmove","touchcancel"),"ongesturestart"in window&&ie.MouseTracker.subscribeEvents.push("gesturestart","gesturechange"),ie.MouseTracker.mousePointerId="legacy-mouse",ie.MouseTracker.maxTouchPoints=10),ie.MouseTracker.GesturePointList=function(dt){this._gPoints=[],this.type=dt,this.buttons=0,this.contacts=0,this.clicks=0,this.captureCount=0},ie.MouseTracker.GesturePointList.prototype={getLength:function(){return this._gPoints.length},asArray:function(){return this._gPoints},add:function(dt){return this._gPoints.push(dt)},removeById:function(dt){var ct,Jr=this._gPoints.length;for(ct=0;ct<Jr;ct++)if(this._gPoints[ct].id===dt){this._gPoints.splice(ct,1);break}return this._gPoints.length},getByIndex:function(dt){return dt<this._gPoints.length?this._gPoints[dt]:null},getById:function(dt){var ct,Jr=this._gPoints.length;for(ct=0;ct<Jr;ct++)if(this._gPoints[ct].id===dt)return this._gPoints[ct];return null},getPrimary:function(dt){var ct,Jr=this._gPoints.length;for(ct=0;ct<Jr;ct++)if(this._gPoints[ct].isPrimary)return this._gPoints[ct];return null},addContact:function(){++this.contacts,this.contacts>1&&(this.type==="mouse"||this.type==="pen")&&(this.contacts=1)},removeContact:function(){--this.contacts,this.contacts<0&&(this.contacts=0)}};function ae(dt){var ct=ee[dt.hash],Jr,ei=ct.activePointersLists.length;for(Jr=0;Jr<ei;Jr++)ct.activePointersLists[Jr].captureCount>0&&(ie.removeEvent(ie.MouseTracker.captureElement,"mousemove",ct.mousemovecaptured,!0),ie.removeEvent(ie.MouseTracker.captureElement,"mouseup",ct.mouseupcaptured,!0),ie.removeEvent(ie.MouseTracker.captureElement,ie.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",ct.pointermovecaptured,!0),ie.removeEvent(ie.MouseTracker.captureElement,ie.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",ct.pointerupcaptured,!0),ie.removeEvent(ie.MouseTracker.captureElement,"touchmove",ct.touchmovecaptured,!0),ie.removeEvent(ie.MouseTracker.captureElement,"touchend",ct.touchendcaptured,!0),ct.activePointersLists[Jr].captureCount=0);for(Jr=0;Jr<ei;Jr++)ct.activePointersLists.pop()}function ve(dt){var ct=ee[dt.hash],Jr,ei;if(!ct.tracking){for(ei=0;ei<ie.MouseTracker.subscribeEvents.length;ei++)Jr=ie.MouseTracker.subscribeEvents[ei],ie.addEvent(dt.element,Jr,ct[Jr],!1);ae(dt),ct.tracking=!0}}function ye(dt){var ct=ee[dt.hash],Jr,ei;if(ct.tracking){for(ei=0;ei<ie.MouseTracker.subscribeEvents.length;ei++)Jr=ie.MouseTracker.subscribeEvents[ei],ie.removeEvent(dt.element,Jr,ct[Jr],!1);ae(dt),ct.tracking=!1}}function be(dt,ct){var Jr=ee[dt.hash];if(ct==="pointerevent")return{upName:ie.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",upHandler:Jr.pointerupcaptured,moveName:ie.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",moveHandler:Jr.pointermovecaptured};if(ct==="mouse")return{upName:"mouseup",upHandler:Jr.mouseupcaptured,moveName:"mousemove",moveHandler:Jr.mousemovecaptured};if(ct==="touch")return{upName:"touchend",upHandler:Jr.touchendcaptured,moveName:"touchmove",moveHandler:Jr.touchmovecaptured};throw new Error("MouseTracker.getCaptureEventParams: Unknown pointer type.")}function Ke(dt,ct,Jr){var ei=dt.getActivePointersListByType(ct),di;ei.captureCount+=Jr||1,ei.captureCount===1&&(ie.Browser.vendor===ie.BROWSERS.IE&&ie.Browser.version<9?dt.element.setCapture(!0):(di=be(dt,ie.MouseTracker.havePointerEvents?"pointerevent":ct),Xi&&Zi(window.top)&&ie.addEvent(window.top,di.upName,di.upHandler,!0),ie.addEvent(ie.MouseTracker.captureElement,di.upName,di.upHandler,!0),ie.addEvent(ie.MouseTracker.captureElement,di.moveName,di.moveHandler,!0)))}function Ye(dt,ct,Jr){var ei=dt.getActivePointersListByType(ct),di;ei.captureCount-=Jr||1,ei.captureCount===0&&(ie.Browser.vendor===ie.BROWSERS.IE&&ie.Browser.version<9?dt.element.releaseCapture():(di=be(dt,ie.MouseTracker.havePointerEvents?"pointerevent":ct),Xi&&Zi(window.top)&&ie.removeEvent(window.top,di.upName,di.upHandler,!0),ie.removeEvent(ie.MouseTracker.captureElement,di.moveName,di.moveHandler,!0),ie.removeEvent(ie.MouseTracker.captureElement,di.upName,di.upHandler,!0)))}function Xe(dt){var ct;if(ie.MouseTracker.unprefixedPointerEvents)ct=dt.pointerType;else switch(dt.pointerType){case 2:ct="touch";break;case 3:ct="pen";break;case 4:ct="mouse";break;default:ct=""}return ct}function Qe(dt){return ie.getMousePosition(dt)}function et(dt,ct){return Je(Qe(dt),ct)}function Je(dt,ct){var Jr=ie.getElementOffset(ct);return dt.minus(Jr)}function rt(dt,ct){return new ie.Point((dt.x+ct.x)/2,(dt.y+ct.y)/2)}function it(dt,ct){dt.clickHandler&&ie.cancelEvent(ct)}function nt(dt,ct){dt.dblClickHandler&&ie.cancelEvent(ct)}function tt(dt,ct){var Jr;dt.keyDownHandler&&(ct=ie.getEvent(ct),Jr=dt.keyDownHandler({eventSource:dt,keyCode:ct.keyCode?ct.keyCode:ct.charCode,ctrl:ct.ctrlKey,shift:ct.shiftKey,alt:ct.altKey,meta:ct.metaKey,originalEvent:ct,preventDefaultAction:!1,userData:dt.userData}),Jr||ie.cancelEvent(ct))}function st(dt,ct){var Jr;dt.keyUpHandler&&(ct=ie.getEvent(ct),Jr=dt.keyUpHandler({eventSource:dt,keyCode:ct.keyCode?ct.keyCode:ct.charCode,ctrl:ct.ctrlKey,shift:ct.shiftKey,alt:ct.altKey,meta:ct.metaKey,originalEvent:ct,preventDefaultAction:!1,userData:dt.userData}),Jr||ie.cancelEvent(ct))}function ot(dt,ct){var Jr;dt.keyHandler&&(ct=ie.getEvent(ct),Jr=dt.keyHandler({eventSource:dt,keyCode:ct.keyCode?ct.keyCode:ct.charCode,ctrl:ct.ctrlKey,shift:ct.shiftKey,alt:ct.altKey,meta:ct.metaKey,originalEvent:ct,preventDefaultAction:!1,userData:dt.userData}),Jr||ie.cancelEvent(ct))}function ut(dt,ct){var Jr;dt.focusHandler&&(ct=ie.getEvent(ct),Jr=dt.focusHandler({eventSource:dt,originalEvent:ct,preventDefaultAction:!1,userData:dt.userData}),Jr===!1&&ie.cancelEvent(ct))}function ft(dt,ct){var Jr;dt.blurHandler&&(ct=ie.getEvent(ct),Jr=dt.blurHandler({eventSource:dt,originalEvent:ct,preventDefaultAction:!1,userData:dt.userData}),Jr===!1&&ie.cancelEvent(ct))}function pt(dt,ct){mt(dt,ct,ct)}function Xr(dt,ct){ct=ie.getEvent(ct);var Jr={target:ct.target||ct.srcElement,type:"wheel",shiftKey:ct.shiftKey||!1,clientX:ct.clientX,clientY:ct.clientY,pageX:ct.pageX?ct.pageX:ct.clientX,pageY:ct.pageY?ct.pageY:ct.clientY,deltaMode:ct.type=="MozMousePixelScroll"?0:1,deltaX:0,deltaZ:0};ie.MouseTracker.wheelEventName=="mousewheel"?Jr.deltaY=-ct.wheelDelta/ie.DEFAULT_SETTINGS.pixelsPerWheelLine:Jr.deltaY=ct.detail,mt(dt,Jr,ct)}function mt(dt,ct,Jr){var ei=0,di;ei=ct.deltaY<0?1:-1,dt.scrollHandler&&(di=dt.scrollHandler({eventSource:dt,pointerType:"mouse",position:et(ct,dt.element),scroll:ei,shift:ct.shiftKey,isTouchEvent:!1,originalEvent:Jr,preventDefaultAction:!1,userData:dt.userData}),di===!1&&ie.cancelEvent(Jr))}function Yr(dt,ct){if(dt===ct)return!1;for(;ct&&ct!==dt;)ct=ct.parentNode;return ct===dt}function ri(dt,ct){ct=ie.getEvent(ct),_r(dt,ct)}function Zr(dt,ct){ct=ie.getEvent(ct),!(ct.currentTarget===ct.relatedTarget||Yr(ct.currentTarget,ct.relatedTarget))&&_r(dt,ct)}function _r(dt,ct){var Jr={id:ie.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:Qe(ct),currentTime:ie.now()};Hi(dt,ct,[Jr])}function Kr(dt,ct){ct=ie.getEvent(ct),oi(dt,ct)}function si(dt,ct){ct=ie.getEvent(ct),!(ct.currentTarget===ct.relatedTarget||Yr(ct.currentTarget,ct.relatedTarget))&&oi(dt,ct)}function oi(dt,ct){var Jr={id:ie.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:Qe(ct),currentTime:ie.now()};Gi(dt,ct,[Jr])}function Qr(dt){return ie.Browser.vendor===ie.BROWSERS.IE&&ie.Browser.version<9?dt===1?0:dt===2?2:dt===4?1:-1:dt}function ii(dt,ct){var Jr;ct=ie.getEvent(ct),Jr={id:ie.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:Qe(ct),currentTime:ie.now()},qi(dt,ct,[Jr],Qr(ct.button))&&(ie.stopEvent(ct),Ke(dt,"mouse")),(dt.clickHandler||dt.dblClickHandler||dt.pressHandler||dt.dragHandler||dt.dragEndHandler)&&ie.cancelEvent(ct)}function ti(dt,ct){ui(dt,ct)}function ni(dt,ct){ui(dt,ct),ie.stopEvent(ct)}function ui(dt,ct){var Jr;ct=ie.getEvent(ct),Jr={id:ie.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:Qe(ct),currentTime:ie.now()},zi(dt,ct,[Jr],Qr(ct.button))&&Ye(dt,"mouse")}function yi(dt,ct){gi(dt,ct)}function pi(dt,ct){gi(dt,ct),ie.stopEvent(ct)}function gi(dt,ct){var Jr;ct=ie.getEvent(ct),Jr={id:ie.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:Qe(ct),currentTime:ie.now()},Ki(dt,ct,[Jr])}function Ri(dt,ct,Jr){var ei,di=Jr.getLength(),bi=[];if(Jr.type==="touch"||Jr.contacts>0){for(ei=0;ei<di;ei++)bi.push(Jr.getByIndex(ei));bi.length>0&&(zi(dt,ct,bi,0),Jr.captureCount=1,Ye(dt,Jr.type),Gi(dt,ct,bi))}}function Ei(dt,ct){var Jr,ei,di,bi=ct.changedTouches.length,hi=[],fi,Ti=dt.getActivePointersListByType("touch");for(Jr=ie.now(),Ti.getLength()>ct.touches.length-bi&&(ie.console.warn("Tracked touch contact count doesn't match event.touches.length. Removing all tracked touch pointers."),Ri(dt,ct,Ti)),ei=0;ei<bi;ei++)hi.push({id:ct.changedTouches[ei].identifier,type:"touch",currentPos:Qe(ct.changedTouches[ei]),currentTime:Jr});for(Hi(dt,ct,hi),ei=0;ei<Z.length;ei++)if(Z[ei]!==dt&&Z[ei].isTracking()&&Yr(Z[ei].element,dt.element)){for(fi=[],di=0;di<bi;di++)fi.push({id:ct.changedTouches[di].identifier,type:"touch",currentPos:Qe(ct.changedTouches[di]),currentTime:Jr});Hi(Z[ei],ct,fi)}qi(dt,ct,hi,0)&&(ie.stopEvent(ct),Ke(dt,"touch",bi)),ie.cancelEvent(ct)}function xi(dt,ct){vi(dt,ct)}function Ii(dt,ct){vi(dt,ct),ie.stopEvent(ct)}function vi(dt,ct){var Jr,ei,di,bi=ct.changedTouches.length,hi=[],fi;for(Jr=ie.now(),ei=0;ei<bi;ei++)hi.push({id:ct.changedTouches[ei].identifier,type:"touch",currentPos:Qe(ct.changedTouches[ei]),currentTime:Jr});for(zi(dt,ct,hi,0)&&Ye(dt,"touch",bi),Gi(dt,ct,hi),ei=0;ei<Z.length;ei++)if(Z[ei]!==dt&&Z[ei].isTracking()&&Yr(Z[ei].element,dt.element)){for(fi=[],di=0;di<bi;di++)fi.push({id:ct.changedTouches[di].identifier,type:"touch",currentPos:Qe(ct.changedTouches[di]),currentTime:Jr});Gi(Z[ei],ct,fi)}ie.cancelEvent(ct)}function Si(dt,ct){Di(dt,ct)}function Fi(dt,ct){Di(dt,ct),ie.stopEvent(ct)}function Di(dt,ct){var Jr,ei=ct.changedTouches.length,di=[];for(Jr=0;Jr<ei;Jr++)di.push({id:ct.changedTouches[Jr].identifier,type:"touch",currentPos:Qe(ct.changedTouches[Jr]),currentTime:ie.now()});Ki(dt,ct,di),ie.cancelEvent(ct)}function Oi(dt,ct){var Jr=dt.getActivePointersListByType("touch");Ri(dt,ct,Jr)}function Mi(dt,ct){return ct.stopPropagation(),ct.preventDefault(),!1}function lt(dt,ct){return ct.stopPropagation(),ct.preventDefault(),!1}function gt(dt,ct){var Jr;ct.currentTarget===ct.relatedTarget||Yr(ct.currentTarget,ct.relatedTarget)||(Jr={id:ct.pointerId,type:Xe(ct),isPrimary:ct.isPrimary,currentPos:Qe(ct),currentTime:ie.now()},Hi(dt,ct,[Jr]))}function ai(dt,ct){var Jr;ct.currentTarget===ct.relatedTarget||Yr(ct.currentTarget,ct.relatedTarget)||(Jr={id:ct.pointerId,type:Xe(ct),isPrimary:ct.isPrimary,currentPos:Qe(ct),currentTime:ie.now()},Gi(dt,ct,[Jr]))}function li(dt,ct){var Jr;Jr={id:ct.pointerId,type:Xe(ct),isPrimary:ct.isPrimary,currentPos:Qe(ct),currentTime:ie.now()},qi(dt,ct,[Jr],ct.button)&&(ie.stopEvent(ct),Ke(dt,Jr.type)),(dt.clickHandler||dt.dblClickHandler||dt.pressHandler||dt.dragHandler||dt.dragEndHandler||dt.pinchHandler)&&ie.cancelEvent(ct)}function ci(dt,ct){mi(dt,ct)}function Ai(dt,ct){var Jr=dt.getActivePointersListByType(Xe(ct));Jr.getById(ct.pointerId)&&mi(dt,ct),ie.stopEvent(ct)}function mi(dt,ct){var Jr;Jr={id:ct.pointerId,type:Xe(ct),isPrimary:ct.isPrimary,currentPos:Qe(ct),currentTime:ie.now()},zi(dt,ct,[Jr],ct.button)&&Ye(dt,Jr.type)}function Ni(dt,ct){$i(dt,ct)}function ki(dt,ct){var Jr=dt.getActivePointersListByType(Xe(ct));Jr.getById(ct.pointerId)&&$i(dt,ct),ie.stopEvent(ct)}function $i(dt,ct){var Jr;Jr={id:ct.pointerId,type:Xe(ct),isPrimary:ct.isPrimary,currentPos:Qe(ct),currentTime:ie.now()},Ki(dt,ct,[Jr])}function wi(dt,ct){var Jr;Jr={id:ct.pointerId,type:Xe(ct)},ts(dt,ct,[Jr])}function Ui(dt,ct){return Object.prototype.hasOwnProperty.call(ct,"isPrimary")||(dt.getLength()===0?ct.isPrimary=!0:ct.isPrimary=!1),ct.speed=0,ct.direction=0,ct.contactPos=ct.currentPos,ct.contactTime=ct.currentTime,ct.lastPos=ct.currentPos,ct.lastTime=ct.currentTime,dt.add(ct)}function Li(dt,ct){var Jr,ei;return dt.getById(ct.id)?(Jr=dt.removeById(ct.id),Object.prototype.hasOwnProperty.call(ct,"isPrimary")||(ei=dt.getPrimary(),ei||(ei=dt.getByIndex(0),ei&&(ei.isPrimary=!0)))):Jr=dt.getLength(),Jr}function Hi(dt,ct,Jr){var ei=dt.getActivePointersListByType(Jr[0].type),di,bi=Jr.length,hi,fi,Ti;for(di=0;di<bi;di++)hi=Jr[di],fi=ei.getById(hi.id),fi?(fi.insideElement=!0,fi.lastPos=fi.currentPos,fi.lastTime=fi.currentTime,fi.currentPos=hi.currentPos,fi.currentTime=hi.currentTime,hi=fi):(hi.captured=!1,hi.insideElementPressed=!1,hi.insideElement=!0,Ui(ei,hi)),dt.enterHandler&&(Ti=dt.enterHandler({eventSource:dt,pointerType:hi.type,position:Je(hi.currentPos,dt.element),buttons:ei.buttons,pointers:dt.getActivePointerCount(),insideElementPressed:hi.insideElementPressed,buttonDownAny:ei.buttons!==0,isTouchEvent:hi.type==="touch",originalEvent:ct,preventDefaultAction:!1,userData:dt.userData}),Ti===!1&&ie.cancelEvent(ct))}function Gi(dt,ct,Jr){var ei=dt.getActivePointersListByType(Jr[0].type),di,bi=Jr.length,hi,fi,Ti;for(di=0;di<bi;di++)hi=Jr[di],fi=ei.getById(hi.id),fi&&(fi.captured?(fi.insideElement=!1,fi.lastPos=fi.currentPos,fi.lastTime=fi.currentTime,fi.currentPos=hi.currentPos,fi.currentTime=hi.currentTime):Li(ei,fi),hi=fi),dt.exitHandler&&(Ti=dt.exitHandler({eventSource:dt,pointerType:hi.type,position:hi.currentPos&&Je(hi.currentPos,dt.element),buttons:ei.buttons,pointers:dt.getActivePointerCount(),insideElementPressed:fi?fi.insideElementPressed:!1,buttonDownAny:ei.buttons!==0,isTouchEvent:hi.type==="touch",originalEvent:ct,preventDefaultAction:!1,userData:dt.userData}),Ti===!1&&ie.cancelEvent(ct))}function qi(dt,ct,Jr,ei){var di=ee[dt.hash],bi,hi=dt.getActivePointersListByType(Jr[0].type),fi,Ti=Jr.length,_i,Pi;typeof ct.buttons<"u"?hi.buttons=ct.buttons:ie.Browser.vendor===ie.BROWSERS.IE&&ie.Browser.version<9?ei===0?hi.buttons+=1:ei===1?hi.buttons+=4:ei===2?hi.buttons+=2:ei===3?hi.buttons+=8:ei===4?hi.buttons+=16:ei===5&&(hi.buttons+=32):ei===0?hi.buttons|=1:ei===1?hi.buttons|=4:ei===2?hi.buttons|=2:ei===3?hi.buttons|=8:ei===4?hi.buttons|=16:ei===5&&(hi.buttons|=32);var Bi=dt.getActivePointersListsExceptType(Jr[0].type);for(fi=0;fi<Bi.length;fi++)Ri(dt,ct,Bi[fi]);if(ei!==0)return dt.nonPrimaryPressHandler&&(bi=dt.nonPrimaryPressHandler({eventSource:dt,pointerType:Jr[0].type,position:Je(Jr[0].currentPos,dt.element),button:ei,buttons:hi.buttons,isTouchEvent:Jr[0].type==="touch",originalEvent:ct,preventDefaultAction:!1,userData:dt.userData}),bi===!1&&ie.cancelEvent(ct)),!1;for(fi=0;fi<Ti;fi++)_i=Jr[fi],Pi=hi.getById(_i.id),Pi?(Pi.captured=!0,Pi.insideElementPressed=!0,Pi.insideElement=!0,Pi.contactPos=_i.currentPos,Pi.contactTime=_i.currentTime,Pi.lastPos=Pi.currentPos,Pi.lastTime=Pi.currentTime,Pi.currentPos=_i.currentPos,Pi.currentTime=_i.currentTime,_i=Pi):(_i.captured=!0,_i.insideElementPressed=!0,_i.insideElement=!0,Ui(hi,_i)),hi.addContact(),(dt.dragHandler||dt.dragEndHandler||dt.pinchHandler)&&ie.MouseTracker.gesturePointVelocityTracker.addPoint(dt,_i),hi.contacts===1?dt.pressHandler&&(bi=dt.pressHandler({eventSource:dt,pointerType:_i.type,position:Je(_i.contactPos,dt.element),buttons:hi.buttons,isTouchEvent:_i.type==="touch",originalEvent:ct,preventDefaultAction:!1,userData:dt.userData}),bi===!1&&ie.cancelEvent(ct)):hi.contacts===2&&dt.pinchHandler&&_i.type==="touch"&&(di.pinchGPoints=hi.asArray(),di.lastPinchDist=di.currentPinchDist=di.pinchGPoints[0].currentPos.distanceTo(di.pinchGPoints[1].currentPos),di.lastPinchCenter=di.currentPinchCenter=rt(di.pinchGPoints[0].currentPos,di.pinchGPoints[1].currentPos));return!0}function zi(dt,ct,Jr,ei){var di=ee[dt.hash],bi=dt.getActivePointersListByType(Jr[0].type),hi,fi,Ti,_i,Pi=Jr.length,Bi,Ci,Wi=!1,ji=!1,Yi;if(typeof ct.buttons<"u"?bi.buttons=ct.buttons:ie.Browser.vendor===ie.BROWSERS.IE&&ie.Browser.version<9?ei===0?bi.buttons-=1:ei===1?bi.buttons-=4:ei===2?bi.buttons-=2:ei===3?bi.buttons-=8:ei===4?bi.buttons-=16:ei===5&&(bi.buttons-=32):ei===0?bi.buttons^=-2:ei===1?bi.buttons^=-5:ei===2?bi.buttons^=-3:ei===3?bi.buttons^=-9:ei===4?bi.buttons^=-17:ei===5&&(bi.buttons^=-33),ei!==0){dt.nonPrimaryReleaseHandler&&(hi=dt.nonPrimaryReleaseHandler({eventSource:dt,pointerType:Jr[0].type,position:Je(Jr[0].currentPos,dt.element),button:ei,buttons:bi.buttons,isTouchEvent:Jr[0].type==="touch",originalEvent:ct,preventDefaultAction:!1,userData:dt.userData}),hi===!1&&ie.cancelEvent(ct));var is=dt.getActivePointersListByType("mouse");return Ri(dt,ct,is),!1}if(typeof Jr[0].currentPos>"u")return Ri(dt,ct,bi),!1;for(_i=0;_i<Pi;_i++)Bi=Jr[_i],Ci=bi.getById(Bi.id),Ci&&(Ci.captured&&(Ci.captured=!1,Wi=!0,ji=!0),Ci.lastPos=Ci.currentPos,Ci.lastTime=Ci.currentTime,Ci.currentPos=Bi.currentPos,Ci.currentTime=Bi.currentTime,Ci.insideElement||Li(bi,Ci),fi=Ci.currentPos,Ti=Ci.currentTime,ji?(bi.removeContact(),(dt.dragHandler||dt.dragEndHandler||dt.pinchHandler)&&ie.MouseTracker.gesturePointVelocityTracker.removePoint(dt,Ci),bi.contacts===0?(dt.releaseHandler&&(hi=dt.releaseHandler({eventSource:dt,pointerType:Ci.type,position:Je(fi,dt.element),buttons:bi.buttons,insideElementPressed:Ci.insideElementPressed,insideElementReleased:Ci.insideElement,isTouchEvent:Ci.type==="touch",originalEvent:ct,preventDefaultAction:!1,userData:dt.userData}),hi===!1&&ie.cancelEvent(ct)),dt.dragEndHandler&&!Ci.currentPos.equals(Ci.contactPos)&&(hi=dt.dragEndHandler({eventSource:dt,pointerType:Ci.type,position:Je(Ci.currentPos,dt.element),speed:Ci.speed,direction:Ci.direction,shift:ct.shiftKey,isTouchEvent:Ci.type==="touch",originalEvent:ct,preventDefaultAction:!1,userData:dt.userData}),hi===!1&&ie.cancelEvent(ct)),(dt.clickHandler||dt.dblClickHandler)&&Ci.insideElement&&(Yi=Ti-Ci.contactTime<=dt.clickTimeThreshold&&Ci.contactPos.distanceTo(fi)<=dt.clickDistThreshold,dt.clickHandler&&(hi=dt.clickHandler({eventSource:dt,pointerType:Ci.type,position:Je(Ci.currentPos,dt.element),quick:Yi,shift:ct.shiftKey,isTouchEvent:Ci.type==="touch",originalEvent:ct,preventDefaultAction:!1,userData:dt.userData}),hi===!1&&ie.cancelEvent(ct)),dt.dblClickHandler&&Yi&&(bi.clicks++,bi.clicks===1?(di.lastClickPos=fi,di.dblClickTimeOut=setTimeout(function(){bi.clicks=0},dt.dblClickTimeThreshold)):bi.clicks===2&&(clearTimeout(di.dblClickTimeOut),bi.clicks=0,di.lastClickPos.distanceTo(fi)<=dt.dblClickDistThreshold&&(hi=dt.dblClickHandler({eventSource:dt,pointerType:Ci.type,position:Je(Ci.currentPos,dt.element),shift:ct.shiftKey,isTouchEvent:Ci.type==="touch",originalEvent:ct,preventDefaultAction:!1,userData:dt.userData}),hi===!1&&ie.cancelEvent(ct)),di.lastClickPos=null)))):bi.contacts===2&&dt.pinchHandler&&Ci.type==="touch"&&(di.pinchGPoints=bi.asArray(),di.lastPinchDist=di.currentPinchDist=di.pinchGPoints[0].currentPos.distanceTo(di.pinchGPoints[1].currentPos),di.lastPinchCenter=di.currentPinchCenter=rt(di.pinchGPoints[0].currentPos,di.pinchGPoints[1].currentPos))):dt.releaseHandler&&(hi=dt.releaseHandler({eventSource:dt,pointerType:Ci.type,position:Je(fi,dt.element),buttons:bi.buttons,insideElementPressed:Ci.insideElementPressed,insideElementReleased:Ci.insideElement,isTouchEvent:Ci.type==="touch",originalEvent:ct,preventDefaultAction:!1,userData:dt.userData}),hi===!1&&ie.cancelEvent(ct)));return Wi}function Ki(dt,ct,Jr){var ei=ee[dt.hash],di=dt.getActivePointersListByType(Jr[0].type),bi,hi=Jr.length,fi,Ti,_i,Pi,Bi;for(typeof ct.buttons<"u"&&(di.buttons=ct.buttons),bi=0;bi<hi;bi++)fi=Jr[bi],Ti=di.getById(fi.id),Ti?(Object.prototype.hasOwnProperty.call(fi,"isPrimary")&&(Ti.isPrimary=fi.isPrimary),Ti.lastPos=Ti.currentPos,Ti.lastTime=Ti.currentTime,Ti.currentPos=fi.currentPos,Ti.currentTime=fi.currentTime):(fi.captured=!1,fi.insideElementPressed=!1,fi.insideElement=!0,Ui(di,fi));dt.stopHandler&&Jr[0].type==="mouse"&&(clearTimeout(dt.stopTimeOut),dt.stopTimeOut=setTimeout(function(){rs(dt,ct,Jr[0].type)},dt.stopDelay)),di.contacts===0?dt.moveHandler&&(Bi=dt.moveHandler({eventSource:dt,pointerType:Jr[0].type,position:Je(Jr[0].currentPos,dt.element),buttons:di.buttons,isTouchEvent:Jr[0].type==="touch",originalEvent:ct,preventDefaultAction:!1,userData:dt.userData}),Bi===!1&&ie.cancelEvent(ct)):di.contacts===1?(dt.moveHandler&&(Ti=di.asArray()[0],Bi=dt.moveHandler({eventSource:dt,pointerType:Ti.type,position:Je(Ti.currentPos,dt.element),buttons:di.buttons,isTouchEvent:Ti.type==="touch",originalEvent:ct,preventDefaultAction:!1,userData:dt.userData}),Bi===!1&&ie.cancelEvent(ct)),dt.dragHandler&&(Ti=di.asArray()[0],Pi=Ti.currentPos.minus(Ti.lastPos),Bi=dt.dragHandler({eventSource:dt,pointerType:Ti.type,position:Je(Ti.currentPos,dt.element),buttons:di.buttons,delta:Pi,speed:Ti.speed,direction:Ti.direction,shift:ct.shiftKey,isTouchEvent:Ti.type==="touch",originalEvent:ct,preventDefaultAction:!1,userData:dt.userData}),Bi===!1&&ie.cancelEvent(ct))):di.contacts===2&&(dt.moveHandler&&(_i=di.asArray(),Bi=dt.moveHandler({eventSource:dt,pointerType:_i[0].type,position:Je(rt(_i[0].currentPos,_i[1].currentPos),dt.element),buttons:di.buttons,isTouchEvent:_i[0].type==="touch",originalEvent:ct,preventDefaultAction:!1,userData:dt.userData}),Bi===!1&&ie.cancelEvent(ct)),dt.pinchHandler&&Jr[0].type==="touch"&&(Pi=ei.pinchGPoints[0].currentPos.distanceTo(ei.pinchGPoints[1].currentPos),Pi!=ei.currentPinchDist&&(ei.lastPinchDist=ei.currentPinchDist,ei.currentPinchDist=Pi,ei.lastPinchCenter=ei.currentPinchCenter,ei.currentPinchCenter=rt(ei.pinchGPoints[0].currentPos,ei.pinchGPoints[1].currentPos),Bi=dt.pinchHandler({eventSource:dt,pointerType:"touch",gesturePoints:ei.pinchGPoints,lastCenter:Je(ei.lastPinchCenter,dt.element),center:Je(ei.currentPinchCenter,dt.element),lastDistance:ei.lastPinchDist,distance:ei.currentPinchDist,shift:ct.shiftKey,originalEvent:ct,preventDefaultAction:!1,userData:dt.userData}),Bi===!1&&ie.cancelEvent(ct))))}function ts(dt,ct,Jr){zi(dt,ct,Jr,0),Gi(dt,ct,Jr)}function rs(dt,ct,Jr){dt.stopHandler&&dt.stopHandler({eventSource:dt,pointerType:Jr,position:et(ct,dt.element),buttons:dt.getActivePointersListByType(Jr).buttons,isTouchEvent:Jr==="touch",originalEvent:ct,preventDefaultAction:!1,userData:dt.userData})}var Xi=function(){try{return window.self!==window.top}catch{return!0}}();function Zi(dt){try{return dt.addEventListener&&dt.removeEventListener}catch{return!1}}}(OpenSeadragon),function(ie){ie.ControlAnchor={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4,ABSOLUTE:5},ie.Control=function(Z,ee,ae){var ve=Z.parentNode;typeof ee=="number"&&(ie.console.error("Passing an anchor directly into the OpenSeadragon.Control constructor is deprecated; please use an options object instead.  Support for this deprecated variant is scheduled for removal in December 2013"),ee={anchor:ee}),ee.attachToViewer=typeof ee.attachToViewer>"u"?!0:ee.attachToViewer,this.autoFade=typeof ee.autoFade>"u"?!0:ee.autoFade,this.element=Z,this.anchor=ee.anchor,this.container=ae,this.anchor==ie.ControlAnchor.ABSOLUTE?(this.wrapper=ie.makeNeutralElement("div"),this.wrapper.style.position="absolute",this.wrapper.style.top=typeof ee.top=="number"?ee.top+"px":ee.top,this.wrapper.style.left=typeof ee.left=="number"?ee.left+"px":ee.left,this.wrapper.style.height=typeof ee.height=="number"?ee.height+"px":ee.height,this.wrapper.style.width=typeof ee.width=="number"?ee.width+"px":ee.width,this.wrapper.style.margin="0px",this.wrapper.style.padding="0px",this.element.style.position="relative",this.element.style.top="0px",this.element.style.left="0px",this.element.style.height="100%",this.element.style.width="100%"):(this.wrapper=ie.makeNeutralElement("div"),this.wrapper.style.display="inline-block",this.anchor==ie.ControlAnchor.NONE&&(this.wrapper.style.width=this.wrapper.style.height="100%")),this.wrapper.appendChild(this.element),ee.attachToViewer?this.anchor==ie.ControlAnchor.TOP_RIGHT||this.anchor==ie.ControlAnchor.BOTTOM_RIGHT?this.container.insertBefore(this.wrapper,this.container.firstChild):this.container.appendChild(this.wrapper):ve.appendChild(this.wrapper)},ie.Control.prototype={destroy:function(){this.wrapper.removeChild(this.element),this.container.removeChild(this.wrapper)},isVisible:function(){return this.wrapper.style.display!="none"},setVisible:function(Z){this.wrapper.style.display=Z?this.anchor==ie.ControlAnchor.ABSOLUTE?"block":"inline-block":"none"},setOpacity:function(Z){this.element[ie.SIGNAL]&&ie.Browser.vendor==ie.BROWSERS.IE?ie.setElementOpacity(this.element,Z,!0):ie.setElementOpacity(this.wrapper,Z,!0)}}}(OpenSeadragon),function(ie){ie.ControlDock=function(ee){var ae=["topleft","topright","bottomright","bottomleft"],ve,ye;for(ie.extend(!0,this,{id:"controldock-"+ie.now()+"-"+Math.floor(Math.random()*1e6),container:ie.makeNeutralElement("div"),controls:[]},ee),this.container.onsubmit=function(){return!1},this.element&&(this.element=ie.getElement(this.element),this.element.appendChild(this.container),this.element.style.position="relative",this.container.style.width="100%",this.container.style.height="100%"),ye=0;ye<ae.length;ye++)ve=ae[ye],this.controls[ve]=ie.makeNeutralElement("div"),this.controls[ve].style.position="absolute",ve.match("left")&&(this.controls[ve].style.left="0px"),ve.match("right")&&(this.controls[ve].style.right="0px"),ve.match("top")&&(this.controls[ve].style.top="0px"),ve.match("bottom")&&(this.controls[ve].style.bottom="0px");this.container.appendChild(this.controls.topleft),this.container.appendChild(this.controls.topright),this.container.appendChild(this.controls.bottomright),this.container.appendChild(this.controls.bottomleft)},ie.ControlDock.prototype={addControl:function(ee,ae){ee=ie.getElement(ee);var ve=null;if(!(Z(this,ee)>=0)){switch(ae.anchor){case ie.ControlAnchor.TOP_RIGHT:ve=this.controls.topright,ee.style.position="relative",ee.style.paddingRight="0px",ee.style.paddingTop="0px";break;case ie.ControlAnchor.BOTTOM_RIGHT:ve=this.controls.bottomright,ee.style.position="relative",ee.style.paddingRight="0px",ee.style.paddingBottom="0px";break;case ie.ControlAnchor.BOTTOM_LEFT:ve=this.controls.bottomleft,ee.style.position="relative",ee.style.paddingLeft="0px",ee.style.paddingBottom="0px";break;case ie.ControlAnchor.TOP_LEFT:ve=this.controls.topleft,ee.style.position="relative",ee.style.paddingLeft="0px",ee.style.paddingTop="0px";break;case ie.ControlAnchor.ABSOLUTE:ve=this.container,ee.style.margin="0px",ee.style.padding="0px";break;default:case ie.ControlAnchor.NONE:ve=this.container,ee.style.margin="0px",ee.style.padding="0px";break}this.controls.push(new ie.Control(ee,ae,ve)),ee.style.display="inline-block"}},removeControl:function(ee){ee=ie.getElement(ee);var ae=Z(this,ee);return ae>=0&&(this.controls[ae].destroy(),this.controls.splice(ae,1)),this},clearControls:function(){for(;this.controls.length>0;)this.controls.pop().destroy();return this},areControlsEnabled:function(){var ee;for(ee=this.controls.length-1;ee>=0;ee--)if(this.controls[ee].isVisible())return!0;return!1},setControlsEnabled:function(ee){var ae;for(ae=this.controls.length-1;ae>=0;ae--)this.controls[ae].setVisible(ee);return this}};function Z(ee,ae){var ve=ee.controls,ye;for(ye=ve.length-1;ye>=0;ye--)if(ve[ye].element==ae)return ye;return-1}}(OpenSeadragon),function(ie){ie.Placement=ie.freezeObject({CENTER:0,TOP_LEFT:1,TOP:2,TOP_RIGHT:3,RIGHT:4,BOTTOM_RIGHT:5,BOTTOM:6,BOTTOM_LEFT:7,LEFT:8,properties:{0:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1},1:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},2:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},3:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!0,isVerticallyCentered:!1,isBottom:!1},4:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!0,isBottom:!1},5:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!1,isBottom:!0},6:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},7:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},8:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1}}})}(OpenSeadragon),function(ie){var Z={},ee=1;ie.Viewer=function(lt){var gt=arguments,ai=this,li;if(ie.isPlainObject(lt)||(lt={id:gt[0],xmlPath:gt.length>1?gt[1]:void 0,prefixUrl:gt.length>2?gt[2]:void 0,controls:gt.length>3?gt[3]:void 0,overlays:gt.length>4?gt[4]:void 0}),lt.config&&(ie.extend(!0,lt,lt.config),delete lt.config),ie.extend(!0,this,{id:lt.id,hash:lt.hash||ee++,initialPage:0,element:null,container:null,canvas:null,overlays:[],overlaysContainer:null,previousBody:[],customControls:[],source:null,drawer:null,world:null,viewport:null,navigator:null,collectionViewport:null,collectionDrawer:null,navImages:null,buttons:null,profiler:null},ie.DEFAULT_SETTINGS,lt),typeof this.hash>"u")throw new Error("A hash must be defined, either by specifying options.id or options.hash.");for(typeof Z[this.hash]<"u"&&ie.console.warn("Hash "+this.hash+" has already been used."),Z[this.hash]={fsBoundsDelta:new ie.Point(1,1),prevContainerSize:null,animating:!1,forceRedraw:!1,mouseInside:!1,group:null,zooming:!1,zoomFactor:null,lastZoomTime:null,fullPage:!1,onfullscreenchange:null},this._sequenceIndex=0,this._firstOpen=!0,this._updateRequestId=null,this._loadQueue=[],this.currentOverlays=[],this._lastScrollTime=ie.now(),ie.EventSource.call(this),this.addHandler("open-failed",function(ci){var Ai=ie.getString("Errors.OpenFailed",ci.eventSource,ci.message);ai._showMessage(Ai)}),ie.ControlDock.call(this,lt),this.xmlPath&&(this.tileSources=[this.xmlPath]),this.element=this.element||document.getElementById(this.id),this.canvas=ie.makeNeutralElement("div"),this.canvas.className="openseadragon-canvas",function(ci){ci.width="100%",ci.height="100%",ci.overflow="hidden",ci.position="absolute",ci.top="0px",ci.left="0px"}(this.canvas.style),ie.setElementTouchActionNone(this.canvas),lt.tabIndex!==""&&(this.canvas.tabIndex=lt.tabIndex===void 0?0:lt.tabIndex),this.container.className="openseadragon-container",function(ci){ci.width="100%",ci.height="100%",ci.position="relative",ci.overflow="hidden",ci.left="0px",ci.top="0px",ci.textAlign="left"}(this.container.style),this.container.insertBefore(this.canvas,this.container.firstChild),this.element.appendChild(this.container),this.bodyWidth=document.body.style.width,this.bodyHeight=document.body.style.height,this.bodyOverflow=document.body.style.overflow,this.docOverflow=document.documentElement.style.overflow,this.innerTracker=new ie.MouseTracker({element:this.canvas,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,keyDownHandler:ie.delegate(this,it),keyHandler:ie.delegate(this,nt),clickHandler:ie.delegate(this,tt),dblClickHandler:ie.delegate(this,st),dragHandler:ie.delegate(this,ot),dragEndHandler:ie.delegate(this,ut),enterHandler:ie.delegate(this,ft),exitHandler:ie.delegate(this,pt),pressHandler:ie.delegate(this,Xr),releaseHandler:ie.delegate(this,mt),nonPrimaryPressHandler:ie.delegate(this,Yr),nonPrimaryReleaseHandler:ie.delegate(this,ri),scrollHandler:ie.delegate(this,_r),pinchHandler:ie.delegate(this,Zr)}),this.outerTracker=new ie.MouseTracker({element:this.container,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,enterHandler:ie.delegate(this,Kr),exitHandler:ie.delegate(this,si)}),this.toolbar&&(this.toolbar=new ie.ControlDock({element:this.toolbar})),this.bindStandardControls(),Z[this.hash].prevContainerSize=ae(this.container),this.world=new ie.World({viewer:this}),this.world.addHandler("add-item",function(ci){ai.source=ai.world.getItemAt(0).source,Z[ai.hash].forceRedraw=!0,ai._updateRequestId||(ai._updateRequestId=Ke(ai,oi))}),this.world.addHandler("remove-item",function(ci){ai.world.getItemCount()?ai.source=ai.world.getItemAt(0).source:ai.source=null,Z[ai.hash].forceRedraw=!0}),this.world.addHandler("metrics-change",function(ci){ai.viewport&&ai.viewport._setContentBounds(ai.world.getHomeBounds(),ai.world.getContentFactor())}),this.world.addHandler("item-index-change",function(ci){ai.source=ai.world.getItemAt(0).source}),this.viewport=new ie.Viewport({containerSize:Z[this.hash].prevContainerSize,springStiffness:this.springStiffness,animationTime:this.animationTime,minZoomImageRatio:this.minZoomImageRatio,maxZoomPixelRatio:this.maxZoomPixelRatio,visibilityRatio:this.visibilityRatio,wrapHorizontal:this.wrapHorizontal,wrapVertical:this.wrapVertical,defaultZoomLevel:this.defaultZoomLevel,minZoomLevel:this.minZoomLevel,maxZoomLevel:this.maxZoomLevel,viewer:this,degrees:this.degrees,flipped:this.flipped,navigatorRotate:this.navigatorRotate,homeFillsViewer:this.homeFillsViewer,margins:this.viewportMargins}),this.viewport._setContentBounds(this.world.getHomeBounds(),this.world.getContentFactor()),this.imageLoader=new ie.ImageLoader({jobLimit:this.imageLoaderLimit,timeout:lt.timeout}),this.tileCache=new ie.TileCache({maxImageCacheCount:this.maxImageCacheCount}),this.drawer=new ie.Drawer({viewer:this,viewport:this.viewport,element:this.canvas,debugGridColor:this.debugGridColor}),this.overlaysContainer=ie.makeNeutralElement("div"),this.canvas.appendChild(this.overlaysContainer),this.drawer.canRotate()||(this.rotateLeft&&(li=this.buttons.buttons.indexOf(this.rotateLeft),this.buttons.buttons.splice(li,1),this.buttons.element.removeChild(this.rotateLeft.element)),this.rotateRight&&(li=this.buttons.buttons.indexOf(this.rotateRight),this.buttons.buttons.splice(li,1),this.buttons.element.removeChild(this.rotateRight.element))),this.showNavigator&&(this.navigator=new ie.Navigator({id:this.navigatorId,position:this.navigatorPosition,sizeRatio:this.navigatorSizeRatio,maintainSizeRatio:this.navigatorMaintainSizeRatio,top:this.navigatorTop,left:this.navigatorLeft,width:this.navigatorWidth,height:this.navigatorHeight,autoResize:this.navigatorAutoResize,autoFade:this.navigatorAutoFade,prefixUrl:this.prefixUrl,viewer:this,navigatorRotate:this.navigatorRotate,background:this.navigatorBackground,opacity:this.navigatorOpacity,borderColor:this.navigatorBorderColor,displayRegionColor:this.navigatorDisplayRegionColor,crossOriginPolicy:this.crossOriginPolicy})),this.sequenceMode&&this.bindSequenceControls(),this.tileSources&&this.open(this.tileSources),li=0;li<this.customControls.length;li++)this.addControl(this.customControls[li].id,{anchor:this.customControls[li].anchor});ie.requestAnimationFrame(function(){Xe(ai)}),this.imageSmoothingEnabled!==void 0&&!this.imageSmoothingEnabled&&this.drawer.setImageSmoothingEnabled(this.imageSmoothingEnabled)},ie.extend(ie.Viewer.prototype,ie.EventSource.prototype,ie.ControlDock.prototype,{isOpen:function(){return!!this.world.getItemCount()},openDzi:function(lt){return ie.console.error("[Viewer.openDzi] this function is deprecated; use Viewer.open() instead."),this.open(lt)},openTileSource:function(lt){return ie.console.error("[Viewer.openTileSource] this function is deprecated; use Viewer.open() instead."),this.open(lt)},open:function(lt,gt){var ai=this;if(this.close(),!!lt){if(this.sequenceMode&&ie.isArray(lt)){this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),typeof gt<"u"&&!isNaN(gt)&&(this.initialPage=gt),this.tileSources=lt,this._sequenceIndex=Math.max(0,Math.min(this.tileSources.length-1,this.initialPage)),this.tileSources.length&&(this.open(this.tileSources[this._sequenceIndex]),this.showReferenceStrip&&this.addReferenceStrip()),this._updateSequenceButtons(this._sequenceIndex);return}if(ie.isArray(lt)||(lt=[lt]),!!lt.length){this._opening=!0;for(var li=lt.length,ci=0,Ai=0,mi,Ni=function(){if(ci+Ai===li)if(ci){(ai._firstOpen||!ai.preserveViewport)&&(ai.viewport.goHome(!0),ai.viewport.update()),ai._firstOpen=!1;var wi=lt[0];if(wi.tileSource&&(wi=wi.tileSource),ai.overlays&&!ai.preserveOverlays)for(var Ui=0;Ui<ai.overlays.length;Ui++)ai.currentOverlays[Ui]=ye(ai,ai.overlays[Ui]);ai._drawOverlays(),ai._opening=!1,ai.raiseEvent("open",{source:wi})}else ai._opening=!1,ai.raiseEvent("open-failed",mi)},ki=function(wi){(!ie.isPlainObject(wi)||!wi.tileSource)&&(wi={tileSource:wi}),wi.index!==void 0&&(ie.console.error("[Viewer.open] setting indexes here is not supported; use addTiledImage instead"),delete wi.index),wi.collectionImmediately===void 0&&(wi.collectionImmediately=!0);var Ui=wi.success;wi.success=function(Hi){if(ci++,wi.tileSource.overlays)for(var Gi=0;Gi<wi.tileSource.overlays.length;Gi++)ai.addOverlay(wi.tileSource.overlays[Gi]);Ui&&Ui(Hi),Ni()};var Li=wi.error;wi.error=function(Hi){Ai++,mi||(mi=Hi),Li&&Li(Hi),Ni()},ai.addTiledImage(wi)},$i=0;$i<lt.length;$i++)ki(lt[$i]);return this}}},close:function(){return Z[this.hash]?(this._opening=!1,this.navigator&&this.navigator.close(),this.preserveOverlays||(this.clearOverlays(),this.overlaysContainer.innerHTML=""),Z[this.hash].animating=!1,this.world.removeAll(),this.imageLoader.clear(),this.raiseEvent("close"),this):this},destroy:function(){if(Z[this.hash]){if(this.close(),this.clearOverlays(),this.overlaysContainer.innerHTML="",this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),this._updateRequestId!==null&&(ie.cancelAnimationFrame(this._updateRequestId),this._updateRequestId=null),this.drawer&&this.drawer.destroy(),this.removeAllHandlers(),this.element)for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.innerTracker&&this.innerTracker.destroy(),this.outerTracker&&this.outerTracker.destroy(),Z[this.hash]=null,delete Z[this.hash],this.canvas=null,this.container=null,this.element=null}},isMouseNavEnabled:function(){return this.innerTracker.isTracking()},setMouseNavEnabled:function(lt){return this.innerTracker.setTracking(lt),this.outerTracker.setTracking(lt),this.raiseEvent("mouse-enabled",{enabled:lt}),this},areControlsEnabled:function(){var lt=this.controls.length,gt;for(gt=0;gt<this.controls.length;gt++)lt=lt&&this.controls[gt].isVisible();return lt},setControlsEnabled:function(lt){return lt?et(this):Xe(this),this.raiseEvent("controls-enabled",{enabled:lt}),this},setDebugMode:function(lt){for(var gt=0;gt<this.world.getItemCount();gt++)this.world.getItemAt(gt).debugMode=lt;this.debugMode=lt,this.forceRedraw()},isFullPage:function(){return Z[this.hash].fullPage},setFullPage:function(lt){var gt=document.body,ai=gt.style,li=document.documentElement.style,ci=this,Ai,mi;if(lt==this.isFullPage())return this;var Ni={fullPage:lt,preventDefaultAction:!1};if(this.raiseEvent("pre-full-page",Ni),Ni.preventDefaultAction)return this;if(lt){for(this.elementSize=ie.getElementSize(this.element),this.pageScroll=ie.getPageScroll(),this.elementMargin=this.element.style.margin,this.element.style.margin="0",this.elementPadding=this.element.style.padding,this.element.style.padding="0",this.bodyMargin=ai.margin,this.docMargin=li.margin,ai.margin="0",li.margin="0",this.bodyPadding=ai.padding,this.docPadding=li.padding,ai.padding="0",li.padding="0",this.bodyWidth=ai.width,this.docWidth=li.width,ai.width="100%",li.width="100%",this.bodyHeight=ai.height,this.docHeight=li.height,ai.height="100%",li.height="100%",this.previousBody=[],Z[this.hash].prevElementParent=this.element.parentNode,Z[this.hash].prevNextSibling=this.element.nextSibling,Z[this.hash].prevElementWidth=this.element.style.width,Z[this.hash].prevElementHeight=this.element.style.height,Ai=gt.childNodes.length,mi=0;mi<Ai;mi++)this.previousBody.push(gt.childNodes[0]),gt.removeChild(gt.childNodes[0]);this.toolbar&&this.toolbar.element&&(this.toolbar.parentNode=this.toolbar.element.parentNode,this.toolbar.nextSibling=this.toolbar.element.nextSibling,gt.appendChild(this.toolbar.element),ie.addClass(this.toolbar.element,"fullpage")),ie.addClass(this.element,"fullpage"),gt.appendChild(this.element),this.element.style.height=ie.getWindowSize().y+"px",this.element.style.width=ie.getWindowSize().x+"px",this.toolbar&&this.toolbar.element&&(this.element.style.height=ie.getElementSize(this.element).y-ie.getElementSize(this.toolbar.element).y+"px"),Z[this.hash].fullPage=!0,ie.delegate(this,Kr)({})}else{for(this.element.style.margin=this.elementMargin,this.element.style.padding=this.elementPadding,ai.margin=this.bodyMargin,li.margin=this.docMargin,ai.padding=this.bodyPadding,li.padding=this.docPadding,ai.width=this.bodyWidth,li.width=this.docWidth,ai.height=this.bodyHeight,li.height=this.docHeight,gt.removeChild(this.element),Ai=this.previousBody.length,mi=0;mi<Ai;mi++)gt.appendChild(this.previousBody.shift());ie.removeClass(this.element,"fullpage"),Z[this.hash].prevElementParent.insertBefore(this.element,Z[this.hash].prevNextSibling),this.toolbar&&this.toolbar.element&&(gt.removeChild(this.toolbar.element),ie.removeClass(this.toolbar.element,"fullpage"),this.toolbar.parentNode.insertBefore(this.toolbar.element,this.toolbar.nextSibling),delete this.toolbar.parentNode,delete this.toolbar.nextSibling),this.element.style.width=Z[this.hash].prevElementWidth,this.element.style.height=Z[this.hash].prevElementHeight;var ki=0,$i=function(){ie.setPageScroll(ci.pageScroll);var wi=ie.getPageScroll();ki++,ki<10&&(wi.x!==ci.pageScroll.x||wi.y!==ci.pageScroll.y)&&ie.requestAnimationFrame($i)};ie.requestAnimationFrame($i),Z[this.hash].fullPage=!1,ie.delegate(this,si)({})}return this.navigator&&this.viewport&&this.navigator.update(this.viewport),this.raiseEvent("full-page",{fullPage:lt}),this},setFullScreen:function(lt){var gt=this;if(!ie.supportsFullScreen)return this.setFullPage(lt);if(ie.isFullScreen()===lt)return this;var ai={fullScreen:lt,preventDefaultAction:!1};if(this.raiseEvent("pre-full-screen",ai),ai.preventDefaultAction)return this;if(lt){if(this.setFullPage(!0),!this.isFullPage())return this;this.fullPageStyleWidth=this.element.style.width,this.fullPageStyleHeight=this.element.style.height,this.element.style.width="100%",this.element.style.height="100%";var li=function(){var ci=ie.isFullScreen();ci||(ie.removeEvent(document,ie.fullScreenEventName,li),ie.removeEvent(document,ie.fullScreenErrorEventName,li),gt.setFullPage(!1),gt.isFullPage()&&(gt.element.style.width=gt.fullPageStyleWidth,gt.element.style.height=gt.fullPageStyleHeight)),gt.navigator&&gt.viewport&&setTimeout(function(){gt.navigator.update(gt.viewport)}),gt.raiseEvent("full-screen",{fullScreen:ci})};ie.addEvent(document,ie.fullScreenEventName,li),ie.addEvent(document,ie.fullScreenErrorEventName,li),ie.requestFullScreen(document.body)}else ie.exitFullScreen();return this},isVisible:function(){return this.container.style.visibility!="hidden"},setVisible:function(lt){return this.container.style.visibility=lt?"":"hidden",this.raiseEvent("visible",{visible:lt}),this},addTiledImage:function(lt){ie.console.assert(lt,"[Viewer.addTiledImage] options is required"),ie.console.assert(lt.tileSource,"[Viewer.addTiledImage] options.tileSource is required"),ie.console.assert(!lt.replace||lt.index>-1&&lt.index<this.world.getItemCount(),"[Viewer.addTiledImage] if options.replace is used, options.index must be a valid index in Viewer.world");var gt=this;lt.replace&&(lt.replaceItem=gt.world.getItemAt(lt.index)),this._hideMessage(),lt.placeholderFillStyle===void 0&&(lt.placeholderFillStyle=this.placeholderFillStyle),lt.opacity===void 0&&(lt.opacity=this.opacity),lt.preload===void 0&&(lt.preload=this.preload),lt.compositeOperation===void 0&&(lt.compositeOperation=this.compositeOperation),lt.crossOriginPolicy===void 0&&(lt.crossOriginPolicy=lt.tileSource.crossOriginPolicy!==void 0?lt.tileSource.crossOriginPolicy:this.crossOriginPolicy),lt.ajaxWithCredentials===void 0&&(lt.ajaxWithCredentials=this.ajaxWithCredentials),lt.loadTilesWithAjax===void 0&&(lt.loadTilesWithAjax=this.loadTilesWithAjax),lt.ajaxHeaders===void 0||lt.ajaxHeaders===null?lt.ajaxHeaders=this.ajaxHeaders:ie.isPlainObject(lt.ajaxHeaders)&&ie.isPlainObject(this.ajaxHeaders)&&(lt.ajaxHeaders=ie.extend({},this.ajaxHeaders,lt.ajaxHeaders));var ai={options:lt};function li(mi){for(var Ni=0;Ni<gt._loadQueue.length;Ni++)if(gt._loadQueue[Ni]===ai){gt._loadQueue.splice(Ni,1);break}gt._loadQueue.length===0&&ci(ai),gt.raiseEvent("add-item-failed",mi),lt.error&&lt.error(mi)}function ci(mi){gt.collectionMode&&(gt.world.arrange({immediately:mi.options.collectionImmediately,rows:gt.collectionRows,columns:gt.collectionColumns,layout:gt.collectionLayout,tileSize:gt.collectionTileSize,tileMargin:gt.collectionTileMargin}),gt.world.setAutoRefigureSizes(!0))}if(ie.isArray(lt.tileSource)){setTimeout(function(){li({message:"[Viewer.addTiledImage] Sequences can not be added; add them one at a time instead.",source:lt.tileSource,options:lt})});return}this._loadQueue.push(ai);function Ai(){for(var mi,Ni,ki;gt._loadQueue.length&&(mi=gt._loadQueue[0],!!mi.tileSource);){if(gt._loadQueue.splice(0,1),mi.options.replace){var $i=gt.world.getIndexOfItem(mi.options.replaceItem);$i!=-1&&(mi.options.index=$i),gt.world.removeItem(mi.options.replaceItem)}Ni=new ie.TiledImage({viewer:gt,source:mi.tileSource,viewport:gt.viewport,drawer:gt.drawer,tileCache:gt.tileCache,imageLoader:gt.imageLoader,x:mi.options.x,y:mi.options.y,width:mi.options.width,height:mi.options.height,fitBounds:mi.options.fitBounds,fitBoundsPlacement:mi.options.fitBoundsPlacement,clip:mi.options.clip,placeholderFillStyle:mi.options.placeholderFillStyle,opacity:mi.options.opacity,preload:mi.options.preload,degrees:mi.options.degrees,compositeOperation:mi.options.compositeOperation,springStiffness:gt.springStiffness,animationTime:gt.animationTime,minZoomImageRatio:gt.minZoomImageRatio,wrapHorizontal:gt.wrapHorizontal,wrapVertical:gt.wrapVertical,immediateRender:gt.immediateRender,blendTime:gt.blendTime,alwaysBlend:gt.alwaysBlend,minPixelRatio:gt.minPixelRatio,smoothTileEdgesMinZoom:gt.smoothTileEdgesMinZoom,iOSDevice:gt.iOSDevice,crossOriginPolicy:mi.options.crossOriginPolicy,ajaxWithCredentials:mi.options.ajaxWithCredentials,loadTilesWithAjax:mi.options.loadTilesWithAjax,ajaxHeaders:mi.options.ajaxHeaders,debugMode:gt.debugMode}),gt.collectionMode&&gt.world.setAutoRefigureSizes(!1),gt.world.addItem(Ni,{index:mi.options.index}),gt._loadQueue.length===0&&ci(mi),gt.world.getItemCount()===1&&!gt.preserveViewport&&gt.viewport.goHome(!0),gt.navigator&&(ki=ie.extend({},mi.options,{replace:!1,originalTiledImage:Ni,tileSource:mi.tileSource}),gt.navigator.addTiledImage(ki)),mi.options.success&&mi.options.success({item:Ni})}}ve(this,lt.tileSource,lt,function(mi){ai.tileSource=mi,Ai()},function(mi){mi.options=lt,li(mi),Ai()})},addSimpleImage:function(lt){ie.console.assert(lt,"[Viewer.addSimpleImage] options is required"),ie.console.assert(lt.url,"[Viewer.addSimpleImage] options.url is required");var gt=ie.extend({},lt,{tileSource:{type:"image",url:lt.url}});delete gt.url,this.addTiledImage(gt)},addLayer:function(lt){var gt=this;ie.console.error("[Viewer.addLayer] this function is deprecated; use Viewer.addTiledImage() instead.");var ai=ie.extend({},lt,{success:function(li){gt.raiseEvent("add-layer",{options:lt,drawer:li.item})},error:function(li){gt.raiseEvent("add-layer-failed",li)}});return this.addTiledImage(ai),this},getLayerAtLevel:function(lt){return ie.console.error("[Viewer.getLayerAtLevel] this function is deprecated; use World.getItemAt() instead."),this.world.getItemAt(lt)},getLevelOfLayer:function(lt){return ie.console.error("[Viewer.getLevelOfLayer] this function is deprecated; use World.getIndexOfItem() instead."),this.world.getIndexOfItem(lt)},getLayersCount:function(){return ie.console.error("[Viewer.getLayersCount] this function is deprecated; use World.getItemCount() instead."),this.world.getItemCount()},setLayerLevel:function(lt,gt){return ie.console.error("[Viewer.setLayerLevel] this function is deprecated; use World.setItemIndex() instead."),this.world.setItemIndex(lt,gt)},removeLayer:function(lt){return ie.console.error("[Viewer.removeLayer] this function is deprecated; use World.removeItem() instead."),this.world.removeItem(lt)},forceRedraw:function(){return Z[this.hash].forceRedraw=!0,this},bindSequenceControls:function(){var lt=ie.delegate(this,Je),gt=ie.delegate(this,rt),ai=ie.delegate(this,Mi),li=ie.delegate(this,Oi),ci=this.navImages,Ai=!0;return this.showSequenceControl&&((this.previousButton||this.nextButton)&&(Ai=!1),this.previousButton=new ie.Button({element:this.previousButton?ie.getElement(this.previousButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:ie.getString("Tooltips.PreviousPage"),srcRest:ti(this.prefixUrl,ci.previous.REST),srcGroup:ti(this.prefixUrl,ci.previous.GROUP),srcHover:ti(this.prefixUrl,ci.previous.HOVER),srcDown:ti(this.prefixUrl,ci.previous.DOWN),onRelease:li,onFocus:lt,onBlur:gt}),this.nextButton=new ie.Button({element:this.nextButton?ie.getElement(this.nextButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:ie.getString("Tooltips.NextPage"),srcRest:ti(this.prefixUrl,ci.next.REST),srcGroup:ti(this.prefixUrl,ci.next.GROUP),srcHover:ti(this.prefixUrl,ci.next.HOVER),srcDown:ti(this.prefixUrl,ci.next.DOWN),onRelease:ai,onFocus:lt,onBlur:gt}),this.navPrevNextWrap||this.previousButton.disable(),(!this.tileSources||!this.tileSources.length)&&this.nextButton.disable(),Ai&&(this.paging=new ie.ButtonGroup({buttons:[this.previousButton,this.nextButton],clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.pagingControl=this.paging.element,this.toolbar?this.toolbar.addControl(this.pagingControl,{anchor:ie.ControlAnchor.BOTTOM_RIGHT}):this.addControl(this.pagingControl,{anchor:this.sequenceControlAnchor||ie.ControlAnchor.TOP_LEFT}))),this},bindStandardControls:function(){var lt=ie.delegate(this,ni),gt=ie.delegate(this,yi),ai=ie.delegate(this,Ri),li=ie.delegate(this,ui),ci=ie.delegate(this,Ei),Ai=ie.delegate(this,Ii),mi=ie.delegate(this,vi),Ni=ie.delegate(this,Si),ki=ie.delegate(this,Fi),$i=ie.delegate(this,Di),wi=ie.delegate(this,Je),Ui=ie.delegate(this,rt),Li=this.navImages,Hi=[],Gi=!0;return this.showNavigationControl&&((this.zoomInButton||this.zoomOutButton||this.homeButton||this.fullPageButton||this.rotateLeftButton||this.rotateRightButton||this.flipButton)&&(Gi=!1),this.showZoomControl&&(Hi.push(this.zoomInButton=new ie.Button({element:this.zoomInButton?ie.getElement(this.zoomInButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:ie.getString("Tooltips.ZoomIn"),srcRest:ti(this.prefixUrl,Li.zoomIn.REST),srcGroup:ti(this.prefixUrl,Li.zoomIn.GROUP),srcHover:ti(this.prefixUrl,Li.zoomIn.HOVER),srcDown:ti(this.prefixUrl,Li.zoomIn.DOWN),onPress:lt,onRelease:gt,onClick:ai,onEnter:lt,onExit:gt,onFocus:wi,onBlur:Ui})),Hi.push(this.zoomOutButton=new ie.Button({element:this.zoomOutButton?ie.getElement(this.zoomOutButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:ie.getString("Tooltips.ZoomOut"),srcRest:ti(this.prefixUrl,Li.zoomOut.REST),srcGroup:ti(this.prefixUrl,Li.zoomOut.GROUP),srcHover:ti(this.prefixUrl,Li.zoomOut.HOVER),srcDown:ti(this.prefixUrl,Li.zoomOut.DOWN),onPress:li,onRelease:gt,onClick:ci,onEnter:li,onExit:gt,onFocus:wi,onBlur:Ui}))),this.showHomeControl&&Hi.push(this.homeButton=new ie.Button({element:this.homeButton?ie.getElement(this.homeButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:ie.getString("Tooltips.Home"),srcRest:ti(this.prefixUrl,Li.home.REST),srcGroup:ti(this.prefixUrl,Li.home.GROUP),srcHover:ti(this.prefixUrl,Li.home.HOVER),srcDown:ti(this.prefixUrl,Li.home.DOWN),onRelease:Ai,onFocus:wi,onBlur:Ui})),this.showFullPageControl&&Hi.push(this.fullPageButton=new ie.Button({element:this.fullPageButton?ie.getElement(this.fullPageButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:ie.getString("Tooltips.FullPage"),srcRest:ti(this.prefixUrl,Li.fullpage.REST),srcGroup:ti(this.prefixUrl,Li.fullpage.GROUP),srcHover:ti(this.prefixUrl,Li.fullpage.HOVER),srcDown:ti(this.prefixUrl,Li.fullpage.DOWN),onRelease:mi,onFocus:wi,onBlur:Ui})),this.showRotationControl&&(Hi.push(this.rotateLeftButton=new ie.Button({element:this.rotateLeftButton?ie.getElement(this.rotateLeftButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:ie.getString("Tooltips.RotateLeft"),srcRest:ti(this.prefixUrl,Li.rotateleft.REST),srcGroup:ti(this.prefixUrl,Li.rotateleft.GROUP),srcHover:ti(this.prefixUrl,Li.rotateleft.HOVER),srcDown:ti(this.prefixUrl,Li.rotateleft.DOWN),onRelease:Ni,onFocus:wi,onBlur:Ui})),Hi.push(this.rotateRightButton=new ie.Button({element:this.rotateRightButton?ie.getElement(this.rotateRightButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:ie.getString("Tooltips.RotateRight"),srcRest:ti(this.prefixUrl,Li.rotateright.REST),srcGroup:ti(this.prefixUrl,Li.rotateright.GROUP),srcHover:ti(this.prefixUrl,Li.rotateright.HOVER),srcDown:ti(this.prefixUrl,Li.rotateright.DOWN),onRelease:ki,onFocus:wi,onBlur:Ui}))),this.showFlipControl&&Hi.push(this.flipButton=new ie.Button({element:this.flipButton?ie.getElement(this.flipButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:ie.getString("Tooltips.Flip"),srcRest:ti(this.prefixUrl,Li.flip.REST),srcGroup:ti(this.prefixUrl,Li.flip.GROUP),srcHover:ti(this.prefixUrl,Li.flip.HOVER),srcDown:ti(this.prefixUrl,Li.flip.DOWN),onRelease:$i,onFocus:wi,onBlur:Ui})),Gi&&(this.buttons=new ie.ButtonGroup({buttons:Hi,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.navControl=this.buttons.element,this.addHandler("open",ie.delegate(this,xi)),this.toolbar?this.toolbar.addControl(this.navControl,{anchor:this.navigationControlAnchor||ie.ControlAnchor.TOP_LEFT}):this.addControl(this.navControl,{anchor:this.navigationControlAnchor||ie.ControlAnchor.TOP_LEFT}))),this},currentPage:function(){return this._sequenceIndex},goToPage:function(lt){return this.tileSources&&lt>=0&&lt<this.tileSources.length&&(this._sequenceIndex=lt,this._updateSequenceButtons(lt),this.open(this.tileSources[lt]),this.referenceStrip&&this.referenceStrip.setFocus(lt),this.raiseEvent("page",{page:lt})),this},addOverlay:function(lt,gt,ai,li){var ci;if(ie.isPlainObject(lt)?ci=lt:ci={element:lt,location:gt,placement:ai,onDraw:li},lt=ie.getElement(ci.element),be(this.currentOverlays,lt)>=0)return this;var Ai=ye(this,ci);return this.currentOverlays.push(Ai),Ai.drawHTML(this.overlaysContainer,this.viewport),this.raiseEvent("add-overlay",{element:lt,location:ci.location,placement:ci.placement}),this},updateOverlay:function(lt,gt,ai){var li;return lt=ie.getElement(lt),li=be(this.currentOverlays,lt),li>=0&&(this.currentOverlays[li].update(gt,ai),Z[this.hash].forceRedraw=!0,this.raiseEvent("update-overlay",{element:lt,location:gt,placement:ai})),this},removeOverlay:function(lt){var gt;return lt=ie.getElement(lt),gt=be(this.currentOverlays,lt),gt>=0&&(this.currentOverlays[gt].destroy(),this.currentOverlays.splice(gt,1),Z[this.hash].forceRedraw=!0,this.raiseEvent("remove-overlay",{element:lt})),this},clearOverlays:function(){for(;this.currentOverlays.length>0;)this.currentOverlays.pop().destroy();return Z[this.hash].forceRedraw=!0,this.raiseEvent("clear-overlay",{}),this},getOverlayById:function(lt){var gt;return lt=ie.getElement(lt),gt=be(this.currentOverlays,lt),gt>=0?this.currentOverlays[gt]:null},_updateSequenceButtons:function(lt){this.nextButton&&(!this.tileSources||this.tileSources.length-1===lt?this.navPrevNextWrap||this.nextButton.disable():this.nextButton.enable()),this.previousButton&&(lt>0?this.previousButton.enable():this.navPrevNextWrap||this.previousButton.disable())},_showMessage:function(lt){this._hideMessage();var gt=ie.makeNeutralElement("div");gt.appendChild(document.createTextNode(lt)),this.messageDiv=ie.makeCenteredNode(gt),ie.addClass(this.messageDiv,"openseadragon-message"),this.container.appendChild(this.messageDiv)},_hideMessage:function(){var lt=this.messageDiv;lt&&(lt.parentNode.removeChild(lt),delete this.messageDiv)},gestureSettingsByDeviceType:function(lt){switch(lt){case"mouse":return this.gestureSettingsMouse;case"touch":return this.gestureSettingsTouch;case"pen":return this.gestureSettingsPen;default:return this.gestureSettingsUnknown}},_drawOverlays:function(){var lt,gt=this.currentOverlays.length;for(lt=0;lt<gt;lt++)this.currentOverlays[lt].drawHTML(this.overlaysContainer,this.viewport)},_cancelPendingImages:function(){this._loadQueue=[]},removeReferenceStrip:function(){this.showReferenceStrip=!1,this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null)},addReferenceStrip:function(){if(this.showReferenceStrip=!0,this.sequenceMode){if(this.referenceStrip)return;this.tileSources.length&&this.tileSources.length>1&&(this.referenceStrip=new ie.ReferenceStrip({id:this.referenceStripElement,position:this.referenceStripPosition,sizeRatio:this.referenceStripSizeRatio,scroll:this.referenceStripScroll,height:this.referenceStripHeight,width:this.referenceStripWidth,tileSources:this.tileSources,prefixUrl:this.prefixUrl,useCanvas:this.useCanvas,viewer:this}),this.referenceStrip.setFocus(this._sequenceIndex))}else ie.console.warn('Attempting to display a reference strip while "sequenceMode" is off.')}});function ae(lt){return lt=ie.getElement(lt),new ie.Point(lt.clientWidth===0?1:lt.clientWidth,lt.clientHeight===0?1:lt.clientHeight)}function ve(lt,gt,ai,li,ci){var Ai=lt;if(ie.type(gt)=="string"){if(gt.match(/^\s*<.*>\s*$/))gt=ie.parseXml(gt);else if(gt.match(/^\s*[\{\[].*[\}\]]\s*$/))try{var mi=ie.parseJSON(gt);gt=mi}catch{}}function Ni(ki,$i){ki.ready?li(ki):(ki.addHandler("ready",function(){li(ki)}),ki.addHandler("open-failed",function(wi){ci({message:wi.message,source:$i})}))}setTimeout(function(){if(ie.type(gt)=="string")gt=new ie.TileSource({url:gt,crossOriginPolicy:ai.crossOriginPolicy!==void 0?ai.crossOriginPolicy:lt.crossOriginPolicy,ajaxWithCredentials:lt.ajaxWithCredentials,ajaxHeaders:lt.ajaxHeaders,useCanvas:lt.useCanvas,success:function(Ui){li(Ui.tileSource)}}),gt.addHandler("open-failed",function(Ui){ci(Ui)});else if(ie.isPlainObject(gt)||gt.nodeType)if(gt.crossOriginPolicy===void 0&&(ai.crossOriginPolicy!==void 0||lt.crossOriginPolicy!==void 0)&&(gt.crossOriginPolicy=ai.crossOriginPolicy!==void 0?ai.crossOriginPolicy:lt.crossOriginPolicy),gt.ajaxWithCredentials===void 0&&(gt.ajaxWithCredentials=lt.ajaxWithCredentials),gt.useCanvas===void 0&&(gt.useCanvas=lt.useCanvas),ie.isFunction(gt.getTileUrl)){var ki=new ie.TileSource(gt);ki.getTileUrl=gt.getTileUrl,li(ki)}else{var $i=ie.TileSource.determineType(Ai,gt);if(!$i){ci({message:"Unable to load TileSource",source:gt});return}var wi=$i.prototype.configure.apply(Ai,[gt]);Ni(new $i(wi),gt)}else Ni(gt,gt)})}function ye(lt,gt){if(gt instanceof ie.Overlay)return gt;var ai=null;if(gt.element)ai=ie.getElement(gt.element);else{var li=gt.id?gt.id:"openseadragon-overlay-"+Math.floor(Math.random()*1e7);ai=ie.getElement(gt.id),ai||(ai=document.createElement("a"),ai.href="#/overlay/"+li),ai.id=li,ie.addClass(ai,gt.className?gt.className:"openseadragon-overlay")}var ci=gt.location,Ai=gt.width,mi=gt.height;if(!ci){var Ni=gt.x,ki=gt.y;if(gt.px!==void 0){var $i=lt.viewport.imageToViewportRectangle(new ie.Rect(gt.px,gt.py,Ai||0,mi||0));Ni=$i.x,ki=$i.y,Ai=Ai!==void 0?$i.width:void 0,mi=mi!==void 0?$i.height:void 0}ci=new ie.Point(Ni,ki)}var wi=gt.placement;return wi&&ie.type(wi)==="string"&&(wi=ie.Placement[gt.placement.toUpperCase()]),new ie.Overlay({element:ai,location:ci,placement:wi,onDraw:gt.onDraw,checkResize:gt.checkResize,width:Ai,height:mi,rotationMode:gt.rotationMode})}function be(lt,gt){var ai;for(ai=lt.length-1;ai>=0;ai--)if(lt[ai].element===gt)return ai;return-1}function Ke(lt,gt){return ie.requestAnimationFrame(function(){gt(lt)})}function Ye(lt){ie.requestAnimationFrame(function(){Qe(lt)})}function Xe(lt){lt.autoHideControls&&(lt.controlsShouldFade=!0,lt.controlsFadeBeginTime=ie.now()+lt.controlsFadeDelay,window.setTimeout(function(){Ye(lt)},lt.controlsFadeDelay))}function Qe(lt){var gt,ai,li,ci;if(lt.controlsShouldFade){for(gt=ie.now(),ai=gt-lt.controlsFadeBeginTime,li=1-ai/lt.controlsFadeLength,li=Math.min(1,li),li=Math.max(0,li),ci=lt.controls.length-1;ci>=0;ci--)lt.controls[ci].autoFade&&lt.controls[ci].setOpacity(li);li>0&&Ye(lt)}}function et(lt){var gt;for(lt.controlsShouldFade=!1,gt=lt.controls.length-1;gt>=0;gt--)lt.controls[gt].setOpacity(1)}function Je(){et(this)}function rt(){Xe(this)}function it(lt){var gt={originalEvent:lt.originalEvent,preventDefaultAction:lt.preventDefaultAction,preventVerticalPan:lt.preventVerticalPan,preventHorizontalPan:lt.preventHorizontalPan};if(this.raiseEvent("canvas-key",gt),!gt.preventDefaultAction&&!lt.ctrl&&!lt.alt&&!lt.meta)switch(lt.keyCode){case 38:return gt.preventVerticalPan||(lt.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new ie.Point(0,-this.pixelsPerArrowPress))),this.viewport.applyConstraints()),!1;case 40:return gt.preventVerticalPan||(lt.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new ie.Point(0,this.pixelsPerArrowPress))),this.viewport.applyConstraints()),!1;case 37:return gt.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new ie.Point(-this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),!1;case 39:return gt.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new ie.Point(this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),!1;default:return!0}else return!0}function nt(lt){var gt={originalEvent:lt.originalEvent,preventDefaultAction:lt.preventDefaultAction,preventVerticalPan:lt.preventVerticalPan,preventHorizontalPan:lt.preventHorizontalPan};if(this.raiseEvent("canvas-key",gt),!gt.preventDefaultAction&&!lt.ctrl&&!lt.alt&&!lt.meta)switch(lt.keyCode){case 43:case 61:return this.viewport.zoomBy(1.1),this.viewport.applyConstraints(),!1;case 45:return this.viewport.zoomBy(.9),this.viewport.applyConstraints(),!1;case 48:return this.viewport.goHome(),this.viewport.applyConstraints(),!1;case 119:case 87:return gt.preventVerticalPan||(lt.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new ie.Point(0,-40))),this.viewport.applyConstraints()),!1;case 115:case 83:return gt.preventVerticalPan||(lt.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new ie.Point(0,40))),this.viewport.applyConstraints()),!1;case 97:return gt.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new ie.Point(-40,0))),this.viewport.applyConstraints()),!1;case 100:return gt.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new ie.Point(40,0))),this.viewport.applyConstraints()),!1;case 114:return this.viewport.flipped?this.viewport.setRotation(ie.positiveModulo(this.viewport.degrees-this.rotationIncrement,360)):this.viewport.setRotation(ie.positiveModulo(this.viewport.degrees+this.rotationIncrement,360)),this.viewport.applyConstraints(),!1;case 82:return this.viewport.flipped?this.viewport.setRotation(ie.positiveModulo(this.viewport.degrees+this.rotationIncrement,360)):this.viewport.setRotation(ie.positiveModulo(this.viewport.degrees-this.rotationIncrement,360)),this.viewport.applyConstraints(),!1;case 102:return this.viewport.toggleFlip(),!1;default:return!0}else return!0}function tt(lt){var gt,ai=document.activeElement==this.canvas;ai||this.canvas.focus(),this.viewport.flipped&&(lt.position.x=this.viewport.getContainerSize().x-lt.position.x);var li={tracker:lt.eventSource,position:lt.position,quick:lt.quick,shift:lt.shift,originalEvent:lt.originalEvent,preventDefaultAction:lt.preventDefaultAction};this.raiseEvent("canvas-click",li),!li.preventDefaultAction&&this.viewport&&lt.quick&&(gt=this.gestureSettingsByDeviceType(lt.pointerType),gt.clickToZoom&&(this.viewport.zoomBy(lt.shift?1/this.zoomPerClick:this.zoomPerClick,gt.zoomToRefPoint?this.viewport.pointFromPixel(lt.position,!0):null),this.viewport.applyConstraints()))}function st(lt){var gt,ai={tracker:lt.eventSource,position:lt.position,shift:lt.shift,originalEvent:lt.originalEvent,preventDefaultAction:lt.preventDefaultAction};this.raiseEvent("canvas-double-click",ai),!ai.preventDefaultAction&&this.viewport&&(gt=this.gestureSettingsByDeviceType(lt.pointerType),gt.dblClickToZoom&&(this.viewport.zoomBy(lt.shift?1/this.zoomPerClick:this.zoomPerClick,gt.zoomToRefPoint?this.viewport.pointFromPixel(lt.position,!0):null),this.viewport.applyConstraints()))}function ot(lt){var gt,ai={tracker:lt.eventSource,position:lt.position,delta:lt.delta,speed:lt.speed,direction:lt.direction,shift:lt.shift,originalEvent:lt.originalEvent,preventDefaultAction:lt.preventDefaultAction};if(this.raiseEvent("canvas-drag",ai),!ai.preventDefaultAction&&this.viewport){if(gt=this.gestureSettingsByDeviceType(lt.pointerType),this.panHorizontal||(lt.delta.x=0),this.panVertical||(lt.delta.y=0),this.viewport.flipped&&(lt.delta.x=-lt.delta.x),this.constrainDuringPan){var li=this.viewport.deltaPointsFromPixels(lt.delta.negate());this.viewport.centerSpringX.target.value+=li.x,this.viewport.centerSpringY.target.value+=li.y;var ci=this.viewport.getBounds(),Ai=this.viewport.getConstrainedBounds();this.viewport.centerSpringX.target.value-=li.x,this.viewport.centerSpringY.target.value-=li.y,ci.x!=Ai.x&&(lt.delta.x=0),ci.y!=Ai.y&&(lt.delta.y=0)}this.viewport.panBy(this.viewport.deltaPointsFromPixels(lt.delta.negate()),gt.flickEnabled&&!this.constrainDuringPan)}}function ut(lt){if(!lt.preventDefaultAction&&this.viewport){var gt=this.gestureSettingsByDeviceType(lt.pointerType);if(gt.flickEnabled&&lt.speed>=gt.flickMinSpeed){var ai=0;this.panHorizontal&&(ai=gt.flickMomentum*lt.speed*Math.cos(lt.direction));var li=0;this.panVertical&&(li=gt.flickMomentum*lt.speed*Math.sin(lt.direction));var ci=this.viewport.pixelFromPoint(this.viewport.getCenter(!0)),Ai=this.viewport.pointFromPixel(new ie.Point(ci.x-ai,ci.y-li));this.viewport.panTo(Ai,!1)}this.viewport.applyConstraints()}this.raiseEvent("canvas-drag-end",{tracker:lt.eventSource,position:lt.position,speed:lt.speed,direction:lt.direction,shift:lt.shift,originalEvent:lt.originalEvent})}function ft(lt){this.raiseEvent("canvas-enter",{tracker:lt.eventSource,pointerType:lt.pointerType,position:lt.position,buttons:lt.buttons,pointers:lt.pointers,insideElementPressed:lt.insideElementPressed,buttonDownAny:lt.buttonDownAny,originalEvent:lt.originalEvent})}function pt(lt){window.location!=window.parent.location&&ie.MouseTracker.resetAllMouseTrackers(),this.raiseEvent("canvas-exit",{tracker:lt.eventSource,pointerType:lt.pointerType,position:lt.position,buttons:lt.buttons,pointers:lt.pointers,insideElementPressed:lt.insideElementPressed,buttonDownAny:lt.buttonDownAny,originalEvent:lt.originalEvent})}function Xr(lt){this.raiseEvent("canvas-press",{tracker:lt.eventSource,pointerType:lt.pointerType,position:lt.position,insideElementPressed:lt.insideElementPressed,insideElementReleased:lt.insideElementReleased,originalEvent:lt.originalEvent})}function mt(lt){this.raiseEvent("canvas-release",{tracker:lt.eventSource,pointerType:lt.pointerType,position:lt.position,insideElementPressed:lt.insideElementPressed,insideElementReleased:lt.insideElementReleased,originalEvent:lt.originalEvent})}function Yr(lt){this.raiseEvent("canvas-nonprimary-press",{tracker:lt.eventSource,position:lt.position,pointerType:lt.pointerType,button:lt.button,buttons:lt.buttons,originalEvent:lt.originalEvent})}function ri(lt){this.raiseEvent("canvas-nonprimary-release",{tracker:lt.eventSource,position:lt.position,pointerType:lt.pointerType,button:lt.button,buttons:lt.buttons,originalEvent:lt.originalEvent})}function Zr(lt){var gt,ai,li,ci;if(!lt.preventDefaultAction&&this.viewport&&(gt=this.gestureSettingsByDeviceType(lt.pointerType),gt.pinchToZoom&&(ai=this.viewport.pointFromPixel(lt.center,!0),li=this.viewport.pointFromPixel(lt.lastCenter,!0),ci=li.minus(ai),this.panHorizontal||(ci.x=0),this.panVertical||(ci.y=0),this.viewport.zoomBy(lt.distance/lt.lastDistance,ai,!0),gt.zoomToRefPoint&&this.viewport.panBy(ci,!0),this.viewport.applyConstraints()),gt.pinchRotate)){var Ai=Math.atan2(lt.gesturePoints[0].currentPos.y-lt.gesturePoints[1].currentPos.y,lt.gesturePoints[0].currentPos.x-lt.gesturePoints[1].currentPos.x),mi=Math.atan2(lt.gesturePoints[0].lastPos.y-lt.gesturePoints[1].lastPos.y,lt.gesturePoints[0].lastPos.x-lt.gesturePoints[1].lastPos.x);this.viewport.setRotation(this.viewport.getRotation()+(Ai-mi)*(180/Math.PI))}return this.raiseEvent("canvas-pinch",{tracker:lt.eventSource,gesturePoints:lt.gesturePoints,lastCenter:lt.lastCenter,center:lt.center,lastDistance:lt.lastDistance,distance:lt.distance,shift:lt.shift,originalEvent:lt.originalEvent}),!1}function _r(lt){var gt,ai,li,ci;if(li=ie.now(),ci=li-this._lastScrollTime,ci>this.minScrollDeltaTime){if(this._lastScrollTime=li,this.viewport.flipped&&(lt.position.x=this.viewport.getContainerSize().x-lt.position.x),!lt.preventDefaultAction&&this.viewport&&(gt=this.gestureSettingsByDeviceType(lt.pointerType),gt.scrollToZoom&&(ai=Math.pow(this.zoomPerScroll,lt.scroll),this.viewport.zoomBy(ai,gt.zoomToRefPoint?this.viewport.pointFromPixel(lt.position,!0):null),this.viewport.applyConstraints())),this.raiseEvent("canvas-scroll",{tracker:lt.eventSource,position:lt.position,scroll:lt.scroll,shift:lt.shift,originalEvent:lt.originalEvent}),gt&&gt.scrollToZoom)return!1}else if(gt=this.gestureSettingsByDeviceType(lt.pointerType),gt&&gt.scrollToZoom)return!1}function Kr(lt){Z[this.hash].mouseInside=!0,et(this),this.raiseEvent("container-enter",{tracker:lt.eventSource,position:lt.position,buttons:lt.buttons,pointers:lt.pointers,insideElementPressed:lt.insideElementPressed,buttonDownAny:lt.buttonDownAny,originalEvent:lt.originalEvent})}function si(lt){lt.pointers<1&&(Z[this.hash].mouseInside=!1,Z[this.hash].animating||Xe(this)),this.raiseEvent("container-exit",{tracker:lt.eventSource,position:lt.position,buttons:lt.buttons,pointers:lt.pointers,insideElementPressed:lt.insideElementPressed,buttonDownAny:lt.buttonDownAny,originalEvent:lt.originalEvent})}function oi(lt){Qr(lt),lt.isOpen()?lt._updateRequestId=Ke(lt,oi):lt._updateRequestId=!1}function Qr(lt){if(!lt._opening){if(lt.autoResize){var gt=ae(lt.container),ai=Z[lt.hash].prevContainerSize;if(!gt.equals(ai)){var li=lt.viewport;if(lt.preserveImageSizeOnResize){var ci=ai.x/gt.x,Ai=li.getZoom()*ci,mi=li.getCenter();li.resize(gt,!1),li.zoomTo(Ai,null,!0),li.panTo(mi,!0)}else{var Ni=li.getBounds();li.resize(gt,!0),li.fitBoundsWithConstraints(Ni,!0)}Z[lt.hash].prevContainerSize=gt,Z[lt.hash].forceRedraw=!0}}var ki=lt.viewport.update(),$i=lt.world.update()||ki;ki&&lt.raiseEvent("viewport-change"),lt.referenceStrip&&($i=lt.referenceStrip.update(lt.viewport)||$i),!Z[lt.hash].animating&&$i&&(lt.raiseEvent("animation-start"),et(lt)),($i||Z[lt.hash].forceRedraw||lt.world.needsDraw())&&(ii(lt),lt._drawOverlays(),lt.navigator&&lt.navigator.update(lt.viewport),Z[lt.hash].forceRedraw=!1,$i&&lt.raiseEvent("animation")),Z[lt.hash].animating&&!$i&&(lt.raiseEvent("animation-finish"),Z[lt.hash].mouseInside||Xe(lt)),Z[lt.hash].animating=$i}}function ii(lt){lt.imageLoader.clear(),lt.drawer.clear(),lt.world.draw(),lt.raiseEvent("update-viewport",{})}function ti(lt,gt){return lt?lt+gt:gt}function ni(){Z[this.hash].lastZoomTime=ie.now(),Z[this.hash].zoomFactor=this.zoomPerSecond,Z[this.hash].zooming=!0,pi(this)}function ui(){Z[this.hash].lastZoomTime=ie.now(),Z[this.hash].zoomFactor=1/this.zoomPerSecond,Z[this.hash].zooming=!0,pi(this)}function yi(){Z[this.hash].zooming=!1}function pi(lt){ie.requestAnimationFrame(ie.delegate(lt,gi))}function gi(){var lt,gt,ai;Z[this.hash].zooming&&this.viewport&&(lt=ie.now(),gt=lt-Z[this.hash].lastZoomTime,ai=Math.pow(Z[this.hash].zoomFactor,gt/1e3),this.viewport.zoomBy(ai),this.viewport.applyConstraints(),Z[this.hash].lastZoomTime=lt,pi(this))}function Ri(){this.viewport&&(Z[this.hash].zooming=!1,this.viewport.zoomBy(this.zoomPerClick/1),this.viewport.applyConstraints())}function Ei(){this.viewport&&(Z[this.hash].zooming=!1,this.viewport.zoomBy(1/this.zoomPerClick),this.viewport.applyConstraints())}function xi(){this.buttons.emulateEnter(),this.buttons.emulateExit()}function Ii(){this.viewport&&this.viewport.goHome()}function vi(){this.isFullPage()&&!ie.isFullScreen()?this.setFullPage(!1):this.setFullScreen(!this.isFullPage()),this.buttons&&this.buttons.emulateExit(),this.fullPageButton.element.focus(),this.viewport&&this.viewport.applyConstraints()}function Si(){if(this.viewport){var lt=this.viewport.getRotation();this.viewport.flipped?lt=ie.positiveModulo(lt+this.rotationIncrement,360):lt=ie.positiveModulo(lt-this.rotationIncrement,360),this.viewport.setRotation(lt)}}function Fi(){if(this.viewport){var lt=this.viewport.getRotation();this.viewport.flipped?lt=ie.positiveModulo(lt-this.rotationIncrement,360):lt=ie.positiveModulo(lt+this.rotationIncrement,360),this.viewport.setRotation(lt)}}function Di(){this.viewport.toggleFlip()}function Oi(){var lt=this._sequenceIndex-1;this.navPrevNextWrap&&lt<0&&(lt+=this.tileSources.length),this.goToPage(lt)}function Mi(){var lt=this._sequenceIndex+1;this.navPrevNextWrap&&lt>=this.tileSources.length&&(lt=0),this.goToPage(lt)}}(OpenSeadragon),function(ie){ie.Navigator=function(Ke){var Ye=Ke.viewer,Xe=this,Qe,et;Ke.id?(this.element=document.getElementById(Ke.id),Ke.controlOptions={anchor:ie.ControlAnchor.NONE,attachToViewer:!1,autoFade:!1}):(Ke.id="navigator-"+ie.now(),this.element=ie.makeNeutralElement("div"),Ke.controlOptions={anchor:ie.ControlAnchor.TOP_RIGHT,attachToViewer:!0,autoFade:Ke.autoFade},Ke.position&&(Ke.position=="BOTTOM_RIGHT"?Ke.controlOptions.anchor=ie.ControlAnchor.BOTTOM_RIGHT:Ke.position=="BOTTOM_LEFT"?Ke.controlOptions.anchor=ie.ControlAnchor.BOTTOM_LEFT:Ke.position=="TOP_RIGHT"?Ke.controlOptions.anchor=ie.ControlAnchor.TOP_RIGHT:Ke.position=="TOP_LEFT"?Ke.controlOptions.anchor=ie.ControlAnchor.TOP_LEFT:Ke.position=="ABSOLUTE"&&(Ke.controlOptions.anchor=ie.ControlAnchor.ABSOLUTE,Ke.controlOptions.top=Ke.top,Ke.controlOptions.left=Ke.left,Ke.controlOptions.height=Ke.height,Ke.controlOptions.width=Ke.width))),this.element.id=Ke.id,this.element.className+=" navigator",Ke=ie.extend(!0,{sizeRatio:ie.DEFAULT_SETTINGS.navigatorSizeRatio},Ke,{element:this.element,tabIndex:-1,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,autoResize:Ke.autoResize,minZoomImageRatio:1,background:Ke.background,opacity:Ke.opacity,borderColor:Ke.borderColor,displayRegionColor:Ke.displayRegionColor}),Ke.minPixelRatio=this.minPixelRatio=Ye.minPixelRatio,ie.setElementTouchActionNone(this.element),this.borderWidth=2,this.fudge=new ie.Point(1,1),this.totalBorderWidths=new ie.Point(this.borderWidth*2,this.borderWidth*2).minus(this.fudge),Ke.controlOptions.anchor!=ie.ControlAnchor.NONE&&function(it,nt){it.margin="0px",it.border=nt+"px solid "+Ke.borderColor,it.padding="0px",it.background=Ke.background,it.opacity=Ke.opacity,it.overflow="hidden"}(this.element.style,this.borderWidth),this.displayRegion=ie.makeNeutralElement("div"),this.displayRegion.id=this.element.id+"-displayregion",this.displayRegion.className="displayregion",function(it,nt){it.position="relative",it.top="0px",it.left="0px",it.fontSize="0px",it.overflow="hidden",it.border=nt+"px solid "+Ke.displayRegionColor,it.margin="0px",it.padding="0px",it.background="transparent",it.float="left",it.cssFloat="left",it.styleFloat="left",it.zIndex=999999999,it.cursor="default"}(this.displayRegion.style,this.borderWidth),this.displayRegionContainer=ie.makeNeutralElement("div"),this.displayRegionContainer.id=this.element.id+"-displayregioncontainer",this.displayRegionContainer.className="displayregioncontainer",this.displayRegionContainer.style.width="100%",this.displayRegionContainer.style.height="100%",Ye.addControl(this.element,Ke.controlOptions),this._resizeWithViewer=Ke.controlOptions.anchor!=ie.ControlAnchor.ABSOLUTE&&Ke.controlOptions.anchor!=ie.ControlAnchor.NONE,Ke.width&&Ke.height?(this.setWidth(Ke.width),this.setHeight(Ke.height)):this._resizeWithViewer&&(Qe=ie.getElementSize(Ye.element),this.element.style.height=Math.round(Qe.y*Ke.sizeRatio)+"px",this.element.style.width=Math.round(Qe.x*Ke.sizeRatio)+"px",this.oldViewerSize=Qe,et=ie.getElementSize(this.element),this.elementArea=et.x*et.y),this.oldContainerSize=new ie.Point(0,0),ie.Viewer.apply(this,[Ke]),this.displayRegionContainer.appendChild(this.displayRegion),this.element.getElementsByTagName("div")[0].appendChild(this.displayRegionContainer);function Je(it){ye(Xe.displayRegionContainer,it),ye(Xe.displayRegion,-it),Xe.viewport.setRotation(it)}if(Ke.navigatorRotate){var rt=Ke.viewer.viewport?Ke.viewer.viewport.getRotation():Ke.viewer.degrees||0;Je(rt),Ke.viewer.addHandler("rotate",function(it){Je(it.degrees)})}this.innerTracker.destroy(),this.innerTracker=new ie.MouseTracker({element:this.element,dragHandler:ie.delegate(this,ee),clickHandler:ie.delegate(this,Z),releaseHandler:ie.delegate(this,ae),scrollHandler:ie.delegate(this,ve)}),this.addHandler("reset-size",function(){Xe.viewport&&Xe.viewport.goHome(!0)}),Ye.world.addHandler("item-index-change",function(it){window.setTimeout(function(){var nt=Xe.world.getItemAt(it.previousIndex);Xe.world.setItemIndex(nt,it.newIndex)},1)}),Ye.world.addHandler("remove-item",function(it){var nt=it.item,tt=Xe._getMatchingItem(nt);tt&&Xe.world.removeItem(tt)}),this.update(Ye.viewport)},ie.extend(ie.Navigator.prototype,ie.EventSource.prototype,ie.Viewer.prototype,{updateSize:function(){if(this.viewport){var Ke=new ie.Point(this.container.clientWidth===0?1:this.container.clientWidth,this.container.clientHeight===0?1:this.container.clientHeight);Ke.equals(this.oldContainerSize)||(this.viewport.resize(Ke,!0),this.viewport.goHome(!0),this.oldContainerSize=Ke,this.drawer.clear(),this.world.draw())}},setWidth:function(Ke){this.width=Ke,this.element.style.width=typeof Ke=="number"?Ke+"px":Ke,this._resizeWithViewer=!1},setHeight:function(Ke){this.height=Ke,this.element.style.height=typeof Ke=="number"?Ke+"px":Ke,this._resizeWithViewer=!1},setFlip:function(Ke){return this.viewport.setFlip(Ke),this.setDisplayTransform(this.viewer.viewport.getFlip()?"scale(-1,1)":"scale(1,1)"),this},setDisplayTransform:function(Ke){be(this.displayRegion,Ke),be(this.canvas,Ke),be(this.element,Ke)},update:function(Ke){var Ye,Xe,Qe,et,Je,rt;if(Ye=ie.getElementSize(this.viewer.element),this._resizeWithViewer&&Ye.x&&Ye.y&&!Ye.equals(this.oldViewerSize)&&(this.oldViewerSize=Ye,this.maintainSizeRatio||!this.elementArea?(Xe=Ye.x*this.sizeRatio,Qe=Ye.y*this.sizeRatio):(Xe=Math.sqrt(this.elementArea*(Ye.x/Ye.y)),Qe=this.elementArea/Xe),this.element.style.width=Math.round(Xe)+"px",this.element.style.height=Math.round(Qe)+"px",this.elementArea||(this.elementArea=Xe*Qe),this.updateSize()),Ke&&this.viewport){et=Ke.getBoundsNoRotate(!0),Je=this.viewport.pixelFromPointNoRotate(et.getTopLeft(),!1),rt=this.viewport.pixelFromPointNoRotate(et.getBottomRight(),!1).minus(this.totalBorderWidths);var it=this.displayRegion.style;it.display=this.world.getItemCount()?"block":"none",it.top=Math.round(Je.y)+"px",it.left=Math.round(Je.x)+"px";var nt=Math.abs(Je.x-rt.x),tt=Math.abs(Je.y-rt.y);it.width=Math.round(Math.max(nt,0))+"px",it.height=Math.round(Math.max(tt,0))+"px"}},addTiledImage:function(Ke){var Ye=this,Xe=Ke.originalTiledImage;delete Ke.original;var Qe=ie.extend({},Ke,{success:function(et){var Je=et.item;Je._originalForNavigator=Xe,Ye._matchBounds(Je,Xe,!0);function rt(){Ye._matchBounds(Je,Xe)}function it(){Ye._matchOpacity(Je,Xe)}function nt(){Ye._matchCompositeOperation(Je,Xe)}Xe.addHandler("bounds-change",rt),Xe.addHandler("clip-change",rt),Xe.addHandler("opacity-change",it),Xe.addHandler("composite-operation-change",nt)}});return ie.Viewer.prototype.addTiledImage.apply(this,[Qe])},_getMatchingItem:function(Ke){for(var Ye=this.world.getItemCount(),Xe,Qe=0;Qe<Ye;Qe++)if(Xe=this.world.getItemAt(Qe),Xe._originalForNavigator===Ke)return Xe;return null},_matchBounds:function(Ke,Ye,Xe){var Qe=Ye.getBoundsNoRotate();Ke.setPosition(Qe.getTopLeft(),Xe),Ke.setWidth(Qe.width,Xe),Ke.setRotation(Ye.getRotation(),Xe),Ke.setClip(Ye.getClip())},_matchOpacity:function(Ke,Ye){Ke.setOpacity(Ye.opacity)},_matchCompositeOperation:function(Ke,Ye){Ke.setCompositeOperation(Ye.compositeOperation)}});function Z(Ke){var Ye={tracker:Ke.eventSource,position:Ke.position,quick:Ke.quick,shift:Ke.shift,originalEvent:Ke.originalEvent,preventDefaultAction:Ke.preventDefaultAction};if(this.viewer.raiseEvent("navigator-click",Ye),!Ye.preventDefaultAction&&Ke.quick&&this.viewer.viewport&&(this.panVertical||this.panHorizontal)){this.viewer.viewport.flipped&&(Ke.position.x=this.viewport.getContainerSize().x-Ke.position.x);var Xe=this.viewport.pointFromPixel(Ke.position);this.panVertical?this.panHorizontal||(Xe.x=this.viewer.viewport.getCenter(!0).x):Xe.y=this.viewer.viewport.getCenter(!0).y,this.viewer.viewport.panTo(Xe),this.viewer.viewport.applyConstraints()}}function ee(Ke){var Ye={tracker:Ke.eventSource,position:Ke.position,delta:Ke.delta,speed:Ke.speed,direction:Ke.direction,shift:Ke.shift,originalEvent:Ke.originalEvent,preventDefaultAction:Ke.preventDefaultAction};this.viewer.raiseEvent("navigator-drag",Ye),!Ye.preventDefaultAction&&this.viewer.viewport&&(this.panHorizontal||(Ke.delta.x=0),this.panVertical||(Ke.delta.y=0),this.viewer.viewport.flipped&&(Ke.delta.x=-Ke.delta.x),this.viewer.viewport.panBy(this.viewport.deltaPointsFromPixels(Ke.delta)),this.viewer.constrainDuringPan&&this.viewer.viewport.applyConstraints())}function ae(Ke){Ke.insideElementPressed&&this.viewer.viewport&&this.viewer.viewport.applyConstraints()}function ve(Ke){return this.viewer.raiseEvent("navigator-scroll",{tracker:Ke.eventSource,position:Ke.position,scroll:Ke.scroll,shift:Ke.shift,originalEvent:Ke.originalEvent}),!1}function ye(Ke,Ye){be(Ke,"rotate("+Ye+"deg)")}function be(Ke,Ye){Ke.style.webkitTransform=Ye,Ke.style.mozTransform=Ye,Ke.style.msTransform=Ye,Ke.style.oTransform=Ye,Ke.style.transform=Ye}}(OpenSeadragon),function(ie){var Z={Errors:{Dzc:"Sorry, we don't support Deep Zoom Collections!",Dzi:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Xml:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",ImageFormat:"Sorry, we don't support {0}-based Deep Zoom Images.",Security:"It looks like a security restriction stopped us from loading this Deep Zoom Image.",Status:"This space unintentionally left blank ({0} {1}).",OpenFailed:"Unable to open {0}: {1}"},Tooltips:{FullPage:"Toggle full page",Home:"Go home",ZoomIn:"Zoom in",ZoomOut:"Zoom out",NextPage:"Next page",PreviousPage:"Previous page",RotateLeft:"Rotate left",RotateRight:"Rotate right",Flip:"Flip Horizontally"}};ie.extend(ie,{getString:function(ee){var ae=ee.split("."),ve=null,ye=arguments,be=Z,Ke;for(Ke=0;Ke<ae.length-1;Ke++)be=be[ae[Ke]]||{};return ve=be[ae[Ke]],typeof ve!="string"&&(ie.console.log("Untranslated source string:",ee),ve=""),ve.replace(/\{\d+\}/g,function(Ye){var Xe=parseInt(Ye.match(/\d+/),10)+1;return Xe<ye.length?ye[Xe]:""})},setString:function(ee,ae){var ve=ee.split("."),ye=Z,be;for(be=0;be<ve.length-1;be++)ye[ve[be]]||(ye[ve[be]]={}),ye=ye[ve[be]];ye[ve[be]]=ae}})}(OpenSeadragon),function(ie){ie.Point=function(Z,ee){this.x=typeof Z=="number"?Z:0,this.y=typeof ee=="number"?ee:0},ie.Point.prototype={clone:function(){return new ie.Point(this.x,this.y)},plus:function(Z){return new ie.Point(this.x+Z.x,this.y+Z.y)},minus:function(Z){return new ie.Point(this.x-Z.x,this.y-Z.y)},times:function(Z){return new ie.Point(this.x*Z,this.y*Z)},divide:function(Z){return new ie.Point(this.x/Z,this.y/Z)},negate:function(){return new ie.Point(-this.x,-this.y)},distanceTo:function(Z){return Math.sqrt(Math.pow(this.x-Z.x,2)+Math.pow(this.y-Z.y,2))},squaredDistanceTo:function(Z){return Math.pow(this.x-Z.x,2)+Math.pow(this.y-Z.y,2)},apply:function(Z){return new ie.Point(Z(this.x),Z(this.y))},equals:function(Z){return Z instanceof ie.Point&&this.x===Z.x&&this.y===Z.y},rotate:function(Z,ee){ee=ee||new ie.Point(0,0);var ae,ve;if(Z%90===0){var ye=ie.positiveModulo(Z,360);switch(ye){case 0:ae=1,ve=0;break;case 90:ae=0,ve=1;break;case 180:ae=-1,ve=0;break;case 270:ae=0,ve=-1;break}}else{var be=Z*Math.PI/180;ae=Math.cos(be),ve=Math.sin(be)}var Ke=ae*(this.x-ee.x)-ve*(this.y-ee.y)+ee.x,Ye=ve*(this.x-ee.x)+ae*(this.y-ee.y)+ee.y;return new ie.Point(Ke,Ye)},toString:function(){return"("+Math.round(this.x*100)/100+","+Math.round(this.y*100)/100+")"}}}(OpenSeadragon),function(ie){ie.TileSource=function(ee,ae,ve,ye,be,Ke){var Ye=this,Xe=arguments,Qe,et;if(ie.isPlainObject(ee)?Qe=ee:Qe={width:Xe[0],height:Xe[1],tileSize:Xe[2],tileOverlap:Xe[3],minLevel:Xe[4],maxLevel:Xe[5]},ie.EventSource.call(this),ie.extend(!0,this,Qe),!this.success){for(et=0;et<arguments.length;et++)if(ie.isFunction(arguments[et])){this.success=arguments[et];break}}this.success&&this.addHandler("ready",function(Je){Ye.success(Je)}),ie.type(arguments[0])=="string"&&(this.url=arguments[0]),this.url?(this.aspectRatio=1,this.dimensions=new ie.Point(10,10),this._tileWidth=0,this._tileHeight=0,this.tileOverlap=0,this.minLevel=0,this.maxLevel=0,this.ready=!1,this.getImageInfo(this.url)):(this.ready=!0,this.aspectRatio=Qe.width&&Qe.height?Qe.width/Qe.height:1,this.dimensions=new ie.Point(Qe.width,Qe.height),this.tileSize?(this._tileWidth=this._tileHeight=this.tileSize,delete this.tileSize):(this.tileWidth?(this._tileWidth=this.tileWidth,delete this.tileWidth):this._tileWidth=0,this.tileHeight?(this._tileHeight=this.tileHeight,delete this.tileHeight):this._tileHeight=0),this.tileOverlap=Qe.tileOverlap?Qe.tileOverlap:0,this.minLevel=Qe.minLevel?Qe.minLevel:0,this.maxLevel=Qe.maxLevel!==void 0&&Qe.maxLevel!==null?Qe.maxLevel:Qe.width&&Qe.height?Math.ceil(Math.log(Math.max(Qe.width,Qe.height))/Math.log(2)):0,this.success&&ie.isFunction(this.success)&&this.success(this))},ie.TileSource.prototype={getTileSize:function(ee){return ie.console.error("[TileSource.getTileSize] is deprecated. Use TileSource.getTileWidth() and TileSource.getTileHeight() instead"),this._tileWidth},getTileWidth:function(ee){return this._tileWidth?this._tileWidth:this.getTileSize(ee)},getTileHeight:function(ee){return this._tileHeight?this._tileHeight:this.getTileSize(ee)},getLevelScale:function(ee){var ae={},ve;for(ve=0;ve<=this.maxLevel;ve++)ae[ve]=1/Math.pow(2,this.maxLevel-ve);return this.getLevelScale=function(ye){return ae[ye]},this.getLevelScale(ee)},getNumTiles:function(ee){var ae=this.getLevelScale(ee),ve=Math.ceil(ae*this.dimensions.x/this.getTileWidth(ee)),ye=Math.ceil(ae*this.dimensions.y/this.getTileHeight(ee));return new ie.Point(ve,ye)},getPixelRatio:function(ee){var ae=this.dimensions.times(this.getLevelScale(ee)),ve=1/ae.x,ye=1/ae.y;return new ie.Point(ve,ye)},getClosestLevel:function(){var ee,ae;for(ee=this.minLevel+1;ee<=this.maxLevel&&(ae=this.getNumTiles(ee),!(ae.x>1||ae.y>1));ee++);return ee-1},getTileAtPoint:function(ee,ae){var ve=ae.x>=0&&ae.x<=1&&ae.y>=0&&ae.y<=1/this.aspectRatio;ie.console.assert(ve,"[TileSource.getTileAtPoint] must be called with a valid point.");var ye=this.dimensions.x*this.getLevelScale(ee),be=ae.x*ye,Ke=ae.y*ye,Ye=Math.floor(be/this.getTileWidth(ee)),Xe=Math.floor(Ke/this.getTileHeight(ee));ae.x>=1&&(Ye=this.getNumTiles(ee).x-1);var Qe=1e-15;return ae.y>=1/this.aspectRatio-Qe&&(Xe=this.getNumTiles(ee).y-1),new ie.Point(Ye,Xe)},getTileBounds:function(ee,ae,ve,ye){var be=this.dimensions.times(this.getLevelScale(ee)),Ke=this.getTileWidth(ee),Ye=this.getTileHeight(ee),Xe=ae===0?0:Ke*ae-this.tileOverlap,Qe=ve===0?0:Ye*ve-this.tileOverlap,et=Ke+(ae===0?1:2)*this.tileOverlap,Je=Ye+(ve===0?1:2)*this.tileOverlap,rt=1/be.x;return et=Math.min(et,be.x-Xe),Je=Math.min(Je,be.y-Qe),ye?new ie.Rect(0,0,et,Je):new ie.Rect(Xe*rt,Qe*rt,et*rt,Je*rt)},getImageInfo:function(ee){var ae=this,ve,ye,be,Ke,Ye,Xe,Qe;ee&&(Ye=ee.split("/"),Xe=Ye[Ye.length-1],Qe=Xe.lastIndexOf("."),Qe>-1&&(Ye[Ye.length-1]=Xe.slice(0,Qe))),ye=function(et){typeof et=="string"&&(et=ie.parseXml(et));var Je=ie.TileSource.determineType(ae,et,ee);if(!Je){ae.raiseEvent("open-failed",{message:"Unable to load TileSource",source:ee});return}Ke=Je.prototype.configure.apply(ae,[et,ee]),Ke.ajaxWithCredentials===void 0&&(Ke.ajaxWithCredentials=ae.ajaxWithCredentials),be=new Je(Ke),ae.ready=!0,ae.raiseEvent("ready",{tileSource:be})},ee.match(/\.js$/)?(ve=ee.split("/").pop().replace(".js",""),ie.jsonp({url:ee,async:!1,callbackName:ve,callback:ye})):ie.makeAjaxRequest({url:ee,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,success:function(et){var Je=Z(et);ye(Je)},error:function(et,Je){var rt;try{rt="HTTP "+et.status+" attempting to load TileSource"}catch{var it;typeof Je>"u"||!Je.toString?it="Unknown error":it=Je.toString(),rt=it+" attempting to load TileSource"}ae.raiseEvent("open-failed",{message:rt,source:ee})}})},supports:function(ee,ae){return!1},configure:function(ee,ae){throw new Error("Method not implemented.")},getTileUrl:function(ee,ae,ve){throw new Error("Method not implemented.")},getTileAjaxHeaders:function(ee,ae,ve){return{}},tileExists:function(ee,ae,ve){var ye=this.getNumTiles(ee);return ee>=this.minLevel&&ee<=this.maxLevel&&ae>=0&&ve>=0&&ae<ye.x&&ve<ye.y}},ie.extend(!0,ie.TileSource.prototype,ie.EventSource.prototype);function Z(ee){var ae=ee.responseText,ve=ee.status,ye,be;if(ee){if(ee.status!==200&&ee.status!==0)throw ve=ee.status,ye=ve==404?"Not Found":ee.statusText,new Error(ie.getString("Errors.Status",ve,ye))}else throw new Error(ie.getString("Errors.Security"));if(ae.match(/\s*<.*/))try{be=ee.responseXML&&ee.responseXML.documentElement?ee.responseXML:ie.parseXml(ae)}catch{be=ee.responseText}else if(ae.match(/\s*[\{\[].*/))try{be=ie.parseJSON(ae)}catch{be=ae}else be=ae;return be}ie.TileSource.determineType=function(ee,ae,ve){var ye;for(ye in OpenSeadragon)if(ye.match(/.+TileSource$/)&&ie.isFunction(OpenSeadragon[ye])&&ie.isFunction(OpenSeadragon[ye].prototype.supports)&&OpenSeadragon[ye].prototype.supports.call(ee,ae,ve))return OpenSeadragon[ye];ie.console.error("No TileSource was able to open %s %s",ve,ae)}}(OpenSeadragon),function(ie){ie.DziTileSource=function(ae,ve,ye,be,Ke,Ye,Xe,Qe,et){var Je,rt,it,nt;if(ie.isPlainObject(ae)?nt=ae:nt={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4],fileFormat:arguments[5],displayRects:arguments[6],minLevel:arguments[7],maxLevel:arguments[8]},this._levelRects={},this.tilesUrl=nt.tilesUrl,this.fileFormat=nt.fileFormat,this.displayRects=nt.displayRects,this.displayRects)for(Je=this.displayRects.length-1;Je>=0;Je--)for(rt=this.displayRects[Je],it=rt.minLevel;it<=rt.maxLevel;it++)this._levelRects[it]||(this._levelRects[it]=[]),this._levelRects[it].push(rt);ie.TileSource.apply(this,[nt])},ie.extend(ie.DziTileSource.prototype,ie.TileSource.prototype,{supports:function(ae,ve){var ye;return ae.Image?ye=ae.Image.xmlns:ae.documentElement&&(ae.documentElement.localName=="Image"||ae.documentElement.tagName=="Image")&&(ye=ae.documentElement.namespaceURI),ye=(ye||"").toLowerCase(),ye.indexOf("schemas.microsoft.com/deepzoom/2008")!==-1||ye.indexOf("schemas.microsoft.com/deepzoom/2009")!==-1},configure:function(ae,ve){var ye;return ie.isPlainObject(ae)?ye=ee(this,ae):ye=Z(this,ae),ve&&!ye.tilesUrl&&(ye.tilesUrl=ve.replace(/([^\/]+?)(\.(dzi|xml|js)?(\?[^\/]*)?)?\/?$/,"$1_files/"),ve.search(/\.(dzi|xml|js)\?/)!=-1?ye.queryParams=ve.match(/\?.*/):ye.queryParams=""),ye},getTileUrl:function(ae,ve,ye){return[this.tilesUrl,ae,"/",ve,"_",ye,".",this.fileFormat,this.queryParams].join("")},tileExists:function(ae,ve,ye){var be=this._levelRects[ae],Ke,Ye,Xe,Qe,et,Je,rt;if(this.minLevel&&ae<this.minLevel||this.maxLevel&&ae>this.maxLevel)return!1;if(!be||!be.length)return!0;for(rt=be.length-1;rt>=0;rt--)if(Ke=be[rt],!(ae<Ke.minLevel||ae>Ke.maxLevel)&&(Ye=this.getLevelScale(ae),Xe=Ke.x*Ye,Qe=Ke.y*Ye,et=Xe+Ke.width*Ye,Je=Qe+Ke.height*Ye,Xe=Math.floor(Xe/this._tileWidth),Qe=Math.floor(Qe/this._tileWidth),et=Math.ceil(et/this._tileWidth),Je=Math.ceil(Je/this._tileWidth),Xe<=ve&&ve<et&&Qe<=ye&&ye<Je))return!0;return!1}});function Z(ae,ve){if(!ve||!ve.documentElement)throw new Error(ie.getString("Errors.Xml"));var ye=ve.documentElement,be=ye.localName||ye.tagName,Ke=ve.documentElement.namespaceURI,Ye=null,Xe=[],Qe,et,Je,rt,it;if(be=="Image")try{if(rt=ye.getElementsByTagName("Size")[0],rt===void 0&&(rt=ye.getElementsByTagNameNS(Ke,"Size")[0]),Ye={Image:{xmlns:"http://schemas.microsoft.com/deepzoom/2008",Url:ye.getAttribute("Url"),Format:ye.getAttribute("Format"),DisplayRect:null,Overlap:parseInt(ye.getAttribute("Overlap"),10),TileSize:parseInt(ye.getAttribute("TileSize"),10),Size:{Height:parseInt(rt.getAttribute("Height"),10),Width:parseInt(rt.getAttribute("Width"),10)}}},!ie.imageFormatSupported(Ye.Image.Format))throw new Error(ie.getString("Errors.ImageFormat",Ye.Image.Format.toUpperCase()));for(Qe=ye.getElementsByTagName("DisplayRect"),Qe===void 0&&(Qe=ye.getElementsByTagNameNS(Ke,"DisplayRect")[0]),it=0;it<Qe.length;it++)et=Qe[it],Je=et.getElementsByTagName("Rect")[0],Je===void 0&&(Je=et.getElementsByTagNameNS(Ke,"Rect")[0]),Xe.push({Rect:{X:parseInt(Je.getAttribute("X"),10),Y:parseInt(Je.getAttribute("Y"),10),Width:parseInt(Je.getAttribute("Width"),10),Height:parseInt(Je.getAttribute("Height"),10),MinLevel:parseInt(et.getAttribute("MinLevel"),10),MaxLevel:parseInt(et.getAttribute("MaxLevel"),10)}});return Xe.length&&(Ye.Image.DisplayRect=Xe),ee(ae,Ye)}catch(st){throw st instanceof Error?st:new Error(ie.getString("Errors.Dzi"))}else{if(be=="Collection")throw new Error(ie.getString("Errors.Dzc"));if(be=="Error"){var nt=ye.getElementsByTagName("Message")[0],tt=nt.firstChild.nodeValue;throw new Error(tt)}}throw new Error(ie.getString("Errors.Dzi"))}function ee(ae,ve){var ye=ve.Image,be=ye.Url,Ke=ye.Format,Ye=ye.Size,Xe=ye.DisplayRect||[],Qe=parseInt(Ye.Width,10),et=parseInt(Ye.Height,10),Je=parseInt(ye.TileSize,10),rt=parseInt(ye.Overlap,10),it=[],nt,tt;for(tt=0;tt<Xe.length;tt++)nt=Xe[tt].Rect,it.push(new ie.DisplayRect(parseInt(nt.X,10),parseInt(nt.Y,10),parseInt(nt.Width,10),parseInt(nt.Height,10),parseInt(nt.MinLevel,10),parseInt(nt.MaxLevel,10)));return ie.extend(!0,{width:Qe,height:et,tileSize:Je,tileOverlap:rt,minLevel:null,maxLevel:null,tilesUrl:be,fileFormat:Ke,displayRects:it},ve)}}(OpenSeadragon),function(ie){ie.IIIFTileSource=function(ye){if(ie.extend(!0,this,ye),!(this.height&&this.width&&this["@id"]))throw new Error("IIIF required parameters not provided.");if(ye.tileSizePerScaleFactor={},this.tileFormat=this.tileFormat||"jpg",this.version=ye.version,this.tile_width&&this.tile_height)ye.tileWidth=this.tile_width,ye.tileHeight=this.tile_height;else if(this.tile_width)ye.tileSize=this.tile_width;else if(this.tile_height)ye.tileSize=this.tile_height;else if(this.tiles)if(this.tiles.length==1)ye.tileWidth=this.tiles[0].width,ye.tileHeight=this.tiles[0].height||this.tiles[0].width,this.scale_factors=this.tiles[0].scaleFactors;else{this.scale_factors=[];for(var be=0;be<this.tiles.length;be++)for(var Ke=0;Ke<this.tiles[be].scaleFactors.length;Ke++){var Ye=this.tiles[be].scaleFactors[Ke];this.scale_factors.push(Ye),ye.tileSizePerScaleFactor[Ye]={width:this.tiles[be].width,height:this.tiles[be].height||this.tiles[be].width}}}else if(Z(ye)){for(var Xe=Math.min(this.height,this.width),Qe=[256,512,1024],et=[],Je=0;Je<Qe.length;Je++)Qe[Je]<=Xe&&et.push(Qe[Je]);et.length>0?ye.tileSize=Math.max.apply(null,et):ye.tileSize=Xe}else this.sizes&&this.sizes.length>0?(this.emulateLegacyImagePyramid=!0,ye.levels=ee(this),ie.extend(!0,ye,{width:ye.levels[ye.levels.length-1].width,height:ye.levels[ye.levels.length-1].height,tileSize:Math.max(ye.height,ye.width),tileOverlap:0,minLevel:0,maxLevel:ye.levels.length-1}),this.levels=ye.levels):ie.console.error("Nothing in the info.json to construct image pyramids from");if(!ye.maxLevel&&!this.emulateLegacyImagePyramid)if(!this.scale_factors)ye.maxLevel=Number(Math.ceil(Math.log(Math.max(this.width,this.height),2)));else{var rt=Math.max.apply(null,this.scale_factors);ye.maxLevel=Math.round(Math.log(rt)*Math.LOG2E)}ie.TileSource.apply(this,[ye])},ie.extend(ie.IIIFTileSource.prototype,ie.TileSource.prototype,{supports:function(ye,be){return ye.protocol&&ye.protocol=="http://iiif.io/api/image"||ye["@context"]&&(ye["@context"]=="http://library.stanford.edu/iiif/image-api/1.1/context.json"||ye["@context"]=="http://iiif.io/api/image/1/context.json")||ye.profile&&ye.profile.indexOf("http://library.stanford.edu/iiif/image-api/compliance.html")===0||ye.identifier&&ye.width&&ye.height?!0:!!(ye.documentElement&&ye.documentElement.tagName=="info"&&ye.documentElement.namespaceURI=="http://library.stanford.edu/iiif/image-api/ns/")},configure:function(ye,be){if(ie.isPlainObject(ye)){if(!ye["@context"])ye["@context"]="http://iiif.io/api/image/1.0/context.json",ye["@id"]=be.replace("/info.json",""),ye.version=1;else{var Ye=ye["@context"];if(Array.isArray(Ye)){for(var Xe=0;Xe<Ye.length;Xe++)if(typeof Ye[Xe]=="string"&&(/^http:\/\/iiif\.io\/api\/image\/[1-3]\/context\.json$/.test(Ye[Xe])||Ye[Xe]==="http://library.stanford.edu/iiif/image-api/1.1/context.json")){Ye=Ye[Xe];break}}switch(Ye){case"http://iiif.io/api/image/1/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/context.json":ye.version=1;break;case"http://iiif.io/api/image/2/context.json":ye.version=2;break;case"http://iiif.io/api/image/3/context.json":ye.version=3;break;default:ie.console.error("Data has a @context property which contains no known IIIF context URI.")}}if(!ye["@id"]&&ye.id&&(ye["@id"]=ye.id),ye.preferredFormats){for(var Qe=0;Qe<ye.preferredFormats.length;Qe++)if(OpenSeadragon.imageFormatSupported(ye.preferredFormats[Qe])){ye.tileFormat=ye.preferredFormats[Qe];break}}return ye}else{var Ke=ae(ye);return Ke["@context"]="http://iiif.io/api/image/1.0/context.json",Ke["@id"]=be.replace("/info.xml",""),Ke.version=1,Ke}},getTileWidth:function(ye){if(this.emulateLegacyImagePyramid)return ie.TileSource.prototype.getTileWidth.call(this,ye);var be=Math.pow(2,this.maxLevel-ye);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[be]?this.tileSizePerScaleFactor[be].width:this._tileWidth},getTileHeight:function(ye){if(this.emulateLegacyImagePyramid)return ie.TileSource.prototype.getTileHeight.call(this,ye);var be=Math.pow(2,this.maxLevel-ye);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[be]?this.tileSizePerScaleFactor[be].height:this._tileHeight},getLevelScale:function(ye){if(this.emulateLegacyImagePyramid){var be=NaN;return this.levels.length>0&&ye>=this.minLevel&&ye<=this.maxLevel&&(be=this.levels[ye].width/this.levels[this.maxLevel].width),be}return ie.TileSource.prototype.getLevelScale.call(this,ye)},getNumTiles:function(ye){if(this.emulateLegacyImagePyramid){var be=this.getLevelScale(ye);return be?new ie.Point(1,1):new ie.Point(0,0)}return ie.TileSource.prototype.getNumTiles.call(this,ye)},getTileAtPoint:function(ye,be){return this.emulateLegacyImagePyramid?new ie.Point(0,0):ie.TileSource.prototype.getTileAtPoint.call(this,ye,be)},getTileUrl:function(ye,be,Ke){if(this.emulateLegacyImagePyramid){var Ye=null;return this.levels.length>0&&ye>=this.minLevel&&ye<=this.maxLevel&&(Ye=this.levels[ye].url),Ye}var Xe="0",Qe=Math.pow(.5,this.maxLevel-ye),et=Math.ceil(this.width*Qe),Je=Math.ceil(this.height*Qe),rt,it,nt,tt,st,ot,ut,ft,pt,Xr,mt,Yr,ri,Zr;return rt=this.getTileWidth(ye),it=this.getTileHeight(ye),nt=Math.ceil(rt/Qe),tt=Math.ceil(it/Qe),this.version===1?ri="native."+this.tileFormat:ri="default."+this.tileFormat,et<rt&&Je<it?(this.version===2&&et===this.width||this.version===3&&et===this.width&&Je===this.height?Xr="max":this.version===3?Xr=et+","+Je:Xr=et+",",st="full"):(ot=be*nt,ut=Ke*tt,ft=Math.min(nt,this.width-ot),pt=Math.min(tt,this.height-ut),be===0&&Ke===0&&ft===this.width&&pt===this.height?st="full":st=[ot,ut,ft,pt].join(","),mt=Math.ceil(ft*Qe),Yr=Math.ceil(pt*Qe),this.version===2&&mt===this.width||this.version===3&&mt===this.width&&Yr===this.height?Xr="max":this.version===3?Xr=mt+","+Yr:Xr=mt+","),Zr=[this["@id"],st,Xr,Xe,ri].join("/"),Zr},__testonly__:{canBeTiled:Z,constructLevels:ee}});function Z(ye){var be=["http://library.stanford.edu/iiif/image-api/compliance.html#level0","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0","http://iiif.io/api/image/2/level0.json","level0","https://iiif.io/api/image/3/level0.json"],Ke=Array.isArray(ye.profile)?ye.profile[0]:ye.profile,Ye=be.indexOf(Ke)!==-1,Xe=!1;return ye.version===2&&ye.profile.length>1&&ye.profile[1].supports&&(Xe=ye.profile[1].supports.indexOf("sizeByW")!==-1),ye.version===3&&ye.extraFeatures&&(Xe=ye.extraFeatures.indexOf("sizeByWh")!==-1),!Ye||Xe}function ee(ye){for(var be=[],Ke=0;Ke<ye.sizes.length;Ke++)be.push({url:ye["@id"]+"/full/"+ye.sizes[Ke].width+","+(ye.version===3?ye.sizes[Ke].height:"")+"/0/default."+ye.tileFormat,width:ye.sizes[Ke].width,height:ye.sizes[Ke].height});return be.sort(function(Ye,Xe){return Ye.width-Xe.width})}function ae(ye){if(!ye||!ye.documentElement)throw new Error(ie.getString("Errors.Xml"));var be=ye.documentElement,Ke=be.tagName,Ye=null;if(Ke=="info")try{return Ye={},ve(be,Ye),Ye}catch(Xe){throw Xe instanceof Error?Xe:new Error(ie.getString("Errors.IIIF"))}throw new Error(ie.getString("Errors.IIIF"))}function ve(ye,be,Ke){var Ye,Xe;if(ye.nodeType==3&&Ke)Xe=ye.nodeValue.trim(),Xe.match(/^\d*$/)&&(Xe=Number(Xe)),be[Ke]?(ie.isArray(be[Ke])||(be[Ke]=[be[Ke]]),be[Ke].push(Xe)):be[Ke]=Xe;else if(ye.nodeType==1)for(Ye=0;Ye<ye.childNodes.length;Ye++)ve(ye.childNodes[Ye],be,ye.nodeName)}}(OpenSeadragon),function(ie){ie.OsmTileSource=function(Z,ee,ae,ve,ye){var be;ie.isPlainObject(Z)?be=Z:be={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]},(!be.width||!be.height)&&(be.width=65572864,be.height=65572864),be.tileSize||(be.tileSize=256,be.tileOverlap=0),be.tilesUrl||(be.tilesUrl="http://tile.openstreetmap.org/"),be.minLevel=8,ie.TileSource.apply(this,[be])},ie.extend(ie.OsmTileSource.prototype,ie.TileSource.prototype,{supports:function(Z,ee){return Z.type&&Z.type=="openstreetmaps"},configure:function(Z,ee){return Z},getTileUrl:function(Z,ee,ae){return this.tilesUrl+(Z-8)+"/"+ee+"/"+ae+".png"}})}(OpenSeadragon),function(ie){ie.TmsTileSource=function(Z,ee,ae,ve,ye){var be;ie.isPlainObject(Z)?be=Z:be={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]};var Ke=Math.ceil(be.width/256)*256,Ye=Math.ceil(be.height/256)*256,Xe;Ke>Ye?Xe=Ke/256:Xe=Ye/256,be.maxLevel=Math.ceil(Math.log(Xe)/Math.log(2))-1,be.tileSize=256,be.width=Ke,be.height=Ye,ie.TileSource.apply(this,[be])},ie.extend(ie.TmsTileSource.prototype,ie.TileSource.prototype,{supports:function(Z,ee){return Z.type&&Z.type=="tiledmapservice"},configure:function(Z,ee){return Z},getTileUrl:function(Z,ee,ae){var ve=this.getNumTiles(Z).y-1;return this.tilesUrl+Z+"/"+ee+"/"+(ve-ae)+".png"}})}(OpenSeadragon),function(ie){ie.ZoomifyTileSource=function(Z){Z.tileSize=256;var ee={x:Z.width,y:Z.height};for(Z.imageSizes=[{x:Z.width,y:Z.height}],Z.gridSize=[this._getGridSize(Z.width,Z.height,Z.tileSize)];parseInt(ee.x,10)>Z.tileSize||parseInt(ee.y,10)>Z.tileSize;)ee.x=Math.floor(ee.x/2),ee.y=Math.floor(ee.y/2),Z.imageSizes.push({x:ee.x,y:ee.y}),Z.gridSize.push(this._getGridSize(ee.x,ee.y,Z.tileSize));Z.imageSizes.reverse(),Z.gridSize.reverse(),Z.minLevel=0,Z.maxLevel=Z.gridSize.length-1,OpenSeadragon.TileSource.apply(this,[Z])},ie.extend(ie.ZoomifyTileSource.prototype,ie.TileSource.prototype,{_getGridSize:function(Z,ee,ae){return{x:Math.ceil(Z/ae),y:Math.ceil(ee/ae)}},_calculateAbsoluteTileNumber:function(Z,ee,ae){for(var ve=0,ye={},be=0;be<Z;be++)ye=this.gridSize[be],ve+=ye.x*ye.y;return ye=this.gridSize[Z],ve+=ye.x*ae+ee,ve},supports:function(Z,ee){return Z.type&&Z.type=="zoomifytileservice"},configure:function(Z,ee){return Z},getTileUrl:function(Z,ee,ae){var ve=0,ye=this._calculateAbsoluteTileNumber(Z,ee,ae);return ve=Math.floor(ye/256),this.tilesUrl+"TileGroup"+ve+"/"+Z+"-"+ee+"-"+ae+".jpg"}})}(OpenSeadragon),function(ie){ie.LegacyTileSource=function(ve){var ye,be,Ke;ie.isArray(ve)&&(ye={type:"legacy-image-pyramid",levels:ve}),ye.levels=Z(ye.levels),ye.levels.length>0?(be=ye.levels[ye.levels.length-1].width,Ke=ye.levels[ye.levels.length-1].height):(be=0,Ke=0,ie.console.error("No supported image formats found")),ie.extend(!0,ye,{width:be,height:Ke,tileSize:Math.max(Ke,be),tileOverlap:0,minLevel:0,maxLevel:ye.levels.length>0?ye.levels.length-1:0}),ie.TileSource.apply(this,[ye]),this.levels=ye.levels},ie.extend(ie.LegacyTileSource.prototype,ie.TileSource.prototype,{supports:function(ve,ye){return ve.type&&ve.type=="legacy-image-pyramid"||ve.documentElement&&ve.documentElement.getAttribute("type")=="legacy-image-pyramid"},configure:function(ve,ye){var be;return ie.isPlainObject(ve)?be=ae(this,ve):be=ee(this,ve),be},getLevelScale:function(ve){var ye=NaN;return this.levels.length>0&&ve>=this.minLevel&&ve<=this.maxLevel&&(ye=this.levels[ve].width/this.levels[this.maxLevel].width),ye},getNumTiles:function(ve){var ye=this.getLevelScale(ve);return ye?new ie.Point(1,1):new ie.Point(0,0)},getTileUrl:function(ve,ye,be){var Ke=null;return this.levels.length>0&&ve>=this.minLevel&&ve<=this.maxLevel&&(Ke=this.levels[ve].url),Ke}});function Z(ve){var ye=[],be,Ke;for(Ke=0;Ke<ve.length;Ke++)be=ve[Ke],be.height&&be.width&&be.url?ye.push({url:be.url,width:Number(be.width),height:Number(be.height)}):ie.console.error("Unsupported image format: %s",be.url?be.url:"<no URL>");return ye.sort(function(Ye,Xe){return Ye.height-Xe.height})}function ee(ve,ye){if(!ye||!ye.documentElement)throw new Error(ie.getString("Errors.Xml"));var be=ye.documentElement,Ke=be.tagName,Ye=null,Xe=[],Qe,et;if(Ke=="image")try{for(Ye={type:be.getAttribute("type"),levels:[]},Xe=be.getElementsByTagName("level"),et=0;et<Xe.length;et++)Qe=Xe[et],Ye.levels.push({url:Qe.getAttribute("url"),width:parseInt(Qe.getAttribute("width"),10),height:parseInt(Qe.getAttribute("height"),10)});return ae(ve,Ye)}catch(Je){throw Je instanceof Error?Je:new Error("Unknown error parsing Legacy Image Pyramid XML.")}else{if(Ke=="collection")throw new Error("Legacy Image Pyramid Collections not yet supported.");if(Ke=="error")throw new Error("Error: "+ye)}throw new Error("Unknown element "+Ke)}function ae(ve,ye){return ye.levels}}(OpenSeadragon),function(ie){ie.ImageTileSource=function(Z){Z=ie.extend({buildPyramid:!0,crossOriginPolicy:!1,ajaxWithCredentials:!1,useCanvas:!0},Z),ie.TileSource.apply(this,[Z])},ie.extend(ie.ImageTileSource.prototype,ie.TileSource.prototype,{supports:function(Z,ee){return Z.type&&Z.type==="image"},configure:function(Z,ee){return Z},getImageInfo:function(Z){var ee=this._image=new Image,ae=this;this.crossOriginPolicy&&(ee.crossOrigin=this.crossOriginPolicy),this.ajaxWithCredentials&&(ee.useCredentials=this.ajaxWithCredentials),ie.addEvent(ee,"load",function(){ae.width=Object.prototype.hasOwnProperty.call(ee,"naturalWidth")?ee.naturalWidth:ee.width,ae.height=Object.prototype.hasOwnProperty.call(ee,"naturalHeight")?ee.naturalHeight:ee.height,ae.aspectRatio=ae.width/ae.height,ae.dimensions=new ie.Point(ae.width,ae.height),ae._tileWidth=ae.width,ae._tileHeight=ae.height,ae.tileOverlap=0,ae.minLevel=0,ae.levels=ae._buildLevels(),ae.maxLevel=ae.levels.length-1,ae.ready=!0,ae.raiseEvent("ready",{tileSource:ae})}),ie.addEvent(ee,"error",function(){ae.raiseEvent("open-failed",{message:"Error loading image at "+Z,source:Z})}),ee.src=Z},getLevelScale:function(Z){var ee=NaN;return Z>=this.minLevel&&Z<=this.maxLevel&&(ee=this.levels[Z].width/this.levels[this.maxLevel].width),ee},getNumTiles:function(Z){var ee=this.getLevelScale(Z);return ee?new ie.Point(1,1):new ie.Point(0,0)},getTileUrl:function(Z,ee,ae){var ve=null;return Z>=this.minLevel&&Z<=this.maxLevel&&(ve=this.levels[Z].url),ve},getContext2D:function(Z,ee,ae){var ve=null;return Z>=this.minLevel&&Z<=this.maxLevel&&(ve=this.levels[Z].context2D),ve},_buildLevels:function(){var Z=[{url:this._image.src,width:Object.prototype.hasOwnProperty.call(this._image,"naturalWidth")?this._image.naturalWidth:this._image.width,height:Object.prototype.hasOwnProperty.call(this._image,"naturalHeight")?this._image.naturalHeight:this._image.height}];if(!this.buildPyramid||!ie.supportsCanvas||!this.useCanvas)return delete this._image,Z;var ee=Object.prototype.hasOwnProperty.call(this._image,"naturalWidth")?this._image.naturalWidth:this._image.width,ae=Object.prototype.hasOwnProperty.call(this._image,"naturalHeight")?this._image.naturalHeight:this._image.height,ve=document.createElement("canvas"),ye=ve.getContext("2d");if(ve.width=ee,ve.height=ae,ye.drawImage(this._image,0,0,ee,ae),Z[0].context2D=ye,delete this._image,ie.isCanvasTainted(ve))return Z;for(;ee>=2&&ae>=2;){ee=Math.floor(ee/2),ae=Math.floor(ae/2);var be=document.createElement("canvas"),Ke=be.getContext("2d");be.width=ee,be.height=ae,Ke.drawImage(ve,0,0,ee,ae),Z.splice(0,0,{context2D:Ke,width:ee,height:ae}),ve=be,ye=Ke}return Z}})}(OpenSeadragon),function(ie){ie.TileSourceCollection=function(Z,ee,ae,ve){ie.console.error("TileSourceCollection is deprecated; use World instead")}}(OpenSeadragon),function(ie){ie.ButtonState={REST:0,GROUP:1,HOVER:2,DOWN:3},ie.Button=function(Ke){var Ye=this;ie.EventSource.call(this),ie.extend(!0,this,{tooltip:null,srcRest:null,srcGroup:null,srcHover:null,srcDown:null,clickTimeThreshold:ie.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:ie.DEFAULT_SETTINGS.clickDistThreshold,fadeDelay:0,fadeLength:2e3,onPress:null,onRelease:null,onClick:null,onEnter:null,onExit:null,onFocus:null,onBlur:null},Ke),this.element=Ke.element||ie.makeNeutralElement("div"),Ke.element||(this.imgRest=ie.makeTransparentImage(this.srcRest),this.imgGroup=ie.makeTransparentImage(this.srcGroup),this.imgHover=ie.makeTransparentImage(this.srcHover),this.imgDown=ie.makeTransparentImage(this.srcDown),this.imgRest.alt=this.imgGroup.alt=this.imgHover.alt=this.imgDown.alt=this.tooltip,this.element.style.position="relative",ie.setElementTouchActionNone(this.element),this.imgGroup.style.position=this.imgHover.style.position=this.imgDown.style.position="absolute",this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="0px",this.imgGroup.style.left=this.imgHover.style.left=this.imgDown.style.left="0px",this.imgHover.style.visibility=this.imgDown.style.visibility="hidden",ie.Browser.vendor==ie.BROWSERS.FIREFOX&&ie.Browser.version<3&&(this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top=""),this.element.appendChild(this.imgRest),this.element.appendChild(this.imgGroup),this.element.appendChild(this.imgHover),this.element.appendChild(this.imgDown)),this.addHandler("press",this.onPress),this.addHandler("release",this.onRelease),this.addHandler("click",this.onClick),this.addHandler("enter",this.onEnter),this.addHandler("exit",this.onExit),this.addHandler("focus",this.onFocus),this.addHandler("blur",this.onBlur),this.currentState=ie.ButtonState.GROUP,this.fadeBeginTime=null,this.shouldFade=!1,this.element.style.display="inline-block",this.element.style.position="relative",this.element.title=this.tooltip,this.tracker=new ie.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(Xe){Xe.insideElementPressed?(ye(Ye,ie.ButtonState.DOWN),Ye.raiseEvent("enter",{originalEvent:Xe.originalEvent})):Xe.buttonDownAny||ye(Ye,ie.ButtonState.HOVER)},focusHandler:function(Xe){this.enterHandler(Xe),Ye.raiseEvent("focus",{originalEvent:Xe.originalEvent})},exitHandler:function(Xe){be(Ye,ie.ButtonState.GROUP),Xe.insideElementPressed&&Ye.raiseEvent("exit",{originalEvent:Xe.originalEvent})},blurHandler:function(Xe){this.exitHandler(Xe),Ye.raiseEvent("blur",{originalEvent:Xe.originalEvent})},pressHandler:function(Xe){ye(Ye,ie.ButtonState.DOWN),Ye.raiseEvent("press",{originalEvent:Xe.originalEvent})},releaseHandler:function(Xe){Xe.insideElementPressed&&Xe.insideElementReleased?(be(Ye,ie.ButtonState.HOVER),Ye.raiseEvent("release",{originalEvent:Xe.originalEvent})):Xe.insideElementPressed?be(Ye,ie.ButtonState.GROUP):ye(Ye,ie.ButtonState.HOVER)},clickHandler:function(Xe){Xe.quick&&Ye.raiseEvent("click",{originalEvent:Xe.originalEvent})},keyHandler:function(Xe){return Xe.keyCode===13?(Ye.raiseEvent("click",{originalEvent:Xe.originalEvent}),Ye.raiseEvent("release",{originalEvent:Xe.originalEvent}),!1):!0}}),be(this,ie.ButtonState.REST)},ie.extend(ie.Button.prototype,ie.EventSource.prototype,{notifyGroupEnter:function(){ye(this,ie.ButtonState.GROUP)},notifyGroupExit:function(){be(this,ie.ButtonState.REST)},disable:function(){this.notifyGroupExit(),this.element.disabled=!0,ie.setElementOpacity(this.element,.2,!0)},enable:function(){this.element.disabled=!1,ie.setElementOpacity(this.element,1,!0),this.notifyGroupEnter()}});function Z(Ke){ie.requestAnimationFrame(function(){ee(Ke)})}function ee(Ke){var Ye,Xe,Qe;Ke.shouldFade&&(Ye=ie.now(),Xe=Ye-Ke.fadeBeginTime,Qe=1-Xe/Ke.fadeLength,Qe=Math.min(1,Qe),Qe=Math.max(0,Qe),Ke.imgGroup&&ie.setElementOpacity(Ke.imgGroup,Qe,!0),Qe>0&&Z(Ke))}function ae(Ke){Ke.shouldFade=!0,Ke.fadeBeginTime=ie.now()+Ke.fadeDelay,window.setTimeout(function(){Z(Ke)},Ke.fadeDelay)}function ve(Ke){Ke.shouldFade=!1,Ke.imgGroup&&ie.setElementOpacity(Ke.imgGroup,1,!0)}function ye(Ke,Ye){Ke.element.disabled||(Ye>=ie.ButtonState.GROUP&&Ke.currentState==ie.ButtonState.REST&&(ve(Ke),Ke.currentState=ie.ButtonState.GROUP),Ye>=ie.ButtonState.HOVER&&Ke.currentState==ie.ButtonState.GROUP&&(Ke.imgHover&&(Ke.imgHover.style.visibility=""),Ke.currentState=ie.ButtonState.HOVER),Ye>=ie.ButtonState.DOWN&&Ke.currentState==ie.ButtonState.HOVER&&(Ke.imgDown&&(Ke.imgDown.style.visibility=""),Ke.currentState=ie.ButtonState.DOWN))}function be(Ke,Ye){Ke.element.disabled||(Ye<=ie.ButtonState.HOVER&&Ke.currentState==ie.ButtonState.DOWN&&(Ke.imgDown&&(Ke.imgDown.style.visibility="hidden"),Ke.currentState=ie.ButtonState.HOVER),Ye<=ie.ButtonState.GROUP&&Ke.currentState==ie.ButtonState.HOVER&&(Ke.imgHover&&(Ke.imgHover.style.visibility="hidden"),Ke.currentState=ie.ButtonState.GROUP),Ye<=ie.ButtonState.REST&&Ke.currentState==ie.ButtonState.GROUP&&(ae(Ke),Ke.currentState=ie.ButtonState.REST))}}(OpenSeadragon),function(ie){ie.ButtonGroup=function(Z){ie.extend(!0,this,{buttons:[],clickTimeThreshold:ie.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:ie.DEFAULT_SETTINGS.clickDistThreshold,labelText:""},Z);var ee=this.buttons.concat([]),ae=this,ve;if(this.element=Z.element||ie.makeNeutralElement("div"),!Z.group)for(this.element.style.display="inline-block",ve=0;ve<ee.length;ve++)this.element.appendChild(ee[ve].element);ie.setElementTouchActionNone(this.element),this.tracker=new ie.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(ye){var be;for(be=0;be<ae.buttons.length;be++)ae.buttons[be].notifyGroupEnter()},exitHandler:function(ye){var be;if(!ye.insideElementPressed)for(be=0;be<ae.buttons.length;be++)ae.buttons[be].notifyGroupExit()}})},ie.ButtonGroup.prototype={emulateEnter:function(){this.tracker.enterHandler({eventSource:this.tracker})},emulateExit:function(){this.tracker.exitHandler({eventSource:this.tracker})}}}(OpenSeadragon),function(ie){ie.Rect=function(Z,ee,ae,ve,ye){this.x=typeof Z=="number"?Z:0,this.y=typeof ee=="number"?ee:0,this.width=typeof ae=="number"?ae:0,this.height=typeof ve=="number"?ve:0,this.degrees=typeof ye=="number"?ye:0,this.degrees=ie.positiveModulo(this.degrees,360);var be,Ke;this.degrees>=270?(be=this.getTopRight(),this.x=be.x,this.y=be.y,Ke=this.height,this.height=this.width,this.width=Ke,this.degrees-=270):this.degrees>=180?(be=this.getBottomRight(),this.x=be.x,this.y=be.y,this.degrees-=180):this.degrees>=90&&(be=this.getBottomLeft(),this.x=be.x,this.y=be.y,Ke=this.height,this.height=this.width,this.width=Ke,this.degrees-=90)},ie.Rect.fromSummits=function(Z,ee,ae){var ve=Z.distanceTo(ee),ye=Z.distanceTo(ae),be=ee.minus(Z),Ke=Math.atan(be.y/be.x);return be.x<0?Ke+=Math.PI:be.y<0&&(Ke+=2*Math.PI),new ie.Rect(Z.x,Z.y,ve,ye,Ke/Math.PI*180)},ie.Rect.prototype={clone:function(){return new ie.Rect(this.x,this.y,this.width,this.height,this.degrees)},getAspectRatio:function(){return this.width/this.height},getTopLeft:function(){return new ie.Point(this.x,this.y)},getBottomRight:function(){return new ie.Point(this.x+this.width,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getTopRight:function(){return new ie.Point(this.x+this.width,this.y).rotate(this.degrees,this.getTopLeft())},getBottomLeft:function(){return new ie.Point(this.x,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getCenter:function(){return new ie.Point(this.x+this.width/2,this.y+this.height/2).rotate(this.degrees,this.getTopLeft())},getSize:function(){return new ie.Point(this.width,this.height)},equals:function(Z){return Z instanceof ie.Rect&&this.x===Z.x&&this.y===Z.y&&this.width===Z.width&&this.height===Z.height&&this.degrees===Z.degrees},times:function(Z){return new ie.Rect(this.x*Z,this.y*Z,this.width*Z,this.height*Z,this.degrees)},translate:function(Z){return new ie.Rect(this.x+Z.x,this.y+Z.y,this.width,this.height,this.degrees)},union:function(Z){var ee=this.getBoundingBox(),ae=Z.getBoundingBox(),ve=Math.min(ee.x,ae.x),ye=Math.min(ee.y,ae.y),be=Math.max(ee.x+ee.width,ae.x+ae.width),Ke=Math.max(ee.y+ee.height,ae.y+ae.height);return new ie.Rect(ve,ye,be-ve,Ke-ye)},intersection:function(Z){var ee=1e-10,ae=[],ve=this.getTopLeft();Z.containsPoint(ve,ee)&&ae.push(ve);var ye=this.getTopRight();Z.containsPoint(ye,ee)&&ae.push(ye);var be=this.getBottomLeft();Z.containsPoint(be,ee)&&ae.push(be);var Ke=this.getBottomRight();Z.containsPoint(Ke,ee)&&ae.push(Ke);var Ye=Z.getTopLeft();this.containsPoint(Ye,ee)&&ae.push(Ye);var Xe=Z.getTopRight();this.containsPoint(Xe,ee)&&ae.push(Xe);var Qe=Z.getBottomLeft();this.containsPoint(Qe,ee)&&ae.push(Qe);var et=Z.getBottomRight();this.containsPoint(et,ee)&&ae.push(et);for(var Je=this._getSegments(),rt=Z._getSegments(),it=0;it<Je.length;it++)for(var nt=Je[it],tt=0;tt<rt.length;tt++){var st=rt[tt],ot=ut(nt[0],nt[1],st[0],st[1]);ot&&ae.push(ot)}function ut(Zr,_r,Kr,si){var oi=_r.minus(Zr),Qr=si.minus(Kr),ii=-Qr.x*oi.y+oi.x*Qr.y;if(ii===0)return null;var ti=(oi.x*(Zr.y-Kr.y)-oi.y*(Zr.x-Kr.x))/ii,ni=(Qr.x*(Zr.y-Kr.y)-Qr.y*(Zr.x-Kr.x))/ii;return-ee<=ti&&ti<=1-ee&&-ee<=ni&&ni<=1-ee?new ie.Point(Zr.x+ni*oi.x,Zr.y+ni*oi.y):null}if(ae.length===0)return null;for(var ft=ae[0].x,pt=ae[0].x,Xr=ae[0].y,mt=ae[0].y,Yr=1;Yr<ae.length;Yr++){var ri=ae[Yr];ri.x<ft&&(ft=ri.x),ri.x>pt&&(pt=ri.x),ri.y<Xr&&(Xr=ri.y),ri.y>mt&&(mt=ri.y)}return new ie.Rect(ft,Xr,pt-ft,mt-Xr)},_getSegments:function(){var Z=this.getTopLeft(),ee=this.getTopRight(),ae=this.getBottomLeft(),ve=this.getBottomRight();return[[Z,ee],[ee,ve],[ve,ae],[ae,Z]]},rotate:function(Z,ee){if(Z=ie.positiveModulo(Z,360),Z===0)return this.clone();ee=ee||this.getCenter();var ae=this.getTopLeft().rotate(Z,ee),ve=this.getTopRight().rotate(Z,ee),ye=ve.minus(ae);ye=ye.apply(function(Ke){var Ye=1e-15;return Math.abs(Ke)<Ye?0:Ke});var be=Math.atan(ye.y/ye.x);return ye.x<0?be+=Math.PI:ye.y<0&&(be+=2*Math.PI),new ie.Rect(ae.x,ae.y,this.width,this.height,be/Math.PI*180)},getBoundingBox:function(){if(this.degrees===0)return this.clone();var Z=this.getTopLeft(),ee=this.getTopRight(),ae=this.getBottomLeft(),ve=this.getBottomRight(),ye=Math.min(Z.x,ee.x,ae.x,ve.x),be=Math.max(Z.x,ee.x,ae.x,ve.x),Ke=Math.min(Z.y,ee.y,ae.y,ve.y),Ye=Math.max(Z.y,ee.y,ae.y,ve.y);return new ie.Rect(ye,Ke,be-ye,Ye-Ke)},getIntegerBoundingBox:function(){var Z=this.getBoundingBox(),ee=Math.floor(Z.x),ae=Math.floor(Z.y),ve=Math.ceil(Z.width+Z.x-ee),ye=Math.ceil(Z.height+Z.y-ae);return new ie.Rect(ee,ae,ve,ye)},containsPoint:function(Z,ee){ee=ee||0;var ae=this.getTopLeft(),ve=this.getTopRight(),ye=this.getBottomLeft(),be=ve.minus(ae),Ke=ye.minus(ae);return(Z.x-ae.x)*be.x+(Z.y-ae.y)*be.y>=-ee&&(Z.x-ve.x)*be.x+(Z.y-ve.y)*be.y<=ee&&(Z.x-ae.x)*Ke.x+(Z.y-ae.y)*Ke.y>=-ee&&(Z.x-ye.x)*Ke.x+(Z.y-ye.y)*Ke.y<=ee},toString:function(){return"["+Math.round(this.x*100)/100+", "+Math.round(this.y*100)/100+", "+Math.round(this.width*100)/100+"x"+Math.round(this.height*100)/100+", "+Math.round(this.degrees*100)/100+"deg]"}}}(OpenSeadragon),function(ie){var Z={};ie.ReferenceStrip=function(Xe){var Qe=this,et=Xe.viewer,Je=ie.getElementSize(et.element),rt,it,nt;for(Xe.id||(Xe.id="referencestrip-"+ie.now(),this.element=ie.makeNeutralElement("div"),this.element.id=Xe.id,this.element.className="referencestrip"),Xe=ie.extend(!0,{sizeRatio:ie.DEFAULT_SETTINGS.referenceStripSizeRatio,position:ie.DEFAULT_SETTINGS.referenceStripPosition,scroll:ie.DEFAULT_SETTINGS.referenceStripScroll,clickTimeThreshold:ie.DEFAULT_SETTINGS.clickTimeThreshold},Xe,{element:this.element,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1}),ie.extend(this,Xe),Z[this.id]={animating:!1},this.minPixelRatio=this.viewer.minPixelRatio,it=this.element.style,it.marginTop="0px",it.marginRight="0px",it.marginBottom="0px",it.marginLeft="0px",it.left="0px",it.bottom="0px",it.border="0px",it.background="#000",it.position="relative",ie.setElementTouchActionNone(this.element),ie.setElementOpacity(this.element,.8),this.viewer=et,this.innerTracker=new ie.MouseTracker({element:this.element,dragHandler:ie.delegate(this,ee),scrollHandler:ie.delegate(this,ae),enterHandler:ie.delegate(this,ye),exitHandler:ie.delegate(this,be),keyDownHandler:ie.delegate(this,Ke),keyHandler:ie.delegate(this,Ye)}),Xe.width&&Xe.height?(this.element.style.width=Xe.width+"px",this.element.style.height=Xe.height+"px",et.addControl(this.element,{anchor:ie.ControlAnchor.BOTTOM_LEFT})):Xe.scroll=="horizontal"?(this.element.style.width=Je.x*Xe.sizeRatio*et.tileSources.length+12*et.tileSources.length+"px",this.element.style.height=Je.y*Xe.sizeRatio+"px",et.addControl(this.element,{anchor:ie.ControlAnchor.BOTTOM_LEFT})):(this.element.style.height=Je.y*Xe.sizeRatio*et.tileSources.length+12*et.tileSources.length+"px",this.element.style.width=Je.x*Xe.sizeRatio+"px",et.addControl(this.element,{anchor:ie.ControlAnchor.TOP_LEFT})),this.panelWidth=Je.x*this.sizeRatio+8,this.panelHeight=Je.y*this.sizeRatio+8,this.panels=[],this.miniViewers={},nt=0;nt<et.tileSources.length;nt++)rt=ie.makeNeutralElement("div"),rt.id=this.element.id+"-"+nt,rt.style.width=Qe.panelWidth+"px",rt.style.height=Qe.panelHeight+"px",rt.style.display="inline",rt.style.float="left",rt.style.cssFloat="left",rt.style.styleFloat="left",rt.style.padding="2px",ie.setElementTouchActionNone(rt),rt.innerTracker=new ie.MouseTracker({element:rt,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,pressHandler:function(tt){tt.eventSource.dragging=ie.now()},releaseHandler:function(tt){var st=tt.eventSource,ot=st.element.id,ut=Number(ot.split("-")[2]),ft=ie.now();tt.insideElementPressed&&tt.insideElementReleased&&st.dragging&&ft-st.dragging<st.clickTimeThreshold&&(st.dragging=null,et.goToPage(ut))}}),this.element.appendChild(rt),rt.activePanel=!1,this.panels.push(rt);ve(this,this.scroll=="vertical"?Je.y:Je.x,0),this.setFocus(0)},ie.extend(ie.ReferenceStrip.prototype,ie.EventSource.prototype,ie.Viewer.prototype,{setFocus:function(Xe){var Qe=this.element.querySelector("#"+this.element.id+"-"+Xe),et=ie.getElementSize(this.viewer.canvas),Je=Number(this.element.style.width.replace("px","")),rt=Number(this.element.style.height.replace("px","")),it=-Number(this.element.style.marginLeft.replace("px","")),nt=-Number(this.element.style.marginTop.replace("px","")),tt;this.currentSelected!==Qe&&(this.currentSelected&&(this.currentSelected.style.background="#000"),this.currentSelected=Qe,this.currentSelected.style.background="#999",this.scroll=="horizontal"?(tt=Number(Xe)*(this.panelWidth+3),tt>it+et.x-this.panelWidth?(tt=Math.min(tt,Je-et.x),this.element.style.marginLeft=-tt+"px",ve(this,et.x,-tt)):tt<it&&(tt=Math.max(0,tt-et.x/2),this.element.style.marginLeft=-tt+"px",ve(this,et.x,-tt))):(tt=Number(Xe)*(this.panelHeight+3),tt>nt+et.y-this.panelHeight?(tt=Math.min(tt,rt-et.y),this.element.style.marginTop=-tt+"px",ve(this,et.y,-tt)):tt<nt&&(tt=Math.max(0,tt-et.y/2),this.element.style.marginTop=-tt+"px",ve(this,et.y,-tt))),this.currentPage=Xe,ye.call(this,{eventSource:this.innerTracker}))},update:function(){return Z[this.id].animating?(ie.console.log("image reference strip update"),!0):!1},destroy:function(){if(this.miniViewers)for(var Xe in this.miniViewers)this.miniViewers[Xe].destroy();this.element&&this.element.parentNode.removeChild(this.element)}});function ee(Xe){var Qe=Number(this.element.style.marginLeft.replace("px","")),et=Number(this.element.style.marginTop.replace("px","")),Je=Number(this.element.style.width.replace("px","")),rt=Number(this.element.style.height.replace("px","")),it=ie.getElementSize(this.viewer.canvas);return this.dragging=!0,this.element&&(this.scroll=="horizontal"?-Xe.delta.x>0?Qe>-(Je-it.x)&&(this.element.style.marginLeft=Qe+Xe.delta.x*2+"px",ve(this,it.x,Qe+Xe.delta.x*2)):-Xe.delta.x<0&&Qe<0&&(this.element.style.marginLeft=Qe+Xe.delta.x*2+"px",ve(this,it.x,Qe+Xe.delta.x*2)):-Xe.delta.y>0?et>-(rt-it.y)&&(this.element.style.marginTop=et+Xe.delta.y*2+"px",ve(this,it.y,et+Xe.delta.y*2)):-Xe.delta.y<0&&et<0&&(this.element.style.marginTop=et+Xe.delta.y*2+"px",ve(this,it.y,et+Xe.delta.y*2))),!1}function ae(Xe){var Qe=Number(this.element.style.marginLeft.replace("px","")),et=Number(this.element.style.marginTop.replace("px","")),Je=Number(this.element.style.width.replace("px","")),rt=Number(this.element.style.height.replace("px","")),it=ie.getElementSize(this.viewer.canvas);return this.element&&(this.scroll=="horizontal"?Xe.scroll>0?Qe>-(Je-it.x)&&(this.element.style.marginLeft=Qe-Xe.scroll*60+"px",ve(this,it.x,Qe-Xe.scroll*60)):Xe.scroll<0&&Qe<0&&(this.element.style.marginLeft=Qe-Xe.scroll*60+"px",ve(this,it.x,Qe-Xe.scroll*60)):Xe.scroll<0?et>it.y-rt&&(this.element.style.marginTop=et+Xe.scroll*60+"px",ve(this,it.y,et+Xe.scroll*60)):Xe.scroll>0&&et<0&&(this.element.style.marginTop=et+Xe.scroll*60+"px",ve(this,it.y,et+Xe.scroll*60))),!1}function ve(Xe,Qe,et){var Je,rt,it,nt,tt,st,ot;for(Xe.scroll=="horizontal"?Je=Xe.panelWidth:Je=Xe.panelHeight,rt=Math.ceil(Qe/Je)+5,it=Math.ceil((Math.abs(et)+Qe)/Je)+1,rt=it-rt,rt=rt<0?0:rt,st=rt;st<it&&st<Xe.panels.length;st++)if(ot=Xe.panels[st],!ot.activePanel){var ut,ft=Xe.viewer.tileSources[st];ft.referenceStripThumbnailUrl?ut={type:"image",url:ft.referenceStripThumbnailUrl}:ut=ft,nt=new ie.Viewer({id:ot.id,tileSources:[ut],element:ot,navigatorSizeRatio:Xe.sizeRatio,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,loadTilesWithAjax:Xe.viewer.loadTilesWithAjax,ajaxHeaders:Xe.viewer.ajaxHeaders,useCanvas:Xe.useCanvas}),nt.displayRegion=ie.makeNeutralElement("div"),nt.displayRegion.id=ot.id+"-displayregion",nt.displayRegion.className="displayregion",tt=nt.displayRegion.style,tt.position="relative",tt.top="0px",tt.left="0px",tt.fontSize="0px",tt.overflow="hidden",tt.float="left",tt.cssFloat="left",tt.styleFloat="left",tt.zIndex=999999999,tt.cursor="default",tt.width=Xe.panelWidth-4+"px",tt.height=Xe.panelHeight-4+"px",nt.displayRegion.innerTracker=new ie.MouseTracker({element:nt.displayRegion,startDisabled:!0}),ot.getElementsByTagName("div")[0].appendChild(nt.displayRegion),Xe.miniViewers[ot.id]=nt,ot.activePanel=!0}}function ye(Xe){var Qe=Xe.eventSource.element;return this.scroll=="horizontal"?Qe.style.marginBottom="0px":Qe.style.marginLeft="0px",!1}function be(Xe){var Qe=Xe.eventSource.element;return this.scroll=="horizontal"?Qe.style.marginBottom="-"+ie.getElementSize(Qe).y/2+"px":Qe.style.marginLeft="-"+ie.getElementSize(Qe).x/2+"px",!1}function Ke(Xe){if(!Xe.preventDefaultAction&&!Xe.ctrl&&!Xe.alt&&!Xe.meta)switch(Xe.keyCode){case 38:return ae.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 40:return ae.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 37:return ae.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 39:return ae.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;default:return!0}else return!0}function Ye(Xe){if(!Xe.preventDefaultAction&&!Xe.ctrl&&!Xe.alt&&!Xe.meta)switch(Xe.keyCode){case 61:return ae.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 45:return ae.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 48:case 119:case 87:return ae.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 115:case 83:return ae.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 97:return ae.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 100:return ae.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;default:return!0}else return!0}}(OpenSeadragon),function(ie){ie.DisplayRect=function(Z,ee,ae,ve,ye,be){ie.Rect.apply(this,[Z,ee,ae,ve]),this.minLevel=ye,this.maxLevel=be},ie.extend(ie.DisplayRect.prototype,ie.Rect.prototype)}(OpenSeadragon),function(ie){ie.Spring=function(ee){var ae=arguments;typeof ee!="object"&&(ee={initial:ae.length&&typeof ae[0]=="number"?ae[0]:void 0,springStiffness:ae.length>1?ae[1].springStiffness:5,animationTime:ae.length>1?ae[1].animationTime:1.5}),ie.console.assert(typeof ee.springStiffness=="number"&&ee.springStiffness!==0,"[OpenSeadragon.Spring] options.springStiffness must be a non-zero number"),ie.console.assert(typeof ee.animationTime=="number"&&ee.animationTime>=0,"[OpenSeadragon.Spring] options.animationTime must be a number greater than or equal to 0"),ee.exponential&&(this._exponential=!0,delete ee.exponential),ie.extend(!0,this,ee),this.current={value:typeof this.initial=="number"?this.initial:this._exponential?0:1,time:ie.now()},ie.console.assert(!this._exponential||this.current.value!==0,"[OpenSeadragon.Spring] value must be non-zero for exponential springs"),this.start={value:this.current.value,time:this.current.time},this.target={value:this.current.value,time:this.current.time},this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},ie.Spring.prototype={resetTo:function(ee){ie.console.assert(!this._exponential||ee!==0,"[OpenSeadragon.Spring.resetTo] target must be non-zero for exponential springs"),this.start.value=this.target.value=this.current.value=ee,this.start.time=this.target.time=this.current.time=ie.now(),this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},springTo:function(ee){ie.console.assert(!this._exponential||ee!==0,"[OpenSeadragon.Spring.springTo] target must be non-zero for exponential springs"),this.start.value=this.current.value,this.start.time=this.current.time,this.target.value=ee,this.target.time=this.start.time+1e3*this.animationTime,this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},shiftBy:function(ee){this.start.value+=ee,this.target.value+=ee,this._exponential&&(ie.console.assert(this.target.value!==0&&this.start.value!==0,"[OpenSeadragon.Spring.shiftBy] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},setExponential:function(ee){this._exponential=ee,this._exponential&&(ie.console.assert(this.current.value!==0&&this.target.value!==0&&this.start.value!==0,"[OpenSeadragon.Spring.setExponential] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},update:function(){this.current.time=ie.now();var ee,ae;this._exponential?(ee=this.start._logValue,ae=this.target._logValue):(ee=this.start.value,ae=this.target.value);var ve=this.current.time>=this.target.time?ae:ee+(ae-ee)*Z(this.springStiffness,(this.current.time-this.start.time)/(this.target.time-this.start.time)),ye=this.current.value;return this._exponential?this.current.value=Math.exp(ve):this.current.value=ve,ye!=this.current.value},isAtTargetValue:function(){return this.current.value===this.target.value}};function Z(ee,ae){return(1-Math.exp(ee*-ae))/(1-Math.exp(-ee))}}(OpenSeadragon),function(ie){function Z(ae){ie.extend(!0,this,{timeout:ie.DEFAULT_SETTINGS.timeout,jobId:null},ae),this.image=null}Z.prototype={errorMsg:null,start:function(){var ae=this,ve=this.abort;this.image=new Image,this.image.onload=function(){ae.finish(!0)},this.image.onabort=this.image.onerror=function(){ae.errorMsg="Image load aborted",ae.finish(!1)},this.jobId=window.setTimeout(function(){ae.errorMsg="Image load exceeded timeout ("+ae.timeout+" ms)",ae.finish(!1)},this.timeout),this.loadWithAjax?(this.request=ie.makeAjaxRequest({url:this.src,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,responseType:"arraybuffer",success:function(ye){var be;try{be=new window.Blob([ye.response])}catch(Qe){var Ke=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if(Qe.name==="TypeError"&&Ke){var Ye=new Ke;Ye.append(ye.response),be=Ye.getBlob()}}be.size===0&&(ae.errorMsg="Empty image response.",ae.finish(!1));var Xe=(window.URL||window.webkitURL).createObjectURL(be);ae.image.src=Xe},error:function(ye){ae.errorMsg="Image load aborted - XHR error",ae.finish(!1)}}),this.abort=function(){ae.request.abort(),typeof ve=="function"&&ve()}):(this.crossOriginPolicy!==!1&&(this.image.crossOrigin=this.crossOriginPolicy),this.image.src=this.src)},finish:function(ae){this.image.onload=this.image.onerror=this.image.onabort=null,ae||(this.image=null),this.jobId&&window.clearTimeout(this.jobId),this.callback(this)}},ie.ImageLoader=function(ae){ie.extend(!0,this,{jobLimit:ie.DEFAULT_SETTINGS.imageLoaderLimit,timeout:ie.DEFAULT_SETTINGS.timeout,jobQueue:[],jobsInProgress:0},ae)},ie.ImageLoader.prototype={addJob:function(ae){var ve=this,ye=function(Ye){ee(ve,Ye,ae.callback)},be={src:ae.src,loadWithAjax:ae.loadWithAjax,ajaxHeaders:ae.loadWithAjax?ae.ajaxHeaders:null,crossOriginPolicy:ae.crossOriginPolicy,ajaxWithCredentials:ae.ajaxWithCredentials,callback:ye,abort:ae.abort,timeout:this.timeout},Ke=new Z(be);!this.jobLimit||this.jobsInProgress<this.jobLimit?(Ke.start(),this.jobsInProgress++):this.jobQueue.push(Ke)},clear:function(){for(var ae=0;ae<this.jobQueue.length;ae++){var ve=this.jobQueue[ae];typeof ve.abort=="function"&&ve.abort()}this.jobQueue=[]}};function ee(ae,ve,ye){var be;ae.jobsInProgress--,(!ae.jobLimit||ae.jobsInProgress<ae.jobLimit)&&ae.jobQueue.length>0&&(be=ae.jobQueue.shift(),be.start(),ae.jobsInProgress++),ye(ve.image,ve.errorMsg,ve.request)}}(OpenSeadragon),function(ie){ie.Tile=function(Z,ee,ae,ve,ye,be,Ke,Ye,Xe,Qe){this.level=Z,this.x=ee,this.y=ae,this.bounds=ve,this.sourceBounds=Qe,this.exists=ye,this.url=be,this.context2D=Ke,this.loadWithAjax=Ye,this.ajaxHeaders=Xe,this.ajaxHeaders?this.cacheKey=this.url+"+"+JSON.stringify(this.ajaxHeaders):this.cacheKey=this.url,this.loaded=!1,this.loading=!1,this.element=null,this.imgElement=null,this.image=null,this.style=null,this.position=null,this.size=null,this.blendStart=null,this.opacity=null,this.squaredDistance=null,this.visibility=null,this.beingDrawn=!1,this.lastTouchTime=0,this.isRightMost=!1,this.isBottomMost=!1},ie.Tile.prototype={toString:function(){return this.level+"/"+this.x+"_"+this.y},_hasTransparencyChannel:function(){return!!this.context2D||this.url.match(".png")},drawHTML:function(Z){if(!this.cacheImageRecord){ie.console.warn("[Tile.drawHTML] attempting to draw tile %s when it's not cached",this.toString());return}if(!this.loaded){ie.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString());return}this.element||(this.element=ie.makeNeutralElement("div"),this.imgElement=this.cacheImageRecord.getImage().cloneNode(),this.imgElement.style.msInterpolationMode="nearest-neighbor",this.imgElement.style.width="100%",this.imgElement.style.height="100%",this.style=this.element.style,this.style.position="absolute"),this.element.parentNode!=Z&&Z.appendChild(this.element),this.imgElement.parentNode!=this.element&&this.element.appendChild(this.imgElement),this.style.top=this.position.y+"px",this.style.left=this.position.x+"px",this.style.height=this.size.y+"px",this.style.width=this.size.x+"px",ie.setElementOpacity(this.element,this.opacity)},drawCanvas:function(Z,ee,ae,ve){var ye=this.position.times(ie.pixelDensityRatio),be=this.size.times(ie.pixelDensityRatio),Ke;if(!this.context2D&&!this.cacheImageRecord){ie.console.warn("[Tile.drawCanvas] attempting to draw tile %s when it's not cached",this.toString());return}if(Ke=this.context2D||this.cacheImageRecord.getRenderedContext(),!this.loaded||!Ke){ie.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString());return}Z.save(),Z.globalAlpha=this.opacity,typeof ae=="number"&&ae!==1&&(ye=ye.times(ae),be=be.times(ae)),ve instanceof ie.Point&&(ye=ye.plus(ve)),Z.globalAlpha===1&&this._hasTransparencyChannel()&&Z.clearRect(ye.x,ye.y,be.x,be.y),ee({context:Z,tile:this,rendered:Ke});var Ye,Xe;this.sourceBounds?(Ye=Math.min(this.sourceBounds.width,Ke.canvas.width),Xe=Math.min(this.sourceBounds.height,Ke.canvas.height)):(Ye=Ke.canvas.width,Xe=Ke.canvas.height),Z.drawImage(Ke.canvas,0,0,Ye,Xe,ye.x,ye.y,be.x,be.y),Z.restore()},getScaleForEdgeSmoothing:function(){var Z;if(this.cacheImageRecord)Z=this.cacheImageRecord.getRenderedContext();else if(this.context2D)Z=this.context2D;else return ie.console.warn("[Tile.drawCanvas] attempting to get tile scale %s when tile's not cached",this.toString()),1;return Z.canvas.width/(this.size.x*ie.pixelDensityRatio)},getTranslationForEdgeSmoothing:function(Z,ee,ae){var ve=Math.max(1,Math.ceil((ae.x-ee.x)/2)),ye=Math.max(1,Math.ceil((ae.y-ee.y)/2));return new ie.Point(ve,ye).minus(this.position.times(ie.pixelDensityRatio).times(Z||1).apply(function(be){return be%1}))},unload:function(){this.imgElement&&this.imgElement.parentNode&&this.imgElement.parentNode.removeChild(this.imgElement),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null,this.imgElement=null,this.loaded=!1,this.loading=!1}}}(OpenSeadragon),function(ie){ie.OverlayPlacement=ie.Placement,ie.OverlayRotationMode=ie.freezeObject({NO_ROTATION:1,EXACT:2,BOUNDING_BOX:3}),ie.Overlay=function(Z,ee,ae){var ve;ie.isPlainObject(Z)?ve=Z:ve={element:Z,location:ee,placement:ae},this.element=ve.element,this.style=ve.element.style,this._init(ve)},ie.Overlay.prototype={_init:function(Z){this.location=Z.location,this.placement=Z.placement===void 0?ie.Placement.TOP_LEFT:Z.placement,this.onDraw=Z.onDraw,this.checkResize=Z.checkResize===void 0?!0:Z.checkResize,this.width=Z.width===void 0?null:Z.width,this.height=Z.height===void 0?null:Z.height,this.rotationMode=Z.rotationMode||ie.OverlayRotationMode.EXACT,this.location instanceof ie.Rect&&(this.width=this.location.width,this.height=this.location.height,this.location=this.location.getTopLeft(),this.placement=ie.Placement.TOP_LEFT),this.scales=this.width!==null&&this.height!==null,this.bounds=new ie.Rect(this.location.x,this.location.y,this.width,this.height),this.position=this.location},adjust:function(Z,ee){var ae=ie.Placement.properties[this.placement];ae&&(ae.isHorizontallyCentered?Z.x-=ee.x/2:ae.isRight&&(Z.x-=ee.x),ae.isVerticallyCentered?Z.y-=ee.y/2:ae.isBottom&&(Z.y-=ee.y))},destroy:function(){var Z=this.element,ee=this.style;Z.parentNode&&(Z.parentNode.removeChild(Z),Z.prevElementParent&&(ee.display="none",document.body.appendChild(Z))),this.onDraw=null,ee.top="",ee.left="",ee.position="",this.width!==null&&(ee.width=""),this.height!==null&&(ee.height="");var ae=ie.getCssPropertyWithVendorPrefix("transformOrigin"),ve=ie.getCssPropertyWithVendorPrefix("transform");ae&&ve&&(ee[ae]="",ee[ve]="")},drawHTML:function(Z,ee){var ae=this.element;ae.parentNode!==Z&&(ae.prevElementParent=ae.parentNode,ae.prevNextSibling=ae.nextSibling,Z.appendChild(ae),this.style.position="absolute",this.size=ie.getElementSize(ae));var ve=this._getOverlayPositionAndSize(ee),ye=ve.position,be=this.size=ve.size,Ke=ve.rotate;if(this.onDraw)this.onDraw(ye,be,this.element);else{var Ye=this.style;Ye.left=ye.x+"px",Ye.top=ye.y+"px",this.width!==null&&(Ye.width=be.x+"px"),this.height!==null&&(Ye.height=be.y+"px");var Xe=ie.getCssPropertyWithVendorPrefix("transformOrigin"),Qe=ie.getCssPropertyWithVendorPrefix("transform");Xe&&Qe&&(Ke?(Ye[Xe]=this._getTransformOrigin(),Ye[Qe]="rotate("+Ke+"deg)"):(Ye[Xe]="",Ye[Qe]="")),Ye.display!=="none"&&(Ye.display="block")}},_getOverlayPositionAndSize:function(Z){var ee=Z.pixelFromPoint(this.location,!0),ae=this._getSizeInPixels(Z);this.adjust(ee,ae);var ve=0;if(Z.degrees&&this.rotationMode!==ie.OverlayRotationMode.NO_ROTATION)if(this.rotationMode===ie.OverlayRotationMode.BOUNDING_BOX&&this.width!==null&&this.height!==null){var ye=new ie.Rect(ee.x,ee.y,ae.x,ae.y),be=this._getBoundingBox(ye,Z.degrees);ee=be.getTopLeft(),ae=be.getSize()}else ve=Z.degrees;return{position:ee,size:ae,rotate:ve}},_getSizeInPixels:function(Z){var ee=this.size.x,ae=this.size.y;if(this.width!==null||this.height!==null){var ve=Z.deltaPixelsFromPointsNoRotate(new ie.Point(this.width||0,this.height||0),!0);this.width!==null&&(ee=ve.x),this.height!==null&&(ae=ve.y)}if(this.checkResize&&(this.width===null||this.height===null)){var ye=this.size=ie.getElementSize(this.element);this.width===null&&(ee=ye.x),this.height===null&&(ae=ye.y)}return new ie.Point(ee,ae)},_getBoundingBox:function(Z,ee){var ae=this._getPlacementPoint(Z);return Z.rotate(ee,ae).getBoundingBox()},_getPlacementPoint:function(Z){var ee=new ie.Point(Z.x,Z.y),ae=ie.Placement.properties[this.placement];return ae&&(ae.isHorizontallyCentered?ee.x+=Z.width/2:ae.isRight&&(ee.x+=Z.width),ae.isVerticallyCentered?ee.y+=Z.height/2:ae.isBottom&&(ee.y+=Z.height)),ee},_getTransformOrigin:function(){var Z="",ee=ie.Placement.properties[this.placement];return ee&&(ee.isLeft?Z="left":ee.isRight&&(Z="right"),ee.isTop?Z+=" top":ee.isBottom&&(Z+=" bottom")),Z},update:function(Z,ee){var ae=ie.isPlainObject(Z)?Z:{location:Z,placement:ee};this._init({location:ae.location||this.location,placement:ae.placement!==void 0?ae.placement:this.placement,onDraw:ae.onDraw||this.onDraw,checkResize:ae.checkResize||this.checkResize,width:ae.width!==void 0?ae.width:this.width,height:ae.height!==void 0?ae.height:this.height,rotationMode:ae.rotationMode||this.rotationMode})},getBounds:function(Z){ie.console.assert(Z,"A viewport must now be passed to Overlay.getBounds.");var ee=this.width,ae=this.height;if(ee===null||ae===null){var ve=Z.deltaPointsFromPixelsNoRotate(this.size,!0);ee===null&&(ee=ve.x),ae===null&&(ae=ve.y)}var ye=this.location.clone();return this.adjust(ye,new ie.Point(ee,ae)),this._adjustBoundsForRotation(Z,new ie.Rect(ye.x,ye.y,ee,ae))},_adjustBoundsForRotation:function(Z,ee){if(!Z||Z.degrees===0||this.rotationMode===ie.OverlayRotationMode.EXACT)return ee;if(this.rotationMode===ie.OverlayRotationMode.BOUNDING_BOX){if(this.width===null||this.height===null)return ee;var ae=this._getOverlayPositionAndSize(Z);return Z.viewerElementToViewportRectangle(new ie.Rect(ae.position.x,ae.position.y,ae.size.x,ae.size.y))}return ee.rotate(-Z.degrees,this._getPlacementPoint(ee))}}}(OpenSeadragon),function(ie){ie.Drawer=function(Z){ie.console.assert(Z.viewer,"[Drawer] options.viewer is required");var ee=arguments;if(ie.isPlainObject(Z)||(Z={source:ee[0],viewport:ee[1],element:ee[2]}),ie.console.assert(Z.viewport,"[Drawer] options.viewport is required"),ie.console.assert(Z.element,"[Drawer] options.element is required"),Z.source&&ie.console.error("[Drawer] options.source is no longer accepted; use TiledImage instead"),this.viewer=Z.viewer,this.viewport=Z.viewport,this.debugGridColor=typeof Z.debugGridColor=="string"?[Z.debugGridColor]:Z.debugGridColor||ie.DEFAULT_SETTINGS.debugGridColor,Z.opacity&&ie.console.error("[Drawer] options.opacity is no longer accepted; set the opacity on the TiledImage instead"),this.useCanvas=ie.supportsCanvas&&(this.viewer?this.viewer.useCanvas:!0),this.container=ie.getElement(Z.element),this.canvas=ie.makeNeutralElement(this.useCanvas?"canvas":"div"),this.context=this.useCanvas?this.canvas.getContext("2d"):null,this.sketchCanvas=null,this.sketchContext=null,this.element=this.container,this.container.dir="ltr",this.useCanvas){var ae=this._calculateCanvasSize();this.canvas.width=ae.x,this.canvas.height=ae.y}this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="absolute",ie.setElementOpacity(this.canvas,this.opacity,!0),this.container.style.textAlign="left",this.container.appendChild(this.canvas),this._imageSmoothingEnabled=!0},ie.Drawer.prototype={addOverlay:function(Z,ee,ae,ve){return ie.console.error("drawer.addOverlay is deprecated. Use viewer.addOverlay instead."),this.viewer.addOverlay(Z,ee,ae,ve),this},updateOverlay:function(Z,ee,ae){return ie.console.error("drawer.updateOverlay is deprecated. Use viewer.updateOverlay instead."),this.viewer.updateOverlay(Z,ee,ae),this},removeOverlay:function(Z){return ie.console.error("drawer.removeOverlay is deprecated. Use viewer.removeOverlay instead."),this.viewer.removeOverlay(Z),this},clearOverlays:function(){return ie.console.error("drawer.clearOverlays is deprecated. Use viewer.clearOverlays instead."),this.viewer.clearOverlays(),this},viewportCoordToDrawerCoord:function(Z){var ee=this.viewport.pixelFromPointNoRotate(Z,!0);return new ie.Point(ee.x*ie.pixelDensityRatio,ee.y*ie.pixelDensityRatio)},clipWithPolygons:function(Z,ee){if(this.useCanvas){var ae=this._getContext(ee);ae.beginPath(),Z.forEach(function(ve){ve.forEach(function(ye,be){ae[be===0?"moveTo":"lineTo"](ye.x,ye.y)})}),ae.clip()}},setOpacity:function(Z){ie.console.error("drawer.setOpacity is deprecated. Use tiledImage.setOpacity instead.");for(var ee=this.viewer.world,ae=0;ae<ee.getItemCount();ae++)ee.getItemAt(ae).setOpacity(Z);return this},getOpacity:function(){ie.console.error("drawer.getOpacity is deprecated. Use tiledImage.getOpacity instead.");for(var Z=this.viewer.world,ee=0,ae=0;ae<Z.getItemCount();ae++){var ve=Z.getItemAt(ae).getOpacity();ve>ee&&(ee=ve)}return ee},needsUpdate:function(){return ie.console.error("[Drawer.needsUpdate] this function is deprecated. Use World.needsDraw instead."),this.viewer.world.needsDraw()},numTilesLoaded:function(){return ie.console.error("[Drawer.numTilesLoaded] this function is deprecated. Use TileCache.numTilesLoaded instead."),this.viewer.tileCache.numTilesLoaded()},reset:function(){return ie.console.error("[Drawer.reset] this function is deprecated. Use World.resetItems instead."),this.viewer.world.resetItems(),this},update:function(){return ie.console.error("[Drawer.update] this function is deprecated. Use Drawer.clear and World.draw instead."),this.clear(),this.viewer.world.draw(),this},canRotate:function(){return this.useCanvas},destroy:function(){this.canvas.width=1,this.canvas.height=1,this.sketchCanvas=null,this.sketchContext=null},clear:function(){if(this.canvas.innerHTML="",this.useCanvas){var Z=this._calculateCanvasSize();if((this.canvas.width!=Z.x||this.canvas.height!=Z.y)&&(this.canvas.width=Z.x,this.canvas.height=Z.y,this._updateImageSmoothingEnabled(this.context),this.sketchCanvas!==null)){var ee=this._calculateSketchCanvasSize();this.sketchCanvas.width=ee.x,this.sketchCanvas.height=ee.y,this._updateImageSmoothingEnabled(this.sketchContext)}this._clear()}},_clear:function(Z,ee){if(this.useCanvas){var ae=this._getContext(Z);if(ee)ae.clearRect(ee.x,ee.y,ee.width,ee.height);else{var ve=ae.canvas;ae.clearRect(0,0,ve.width,ve.height)}}},viewportToDrawerRectangle:function(Z){var ee=this.viewport.pixelFromPointNoRotate(Z.getTopLeft(),!0),ae=this.viewport.deltaPixelsFromPointsNoRotate(Z.getSize(),!0);return new ie.Rect(ee.x*ie.pixelDensityRatio,ee.y*ie.pixelDensityRatio,ae.x*ie.pixelDensityRatio,ae.y*ie.pixelDensityRatio)},drawTile:function(Z,ee,ae,ve,ye){if(ie.console.assert(Z,"[Drawer.drawTile] tile is required"),ie.console.assert(ee,"[Drawer.drawTile] drawingHandler is required"),this.useCanvas){var be=this._getContext(ae);ve=ve||1,Z.drawCanvas(be,ee,ve,ye)}else Z.drawHTML(this.canvas)},_getContext:function(Z){var ee=this.context;if(Z){if(this.sketchCanvas===null){this.sketchCanvas=document.createElement("canvas");var ae=this._calculateSketchCanvasSize();if(this.sketchCanvas.width=ae.x,this.sketchCanvas.height=ae.y,this.sketchContext=this.sketchCanvas.getContext("2d"),this.viewport.getRotation()===0){var ve=this;this.viewer.addHandler("rotate",function ye(){if(ve.viewport.getRotation()!==0){ve.viewer.removeHandler("rotate",ye);var be=ve._calculateSketchCanvasSize();ve.sketchCanvas.width=be.x,ve.sketchCanvas.height=be.y}})}this._updateImageSmoothingEnabled(this.sketchContext)}ee=this.sketchContext}return ee},saveContext:function(Z){this.useCanvas&&this._getContext(Z).save()},restoreContext:function(Z){this.useCanvas&&this._getContext(Z).restore()},setClip:function(Z,ee){if(this.useCanvas){var ae=this._getContext(ee);ae.beginPath(),ae.rect(Z.x,Z.y,Z.width,Z.height),ae.clip()}},drawRectangle:function(Z,ee,ae){if(this.useCanvas){var ve=this._getContext(ae);ve.save(),ve.fillStyle=ee,ve.fillRect(Z.x,Z.y,Z.width,Z.height),ve.restore()}},blendSketch:function(Z,ee,ae,ve){var ye=Z;if(ie.isPlainObject(ye)||(ye={opacity:Z,scale:ee,translate:ae,compositeOperation:ve}),!(!this.useCanvas||!this.sketchCanvas)){Z=ye.opacity,ve=ye.compositeOperation;var be=ye.bounds;if(this.context.save(),this.context.globalAlpha=Z,ve&&(this.context.globalCompositeOperation=ve),be)be.x<0&&(be.width+=be.x,be.x=0),be.x+be.width>this.canvas.width&&(be.width=this.canvas.width-be.x),be.y<0&&(be.height+=be.y,be.y=0),be.y+be.height>this.canvas.height&&(be.height=this.canvas.height-be.y),this.context.drawImage(this.sketchCanvas,be.x,be.y,be.width,be.height,be.x,be.y,be.width,be.height);else{ee=ye.scale||1,ae=ye.translate;var Ke=ae instanceof ie.Point?ae:new ie.Point(0,0),Ye=0,Xe=0;if(ae){var Qe=this.sketchCanvas.width-this.canvas.width,et=this.sketchCanvas.height-this.canvas.height;Ye=Math.round(Qe/2),Xe=Math.round(et/2)}this.context.drawImage(this.sketchCanvas,Ke.x-Ye*ee,Ke.y-Xe*ee,(this.canvas.width+2*Ye)*ee,(this.canvas.height+2*Xe)*ee,-Ye,-Xe,this.canvas.width+2*Ye,this.canvas.height+2*Xe)}this.context.restore()}},drawDebugInfo:function(Z,ee,ae,ve){if(this.useCanvas){var ye=this.viewer.world.getIndexOfItem(ve)%this.debugGridColor.length,be=this.context;be.save(),be.lineWidth=2*ie.pixelDensityRatio,be.font="small-caps bold "+13*ie.pixelDensityRatio+"px arial",be.strokeStyle=this.debugGridColor[ye],be.fillStyle=this.debugGridColor[ye],this.viewport.degrees!==0&&this._offsetForRotation({degrees:this.viewport.degrees}),ve.getRotation(!0)%360!==0&&this._offsetForRotation({degrees:ve.getRotation(!0),point:ve.viewport.pixelFromPointNoRotate(ve._getRotationPoint(!0),!0)}),ve.viewport.degrees===0&&ve.getRotation(!0)%360===0&&ve._drawer.viewer.viewport.getFlip()&&ve._drawer._flip(),be.strokeRect(Z.position.x*ie.pixelDensityRatio,Z.position.y*ie.pixelDensityRatio,Z.size.x*ie.pixelDensityRatio,Z.size.y*ie.pixelDensityRatio);var Ke=(Z.position.x+Z.size.x/2)*ie.pixelDensityRatio,Ye=(Z.position.y+Z.size.y/2)*ie.pixelDensityRatio;be.translate(Ke,Ye),be.rotate(Math.PI/180*-this.viewport.degrees),be.translate(-Ke,-Ye),Z.x===0&&Z.y===0&&(be.fillText("Zoom: "+this.viewport.getZoom(),Z.position.x*ie.pixelDensityRatio,(Z.position.y-30)*ie.pixelDensityRatio),be.fillText("Pan: "+this.viewport.getBounds().toString(),Z.position.x*ie.pixelDensityRatio,(Z.position.y-20)*ie.pixelDensityRatio)),be.fillText("Level: "+Z.level,(Z.position.x+10)*ie.pixelDensityRatio,(Z.position.y+20)*ie.pixelDensityRatio),be.fillText("Column: "+Z.x,(Z.position.x+10)*ie.pixelDensityRatio,(Z.position.y+30)*ie.pixelDensityRatio),be.fillText("Row: "+Z.y,(Z.position.x+10)*ie.pixelDensityRatio,(Z.position.y+40)*ie.pixelDensityRatio),be.fillText("Order: "+ae+" of "+ee,(Z.position.x+10)*ie.pixelDensityRatio,(Z.position.y+50)*ie.pixelDensityRatio),be.fillText("Size: "+Z.size.toString(),(Z.position.x+10)*ie.pixelDensityRatio,(Z.position.y+60)*ie.pixelDensityRatio),be.fillText("Position: "+Z.position.toString(),(Z.position.x+10)*ie.pixelDensityRatio,(Z.position.y+70)*ie.pixelDensityRatio),this.viewport.degrees!==0&&this._restoreRotationChanges(),ve.getRotation(!0)%360!==0&&this._restoreRotationChanges(),ve.viewport.degrees===0&&ve.getRotation(!0)%360===0&&ve._drawer.viewer.viewport.getFlip()&&ve._drawer._flip(),be.restore()}},debugRect:function(Z){if(this.useCanvas){var ee=this.context;ee.save(),ee.lineWidth=2*ie.pixelDensityRatio,ee.strokeStyle=this.debugGridColor[0],ee.fillStyle=this.debugGridColor[0],ee.strokeRect(Z.x*ie.pixelDensityRatio,Z.y*ie.pixelDensityRatio,Z.width*ie.pixelDensityRatio,Z.height*ie.pixelDensityRatio),ee.restore()}},setImageSmoothingEnabled:function(Z){this.useCanvas&&(this._imageSmoothingEnabled=Z,this._updateImageSmoothingEnabled(this.context),this.viewer.forceRedraw())},_updateImageSmoothingEnabled:function(Z){Z.msImageSmoothingEnabled=this._imageSmoothingEnabled,Z.imageSmoothingEnabled=this._imageSmoothingEnabled},getCanvasSize:function(Z){var ee=this._getContext(Z).canvas;return new ie.Point(ee.width,ee.height)},getCanvasCenter:function(){return new ie.Point(this.canvas.width/2,this.canvas.height/2)},_offsetForRotation:function(Z){var ee=Z.point?Z.point.times(ie.pixelDensityRatio):this.getCanvasCenter(),ae=this._getContext(Z.useSketch);ae.save(),ae.translate(ee.x,ee.y),this.viewer.viewport.flipped?(ae.rotate(Math.PI/180*-Z.degrees),ae.scale(-1,1)):ae.rotate(Math.PI/180*Z.degrees),ae.translate(-ee.x,-ee.y)},_flip:function(Z){Z=Z||{};var ee=Z.point?Z.point.times(ie.pixelDensityRatio):this.getCanvasCenter(),ae=this._getContext(Z.useSketch);ae.translate(ee.x,0),ae.scale(-1,1),ae.translate(-ee.x,0)},_restoreRotationChanges:function(Z){var ee=this._getContext(Z);ee.restore()},_calculateCanvasSize:function(){var Z=ie.pixelDensityRatio,ee=this.viewport.getContainerSize();return{x:Math.round(ee.x*Z),y:Math.round(ee.y*Z)}},_calculateSketchCanvasSize:function(){var Z=this._calculateCanvasSize();if(this.viewport.getRotation()===0)return Z;var ee=Math.ceil(Math.sqrt(Z.x*Z.x+Z.y*Z.y));return{x:ee,y:ee}}}}(OpenSeadragon),function(ie){ie.Viewport=function(Z){var ee=arguments;ee.length&&ee[0]instanceof ie.Point&&(Z={containerSize:ee[0],contentSize:ee[1],config:ee[2]}),Z.config&&(ie.extend(!0,Z,Z.config),delete Z.config),this._margins=ie.extend({left:0,top:0,right:0,bottom:0},Z.margins||{}),delete Z.margins,ie.extend(!0,this,{containerSize:null,contentSize:null,zoomPoint:null,viewer:null,springStiffness:ie.DEFAULT_SETTINGS.springStiffness,animationTime:ie.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:ie.DEFAULT_SETTINGS.minZoomImageRatio,maxZoomPixelRatio:ie.DEFAULT_SETTINGS.maxZoomPixelRatio,visibilityRatio:ie.DEFAULT_SETTINGS.visibilityRatio,wrapHorizontal:ie.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:ie.DEFAULT_SETTINGS.wrapVertical,defaultZoomLevel:ie.DEFAULT_SETTINGS.defaultZoomLevel,minZoomLevel:ie.DEFAULT_SETTINGS.minZoomLevel,maxZoomLevel:ie.DEFAULT_SETTINGS.maxZoomLevel,degrees:ie.DEFAULT_SETTINGS.degrees,flipped:ie.DEFAULT_SETTINGS.flipped,homeFillsViewer:ie.DEFAULT_SETTINGS.homeFillsViewer},Z),this._updateContainerInnerSize(),this.centerSpringX=new ie.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.centerSpringY=new ie.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.zoomSpring=new ie.Spring({exponential:!0,initial:1,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,this._setContentBounds(new ie.Rect(0,0,1,1),1),this.goHome(!0),this.update()},ie.Viewport.prototype={resetContentSize:function(Z){return ie.console.assert(Z,"[Viewport.resetContentSize] contentSize is required"),ie.console.assert(Z instanceof ie.Point,"[Viewport.resetContentSize] contentSize must be an OpenSeadragon.Point"),ie.console.assert(Z.x>0,"[Viewport.resetContentSize] contentSize.x must be greater than 0"),ie.console.assert(Z.y>0,"[Viewport.resetContentSize] contentSize.y must be greater than 0"),this._setContentBounds(new ie.Rect(0,0,1,Z.y/Z.x),Z.x),this},setHomeBounds:function(Z,ee){ie.console.error("[Viewport.setHomeBounds] this function is deprecated; The content bounds should not be set manually."),this._setContentBounds(Z,ee)},_setContentBounds:function(Z,ee){ie.console.assert(Z,"[Viewport._setContentBounds] bounds is required"),ie.console.assert(Z instanceof ie.Rect,"[Viewport._setContentBounds] bounds must be an OpenSeadragon.Rect"),ie.console.assert(Z.width>0,"[Viewport._setContentBounds] bounds.width must be greater than 0"),ie.console.assert(Z.height>0,"[Viewport._setContentBounds] bounds.height must be greater than 0"),this._contentBoundsNoRotate=Z.clone(),this._contentSizeNoRotate=this._contentBoundsNoRotate.getSize().times(ee),this._contentBounds=Z.rotate(this.degrees).getBoundingBox(),this._contentSize=this._contentBounds.getSize().times(ee),this._contentAspectRatio=this._contentSize.x/this._contentSize.y,this.viewer&&this.viewer.raiseEvent("reset-size",{contentSize:this._contentSizeNoRotate.clone(),contentFactor:ee,homeBounds:this._contentBoundsNoRotate.clone(),contentBounds:this._contentBounds.clone()})},getHomeZoom:function(){if(this.defaultZoomLevel)return this.defaultZoomLevel;var Z=this._contentAspectRatio/this.getAspectRatio(),ee;return this.homeFillsViewer?ee=Z>=1?Z:1:ee=Z>=1?1:Z,ee/this._contentBounds.width},getHomeBounds:function(){return this.getHomeBoundsNoRotate().rotate(-this.getRotation())},getHomeBoundsNoRotate:function(){var Z=this._contentBounds.getCenter(),ee=1/this.getHomeZoom(),ae=ee/this.getAspectRatio();return new ie.Rect(Z.x-ee/2,Z.y-ae/2,ee,ae)},goHome:function(Z){return this.viewer&&this.viewer.raiseEvent("home",{immediately:Z}),this.fitBounds(this.getHomeBounds(),Z)},getMinZoom:function(){var Z=this.getHomeZoom(),ee=this.minZoomLevel?this.minZoomLevel:this.minZoomImageRatio*Z;return ee},getMaxZoom:function(){var Z=this.maxZoomLevel;return Z||(Z=this._contentSize.x*this.maxZoomPixelRatio/this._containerInnerSize.x,Z/=this._contentBounds.width),Math.max(Z,this.getHomeZoom())},getAspectRatio:function(){return this._containerInnerSize.x/this._containerInnerSize.y},getContainerSize:function(){return new ie.Point(this.containerSize.x,this.containerSize.y)},getMargins:function(){return ie.extend({},this._margins)},setMargins:function(Z){ie.console.assert(ie.type(Z)==="object","[Viewport.setMargins] margins must be an object"),this._margins=ie.extend({left:0,top:0,right:0,bottom:0},Z),this._updateContainerInnerSize(),this.viewer&&this.viewer.forceRedraw()},getBounds:function(Z){return this.getBoundsNoRotate(Z).rotate(-this.getRotation())},getBoundsNoRotate:function(Z){var ee=this.getCenter(Z),ae=1/this.getZoom(Z),ve=ae/this.getAspectRatio();return new ie.Rect(ee.x-ae/2,ee.y-ve/2,ae,ve)},getBoundsWithMargins:function(Z){return this.getBoundsNoRotateWithMargins(Z).rotate(-this.getRotation(),this.getCenter(Z))},getBoundsNoRotateWithMargins:function(Z){var ee=this.getBoundsNoRotate(Z),ae=this._containerInnerSize.x*this.getZoom(Z);return ee.x-=this._margins.left/ae,ee.y-=this._margins.top/ae,ee.width+=(this._margins.left+this._margins.right)/ae,ee.height+=(this._margins.top+this._margins.bottom)/ae,ee},getCenter:function(Z){var ee=new ie.Point(this.centerSpringX.current.value,this.centerSpringY.current.value),ae=new ie.Point(this.centerSpringX.target.value,this.centerSpringY.target.value),ve,ye,be,Ke,Ye,Xe,Qe,et;return Z?ee:this.zoomPoint?(ve=this.pixelFromPoint(this.zoomPoint,!0),ye=this.getZoom(),be=1/ye,Ke=be/this.getAspectRatio(),Ye=new ie.Rect(ee.x-be/2,ee.y-Ke/2,be,Ke),Xe=this._pixelFromPoint(this.zoomPoint,Ye),Qe=Xe.minus(ve),et=Qe.divide(this._containerInnerSize.x*ye),ae.plus(et)):ae},getZoom:function(Z){return Z?this.zoomSpring.current.value:this.zoomSpring.target.value},_applyZoomConstraints:function(Z){return Math.max(Math.min(Z,this.getMaxZoom()),this.getMinZoom())},_applyBoundaryConstraints:function(Z){var ee=new ie.Rect(Z.x,Z.y,Z.width,Z.height);if(!this.wrapHorizontal){var ae=this.visibilityRatio*ee.width,ve=ee.x+ee.width,ye=this._contentBoundsNoRotate.x+this._contentBoundsNoRotate.width,be=this._contentBoundsNoRotate.x-ve+ae,Ke=ye-ee.x-ae;ae>this._contentBoundsNoRotate.width?ee.x+=(be+Ke)/2:Ke<0?ee.x+=Ke:be>0&&(ee.x+=be)}if(!this.wrapVertical){var Ye=this.visibilityRatio*ee.height,Xe=ee.y+ee.height,Qe=this._contentBoundsNoRotate.y+this._contentBoundsNoRotate.height,et=this._contentBoundsNoRotate.y-Xe+Ye,Je=Qe-ee.y-Ye;Ye>this._contentBoundsNoRotate.height?ee.y+=(et+Je)/2:Je<0?ee.y+=Je:et>0&&(ee.y+=et)}return ee},_raiseConstraintsEvent:function(Z){this.viewer&&this.viewer.raiseEvent("constrain",{immediately:Z})},applyConstraints:function(Z){var ee=this.getZoom(),ae=this._applyZoomConstraints(ee);ee!==ae&&this.zoomTo(ae,this.zoomPoint,Z);var ve=this.getBoundsNoRotate(),ye=this._applyBoundaryConstraints(ve);return this._raiseConstraintsEvent(Z),(ve.x!==ye.x||ve.y!==ye.y||Z)&&this.fitBounds(ye.rotate(-this.getRotation()),Z),this},ensureVisible:function(Z){return this.applyConstraints(Z)},_fitBounds:function(Z,ee){ee=ee||{};var ae=ee.immediately||!1,ve=ee.constraints||!1,ye=this.getAspectRatio(),be=Z.getCenter(),Ke=new ie.Rect(Z.x,Z.y,Z.width,Z.height,Z.degrees+this.getRotation()).getBoundingBox();Ke.getAspectRatio()>=ye?Ke.height=Ke.width/ye:Ke.width=Ke.height*ye,Ke.x=be.x-Ke.width/2,Ke.y=be.y-Ke.height/2;var Ye=1/Ke.width;if(ve){var Xe=Ke.getAspectRatio(),Qe=this._applyZoomConstraints(Ye);Ye!==Qe&&(Ye=Qe,Ke.width=1/Ye,Ke.x=be.x-Ke.width/2,Ke.height=Ke.width/Xe,Ke.y=be.y-Ke.height/2),Ke=this._applyBoundaryConstraints(Ke),be=Ke.getCenter(),this._raiseConstraintsEvent(ae)}if(ae)return this.panTo(be,!0),this.zoomTo(Ye,null,!0);this.panTo(this.getCenter(!0),!0),this.zoomTo(this.getZoom(!0),null,!0);var et=this.getBounds(),Je=this.getZoom();if(Je===0||Math.abs(Ye/Je-1)<1e-8)return this.zoomTo(Ye,!0),this.panTo(be,ae);Ke=Ke.rotate(-this.getRotation());var rt=Ke.getTopLeft().times(Ye).minus(et.getTopLeft().times(Je)).divide(Ye-Je);return this.zoomTo(Ye,rt,ae)},fitBounds:function(Z,ee){return this._fitBounds(Z,{immediately:ee,constraints:!1})},fitBoundsWithConstraints:function(Z,ee){return this._fitBounds(Z,{immediately:ee,constraints:!0})},fitVertically:function(Z){var ee=new ie.Rect(this._contentBounds.x+this._contentBounds.width/2,this._contentBounds.y,0,this._contentBounds.height);return this.fitBounds(ee,Z)},fitHorizontally:function(Z){var ee=new ie.Rect(this._contentBounds.x,this._contentBounds.y+this._contentBounds.height/2,this._contentBounds.width,0);return this.fitBounds(ee,Z)},getConstrainedBounds:function(Z){var ee,ae;return ee=this.getBounds(Z),ae=this._applyBoundaryConstraints(ee),ae},panBy:function(Z,ee){var ae=new ie.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return this.panTo(ae.plus(Z),ee)},panTo:function(Z,ee){return ee?(this.centerSpringX.resetTo(Z.x),this.centerSpringY.resetTo(Z.y)):(this.centerSpringX.springTo(Z.x),this.centerSpringY.springTo(Z.y)),this.viewer&&this.viewer.raiseEvent("pan",{center:Z,immediately:ee}),this},zoomBy:function(Z,ee,ae){return this.zoomTo(this.zoomSpring.target.value*Z,ee,ae)},zoomTo:function(Z,ee,ae){var ve=this;return this.zoomPoint=ee instanceof ie.Point&&!isNaN(ee.x)&&!isNaN(ee.y)?ee:null,ae?this._adjustCenterSpringsForZoomPoint(function(){ve.zoomSpring.resetTo(Z)}):this.zoomSpring.springTo(Z),this.viewer&&this.viewer.raiseEvent("zoom",{zoom:Z,refPoint:ee,immediately:ae}),this},setRotation:function(Z){return!this.viewer||!this.viewer.drawer.canRotate()?this:(this.degrees=ie.positiveModulo(Z,360),this._setContentBounds(this.viewer.world.getHomeBounds(),this.viewer.world.getContentFactor()),this.viewer.forceRedraw(),this.viewer.raiseEvent("rotate",{degrees:Z}),this)},getRotation:function(){return this.degrees},resize:function(Z,ee){var ae=this.getBoundsNoRotate(),ve=ae,ye;return this.containerSize.x=Z.x,this.containerSize.y=Z.y,this._updateContainerInnerSize(),ee&&(ye=Z.x/this.containerSize.x,ve.width=ae.width*ye,ve.height=ve.width/this.getAspectRatio()),this.viewer&&this.viewer.raiseEvent("resize",{newContainerSize:Z,maintain:ee}),this.fitBounds(ve,!0)},_updateContainerInnerSize:function(){this._containerInnerSize=new ie.Point(Math.max(1,this.containerSize.x-(this._margins.left+this._margins.right)),Math.max(1,this.containerSize.y-(this._margins.top+this._margins.bottom)))},update:function(){var Z=this;this._adjustCenterSpringsForZoomPoint(function(){Z.zoomSpring.update()}),this.centerSpringX.update(),this.centerSpringY.update();var ee=this.centerSpringX.current.value!==this._oldCenterX||this.centerSpringY.current.value!==this._oldCenterY||this.zoomSpring.current.value!==this._oldZoom;return this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,ee},_adjustCenterSpringsForZoomPoint:function(Z){if(this.zoomPoint){var ee=this.pixelFromPoint(this.zoomPoint,!0);Z();var ae=this.pixelFromPoint(this.zoomPoint,!0),ve=ae.minus(ee),ye=this.deltaPointsFromPixels(ve,!0);this.centerSpringX.shiftBy(ye.x),this.centerSpringY.shiftBy(ye.y),this.zoomSpring.isAtTargetValue()&&(this.zoomPoint=null)}else Z()},deltaPixelsFromPointsNoRotate:function(Z,ee){return Z.times(this._containerInnerSize.x*this.getZoom(ee))},deltaPixelsFromPoints:function(Z,ee){return this.deltaPixelsFromPointsNoRotate(Z.rotate(this.getRotation()),ee)},deltaPointsFromPixelsNoRotate:function(Z,ee){return Z.divide(this._containerInnerSize.x*this.getZoom(ee))},deltaPointsFromPixels:function(Z,ee){return this.deltaPointsFromPixelsNoRotate(Z,ee).rotate(-this.getRotation())},pixelFromPointNoRotate:function(Z,ee){return this._pixelFromPointNoRotate(Z,this.getBoundsNoRotate(ee))},pixelFromPoint:function(Z,ee){return this._pixelFromPoint(Z,this.getBoundsNoRotate(ee))},_pixelFromPointNoRotate:function(Z,ee){return Z.minus(ee.getTopLeft()).times(this._containerInnerSize.x/ee.width).plus(new ie.Point(this._margins.left,this._margins.top))},_pixelFromPoint:function(Z,ee){return this._pixelFromPointNoRotate(Z.rotate(this.getRotation(),this.getCenter(!0)),ee)},pointFromPixelNoRotate:function(Z,ee){var ae=this.getBoundsNoRotate(ee);return Z.minus(new ie.Point(this._margins.left,this._margins.top)).divide(this._containerInnerSize.x/ae.width).plus(ae.getTopLeft())},pointFromPixel:function(Z,ee){return this.pointFromPixelNoRotate(Z,ee).rotate(-this.getRotation(),this.getCenter(!0))},_viewportToImageDelta:function(Z,ee){var ae=this._contentBoundsNoRotate.width;return new ie.Point(Z*this._contentSizeNoRotate.x/ae,ee*this._contentSizeNoRotate.x/ae)},viewportToImageCoordinates:function(Z,ee){if(Z instanceof ie.Point)return this.viewportToImageCoordinates(Z.x,Z.y);if(this.viewer){var ae=this.viewer.world.getItemCount();if(ae>1)ie.console.error("[Viewport.viewportToImageCoordinates] is not accurate with multi-image; use TiledImage.viewportToImageCoordinates instead.");else if(ae===1){var ve=this.viewer.world.getItemAt(0);return ve.viewportToImageCoordinates(Z,ee,!0)}}return this._viewportToImageDelta(Z-this._contentBoundsNoRotate.x,ee-this._contentBoundsNoRotate.y)},_imageToViewportDelta:function(Z,ee){var ae=this._contentBoundsNoRotate.width;return new ie.Point(Z/this._contentSizeNoRotate.x*ae,ee/this._contentSizeNoRotate.x*ae)},imageToViewportCoordinates:function(Z,ee){if(Z instanceof ie.Point)return this.imageToViewportCoordinates(Z.x,Z.y);if(this.viewer){var ae=this.viewer.world.getItemCount();if(ae>1)ie.console.error("[Viewport.imageToViewportCoordinates] is not accurate with multi-image; use TiledImage.imageToViewportCoordinates instead.");else if(ae===1){var ve=this.viewer.world.getItemAt(0);return ve.imageToViewportCoordinates(Z,ee,!0)}}var ye=this._imageToViewportDelta(Z,ee);return ye.x+=this._contentBoundsNoRotate.x,ye.y+=this._contentBoundsNoRotate.y,ye},imageToViewportRectangle:function(Z,ee,ae,ve){var ye=Z;if(ye instanceof ie.Rect||(ye=new ie.Rect(Z,ee,ae,ve)),this.viewer){var be=this.viewer.world.getItemCount();if(be>1)ie.console.error("[Viewport.imageToViewportRectangle] is not accurate with multi-image; use TiledImage.imageToViewportRectangle instead.");else if(be===1){var Ke=this.viewer.world.getItemAt(0);return Ke.imageToViewportRectangle(Z,ee,ae,ve,!0)}}var Ye=this.imageToViewportCoordinates(ye.x,ye.y),Xe=this._imageToViewportDelta(ye.width,ye.height);return new ie.Rect(Ye.x,Ye.y,Xe.x,Xe.y,ye.degrees)},viewportToImageRectangle:function(Z,ee,ae,ve){var ye=Z;if(ye instanceof ie.Rect||(ye=new ie.Rect(Z,ee,ae,ve)),this.viewer){var be=this.viewer.world.getItemCount();if(be>1)ie.console.error("[Viewport.viewportToImageRectangle] is not accurate with multi-image; use TiledImage.viewportToImageRectangle instead.");else if(be===1){var Ke=this.viewer.world.getItemAt(0);return Ke.viewportToImageRectangle(Z,ee,ae,ve,!0)}}var Ye=this.viewportToImageCoordinates(ye.x,ye.y),Xe=this._viewportToImageDelta(ye.width,ye.height);return new ie.Rect(Ye.x,Ye.y,Xe.x,Xe.y,ye.degrees)},viewerElementToImageCoordinates:function(Z){var ee=this.pointFromPixel(Z,!0);return this.viewportToImageCoordinates(ee)},imageToViewerElementCoordinates:function(Z){var ee=this.imageToViewportCoordinates(Z);return this.pixelFromPoint(ee,!0)},windowToImageCoordinates:function(Z){ie.console.assert(this.viewer,"[Viewport.windowToImageCoordinates] the viewport must have a viewer.");var ee=Z.minus(ie.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(ee)},imageToWindowCoordinates:function(Z){ie.console.assert(this.viewer,"[Viewport.imageToWindowCoordinates] the viewport must have a viewer.");var ee=this.imageToViewerElementCoordinates(Z);return ee.plus(ie.getElementPosition(this.viewer.element))},viewerElementToViewportCoordinates:function(Z){return this.pointFromPixel(Z,!0)},viewportToViewerElementCoordinates:function(Z){return this.pixelFromPoint(Z,!0)},viewerElementToViewportRectangle:function(Z){return ie.Rect.fromSummits(this.pointFromPixel(Z.getTopLeft(),!0),this.pointFromPixel(Z.getTopRight(),!0),this.pointFromPixel(Z.getBottomLeft(),!0))},viewportToViewerElementRectangle:function(Z){return ie.Rect.fromSummits(this.pixelFromPoint(Z.getTopLeft(),!0),this.pixelFromPoint(Z.getTopRight(),!0),this.pixelFromPoint(Z.getBottomLeft(),!0))},windowToViewportCoordinates:function(Z){ie.console.assert(this.viewer,"[Viewport.windowToViewportCoordinates] the viewport must have a viewer.");var ee=Z.minus(ie.getElementPosition(this.viewer.element));return this.viewerElementToViewportCoordinates(ee)},viewportToWindowCoordinates:function(Z){ie.console.assert(this.viewer,"[Viewport.viewportToWindowCoordinates] the viewport must have a viewer.");var ee=this.viewportToViewerElementCoordinates(Z);return ee.plus(ie.getElementPosition(this.viewer.element))},viewportToImageZoom:function(Z){if(this.viewer){var ee=this.viewer.world.getItemCount();if(ee>1)ie.console.error("[Viewport.viewportToImageZoom] is not accurate with multi-image.");else if(ee===1){var ae=this.viewer.world.getItemAt(0);return ae.viewportToImageZoom(Z)}}var ve=this._contentSizeNoRotate.x,ye=this._containerInnerSize.x,be=this._contentBoundsNoRotate.width,Ke=ye/ve*be;return Z*Ke},imageToViewportZoom:function(Z){if(this.viewer){var ee=this.viewer.world.getItemCount();if(ee>1)ie.console.error("[Viewport.imageToViewportZoom] is not accurate with multi-image.");else if(ee===1){var ae=this.viewer.world.getItemAt(0);return ae.imageToViewportZoom(Z)}}var ve=this._contentSizeNoRotate.x,ye=this._containerInnerSize.x,be=this._contentBoundsNoRotate.width,Ke=ve/ye/be;return Z*Ke},toggleFlip:function(){return this.setFlip(!this.getFlip()),this},getFlip:function(){return this.flipped},setFlip:function(Z){return this.flipped===Z?this:(this.flipped=Z,this.viewer.navigator&&this.viewer.navigator.setFlip(this.getFlip()),this.viewer.forceRedraw(),this.viewer.raiseEvent("flip",{flipped:Z}),this)}}}(OpenSeadragon),function(ie){ie.TiledImage=function(tt){var st=this;ie.console.assert(tt.tileCache,"[TiledImage] options.tileCache is required"),ie.console.assert(tt.drawer,"[TiledImage] options.drawer is required"),ie.console.assert(tt.viewer,"[TiledImage] options.viewer is required"),ie.console.assert(tt.imageLoader,"[TiledImage] options.imageLoader is required"),ie.console.assert(tt.source,"[TiledImage] options.source is required"),ie.console.assert(!tt.clip||tt.clip instanceof ie.Rect,"[TiledImage] options.clip must be an OpenSeadragon.Rect if present"),ie.EventSource.call(this),this._tileCache=tt.tileCache,delete tt.tileCache,this._drawer=tt.drawer,delete tt.drawer,this._imageLoader=tt.imageLoader,delete tt.imageLoader,tt.clip instanceof ie.Rect&&(this._clip=tt.clip.clone()),delete tt.clip;var ot=tt.x||0;delete tt.x;var ut=tt.y||0;delete tt.y,this.normHeight=tt.source.dimensions.y/tt.source.dimensions.x,this.contentAspectX=tt.source.dimensions.x/tt.source.dimensions.y;var ft=1;tt.width?(ft=tt.width,delete tt.width,tt.height&&(ie.console.error("specifying both width and height to a tiledImage is not supported"),delete tt.height)):tt.height&&(ft=tt.height/this.normHeight,delete tt.height);var pt=tt.fitBounds;delete tt.fitBounds;var Xr=tt.fitBoundsPlacement||OpenSeadragon.Placement.CENTER;delete tt.fitBoundsPlacement;var mt=tt.degrees||0;delete tt.degrees,ie.extend(!0,this,{viewer:null,tilesMatrix:{},coverage:{},loadingCoverage:{},lastDrawn:[],lastResetTime:0,_midDraw:!1,_needsDraw:!0,_hasOpaqueTile:!1,_tilesLoading:0,springStiffness:ie.DEFAULT_SETTINGS.springStiffness,animationTime:ie.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:ie.DEFAULT_SETTINGS.minZoomImageRatio,wrapHorizontal:ie.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:ie.DEFAULT_SETTINGS.wrapVertical,immediateRender:ie.DEFAULT_SETTINGS.immediateRender,blendTime:ie.DEFAULT_SETTINGS.blendTime,alwaysBlend:ie.DEFAULT_SETTINGS.alwaysBlend,minPixelRatio:ie.DEFAULT_SETTINGS.minPixelRatio,smoothTileEdgesMinZoom:ie.DEFAULT_SETTINGS.smoothTileEdgesMinZoom,iOSDevice:ie.DEFAULT_SETTINGS.iOSDevice,debugMode:ie.DEFAULT_SETTINGS.debugMode,crossOriginPolicy:ie.DEFAULT_SETTINGS.crossOriginPolicy,ajaxWithCredentials:ie.DEFAULT_SETTINGS.ajaxWithCredentials,placeholderFillStyle:ie.DEFAULT_SETTINGS.placeholderFillStyle,opacity:ie.DEFAULT_SETTINGS.opacity,preload:ie.DEFAULT_SETTINGS.preload,compositeOperation:ie.DEFAULT_SETTINGS.compositeOperation},tt),this._preload=this.preload,delete this.preload,this._fullyLoaded=!1,this._xSpring=new ie.Spring({initial:ot,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._ySpring=new ie.Spring({initial:ut,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._scaleSpring=new ie.Spring({initial:ft,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._degreesSpring=new ie.Spring({initial:mt,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._updateForScale(),pt&&this.fitBounds(pt,Xr,!0),this._drawingHandler=function(Yr){st.viewer.raiseEvent("tile-drawing",ie.extend({tiledImage:st},Yr))}},ie.extend(ie.TiledImage.prototype,ie.EventSource.prototype,{needsDraw:function(){return this._needsDraw},getFullyLoaded:function(){return this._fullyLoaded},_setFullyLoaded:function(tt){tt!==this._fullyLoaded&&(this._fullyLoaded=tt,this.raiseEvent("fully-loaded-change",{fullyLoaded:this._fullyLoaded}))},reset:function(){this._tileCache.clearTilesFor(this),this.lastResetTime=ie.now(),this._needsDraw=!0},update:function(){var tt=this._xSpring.update(),st=this._ySpring.update(),ot=this._scaleSpring.update(),ut=this._degreesSpring.update();return tt||st||ot||ut?(this._updateForScale(),this._needsDraw=!0,!0):!1},draw:function(){this.opacity!==0||this._preload?(this._midDraw=!0,this._updateViewport(),this._midDraw=!1):this._needsDraw=!1},destroy:function(){this.reset()},getBounds:function(tt){return this.getBoundsNoRotate(tt).rotate(this.getRotation(tt),this._getRotationPoint(tt))},getBoundsNoRotate:function(tt){return tt?new ie.Rect(this._xSpring.current.value,this._ySpring.current.value,this._worldWidthCurrent,this._worldHeightCurrent):new ie.Rect(this._xSpring.target.value,this._ySpring.target.value,this._worldWidthTarget,this._worldHeightTarget)},getWorldBounds:function(){return ie.console.error("[TiledImage.getWorldBounds] is deprecated; use TiledImage.getBounds instead"),this.getBounds()},getClippedBounds:function(tt){var st=this.getBoundsNoRotate(tt);if(this._clip){var ot=tt?this._worldWidthCurrent:this._worldWidthTarget,ut=ot/this.source.dimensions.x,ft=this._clip.times(ut);st=new ie.Rect(st.x+ft.x,st.y+ft.y,ft.width,ft.height)}return st.rotate(this.getRotation(tt),this._getRotationPoint(tt))},getContentSize:function(){return new ie.Point(this.source.dimensions.x,this.source.dimensions.y)},_viewportToImageDelta:function(tt,st,ot){var ut=ot?this._scaleSpring.current.value:this._scaleSpring.target.value;return new ie.Point(tt*(this.source.dimensions.x/ut),st*(this.source.dimensions.y*this.contentAspectX/ut))},viewportToImageCoordinates:function(tt,st,ot){var ut;return tt instanceof ie.Point?(ot=st,ut=tt):ut=new ie.Point(tt,st),ut=ut.rotate(-this.getRotation(ot),this._getRotationPoint(ot)),ot?this._viewportToImageDelta(ut.x-this._xSpring.current.value,ut.y-this._ySpring.current.value):this._viewportToImageDelta(ut.x-this._xSpring.target.value,ut.y-this._ySpring.target.value)},_imageToViewportDelta:function(tt,st,ot){var ut=ot?this._scaleSpring.current.value:this._scaleSpring.target.value;return new ie.Point(tt/this.source.dimensions.x*ut,st/this.source.dimensions.y/this.contentAspectX*ut)},imageToViewportCoordinates:function(tt,st,ot){tt instanceof ie.Point&&(ot=st,st=tt.y,tt=tt.x);var ut=this._imageToViewportDelta(tt,st);return ot?(ut.x+=this._xSpring.current.value,ut.y+=this._ySpring.current.value):(ut.x+=this._xSpring.target.value,ut.y+=this._ySpring.target.value),ut.rotate(this.getRotation(ot),this._getRotationPoint(ot))},imageToViewportRectangle:function(tt,st,ot,ut,ft){var pt=tt;pt instanceof ie.Rect?ft=st:pt=new ie.Rect(tt,st,ot,ut);var Xr=this.imageToViewportCoordinates(pt.getTopLeft(),ft),mt=this._imageToViewportDelta(pt.width,pt.height,ft);return new ie.Rect(Xr.x,Xr.y,mt.x,mt.y,pt.degrees+this.getRotation(ft))},viewportToImageRectangle:function(tt,st,ot,ut,ft){var pt=tt;tt instanceof ie.Rect?ft=st:pt=new ie.Rect(tt,st,ot,ut);var Xr=this.viewportToImageCoordinates(pt.getTopLeft(),ft),mt=this._viewportToImageDelta(pt.width,pt.height,ft);return new ie.Rect(Xr.x,Xr.y,mt.x,mt.y,pt.degrees-this.getRotation(ft))},viewerElementToImageCoordinates:function(tt){var st=this.viewport.pointFromPixel(tt,!0);return this.viewportToImageCoordinates(st)},imageToViewerElementCoordinates:function(tt){var st=this.imageToViewportCoordinates(tt);return this.viewport.pixelFromPoint(st,!0)},windowToImageCoordinates:function(tt){var st=tt.minus(OpenSeadragon.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(st)},imageToWindowCoordinates:function(tt){var st=this.imageToViewerElementCoordinates(tt);return st.plus(OpenSeadragon.getElementPosition(this.viewer.element))},_viewportToTiledImageRectangle:function(tt){var st=this._scaleSpring.current.value;return tt=tt.rotate(-this.getRotation(!0),this._getRotationPoint(!0)),new ie.Rect((tt.x-this._xSpring.current.value)/st,(tt.y-this._ySpring.current.value)/st,tt.width/st,tt.height/st,tt.degrees)},viewportToImageZoom:function(tt){var st=this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x;return st*tt},imageToViewportZoom:function(tt){var st=this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x;return tt/st},setPosition:function(tt,st){var ot=this._xSpring.target.value===tt.x&&this._ySpring.target.value===tt.y;if(st){if(ot&&this._xSpring.current.value===tt.x&&this._ySpring.current.value===tt.y)return;this._xSpring.resetTo(tt.x),this._ySpring.resetTo(tt.y),this._needsDraw=!0}else{if(ot)return;this._xSpring.springTo(tt.x),this._ySpring.springTo(tt.y),this._needsDraw=!0}ot||this._raiseBoundsChange()},setWidth:function(tt,st){this._setScale(tt,st)},setHeight:function(tt,st){this._setScale(tt/this.normHeight,st)},setCroppingPolygons:function(tt){var st=function(ut){return ut instanceof ie.Point||typeof ut.x=="number"&&typeof ut.y=="number"},ot=function(ut){return ut.map(function(ft){try{if(st(ft))return{x:ft.x,y:ft.y};throw new Error}catch{throw new Error("A Provided cropping polygon point is not supported")}})};try{if(!ie.isArray(tt))throw new Error("Provided cropping polygon is not an array");this._croppingPolygons=tt.map(function(ut){return ot(ut)})}catch(ut){ie.console.error("[TiledImage.setCroppingPolygons] Cropping polygon format not supported"),ie.console.error(ut),this._croppingPolygons=null}},resetCroppingPolygons:function(){this._croppingPolygons=null},fitBounds:function(tt,st,ot){st=st||ie.Placement.CENTER;var ut=ie.Placement.properties[st],ft=this.contentAspectX,pt=0,Xr=0,mt=1,Yr=1;if(this._clip&&(ft=this._clip.getAspectRatio(),mt=this._clip.width/this.source.dimensions.x,Yr=this._clip.height/this.source.dimensions.y,tt.getAspectRatio()>ft?(pt=this._clip.x/this._clip.height*tt.height,Xr=this._clip.y/this._clip.height*tt.height):(pt=this._clip.x/this._clip.width*tt.width,Xr=this._clip.y/this._clip.width*tt.width)),tt.getAspectRatio()>ft){var ri=tt.height/Yr,Zr=0;ut.isHorizontallyCentered?Zr=(tt.width-tt.height*ft)/2:ut.isRight&&(Zr=tt.width-tt.height*ft),this.setPosition(new ie.Point(tt.x-pt+Zr,tt.y-Xr),ot),this.setHeight(ri,ot)}else{var _r=tt.width/mt,Kr=0;ut.isVerticallyCentered?Kr=(tt.height-tt.width/ft)/2:ut.isBottom&&(Kr=tt.height-tt.width/ft),this.setPosition(new ie.Point(tt.x-pt,tt.y-Xr+Kr),ot),this.setWidth(_r,ot)}},getClip:function(){return this._clip?this._clip.clone():null},setClip:function(tt){ie.console.assert(!tt||tt instanceof ie.Rect,"[TiledImage.setClip] newClip must be an OpenSeadragon.Rect or null"),tt instanceof ie.Rect?this._clip=tt.clone():this._clip=null,this._needsDraw=!0,this.raiseEvent("clip-change")},getOpacity:function(){return this.opacity},setOpacity:function(tt){tt!==this.opacity&&(this.opacity=tt,this._needsDraw=!0,this.raiseEvent("opacity-change",{opacity:this.opacity}))},getPreload:function(){return this._preload},setPreload:function(tt){this._preload=!!tt,this._needsDraw=!0},getRotation:function(tt){return tt?this._degreesSpring.current.value:this._degreesSpring.target.value},setRotation:function(tt,st){this._degreesSpring.target.value===tt&&this._degreesSpring.isAtTargetValue()||(st?this._degreesSpring.resetTo(tt):this._degreesSpring.springTo(tt),this._needsDraw=!0,this._raiseBoundsChange())},_getRotationPoint:function(tt){return this.getBoundsNoRotate(tt).getCenter()},getCompositeOperation:function(){return this.compositeOperation},setCompositeOperation:function(tt){tt!==this.compositeOperation&&(this.compositeOperation=tt,this._needsDraw=!0,this.raiseEvent("composite-operation-change",{compositeOperation:this.compositeOperation}))},_setScale:function(tt,st){var ot=this._scaleSpring.target.value===tt;if(st){if(ot&&this._scaleSpring.current.value===tt)return;this._scaleSpring.resetTo(tt),this._updateForScale(),this._needsDraw=!0}else{if(ot)return;this._scaleSpring.springTo(tt),this._updateForScale(),this._needsDraw=!0}ot||this._raiseBoundsChange()},_updateForScale:function(){this._worldWidthTarget=this._scaleSpring.target.value,this._worldHeightTarget=this.normHeight*this._scaleSpring.target.value,this._worldWidthCurrent=this._scaleSpring.current.value,this._worldHeightCurrent=this.normHeight*this._scaleSpring.current.value},_raiseBoundsChange:function(){this.raiseEvent("bounds-change")},_isBottomItem:function(){return this.viewer.world.getItemAt(0)===this},_getLevelsInterval:function(){var tt=Math.max(this.source.minLevel,Math.floor(Math.log(this.minZoomImageRatio)/Math.log(2))),st=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(0),!0).x*this._scaleSpring.current.value,ot=Math.min(Math.abs(this.source.maxLevel),Math.abs(Math.floor(Math.log(st/this.minPixelRatio)/Math.log(2))));return ot=Math.max(ot,this.source.minLevel||0),tt=Math.min(tt,ot),{lowestLevel:tt,highestLevel:ot}},_updateViewport:function(){for(this._needsDraw=!1,this._tilesLoading=0,this.loadingCoverage={};this.lastDrawn.length>0;){var tt=this.lastDrawn.pop();tt.beingDrawn=!1}var st=this.viewport,ot=this._viewportToTiledImageRectangle(st.getBoundsWithMargins(!0));if(!this.wrapHorizontal&&!this.wrapVertical){var ut=this._viewportToTiledImageRectangle(this.getClippedBounds(!0));if(ot=ot.intersection(ut),ot===null)return}for(var ft=this._getLevelsInterval(),pt=ft.lowestLevel,Xr=ft.highestLevel,mt=null,Yr=!1,ri=ie.now(),Zr=Xr;Zr>=pt;Zr--){var _r=!1,Kr=st.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(Zr),!0).x*this._scaleSpring.current.value;if(Zr===pt||!Yr&&Kr>=this.minPixelRatio)_r=!0,Yr=!0;else if(!Yr)continue;var si=st.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(Zr),!1).x*this._scaleSpring.current.value,oi=st.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(Math.max(this.source.getClosestLevel(),0)),!1).x*this._scaleSpring.current.value,Qr=this.immediateRender?1:oi,ii=Math.min(1,(Kr-.5)/.5),ti=Qr/Math.abs(Qr-si);if(mt=Z(this,Yr,_r,Zr,ii,ti,ot,ri,mt),Xe(this.coverage,Zr))break}it(this,this.lastDrawn),mt&&!mt.context2D?(ve(this,mt,ri),this._needsDraw=!0,this._setFullyLoaded(!1)):this._setFullyLoaded(this._tilesLoading===0)},_getCornerTiles:function(tt,st,ot){var ut,ft;this.wrapHorizontal?(ut=ie.positiveModulo(st.x,1),ft=ie.positiveModulo(ot.x,1)):(ut=Math.max(0,st.x),ft=Math.min(1,ot.x));var pt,Xr,mt=1/this.source.aspectRatio;this.wrapVertical?(pt=ie.positiveModulo(st.y,mt),Xr=ie.positiveModulo(ot.y,mt)):(pt=Math.max(0,st.y),Xr=Math.min(mt,ot.y));var Yr=this.source.getTileAtPoint(tt,new ie.Point(ut,pt)),ri=this.source.getTileAtPoint(tt,new ie.Point(ft,Xr)),Zr=this.source.getNumTiles(tt);return this.wrapHorizontal&&(Yr.x+=Zr.x*Math.floor(st.x),ri.x+=Zr.x*Math.floor(ot.x)),this.wrapVertical&&(Yr.y+=Zr.y*Math.floor(st.y/mt),ri.y+=Zr.y*Math.floor(ot.y/mt)),{topLeft:Yr,bottomRight:ri}}});function Z(tt,st,ot,ut,ft,pt,Xr,mt,Yr){var ri=Xr.getBoundingBox().getTopLeft(),Zr=Xr.getBoundingBox().getBottomRight();tt.viewer&&tt.viewer.raiseEvent("update-level",{tiledImage:tt,havedrawn:st,level:ut,opacity:ft,visibility:pt,drawArea:Xr,topleft:ri,bottomright:Zr,currenttime:mt,best:Yr}),Je(tt.coverage,ut),Je(tt.loadingCoverage,ut);for(var _r=tt._getCornerTiles(ut,ri,Zr),Kr=_r.topLeft,si=_r.bottomRight,oi=tt.source.getNumTiles(ut),Qr=tt.viewport.pixelFromPoint(tt.viewport.getCenter()),ii=Kr.x;ii<=si.x;ii++)for(var ti=Kr.y;ti<=si.y;ti++){if(!tt.wrapHorizontal&&!tt.wrapVertical){var ni=tt.source.getTileBounds(ut,ii,ti);if(Xr.intersection(ni)===null)continue}Yr=ee(tt,ot,st,ii,ti,ut,ft,pt,Qr,oi,mt,Yr)}return Yr}function ee(tt,st,ot,ut,ft,pt,Xr,mt,Yr,ri,Zr,_r){var Kr=ae(ut,ft,pt,tt,tt.source,tt.tilesMatrix,Zr,ri,tt._worldWidthCurrent,tt._worldHeightCurrent),si=ot;tt.viewer&&tt.viewer.raiseEvent("update-tile",{tiledImage:tt,tile:Kr}),et(tt.coverage,pt,ut,ft,!1);var oi=Kr.loaded||Kr.loading||Qe(tt.loadingCoverage,pt,ut,ft);if(et(tt.loadingCoverage,pt,ut,ft,oi),!Kr.exists||(st&&!si&&(Qe(tt.coverage,pt,ut,ft)?et(tt.coverage,pt,ut,ft,!0):si=!0),!si))return _r;if(Ke(Kr,tt.source.tileOverlap,tt.viewport,Yr,mt,tt),!Kr.loaded)if(Kr.context2D)be(tt,Kr);else{var Qr=tt._tileCache.getImageRecord(Kr.cacheKey);if(Qr){var ii=Qr.getImage();be(tt,Kr,ii)}}if(Kr.loaded){var ti=Ye(tt,Kr,ut,ft,pt,Xr,Zr);ti&&(tt._needsDraw=!0)}else Kr.loading?tt._tilesLoading++:oi||(_r=rt(_r,Kr));return _r}function ae(tt,st,ot,ut,ft,pt,Xr,mt,Yr,ri){var Zr,_r,Kr,si,oi,Qr,ii,ti,ni;return pt[ot]||(pt[ot]={}),pt[ot][tt]||(pt[ot][tt]={}),pt[ot][tt][st]||(Zr=(mt.x+tt%mt.x)%mt.x,_r=(mt.y+st%mt.y)%mt.y,Kr=ft.getTileBounds(ot,Zr,_r),si=ft.getTileBounds(ot,Zr,_r,!0),oi=ft.tileExists(ot,Zr,_r),Qr=ft.getTileUrl(ot,Zr,_r),ut.loadTilesWithAjax?(ii=ft.getTileAjaxHeaders(ot,Zr,_r),ie.isPlainObject(ut.ajaxHeaders)&&(ii=ie.extend({},ut.ajaxHeaders,ii))):ii=null,ti=ft.getContext2D?ft.getContext2D(ot,Zr,_r):void 0,Kr.x+=(tt-Zr)/mt.x,Kr.y+=ri/Yr*((st-_r)/mt.y),ni=new ie.Tile(ot,tt,st,Kr,oi,Qr,ti,ut.loadTilesWithAjax,ii,si),Zr===mt.x-1&&(ni.isRightMost=!0),_r===mt.y-1&&(ni.isBottomMost=!0),pt[ot][tt][st]=ni),ni=pt[ot][tt][st],ni.lastTouchTime=Xr,ni}function ve(tt,st,ot){st.loading=!0,tt._imageLoader.addJob({src:st.url,loadWithAjax:st.loadWithAjax,ajaxHeaders:st.ajaxHeaders,crossOriginPolicy:tt.crossOriginPolicy,ajaxWithCredentials:tt.ajaxWithCredentials,callback:function(ut,ft,pt){ye(tt,st,ot,ut,ft,pt)},abort:function(){st.loading=!1}})}function ye(tt,st,ot,ut,ft,pt){if(!ut){ie.console.log("Tile %s failed to load: %s - error: %s",st,st.url,ft),tt.viewer.raiseEvent("tile-load-failed",{tile:st,tiledImage:tt,time:ot,message:ft,tileRequest:pt}),st.loading=!1,st.exists=!1;return}if(ot<tt.lastResetTime){ie.console.log("Ignoring tile %s loaded before reset: %s",st,st.url),st.loading=!1;return}var Xr=function(){var mt=tt.source.getClosestLevel();be(tt,st,ut,mt,pt)};tt._midDraw?window.setTimeout(Xr,1):Xr()}function be(tt,st,ot,ut,ft){var pt=0;function Xr(){return pt++,mt}function mt(){pt--,pt===0&&(st.loading=!1,st.loaded=!0,st.context2D||tt._tileCache.cacheTile({image:ot,tile:st,cutoff:ut,tiledImage:tt}),tt._needsDraw=!0)}tt.viewer.raiseEvent("tile-loaded",{tile:st,tiledImage:tt,tileRequest:ft,image:ot,getCompletionCallback:Xr}),Xr()()}function Ke(tt,st,ot,ut,ft,pt){var Xr=tt.bounds.getTopLeft();Xr.x*=pt._scaleSpring.current.value,Xr.y*=pt._scaleSpring.current.value,Xr.x+=pt._xSpring.current.value,Xr.y+=pt._ySpring.current.value;var mt=tt.bounds.getSize();mt.x*=pt._scaleSpring.current.value,mt.y*=pt._scaleSpring.current.value;var Yr=ot.pixelFromPointNoRotate(Xr,!0),ri=ot.pixelFromPointNoRotate(Xr,!1),Zr=ot.deltaPixelsFromPointsNoRotate(mt,!0),_r=ot.deltaPixelsFromPointsNoRotate(mt,!1),Kr=ri.plus(_r.divide(2)),si=ut.squaredDistanceTo(Kr);st||(Zr=Zr.plus(new ie.Point(1,1))),tt.isRightMost&&pt.wrapHorizontal&&(Zr.x+=.75),tt.isBottomMost&&pt.wrapVertical&&(Zr.y+=.75),tt.position=Yr,tt.size=Zr,tt.squaredDistance=si,tt.visibility=ft}function Ye(tt,st,ot,ut,ft,pt,Xr){var mt=1e3*tt.blendTime,Yr,ri;if(st.blendStart||(st.blendStart=Xr),Yr=Xr-st.blendStart,ri=mt?Math.min(1,Yr/mt):1,tt.alwaysBlend&&(ri*=pt),st.opacity=ri,tt.lastDrawn.push(st),ri===1)et(tt.coverage,ft,ot,ut,!0),tt._hasOpaqueTile=!0;else if(Yr<mt)return!0;return!1}function Xe(tt,st,ot,ut){var ft,pt,Xr,mt;if(!tt[st])return!1;if(ot===void 0||ut===void 0){ft=tt[st];for(Xr in ft)if(Object.prototype.hasOwnProperty.call(ft,Xr)){pt=ft[Xr];for(mt in pt)if(Object.prototype.hasOwnProperty.call(pt,mt)&&!pt[mt])return!1}return!0}return tt[st][ot]===void 0||tt[st][ot][ut]===void 0||tt[st][ot][ut]===!0}function Qe(tt,st,ot,ut){return ot===void 0||ut===void 0?Xe(tt,st+1):Xe(tt,st+1,2*ot,2*ut)&&Xe(tt,st+1,2*ot,2*ut+1)&&Xe(tt,st+1,2*ot+1,2*ut)&&Xe(tt,st+1,2*ot+1,2*ut+1)}function et(tt,st,ot,ut,ft){if(!tt[st]){ie.console.warn("Setting coverage for a tile before its level's coverage has been reset: %s",st);return}tt[st][ot]||(tt[st][ot]={}),tt[st][ot][ut]=ft}function Je(tt,st){tt[st]={}}function rt(tt,st){return!tt||st.visibility>tt.visibility||st.visibility==tt.visibility&&st.squaredDistance<tt.squaredDistance?st:tt}function it(tt,st){if(!(tt.opacity===0||st.length===0&&!tt.placeholderFillStyle)){var ot=st[0],ut;ot&&(ut=tt.opacity<1||tt.compositeOperation&&tt.compositeOperation!=="source-over"||!tt._isBottomItem()&&ot._hasTransparencyChannel());var ft,pt,Xr=tt.viewport.getZoom(!0),mt=tt.viewportToImageZoom(Xr);st.length>1&&mt>tt.smoothTileEdgesMinZoom&&!tt.iOSDevice&&tt.getRotation(!0)%360===0&&ie.supportsCanvas&&(ut=!0,ft=ot.getScaleForEdgeSmoothing(),pt=ot.getTranslationForEdgeSmoothing(ft,tt._drawer.getCanvasSize(!1),tt._drawer.getCanvasSize(!0)));var Yr;ut&&(ft||(Yr=tt.viewport.viewportToViewerElementRectangle(tt.getClippedBounds(!0)).getIntegerBoundingBox(),tt._drawer.viewer.viewport.getFlip()&&(tt.viewport.degrees!==0||tt.getRotation(!0)%360!==0)&&(Yr.x=tt._drawer.viewer.container.clientWidth-(Yr.x+Yr.width)),Yr=Yr.times(ie.pixelDensityRatio)),tt._drawer._clear(!0,Yr)),ft||(tt.viewport.degrees!==0&&tt._drawer._offsetForRotation({degrees:tt.viewport.degrees,useSketch:ut}),tt.getRotation(!0)%360!==0&&tt._drawer._offsetForRotation({degrees:tt.getRotation(!0),point:tt.viewport.pixelFromPointNoRotate(tt._getRotationPoint(!0),!0),useSketch:ut}),tt.viewport.degrees===0&&tt.getRotation(!0)%360===0&&tt._drawer.viewer.viewport.getFlip()&&tt._drawer._flip());var ri=!1;if(tt._clip){tt._drawer.saveContext(ut);var Zr=tt.imageToViewportRectangle(tt._clip,!0);Zr=Zr.rotate(-tt.getRotation(!0),tt._getRotationPoint(!0));var _r=tt._drawer.viewportToDrawerRectangle(Zr);ft&&(_r=_r.times(ft)),pt&&(_r=_r.translate(pt)),tt._drawer.setClip(_r,ut),ri=!0}if(tt._croppingPolygons){tt._drawer.saveContext(ut);try{var Kr=tt._croppingPolygons.map(function(ii){return ii.map(function(ti){var ni=tt.imageToViewportCoordinates(ti.x,ti.y,!0).rotate(-tt.getRotation(!0),tt._getRotationPoint(!0)),ui=tt._drawer.viewportCoordToDrawerCoord(ni);return ft&&(ui=ui.times(ft)),ui})});tt._drawer.clipWithPolygons(Kr,ut)}catch(ii){ie.console.error(ii)}ri=!0}if(tt.placeholderFillStyle&&tt._hasOpaqueTile===!1){var si=tt._drawer.viewportToDrawerRectangle(tt.getBounds(!0));ft&&(si=si.times(ft)),pt&&(si=si.translate(pt));var oi=null;typeof tt.placeholderFillStyle=="function"?oi=tt.placeholderFillStyle(tt,tt._drawer.context):oi=tt.placeholderFillStyle,tt._drawer.drawRectangle(si,oi,ut)}for(var Qr=st.length-1;Qr>=0;Qr--)ot=st[Qr],tt._drawer.drawTile(ot,tt._drawingHandler,ut,ft,pt),ot.beingDrawn=!0,tt.viewer&&tt.viewer.raiseEvent("tile-drawn",{tiledImage:tt,tile:ot});ri&&tt._drawer.restoreContext(ut),ft||(tt.getRotation(!0)%360!==0&&tt._drawer._restoreRotationChanges(ut),tt.viewport.degrees!==0&&tt._drawer._restoreRotationChanges(ut)),ut&&(ft&&(tt.viewport.degrees!==0&&tt._drawer._offsetForRotation({degrees:tt.viewport.degrees,useSketch:!1}),tt.getRotation(!0)%360!==0&&tt._drawer._offsetForRotation({degrees:tt.getRotation(!0),point:tt.viewport.pixelFromPointNoRotate(tt._getRotationPoint(!0),!0),useSketch:!1})),tt._drawer.blendSketch({opacity:tt.opacity,scale:ft,translate:pt,compositeOperation:tt.compositeOperation,bounds:Yr}),ft&&(tt.getRotation(!0)%360!==0&&tt._drawer._restoreRotationChanges(!1),tt.viewport.degrees!==0&&tt._drawer._restoreRotationChanges(!1))),ft||tt.viewport.degrees===0&&tt.getRotation(!0)%360===0&&tt._drawer.viewer.viewport.getFlip()&&tt._drawer._flip(),nt(tt,st)}}function nt(tt,st){if(tt.debugMode)for(var ot=st.length-1;ot>=0;ot--){var ut=st[ot];try{tt._drawer.drawDebugInfo(ut,st.length,ot,tt)}catch(ft){ie.console.error(ft)}}}}(OpenSeadragon),function(ie){var Z=function(ae){ie.console.assert(ae,"[TileCache.cacheTile] options is required"),ie.console.assert(ae.tile,"[TileCache.cacheTile] options.tile is required"),ie.console.assert(ae.tiledImage,"[TileCache.cacheTile] options.tiledImage is required"),this.tile=ae.tile,this.tiledImage=ae.tiledImage},ee=function(ae){ie.console.assert(ae,"[ImageRecord] options is required"),ie.console.assert(ae.image,"[ImageRecord] options.image is required"),this._image=ae.image,this._tiles=[]};ee.prototype={destroy:function(){this._image=null,this._renderedContext=null,this._tiles=null},getImage:function(){return this._image},getRenderedContext:function(){if(!this._renderedContext){var ae=document.createElement("canvas");ae.width=this._image.width,ae.height=this._image.height,this._renderedContext=ae.getContext("2d"),this._renderedContext.drawImage(this._image,0,0),this._image=null}return this._renderedContext},setRenderedContext:function(ae){ie.console.error("ImageRecord.setRenderedContext is deprecated. The rendered context should be created by the ImageRecord itself when calling ImageRecord.getRenderedContext."),this._renderedContext=ae},addTile:function(ae){ie.console.assert(ae,"[ImageRecord.addTile] tile is required"),this._tiles.push(ae)},removeTile:function(ae){for(var ve=0;ve<this._tiles.length;ve++)if(this._tiles[ve]===ae){this._tiles.splice(ve,1);return}ie.console.warn("[ImageRecord.removeTile] trying to remove unknown tile",ae)},getTileCount:function(){return this._tiles.length}},ie.TileCache=function(ae){ae=ae||{},this._maxImageCacheCount=ae.maxImageCacheCount||ie.DEFAULT_SETTINGS.maxImageCacheCount,this._tilesLoaded=[],this._imagesLoaded=[],this._imagesLoadedCount=0},ie.TileCache.prototype={numTilesLoaded:function(){return this._tilesLoaded.length},cacheTile:function(ae){ie.console.assert(ae,"[TileCache.cacheTile] options is required"),ie.console.assert(ae.tile,"[TileCache.cacheTile] options.tile is required"),ie.console.assert(ae.tile.cacheKey,"[TileCache.cacheTile] options.tile.cacheKey is required"),ie.console.assert(ae.tiledImage,"[TileCache.cacheTile] options.tiledImage is required");var ve=ae.cutoff||0,ye=this._tilesLoaded.length,be=this._imagesLoaded[ae.tile.cacheKey];if(be||(ie.console.assert(ae.image,"[TileCache.cacheTile] options.image is required to create an ImageRecord"),be=this._imagesLoaded[ae.tile.cacheKey]=new ee({image:ae.image}),this._imagesLoadedCount++),be.addTile(ae.tile),ae.tile.cacheImageRecord=be,this._imagesLoadedCount>this._maxImageCacheCount){for(var Ke=null,Ye=-1,Xe=null,Qe,et,Je,rt,it,nt,tt=this._tilesLoaded.length-1;tt>=0;tt--)if(nt=this._tilesLoaded[tt],Qe=nt.tile,!(Qe.level<=ve||Qe.beingDrawn)){if(!Ke){Ke=Qe,Ye=tt,Xe=nt;continue}rt=Qe.lastTouchTime,et=Ke.lastTouchTime,it=Qe.level,Je=Ke.level,(rt<et||rt==et&&it>Je)&&(Ke=Qe,Ye=tt,Xe=nt)}Ke&&Ye>=0&&(this._unloadTile(Xe),ye=Ye)}this._tilesLoaded[ye]=new Z({tile:ae.tile,tiledImage:ae.tiledImage})},clearTilesFor:function(ae){ie.console.assert(ae,"[TileCache.clearTilesFor] tiledImage is required");for(var ve,ye=0;ye<this._tilesLoaded.length;++ye)ve=this._tilesLoaded[ye],ve.tiledImage===ae&&(this._unloadTile(ve),this._tilesLoaded.splice(ye,1),ye--)},getImageRecord:function(ae){return ie.console.assert(ae,"[TileCache.getImageRecord] cacheKey is required"),this._imagesLoaded[ae]},_unloadTile:function(ae){ie.console.assert(ae,"[TileCache._unloadTile] tileRecord is required");var ve=ae.tile,ye=ae.tiledImage;ve.unload(),ve.cacheImageRecord=null;var be=this._imagesLoaded[ve.cacheKey];be.removeTile(ve),be.getTileCount()||(be.destroy(),delete this._imagesLoaded[ve.cacheKey],this._imagesLoadedCount--),ye.viewer.raiseEvent("tile-unloaded",{tile:ve,tiledImage:ye})}}}(OpenSeadragon),function(ie){ie.World=function(Z){var ee=this;ie.console.assert(Z.viewer,"[World] options.viewer is required"),ie.EventSource.call(this),this.viewer=Z.viewer,this._items=[],this._needsDraw=!1,this._autoRefigureSizes=!0,this._needsSizesFigured=!1,this._delegatedFigureSizes=function(ae){ee._autoRefigureSizes?ee._figureSizes():ee._needsSizesFigured=!0},this._figureSizes()},ie.extend(ie.World.prototype,ie.EventSource.prototype,{addItem:function(Z,ee){if(ie.console.assert(Z,"[World.addItem] item is required"),ie.console.assert(Z instanceof ie.TiledImage,"[World.addItem] only TiledImages supported at this time"),ee=ee||{},ee.index!==void 0){var ae=Math.max(0,Math.min(this._items.length,ee.index));this._items.splice(ae,0,Z)}else this._items.push(Z);this._autoRefigureSizes?this._figureSizes():this._needsSizesFigured=!0,this._needsDraw=!0,Z.addHandler("bounds-change",this._delegatedFigureSizes),Z.addHandler("clip-change",this._delegatedFigureSizes),this.raiseEvent("add-item",{item:Z})},getItemAt:function(Z){return ie.console.assert(Z!==void 0,"[World.getItemAt] index is required"),this._items[Z]},getIndexOfItem:function(Z){return ie.console.assert(Z,"[World.getIndexOfItem] item is required"),ie.indexOf(this._items,Z)},getItemCount:function(){return this._items.length},setItemIndex:function(Z,ee){ie.console.assert(Z,"[World.setItemIndex] item is required"),ie.console.assert(ee!==void 0,"[World.setItemIndex] index is required");var ae=this.getIndexOfItem(Z);if(ee>=this._items.length)throw new Error("Index bigger than number of layers.");ee===ae||ae===-1||(this._items.splice(ae,1),this._items.splice(ee,0,Z),this._needsDraw=!0,this.raiseEvent("item-index-change",{item:Z,previousIndex:ae,newIndex:ee}))},removeItem:function(Z){ie.console.assert(Z,"[World.removeItem] item is required");var ee=ie.indexOf(this._items,Z);ee!==-1&&(Z.removeHandler("bounds-change",this._delegatedFigureSizes),Z.removeHandler("clip-change",this._delegatedFigureSizes),Z.destroy(),this._items.splice(ee,1),this._figureSizes(),this._needsDraw=!0,this._raiseRemoveItem(Z))},removeAll:function(){this.viewer._cancelPendingImages();var Z,ee;for(ee=0;ee<this._items.length;ee++)Z=this._items[ee],Z.removeHandler("bounds-change",this._delegatedFigureSizes),Z.removeHandler("clip-change",this._delegatedFigureSizes),Z.destroy();var ae=this._items;for(this._items=[],this._figureSizes(),this._needsDraw=!0,ee=0;ee<ae.length;ee++)Z=ae[ee],this._raiseRemoveItem(Z)},resetItems:function(){for(var Z=0;Z<this._items.length;Z++)this._items[Z].reset()},update:function(){for(var Z=!1,ee=0;ee<this._items.length;ee++)Z=this._items[ee].update()||Z;return Z},draw:function(){for(var Z=0;Z<this._items.length;Z++)this._items[Z].draw();this._needsDraw=!1},needsDraw:function(){for(var Z=0;Z<this._items.length;Z++)if(this._items[Z].needsDraw())return!0;return this._needsDraw},getHomeBounds:function(){return this._homeBounds.clone()},getContentFactor:function(){return this._contentFactor},setAutoRefigureSizes:function(Z){this._autoRefigureSizes=Z,Z&this._needsSizesFigured&&(this._figureSizes(),this._needsSizesFigured=!1)},arrange:function(Z){Z=Z||{};var ee=Z.immediately||!1,ae=Z.layout||ie.DEFAULT_SETTINGS.collectionLayout,ve=Z.rows||ie.DEFAULT_SETTINGS.collectionRows,ye=Z.columns||ie.DEFAULT_SETTINGS.collectionColumns,be=Z.tileSize||ie.DEFAULT_SETTINGS.collectionTileSize,Ke=Z.tileMargin||ie.DEFAULT_SETTINGS.collectionTileMargin,Ye=be+Ke,Xe;!Z.rows&&ye?Xe=ye:Xe=Math.ceil(this._items.length/ve);var Qe=0,et=0,Je,rt,it,nt,tt;this.setAutoRefigureSizes(!1);for(var st=0;st<this._items.length;st++)st&&st%Xe===0&&(ae==="horizontal"?(et+=Ye,Qe=0):(Qe+=Ye,et=0)),Je=this._items[st],rt=Je.getBounds(),rt.width>rt.height?it=be:it=be*(rt.width/rt.height),nt=it*(rt.height/rt.width),tt=new ie.Point(Qe+(be-it)/2,et+(be-nt)/2),Je.setPosition(tt,ee),Je.setWidth(it,ee),ae==="horizontal"?Qe+=Ye:et+=Ye;this.setAutoRefigureSizes(!0)},_figureSizes:function(){var Z=this._homeBounds?this._homeBounds.clone():null,ee=this._contentSize?this._contentSize.clone():null,ae=this._contentFactor||0;if(!this._items.length)this._homeBounds=new ie.Rect(0,0,1,1),this._contentSize=new ie.Point(1,1),this._contentFactor=1;else{var ve=this._items[0],ye=ve.getBounds();this._contentFactor=ve.getContentSize().x/ye.width;for(var be=ve.getClippedBounds().getBoundingBox(),Ke=be.x,Ye=be.y,Xe=be.x+be.width,Qe=be.y+be.height,et=1;et<this._items.length;et++)ve=this._items[et],ye=ve.getBounds(),this._contentFactor=Math.max(this._contentFactor,ve.getContentSize().x/ye.width),be=ve.getClippedBounds().getBoundingBox(),Ke=Math.min(Ke,be.x),Ye=Math.min(Ye,be.y),Xe=Math.max(Xe,be.x+be.width),Qe=Math.max(Qe,be.y+be.height);this._homeBounds=new ie.Rect(Ke,Ye,Xe-Ke,Qe-Ye),this._contentSize=new ie.Point(this._homeBounds.width*this._contentFactor,this._homeBounds.height*this._contentFactor)}(this._contentFactor!==ae||!this._homeBounds.equals(Z)||!this._contentSize.equals(ee))&&this.raiseEvent("metrics-change",{})},_raiseRemoveItem:function(Z){this.raiseEvent("remove-item",{item:Z})}})}(OpenSeadragon)})(openseadragon);var openseadragonExports=openseadragon.exports;const le=getDefaultExportFromCjs$1(openseadragonExports),$6be4966fd9bbc698$var$SWITCH_NAME="Switch",[$6be4966fd9bbc698$var$createSwitchContext,$6be4966fd9bbc698$export$cf7f5f17f69cbd43]=$c512c27ab02ef895$export$50c7b4e9d9f19c1($6be4966fd9bbc698$var$SWITCH_NAME),[$6be4966fd9bbc698$var$SwitchProvider,$6be4966fd9bbc698$var$useSwitchContext]=$6be4966fd9bbc698$var$createSwitchContext($6be4966fd9bbc698$var$SWITCH_NAME),$6be4966fd9bbc698$export$b5d5cf8927ab7262=reactExports.forwardRef((ie,Z)=>{const{__scopeSwitch:ee,name:ae,checked:ve,defaultChecked:ye,required:be,disabled:Ke,value:Ye="on",onCheckedChange:Xe,...Qe}=ie,[et,Je]=reactExports.useState(null),rt=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(Z,ot=>Je(ot)),it=reactExports.useRef(!1),nt=et?!!et.closest("form"):!0,[tt=!1,st]=$71cd76cc60e0454e$export$6f32135080cb4c3({prop:ve,defaultProp:ye,onChange:Xe});return reactExports.createElement($6be4966fd9bbc698$var$SwitchProvider,{scope:ee,checked:tt,disabled:Ke},reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.button,_extends$1({type:"button",role:"switch","aria-checked":tt,"aria-required":be,"data-state":$6be4966fd9bbc698$var$getState(tt),"data-disabled":Ke?"":void 0,disabled:Ke,value:Ye},Qe,{ref:rt,onClick:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ie.onClick,ot=>{st(ut=>!ut),nt&&(it.current=ot.isPropagationStopped(),it.current||ot.stopPropagation())})})),nt&&reactExports.createElement($6be4966fd9bbc698$var$BubbleInput,{control:et,bubbles:!it.current,name:ae,value:Ye,checked:tt,required:be,disabled:Ke,style:{transform:"translateX(-100%)"}}))}),$6be4966fd9bbc698$var$THUMB_NAME="SwitchThumb",$6be4966fd9bbc698$export$4d07bf653ea69106=reactExports.forwardRef((ie,Z)=>{const{__scopeSwitch:ee,...ae}=ie,ve=$6be4966fd9bbc698$var$useSwitchContext($6be4966fd9bbc698$var$THUMB_NAME,ee);return reactExports.createElement($8927f6f2acc4f386$export$250ffa63cdc0d034.span,_extends$1({"data-state":$6be4966fd9bbc698$var$getState(ve.checked),"data-disabled":ve.disabled?"":void 0},ae,{ref:Z}))}),$6be4966fd9bbc698$var$BubbleInput=ie=>{const{control:Z,checked:ee,bubbles:ae=!0,...ve}=ie,ye=reactExports.useRef(null),be=$010c2913dbd2fe3d$export$5cae361ad82dce8b(ee),Ke=$db6c3485150b8e66$export$1ab7ae714698c4b8(Z);return reactExports.useEffect(()=>{const Ye=ye.current,Xe=window.HTMLInputElement.prototype,et=Object.getOwnPropertyDescriptor(Xe,"checked").set;if(be!==ee&&et){const Je=new Event("click",{bubbles:ae});et.call(Ye,ee),Ye.dispatchEvent(Je)}},[be,ee,ae]),reactExports.createElement("input",_extends$1({type:"checkbox","aria-hidden":!0,defaultChecked:ee},ve,{tabIndex:-1,ref:ye,style:{...ie.style,...Ke,position:"absolute",pointerEvents:"none",opacity:0,margin:0}}))};function $6be4966fd9bbc698$var$getState(ie){return ie?"checked":"unchecked"}const $6be4966fd9bbc698$export$be92b6f5f03c0fe9=$6be4966fd9bbc698$export$b5d5cf8927ab7262,$6be4966fd9bbc698$export$6521433ed15a34db=$6be4966fd9bbc698$export$4d07bf653ea69106,ht=ie=>{const Z=ie.toString().split(":"),ee=Math.ceil(parseInt(Z[0])),ae=Math.ceil(parseInt(Z[1])),ve=xt(Math.ceil(parseInt(Z[2])),2);let ye=`${ee!==0&&ae<10?(ae+"").padStart(2,"0"):ae}:${ve}`;return ee!==0&&(ye=`${ee}:${ye}`),ye},Ee=ie=>{const Z=new Date(ie*1e3).toISOString().substr(11,8);return ht(Z)},we=(ie,Z)=>{if(typeof ie!="object"||ie===null)return Z;for(const ee in Z)typeof Z[ee]=="object"&&Z[ee]!==null&&!Array.isArray(Z[ee])?(ie[ee]||(ie[ee]={}),ie[ee]=we(ie[ee],Z[ee])):ie[ee]=Z[ee];return ie},Ce=(ie,Z)=>Object.hasOwn(ie,Z)?ie[Z].toString():void 0,xt=(ie,Z)=>String(ie).padStart(Z,"0"),j={background:"transparent",canvasBackgroundColor:"#6662",canvasHeight:"61.8vh",ignoreCaptionLabels:[],informationPanel:{open:!0,renderAbout:!0,renderSupplementing:!0,renderToggle:!0},openSeadragon:{},requestHeaders:{"Content-Type":"application/json"},showIIIFBadge:!0,showTitle:!0,withCredentials:!1};var xe;const _={activeCanvas:"",activeManifest:"",collection:{},configOptions:j,customDisplays:[],informationOpen:(xe=j==null?void 0:j.informationPanel)==null?void 0:xe.open,isLoaded:!1,vault:new Vault},Se=e$1.createContext(_),ke=e$1.createContext(_);function vt(ie,Z){switch(Z.type){case"updateActiveCanvas":return Z.canvasId||(Z.canvasId=""),{...ie,activeCanvas:Z.canvasId};case"updateActiveManifest":return{...ie,activeManifest:Z.manifestId};case"updateCollection":return{...ie,collection:Z.collection};case"updateConfigOptions":return{...ie,configOptions:we(ie.configOptions,Z.configOptions)};case"updateInformationOpen":return{...ie,informationOpen:Z.informationOpen};case"updateIsLoaded":return{...ie,isLoaded:Z.isLoaded};default:throw new Error(`Unhandled action type: ${Z.type}`)}}const bt=({initialState:ie=_,children:Z})=>{const[ee,ae]=reactExports.useReducer(vt,ie);return e$1.createElement(Se.Provider,{value:ee},e$1.createElement(ke.Provider,{value:ae},Z))};function k(){const ie=e$1.useContext(Se);if(ie===void 0)throw new Error("useViewerState must be used within a ViewerProvider");return ie}function O(){const ie=e$1.useContext(ke);if(ie===void 0)throw new Error("useViewerDispatch must be used within a ViewerProvider");return ie}const Ie=(ie,Z,ee,ae)=>{var ve,ye;const be={canvas:void 0,accompanyingCanvas:void 0,annotationPage:void 0,annotations:[]},Ke=Ye=>{if(Ye){if(!Ye.body||!Ye.motivation){console.error("Invalid annotation after Hyperion parsing: missing either 'body' or 'motivation'",Ye);return}let Xe=Ye.body;Array.isArray(Xe)&&(Xe=Xe[0]);const Qe=ie.get(Xe.id);if(!Qe)return;switch(ee){case"painting":return Ye.target===Z.id&&Ye.motivation&&Ye.motivation[0]==="painting"&&ae.includes(Qe.type)&&(Ye.body=Qe),!!Ye;case"supplementing":return;default:throw new Error("Invalid annotation motivation.")}}};if(be.canvas=ie.get(Z),be.canvas&&(be.annotationPage=ie.get(be.canvas.items[0]),be.accompanyingCanvas=(ve=be.canvas)!=null&&ve.accompanyingCanvas?ie.get((ye=be.canvas)==null?void 0:ye.accompanyingCanvas):void 0),be.annotationPage){const Ye=ie.get(be.annotationPage.items).map(Qe=>({body:ie.get(Qe.body[0].id),motivation:Qe.motivation,type:"Annotation"})),Xe=[];Ye.forEach(Qe=>{Qe.body.type==="Choice"?Qe.body.items.forEach(et=>Xe.push({...Qe,id:et.id,body:ie.get(et.id)})):Xe.push(Qe)}),be.annotations=Xe.filter(Ke)}return be},D=(ie,Z="en")=>{if(!ie)return"";if(!ie[Z]){const ee=Object.getOwnPropertyNames(ie);if(ee.length>0)return ie[ee[0]]}return ie[Z]},N=(ie,Z)=>{const ee=Ie(ie,{id:Z,type:"Canvas"},"painting",["Image","Sound","Video"]);if(ee.annotations.length!==0&&ee.annotations&&ee.annotations)return ee.annotations.map(ae=>ae==null?void 0:ae.body)},yt=(ie,Z,ee)=>{const ae=ie.get({id:Z,type:"Canvas"});if(!(ae!=null&&ae.annotations)||!ae.annotations[0])return[];const ve=ie.get(ae.annotations[0]),ye=ie.get(ve.items);return Array.isArray(ye)?ye.filter(be=>{var Ke;if(be.body&&(Ke=be.motivation)!=null&&Ke.includes("supplementing")){let Ye=be.body;Array.isArray(Ye)&&(Ye=Ye[0]);const Xe=ie.get(Ye.id);if(Xe.format===ee)return be.body=Xe,be}}).map(be=>be.body):[]},Et=(ie,Z,ee,ae)=>{const ve=[];if(Z.canvas&&Z.canvas.thumbnail.length>0){const ye=ie.get(Z.canvas.thumbnail[0]);ve.push(ye)}if(Z.annotations[0]){if(Z.annotations[0].thumbnail&&Z.annotations[0].thumbnail.length>0){const be=ie.get(Z.annotations[0].thumbnail[0]);ve.push(be)}if(!Z.annotations[0].body)return;const ye=Z.annotations[0].body;ye.type==="Image"&&ve.push(ye)}return ve.length===0?void 0:{id:ve[0].id,format:ve[0].format,type:ve[0].type,width:ee,height:ae}},X=209,wt={colors:{primary:"#1a1d1e",primaryMuted:"#26292b",primaryAlt:"#151718",accent:`hsl(${X} 100% 38.2%)`,accentMuted:`hsl(${X} 80% 61.8%)`,accentAlt:`hsl(${X} 80% 30%)`,secondary:"#FFFFFF",secondaryMuted:"#e6e8eb",secondaryAlt:"#c1c8cd"},fontSizes:{1:"12px",2:"13px",3:"15px",4:"17px",5:"19px",6:"21px",7:"27px",8:"35px",9:"59px"},lineHeights:{1:"12px",2:"13px",3:"15px",4:"17px",5:"19px",6:"21px",7:"27px",8:"35px",9:"59px"},sizes:{1:"5px",2:"10px",3:"15px",4:"20px",5:"25px",6:"35px",7:"45px",8:"65px",9:"80px"},space:{1:"5px",2:"10px",3:"15px",4:"20px",5:"25px",6:"35px",7:"45px",8:"65px",9:"80px"},radii:{1:"4px",2:"6px",3:"8px",4:"12px",round:"50%",pill:"9999px"},transitions:{all:"all 300ms cubic-bezier(0.16, 1, 0.3, 1)"},zIndices:{1:"100",2:"200",3:"300",4:"400",max:"999"}},te={xxs:"(max-width: 349px)",xs:"(max-width: 575px)",sm:"(max-width: 767px)",md:"(max-width: 991px)",lg:"(max-width: 90rem)",xl:"(min-width: calc(90rem + 1px))"},{styled:m,css:ro,keyframes:ne,createTheme:oo}=q({theme:wt,media:te}),Ct=m("div",{display:"flex",flexDirection:"column",alignItems:"center"}),St=m("p",{fontWeight:"bold",fontSize:"x-large"}),kt=m("span",{fontSize:"medium"}),It=({error:ie})=>{const{message:Z}=ie;return e$1.createElement(Ct,{role:"alert"},e$1.createElement(St,{"data-testid":"headline"},"Something went wrong"),Z&&e$1.createElement(kt,null,`Error message: ${Z}`," "))},$e=m("div",{position:"relative",zIndex:"0"}),Ae=m("div",{display:"flex",flexDirection:"row",overflow:"hidden","@sm":{flexDirection:"column"}}),Te=m("div",{display:"flex",flexDirection:"column",flexGrow:"1",flexShrink:"1",width:"61.8%","@sm":{width:"100%"}}),Me=m($409067139f391064$export$41fb9f06171c75f4,{display:"none",border:"none",padding:"0",transition:"$all",opacity:"1",background:"#6663",margin:"1rem 0",borderRadius:"6px","&[data-information-panel='false']":{opacity:"0",marginTop:"-59px"},"@sm":{display:"flex","> span":{display:"flex",flexGrow:"1",fontSize:"0.8333em",justifyContent:"center",padding:"0.5rem",fontFamily:"inherit"}}}),Re=m($409067139f391064$export$7c6e2c02157bb7d2,{width:"100%",display:"flex"}),$t=m("aside",{display:"flex",flexGrow:"1",flexShrink:"0",width:"38.2%",maxHeight:"100%","@sm":{width:"100%"}}),At=m("div",{display:"flex",flexDirection:"column",fontSmooth:"auto",webkitFontSmoothing:"antialiased","> div":{display:"flex",flexDirection:"column",flexGrow:"1",justifyContent:"flex-start","@sm":{[`& ${Ae}`]:{flexGrow:"1"},[`& ${Te}`]:{flexGrow:"0"}}},"@sm":{padding:"0"},"&[data-information-panel-open='true']":{"@sm":{position:"fixed",height:"100%",width:"100%",top:"0",left:"0",zIndex:"2500000000",[`& ${$e}`]:{display:"none"},[`& ${Me}`]:{margin:"1rem"},[`& ${Re}`]:{height:"100%"}}}}),Tt=m($69cb30bb0017df05$export$be92b6f5f03c0fe9,{display:"flex",flexDirection:"column",width:"100%",height:"100%",flexGrow:"1",flexShrink:"0",position:"relative",zIndex:"1",maskImage:"linear-gradient(180deg, rgba(0, 0, 0, 1) calc(100% - 2rem), transparent 100%)","@sm":{marginTop:"0.5rem",boxShadow:"none"}}),Mt=m($69cb30bb0017df05$export$54c2e3dc7acea9f5,{display:"flex",flexGrow:"0",margin:"0 1.618rem",borderBottom:"4px solid #6663","@sm":{margin:"0 1rem"}}),se=m($69cb30bb0017df05$export$41fb9f06171c75f4,{display:"flex",position:"relative",padding:"0.5rem 1rem",background:"none",backgroundColor:"transparent",fontFamily:"inherit",border:"none",opacity:"0.7",fontSize:"1rem",marginRight:"1rem",lineHeight:"1rem",whiteSpace:"nowrap",cursor:"pointer",fontWeight:400,transition:"$all","&::after":{width:"0",height:"4px",content:"",position:"absolute",bottom:"-4px",left:"0",transition:"$all"},"&[data-state='active']":{opacity:"1",fontWeight:700,"&::after":{width:"100%",backgroundColor:"$accent"}}}),ce=m($69cb30bb0017df05$export$7c6e2c02157bb7d2,{display:"flex",flexGrow:"1",flexShrink:"0",position:"absolute",top:"0",left:"0","&[data-state='active']":{width:"100%",height:"calc(100% - 2rem)",padding:"1.618rem 0"}}),Rt=m("div",{position:"relative",height:"100%",width:"100%",overflowY:"scroll"}),zt=m("div",{padding:" 0 1.618rem 2rem",display:"flex",flexDirection:"column",overflow:"scroll",position:"absolute",fontWeight:"400",fontSize:"1rem",zIndex:"0",img:{maxWidth:"100px",maxHeight:"100px",objectFit:"contain",color:"transparent",margin:"0 0 1rem",borderRadius:"3px",backgroundColor:"$secondaryMuted"},video:{display:"none"},"a, a:visited":{color:"$accent"},p:{fontSize:"1rem",lineHeight:"1.45em",margin:"0"},dl:{margin:"0",dt:{fontWeight:"700",margin:"1rem 0 0.25rem"},dd:{margin:"0"}},".manifest-property-title":{fontWeight:"700",margin:"1rem 0 0.25rem"},"ul, ol":{padding:"0",margin:"0",li:{fontSize:"1rem",lineHeight:"1.45em",listStyle:"none",margin:"0.25rem 0 0.25rem"}}}),Lt=m("div",{position:"relative",width:"100%",height:"100%",zIndex:"0"}),ze=(ie,Z="none")=>{if(!ie)return null;if(typeof ie=="string")return[ie];if(!ie[Z]){const ee=Object.getOwnPropertyNames(ie);if(ee.length>0)return ie[ee[0]]}return!ie[Z]||!Array.isArray(ie[Z])?null:ie[Z]},R=(ie,Z="none",ee=", ")=>{const ae=ze(ie,Z);return Array.isArray(ae)?ae.join(`${ee}`):ae};function Ft(ie){return{__html:Pt(ie)}}function T(ie,Z){const ee=Object.keys(ie).filter(ve=>Z.includes(ve)?null:ve),ae=new Object;return ee.forEach(ve=>{ae[ve]=ie[ve]}),ae}function Pt(ie){return at(ie,{allowedAttributes:{a:["href"],img:["alt","src","height","width"]},allowedSchemes:["http","https","mailto"],allowedTags:["a","b","br","i","img","p","small","span","sub","sup"]})}const Vt=m("span",{}),L=ie=>{const{as:Z,label:ee}=ie,ae=T(ie,["as","label"]);return e$1.createElement(Vt,{as:Z,...ae},R(ee,ae.lang))},Bt=(ie,Z="200,",ee="full")=>{Array.isArray(ie)&&(ie=ie[0]);const{id:ae,service:ve}=ie;let ye;if(!ve)return ae;if(Array.isArray(ie.service)&&ie.service.length>0&&(ye=ve[0]),ye){if(ye["@id"])return`${ye["@id"]}/${ee}/${Z}/0/default.jpg`;if(ye.id)return`${ye.id}/${ee}/${Z}/0/default.jpg`}},de=m("img",{objectFit:"cover"}),Ht=ie=>{const Z=reactExports.useRef(null),{contentResource:ee,altAsLabel:ae,region:ve="full"}=ie;let ye;ae&&(ye=R(ae));const be=T(ie,["contentResource","altAsLabel"]),{type:Ke,id:Ye,width:Xe=200,height:Qe=200,duration:et}=ee;reactExports.useEffect(()=>{if(!Ye&&!Z.current||["Image"].includes(Ke)||!Ye.includes("m3u8"))return;const it=new Hls;return Z.current&&(it.attachMedia(Z.current),it.on(Hls.Events.MEDIA_ATTACHED,function(){it.loadSource(Ye)})),it.on(Hls.Events.ERROR,function(nt,tt){if(tt.fatal)switch(tt.type){case Hls.ErrorTypes.NETWORK_ERROR:console.error(`fatal ${nt} network error encountered, try to recover`),it.startLoad();break;case Hls.ErrorTypes.MEDIA_ERROR:console.error(`fatal ${nt} media error encountered, try to recover`),it.recoverMediaError();break;default:it.destroy();break}}),()=>{it&&(it.detachMedia(),it.destroy())}},[Ye,Ke]);const Je=reactExports.useCallback(()=>{if(!Z.current)return;let it=0,nt=30;if(et&&(nt=et),!Ye.split("#t=")&&et&&(it=et*.1),Ye.split("#t=").pop()){const st=Ye.split("#t=").pop();st&&(it=parseInt(st.split(",")[0]))}const tt=Z.current;tt.autoplay=!0,tt.currentTime=it,setTimeout(()=>Je(),nt*1e3)},[et,Ye]);reactExports.useEffect(()=>Je(),[Je]);const rt=Bt(ee,`${Xe},${Qe}`,ve);switch(Ke){case"Image":return e$1.createElement(de,{as:"img",alt:ye,css:{width:Xe,height:Qe},key:Ye,src:rt,...be});case"Video":return e$1.createElement(de,{as:"video",css:{width:Xe,height:Qe},disablePictureInPicture:!0,key:Ye,loop:!0,muted:!0,onPause:Je,ref:Z,src:Ye});default:return console.warn(`Resource type: ${Ke} is not valid or not yet supported in Primitives.`),e$1.createElement(e$1.Fragment,null)}},Ot=m("a",{}),Dt=ie=>{const{children:Z,homepage:ee}=ie,ae=T(ie,["children","homepage"]);return e$1.createElement(e$1.Fragment,null,ee&&ee.map(ve=>{const ye=R(ve.label,ae.lang);return e$1.createElement(Ot,{"aria-label":Z?ye:void 0,href:ve.id,key:ve.id,...ae},Z||ye)}))},Wt={delimiter:", "},re=reactExports.createContext(void 0),Le=()=>{const ie=reactExports.useContext(re);if(ie===void 0)throw new Error("usePrimitivesContext must be used with a PrimitivesProvider");return ie},oe=({children:ie,initialState:Z=Wt})=>{const ee=jt(Z,"delimiter");return e$1.createElement(re.Provider,{value:{delimiter:ee}},ie)},jt=(ie,Z)=>Object.hasOwn(ie,Z)?ie[Z].toString():void 0,Nt=m("span",{}),me=ie=>{const{as:Z,markup:ee}=ie,{delimiter:ae}=Le();if(!ee)return e$1.createElement(e$1.Fragment,null);const ve=T(ie,["as","markup"]),ye=Ft(R(ee,ve.lang,ae));return e$1.createElement(Nt,{as:Z,...ve,dangerouslySetInnerHTML:ye})},Fe=ie=>e$1.useContext(re)?e$1.createElement(me,{...ie}):e$1.createElement(oe,null,e$1.createElement(me,{...ie})),Gt=({as:ie="dd",lang:Z,value:ee})=>e$1.createElement(Fe,{markup:ee,as:ie,lang:Z}),qt=m("span",{}),Ut=({as:ie="dd",customValueContent:Z,lang:ee,value:ae})=>{var ve;const{delimiter:ye}=Le(),be=(ve=ze(ae,ee))==null?void 0:ve.map(Ke=>reactExports.cloneElement(Z,{value:Ke}));return e$1.createElement(qt,{as:ie,lang:ee},be==null?void 0:be.map((Ke,Ye)=>[Ye>0&&`${ye}`,e$1.createElement(reactExports.Fragment,{key:Ye},Ke)]))},Pe=ie=>{var Z;const{item:ee,lang:ae,customValueContent:ve}=ie,{label:ye,value:be}=ee,Ke=(Z=R(ye))==null?void 0:Z.replace(" ","-").toLowerCase();return e$1.createElement("div",{role:"group","data-label":Ke},e$1.createElement(L,{as:"dt",label:ye,lang:ae}),ve?e$1.createElement(Ut,{as:"dd",customValueContent:ve,value:be,lang:ae}):e$1.createElement(Gt,{as:"dd",value:be,lang:ae}))};function _t(ie,Z){const ee=Z.filter(ae=>{const{matchingLabel:ve}=ae,ye=Object.keys(ae.matchingLabel)[0],be=R(ve,ye);if(R(ie,ye)===be)return!0}).map(ae=>ae.Content);if(Array.isArray(ee))return ee[0]}const Zt=m("dl",{}),Xt=ie=>{const{as:Z,customValueContent:ee,metadata:ae}=ie;if(!Array.isArray(ae))return e$1.createElement(e$1.Fragment,null);const ve=Ce(ie,"customValueDelimiter"),ye=T(ie,["as","customValueContent","customValueDelimiter","metadata"]);return e$1.createElement(oe,{...typeof ve=="string"?{initialState:{delimiter:ve}}:void 0},ae.length>0&&e$1.createElement(Zt,{as:Z,...ye},ae.map((be,Ke)=>{const Ye=ee?_t(be.label,ee):void 0;return e$1.createElement(Pe,{customValueContent:Ye,item:be,key:Ke,lang:ye==null?void 0:ye.lang})})))};m("li",{});m("ul",{});const Yt=m("dl",{}),Kt=ie=>{const{as:Z,requiredStatement:ee}=ie;if(!ee)return e$1.createElement(e$1.Fragment,null);const ae=Ce(ie,"customValueDelimiter"),ve=T(ie,["as","customValueDelimiter","requiredStatement"]);return e$1.createElement(oe,{...typeof ae=="string"?{initialState:{delimiter:ae}}:void 0},e$1.createElement(Yt,{as:Z,...ve},e$1.createElement(Pe,{item:ee,lang:ve.lang})))},Jt=m("li",{}),Qt=m("ul",{}),en=ie=>{const{as:Z,seeAlso:ee}=ie,ae=T(ie,["as","seeAlso"]);return e$1.createElement(Qt,{as:Z},ee&&ee.map(ve=>{const ye=R(ve.label,ae.lang);return e$1.createElement(Jt,{key:ve.id},e$1.createElement("a",{href:ve.id,...ae},ye||ve.id))}))},tn=ie=>{const{as:Z,summary:ee}=ie,ae=T(ie,["as","customValueDelimiter","summary"]);return e$1.createElement(Fe,{as:Z,markup:ee,...ae})},Ve=ie=>{const{thumbnail:Z,region:ee}=ie,ae=T(ie,["thumbnail"]);return e$1.createElement(e$1.Fragment,null,Z&&Z.map(ve=>e$1.createElement(Ht,{contentResource:ve,key:ve.id,region:ee,...ae})))},nn=({homepage:ie})=>(ie==null?void 0:ie.length)===0?e$1.createElement(e$1.Fragment,null):e$1.createElement(e$1.Fragment,null,e$1.createElement("span",{className:"manifest-property-title"},"Homepage"),e$1.createElement(Dt,{homepage:ie})),rn=({id:ie,htmlLabel:Z,parent:ee="manifest"})=>e$1.createElement(e$1.Fragment,null,e$1.createElement("span",{className:"manifest-property-title"},Z),e$1.createElement("a",{href:ie,target:"_blank",id:`iiif-${ee}-id`},ie)),on=({metadata:ie,parent:Z="manifest"})=>ie?e$1.createElement(e$1.Fragment,null,e$1.createElement(Xt,{metadata:ie,id:`iiif-${Z}-metadata`})):e$1.createElement(e$1.Fragment,null),an=({requiredStatement:ie,parent:Z="manifest"})=>ie?e$1.createElement(e$1.Fragment,null,e$1.createElement(Kt,{requiredStatement:ie,id:`iiif-${Z}-required-statement`})):e$1.createElement(e$1.Fragment,null),ln=({rights:ie})=>ie?e$1.createElement(e$1.Fragment,null,e$1.createElement("span",{className:"manifest-property-title"},"Rights"),e$1.createElement("a",{href:ie,target:"_blank"},ie)):e$1.createElement(e$1.Fragment,null),sn=({seeAlso:ie})=>(ie==null?void 0:ie.length)===0?e$1.createElement(e$1.Fragment,null):e$1.createElement(e$1.Fragment,null,e$1.createElement("span",{className:"manifest-property-title"},"See Also"),e$1.createElement(en,{seeAlso:ie})),cn=({summary:ie,parent:Z="manifest"})=>ie?e$1.createElement(e$1.Fragment,null,e$1.createElement(tn,{summary:ie,as:"p",id:`iiif-${Z}-summary`})):e$1.createElement(e$1.Fragment,null),dn=({label:ie,thumbnail:Z})=>(Z==null?void 0:Z.length)===0?e$1.createElement(e$1.Fragment,null):e$1.createElement(e$1.Fragment,null,e$1.createElement(Ve,{altAsLabel:ie||{none:["resource"]},thumbnail:Z,style:{backgroundColor:"#6663",objectFit:"cover"}})),mn=()=>{const ie=k(),{activeManifest:Z,vault:ee}=ie,[ae,ve]=reactExports.useState(),[ye,be]=reactExports.useState([]),[Ke,Ye]=reactExports.useState([]),[Xe,Qe]=reactExports.useState([]);return reactExports.useEffect(()=>{var et,Je,rt;const it=ee.get(Z);ve(it),((et=it.homepage)==null?void 0:et.length)>0&&be(ee.get(it.homepage)),((Je=it.seeAlso)==null?void 0:Je.length)>0&&Ye(ee.get(it.seeAlso)),((rt=it.thumbnail)==null?void 0:rt.length)>0&&Qe(ee.get(it.thumbnail))},[Z,ee]),ae?e$1.createElement(Lt,null,e$1.createElement(zt,null,e$1.createElement(dn,{thumbnail:Xe,label:ae.label}),e$1.createElement(cn,{summary:ae.summary}),e$1.createElement(on,{metadata:ae.metadata}),e$1.createElement(an,{requiredStatement:ae.requiredStatement}),e$1.createElement(ln,{rights:ae.rights}),e$1.createElement(nn,{homepage:ye}),e$1.createElement(sn,{seeAlso:Ke}),e$1.createElement(rn,{id:ae.id,htmlLabel:"IIIF Manifest"}))):e$1.createElement(e$1.Fragment,null)},un=()=>{function ie(ve){return ve.map(ye=>{const be=ye.identifier||v4();return{...ye,identifier:be}})}function Z(ve){var ye;const be=[],Ke=[],Ye=ie(ve);for(const Xe of Ye){for(;Ke.length>0&&Ke[Ke.length-1].end<=Xe.start;)Ke.pop();Ke.length>0?(Ke[Ke.length-1].children||(Ke[Ke.length-1].children=[]),(ye=Ke[Ke.length-1].children)==null||ye.push(Xe),Ke.push(Xe)):(be.push(Xe),Ke.push(Xe))}return be}function ee(ve,ye=[]){return ye.some(be=>ve.start>=be.start&&ve.end<=be.end)}function ae(ve=[]){return ve.sort((ye,be)=>ye.start-be.start)}return{addIdentifiersToParsedCues:ie,createNestedCues:Z,isChild:ee,orderCuesByTime:ae}},ue=ne({from:{transform:"rotate(360deg)"},to:{transform:"rotate(0deg)"}}),pn=m($f99a8c78507165f7$export$be92b6f5f03c0fe9,{display:"flex",flexDirection:"column",width:"100%"}),Be=m($f99a8c78507165f7$export$6d08773d2e66f8f2,{position:"relative",cursor:"pointer",display:"flex",width:"100%",justifyContent:"space-between",textAlign:"left",margin:"0",padding:"0.5rem 1.618rem",fontFamily:"inherit",lineHeight:"1.25em",fontSize:"1rem",color:"inherit",border:"none",background:"none","@sm":{padding:"0.5rem 1rem",fontSize:"0.8333rem"},"&::before":{content:"",width:"12px",height:"12px",borderRadius:"12px",position:"absolute",backgroundColor:"$primaryMuted",opacity:"0",left:"8px",marginTop:"3px",boxSizing:"content-box","@sm":{content:"unset"}},"&::after":{content:"",width:"4px",height:"6px",position:"absolute",backgroundColor:"$secondary",opacity:"0",clipPath:"polygon(100% 50%, 0 100%, 0 0)",left:"13px",marginTop:"6px",boxSizing:"content-box","@sm":{content:"unset"}},strong:{marginLeft:"1rem"},"&:hover":{color:"$accent","&::before":{backgroundColor:"$accent",opacity:"1"},"&::after":{content:"",width:"4px",height:"6px",position:"absolute",backgroundColor:"$secondary",clipPath:"polygon(100% 50%, 0 100%, 0 0)",opacity:"1"}},"&[aria-checked='true']":{backgroundColor:"#6663","&::before":{content:"",width:"6px",height:"6px",position:"absolute",backgroundColor:"transparent",border:"3px solid $accentMuted",borderRadius:"12px",left:"8px",marginTop:"4px",opacity:"1",animation:"1s linear infinite",animationName:ue,boxSizing:"content-box","@sm":{content:"unset"}},"&::after":{content:"",width:"6px",height:"6px",position:"absolute",backgroundColor:"transparent",border:"3px solid $accent",clipPath:"polygon(100% 0, 100% 100%, 0 0)",borderRadius:"12px",left:"8px",marginTop:"4px",opacity:"1",animation:"1.5s linear infinite",animationName:ue,boxSizing:"content-box","@sm":{content:"unset"}}}}),fn=({label:ie,start:Z,end:ee})=>{const[ae,ve]=reactExports.useState(!1),ye=document.getElementById("clover-iiif-video");reactExports.useEffect(()=>(ye==null||ye.addEventListener("timeupdate",()=>{const{currentTime:Ke}=ye;ve(Z<=Ke&&Ke<ee)}),()=>document.removeEventListener("timeupdate",()=>{})),[ee,Z,ye]);const be=()=>{ye&&(ye.pause(),ye.currentTime=Z,ye.play())};return e$1.createElement(Be,{"aria-checked":ae,"data-testid":"information-panel-cue",onClick:be,value:ie},ie,e$1.createElement("strong",null,Ee(Z)))},gn=m("ul",{listStyle:"none",paddingLeft:"1rem",position:"relative","&&:first-child":{paddingLeft:"0"},"& li ul":{[`& ${Be}`]:{backgroundColor:"unset","&::before":{content:"none"},"&::after":{content:"none"}}},"&:first-child":{margin:"0 0 1.618rem"}}),He=({items:ie})=>e$1.createElement(gn,null,ie.map(Z=>{const{text:ee,start:ae,end:ve,children:ye,identifier:be}=Z;return e$1.createElement("li",{key:be},e$1.createElement(fn,{label:ee,start:ae,end:ve}),ye&&e$1.createElement(He,{items:ye}))})),hn=({resource:ie})=>{const[Z,ee]=e$1.useState([]),{id:ae,label:ve}=ie,{createNestedCues:ye,orderCuesByTime:be}=un();return reactExports.useEffect(()=>{ae&&fetch(ae,{headers:{"Content-Type":"text/plain",Accept:"application/json"}}).then(Ke=>Ke.text()).then(Ke=>{const Ye=nodeWebvtt.parse(Ke).cues,Xe=be(Ye),Qe=ye(Xe);ee(Qe)}).catch(Ke=>console.error(ae,Ke.toString()))},[ae]),e$1.createElement(pn,{"aria-label":`navigate ${D(ve,"en")}`},e$1.createElement(He,{items:Z}))},xn=({activeCanvas:ie,resources:Z})=>{var ee;const ae=k(),{configOptions:ve}=ae,{informationPanel:ye}=ve,[be,Ke]=reactExports.useState(),Ye=(ye==null?void 0:ye.renderAbout)||((ee=ve==null?void 0:ve.informationPanel)==null?void 0:ee.renderAbout),Xe=ye==null?void 0:ye.renderSupplementing;reactExports.useEffect(()=>{Ye?Ke("manifest-about"):Z&&(Z==null?void 0:Z.length)>0&&!Ye&&Ke(Z[0].id)},[ie,Ye,Z]);const Qe=et=>{Ke(et)};return Z?e$1.createElement(Tt,{"data-testid":"information-panel",defaultValue:be,onValueChange:Qe,orientation:"horizontal",value:be,className:"clover-viewer-information-panel"},e$1.createElement(Mt,{"aria-label":"select chapter","data-testid":"information-panel-list"},Ye&&e$1.createElement(se,{value:"manifest-about"},"About"),Xe&&Z&&Z.map(({id:et,label:Je})=>e$1.createElement(se,{key:et,value:et},e$1.createElement(L,{label:Je})))),e$1.createElement(Rt,null,Ye&&e$1.createElement(ce,{value:"manifest-about"},e$1.createElement(mn,null)),Xe&&Z&&Z.map(et=>e$1.createElement(ce,{key:et.id,value:et.id},e$1.createElement(hn,{resource:et}))))):e$1.createElement(e$1.Fragment,null)},Oe=m("div",{position:"absolute",right:"1rem",top:"1rem",display:"flex",justifyContent:"flex-end",zIndex:"1"}),vn=m("input",{flexGrow:"1",border:"none",backgroundColor:"$secondaryMuted",color:"$primary",marginRight:"1rem",height:"2rem",padding:"0 1rem",borderRadius:"2rem",fontFamily:"inherit",fontSize:"1rem",lineHeight:"1rem",boxShadow:"inset 1px 1px 2px #0003","&::placeholder":{color:"$primaryMuted"}}),Y=m("button",{display:"flex",background:"none",border:"none",width:"2rem !important",height:"2rem !important",padding:"0",margin:"0",fontWeight:"700",borderRadius:"2rem",backgroundColor:"$accent",color:"$secondary",cursor:"pointer",boxSizing:"content-box !important",transition:"$all",svg:{height:"60%",width:"60%",padding:"20%",fill:"$secondary",stroke:"$secondary",opacity:"1",filter:"drop-shadow(5px 5px 5px #000D)",boxSizing:"inherit",transition:"$all"},"&:disabled":{backgroundColor:"transparent",boxShadow:"none",svg:{opacity:"0.25"}}}),bn=m("div",{display:"flex",marginRight:"0.618rem",backgroundColor:"$accentAlt",borderRadius:"2rem",boxShadow:"5px 5px 5px #0003",color:"$secondary",alignItems:"center","> span":{display:"flex",margin:"0 0.5rem",fontSize:"0.7222rem"}}),yn=m("div",{display:"flex",position:"relative",zIndex:"1",width:"100%",padding:"0",transition:"$all",variants:{isToggle:{true:{paddingTop:"2.618rem",[`& ${Oe}`]:{width:"calc(100% - 2rem)","@sm":{width:"calc(100% - 2rem)"}}}}}}),En=(ie,Z)=>{reactExports.useEffect(()=>{function ee(ae){ae.key===ie&&Z()}return window.addEventListener("keyup",ee),()=>window.removeEventListener("keyup",ee)},[])},wn=()=>e$1.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},e$1.createElement("title",null,"Arrow Back"),e$1.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M244 400L100 256l144-144M120 256h292"})),Cn=()=>e$1.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},e$1.createElement("title",null,"Arrow Forward"),e$1.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M268 112l144 144-144 144M392 256H100"})),Sn=()=>e$1.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},e$1.createElement("title",null,"Close"),e$1.createElement("path",{d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"})),kn=()=>e$1.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},e$1.createElement("title",null,"Search"),e$1.createElement("path",{d:"M456.69 421.39L362.6 327.3a173.81 173.81 0 0034.84-104.58C397.44 126.38 319.06 48 222.72 48S48 126.38 48 222.72s78.38 174.72 174.72 174.72A173.81 173.81 0 00327.3 362.6l94.09 94.09a25 25 0 0035.3-35.3zM97.92 222.72a124.8 124.8 0 11124.8 124.8 124.95 124.95 0 01-124.8-124.8z"})),In=({handleCanvasToggle:ie,handleFilter:Z,activeIndex:ee,canvasLength:ae})=>{const[ve,ye]=reactExports.useState(!1),[be,Ke]=reactExports.useState(!1),[Ye,Xe]=reactExports.useState(!1);reactExports.useEffect(()=>{Xe(ee===0),ee===ae-1?Ke(!0):Ke(!1)},[ee,ae]),En("Escape",()=>{ye(!1),Z("")});const Qe=()=>{ye(Je=>!Je),Z("")},et=Je=>Z(Je.target.value);return e$1.createElement(yn,{isToggle:ve},e$1.createElement(Oe,null,ve&&e$1.createElement(vn,{autoFocus:!0,onChange:et,placeholder:"Search"}),!ve&&e$1.createElement(bn,null,e$1.createElement(Y,{onClick:()=>ie(-1),disabled:Ye,type:"button"},e$1.createElement(wn,null)),e$1.createElement("span",null,ee+1," of ",ae),e$1.createElement(Y,{onClick:()=>ie(1),disabled:be,type:"button"},e$1.createElement(Cn,null))),e$1.createElement(Y,{onClick:Qe,type:"button"},ve?e$1.createElement(Sn,null):e$1.createElement(kn,null))))},$n=m($f99a8c78507165f7$export$be92b6f5f03c0fe9,{display:"flex",flexDirection:"row",flexGrow:"1",padding:"1.618rem",overflowX:"scroll",position:"relative",zIndex:"0"}),An=()=>e$1.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M256 112v288M400 256H112"}),Tn=()=>e$1.createElement(e$1.Fragment,null,e$1.createElement("path",{d:"M232 416a23.88 23.88 0 01-14.2-4.68 8.27 8.27 0 01-.66-.51L125.76 336H56a24 24 0 01-24-24V200a24 24 0 0124-24h69.75l91.37-74.81a8.27 8.27 0 01.66-.51A24 24 0 01256 120v272a24 24 0 01-24 24zm-106.18-80zm-.27-159.86zM320 336a16 16 0 01-14.29-23.19c9.49-18.87 14.3-38 14.3-56.81 0-19.38-4.66-37.94-14.25-56.73a16 16 0 0128.5-14.54C346.19 208.12 352 231.44 352 256c0 23.86-6 47.81-17.7 71.19A16 16 0 01320 336z"}),e$1.createElement("path",{d:"M368 384a16 16 0 01-13.86-24C373.05 327.09 384 299.51 384 256c0-44.17-10.93-71.56-29.82-103.94a16 16 0 0127.64-16.12C402.92 172.11 416 204.81 416 256c0 50.43-13.06 83.29-34.13 120a16 16 0 01-13.87 8z"}),e$1.createElement("path",{d:"M416 432a16 16 0 01-13.39-24.74C429.85 365.47 448 323.76 448 256c0-66.5-18.18-108.62-45.49-151.39a16 16 0 1127-17.22C459.81 134.89 480 181.74 480 256c0 64.75-14.66 113.63-50.6 168.74A16 16 0 01416 432z"})),Mn=()=>e$1.createElement("path",{d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"}),Rn=()=>e$1.createElement("path",{d:"M416 64H96a64.07 64.07 0 00-64 64v256a64.07 64.07 0 0064 64h320a64.07 64.07 0 0064-64V128a64.07 64.07 0 00-64-64zm-80 64a48 48 0 11-48 48 48.05 48.05 0 0148-48zM96 416a32 32 0 01-32-32v-67.63l94.84-84.3a48.06 48.06 0 0165.8 1.9l64.95 64.81L172.37 416zm352-32a32 32 0 01-32 32H217.63l121.42-121.42a47.72 47.72 0 0161.64-.16L448 333.84z"}),zn=()=>e$1.createElement("path",{d:"M464 384.39a32 32 0 01-13-2.77 15.77 15.77 0 01-2.71-1.54l-82.71-58.22A32 32 0 01352 295.7v-79.4a32 32 0 0113.58-26.16l82.71-58.22a15.77 15.77 0 012.71-1.54 32 32 0 0145 29.24v192.76a32 32 0 01-32 32zM268 400H84a68.07 68.07 0 01-68-68V180a68.07 68.07 0 0168-68h184.48A67.6 67.6 0 01336 179.52V332a68.07 68.07 0 01-68 68z"}),De=m("svg",{display:"inline-flex",variants:{isLarge:{true:{height:"4rem",width:"4rem"}},isMedium:{true:{height:"2rem",width:"2rem"}},isSmall:{true:{height:"1rem",width:"1rem"}}}}),Ln=({children:ie})=>e$1.createElement("title",null,ie),S=ie=>e$1.createElement(De,{...ie,"data-testid":"icon-svg",role:"img",viewBox:"0 0 512 512",xmlns:"http://www.w3.org/2000/svg"},ie.children);S.Title=Ln;S.Add=An;S.Audio=Tn;S.Close=Mn;S.Image=Rn;S.Video=zn;const Fn=ne({"0%":{opacity:0,transform:"translateY(1rem)"},"100%":{opacity:1,transform:"translateY(0)"}}),Pn=ne({"0%":{opacity:0,transform:"translateY(1rem)"},"100%":{opacity:1,transform:"translateY(0)"}}),We=m($cb5cc270b50c6fcd$export$21b07c8f274aebd5,{fill:"$secondaryAlt"}),Vn=m($cb5cc270b50c6fcd$export$f39c2d165cd861fe,{position:"absolute",right:"0",top:"0",padding:"0.5rem",margin:"0",cursor:"pointer",border:"none",background:"none",fill:"inherit","&:hover":{opacity:"0.75"}}),Bn=m($cb5cc270b50c6fcd$export$7c6e2c02157bb7d2,{border:"none",backgroundColor:"white",fill:"inhrerit",padding:"1rem 2rem 1rem 1rem",width:"auto",minWidth:"200px",maxWidth:"350px",borderRadius:"3px",boxShadow:"5px 5px 13px #0002",animationDuration:"0.3s",animationTimingFunction:"cubic-bezier(0.16, 1, 0.3, 1)",'&[data-side="top"]':{animationName:Pn},'&[data-side="bottom"]':{animationName:Fn},'&[data-align="end"]':{[`& ${We}`]:{margin:"0 0.7rem"}}}),Hn=m($cb5cc270b50c6fcd$export$41fb9f06171c75f4,{display:"inline-flex",padding:"0.5rem 0",margin:"0 0.5rem 0 0",cursor:"pointer",border:"none",background:"none","> button, > span":{margin:"0"}}),On=m($cb5cc270b50c6fcd$export$be92b6f5f03c0fe9,{boxSizing:"content-box"}),Dn=ie=>e$1.createElement(Hn,{...ie},ie.children),Wn=ie=>e$1.createElement(Bn,{...ie},e$1.createElement(We,null),e$1.createElement(Vn,null,e$1.createElement(S,{isSmall:!0},e$1.createElement(S.Close,null))),ie.children),W=({children:ie})=>e$1.createElement(On,null,ie);W.Trigger=Dn;W.Content=Wn;const J=m("div",{boxSizing:"border-box",display:"inline-flex",alignItems:"center",borderRadius:"5px",padding:"$1",marginBottom:"$2",marginRight:"$2",backgroundColor:"$lightGrey",color:"$richBlack50",textTransform:"uppercase",fontSize:"$2",objectFit:"contain",lineHeight:"1em !important","&:last-child":{marginRight:"0"},[`${De}`]:{position:"absolute",left:"$1",height:"$3",width:"$3"},variants:{isIcon:{true:{position:"relative",paddingLeft:"$5"}}}}),Q=m("span",{display:"flex"}),jn=m("span",{display:"flex",width:"1.2111rem",height:"0.7222rem"}),Nn=m("span",{display:"inline-flex",marginLeft:"5px",marginBottom:"-1px"}),Gn=m($f99a8c78507165f7$export$6d08773d2e66f8f2,{display:"flex",flexShrink:"0",margin:"0 1.618rem 0 0",padding:"0",cursor:"pointer",background:"none",border:"none",fontFamily:"inherit",lineHeight:"1.25em",fontSize:"1rem",textAlign:"left","&:last-child":{marginRight:"1rem"},figure:{margin:"0",width:"161.8px","> div":{position:"relative",display:"flex",backgroundColor:"$secondaryAlt",width:"inherit",height:"100px",overflow:"hidden",borderRadius:"3px",transition:"$all",img:{width:"100%",height:"100%",objectFit:"cover",filter:"blur(0)",transform:"scale3d(1, 1, 1)",transition:"$all",color:"transparent"},[`& ${Q}`]:{position:"absolute",right:"0",bottom:"0",[`& ${J}`]:{margin:"0",paddingLeft:"0",fontSize:"0.7222rem",backgroundColor:"#000d",color:"$secondary",fill:"$secondary",borderBottomLeftRadius:"0",borderTopRightRadius:"0"}}},figcaption:{marginTop:"0.5rem",fontWeight:"400",fontSize:"0.8333rem",display:"-webkit-box",overflow:"hidden",MozBoxOrient:"vertical",WebkitBoxOrient:"vertical",WebkitLineClamp:"5","@sm":{fontSize:"0.8333rem"}}},"&[aria-checked='true']":{figure:{"> div":{backgroundColor:"$primaryAlt","&::before":{position:"absolute",zIndex:"1",color:"$secondaryMuted",content:"Active Item",textTransform:"uppercase",fontWeight:"700",fontSize:"0.6111rem",letterSpacing:"0.03rem",display:"flex",width:"100%",height:"100%",flexDirection:"column",justifyContent:"center",textAlign:"center",textShadow:"5px 5px 5px #0003"},img:{opacity:"0.3",transform:"scale3d(1.1, 1.1, 1.1)",filter:"blur(2px)"},[`& ${Q}`]:{[`& ${J}`]:{backgroundColor:"$accent"}}}},figcaption:{fontWeight:"700"}}}),qn=({type:ie})=>{switch(ie){case"Sound":return e$1.createElement(S.Audio,null);case"Image":return e$1.createElement(S.Image,null);case"Video":return e$1.createElement(S.Video,null);default:return e$1.createElement(S.Image,null)}},Un=({canvas:ie,canvasIndex:Z,isActive:ee,thumbnail:ae,type:ve,handleChange:ye})=>e$1.createElement(Gn,{"aria-checked":ee,"data-testid":"media-thumbnail","data-canvas":Z,onClick:()=>ye(ie.id),value:ie.id},e$1.createElement("figure",null,e$1.createElement("div",null,(ae==null?void 0:ae.id)&&e$1.createElement("img",{src:ae.id,alt:ie!=null&&ie.label?D(ie.label):""}),e$1.createElement(Q,null,e$1.createElement(J,{isIcon:!0,"data-testid":"thumbnail-tag"},e$1.createElement(jn,null),e$1.createElement(S,{"aria-label":ve},e$1.createElement(qn,{type:ve})),["Video","Sound"].includes(ve)&&e$1.createElement(Nn,null,Ee(ie.duration))))),(ie==null?void 0:ie.label)&&e$1.createElement("figcaption",{"data-testid":"fig-caption"},e$1.createElement(L,{label:ie.label})))),_n=ie=>ie.body?ie.body.type:"Image",Zn=({items:ie})=>{const Z=O(),ee=k(),{activeCanvas:ae,vault:ve}=ee,[ye,be]=reactExports.useState(""),[Ke,Ye]=reactExports.useState([]),[Xe,Qe]=reactExports.useState(0),et=e$1.useRef(null),Je="painting",rt=tt=>{ae!==tt&&Z({type:"updateActiveCanvas",canvasId:tt})};reactExports.useEffect(()=>{if(!Ke.length){const tt=["Image","Sound","Video"],st=ie.map(ot=>Ie(ve,ot,Je,tt)).filter(ot=>ot.annotations.length>0);Ye(st)}},[ie,Ke.length,ve]),reactExports.useEffect(()=>{Ke.forEach((tt,st)=>{tt!=null&&tt.canvas&&tt.canvas.id===ae&&Qe(st)})},[ae,Ke]),reactExports.useEffect(()=>{const tt=document.querySelector(`[data-canvas="${Xe}"]`);if(tt instanceof HTMLElement&&et.current){const st=tt.offsetLeft-et.current.offsetWidth/2+tt.offsetWidth/2;et.current.scrollTo({left:st,behavior:"smooth"})}},[Xe]);const it=tt=>be(tt),nt=tt=>{const st=Ke[Xe+tt];st!=null&&st.canvas&&rt(st.canvas.id)};return e$1.createElement(e$1.Fragment,null,e$1.createElement(In,{handleFilter:it,handleCanvasToggle:nt,activeIndex:Xe,canvasLength:Ke.length}),e$1.createElement($n,{"aria-label":"select item","data-testid":"media",ref:et},Ke.filter(tt=>{var st;if((st=tt.canvas)!=null&&st.label){const ot=D(tt.canvas.label);if(Array.isArray(ot))return ot[0].toLowerCase().includes(ye.toLowerCase())}}).map((tt,st)=>{var ot,ut;return e$1.createElement(Un,{canvas:tt.canvas,canvasIndex:st,handleChange:rt,isActive:ae===((ot=tt==null?void 0:tt.canvas)==null?void 0:ot.id),key:(ut=tt==null?void 0:tt.canvas)==null?void 0:ut.id,thumbnail:Et(ve,tt,200,200),type:_n(tt.annotations[0])})})))},je=m("button",{background:"none",border:"none",cursor:"zoom-in",width:"100%",height:"100%",margin:"0",padding:"0",transition:"$all","& img":{width:"100%",height:"100%",objectFit:"contain",color:"transparent",transition:"$all"},variants:{isMedia:{true:{cursor:"pointer"}}}}),Ne=m("button",{display:"flex",height:"2rem",width:"2rem",borderRadius:"2rem",padding:"0",margin:"0",fontFamily:"inherit",background:"none",border:"none",color:"white",cursor:"pointer",marginLeft:"0.618rem",backgroundColor:"$primary",filter:"drop-shadow(2px 2px 5px #0003)",transition:"$all",boxSizing:"content-box !important","&:first-child":{marginLeft:"0"},"@xs":{marginBottom:"0.618rem",marginLeft:"0","&:last-child":{marginBottom:"0"}},svg:{height:"60%",width:"60%",padding:"20%",fill:"$secondary",stroke:"$secondary",filter:"drop-shadow(2px 2px 5px #0003)",transition:"$all",boxSizing:"inherit"},"&:hover, &:focus":{backgroundColor:"$accent"},"&#rotateRight":{"&:hover, &:focus":{svg:{rotate:"45deg"}}},"&#rotateLeft":{transform:"scaleX(-1)","&:hover, &:focus":{svg:{rotate:"45deg"}}},"&#reset":{"&:hover, &:focus":{svg:{rotate:"-15deg"}}}}),Ge=m(Ne,{position:"absolute",width:"2rem",top:"1rem",right:"1rem",zIndex:100,display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",transition:"$all",borderRadius:"50%",backgroundColor:"$accent",cursor:"pointer","&:hover, &:focus":{backgroundColor:"$accent !important"},variants:{isInteractive:{true:{"&:hover":{opacity:"1"}},false:{}},isMedia:{true:{cursor:"pointer !important"}}},compoundVariants:[{isInteractive:!1,isMedia:!0,css:{top:"50%",right:"50%",width:"4rem",height:"4rem",transform:"translate(50%,-50%)"}}]}),Xn=m("div",{position:"relative",zIndex:"0",display:"flex",flexDirection:"column",gap:"1rem","&:hover":{[`${Ge}`]:{backgroundColor:"$accent"},[`${je}`]:{backgroundColor:"#6662",img:{filter:"brightness(0.85)"}}}}),Yn=m("div",{}),Kn=m("svg",{height:"19px",color:"$accent",fill:"$accent",stroke:"$accent",display:"flex",margin:"0.25rem 0.85rem"}),Jn=m($cc7e05a45900e73f$export$41fb9f06171c75f4,{fontSize:"1.25rem",fontWeight:"400",fontFamily:"inherit",alignSelf:"flex-start",flexGrow:"1",cursor:"pointer",transition:"$all",border:"1px solid #6663",boxShadow:"2px 2px 5px #0001",borderRadius:"3px",display:"flex",alignItems:"center",paddingLeft:"0.5rem",width:"100%","@sm":{fontSize:"1rem"}}),Qn=m($cc7e05a45900e73f$export$7c6e2c02157bb7d2,{borderRadius:"3px",boxShadow:"3px 3px 8px #0003",backgroundColor:"$secondary",marginTop:"2.25rem",marginLeft:"6px",paddingBottom:"0.25rem",maxHeight:"calc(61.8vh - 2.5rem) !important",borderTopLeftRadius:"0",border:"1px solid $secondaryMuted",maxWidth:"90vw"}),er=m($cc7e05a45900e73f$export$6d08773d2e66f8f2,{display:"flex",alignItems:"center",fontFamily:"inherit",padding:"0.25rem 0.5rem",color:"$primary",fontWeight:"400",fontSize:"0.8333rem",cursor:"pointer",backgroundColor:"$secondary",width:"calc(100% - 1rem)","> span":{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"},'&[data-state="checked"]':{fontWeight:"700",color:"$primary !important"},"&:hover":{color:"$accent"},img:{width:"31px",height:"31px",marginRight:"0.5rem",borderRadius:"3px"}}),tr=m($cc7e05a45900e73f$export$b04be29aa201d4f5,{color:"$primaryMuted",fontFamily:"inherit",fontSize:"0.85rem",padding:"0.5rem 1rem 0.5rem 0.5rem",display:"flex",alignItems:"center",marginBottom:"0.25rem",borderRadius:"3px",borderTopLeftRadius:"0",borderBottomLeftRadius:"0",borderBottomRightRadius:"0",backgroundColor:"$secondaryMuted"}),qe=m($cc7e05a45900e73f$export$be92b6f5f03c0fe9,{position:"relative",zIndex:"5",width:"100%"}),K=({direction:ie,title:Z})=>{const ee=()=>e$1.createElement("path",{d:"M414 321.94L274.22 158.82a24 24 0 00-36.44 0L98 321.94c-13.34 15.57-2.28 39.62 18.22 39.62h279.6c20.5 0 31.56-24.05 18.18-39.62z"}),ae=()=>e$1.createElement("path",{d:"M98 190.06l139.78 163.12a24 24 0 0036.44 0L414 190.06c13.34-15.57 2.28-39.62-18.22-39.62h-279.6c-20.5 0-31.56 24.05-18.18 39.62z"});return e$1.createElement(Kn,{xmlns:"http://www.w3.org/2000/svg",focusable:"false",viewBox:"0 0 512 512",role:"img"},e$1.createElement("title",null,Z),ie==="up"&&e$1.createElement(ee,null),ie==="down"&&e$1.createElement(ae,null))},Ue=({children:ie,label:Z,maxHeight:ee,onValueChange:ae,value:ve})=>e$1.createElement(qe,{onValueChange:ae,value:ve},e$1.createElement(Jn,{"data-testid":"select-button"},e$1.createElement($cc7e05a45900e73f$export$e288731fd71264f0,{"data-testid":"select-button-value"}),e$1.createElement($cc7e05a45900e73f$export$99b400cabb58c515,null,e$1.createElement(K,{direction:"down",title:"select"}))),e$1.createElement($cc7e05a45900e73f$export$b2af6c9944296213,null,e$1.createElement(Qn,{css:{maxHeight:`${ee} !important`},"data-testid":"select-content"},e$1.createElement($cc7e05a45900e73f$export$d8117927658af6d7,null,e$1.createElement(K,{direction:"up",title:"scroll up for more"})),e$1.createElement($cc7e05a45900e73f$export$9ed6e7b40248d36d,null,e$1.createElement($cc7e05a45900e73f$export$ee25a334c55de1f4,null,Z&&e$1.createElement(tr,null,e$1.createElement(L,{"data-testid":"select-label",label:Z})),ie)),e$1.createElement($cc7e05a45900e73f$export$ff951e476c12189,null,e$1.createElement(K,{direction:"down",title:"scroll down for more"}))))),_e=ie=>e$1.createElement(er,{...ie},ie.thumbnail&&e$1.createElement(Ve,{thumbnail:ie.thumbnail}),e$1.createElement($cc7e05a45900e73f$export$3572fb0fb821ff49,null,e$1.createElement(L,{label:ie.label})),e$1.createElement($cc7e05a45900e73f$export$6b9198de19accfe6,null)),nr=m("div",{position:"absolute !important",zIndex:"1",top:"1rem",left:"1rem",width:"161.8px",height:"100px",backgroundColor:"#000D",boxShadow:"5px 5px 5px #0002",borderRadius:"3px",".displayregion":{border:" 3px solid $accent !important",boxShadow:"0 0 3px #0006"},"@sm":{width:"123px",height:"76px"},"@xs":{width:"100px",height:"61.8px"}}),rr=m("div",{position:"relative",width:"100%",height:"100%",zIndex:"0"}),or=m("div",{width:"100%",height:"61.8vh",maxHeight:"100vh",background:"black",backgroundSize:"contain",color:"white",position:"relative",zIndex:"1",overflow:"hidden"}),z=({id:ie,label:Z,children:ee})=>e$1.createElement(Ne,{id:ie,"data-testid":"openseadragon-button"},e$1.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","aria-labelledby":`${ie}-svg-title`,"data-testid":"openseadragon-button-svg",focusable:"false",viewBox:"0 0 512 512",role:"img"},e$1.createElement("title",{id:`${ie}-svg-title`},Z),ee)),ar=m("div",{position:"absolute",zIndex:"1",top:"1rem",display:"flex","@xs":{flexDirection:"column",zIndex:"2"},variants:{hasPlaceholder:{true:{right:"3.618rem","@xs":{top:"3.618rem",right:"1rem"}},false:{right:"1rem","@xs":{top:"1rem",right:"1rem"}}}}}),ir=()=>e$1.createElement("path",{strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M256 112v288M400 256H112"}),lr=()=>e$1.createElement("path",{strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M400 256H112"}),sr=()=>e$1.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M432 320v112H320M421.8 421.77L304 304M80 192V80h112M90.2 90.23L208 208M320 80h112v112M421.77 90.2L304 208M192 432H80V320M90.23 421.8L208 304"}),cr=()=>e$1.createElement("path",{d:"M448 440a16 16 0 01-12.61-6.15c-22.86-29.27-44.07-51.86-73.32-67C335 352.88 301 345.59 256 344.23V424a16 16 0 01-27 11.57l-176-168a16 16 0 010-23.14l176-168A16 16 0 01256 88v80.36c74.14 3.41 129.38 30.91 164.35 81.87C449.32 292.44 464 350.9 464 424a16 16 0 01-16 16z"}),pe=()=>e$1.createElement(e$1.Fragment,null,e$1.createElement("path",{fill:"none",strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M400 148l-21.12-24.57A191.43 191.43 0 00240 64C134 64 48 150 48 256s86 192 192 192a192.09 192.09 0 00181.07-128"}),e$1.createElement("path",{d:"M464 97.42V208a16 16 0 01-16 16H337.42c-14.26 0-21.4-17.23-11.32-27.31L436.69 86.1C446.77 76 464 83.16 464 97.42z"})),dr=({hasPlaceholder:ie,options:Z})=>e$1.createElement(ar,{"data-testid":"openseadragon-controls",hasPlaceholder:ie,id:"openseadragon-controls"},Z.showZoomControl&&e$1.createElement(e$1.Fragment,null,e$1.createElement(z,{id:"zoomIn",label:"zoom in"},e$1.createElement(ir,null)),e$1.createElement(z,{id:"zoomOut",label:"zoom out"},e$1.createElement(lr,null))),Z.showFullPageControl&&e$1.createElement(z,{id:"fullPage",label:"full page"},e$1.createElement(sr,null)),Z.showRotationControl&&e$1.createElement(e$1.Fragment,null,e$1.createElement(z,{id:"rotateRight",label:"rotate right"},e$1.createElement(pe,null)),e$1.createElement(z,{id:"rotateLeft",label:"rotate left"},e$1.createElement(pe,null))),Z.showHomeControl&&e$1.createElement(z,{id:"reset",label:"reset"},e$1.createElement(cr,null))),mr=ie=>fetch(`${ie.replace(/\/$/,"")}/info.json`).then(Z=>Z.json()).then(Z=>Z).catch(Z=>{console.error(`The IIIF tilesource ${ie.replace(/\/$/,"")}/info.json failed to load: ${Z}`)}),ur=ie=>{let Z,ee;if(Array.isArray(ie)&&(Z=ie[0],Z)){let ae;"@id"in Z?ae=Z["@id"]:ae=Z.id,ee=ae}return ee},pr=({uri:ie,hasPlaceholder:Z,imageType:ee})=>{const[ae,ve]=reactExports.useState(),[ye,be]=reactExports.useState(),Ke=k(),{configOptions:Ye}=Ke,Xe={id:`openseadragon-viewport-${ye}`,loadTilesWithAjax:!0,fullPageButton:"fullPage",homeButton:"reset",rotateLeftButton:"rotateLeft",rotateRightButton:"rotateRight",zoomInButton:"zoomIn",zoomOutButton:"zoomOut",showNavigator:!0,showFullPageControl:!0,showHomeControl:!0,showRotationControl:!0,showZoomControl:!0,navigatorBorderColor:"transparent",navigatorId:`openseadragon-navigator-${ye}`,gestureSettingsMouse:{clickToZoom:!0,dblClickToZoom:!0,pinchToZoom:!0,scrollToZoom:!0},...Ye.openSeadragon,ajaxWithCredentials:Ye.withCredentials};return reactExports.useEffect(()=>{ie!==ae&&(ve(ie),be(v4()))},[ae,ie]),reactExports.useEffect(()=>{if(ae)switch(ee){case"simpleImage":le(Xe).addSimpleImage({url:ae});break;case"tiledImage":mr(ae).then(Qe=>le(Xe).addTiledImage({tileSource:Qe}));break;default:console.warn(`Unable to render ${ae} in OpenSeadragon as type: "${ee}"`);break}},[ae]),ye?e$1.createElement(or,{css:{backgroundColor:Ye.canvasBackgroundColor,height:Ye.canvasHeight},className:"clover-viewer-osd-wrapper","data-testid":"clover-viewer-osd-wrapper"},e$1.createElement(dr,{hasPlaceholder:Z,options:Xe}),e$1.createElement(nr,{id:`openseadragon-navigator-${ye}`}),e$1.createElement(rr,{id:`openseadragon-viewport-${ye}`})):null},fr=({painting:ie,hasPlaceholder:Z})=>{const[ee,ae]=reactExports.useState(),[ve,ye]=reactExports.useState();return reactExports.useEffect(()=>{Array.isArray(ie==null?void 0:ie.service)&&(ie==null?void 0:ie.service.length)>0?(ae("tiledImage"),ye(ur(ie==null?void 0:ie.service))):(ae("simpleImage"),ye(ie==null?void 0:ie.id))},[ie]),e$1.createElement(pr,{uri:ve,key:ve,hasPlaceholder:Z,imageType:ee})},gr=({isMedia:ie,label:Z,placeholderCanvas:ee,setIsInteractive:ae})=>{const{vault:ve}=k(),ye=N(ve,ee),be=ye?ye[0]:void 0,Ke=Z?D(Z):["placeholder image"];return e$1.createElement(je,{onClick:()=>ae(!0),isMedia:ie,className:"clover-viewer-placeholder"},e$1.createElement("img",{src:(be==null?void 0:be.id)||"",alt:Ke.join(),height:be==null?void 0:be.height,width:be==null?void 0:be.width}))},hr=m("canvas",{position:"absolute",width:"100%",height:"100%",zIndex:"0"}),xr=e$1.forwardRef((ie,Z)=>{const ee=e$1.useRef(null),ae=reactExports.useCallback(()=>{var ye,be;if((ye=Z.current)!=null&&ye.currentTime&&((be=Z.current)==null?void 0:be.currentTime)>0)return;const Ke=Z.current;if(!Ke)return;const Ye=new AudioContext,Xe=Ye.createMediaElementSource(Ke),Qe=Ye.createAnalyser(),et=ee.current;if(!et)return;et.width=Ke.offsetWidth,et.height=Ke.offsetHeight;const Je=et.getContext("2d");Xe.connect(Qe),Qe.connect(Ye.destination),Qe.fftSize=256;const rt=Qe.frequencyBinCount,it=new Uint8Array(rt);setInterval(function(){ve(Qe,Je,rt,it,et.width,et.height)},20)},[Z]);e$1.useEffect(()=>{!Z||!Z.current||(Z.current.onplay=ae)},[ae,Z]);function ve(ye,be,Ke,Ye,Xe,Qe){const et=Xe/Ke*2.6;let Je,rt=0;ye.getByteFrequencyData(Ye),be.fillStyle="#000000",be.fillRect(0,0,Xe,Qe);for(let it=0;it<Ke;it++)Je=Ye[it]*2,be.fillStyle="rgba(78, 42, 132, 1)",be.fillRect(rt,Qe-Je,et,Je),rt+=et+6}return e$1.createElement(hr,{ref:ee,role:"presentation"})}),vr=m("div",{position:"relative",backgroundColor:"$primaryAlt",display:"flex",flexGrow:"0",flexShrink:"1",maxHeight:"500px",zIndex:"1",video:{backgroundColor:"transparent",objectFit:"contain",width:"100%",height:"100%",position:"relative",zIndex:"1"}}),br=({resource:ie,ignoreCaptionLabels:Z})=>{const ee=D(ie.label,"en");return Array.isArray(ee)&&ee.some(ae=>Z.includes(ae))?null:e$1.createElement("track",{key:ie.id,src:ie.id,label:Array.isArray(ee)?ee[0]:ee,srcLang:"en","data-testid":"player-track"})},yr=({allSources:ie,resources:Z,painting:ee})=>{const[ae,ve]=e$1.useState(0),[ye,be]=e$1.useState(),Ke=e$1.useRef(null),Ye=(ee==null?void 0:ee.type)==="Sound",Xe=k(),{activeCanvas:Qe,configOptions:et,vault:Je}=Xe;return reactExports.useEffect(()=>{if(!ee.id||!Ke.current)return;if(Ke!=null&&Ke.current){const nt=Ke.current;nt.src=ee.id,nt.load()}if(ee.id.split(".").pop()!=="m3u8")return;const rt={xhrSetup:function(nt,tt){nt.withCredentials=!!et.withCredentials}},it=new Hls(rt);return it.attachMedia(Ke.current),it.on(Hls.Events.MEDIA_ATTACHED,function(){it.loadSource(ee.id)}),it.on(Hls.Events.ERROR,function(nt,tt){if(tt.fatal)switch(tt.type){case Hls.ErrorTypes.NETWORK_ERROR:console.error(`fatal ${nt} network error encountered, try to recover`),it.startLoad();break;case Hls.ErrorTypes.MEDIA_ERROR:console.error(`fatal ${nt} media error encountered, try to recover`),it.recoverMediaError();break;default:it.destroy();break}}),()=>{if(it&&Ke.current){const nt=Ke.current;it.detachMedia(),it.destroy(),nt.currentTime=0}}},[et.withCredentials,ee.id]),reactExports.useEffect(()=>{var rt,it,nt,tt;const st=Je.get(Qe),ot=(rt=st.accompanyingCanvas)!=null&&rt.id?N(Je,(it=st.accompanyingCanvas)==null?void 0:it.id):null,ut=(nt=st.placeholderCanvas)!=null&&nt.id?N(Je,(tt=st.placeholderCanvas)==null?void 0:tt.id):null;ot&&ut?be(ae===0?ut[0].id:ot[0].id):(ot&&be(ot[0].id),ut&&be(ut[0].id))},[Qe,ae,Je]),reactExports.useEffect(()=>{if(Ke!=null&&Ke.current){const rt=Ke.current;return rt==null||rt.addEventListener("timeupdate",()=>ve(rt.currentTime)),()=>document.removeEventListener("timeupdate",()=>{})}},[]),e$1.createElement(vr,{css:{backgroundColor:et.canvasBackgroundColor,maxHeight:et.canvasHeight,position:"relative"},"data-testid":"player-wrapper",className:"clover-viewer-player-wrapper"},e$1.createElement("video",{id:"clover-iiif-video",key:ee.id,ref:Ke,controls:!0,height:ee.height,width:ee.width,crossOrigin:"anonymous",poster:ye,style:{maxHeight:et.canvasHeight,position:"relative",zIndex:"1"}},ie.map(rt=>e$1.createElement("source",{src:rt.id,type:rt.format,key:rt.id})),Z.length>0&&Z.map(rt=>e$1.createElement(br,{resource:rt,ignoreCaptionLabels:et.ignoreCaptionLabels||[],key:rt.id})),"Sorry, your browser doesn't support embedded videos."),Ye&&e$1.createElement(xr,{ref:Ke}))},Er=()=>e$1.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","aria-labelledby":"close-svg-title",focusable:"false",viewBox:"0 0 512 512",role:"img"},e$1.createElement("title",{id:"close-svg-title"},"close"),e$1.createElement("path",{d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"})),wr=({isMedia:ie})=>e$1.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","aria-labelledby":"open-svg-title",focusable:"false",viewBox:"0 0 512 512",role:"img"},e$1.createElement("title",{id:"open-svg-title"},"open"),ie?e$1.createElement("path",{d:"M133 440a35.37 35.37 0 01-17.5-4.67c-12-6.8-19.46-20-19.46-34.33V111c0-14.37 7.46-27.53 19.46-34.33a35.13 35.13 0 0135.77.45l247.85 148.36a36 36 0 010 61l-247.89 148.4A35.5 35.5 0 01133 440z"}):e$1.createElement(e$1.Fragment,null,e$1.createElement("path",{d:"m456.69,421.39l-94.09-94.09c22.65-30.16,34.88-66.86,34.84-104.58,0-96.34-78.38-174.72-174.72-174.72S48,126.38,48,222.72s78.38,174.72,174.72,174.72c37.72.04,74.42-12.19,104.58-34.84l94.09,94.09c10.29,9.2,26.1,8.32,35.3-1.98,8.48-9.49,8.48-23.83,0-33.32Zm-233.97-73.87c-68.89-.08-124.72-55.91-124.8-124.8h0c0-68.93,55.87-124.8,124.8-124.8s124.8,55.87,124.8,124.8-55.87,124.8-124.8,124.8Z"}),e$1.createElement("path",{d:"m279.5,197.76h-3.35s-28.47,0-28.47,0v-31.82c-.77-13.79-12.57-24.33-26.36-23.56-12.71.71-22.85,10.86-23.56,23.56v3.35h0v28.47h-31.82c-13.79.77-24.33,12.57-23.56,26.36.71,12.71,10.86,22.85,23.56,23.56h3.35s28.47,0,28.47,0v31.82c.77,13.79,12.57,24.33,26.36,23.56,12.71-.71,22.85-10.86,23.56-23.56v-3.35h0v-28.47h31.82c13.79-.77,24.33-12.57,23.56-26.36-.71-12.71-10.86-22.85-23.56-23.56Z"}))),Cr=({handleToggle:ie,isInteractive:Z,isMedia:ee})=>e$1.createElement(Ge,{onClick:ie,isInteractive:Z,isMedia:ee,"data-testid":"placeholder-toggle"},Z?e$1.createElement(Er,null):e$1.createElement(wr,{isMedia:ee})),Sr=({activeCanvas:ie,isMedia:Z,painting:ee,resources:ae})=>{var ve,ye,be;const[Ke,Ye]=e$1.useState(0),[Xe,Qe]=e$1.useState(!1),{configOptions:et,customDisplays:Je,vault:rt}=k(),it=rt.get(ie),nt=(ve=it==null?void 0:it.placeholderCanvas)==null?void 0:ve.id,tt=!!nt,st=(ee==null?void 0:ee.length)>1,ot=nt&&!Xe&&!Z,ut=()=>Qe(!Xe),ft=mt=>{const Yr=ee.findIndex(ri=>ri.id===mt);Ye(Yr)},pt=Je.find(mt=>{var Yr;let ri=!1;const{canvasId:Zr,paintingFormat:_r}=mt.target;if(Array.isArray(Zr)&&Zr.length>0&&(ri=Zr.includes(ie)),Array.isArray(_r)&&_r.length>0){const Kr=((Yr=ee[Ke])==null?void 0:Yr.format)||"";ri=!!(Kr&&_r.includes(Kr))}return ri}),Xr=(ye=pt==null?void 0:pt.display)==null?void 0:ye.component;return e$1.createElement(Xn,{className:"clover-viewer-painting"},e$1.createElement(Yn,{style:{backgroundColor:et.canvasBackgroundColor,maxHeight:et.canvasHeight}},nt&&!Z&&e$1.createElement(Cr,{handleToggle:ut,isInteractive:Xe,isMedia:Z}),ot&&!Z&&e$1.createElement(gr,{isMedia:Z,label:it==null?void 0:it.label,placeholderCanvas:nt,setIsInteractive:Qe}),!ot&&!pt&&(Z?e$1.createElement(yr,{allSources:ee,painting:ee[Ke],resources:ae}):ee&&e$1.createElement(fr,{painting:ee[Ke],hasPlaceholder:tt,key:ie})),!ot&&Xr&&e$1.createElement(Xr,{id:ie,annotationBody:ee[Ke],...pt==null?void 0:pt.display.componentProps})),st&&e$1.createElement(Ue,{value:(be=ee[Ke])==null?void 0:be.id,onValueChange:ft,maxHeight:"200px"},ee==null?void 0:ee.map(mt=>e$1.createElement(_e,{value:mt==null?void 0:mt.id,key:mt==null?void 0:mt.id,label:mt==null?void 0:mt.label}))))},kr=({activeCanvas:ie,painting:Z,resources:ee,items:ae,isAudioVideo:ve})=>{const{informationOpen:ye,configOptions:be}=k(),{informationPanel:Ke}=be,Ye=(Ke==null?void 0:Ke.renderAbout)||(Ke==null?void 0:Ke.renderSupplementing)&&ee.length>0;return e$1.createElement(Ae,{className:"clover-viewer-content","data-testid":"clover-viewer-content"},e$1.createElement(Te,null,e$1.createElement(Sr,{activeCanvas:ie,isMedia:ve,painting:Z,resources:ee}),Ye&&e$1.createElement(Me,null,e$1.createElement("span",null,ye?"View Items":"More Information")),ae.length>1&&e$1.createElement($e,{className:"clover-viewer-media-wrapper"},e$1.createElement(Zn,{items:ae,activeItem:0}))),ye&&Ye&&e$1.createElement($t,null,e$1.createElement(Re,null,e$1.createElement(xn,{activeCanvas:ie,resources:ee}))))},Ir=m(W.Trigger,{width:"30px",padding:"5px"}),$r=m(W.Content,{display:"flex",flexDirection:"column",fontSize:"0.8333rem",border:"none",boxShadow:"2px 2px 5px #0003",zIndex:"2",button:{display:"flex",textDecoration:"none",marginBottom:"0.5em",color:"$accentAlt",cursor:"pointer",background:"$secondary",border:"none","&:last-child":{marginBottom:"0"}}}),Ar=m("span",{fontSize:"1.33rem",alignSelf:"flex-start",flexGrow:"0",flexShrink:"1",padding:"1rem","@sm":{fontSize:"1rem"},"&.visually-hidden":{position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",border:"0"}}),Tr=m("header",{display:"flex",backgroundColor:"transparent !important",justifyContent:"space-between",alignItems:"flex-start",width:"100%",[`> ${qe}`]:{flexGrow:"1",flexShrink:"0"},form:{flexGrow:"0",flexShrink:"1"}}),Mr=m("div",{display:"flex",alignItems:"flex-end",justifyContent:"flex-end",padding:"1rem",flexShrink:"0",flexGrow:"1"}),Rr=()=>{var ie;const Z=O(),ee=k(),{activeManifest:ae,collection:ve,configOptions:ye,vault:be}=ee,Ke=ye==null?void 0:ye.canvasHeight,Ye=Xe=>{Z({type:"updateActiveManifest",manifestId:Xe})};return e$1.createElement("div",{style:{margin:"0.75rem"}},e$1.createElement(Ue,{label:ve.label,maxHeight:Ke,value:ae,onValueChange:Ye},(ie=ve==null?void 0:ve.items)==null?void 0:ie.map(Xe=>e$1.createElement(_e,{value:Xe.id,key:Xe.id,thumbnail:Xe!=null&&Xe.thumbnail?be.get(Xe==null?void 0:Xe.thumbnail):void 0,label:Xe.label}))))},zr=(ie,Z=2500)=>{const[ee,ae]=reactExports.useState(),ve=reactExports.useCallback(()=>{navigator.clipboard.writeText(ie).then(()=>ae("copied"),()=>ae("failed"))},[ie]);return reactExports.useEffect(()=>{if(!ee)return;const ye=setTimeout(()=>ae(void 0),Z);return()=>clearTimeout(ye)},[ee]),[ee,ve]},Lr=m("span",{display:"flex",alignContent:"center",alignItems:"center",padding:"0.125rem 0.25rem 0",marginTop:"-0.125rem",marginLeft:"0.5rem",backgroundColor:"$accent",color:"$secondary",borderRadius:"3px",fontSize:"0.6111rem",textTransform:"uppercase",lineHeight:"1em"}),Fr=({status:ie})=>ie?e$1.createElement(Lr,{"data-copy-status":ie},ie):null,fe=({textPrompt:ie,textToCopy:Z})=>{const[ee,ae]=zr(Z);return e$1.createElement("button",{onClick:ae},ie," ",e$1.createElement(Fr,{status:ee}))},Pr=()=>{const ie="#ed1d33",Z="#2873ab";return e$1.createElement("svg",{viewBox:"0 0 493.35999 441.33334",id:"iiif-logo",version:"1.1"},e$1.createElement("title",null,"IIIF Manifest Options"),e$1.createElement("g",{transform:"matrix(1.3333333,0,0,-1.3333333,0,441.33333)"},e$1.createElement("g",{transform:"scale(0.1)"},e$1.createElement("path",{style:{fill:Z},d:"M 65.2422,2178.75 775.242,1915 773.992,15 65.2422,276.25 v 1902.5"}),e$1.createElement("path",{style:{fill:Z},d:"m 804.145,2640.09 c 81.441,-240.91 -26.473,-436.2 -241.04,-436.2 -214.558,0 -454.511,195.29 -535.9527,436.2 -81.4335,240.89 26.4805,436.18 241.0387,436.18 214.567,0 454.512,-195.29 535.954,-436.18"}),e$1.createElement("path",{style:{fill:ie},d:"M 1678.58,2178.75 968.578,1915 969.828,15 1678.58,276.25 v 1902.5"}),e$1.createElement("path",{style:{fill:ie},d:"m 935.082,2640.09 c -81.437,-240.91 26.477,-436.2 241.038,-436.2 214.56,0 454.51,195.29 535.96,436.2 81.43,240.89 -26.48,436.18 -241.04,436.18 -214.57,0 -454.52,-195.29 -535.958,-436.18"}),e$1.createElement("path",{style:{fill:Z},d:"m 1860.24,2178.75 710,-263.75 -1.25,-1900 -708.75,261.25 v 1902.5"}),e$1.createElement("path",{style:{fill:Z},d:"m 2603.74,2640.09 c 81.45,-240.91 -26.47,-436.2 -241.03,-436.2 -214.58,0 -454.52,195.29 -535.96,436.2 -81.44,240.89 26.48,436.18 241.03,436.18 214.57,0 454.51,-195.29 535.96,-436.18"}),e$1.createElement("path",{style:{fill:ie},d:"m 3700.24,3310 v -652.5 c 0,0 -230,90 -257.5,-142.5 -2.5,-247.5 0,-336.25 0,-336.25 l 257.5,83.75 V 1690 l -258.61,-92.5 V 262.5 L 2735.24,0 v 2360 c 0,0 -15,850 965,950"}))))},Vr=m($6be4966fd9bbc698$export$be92b6f5f03c0fe9,{all:"unset",height:"2rem",width:"3.236rem",backgroundColor:"#6663",borderRadius:"9999px",position:"relative",WebkitTapHighlightColor:"transparent",cursor:"pointer","&:focus":{boxShadow:"0 0 0 2px $secondaryAlt"},'&[data-state="checked"]':{backgroundColor:"$accent",boxShadow:"inset 2px 2px 5px #0003"}}),Br=m($6be4966fd9bbc698$export$6521433ed15a34db,{display:"block",height:"calc(2rem - 12px)",width:"calc(2rem - 12px)",backgroundColor:"$secondary",borderRadius:"100%",boxShadow:"2px 2px 5px #0001",transition:"$all",transform:"translateX(6px)",willChange:"transform",'&[data-state="checked"]':{transform:"translateX(calc(1.236rem + 6px))"}}),Hr=m("label",{fontSize:"0.8333rem",fontWeight:"400",lineHeight:"1em",userSelect:"none",cursor:"pointer",paddingRight:"0.618rem"}),Or=m("form",{display:"flex",flexShrink:"0",flexGrow:"1",alignItems:"center",marginLeft:"1.618rem"}),Dr=()=>{var ie;const{configOptions:Z}=k(),ee=O(),[ae,ve]=reactExports.useState((ie=Z==null?void 0:Z.informationPanel)==null?void 0:ie.open);return reactExports.useEffect(()=>{ee({type:"updateInformationOpen",informationOpen:ae})},[ae]),e$1.createElement(Or,null,e$1.createElement(Hr,{htmlFor:"information-toggle",css:ae?{opacity:"1"}:{}},"More Information"),e$1.createElement(Vr,{checked:ae,onCheckedChange:()=>ve(!ae),id:"information-toggle","aria-label":"information panel toggle",name:"toggled?"},e$1.createElement(Br,null)))},Ze=ie=>{const Z=()=>window.matchMedia?window.matchMedia(ie).matches:!1,[ee,ae]=reactExports.useState(Z);return reactExports.useEffect(()=>{const ve=()=>ae(Z);return window.addEventListener("resize",ve),()=>window.removeEventListener("resize",ve)}),ee},Wr=({manifestId:ie,manifestLabel:Z})=>{const ee=k(),{collection:ae,configOptions:ve}=ee,{showTitle:ye,showIIIFBadge:be,informationPanel:Ke}=ve,Ye=be||(Ke==null?void 0:Ke.renderToggle),Xe=Ze(te.sm);return e$1.createElement(Tr,{className:"clover-viewer-header"},ae!=null&&ae.items?e$1.createElement(Rr,null):e$1.createElement(Ar,{className:ye?"":"visually-hidden"},ye&&e$1.createElement(L,{label:Z,className:"label"})),Ye&&e$1.createElement(Mr,null,be&&e$1.createElement(W,null,e$1.createElement(Ir,null,e$1.createElement(Pr,null)),e$1.createElement($r,null,(ae==null?void 0:ae.items)&&e$1.createElement("button",{onClick:Qe=>{Qe.preventDefault(),window.open(ae.id,"_blank")}},"View Collection"),e$1.createElement("button",{onClick:Qe=>{Qe.preventDefault(),window.open(ie,"_blank")}},"View Manifest")," ",(ae==null?void 0:ae.items)&&e$1.createElement(fe,{textPrompt:"Copy Collection URL",textToCopy:ae.id}),e$1.createElement(fe,{textPrompt:"Copy Manifest URL",textToCopy:ie}))),(Ke==null?void 0:Ke.renderToggle)&&!Xe&&e$1.createElement(Dr,null)))},jr=(ie=!1)=>{const[Z,ee]=reactExports.useState(ie);return reactExports.useLayoutEffect(()=>{if(!Z)return;const ae=document.documentElement.style.overflow;return document.documentElement.style.overflow="hidden",()=>{document.documentElement.style.overflow=ae}},[Z]),reactExports.useEffect(()=>{Z!==ie&&ee(ie)},[ie]),[Z,ee]},Nr=({manifest:ie,theme:Z})=>{var ee;const ae=k(),ve=O(),{activeCanvas:ye,informationOpen:be,vault:Ke,configOptions:Ye}=ae,[Xe,Qe]=reactExports.useState(!1),[et,Je]=reactExports.useState(!1),[rt,it]=reactExports.useState([]),[nt,tt]=reactExports.useState([]),[st,ot]=jr(!1),ut=Ze(te.sm),ft=reactExports.useCallback(pt=>{ve({type:"updateInformationOpen",informationOpen:pt})},[ve]);return reactExports.useEffect(()=>{var pt;(pt=Ye==null?void 0:Ye.informationPanel)!=null&&pt.open&&ft(!ut)},[ut,(ee=Ye==null?void 0:Ye.informationPanel)==null?void 0:ee.open,ft]),reactExports.useEffect(()=>{if(!ut){ot(!1);return}ot(be)},[be,ut,ot]),reactExports.useEffect(()=>{const pt=N(Ke,ye),Xr=yt(Ke,ye,"text/vtt");pt&&(Je(["Sound","Video"].indexOf(pt[0].type)>-1),it(pt)),tt(Xr),Qe(Xr.length!==0)},[ye,Ke]),e$1.createElement(ErrorBoundary,{FallbackComponent:It},e$1.createElement(At,{className:`${Z} clover-viewer`,css:{background:Ye==null?void 0:Ye.background},"data-body-locked":st,"data-information-panel":Xe,"data-information-panel-open":be},e$1.createElement($409067139f391064$export$be92b6f5f03c0fe9,{open:be,onOpenChange:ft},e$1.createElement(Wr,{manifestLabel:ie.label,manifestId:ie.id}),e$1.createElement(kr,{activeCanvas:ye,painting:rt,resources:nt,items:ie.items,isAudioVideo:et}))))},ge={ignoreCache:!1,headers:{Accept:"application/json, text/javascript, text/plain"},timeout:5e3,withCredentials:!1};function Gr(ie){return{ok:ie.status>=200&&ie.status<300,status:ie.status,statusText:ie.statusText,headers:ie.getAllResponseHeaders(),data:ie.responseText,json:()=>JSON.parse(ie.responseText)}}function he(ie,Z=null){return{ok:!1,status:ie.status,statusText:ie.statusText,headers:ie.getAllResponseHeaders(),data:Z||ie.statusText,json:()=>JSON.parse(Z||ie.statusText)}}function qr(ie,Z=ge){const ee=Z.headers||ge.headers;return new Promise((ae,ve)=>{const ye=new XMLHttpRequest;ye.open("get",ie),ye.withCredentials=Z.withCredentials,ee&&Object.keys(ee).forEach(be=>ye.setRequestHeader(be,ee[be])),ye.onload=()=>{ae(Gr(ye))},ye.onerror=()=>{ve(he(ye,"Failed to make request."))},ye.ontimeout=()=>{ve(he(ye,"Request took longer than expected."))},ye.send()})}const ao=({canvasIdCallback:ie=()=>{},customDisplays:Z=[],customTheme:ee,iiifContent:ae,id:ve,manifestId:ye,options:be})=>{var Ke;let Ye=ae;return ve&&(Ye=ve),ye&&(Ye=ye),e$1.createElement(bt,{initialState:{..._,customDisplays:Z,informationOpen:!!((Ke=be==null?void 0:be.informationPanel)!=null&&Ke.open),vault:new Vault({customFetcher:Xe=>qr(Xe,{withCredentials:be==null?void 0:be.withCredentials,headers:be==null?void 0:be.requestHeaders}).then(Qe=>JSON.parse(Qe.data))})}},e$1.createElement(Ur,{iiifContent:Ye,canvasIdCallback:ie,customTheme:ee,options:be}))},Ur=({canvasIdCallback:ie,customTheme:Z,iiifContent:ee,options:ae})=>{const ve=O(),ye=k(),{activeCanvas:be,activeManifest:Ke,isLoaded:Ye,vault:Xe}=ye,[Qe,et]=reactExports.useState(),[Je,rt]=reactExports.useState();let it={};return Z&&(it=Q$1("custom",Z)),reactExports.useEffect(()=>{ie&&ie(be)},[be,ie]),reactExports.useEffect(()=>{Ke&&Xe.loadManifest(Ke).then(nt=>{rt(nt),ve({type:"updateActiveCanvas",canvasId:nt.items[0]&&nt.items[0].id})}).catch(nt=>{console.error(`Manifest failed to load: ${nt}`)}).finally(()=>{ve({type:"updateIsLoaded",isLoaded:!0})})},[Ke,ve,Xe]),reactExports.useEffect(()=>{ve({type:"updateConfigOptions",configOptions:ae}),Xe.load(ee).then(nt=>{et(nt)}).catch(nt=>{console.error(`The IIIF resource ${ee} failed to load: ${nt}`)})},[ve,ee,ae,Xe]),reactExports.useEffect(()=>{let nt=[];(Qe==null?void 0:Qe.type)==="Collection"?(ve({type:"updateCollection",collection:Qe}),nt=Qe.items.filter(tt=>tt.type==="Manifest").map(tt=>tt.id),nt.length>0&&ve({type:"updateActiveManifest",manifestId:nt[0]})):(Qe==null?void 0:Qe.type)==="Manifest"&&ve({type:"updateActiveManifest",manifestId:Qe.id})},[ve,Qe]),Ye?!Je||!Je.items?(console.log(`The IIIF manifest ${ee} failed to load.`),e$1.createElement(e$1.Fragment,null)):Je.items.length===0?(console.log(`The IIIF manifest ${ee} does not contain canvases.`),e$1.createElement(e$1.Fragment,null)):e$1.createElement(Nr,{manifest:Je,theme:it,key:Je.id}):e$1.createElement(e$1.Fragment,null,"Loading")};export{ao as default};
